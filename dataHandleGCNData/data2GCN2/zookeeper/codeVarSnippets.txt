fileoffset fp read file read buffer buffer length String buf String buffer
FilterOp fo starttime request getNumber endtime request getNumber period request getNumber String filterstr request getString filterstr fo FilterParser filterstr parse starttime starttime source getStartTime endtime period endtime starttime period endtime starttime DEFAULT_PERIOD
starttime starttime source getStartTime endtime period endtime starttime period endtime source getEndTime LogIterator iter source iterator starttime endtime JSONObject data JSONObject data put starttime data put endtime size size iter size data put size
e cfg ZooKeeperService mapContext e getContext e gws addGrizzlyAdapter createJerseyAdapter e String e getContext System out println String jks cfg getJKS String jksPassword cfg getJKSPassword SSLConfig sslConfig SSLConfig URL resource getClass getClassLoader getResource jks resource LOG error jks System exit sslConfig setKeyStoreFile File resource toURI getAbsolutePath
ZooKeeper String contextPath String session String connectionId concat contextPath session ZooKeeper zk zkMap get connectionId zk
String params String parts params split serverId Integer parseInt parts
e e printStackTrace spaceIndex params indexOf spaceIndex LOG warn params String quorumSpecs params substring spaceIndex String cmd params substring spaceIndex LOG LOG debug cmd cmd peer peer shutdown
String quorumSpecs params substring spaceIndex String cmd params substring spaceIndex LOG LOG debug cmd cmd peer peer shutdown peer Thread sleep Socket clientAddr getPort close
Socket clientAddr getPort close e r report e LOG error e String parts quorumSpecs split peers HashMap Long QuorumServer i i parts i String subparts parts i split split String clientPort parts i split peers put Long valueOf i QuorumServer i InetSocketAddress subparts Integer parseInt subparts InetSocketAddress subparts Integer parseInt subparts InetSocketAddress subparts Integer parseInt clientPort
Assert fail i Thread sleep i i i stopServer i i startServer i i Assert assertTrue waitForConnect zk zk setData getBytes Assert assertTrue waitForConnect zk zk setData getBytes
state State STOP dispatchEvent EventType STOP_START LOG info leaderOffer zooKeeper delete leaderOffer getNodePath
state State DETERMINE dispatchEvent EventType DETERMINE_START LeaderOffer currentLeaderOffer getLeaderOffer String components currentLeaderOffer getNodePath split currentLeaderOffer setId Integer valueOf components components length substring length List LeaderOffer leaderOffers toLeaderOffers zooKeeper getChildren rootNodeName i i leaderOffers i LeaderOffer leaderOffer leaderOffers get i leaderOffer currentLeaderOffer
neighborLeaderOffer LOG info getLeaderOffer getNodePath neighborLeaderOffer getNodePath Stat stat zooKeeper exists neighborLeaderOffer getNodePath stat dispatchEvent EventType READY_START
ArrayList EventType events ArrayList CountDownLatch electedComplete CountDownLatch LeaderElectionSupport electionSupport1 createLeaderElectionSupport electionSupport1 start LeaderElectionSupport electionSupport2 createLeaderElectionSupport stoppedElectedNode EventType eventType events add eventType stoppedElectedNode eventType EventType stoppedElectedNode electionSupport1 stop
packet waitStartTime Time currentElapsedTime packet packet wait requestTimeout packet Time currentElapsedTime waitStartTime requestTimeout
requestTimeout clientConfig getLong ZKClientConfig ZOOKEEPER_REQUEST_TIMEOUT ZKClientConfig ZOOKEEPER_REQUEST_TIMEOUT_DEFAULT
packetLen clientConfig getInt ZKConfig JUTE_MAXBUFFER ZKClientConfig CLIENT_MAX_PACKET_LENGTH_DEFAULT
sockKey SocketChannel sock SocketChannel sockKey channel sockKey cancel sock socket shutdownInput e LOG debug e sock socket shutdownOutput e LOG debug e sock socket close e
sock socket shutdownInput e LOG debug e sock socket shutdownOutput e LOG debug e sock socket close e LOG debug e sock close e
List Entry env Environment list Entry env
String principalUserName clientConfig getProperty ZKClientConfig ZK_SASL_CLIENT_USERNAME ZKClientConfig ZK_SASL_CLIENT_USERNAME_DEFAULT String hostName addr getHostName canonicalize String canonicalizeText clientConfig getProperty ZKClientConfig ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME ZKClientConfig ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME_DEFAULT canonicalize Boolean parseBoolean canonicalizeText IllegalArgumentException LOG warn ZKClientConfig ZK_SASL_CLIENT_CANONICALIZE_HOSTNAME canonicalizeText canonicalize canonicalize WrapperInetAddress ia addr getAddress ia IllegalArgumentException addr String canonicalHostName ia getCanonicalHostName canonicalHostName ia hostName canonicalHostName
zk String pathRoot PathUtils validatePath pathRoot List String tree listSubTreeBFS zk pathRoot
zk String pathRoot PathUtils validatePath pathRoot List String tree listSubTreeBFS zk pathRoot
System out println jlinemissing Class consoleC Class forName Class completorC Class forName System out println Object console consoleC getConstructor newInstance Object completor completorC getConstructor ZooKeeper newInstance zk Method addCompletor consoleC getMethod Class forName addCompletor invoke console completor String line Method readLine consoleC getMethod String line String readLine invoke console executeLine line
SetACLRequest setACLRequest SetACLRequest deserialize request setACLRequest path setACLRequest getPath acls ZKUtil aclToString setACLRequest getAcl acls getACLs request op AuditConstants OP_MULTI_OP logMultiOperation request txnResult op AuditConstants
Subject subject login getSubject subject login retval Subject subject LOG debug saslToken length saslClient evaluateChallenge saslToken retval e String error e String UNKNOWN_SERVER_ERROR_TEXT e UNKNOWN_SERVER_ERROR_TEXT error
Set InetAddress validInetAddresses HashSet Enumeration NetworkInterface allNetworkInterfaces NetworkInterface getNetworkInterfaces NetworkInterface allNetworkInterfaces InetAddress
String String path Objects requireNonNull path String pathComponents StringUtils split path readLock lock TrieNode parent rootNode TrieNode deepestPropertyNode String element pathComponents parent parent getChild element parent
config String supplierContextClassName config getProperty sslContextSupplierClassProperty supplierContextClassName
javaVersion Objects requireNonNull javaVersion javaVersion
shouldResetContext Path dirPath filePath getParent event kind shouldResetContext event kind event kind Path eventFilePath dirPath resolve Path event context filePath eventFilePath shouldResetContext shouldResetContext LOG debug event kind event context resetDefaultSSLContextAndOptions e RuntimeException e
Object hdm Class forName getConstructor newInstance String mbean System getProperty ObjectName mbo ObjectName mbean mbs registerMBean hdm mbo Object rootLogger Class forName getMethod Class invoke Object Object rootLoggerName rootLogger getClass getMethod Class invoke rootLogger Object hdm getClass getMethod String invoke hdm rootLoggerName Object r Class forName getMethod Class invoke Object Enumeration enumer Enumeration r getClass getMethod Class invoke r Object enumer Object logger enumer nextElement Object loggerName logger getClass getMethod Class invoke logger Object hdm getClass getMethod String invoke hdm loggerName
minIntervalMs getMinIntervalMs containerPath startMs Time currentElapsedTime ByteBuffer path ByteBuffer wrap containerPath getBytes Request request Request ZooDefs OpCode deleteContainer path
String lastPrefix String statNode Quotas statPath lastPrefix DataNode node nodes get statNode StatsTrack updatedStat node
String statNode Quotas statPath lastPrefix DataNode node nodes get statNode StatsTrack updatedStat node LOG error statNode node updatedStat StatsTrack String node data updatedStat setCount updatedStat getCount countDiff updatedStat setBytes updatedStat getBytes bytesDiff node data updatedStat toString getBytes String quotaNode Quotas quotaPath lastPrefix node nodes get quotaNode StatsTrack thisStats node
session zxid String String path deleted String sessionHex Long toHexString session deleteNode path zxid deleted
header digest zxid header getZxid digest digest RATE_LOGGER rateLimitLog String valueOf zxid logDigest digest getTreeDigest actualDigest getTreeDigest logDigest actualDigest reportDigestMismatch zxid LOG debug logDigest actualDigest
digest RATE_LOGGER rateLimitLog String valueOf zxid logDigest digest getTreeDigest actualDigest getTreeDigest logDigest actualDigest reportDigestMismatch zxid LOG debug logDigest actualDigest firstMismatchTxn LOG error header txn digest actualDigest firstMismatchTxn
zks decInProcess zks requestFinished request Code err Code OK Record rsp String path responseSize request request AuditHelper addAuditLog request rc request getException request getException KeeperException create KeeperException Code get ErrorTxn request getTxn getErr KeeperException ke request getException ke
rsp GetAllChildrenNumberResponse number lastOp GetChildren2Request getChildren2Request GetChildren2Request ByteBufferInputStream byteBuffer2Record request request getChildren2Request Stat stat Stat path getChildren2Request getPath DataNode n zks getZKDatabase getNode path n KeeperException NoNodeException zks checkACL request cnxn zks getZKDatabase aclForNode n ZooDefs Perms READ request authInfo path List String children zks getZKDatabase getChildren path stat getChildren2Request getWatch cnxn rsp GetChildren2Response children stat requestPathMetricsCollector registerRequest request type path
sock socket shutdownOutput e LOG debug e sock socket shutdownInput e LOG debug e sock socket close e LOG debug e sock close e
UnsupportedOperationException configureSaslLogin maxClientCnxns maxcc initMaxCnxns sessionlessCnxnTimeout Integer getInteger ZOOKEEPER_NIO_SESSIONLESS_CNXN_TIMEOUT cnxnExpiryQueue ExpiryQueue NIOServerCnxn sessionlessCnxnTimeout expirerThread ConnectionExpirerThread numCores Runtime getRuntime availableProcessors numSelectorThreads Integer getInteger ZOOKEEPER_NIO_NUM_SELECTOR_THREADS Math max Math sqrt numCores numSelectorThreads IOException numWorkerThreads Integer getInteger ZOOKEEPER_NIO_NUM_WORKER_THREADS numCores workerShutdownTimeoutMS Long getLong ZOOKEEPER_NIO_SHUTDOWN_TIMEOUT String logMsg sessionlessCnxnTimeout numSelectorThreads numWorkerThreads numWorkerThreads directBufferBytes directBufferBytes
tryClose oldSS acceptThread wakeupSelector acceptThread join e LOG error e Thread currentThread interrupt ss ServerSocketChannel open ss socket setReuseAddress LOG info addr ss socket bind addr ss configureBlocking acceptThread AcceptThread ss addr selectorThreads acceptThread start e
limit outstandingHandshakeLimit limit handshakeThrottlingEnabled secure shouldUsePortUnification outstandingHandshakeLimit
String authProviderProp System getProperty x509Util getSslAuthProviderProperty SslContext nettySslContext authProviderProp SSLContextAndOptions sslContextAndOptions x509Util getDefaultSSLContextAndOptions nettySslContext sslContextAndOptions createNettyJdkSslContext sslContextAndOptions getSSLContext SSLContext sslContext SSLContext getInstance ClientX509Util DEFAULT_PROTOCOL X509AuthenticationProvider authProvider X509AuthenticationProvider ProviderRegistry getProvider System getProperty x509Util getSslAuthProviderProperty authProvider LOG error authProviderProp SSLContextException authProviderProp sslContext init X509KeyManager authProvider getKeyManager X509TrustManager authProvider getTrustManager nettySslContext x509Util getDefaultSSLContextAndOptions createNettyJdkSslContext sslContext p addLast DualModeSslHandler nettySslContext
SSLContextAndOptions sslContextAndOptions x509Util getDefaultSSLContextAndOptions nettySslContext sslContextAndOptions createNettyJdkSslContext sslContextAndOptions getSSLContext SSLContext sslContext SSLContext getInstance ClientX509Util DEFAULT_PROTOCOL X509AuthenticationProvider authProvider X509AuthenticationProvider ProviderRegistry getProvider System getProperty x509Util getSslAuthProviderProperty authProvider LOG error authProviderProp SSLContextException authProviderProp sslContext init X509KeyManager authProvider getKeyManager X509TrustManager authProvider getTrustManager nettySslContext x509Util getDefaultSSLContextAndOptions createNettyJdkSslContext sslContext p addLast DualModeSslHandler nettySslContext LOG debug p channel p addLast nettySslContext newHandler p channel alloc
path lastSlash path lastIndexOf lastSlash path
op Record subrequest op toRequestRecord type Record txn ke type OpCode error txn ErrorTxn Code RUNTIMEINCONSISTENCY intValue pRequest2Txn op getType zxid request subrequest type op getType txn request getTxn e ke e type OpCode error
baos BinaryOutputArchive boa BinaryOutputArchive getArchive baos txn serialize boa ByteBuffer bb ByteBuffer wrap baos toByteArray txns add Txn type bb array request setTxn MultiTxn txns setTxnDigest request request pRequest2Txn request type zks getNextZxid request zks request request request type
txn serialize boa ByteBuffer bb ByteBuffer wrap baos toByteArray txns add Txn type bb array request setTxn MultiTxn txns setTxnDigest request request pRequest2Txn request type zks getNextZxid request zks request request request type
List ACL rv ArrayList ACL a LOG debug a a KeeperException InvalidACLException path Id id a getId id id getScheme KeeperException InvalidACLException path id getScheme id getId rv add a id getScheme authIdValid Id cid ServerAuthenticationProvider ap ProviderRegistry getServerProvider cid getScheme ap
digest zks zks digest zks getZKDatabase getDataTree getTreeDigest
startTime Time currentElapsedTime zxid snapLog restore dataTree sessionsWithTimeouts commitProposalPlaybackListener initialized loadTime Time currentElapsedTime startTime ServerMetrics getMetrics DB_INIT_TIME add loadTime
enabled snapshotSizeFactor enabled
TxnLogProposalIterator EMPTY_ITERATOR TxnIterator itr itr snapLog readTxnLog startZxid itr itr startZxid LOG warn Long toHexString startZxid itr close TxnLogProposalIterator EMPTY_ITERATOR sizeLimit txnSize itr getStorageSize txnSize sizeLimit LOG info txnSize sizeLimit itr close TxnLogProposalIterator EMPTY_ITERATOR
enabled ZooKeeperServer closeSessionTxnEnabled enabled
session sessionId session getSessionId
secureServerCnxnFactory registerConnection cnxn e LOG warn e ConnectResponse rsp ConnectResponse valid cnxn getSessionTimeout valid cnxn getSessionId valid generatePasswd cnxn getSessionId ByteArrayOutputStream baos ByteArrayOutputStream BinaryOutputArchive bos BinaryOutputArchive getArchive baos bos writeInt rsp serialize bos cnxn bos writeBool ReadOnlyZooKeeperServer baos close ByteBuffer bb ByteBuffer wrap baos toByteArray bb putInt bb remaining rewind cnxn sendBuffer bb
e LOG warn e ConnectResponse rsp ConnectResponse valid cnxn getSessionTimeout valid cnxn getSessionId valid generatePasswd cnxn getSessionId ByteArrayOutputStream baos ByteArrayOutputStream BinaryOutputArchive bos BinaryOutputArchive getArchive baos bos writeInt rsp serialize bos cnxn bos writeBool ReadOnlyZooKeeperServer baos close ByteBuffer bb ByteBuffer wrap baos toByteArray bb putInt bb remaining rewind cnxn sendBuffer bb valid
e LOG warn e firstProcessor RuntimeException touch si cnxn validpacket Request isValid si type validpacket setLocalSessionFlag si firstProcessor processRequest si si cnxn incInProcess LOG warn si type requestFinished si
firstProcessor RuntimeException touch si cnxn validpacket Request isValid si type validpacket setLocalSessionFlag si firstProcessor processRequest si si cnxn incInProcess LOG warn si type requestFinished si UnimplementedRequestProcessor processRequest si
size Long getLong size
backlog listenBacklog backlog
incomingBuffer BinaryInputArchive bia BinaryInputArchive getArchive ByteBufferInputStream incomingBuffer ConnectRequest connReq ConnectRequest connReq deserialize bia
tokensNeeded connThrottle getRequiredTokensForRenew connThrottle tokensNeeded ClientCnxnLimitException ServerMetrics getMetrics CONNECTION_TOKEN_DEFICIT add connThrottle getDeficit ServerMetrics getMetrics CONNECTION_REQUEST_COUNT add readOnly readOnly bia readBool cnxn isOldClient LOG warn cnxn getRemoteSocketAddress readOnly String msg cnxn getRemoteSocketAddress LOG info msg
LOG warn cnxn getRemoteSocketAddress String msg cnxn getRemoteSocketAddress LOG info msg CloseRequestException msg ServerCnxn DisconnectReason CLIENT_ZXID_AHEAD connReq getLastZxidSeen String msg cnxn getRemoteSocketAddress Long toHexString connReq getLastZxidSeen Long toHexString getZKDatabase getDataTreeLastProcessedZxid LOG info msg CloseRequestException msg ServerCnxn DisconnectReason NOT_READ_ONLY_CLIENT sessionTimeout connReq getTimeOut passwd connReq getPasswd minSessionTimeout getMinSessionTimeout sessionTimeout minSessionTimeout sessionTimeout minSessionTimeout
String msg cnxn getRemoteSocketAddress LOG info msg CloseRequestException msg ServerCnxn DisconnectReason CLIENT_ZXID_AHEAD connReq getLastZxidSeen String msg cnxn getRemoteSocketAddress Long toHexString connReq getLastZxidSeen Long toHexString getZKDatabase getDataTreeLastProcessedZxid LOG info msg CloseRequestException msg ServerCnxn DisconnectReason NOT_READ_ONLY_CLIENT sessionTimeout connReq getTimeOut passwd connReq getPasswd minSessionTimeout getMinSessionTimeout sessionTimeout minSessionTimeout sessionTimeout minSessionTimeout maxSessionTimeout getMaxSessionTimeout sessionTimeout maxSessionTimeout
cnxn incomingBuffer InputStream bais ByteBufferInputStream incomingBuffer BinaryInputArchive bia BinaryInputArchive getArchive bais RequestHeader h RequestHeader h deserialize bia cnxn incrOutstandingAndCheckThrottle h incomingBuffer incomingBuffer slice h
incomingBuffer incomingBuffer slice LOG info cnxn getRemoteSocketAddress AuthPacket authPacket AuthPacket ByteBufferInputStream byteBuffer2Record incomingBuffer authPacket String scheme authPacket getScheme ServerAuthenticationProvider ap ProviderRegistry getServerProvider scheme Code authReturn KeeperException Code AUTHFAILED ap authReturn ap handleAuthentication ServerAuthenticationProvider ServerObjs cnxn authPacket getAuth e LOG warn scheme e authReturn KeeperException Code AUTHFAILED authReturn KeeperException Code
LOG info cnxn getRemoteSocketAddress AuthPacket authPacket AuthPacket ByteBufferInputStream byteBuffer2Record incomingBuffer authPacket String scheme authPacket getScheme ServerAuthenticationProvider ap ProviderRegistry getServerProvider scheme Code authReturn KeeperException Code AUTHFAILED ap authReturn ap handleAuthentication ServerAuthenticationProvider ServerObjs cnxn authPacket getAuth e LOG warn scheme e authReturn KeeperException Code AUTHFAILED authReturn KeeperException Code LOG debug scheme
incomingBuffer LOG debug GetSASLRequest clientTokenRecord GetSASLRequest ByteBufferInputStream byteBuffer2Record incomingBuffer clientTokenRecord clientToken clientTokenRecord getToken
incomingBuffer cnxn LOG debug GetSASLRequest clientTokenRecord GetSASLRequest ByteBufferInputStream byteBuffer2Record incomingBuffer clientTokenRecord clientToken clientTokenRecord getToken LOG debug clientToken length responseToken ZooKeeperSaslServer saslServer cnxn zooKeeperSaslServer responseToken saslServer evaluateResponse clientToken saslServer String authorizationID saslServer getAuthorizationID
String pathToCheck err KeeperException Code OK intValue pathToCheck effectiveACLPath request pathToCheck checkACL request cnxn zkDb getACL pathToCheck effectiveACLPerms request request authInfo pathToCheck KeeperException e LOG debug e err e code intValue KeeperException e LOG debug e err e code intValue KeeperException e
err KeeperException Code OK intValue pathToCheck effectiveACLPath request pathToCheck checkACL request cnxn zkDb getACL pathToCheck effectiveACLPerms request request authInfo pathToCheck KeeperException e LOG debug e err e code intValue KeeperException e LOG debug e err e code intValue KeeperException e LOG debug e getMessage KeeperException e
err e code intValue e LOG debug e err e code intValue e LOG debug e getMessage e LOG debug e getMessage t LOG error t t err intValue decInProcess ReplyHeader rh ReplyHeader request cxid err
ZooKeeperServerMain main ZooKeeperServerMain main initializeAndRun args e LOG error e LOG info USAGE System err println USAGE ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode INVALID_INVOCATION getValue e LOG error e System err println ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode INVALID_INVOCATION getValue e
LOG error e LOG info USAGE System err println USAGE ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode INVALID_INVOCATION getValue e LOG error e System err println ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode INVALID_INVOCATION getValue e LOG error e System err println ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode UNABLE_TO_ACCESS_DATADIR getValue
e LOG error e System err println ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode INVALID_INVOCATION getValue e LOG error e System err println ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode UNABLE_TO_ACCESS_DATADIR getValue e LOG error e System err println ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode ERROR_STARTING_ADMIN_SERVER getValue
mask traceMask mask Logger LOG LoggerFactory getLogger ZooTrace
ac String authenticationID ac getAuthenticationID String authorizationID ac getAuthorizationID
ac String authenticationID ac getAuthenticationID String authorizationID ac getAuthorizationID LOG info authenticationID authorizationID ac setAuthorized KerberosName kerberosName KerberosName authenticationID StringBuilder userNameBuilder StringBuilder kerberosName getShortName kerberosName userNameBuilder append append kerberosName getHostName kerberosName userNameBuilder append append kerberosName getRealm LOG info userNameBuilder ac setAuthorizedID userNameBuilder toString
X509Certificate certChain X509Certificate cnxn getClientCertificateChain certChain certChain KeeperException Code AUTHFAILED trustManager LOG error Long toHexString cnxn getSessionId KeeperException Code AUTHFAILED X509Certificate clientCert certChain trustManager checkClientTrusted certChain clientCert getPublicKey getAlgorithm ce LOG error Long toHexString cnxn getSessionId ce KeeperException Code AUTHFAILED String clientId getClientId clientCert clientId cnxn addAuthInfo Id clientId
trustManager LOG error Long toHexString cnxn getSessionId KeeperException Code AUTHFAILED X509Certificate clientCert certChain trustManager checkClientTrusted certChain clientCert getPublicKey getAlgorithm ce LOG error Long toHexString cnxn getSessionId ce KeeperException Code AUTHFAILED String clientId getClientId clientCert clientId cnxn addAuthInfo Id clientId LOG info clientId Id authInfo Id getScheme clientId cnxn addAuthInfo authInfo
whiteListedCommands contains command String commands System getProperty ZOOKEEPER_4LW_COMMANDS_WHITELIST commands String list commands split String cmd list cmd trim String entry whiteListedCommands add entry getValue cmd trim whiteListedCommands add cmd trim System getProperty whiteListedCommands add whiteListedCommands add whiteListInitialized
String commands System getProperty ZOOKEEPER_4LW_COMMANDS_WHITELIST commands String list commands split String cmd list cmd trim String entry cmd2String whiteListedCommands add entry getValue cmd trim whiteListedCommands add cmd trim System getProperty whiteListedCommands add whiteListedCommands add whiteListInitialized LOG info Arrays asList cmd2String
log flush startSyncNS System nanoTime FileChannel channel log getChannel channel force syncElapsedMS TimeUnit NANOSECONDS toMillis System nanoTime startSyncNS syncElapsedMS serverStats serverStats incrementFsyncThresholdExceedCount LOG warn Thread currentThread getName syncElapsedMS channel size ServerMetrics getMetrics FSYNC_TIME add syncElapsedMS streamsToFlush size streamsToFlush poll close logSize getCurrentLogSize
LOG error highestZxid hdr getZxid hdr getType highestZxid hdr getZxid processTransaction hdr dt sessions itr getTxn dt compareDigest hdr itr getTxn itr getDigest txnLoaded e IOException hdr getType e getMessage e listener onTxnLoaded hdr itr getTxn itr getDigest itr itr itr close
hdr dt Long txn ProcessTxnResult rc hdr hdr getClientId CreateSessionTxn txn getTimeOut LOG ZooTrace logTraceMessage LOG ZooTrace SESSION_TRACE_MASK Long toHexString hdr getClientId CreateSessionTxn txn getTimeOut rc dt processTxn hdr txn hdr getClientId LOG ZooTrace logTraceMessage LOG ZooTrace SESSION_TRACE_MASK Long toHexString hdr getClientId rc dt processTxn hdr txn rc dt processTxn hdr txn rc
dataTree lastZxid dataTree lastProcessedZxid File snapshotFile File snapDir Util makeSnapshotName lastZxid
byteArray byteArray
byteArray SnappyCodec MAGIC_LEN SnappyCodec MAGIC_LEN byteArray SnappyCodec MAGIC_LEN
raf length raf seek raf length bytes readlen l readlen l raf bytes readlen bytes length readlen readlen l readlen bytes length LOG info f getName readlen ByteBuffer bb ByteBuffer wrap bytes len bb getInt b bb get len b
numReadQueuedRequests decrementAndGet sendToNextProcessor request isEmpty committedRequests isEmpty commitIsWaiting ServerMetrics getMetrics READS_ISSUED_IN_COMMIT_PROC add readsProcessed commitIsWaiting commitIsWaiting committedRequests isEmpty commitIsWaiting waitForEmptyPool commitsToProcess maxCommitBatchSize Set Long queuesToDrain HashSet startWriteTime Time currentElapsedTime
commitsToProcess maxCommitBatchSize Set Long queuesToDrain HashSet startWriteTime Time currentElapsedTime commitsProcessed commitsToProcess request committedRequests peek request LOG error request ServiceUtils requestSystemExit ExitCode UNEXPECTED_ERROR getValue peek sessionId request sessionId peek request Deque Request sessionQueue pendingRequests get request sessionId ServerMetrics getMetrics PENDING_SESSION_QUEUE_SIZE add pendingRequests size sessionQueue sessionQueue sessionQueue peek
size maxReadBatchSize size
size size maxCommitBatchSize size
sid self QuorumVerifier qv self getQuorumVerifier ToSend notmsg ToSend ToSend mType notification proposedLeader proposedZxid logicalclock get QuorumPeer ServerState LOOKING sid proposedEpoch qv toString getBytes
Map Long Vote outofelection HashMap Long Vote notTimeout minNotificationInterval logicalclock incrementAndGet updateProposal getInitId getInitLastLoggedZxid getPeerEpoch LOG info self getId Long toHexString proposedZxid sendNotifications SyncedLearnerTracker voteSet self Notification n recvqueue poll notTimeout TimeUnit MILLISECONDS n manager sendNotifications manager connectAll
sendNotifications SyncedLearnerTracker voteSet Notification n recvqueue poll notTimeout TimeUnit MILLISECONDS n manager sendNotifications manager connectAll tmpTimeOut notTimeout notTimeout Math min tmpTimeOut maxNotificationInterval LOG info notTimeout n n n
tmpTimeOut notTimeout notTimeout Math min tmpTimeOut maxNotificationInterval LOG info notTimeout n sid n n LOG debug n LOG debug n sid n electionEpoch logicalclock logicalclock set n electionEpoch recvset clear n n n
getInitLastLoggedZxid LOG debug n zxid LOG debug n sid n electionEpoch logicalclock logicalclock set n electionEpoch recvset clear n leader n zxid n peerEpoch getInitId getInitLastLoggedZxid getPeerEpoch updateProposal n leader n zxid n peerEpoch updateProposal getInitId getInitLastLoggedZxid getPeerEpoch sendNotifications n electionEpoch logicalclock
self end_fle Time currentElapsedTime electionTimeTaken self end_fle self start_fle self setElectionTimeTaken electionTimeTaken ServerMetrics getMetrics ELECTION_TIME add electionTimeTaken
self end_fle fzk registerJMX FollowerBean zk self jmxLocalPeerBean connectionTime completedSync self setZabState QuorumPeer ZabState DISCOVERY QuorumServer leaderServer findLeader connectToLeader leaderServer addr leaderServer hostname connectionTime System currentTimeMillis newEpochZxid registerWithLeader Leader FOLLOWERINFO self Exception newEpoch ZxidUtils getEpochFromZxid newEpochZxid newEpoch self
self end_fle Time currentElapsedTime electionTimeTaken self end_fle self start_fle self setElectionTimeTaken electionTimeTaken ServerMetrics getMetrics ELECTION_TIME add electionTimeTaken
zk loadData leaderStateSummary StateSummary self getCurrentEpoch zk getLastProcessedZxid cnxAcceptor LearnerCnxAcceptor cnxAcceptor start epoch getEpochToPropose self getId self getAcceptedEpoch zk setZxid ZxidUtils makeZxid epoch lastProposed zk getZxid newLeaderProposal packet QuorumPacket NEWLEADER zk getZxid newLeaderProposal packet getZxid LOG info Long toHexString newLeaderProposal packet getZxid QuorumVerifier lastSeenQV self getLastSeenQuorumVerifier QuorumVerifier curQV self getQuorumVerifier curQV curQV lastSeenQV
p zxid lastCommitted LOG warn Long toHexString zxid followerAddr LOG warn lastCommitted outstandingProposals remove zxid p toBeApplied add p p LOG warn p p LOG debug outstandingProposals size Long designatedLeader getDesignatedLeader p zxid QuorumVerifier newQV p qvAcksetPairs get p qvAcksetPairs size getQuorumVerifier self processReconfig newQV designatedLeader zk getZxid
zxid LOG LOG trace Long toHexString zxid p packetZxid p packet getZxid LOG trace Long toHexString packetZxid LOG trace zxid LOG debug zxid
String msg shutdown msg XidRolloverException msg data SerializeUtils serializeRequest request proposalStats setLastBufferSize data length QuorumPacket pp QuorumPacket Leader PROPOSAL request zxid data Proposal p Proposal p packet pp p request request p addQuorumVerifier self getQuorumVerifier request self setLastSeenQuorumVerifier request qv self getQuorumVerifier self getLastSeenQuorumVerifier p addQuorumVerifier self getLastSeenQuorumVerifier
maxTimeToWaitForEpoch Leader maxTimeToWaitForEpoch maxTimeToWaitForEpoch
lastCommitted zk getZxid
trackSession sessionId sessionTimeout tracked globalSessionTracker trackSession sessionId sessionTimeout tracked
commitSession sessionId sessionTimeout added globalSessionTracker commitSession sessionId sessionTimeout added
newMode asyncSending newMode
newLeaderZxid QuorumPacket ack QuorumPacket Leader ACK QuorumPacket qp QuorumPacket newEpoch ZxidUtils getEpochFromZxid newLeaderZxid QuorumVerifier newLeaderQV snapshotNeeded syncSnapshot readPacket qp Deque Long packetsCommitted ArrayDeque Deque PacketInFlight packetsNotCommitted ArrayDeque qp Leader
QuorumPacket qp QuorumPacket newEpoch ZxidUtils getEpochFromZxid newLeaderZxid QuorumVerifier newLeaderQV snapshotNeeded syncSnapshot readPacket qp Deque Long packetsCommitted ArrayDeque Deque PacketInFlight packetsNotCommitted ArrayDeque qp DIFF LOG info Long toHexString qp getZxid self setSyncMode QuorumPeer SyncMode DIFF snapshotNeeded qp SNAP self setSyncMode QuorumPeer SyncMode SNAP
Deque PacketInFlight packetsNotCommitted ArrayDeque zk qp DIFF LOG info Long toHexString qp getZxid self setSyncMode QuorumPeer SyncMode DIFF snapshotNeeded qp SNAP self setSyncMode QuorumPeer SyncMode SNAP LOG info Long toHexString qp getZxid zk getZKDatabase deserializeSnapshot leaderIs self LOG debug zk getZKDatabase initConfigInZKDatabase self getQuorumVerifier String signature leaderIs readString signature
LOG info Long toHexString qp getZxid zk getZKDatabase deserializeSnapshot leaderIs self LOG debug zk getZKDatabase initConfigInZKDatabase self getQuorumVerifier String signature leaderIs readString signature LOG error signature IOException zk getZKDatabase setlastProcessedZxid qp getZxid syncSnapshot qp TRUNC self setSyncMode QuorumPeer SyncMode TRUNC LOG warn Long toHexString qp getZxid truncated zk getZKDatabase truncateLog qp getZxid
zk getZKDatabase initConfigInZKDatabase self getQuorumVerifier String signature leaderIs readString signature LOG error signature IOException zk getZKDatabase setlastProcessedZxid qp getZxid syncSnapshot qp TRUNC self setSyncMode QuorumPeer SyncMode TRUNC LOG warn Long toHexString qp getZxid truncated zk getZKDatabase truncateLog qp getZxid truncated LOG error Long toHexString qp getZxid ServiceUtils requestSystemExit ExitCode QUORUM_PACKET_ERROR getValue zk getZKDatabase setlastProcessedZxid qp getZxid
learnerMaster addLearnerHandler tickOfNextAckDeadline learnerMaster getTickOfInitialAckDeadline ia BinaryInputArchive getArchive bufferedInput bufferedOutput BufferedOutputStream sock getOutputStream oa BinaryOutputArchive getArchive bufferedOutput QuorumPacket qp QuorumPacket ia readRecord qp messageTracker trackReceived qp getType qp getType qp getType
IOException qp getType learnerInfoData qp getData learnerInfoData ByteBuffer bbsid ByteBuffer wrap learnerInfoData learnerInfoData sid bbsid getLong learnerInfoData version bbsid getInt learnerInfoData configVersion bbsid getLong configVersion learnerMaster IOException sid learnerMaster getAndDecrementFollowerCounter String followerInfo learnerMaster getPeerInfo sid
learnerInfoData qp getData learnerInfoData ByteBuffer bbsid ByteBuffer wrap learnerInfoData learnerInfoData sid bbsid getLong learnerInfoData version bbsid getInt learnerInfoData configVersion bbsid getLong configVersion learnerMaster IOException sid learnerMaster getAndDecrementFollowerCounter String followerInfo learnerMaster getPeerInfo sid followerInfo
messageTracker trackSent Leader SNAP bufferedOutput flush LOG info Long toHexString peerLastZxid Long toHexString leaderLastZxid Long toHexString zxidToSend syncThrottler getSyncInProgress exemptFromThrottle learnerMaster getZKDatabase serializeSnapshot oa oa writeString bufferedOutput flush ServerMetrics getMetrics SNAP_COUNT add syncThrottler learnerMaster getLearnerDiffSyncThrottler syncThrottler beginSync exemptFromThrottle ServerMetrics getMetrics INFLIGHT_DIFF_COUNT add syncThrottler getSyncInProgress ServerMetrics getMetrics DIFF_COUNT add LOG debug sid
syncThrottler learnerMaster getLearnerDiffSyncThrottler syncThrottler beginSync exemptFromThrottle ServerMetrics getMetrics INFLIGHT_DIFF_COUNT add syncThrottler getSyncInProgress ServerMetrics getMetrics DIFF_COUNT add LOG debug sid QuorumPacket newLeaderQP QuorumPacket Leader NEWLEADER newLeaderZxid oa writeRecord newLeaderQP QuorumPacket newLeaderQP QuorumPacket Leader NEWLEADER newLeaderZxid learnerMaster getQuorumVerifierBytes queuedPackets add newLeaderQP bufferedOutput flush startSendingPackets qp QuorumPacket
peerLastZxid learnerMaster isPeerNewEpochZxid peerLastZxid currentZxid peerLastZxid needSnap ZKDatabase db learnerMaster getZKDatabase txnLogSyncEnabled db isTxnLogSyncEnabled ReentrantReadWriteLock lock db getLogLock ReadLock rl lock readLock rl lock maxCommittedLog db getmaxCommittedLog minCommittedLog db getminCommittedLog lastProcessedZxid db getDataTreeLastProcessedZxid
txnLogSyncEnabled db isTxnLogSyncEnabled ReentrantReadWriteLock lock db getLogLock ReadLock rl lock readLock rl lock maxCommittedLog db getmaxCommittedLog minCommittedLog db getminCommittedLog lastProcessedZxid db getDataTreeLastProcessedZxid LOG info getSid Long toHexString maxCommittedLog Long toHexString minCommittedLog Long toHexString lastProcessedZxid Long toHexString peerLastZxid db minCommittedLog lastProcessedZxid maxCommittedLog lastProcessedZxid LOG warn lastProcessedZxid peerLastZxid
maxCommittedLog db getmaxCommittedLog minCommittedLog db getminCommittedLog lastProcessedZxid db getDataTreeLastProcessedZxid LOG info getSid Long toHexString maxCommittedLog Long toHexString minCommittedLog Long toHexString lastProcessedZxid Long toHexString peerLastZxid db minCommittedLog lastProcessedZxid maxCommittedLog lastProcessedZxid LOG warn lastProcessedZxid peerLastZxid LOG info Long toHexString peerLastZxid getSid queueOpPacket Leader DIFF peerLastZxid needOpPacket needSnap peerLastZxid maxCommittedLog
peerLastZxid maxCommittedLog LOG debug Long toHexString maxCommittedLog getSid queueOpPacket Leader TRUNC maxCommittedLog currentZxid maxCommittedLog needOpPacket needSnap maxCommittedLog peerLastZxid peerLastZxid LOG info getSid Iterator Proposal itr db getCommittedLog iterator currentZxid queueCommittedProposals itr peerLastZxid maxCommittedLog needSnap peerLastZxid sizeLimit db calculateTxnLogSizeLimit Iterator Proposal txnLogItr db getProposalsFromTxnLog peerLastZxid sizeLimit txnLogItr
needSnap maxCommittedLog peerLastZxid minCommittedLog peerLastZxid LOG info getSid Iterator Proposal itr db getCommittedLog iterator currentZxid queueCommittedProposals itr peerLastZxid maxCommittedLog needSnap peerLastZxid minCommittedLog sizeLimit db calculateTxnLogSizeLimit Iterator Proposal txnLogItr db getProposalsFromTxnLog peerLastZxid sizeLimit txnLogItr LOG info getSid currentZxid queueCommittedProposals txnLogItr peerLastZxid minCommittedLog maxCommittedLog currentZxid minCommittedLog LOG info Long toHexString currentZxid Long toHexString minCommittedLog currentZxid peerLastZxid
LOG info getSid currentZxid queueCommittedProposals txnLogItr peerLastZxid minCommittedLog maxCommittedLog currentZxid minCommittedLog LOG info Long toHexString currentZxid Long toHexString minCommittedLog currentZxid peerLastZxid queuedPackets clear needOpPacket LOG debug Long toHexString currentZxid Iterator Proposal committedLogItr db getCommittedLog iterator currentZxid queueCommittedProposals committedLogItr currentZxid maxCommittedLog needSnap txnLogItr TxnLogProposalIterator TxnLogProposalIterator txnProposalItr TxnLogProposalIterator txnLogItr txnProposalItr close
itr Proposal propose itr next packetZxid propose packet getZxid packetZxid packetZxid prevProposalZxid packetZxid needOpPacket packetZxid LOG info Long toHexString lastCommittedZxid getSid queueOpPacket Leader DIFF lastCommittedZxid needOpPacket
LOG info Long toHexString lastCommittedZxid getSid queueOpPacket Leader DIFF lastCommittedZxid needOpPacket packetZxid packetZxid LOG warn getSid queuedZxid LOG info Long toHexString prevProposalZxid getSid queueOpPacket Leader TRUNC prevProposalZxid needOpPacket packetZxid queuedZxid queuePacket propose packet queueOpPacket Leader COMMIT packetZxid
sessionId sessionTimeout added globalSessionsWithTimeouts put sessionId sessionTimeout added
syncWithLeader newLeaderZxid self setZabState QuorumPeer ZabState BROADCAST completedSync QuorumPacket qp QuorumPacket readPacket qp processPacket qp e LOG warn e closeSocket pendingRevalidations clear currentLearnerMaster zk unregisterJMX
delayValueMs delayValueMs randomDelay delayValueMs Math random
electionDelayMs observerElectionDelayMs electionDelayMs
Iterator QuorumPacket itr committedPkts iterator itr QuorumPacket packet itr next packet
QuorumPacket QuorumPacket pkt proposedPkts peek pkt pkt
ServerSocket ss ss ss Socket s ss accept s setSoTimeout self tickTime self initLimit BufferedInputStream is BufferedInputStream s getInputStream LearnerHandler lh LearnerHandler s is lh start e LOG debug e
Socket sock
sock connect electionAddr getReachableOrOne cnxTO sock SSLSocket SSLSocket sslSock SSLSocket sock sslSock startHandshake LOG info sslSock getRemoteSocketAddress sslSock getSession getProtocol sslSock getSession getCipherSuite LOG debug sid sock getInetAddress sock getPort e LOG warn sid electionAddr e closeSocket sock e LOG warn sid electionAddr e closeSocket sock
DataOutputStream dout DataInputStream din
Collection InetSocketAddress addressesToSend protocolVersion PROTOCOL_VERSION_V2 self getElectionAddress getAllAddresses Arrays asList self getElectionAddress getOne String addr addressesToSend stream map NetUtils formatInetAddr collect Collectors joining addr_bytes addr getBytes dout writeInt addr_bytes length dout write addr_bytes dout flush din DataInputStream BufferedInputStream sock getInputStream e LOG warn e closeSocket sock QuorumPeer QuorumServer qps self getVotingView get sid qps authLearner authenticate sock qps hostname sid self
dout writeInt addr_bytes length dout write addr_bytes dout flush din DataInputStream BufferedInputStream sock getInputStream e LOG warn e closeSocket sock QuorumPeer QuorumServer qps self getVotingView get sid qps authLearner authenticate sock qps hostname sid self getId LOG info self getId sid closeSocket sock
sock DataInputStream din din DataInputStream BufferedInputStream sock getInputStream
din Long sid protocolVersion MultipleAddresses electionAddr protocolVersion din readLong protocolVersion sid protocolVersion InitialMessage init InitialMessage parse protocolVersion din sid init sid init electionAddr electionAddr MultipleAddresses init electionAddr Duration ofMillis self getMultiAddressReachabilityCheckTimeoutMs LOG debug self getId init toString InitialMessage
protocolVersion sid protocolVersion InitialMessage init InitialMessage parse protocolVersion din sid init sid init electionAddr electionAddr MultipleAddresses init electionAddr Duration ofMillis self getMultiAddressReachabilityCheckTimeoutMs LOG debug self getId init toString InitialMessage ex LOG error ex closeSocket sock sid sid observerCounter getAndDecrement
ex LOG error ex closeSocket sock sid sid observerCounter getAndDecrement LOG info sid e LOG warn e closeSocket sock authServer authenticate sock din sid SendWorker sw senderWorkerMap get sid sw
senderWorkerMap get sid asyncValidateIfSocketIsStillReachable self knownId self recreateSocketAddresses sid Map Long QuorumPeer QuorumServer lastCommittedView self getView QuorumVerifier lastSeenQV self getLastSeenQuorumVerifier Map Long QuorumPeer QuorumServer lastProposedView lastSeenQV getAllMembers lastCommittedView sid knownId LOG debug self getId sid sid lastCommittedView get sid lastSeenQV lastProposedView sid knownId lastProposedView get sid lastCommittedView get sid knownId
queue queueSize queue size
multiAddressEnabled multiAddressEnabled multiAddressEnabled
multiAddressReachabilityCheckTimeoutMs multiAddressReachabilityCheckTimeoutMs multiAddressReachabilityCheckTimeoutMs
multiAddressReachabilityCheckEnabled multiAddressReachabilityCheckEnabled multiAddressReachabilityCheckEnabled
zkDb loadDataBase lastProcessedZxid zkDb getDataTree lastProcessedZxid epochOfZxid ZxidUtils getEpochFromZxid lastProcessedZxid currentEpoch readLongFromFile CURRENT_EPOCH_FILENAME currentEpoch epochOfZxid LOG info CURRENT_EPOCH_FILENAME currentEpoch writeLongToFile CURRENT_EPOCH_FILENAME currentEpoch epochOfZxid currentEpoch IOException ZxidUtils zxidToString currentEpoch lastProcessedZxid acceptedEpoch readLongFromFile ACCEPTED_EPOCH_FILENAME acceptedEpoch epochOfZxid
currentEpoch epochOfZxid LOG info CURRENT_EPOCH_FILENAME currentEpoch writeLongToFile CURRENT_EPOCH_FILENAME currentEpoch epochOfZxid currentEpoch IOException ZxidUtils zxidToString currentEpoch lastProcessedZxid acceptedEpoch readLongFromFile ACCEPTED_EPOCH_FILENAME acceptedEpoch epochOfZxid LOG info ACCEPTED_EPOCH_FILENAME acceptedEpoch writeLongToFile ACCEPTED_EPOCH_FILENAME acceptedEpoch acceptedEpoch currentEpoch IOException ZxidUtils zxidToString acceptedEpoch ZxidUtils zxidToString currentEpoch IOException
e LOG warn e jmxQuorumBean LOG info ServerMetrics getMetrics LOOKING_COUNT add LOG info ReadOnlyZooKeeperServer roZk ReadOnlyZooKeeperServer logFactory zkDb sleep Math max tickTime
quorumVerifier quorumVerifier getVersion qv getVersion LOG debug getId qv getVersion quorumVerifier getVersion quorumVerifier QuorumVerifier prevQV quorumVerifier quorumVerifier qv lastSeenQuorumVerifier qv getVersion lastSeenQuorumVerifier getVersion lastSeenQuorumVerifier qv configFilename String dynamicConfigFilename makeDynamicConfigFilename qv getVersion QuorumPeerConfig writeDynamicConfig dynamicConfigFilename qv QuorumPeerConfig editStaticConfig configFilename dynamicConfigFilename needEraseClientInfoFromStaticConfig
Long sid sid Long parseLong desiredMaster sid server sid address server String serverAddr address getAddress getHostAddress address getPort serverAddr desiredMaster server sid server server sid
serverSaslRequired quorumServerSaslAuthRequired serverSaslRequired
learnerSaslRequired quorumLearnerSaslAuthRequired learnerSaslRequired
servicePrincipal quorumServicePrincipal servicePrincipal
learnerContext quorumLearnerLoginContext learnerContext
serverContext quorumServerLoginContext serverContext
timeout quorumCnxnTimeoutMs quorumCnxnTimeoutMs tickTime syncLimit
key metricsProviderClassName value key String keyForMetricsProvider key substring metricsProviderConfiguration put keyForMetricsProvider value key multiAddressEnabled parseBoolean key value key multiAddressReachabilityCheckTimeoutMs Integer parseInt value key multiAddressReachabilityCheckEnabled parseBoolean key value System setProperty key value IllegalArgumentException QuorumAuth QUORUM_SASL_AUTH_ENABLED QuorumAuth QUORUM_SERVER_SASL_AUTH_REQUIRED
QuorumPeerMain main QuorumPeerMain main initializeAndRun args e LOG error e LOG info USAGE System err println USAGE ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode INVALID_INVOCATION getValue e LOG error e System err println ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode INVALID_INVOCATION getValue e
LOG error e LOG info USAGE System err println USAGE ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode INVALID_INVOCATION getValue e LOG error e System err println ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode INVALID_INVOCATION getValue e LOG error e System err println ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode UNABLE_TO_ACCESS_DATADIR getValue
e LOG error e System err println ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode INVALID_INVOCATION getValue e LOG error e System err println ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode UNABLE_TO_ACCESS_DATADIR getValue e LOG error e System err println ZKAuditProvider addServerStartFailureAuditLog ServiceUtils requestSystemExit ExitCode ERROR_STARTING_ADMIN_SERVER getValue
sessionId Request request makeUpgradeRequest sessionId request
Request request queuedRequests take traceMask ZooTrace CLIENT_REQUEST_TRACE_MASK request traceMask ZooTrace CLIENT_PING_TRACE_MASK LOG ZooTrace logRequest LOG traceMask request Request request request hdr request request cnxn sendResponse hdr
token receive din tries dout DataOutputStream sock getOutputStream challenge ss SecurityUtils createSaslServer serverLogin getSubject QuorumAuth QUORUM_SERVER_PROTOCOL_NAME QuorumAuth QUORUM_SERVER_SASL_DIGEST serverLogin callbackHandler LOG ss challenge ss evaluateResponse token ss tries send dout challenge QuorumAuth Status ERROR LOG warn sock getRemoteSocketAddress tries send dout challenge QuorumAuth Status IN_PROGRESS token receive din ss
challenge ss evaluateResponse token ss tries send dout challenge QuorumAuth Status ERROR LOG warn sock getRemoteSocketAddress tries send dout challenge QuorumAuth Status IN_PROGRESS token receive din ss send dout challenge QuorumAuth Status SUCCESS LOG info sock getRemoteSocketAddress dout send dout QuorumAuth Status ERROR
send dout challenge QuorumAuth Status SUCCESS LOG info sock getRemoteSocketAddress e dout send dout QuorumAuth Status ERROR ioe LOG warn ioe quorumRequireSasl LOG error e SaslException e getMessage LOG warn e LOG warn sock getRemoteSocketAddress QuorumAuth QUORUM_SERVER_SASL_AUTH_REQUIRED quorumRequireSasl
filename File configFile File filename
Long HashMap Long Long expansion HashMap Long Long
LOG debug set size set size sid set Long gid serverGroup get sid gid expansion gid expansion put gid serverWeight get sid totalWeight serverWeight get sid expansion get gid expansion put gid totalWeight majGroupCounter Long Long entry expansion Long gid entry getKey
sid Long gid serverGroup get sid gid expansion gid expansion put gid serverWeight get sid totalWeight serverWeight get sid expansion get gid expansion put gid totalWeight majGroupCounter Long Long entry expansion Long gid entry getKey LOG debug entry getValue gid groupWeight get gid entry getValue groupWeight get gid majGroupCounter
expansion gid expansion put gid serverWeight get sid totalWeight serverWeight get sid expansion get gid expansion put gid totalWeight majGroupCounter Long Long entry expansion Long gid entry getKey LOG debug entry getValue gid groupWeight get gid entry getValue groupWeight get gid majGroupCounter LOG debug majGroupCounter numGroups majGroupCounter numGroups LOG debug set size
String Direction direction String sentOrReceivedText direction Direction SENT
cleanEvent deadWatchers size maxWaitMs watcherCleanIntervalInSeconds r nextInt watcherCleanIntervalInSeconds cleanEvent wait maxWaitMs LOG info deadWatchers Set Integer snapshot HashSet Integer deadWatchers deadWatchers clear total snapshot size
LOG info deadWatchers Set Integer snapshot HashSet Integer deadWatchers deadWatchers clear total snapshot size LOG info total startTime Time currentElapsedTime listener processDeadWatchers snapshot latency Time currentElapsedTime startTime
E e Objects requireNonNull e ReentrantLock lock lock lock lock queue E discard queue remove droppedCount
SaslClient SaslClient saslClient
String mechs String username String subject getPublicCredentials toArray String password String subject getPrivateCredentials toArray saslClient Sasl createSaslClient mechs username protocol serverName SaslClientCallbackHandler password entity saslClient Object principals subject getPrincipals toArray Principal clientPrincipal Principal principals usingNativeJgss Boolean getBoolean usingNativeJgss GSSManager manager GSSManager getInstance Oid krb5Mechanism Oid GSSCredential cred manager createCredential GSSContext DEFAULT_LIFETIME krb5Mechanism GSSCredential INITIATE_ONLY subject getPrivateCredentials add cred
subject getPrivateCredentials add cred LOG debug entity clientPrincipal ex LOG warn ex KerberosName clientKerberosName KerberosName clientPrincipal getName String serverRealm System getProperty clientKerberosName getRealm String modifiedServerPrincipal servicePrincipal modifiedServerPrincipal modifiedServerPrincipal modifiedServerPrincipal serverRealm KerberosName serviceKerberosName KerberosName modifiedServerPrincipal String serviceName serviceKerberosName getServiceName String serviceHostname serviceKerberosName getHostName String clientPrincipalName clientKerberosName toString subject
ex LOG warn ex KerberosName clientKerberosName KerberosName clientPrincipal getName String serverRealm System getProperty clientKerberosName getRealm String modifiedServerPrincipal servicePrincipal modifiedServerPrincipal modifiedServerPrincipal modifiedServerPrincipal serverRealm KerberosName serviceKerberosName KerberosName modifiedServerPrincipal String serviceName serviceKerberosName getServiceName String serviceHostname serviceKerberosName getHostName String clientPrincipalName clientKerberosName toString LOG info entity
subject String String subject subject getPrincipals Object principals subject getPrincipals toArray Principal servicePrincipal Principal principals String servicePrincipalNameAndHostname servicePrincipal getName indexOf servicePrincipalNameAndHostname indexOf String servicePrincipalName servicePrincipalNameAndHostname substring indexOf String serviceHostnameAndKerbDomain servicePrincipalNameAndHostname substring indexOf indexOf serviceHostnameAndKerbDomain indexOf String serviceHostname serviceHostnameAndKerbDomain substring indexOf String mech
subject String String LOG subject subject getPrincipals Object principals subject getPrincipals toArray Principal servicePrincipal Principal principals String servicePrincipalNameAndHostname servicePrincipal getName indexOf servicePrincipalNameAndHostname indexOf String servicePrincipalName servicePrincipalNameAndHostname substring indexOf String serviceHostnameAndKerbDomain servicePrincipalNameAndHostname substring indexOf indexOf serviceHostnameAndKerbDomain indexOf String serviceHostname serviceHostnameAndKerbDomain substring indexOf String mech LOG debug serviceHostname
subject String String LOG subject subject getPrincipals Object principals subject getPrincipals toArray Principal servicePrincipal Principal principals String servicePrincipalNameAndHostname servicePrincipal getName indexOf servicePrincipalNameAndHostname indexOf String servicePrincipalName servicePrincipalNameAndHostname substring indexOf String serviceHostnameAndKerbDomain servicePrincipalNameAndHostname substring indexOf indexOf serviceHostnameAndKerbDomain indexOf String serviceHostname serviceHostnameAndKerbDomain substring indexOf String mech LOG debug serviceHostname LOG debug servicePrincipalName
String serviceHostnameAndKerbDomain servicePrincipalNameAndHostname substring indexOf indexOf serviceHostnameAndKerbDomain indexOf String serviceHostname serviceHostnameAndKerbDomain substring indexOf String mech LOG debug serviceHostname LOG debug servicePrincipalName LOG debug mech usingNativeJgss Boolean getBoolean usingNativeJgss GSSManager manager GSSManager getInstance Oid krb5Mechanism Oid GSSName gssName manager createName servicePrincipalName serviceHostname GSSName NT_HOSTBASED_SERVICE GSSCredential cred manager createCredential gssName GSSContext DEFAULT_LIFETIME krb5Mechanism GSSCredential ACCEPT_ONLY subject getPrivateCredentials add cred
Oid krb5Mechanism Oid GSSName gssName manager createName servicePrincipalName serviceHostname GSSName NT_HOSTBASED_SERVICE GSSCredential cred manager createCredential gssName GSSContext DEFAULT_LIFETIME krb5Mechanism GSSCredential ACCEPT_ONLY subject getPrivateCredentials add cred LOG debug servicePrincipalName cred getName ex LOG warn ex subject SaslServer SaslServer SaslServer saslServer saslServer Sasl createSaslServer mech servicePrincipalName serviceHostname callbackHandler saslServer
LOG debug servicePrincipalName cred getName ex LOG warn ex SaslServer SaslServer SaslServer saslServer saslServer Sasl createSaslServer mech servicePrincipalName serviceHostname callbackHandler saslServer e LOG error e e
ex LOG warn ex SaslServer SaslServer SaslServer saslServer saslServer Sasl createSaslServer mech servicePrincipalName serviceHostname callbackHandler saslServer e LOG error e e LOG error e
SaslServer SaslServer saslServer saslServer Sasl createSaslServer mech servicePrincipalName serviceHostname callbackHandler saslServer e LOG error e e LOG error e e LOG error e
portRange Integer threadId Integer getInteger portRange setupPortRange System getProperty threadId threadId System getProperty nextPort portRange getMinimum candidatePort nextPort candidatePort candidatePort portRange candidatePort portRange getMinimum candidatePort nextPort IllegalStateException String format portRange ServerSocket s ServerSocket candidatePort s close nextPort candidatePort
nextPort portRange getMinimum candidatePort nextPort candidatePort candidatePort portRange candidatePort portRange getMinimum candidatePort nextPort IllegalStateException String format portRange ServerSocket s ServerSocket candidatePort s close nextPort candidatePort LOG info nextPort portRange nextPort
LOG warn strProcessCount e Integer threadId processCount cmdLine cmdLine Matcher m Pattern compile matcher cmdLine m threadId Integer valueOf m group e LOG warn cmdLine e PortRange newPortRange processCount processCount threadId portRangeSize GLOBAL_MAX_PORT GLOBAL_BASE_PORT processCount minPort GLOBAL_BASE_PORT threadId portRangeSize maxPort minPort portRangeSize
Integer threadId processCount cmdLine cmdLine Matcher m Pattern compile matcher cmdLine m threadId Integer valueOf m group e LOG warn cmdLine e PortRange newPortRange processCount processCount threadId portRangeSize GLOBAL_MAX_PORT GLOBAL_BASE_PORT processCount minPort GLOBAL_BASE_PORT threadId portRangeSize maxPort minPort portRangeSize newPortRange PortRange minPort maxPort
List EventType expectedEvents ArrayList expectedEvents add EventType ChildWatchRemoved expectedEvents add EventType DataWatchRemoved MyWatcher myWatcher MyWatcher expectedEvents zk create getBytes Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk create getBytes Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT LOG info zk getChildren myWatcher zk getChildren myWatcher LOG info zk getData myWatcher zk getData myWatcher String cmdstring
LOG info List EventType expectedEvents ArrayList expectedEvents add EventType DataWatchRemoved MyWatcher myWatcher MyWatcher expectedEvents zk create getBytes Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk getData myWatcher String cmdstring
List EventType expectedEvents ArrayList expectedEvents add EventType DataWatchRemoved MyWatcher myWatcher1 MyWatcher expectedEvents MyWatcher myWatcher2 MyWatcher expectedEvents LOG info zk exists myWatcher1 zk exists myWatcher2 String cmdstring1
List EventType expectedEvents ArrayList expectedEvents add EventType DataWatchRemoved MyWatcher myWatcher1 MyWatcher expectedEvents MyWatcher myWatcher2 MyWatcher expectedEvents LOG info zk exists myWatcher1 zk exists myWatcher2 String cmdstring1 LOG info cmdstring1 zkMain cl parseCommand cmdstring1 assertTrue zkMain processZKCmd zkMain cl myWatcher1 matches assertEquals zk getExistWatches size zk getExistWatches assertTrue zk getExistWatches contains zk getExistWatches String cmdstring2
List EventType expectedEvents ArrayList expectedEvents add EventType ChildWatchRemoved MyWatcher myWatcher MyWatcher expectedEvents zk create getBytes Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT LOG info zk getChildren myWatcher String cmdstring
LOG info List EventType expectedEvents ArrayList expectedEvents add EventType ChildWatchRemoved expectedEvents add EventType NodeDeleted MyWatcher myWatcher MyWatcher expectedEvents zk create getBytes Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk create getBytes Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk getChildren myWatcher zk getChildren myWatcher String cmdstring
zk1 create Ids OPEN_ACL_UNSAFE CreateMode EPHEMERAL zk1 create Ids OPEN_ACL_UNSAFE CreateMode EPHEMERAL MyWatcher w1 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode EPHEMERAL zk1 create Ids OPEN_ACL_UNSAFE CreateMode EPHEMERAL MyWatcher w1 MyWatcher LOG info w1 assertNotNull zk2 exists w1 MyWatcher w2 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode EPHEMERAL MyWatcher w1 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode EPHEMERAL MyWatcher w1 MyWatcher LOG info w1 assertNotNull zk2 exists w1 MyWatcher w2 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher LOG info w1 zk2 getChildren w1 MyWatcher w2 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1 LOG info w2 assertNotNull zk2 exists w2
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1 LOG info w2 assertNotNull zk2 exists w2 LOG info w1 zk2 getChildren w1
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1 LOG info w2 assertNotNull zk2 exists w2
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1 LOG info w2 assertNotNull zk2 exists w2 LOG info w1 zk2 getChildren w1
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1 LOG info w2 assertNotNull zk2 exists w2
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1 LOG info w2 assertNotNull zk2 exists w2 LOG info w1 zk2 getChildren w1
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1 LOG info w2 assertNull zk2 exists w2
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1 LOG info w2 assertNull zk2 exists w2 LOG info w1 zk2 getChildren w1
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1 LOG info w2 assertNotNull zk2 exists w2
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1 LOG info w1 zk2 getChildren w2
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1 LOG info w1 zk2 getChildren w1
count List MyWatcher wList ArrayList MyWatcher count MyWatcher w String path i i count i String nodePath path i w MyWatcher nodePath wList add w
count List MyWatcher wList ArrayList MyWatcher count MyWatcher w String path i i count i String nodePath path i w MyWatcher path i wList add w zk1 create nodePath Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT
i i count i String nodePath path i zk1 create nodePath Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT nodePath i i count i String nodePath path i w MyWatcher path i wList add w LOG info w nodePath zk1 getChildren nodePath w nodePath assertEquals count zk1 getChildWatches size i i count i String nodePath path i w wList get i
String chRoot zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk1 zk1 close zk2 zk2 close zk1 createClient hostPort chRoot zk2 createClient hostPort chRoot LOG info zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1
zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk1 zk1 close zk2 zk2 close zk1 createClient hostPort chRoot zk2 createClient hostPort chRoot LOG info zk1 create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT MyWatcher w1 MyWatcher MyWatcher w2 MyWatcher LOG info w1 assertNotNull zk2 exists w1 LOG info w1 zk2 getChildren w2
LOG info w1 assertNotNull zk2 exists w1
LOG info w1 assertEquals zk2 getChildren w1 size
LOG info w1 assertEquals zk2 getChildren w1 size
w2 LOG info w1 assertEquals zk2 getChildren w1 size LOG info w2 assertEquals zk2 getChildren w2 size
w2 LOG info w1 assertEquals zk2 getChildren w1 size LOG info w2 assertEquals zk2 getChildren w2 size LOG info w1 assertNotNull zk2 exists w1
System setProperty System setProperty
String String operation String znode result String acl String createMode String session String user String ip AuditEvent logEvent ZKAuditProvider createLogEvent user operation znode acl createMode session ip result String auditLog logEvent toString
e String msg cxnString logErrorAndExit e msg String parentPath args Stat exists zkClient exists parentPath exists System err println parentPath System exit e1 String msg logErrorAndExit e1 msg recordCount recordCount Integer parseInt args
System exit e1 String msg logErrorAndExit e1 msg recordCount recordCount Integer parseInt args e String msg args LOG error msg e System err println msg System exit ZKAuditLoggerPerformance auditLoggingPerf ZKAuditLoggerPerformance zkClient parentPath recordCount AuditLogPerfReading doOperations
FileChangeWatcher watcher List WatchEvent events ArrayList watcher FileChangeWatcher
FileChangeWatcher watcher List WatchEvent events ArrayList watcher FileChangeWatcher event LOG info event kind event context event kind events events add event events notifyAll watcher start watcher waitForState FileChangeWatcher State RUNNING Thread sleep
FileChangeWatcher watcher List WatchEvent events ArrayList watcher FileChangeWatcher
FileChangeWatcher watcher List WatchEvent events ArrayList watcher FileChangeWatcher
FileChangeWatcher watcher List WatchEvent events ArrayList watcher FileChangeWatcher
FileChangeWatcher watcher AtomicInteger callCount AtomicInteger watcher FileChangeWatcher
maxTokens BlueThrottle throttler BlueThrottleWithMockRandom MockRandom throttler setMaxTokens maxTokens throttler setFillCount maxTokens throttler setFillTime throttler setFreezeTime throttler setDropIncrease maxTokens throttler checkLimit assertEquals throttler getMaxTokens throttler getDeficit Thread sleep throttler checkLimit assertTrue throttler getDropChance LOG info throttler getDropChance Thread sleep
throttler checkLimit assertTrue throttler getDropChance LOG info throttler getDropChance Thread sleep LOG info maxTokens accepted maxTokens throttler checkLimit accepted LOG info maxTokens accepted assertTrue accepted maxTokens accepted maxTokens throttler checkLimit accepted
assertTrue ClientBase waitForServerUp HOSTPORT CONNECTION_TIMEOUT ZooKeeper zk ClientBase createZKClient HOSTPORT i i i zk create i i getBytes Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk close f shutdown zks shutdown assertTrue ClientBase waitForServerDown HOSTPORT ClientBase CONNECTION_TIMEOUT File versionDir File tmpDir File list versionDir listFiles File snapFile File logFile File list
ServerMetrics getMetrics resetAll QuorumUtil util QuorumUtil util enableLocalSession util startAll follower1 util getFollowerQuorumPeers get getId follower2 util getFollowerQuorumPeers get getId
count session zxid DataTree dataTree DataTree
count session zxid DataTree dataTree DataTree LOG info count createEphemeralNode session dataTree count AtomicBoolean exceptionDuringDumpEphemerals AtomicBoolean AtomicBoolean running AtomicBoolean PrintWriter pwriter PrintWriter StringWriter running dataTree dumpEphemerals pwriter
LOG info count createEphemeralNode session dataTree count AtomicBoolean exceptionDuringDumpEphemerals AtomicBoolean AtomicBoolean running AtomicBoolean thread PrintWriter pwriter PrintWriter StringWriter running dataTree dumpEphemerals pwriter e LOG error e exceptionDuringDumpEphemerals set thread start
SerializationPerfTest createNodes tree depth width tree getNode stat getCversion len count tree getNodeCount ByteArrayOutputStream baos ByteArrayOutputStream BinaryOutputArchive oa BinaryOutputArchive getArchive baos tree serialize oa baos flush ByteArrayInputStream bais ByteArrayInputStream baos toByteArray ia BinaryInputArchive getArchive bais DataTree dserTree DataTree System gc start System nanoTime dserTree deserialize ia end System nanoTime durationms end start pernodeus end start count
assertEquals tlsHandshakeExceeded get NettyServerCnxnFactory factory NettyServerCnxnFactory serverFactory factory setSecure factory setOutstandingHandshakeLimit threadNum cnxnPerThread cnxnLimit threadNum cnxnPerThread AtomicInteger cnxnCreated AtomicInteger CountDownLatch latch CountDownLatch Thread cnxnWorker Thread threadNum i i cnxnWorker i cnxnWorker i ClientConnectionGenerator i cnxnPerThread cnxnCreated cnxnLimit latch zooKeeperClients cnxnWorker i start allConnectionsCreatedInTime latch await TimeUnit SECONDS actualConnections cnxnCreated get
threadNum cnxnPerThread cnxnLimit threadNum cnxnPerThread AtomicInteger cnxnCreated AtomicInteger CountDownLatch latch CountDownLatch Thread cnxnWorker Thread threadNum i i cnxnWorker i cnxnWorker i ClientConnectionGenerator i cnxnPerThread cnxnCreated cnxnLimit latch zooKeeperClients cnxnWorker i start allConnectionsCreatedInTime latch await TimeUnit SECONDS actualConnections cnxnCreated get LOG info actualConnections allConnectionsCreatedInTime fail String format actualConnections cnxnLimit handshakeThrottledNum tlsHandshakeExceeded get
AtomicInteger cnxnCreated AtomicInteger CountDownLatch latch CountDownLatch Thread cnxnWorker Thread threadNum i i cnxnWorker i cnxnWorker i ClientConnectionGenerator i cnxnPerThread cnxnCreated cnxnLimit latch zooKeeperClients cnxnWorker i start allConnectionsCreatedInTime latch await TimeUnit SECONDS actualConnections cnxnCreated get LOG info actualConnections allConnectionsCreatedInTime fail String format actualConnections cnxnLimit handshakeThrottledNum tlsHandshakeExceeded get LOG info handshakeThrottledNum assertThat handshakeThrottledNum Matchers greaterThan outstandingHandshakeNum factory getOutstandingHandshakeNum
cnxn cnxn disableRecv Thread sleep cnxn enableRecv Thread sleep enableDisableThread start LOG info totalRequestsNum AtomicInteger successResponse AtomicInteger CountDownLatch responseReceivedLatch CountDownLatch totalRequestsNum Thread Thread
cnxn disableRecv Thread sleep cnxn enableRecv Thread sleep enableDisableThread start LOG info totalRequestsNum AtomicInteger successResponse AtomicInteger CountDownLatch responseReceivedLatch CountDownLatch totalRequestsNum Thread Thread requestIssued requestIssued totalRequestsNum
SyncRequestProcessor setSnapCount PORT Integer parseInt HOSTPORT split ServerCnxnFactory f ServerCnxnFactory createFactory PORT f startup zks assertTrue ClientBase waitForServerUp HOSTPORT CONNECTION_TIMEOUT ZooKeeper zk ClientBase createZKClient HOSTPORT CountDownLatch doPurge CountDownLatch CountDownLatch purgeFinished CountDownLatch AtomicBoolean opFailed AtomicBoolean doPurge await OP_TIMEOUT_IN_MILLIS TimeUnit MILLISECONDS PurgeTxnLog purge tmpDir tmpDir
f startup zks assertTrue ClientBase waitForServerUp HOSTPORT CONNECTION_TIMEOUT ZooKeeper zk ClientBase createZKClient HOSTPORT CountDownLatch doPurge CountDownLatch CountDownLatch purgeFinished CountDownLatch AtomicBoolean opFailed AtomicBoolean doPurge await OP_TIMEOUT_IN_MILLIS TimeUnit MILLISECONDS PurgeTxnLog purge tmpDir tmpDir ioe LOG error ioe opFailed set
znodes add mynode zk create mynode Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT e LOG error e exception set e doPurge countDown finished countDown ths indx th thread ths thread start operationsFinishedSuccessfully finished await OP_TIMEOUT_IN_MILLIS TimeUnit MILLISECONDS exception
depth width len DataTree tree DataTree createNodes tree depth width tree getNode stat getCversion len count tree getNodeCount BinaryOutputArchive oa BinaryOutputArchive getArchive NullOutputStream System gc start System nanoTime tree serialize oa end System nanoTime durationms end start pernodeus end start count
ttlsEnabled System setProperty Boolean toString ttlsEnabled
String cmd String String resp sendRequest cmd
zk start count LOG info start start count i start i start count i assertNotNull zk exists i
FileTxnLog setTxnLogSizeLimit File tmpDir ClientBase createTmpDir FileTxnLog log FileTxnLog tmpDir FileTxnLog setPreallocSize PREALLOCATE CreateRequest record CreateRequest NODE_SIZE ZooDefs Ids OPEN_ACL_UNSAFE zxid log append TxnHeader zxid record
FileTxnLog setTxnLogSizeLimit File tmpDir ClientBase createTmpDir FileTxnLog log FileTxnLog tmpDir FileTxnLog setPreallocSize PREALLOCATE CreateRequest record CreateRequest NODE_SIZE ZooDefs Ids OPEN_ACL_UNSAFE zxid log append TxnHeader zxid record LOG debug log getCurrentLogSize log commit LOG info log getCurrentLogSize assertTrue log getCurrentLogSize zxid NODE_SIZE log append TxnHeader zxid record
File tmpDir ClientBase createTmpDir FileTxnLog log FileTxnLog tmpDir FileTxnLog setPreallocSize PREALLOCATE CreateRequest record CreateRequest NODE_SIZE ZooDefs Ids OPEN_ACL_UNSAFE zxid log append TxnHeader zxid record LOG debug log getCurrentLogSize log commit LOG info log getCurrentLogSize assertTrue log getCurrentLogSize zxid NODE_SIZE log append TxnHeader zxid record LOG debug log getCurrentLogSize log commit
File tmpDir ClientBase createTmpDir ClientBase setupTestEnv FileTxnLog setPreallocSize PREALLOCATE FileTxnLog setTxnLogSizeLimit LOG_SIZE_LIMIT ZooKeeperServer zks ZooKeeperServer tmpDir tmpDir PORT Integer parseInt HOSTPORT split ServerCnxnFactory f ServerCnxnFactory createFactory PORT f startup zks assertTrue ClientBase waitForServerUp HOSTPORT CONNECTION_TIMEOUT ZooKeeper zk ZooKeeper HOSTPORT CONNECTION_TIMEOUT DummyWatcher INSTANCE HashSet Long zxids HashSet bytes NODE_SIZE Random random Random random nextBytes bytes txnCount LOG_SIZE_LIMIT NODE_SIZE
SyncRequestProcessor setSnapCount QuorumUtil util QuorumUtil util startAll allCreatedLatch CountDownLatch data ZooKeeper zk ClientBase createZKClient util getConnString i i i zk create i data ZooDefs Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk allCreatedLatch await ServerMetrics getMetrics resetAll leader util getLeaderServer util shutdown leader util start leader Map String Object values MetricsUtils currentServerMetrics
ArrayList QuorumPeer peerList ArrayList QuorumPeer sid sid sid QuorumPeer peer QuorumPeer peers peerTmpdir sid peerTmpdir sid peerClientPort sid sid
QuorumPeer peer QuorumPeer peers peerTmpdir sid peerTmpdir sid peerClientPort sid sid LOG info peer getId peer start peerList add sid peer String failure verifyThreadCount peerList assertNull failure failure myid myid myid i i i QuorumPeer peer peerList get myid LOG info i peer getId peer shutdown peerList remove myid failure verifyThreadCount peerList assertNull failure failure peer QuorumPeer peers peerTmpdir myid peerTmpdir myid peerClientPort myid myid
shouldBeProcessed add readReq processor queuedRequests add readReq Request writeReq newRequest CreateRequest path Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT_SEQUENTIAL toFlag OpCode create sessionId sessionId Request readReq newRequest GetDataRequest path OpCode getData sessionId sessionId processor queuedRequests add writeReq processor queuedWriteRequests add writeReq processor queuedRequests add readReq shouldNotBeProcessed add writeReq shouldNotBeProcessed add readReq processor initThreads defaultSizeOfThreadPool processor stoppedMainLoop processor run Thread sleep shouldBeProcessed removeAll processedRequests Request shouldBeProcessed
processor queuedWriteRequests add writeReq shouldBeInPending add writeReq readReqId readReqId readReqId Request readReq newRequest GetDataRequest path OpCode getData readReqId processor queuedRequests add readReq shouldBeInPending add readReq shouldBeProcessedAfterPending add readReq processor initThreads defaultSizeOfThreadPool processor stoppedMainLoop processor run assertTrue processedRequests isEmpty assertTrue processor queuedRequests isEmpty assertTrue processor queuedWriteRequests isEmpty shouldBeInPending removeAll processor pendingRequests get writeReq sessionId Request shouldBeInPending
count peers HashMap count tmpdir File count port count
createEmptyNode zk followerA path CreateMode PERSISTENT CustomDataTree dt CustomDataTree mt followerA main quorumPeer getZkDb getDataTree CountDownLatch setDataLatch CountDownLatch CountDownLatch continueSetDataLatch CountDownLatch ZooKeeper followerZk zk followerA dt LOG info followerZk CreateMode PERSISTENT path path LOG info setDataLatch await TimeUnit SECONDS
LOG info setDataLatch await TimeUnit SECONDS e LOG error e LOG info continueSetDataLatch countDown setDataLatch countDown continueSetDataLatch await TimeUnit SECONDS
LOG info zkServer takeSnapshot LOG info ZooKeeper globalClient ZooKeeper clientPorts followerA ClientBase CONNECTION_TIMEOUT QuorumPeerMainTest waitForOne globalClient States CONNECTED LOG info mt followerA shutdown QuorumPeerMainTest waitForOne zk followerA States CONNECTING mt followerA start QuorumPeerMainTest waitForOne zk followerA States CONNECTED LOG info Map Long Integer globalSessionsOnLeader mt leaderId main quorumPeer getZkDb getSessionWithTimeOuts Map Long Integer globalSessionsOnFollowerA mt followerA main quorumPeer getZkDb getSessionWithTimeOuts
String metricKey String errorMessage String format metricKey errorMessage actual MetricsUtils currentServerMetrics get metricKey actual
QuorumServerConfigBuilder builders numServers builders size servers Servers servers clientPorts numServers servers mt MainThread numServers servers zk ZooKeeper numServers i i numServers i QuorumServerConfigBuilder quorumServerConfigBuilder builders get i String quorumCfgSection quorumServerConfigBuilder build
CustomizedQPMain context mt i start zk i ZooKeeper clientPorts i ClientBase CONNECTION_TIMEOUT waitForAll zk States CONNECTED LOG info String nodePath leaderId followerA i i i mt i leaderId i followerA followerA i
waitForAll zk States CONNECTED LOG info String nodePath leaderId followerA i i i mt i leaderId i followerA followerA i LOG info followerA mt followerA shutdown waitForOne zk followerA States CONNECTING LOG info
leaderId i followerA followerA i LOG info followerA mt followerA shutdown waitForOne zk followerA States CONNECTING LOG info System setProperty LearnerHandler FORCE_SNAP_SYNC String initialValue ZooKeeper leaderZk zk leaderId leaderZk create nodePath initialValue getBytes Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT LOG info nodePath initialValue CustomQuorumPeer leaderQuorumPeer CustomQuorumPeer mt leaderId main quorumPeer leaderQuorumPeer
LOG info followerA mt followerA shutdown waitForOne zk followerA States CONNECTING LOG info System setProperty LearnerHandler FORCE_SNAP_SYNC String initialValue ZooKeeper leaderZk zk leaderId leaderZk create nodePath initialValue getBytes Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT LOG info nodePath initialValue CustomQuorumPeer leaderQuorumPeer CustomQuorumPeer mt leaderId main quorumPeer leaderQuorumPeer LearnerHandler FORCE_SNAP_SYNC
System setProperty LearnerHandler FORCE_SNAP_SYNC String initialValue ZooKeeper leaderZk zk leaderId leaderZk create nodePath initialValue getBytes Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT LOG info nodePath initialValue CustomQuorumPeer leaderQuorumPeer CustomQuorumPeer mt leaderId main quorumPeer leaderQuorumPeer LearnerHandler FORCE_SNAP_SYNC String value LOG info nodePath value leaderZk nodePath value getBytes
leaderZk create nodePath initialValue getBytes Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT LOG info nodePath initialValue CustomQuorumPeer leaderQuorumPeer CustomQuorumPeer mt leaderId main quorumPeer leaderQuorumPeer String value LOG info nodePath value leaderZk nodePath value getBytes Thread sleep e LOG error nodePath value e
CustomQuorumPeer leaderQuorumPeer CustomQuorumPeer mt leaderId main quorumPeer leaderQuorumPeer String value LOG info nodePath value nodePath value Thread sleep e LOG error nodePath value e leaderQuorumPeer
e LOG error nodePath value e String value LOG info nodePath value leaderZk setData nodePath value getBytes LOG info nodePath value e LOG error nodePath value e CustomQuorumPeer followerAQuorumPeer CustomQuorumPeer mt followerA main quorumPeer LOG info followerA
String value LOG info nodePath value leaderZk setData nodePath value getBytes LOG info nodePath value e LOG error nodePath value e CustomQuorumPeer followerAQuorumPeer CustomQuorumPeer mt followerA main quorumPeer LOG info followerA contexts followerA exitWhenAckNewLeader CountDownLatch latch CountDownLatch
String value LOG info nodePath value leaderZk setData nodePath value getBytes LOG info nodePath value e LOG error nodePath value e CustomQuorumPeer followerAQuorumPeer CustomQuorumPeer mt followerA main quorumPeer LOG info followerA contexts followerA exitWhenAckNewLeader CountDownLatch latch CountDownLatch MainThread followerAMT mt followerA contexts followerA
i i i i leader leader i followerA followerA i LOG info followerA qpMain followerA setDropCreateSession String node ZooKeeper zk ZooKeeper clientPorts followerA ClientBase CONNECTION_TIMEOUT waitForOne zk States CONNECTED sessionId zk getSessionId zk create node ZooDefs Ids OPEN_ACL_UNSAFE CreateMode EPHEMERAL fail
iterations ClientBase CONNECTION_TIMEOUT iterations
id String config peers id MainThread id clientPorts id config peers id start assertTrue ClientBase waitForServerUp clientPorts id CONNECTION_TIMEOUT id assertTrue peers id isQuorumPeerRunning zkHandles id ClientBase createZKClient clientPorts id zkAdminHandles id ZooKeeperAdmin clientPorts id CONNECTION_TIMEOUT zkAdminHandles id addAuthInfo getBytes String statCommandOut FourLetterWordMain send4LetterWord clientPorts id
x509Util ClientX509Util x509TestContext setSystemProperties x509Util KeyStoreFileType JKS KeyStoreFileType JKS System setProperty x509Util getSslHandshakeDetectionTimeoutMillisProperty workerPool Executors newCachedThreadPool port PortAssignment unique localServerAddress InetSocketAddress InetAddress getLoopbackAddress port listeningSocket UnifiedServerSocket x509Util listeningSocket bind localServerAddress Future UnifiedServerSocket UnifiedSocket acceptFuture acceptFuture workerPool UnifiedServerSocket UnifiedSocket UnifiedServerSocket UnifiedSocket UnifiedServerSocket UnifiedSocket listeningSocket accept
LOG info SocketChannel socketChannel createClientSocketChannel MockNIOServerCnxn nioCnxn MockNIOServerCnxn fzks socketChannel sk serverCnxnFactory selectorThread sk attach nioCnxn nioCnxn doIO sk LOG info QuorumPacket qp createValidateSessionPacketResponse sessionTimedout quorumPeer follower processPacket qp LOG info nioCnxn doIO sk Thread sleep LOG info watchCount database getDataTree getWatchCount sessionTimedout LOG info watchCount
ConversableFollower follower QuorumPeer peer peer createQuorumPeer tmpDir follower createFollower tmpDir peer peer follower follower ServerSocket ss ServerSocket InetAddress getByName QuorumServer leaderQS QuorumServer InetSocketAddress ss getLocalSocketAddress follower setLeaderQuorumServer leaderQS Follower followerForThread follower followerForThread followLeader
assertEquals Leader ACK qp getType assertEquals ZxidUtils makeZxid qp getZxid assertEquals f self getAcceptedEpoch assertEquals f self getCurrentEpoch start System currentTimeMillis createSessionZxid f fzk getLastProcessedZxid System currentTimeMillis start Thread sleep assertEquals createSessionZxid f fzk getLastProcessedZxid ZKDatabase zkDb2 ZKDatabase FileTxnSnapLog logDir snapDir start System currentTimeMillis zkDb2 loadDataBase zkDb2 System currentTimeMillis start Thread sleep zkDb2 loadDataBase LOG info zkDb2 getSessions
assertEquals ZxidUtils makeZxid qp getZxid assertEquals l self getAcceptedEpoch assertCurrentEpochGotUpdated l self ClientBase CONNECTION_TIMEOUT qp QuorumPacket Leader ACK qp getZxid oa writeRecord qp readPacketSkippingPing ia qp assertEquals Leader UPTODATE qp getType zxid l zk getZxid l propose Request ZooDefs OpCode create TxnHeader zxid ZooDefs OpCode create CreateTxn getBytes zxid readPacketSkippingPing ia qp assertEquals Leader PROPOSAL qp getType LOG info ia readRecord qp
principals simpleKdc createPrincipals principals
Socket sock LOG info serverSocket getLocalPort to sock serverSocket accept
retry LOG info sock getLocalPort sock getPort to sock setSoTimeout target setSoTimeout workers add PortForwardWorker sock target sock getInputStream target getOutputStream workers add PortForwardWorker target sock target getInputStream sock getOutputStream PortForwardWorker worker workers workerExecutor submit worker e LOG warn e e LOG warn sock getLocalPort sock getPort to e sock close e e
LOG info sock getLocalPort sock getPort to sock setSoTimeout target setSoTimeout workers add PortForwardWorker sock target sock getInputStream target getOutputStream workers add PortForwardWorker target sock target getInputStream sock getOutputStream PortForwardWorker worker workers workerExecutor submit worker e LOG warn e e LOG warn sock getLocalPort sock getPort to e sock close e e LOG warn sock getLocalPort sock getPort to e
thread millis thread join millis thread
hostPort port getPort hostPort
hostPort port getPort hostPort
OSMXBean osMbean OSMXBean osMbean initialFdCount osMbean getOpenFileDescriptorCount
ObjectName children Iterator ObjectName childItr children iterator childItr ObjectName clientBean childItr next clientBean
failed newcounts parts length i hp parts ZooKeeper zk createClient hp newcounts i zk getChildren size zk close failed logAllStackTraces newcounts
zk close failed logAllStackTraces Arrays newcounts counts LOG info Arrays toString newcounts counts newcounts counts newcounts Thread sleep failed String logmsg
failed logAllStackTraces Arrays newcounts counts LOG info Arrays toString newcounts counts newcounts counts newcounts Thread sleep failed String logmsg counts counts
HammerThread threads HammerThread threadCount start Time currentElapsedTime i i threads i String prefix i ZooKeeper zk createClient zk create prefix Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk close prefix HammerThread thread SuperHammerThread i prefix childCount thread start threads i thread verifyHammer start threads childCount
i Enumeration InetAddress addrs i getInetAddresses addrs InetAddress a addrs nextElement a bindAddress a getHostAddress a bindAddress bindAddress se LOG warn se bindAddress LOG warn PORT PortAssignment unique
addrs InetAddress a addrs nextElement a bindAddress a getHostAddress a bindAddress bindAddress se LOG warn se bindAddress LOG warn PORT PortAssignment unique LOG info bindAddress String HOSTPORT bindAddress PORT
TestableZooKeeper zk createClient
TestableZooKeeper zk createClient LOG info zk testableLocalSocketAddress
TestableZooKeeper zk createClient LOG info zk testableLocalSocketAddress LOG info zk testableRemoteSocketAddress
ZooKeeper zk zk createClient zk create Ids CREATOR_ALL_ACL CreateMode PERSISTENT fail e LOG info e getMessage ArrayList ACL testACL ArrayList ACL testACL add ACL Perms ALL Perms ADMIN Ids AUTH_IDS testACL add ACL Perms ALL Perms ADMIN Id zk create testACL CreateMode PERSISTENT fail e
e LOG info e getMessage ArrayList ACL testACL ArrayList ACL testACL add ACL Perms ALL Perms ADMIN Ids AUTH_IDS testACL add ACL Perms ALL Perms ADMIN Id zk create testACL CreateMode PERSISTENT fail e LOG info e getMessage ArrayList ACL testACL ArrayList ACL testACL add ACL Perms ALL Perms ADMIN Id zk create testACL CreateMode PERSISTENT fail
LOG warn threadCount clientCount initialFdCount osMbean getOpenFileDescriptorCount VerifyClientCleanup threads VerifyClientCleanup threadCount i i threads i threads i VerifyClientCleanup i clientCount threads i start i i threads i threads i join CONNECTION_TIMEOUT assertTrue threads i current threads i count currentCount osMbean getOpenFileDescriptorCount String logmsg currentCount initialFdCount
threadCount clientCount initialFdCount osMbean getOpenFileDescriptorCount VerifyClientCleanup threads VerifyClientCleanup threadCount i i threads i threads i VerifyClientCleanup i clientCount threads i start i i threads i threads i join CONNECTION_TIMEOUT assertTrue threads i current threads i count currentCount osMbean getOpenFileDescriptorCount String logmsg currentCount initialFdCount LOG error logmsg currentCount initialFdCount
ServerCnxnFactory f ServerCnxnFactory createFactory PORT f startup zks assertTrue ClientBase waitForServerUp HOSTPORT CONNECTION_TIMEOUT ZooKeeper zk ZooKeeper HOSTPORT CONNECTION_TIMEOUT i i i zk create i Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk close f shutdown zks shutdown assertTrue ClientBase waitForServerDown HOSTPORT CONNECTION_TIMEOUT zks ZooKeeperServer tmpSnapDir tmpLogDir zks startdata zxid zks getZKDatabase getDataTreeLastProcessedZxid
i i i QuorumPeer peer QuorumPeer peers tmpdir i tmpdir i port i i peer startLeaderElection LEThread thread LEThread peer i rounds quora thread start threads add thread LOG info getTestName waitCounter successCount waitCounter wait waitCounter LOG info successCount i i threads i threads i
sid sid sid port sid PortAssignment unique peers put Long valueOf sid QuorumServer sid InetSocketAddress PortAssignment unique InetSocketAddress PortAssignment unique InetSocketAddress port sid tmpdir sid ClientBase createTmpDir sid sid sid peer QuorumPeer peers tmpdir sid tmpdir sid port sid sid LOG info peer getId peer start peerList add sid peer peer peerList get VerifyState v1 VerifyState peerList get v1 start v1 join waitTime assertFalse v1 isSuccess waitTime peer QuorumPeer peers tmpdir sid tmpdir sid port sid sid
LOG info peer getId peer start peerList add sid peer peer peerList get VerifyState v1 VerifyState peerList get v1 start v1 join waitTime assertFalse v1 isSuccess waitTime leaderSid peer getCurrentVote getId zxid peer getCurrentVote getZxid electionEpoch peer getCurrentVote getElectionEpoch ServerState state peer getCurrentVote getState peerEpoch peer getCurrentVote getPeerEpoch Vote newVote Vote leaderSid zxid electionEpoch peerEpoch state peer setCurrentVote newVote
CountdownWatcher watcher1 CountdownWatcher CountdownWatcher watcher2 CountdownWatcher CountdownWatcher watcher3 CountdownWatcher QuorumUtil qu QuorumUtil qu shutdownAll qu start qu start assertTrue ClientBase waitForServerUp qu getPeer clientPort ClientBase CONNECTION_TIMEOUT assertTrue ClientBase waitForServerUp qu getPeer clientPort ClientBase CONNECTION_TIMEOUT ZooKeeper zk1 createClient qu getPeer peer getClientPort watcher1
LOG info Long toHexString zk1 getSessionId String resyncPath zk1 create resyncPath ZooDefs Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk1 close qu shutdown qu shutdown assertTrue ClientBase waitForServerDown qu getPeer clientPort ClientBase CONNECTION_TIMEOUT assertTrue ClientBase waitForServerDown qu getPeer clientPort ClientBase CONNECTION_TIMEOUT qu start qu start assertTrue ClientBase waitForServerUp qu getPeer clientPort ClientBase CONNECTION_TIMEOUT assertTrue ClientBase waitForServerUp qu getPeer clientPort ClientBase CONNECTION_TIMEOUT qu start assertTrue ClientBase waitForServerUp qu getPeer clientPort ClientBase CONNECTION_TIMEOUT zk1 createClient qu getPeer peer getClientPort watcher1
zk1 close qu shutdown qu shutdown assertTrue ClientBase waitForServerDown qu getPeer clientPort ClientBase CONNECTION_TIMEOUT assertTrue ClientBase waitForServerDown qu getPeer clientPort ClientBase CONNECTION_TIMEOUT qu start qu start assertTrue ClientBase waitForServerUp qu getPeer clientPort ClientBase CONNECTION_TIMEOUT assertTrue ClientBase waitForServerUp qu getPeer clientPort ClientBase CONNECTION_TIMEOUT qu start assertTrue ClientBase waitForServerUp qu getPeer clientPort ClientBase CONNECTION_TIMEOUT zk1 createClient qu getPeer peer getClientPort watcher1 LOG info Long toHexString zk1 getSessionId assertNotNull zk1 exists resyncPath ZooKeeper zk2 createClient qu getPeer peer getClientPort watcher2
assertTrue ClientBase waitForServerDown qu getPeer clientPort ClientBase CONNECTION_TIMEOUT assertTrue ClientBase waitForServerDown qu getPeer clientPort ClientBase CONNECTION_TIMEOUT qu start qu start assertTrue ClientBase waitForServerUp qu getPeer clientPort ClientBase CONNECTION_TIMEOUT assertTrue ClientBase waitForServerUp qu getPeer clientPort ClientBase CONNECTION_TIMEOUT qu start assertTrue ClientBase waitForServerUp qu getPeer clientPort ClientBase CONNECTION_TIMEOUT zk1 createClient qu getPeer peer getClientPort watcher1 LOG info Long toHexString zk1 getSessionId assertNotNull zk1 exists resyncPath ZooKeeper zk2 createClient qu getPeer peer getClientPort watcher2 LOG info Long toHexString zk2 getSessionId assertNotNull zk2 exists resyncPath ZooKeeper zk3 createClient qu getPeer peer getClientPort watcher3
QuorumUtil qu QuorumUtil qu startAll CountdownWatcher watcher1 CountdownWatcher CountdownWatcher watcher2 CountdownWatcher CountdownWatcher watcher3 CountdownWatcher index qu getPeer index peer leader index Leader leader qu getPeer index peer leader assertNotNull leader qu getPeer index peer getActiveServer getZKDatabase setSnapshotSizeFactor qu getPeer index peer getActiveServer getZKDatabase setSnapshotSizeFactor index index
CountdownWatcher watcher2 CountdownWatcher CountdownWatcher watcher3 CountdownWatcher index qu getPeer index peer leader index Leader leader qu getPeer index peer leader assertNotNull leader qu getPeer index peer getActiveServer getZKDatabase setSnapshotSizeFactor qu getPeer index peer getActiveServer getZKDatabase setSnapshotSizeFactor index index LOG info index qu shutdown index ZooKeeper zk3 createClient qu getPeer peer getClientPort watcher3
index Leader leader qu getPeer index peer leader assertNotNull leader qu getPeer index peer getActiveServer getZKDatabase setSnapshotSizeFactor qu getPeer index peer getActiveServer getZKDatabase setSnapshotSizeFactor index index LOG info index qu shutdown index ZooKeeper zk3 createClient qu getPeer peer getClientPort watcher3 LOG info Long toHexString zk3 getSessionId zk3 create ZooDefs Ids OPEN_ACL_UNSAFE CreateMode EPHEMERAL_SEQUENTIAL qu restart index ZooKeeper zk1 createClient qu getPeer index peer getClientPort watcher1
Thread sleep pending decrementAndGet counter incrementAndGet errors incrementAndGet counter sem release pending incrementAndGet qu shutdown index
pending decrementAndGet counter incrementAndGet errors incrementAndGet counter sem release pending incrementAndGet qu shutdown index LOG info
pending decrementAndGet counter incrementAndGet errors incrementAndGet counter sem release pending incrementAndGet qu shutdown index LOG info
Semaphore sem Semaphore QuorumUtil qu QuorumUtil qu startAll CountdownWatcher watcher1 CountdownWatcher CountdownWatcher watcher2 CountdownWatcher CountdownWatcher watcher3 CountdownWatcher index qu getPeer index peer leader index Leader leader qu getPeer index peer leader assertNotNull leader index index LOG info index ZooKeeper zk1 createClient qu getPeer index peer getClientPort watcher1
QuorumUtil qu QuorumUtil qu startAll CountdownWatcher watcher1 CountdownWatcher CountdownWatcher watcher2 CountdownWatcher CountdownWatcher watcher3 CountdownWatcher index qu getPeer index peer leader index Leader leader qu getPeer index peer leader assertNotNull leader index index LOG info index ZooKeeper zk1 createClient qu getPeer index peer getClientPort watcher1 LOG info Long toHexString zk1 getSessionId ZooKeeper zk2 createClient qu getPeer index peer getClientPort watcher2
CountdownWatcher watcher1 CountdownWatcher CountdownWatcher watcher2 CountdownWatcher CountdownWatcher watcher3 CountdownWatcher index qu getPeer index peer leader index Leader leader qu getPeer index peer leader assertNotNull leader index index LOG info index ZooKeeper zk1 createClient qu getPeer index peer getClientPort watcher1 LOG info Long toHexString zk1 getSessionId ZooKeeper zk2 createClient qu getPeer index peer getClientPort watcher2 LOG info Long toHexString zk2 getSessionId ZooKeeper zk3 createClient qu getPeer peer getClientPort watcher3
mytestfooThread start pending decrementAndGet counter incrementAndGet errors incrementAndGet counter sem release pending incrementAndGet qu shutdown index Thread sleep
LOG info assertTrue qu getPeer index peer follower epochF qu getPeer index peer getActiveServer getZxid epochL leader getEpoch assertTrue epochF epochL qu getPeer index peer getActiveServer getZKDatabase getDataTreeLastProcessedZxid epochF leaderIndex index Collection Long sessionsRestarted qu getPeer index peer getActiveServer getZKDatabase getSessions Collection Long sessionsNotRestarted qu getPeer leaderIndex peer getActiveServer getZKDatabase getSessions Long l sessionsRestarted assertTrue sessionsNotRestarted contains l l assertEquals sessionsNotRestarted size sessionsRestarted size ZKDatabase restarted qu getPeer index peer getActiveServer getZKDatabase ZKDatabase clean qu getPeer peer getActiveServer getZKDatabase ZKDatabase lead qu getPeer leaderIndex peer getActiveServer getZKDatabase Long l sessionsRestarted
Collection Long sessionsRestarted qu getPeer index peer getActiveServer getZKDatabase getSessions Collection Long sessionsNotRestarted qu getPeer leaderIndex peer getActiveServer getZKDatabase getSessions Long l sessionsRestarted assertTrue sessionsNotRestarted contains l l assertEquals sessionsNotRestarted size sessionsRestarted size ZKDatabase restarted qu getPeer index peer getActiveServer getZKDatabase ZKDatabase clean qu getPeer peer getActiveServer getZKDatabase ZKDatabase lead qu getPeer leaderIndex peer getActiveServer getZKDatabase Long l sessionsRestarted LOG info Long toHexString l assertTrue sessionsNotRestarted contains l l Set String ephemerals restarted getEphemerals l Set String cleanEphemerals clean getEphemerals l String cleanEphemerals ephemerals contains
assertTrue sessionsNotRestarted contains l l assertEquals sessionsNotRestarted size sessionsRestarted size ZKDatabase restarted qu getPeer index peer getActiveServer getZKDatabase ZKDatabase clean qu getPeer peer getActiveServer getZKDatabase ZKDatabase lead qu getPeer leaderIndex peer getActiveServer getZKDatabase Long l sessionsRestarted LOG info Long toHexString l assertTrue sessionsNotRestarted contains l l Set String ephemerals restarted getEphemerals l Set String cleanEphemerals clean getEphemerals l String o cleanEphemerals ephemerals contains o LOG info o Long toHexString clean getDataTree getNode o stat getMzxid String o ephemerals cleanEphemerals contains o
ZKDatabase clean qu getPeer peer getActiveServer getZKDatabase ZKDatabase lead qu getPeer leaderIndex peer getActiveServer getZKDatabase Long l LOG info Long toHexString l assertTrue sessionsNotRestarted contains l l Set String ephemerals restarted getEphemerals l Set String cleanEphemerals clean getEphemerals l String o cleanEphemerals ephemerals contains o LOG info o Long toHexString clean getDataTree getNode o stat getMzxid String o ephemerals cleanEphemerals contains o LOG info o Long toHexString restarted getDataTree getNode o stat getMzxid Set String leadEphemerals lead getEphemerals l String o leadEphemerals
LOG info Long toHexString l assertTrue sessionsNotRestarted contains l l Set String ephemerals restarted getEphemerals l Set String cleanEphemerals clean getEphemerals l String o cleanEphemerals ephemerals contains o LOG info o Long toHexString clean getDataTree getNode o stat getMzxid String o ephemerals cleanEphemerals contains o LOG info o Long toHexString restarted getDataTree getNode o stat getMzxid Set String leadEphemerals lead getEphemerals l String o leadEphemerals cleanEphemerals contains o LOG info o Long toHexString lead getDataTree getNode o stat getMzxid String o cleanEphemerals
String String cmd String hpobj String resp send4LetterWord hpobj host hpobj port cmd
String cmd String String resp sendRequest cmd
String cmd String String resp sendRequest cmd
String cmd String String resp sendRequest cmd
port2 PortAssignment unique port3 PortAssignment unique port4 PortAssignment unique port5 PortAssignment unique leport1 PortAssignment unique leport2 PortAssignment unique leport3 PortAssignment unique leport4 PortAssignment unique leport5 PortAssignment unique clientport1 PortAssignment unique clientport2 PortAssignment unique clientport3 PortAssignment unique clientport4 PortAssignment unique clientport5 PortAssignment unique hostPort clientport1 clientport2 clientport3 clientport4 clientport5
withObservers tickTime initLimit syncLimit connectToLearnerMasterLimit HashMap Long QuorumServer peers HashMap peers put Long valueOf QuorumServer InetSocketAddress port1 InetSocketAddress leport1 InetSocketAddress clientport1 peers put Long valueOf QuorumServer InetSocketAddress port2 InetSocketAddress leport2 InetSocketAddress clientport2 peers put Long valueOf QuorumServer InetSocketAddress port3 InetSocketAddress leport3 InetSocketAddress clientport3 peers put Long valueOf QuorumServer InetSocketAddress port4 InetSocketAddress leport4 InetSocketAddress clientport4 withObservers QuorumPeer LearnerType OBSERVER QuorumPeer LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress port5 InetSocketAddress leport5 InetSocketAddress clientport5 withObservers QuorumPeer LearnerType OBSERVER QuorumPeer LearnerType PARTICIPANT
syncLimit connectToLearnerMasterLimit HashMap Long QuorumServer peers HashMap peers put Long valueOf QuorumServer InetSocketAddress port1 InetSocketAddress leport1 InetSocketAddress clientport1 peers put Long valueOf QuorumServer InetSocketAddress port2 InetSocketAddress leport2 InetSocketAddress clientport2 peers put Long valueOf QuorumServer InetSocketAddress port3 InetSocketAddress leport3 InetSocketAddress clientport3 peers put Long valueOf QuorumServer InetSocketAddress port4 InetSocketAddress leport4 InetSocketAddress clientport4 withObservers QuorumPeer LearnerType OBSERVER QuorumPeer LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress port5 InetSocketAddress leport5 InetSocketAddress clientport5 withObservers QuorumPeer LearnerType OBSERVER QuorumPeer LearnerType PARTICIPANT LOG info clientport1 withObservers qp setProperty port4 leport4 clientport4 qp setProperty port5 leport5 clientport5 QuorumHierarchical hq1 QuorumHierarchical qp s1 QuorumPeer peers s1dir s1dir clientport1 tickTime initLimit syncLimit connectToLearnerMasterLimit hq1 assertEquals clientport1 s1 getClientPort
peers put Long valueOf QuorumServer InetSocketAddress port2 InetSocketAddress leport2 InetSocketAddress clientport2 peers put Long valueOf QuorumServer InetSocketAddress port3 InetSocketAddress leport3 InetSocketAddress clientport3 peers put Long valueOf QuorumServer InetSocketAddress port4 InetSocketAddress leport4 InetSocketAddress clientport4 withObservers QuorumPeer LearnerType OBSERVER QuorumPeer LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress port5 InetSocketAddress leport5 InetSocketAddress clientport5 withObservers QuorumPeer LearnerType OBSERVER QuorumPeer LearnerType PARTICIPANT LOG info clientport1 withObservers qp setProperty port4 leport4 clientport4 qp setProperty port5 leport5 clientport5 QuorumHierarchical hq1 QuorumHierarchical qp s1 QuorumPeer peers s1dir s1dir clientport1 tickTime initLimit syncLimit connectToLearnerMasterLimit hq1 assertEquals clientport1 s1 getClientPort LOG info clientport2 QuorumHierarchical hq2 QuorumHierarchical qp s2 QuorumPeer peers s2dir s2dir clientport2 tickTime initLimit syncLimit connectToLearnerMasterLimit hq2 assertEquals clientport2 s2 getClientPort
LOG info clientport1 qp setProperty port4 leport4 clientport4 qp setProperty port5 leport5 clientport5 QuorumHierarchical hq1 QuorumHierarchical qp s1 QuorumPeer peers s1dir s1dir clientport1 tickTime initLimit syncLimit connectToLearnerMasterLimit hq1 assertEquals clientport1 s1 getClientPort LOG info clientport2 QuorumHierarchical hq2 QuorumHierarchical qp s2 QuorumPeer peers s2dir s2dir clientport2 tickTime initLimit syncLimit connectToLearnerMasterLimit hq2 assertEquals clientport2 s2 getClientPort LOG info clientport3 QuorumHierarchical hq3 QuorumHierarchical qp s3 QuorumPeer peers s3dir s3dir clientport3 tickTime initLimit syncLimit connectToLearnerMasterLimit hq3 assertEquals clientport3 s3 getClientPort
LOG info cht tearDownAll LOG info shutdown s1 LOG info shutdown s2 LOG info shutdown s3 LOG info shutdown s4 LOG info shutdown s5 hp assertTrue ClientBase waitForServerDown hp ClientBase CONNECTION_TIMEOUT
MBeanServer mbs MBeanRegistry getInstance getPlatformMBeanServer JMXServiceURL url JMXServiceURL cs JMXConnectorServerFactory newJMXConnectorServer url mbs cs start JMXServiceURL addr cs getAddress
Set ObjectName beans Set ObjectName found nTry nTry Thread sleep beans conn queryNames ObjectName MBeanRegistry DOMAIN e RuntimeException e found HashSet ObjectName name LOG info name ObjectName beans name
Set ObjectName expectedNames LOG info Arrays toString expectedNames Set ObjectName beans ensureAll expectedNames ObjectName beans
Set ObjectName beans nTry foundUnexpected String unexpectedName nTry Thread sleep beans conn queryNames ObjectName MBeanRegistry DOMAIN e RuntimeException e foundUnexpected String ObjectName beans
e RuntimeException e foundUnexpected name bean bean toString name LOG info name foundUnexpected unexpectedName name bean toString foundUnexpected foundUnexpected nTry foundUnexpected LOG info
Set ObjectName beans nTry Set ObjectName found HashSet ObjectName nTry Thread sleep beans conn queryNames ObjectName MBeanRegistry DOMAIN e RuntimeException e found clear name LOG info name ObjectName beans name
String String String value
String expectedName String expectedAttribute String value LOG info expectedName expectedAttribute Set ObjectName beans nTry nTry Thread sleep beans conn queryNames ObjectName MBeanRegistry DOMAIN e RuntimeException e LOG info expectedName ObjectName beans expectedName
zk path LOG debug path zk create path Ids CREATOR_ALL_ACL CreateMode PERSISTENT List ACL acls zk getACL path
zk path testName LOG debug path zk create path Ids CREATOR_ALL_ACL CreateMode PERSISTENT List ACL acls zk getACL path LOG debug path testName ACL acls
qu enableLocalSession qu startAll QuorumPeer leader qu getLeaderQuorumPeer ZooKeeper zk ClientBase createZKClient qu getConnectString leader CreateRequest createRequest CreateRequest Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT toFlag ByteArrayOutputStream baos ByteArrayOutputStream BinaryOutputArchive boa BinaryOutputArchive getArchive baos createRequest serialize boa ByteBuffer bb ByteBuffer wrap baos toByteArray sid qu getFollowerQuorumPeers get getActiveServer getServerId locallSession sid
ZooKeeperServer setDigestEnabled count File tmpDir ClientBase createTmpDir FileTxnSnapLog logFile FileTxnSnapLog tmpDir tmpDir DataTree dt DataTree dt createNode count count count dt createNode count count Time currentElapsedTime digestBefore dt getTreeDigest DataNode zk dt getNode LOG info count doOp logFile ZooDefs OpCode create count dt zk assertNotEquals digestBefore dt getTreeDigest
File tmpDir ClientBase createTmpDir FileTxnSnapLog logFile FileTxnSnapLog tmpDir tmpDir DataTree dt DataTree dt createNode count count count dt createNode count count Time currentElapsedTime digestBefore dt getTreeDigest DataNode zk dt getNode LOG info count doOp logFile ZooDefs OpCode create count dt zk assertNotEquals digestBefore dt getTreeDigest LOG info count digestBefore dt getTreeDigest doOp logFile ZooDefs OpCode create count dt zk zk stat getCversion assertNotEquals digestBefore dt getTreeDigest
count count count dt createNode count count Time currentElapsedTime digestBefore dt getTreeDigest DataNode zk dt getNode LOG info count doOp logFile ZooDefs OpCode create count dt zk assertNotEquals digestBefore dt getTreeDigest LOG info count digestBefore dt getTreeDigest doOp logFile ZooDefs OpCode create count dt zk zk stat getCversion assertNotEquals digestBefore dt getTreeDigest LOG info count digestBefore dt getTreeDigest doOp logFile ZooDefs OpCode multi count dt zk zk stat getCversion assertNotEquals digestBefore dt getTreeDigest
txn CreateTxn path cversion List Txn txnList ArrayList Txn ByteArrayOutputStream baos ByteArrayOutputStream BinaryOutputArchive boa BinaryOutputArchive getArchive baos txn serialize boa ByteBuffer bb ByteBuffer wrap baos toByteArray Txn txact Txn ZooDefs OpCode create bb array txnList add txact txn MultiTxn txnList txnHeader TxnHeader prevPzxid Time currentElapsedTime ZooDefs OpCode multi logFile processTransaction txnHeader dt txn newCversion parent stat getCversion newPzxid parent stat getPzxid child dt getChildren parentName childStr StringBuilder
txn CreateTxn path cversion List Txn txnList ArrayList Txn ByteArrayOutputStream baos ByteArrayOutputStream BinaryOutputArchive boa BinaryOutputArchive getArchive baos txn serialize boa ByteBuffer bb ByteBuffer wrap baos toByteArray Txn txact Txn ZooDefs OpCode create bb array txnList add txact txn MultiTxn txnList txnHeader TxnHeader prevPzxid Time currentElapsedTime ZooDefs OpCode multi logFile processTransaction txnHeader dt txn newCversion parent stat getCversion newPzxid parent stat getPzxid child dt getChildren parentName childStr StringBuilder
File tmpDir ClientBase createTmpDir FileTxnLog txnLog FileTxnLog tmpDir TxnHeader txnHeader TxnHeader Time currentElapsedTime ZooDefs OpCode create Record txn CreateTxn txnLog append txnHeader txn FileInputStream in FileInputStream tmpDir getPath Long toHexString txnHeader getZxid BinaryInputArchive ia BinaryInputArchive getArchive in FileHeader header FileHeader header deserialize ia
zks getZKDatabase setlastProcessedZxid zks getZKDatabase getDataTreeLastProcessedZxid LOG info zks getZKDatabase getDataTreeLastProcessedZxid zks takeSnapshot zks shutdown stopServer startServer zks serverFactory getZooKeeperServer fZxid zks getZKDatabase getDataTreeLastProcessedZxid assertTrue fZxid eZxid eZxid fZxid zk createZKClient hostPort String children String path children zk getChildren toArray String path zk create Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT_SEQUENTIAL
sessionId String session Long toHexString sessionId
osMbean osMbean ofdc osMbean getOpenFileDescriptorCount
osMbean osMbean mfdc osMbean getMaxFileDescriptorCount
testObserverMaster latch CountDownLatch setUp testObserverMaster q3 start assertTrue ClientBase waitForServerUp CLIENT_PORT_OBS CONNECTION_TIMEOUT testObserverMaster masterPort q3 getQuorumPeer observer getSocket getPort
port2 PortAssignment unique port3 PortAssignment unique port4 PortAssignment unique port5 PortAssignment unique portLE1 PortAssignment unique portLE2 PortAssignment unique portLE3 PortAssignment unique portLE4 PortAssignment unique portLE5 PortAssignment unique portClient1 PortAssignment unique portClient2 PortAssignment unique portClient3 PortAssignment unique portClient4 PortAssignment unique portClient5 PortAssignment unique hostPort portClient1 portClient2 portClient3 portClient4 portClient5
portClient1 PortAssignment unique portClient2 PortAssignment unique portClient3 PortAssignment unique portClient4 PortAssignment unique portClient5 PortAssignment unique hostPort portClient1 portClient2 portClient3 portClient4 portClient5 LOG info hostPort s1dir ClientBase createTmpDir s2dir ClientBase createTmpDir s3dir ClientBase createTmpDir s4dir ClientBase createTmpDir s5dir ClientBase createTmpDir startServers withObservers OSMXBean osMbean OSMXBean osMbean
initLimit syncLimit connectToLearnerMasterLimit Map Long QuorumServer peers HashMap Long QuorumServer peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port1 InetSocketAddress LOCALADDR portLE1 InetSocketAddress LOCALADDR portClient1 LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port2 InetSocketAddress LOCALADDR portLE2 InetSocketAddress LOCALADDR portClient2 LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port3 InetSocketAddress LOCALADDR portLE3 InetSocketAddress LOCALADDR portClient3 LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port4 InetSocketAddress LOCALADDR portLE4 InetSocketAddress LOCALADDR portClient4 LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port5 InetSocketAddress LOCALADDR portLE5 InetSocketAddress LOCALADDR portClient5 LearnerType PARTICIPANT peers get Long valueOf type LearnerType OBSERVER peers get Long valueOf type LearnerType OBSERVER LOG info portClient1 s1 QuorumPeer peers s1dir s1dir portClient1 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient1 s1 getClientPort
Map Long QuorumServer peers HashMap Long QuorumServer peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port1 InetSocketAddress LOCALADDR portLE1 InetSocketAddress LOCALADDR portClient1 LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port2 InetSocketAddress LOCALADDR portLE2 InetSocketAddress LOCALADDR portClient2 LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port3 InetSocketAddress LOCALADDR portLE3 InetSocketAddress LOCALADDR portClient3 LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port4 InetSocketAddress LOCALADDR portLE4 InetSocketAddress LOCALADDR portClient4 LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port5 InetSocketAddress LOCALADDR portLE5 InetSocketAddress LOCALADDR portClient5 LearnerType PARTICIPANT peers get Long valueOf type LearnerType OBSERVER peers get Long valueOf type LearnerType OBSERVER LOG info portClient1 s1 QuorumPeer peers s1dir s1dir portClient1 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient1 s1 getClientPort LOG info portClient2 s2 QuorumPeer peers s2dir s2dir portClient2 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient2 s2 getClientPort
peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port3 InetSocketAddress LOCALADDR portLE3 InetSocketAddress LOCALADDR portClient3 LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port4 InetSocketAddress LOCALADDR portLE4 InetSocketAddress LOCALADDR portClient4 LearnerType PARTICIPANT peers put Long valueOf QuorumServer InetSocketAddress LOCALADDR port5 InetSocketAddress LOCALADDR portLE5 InetSocketAddress LOCALADDR portClient5 LearnerType PARTICIPANT peers get Long valueOf type LearnerType OBSERVER peers get Long valueOf type LearnerType OBSERVER LOG info portClient1 s1 QuorumPeer peers s1dir s1dir portClient1 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient1 s1 getClientPort LOG info portClient2 s2 QuorumPeer peers s2dir s2dir portClient2 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient2 s2 getClientPort LOG info portClient3 s3 QuorumPeer peers s3dir s3dir portClient3 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient3 s3 getClientPort
LOG info portClient2 s2 QuorumPeer peers s2dir s2dir portClient2 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient2 s2 getClientPort LOG info portClient3 s3 QuorumPeer peers s3dir s3dir portClient3 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient3 s3 getClientPort LOG info portClient4 s4 QuorumPeer peers s4dir s4dir portClient4 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient4 s4 getClientPort LOG info portClient5 s5 QuorumPeer peers s5dir s5dir portClient5 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient5 s5 getClientPort s4 setLearnerType LearnerType OBSERVER s5 setLearnerType LearnerType OBSERVER
s2 QuorumPeer peers s2dir s2dir portClient2 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient2 s2 getClientPort LOG info portClient3 s3 QuorumPeer peers s3dir s3dir portClient3 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient3 s3 getClientPort LOG info portClient4 s4 QuorumPeer peers s4dir s4dir portClient4 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient4 s4 getClientPort LOG info portClient5 s5 QuorumPeer peers s5dir s5dir portClient5 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient5 s5 getClientPort s4 setLearnerType LearnerType OBSERVER s5 setLearnerType LearnerType OBSERVER LOG info s1 getVotingView
assertEquals portClient2 s2 getClientPort LOG info portClient3 s3 QuorumPeer peers s3dir s3dir portClient3 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient3 s3 getClientPort LOG info portClient4 s4 QuorumPeer peers s4dir s4dir portClient4 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient4 s4 getClientPort LOG info portClient5 s5 QuorumPeer peers s5dir s5dir portClient5 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient5 s5 getClientPort s4 setLearnerType LearnerType OBSERVER s5 setLearnerType LearnerType OBSERVER LOG info s1 getVotingView LOG info s2 getVotingView
LOG info portClient3 s3 QuorumPeer peers s3dir s3dir portClient3 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient3 s3 getClientPort LOG info portClient4 s4 QuorumPeer peers s4dir s4dir portClient4 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient4 s4 getClientPort LOG info portClient5 s5 QuorumPeer peers s5dir s5dir portClient5 tickTime initLimit syncLimit connectToLearnerMasterLimit assertEquals portClient5 s5 getClientPort s4 setLearnerType LearnerType OBSERVER s5 setLearnerType LearnerType OBSERVER LOG info s1 getVotingView LOG info s2 getVotingView LOG info s3 getVotingView
LOG info OSMXBean osMbean OSMXBean osMbean
qp shutdown Election e qp getElectionAlg e LOG info qp getName e shutdown LOG info qp getName LOG info qp getName readTimeout qp getTickTime qp getInitLimit connectTimeout qp getTickTime qp getSyncLimit maxTimeout Math max readTimeout connectTimeout maxTimeout Math max maxTimeout ClientBase CONNECTION_TIMEOUT qp join maxTimeout qp fail maxTimeout qp getName
serverToRestart serverToRestart serverToRestart LOG info serverToRestart qu shutdown serverToRestart assertTrue ClientBase waitForServerDown qu getPeer serverToRestart clientPort ClientBase CONNECTION_TIMEOUT String format serverToRestart qu restart serverToRestart String errorMessage serverToRestart waitFor errorMessage qu allPeersAreConnected
serverToRestart serverToRestart serverToRestart LOG info serverToRestart qu shutdown serverToRestart assertTrue ClientBase waitForServerDown qu getPeer serverToRestart clientPort ClientBase CONNECTION_TIMEOUT String format serverToRestart qu restart serverToRestart String errorMessage serverToRestart waitFor errorMessage qu allPeersAreConnected
leaderId qu getLeaderServer
leaderId qu getLeaderServer LOG info leaderId qu shutdown leaderId assertTrue ClientBase waitForServerDown qu getPeer leaderId clientPort ClientBase CONNECTION_TIMEOUT String errorMessage waitFor errorMessage qu leaderExists qu getLeaderServer leaderId qu restart leaderId errorMessage waitFor errorMessage qu allPeersAreConnected
shutdownAll i i i start i
id PeerStruct ps getPeer id
id PeerStruct ps getPeer id
id QuorumPeer qp getPeer id peer
shutdown id QuorumPeer qp getPeer id peer LOG info qp getName qp shutdown Election e qp getElectionAlg e
QuorumPeer qp getPeer id peer LOG info qp getName qp shutdown Election e qp getElectionAlg e LOG info qp getName e shutdown LOG info qp getName LOG info qp getName qp join qp fail qp getName e
LOG info OSMXBean osMbean OSMXBean osMbean
secondFollowerIndex firstFollowerIndex secondFollowerIndex firstFollowerIndex secondFollowerIndex firstFollowerIndex secondFollowerIndex LOG info firstFollowerIndex qU shutdown firstFollowerIndex
firstFollowerIndex secondFollowerIndex firstFollowerIndex secondFollowerIndex firstFollowerIndex secondFollowerIndex LOG info firstFollowerIndex qU shutdown firstFollowerIndex LOG info secondFollowerIndex qU shutdown secondFollowerIndex
firstFollowerIndex secondFollowerIndex firstFollowerIndex secondFollowerIndex LOG info firstFollowerIndex qU shutdown firstFollowerIndex LOG info secondFollowerIndex qU shutdown secondFollowerIndex LOG info firstFollowerIndex qU restart firstFollowerIndex
qu shutdown CountdownWatcher watcher CountdownWatcher ZooKeeper zk ZooKeeper qu getConnString CONNECTION_TIMEOUT watcher watcher waitForConnected CONNECTION_TIMEOUT assertSame States CONNECTEDREADONLY zk getState fakeId zk getSessionId
qu shutdown CountdownWatcher watcher CountdownWatcher ZooKeeper zk ZooKeeper qu getConnString CONNECTION_TIMEOUT watcher watcher waitForConnected CONNECTION_TIMEOUT assertSame States CONNECTEDREADONLY zk getState fakeId zk getSessionId LOG info zk getState fakeId watcher reset qu start assertTrue ClientBase waitForServerUp qu getPeer clientPort CONNECTION_TIMEOUT LOG info qu getPeer clientPort watcher waitForSyncConnected CONNECTION_TIMEOUT assertEquals States CONNECTED zk getState
String subsubpath subpath k zk create subsubpath subsubpath getBytes Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT f shutdown zks shutdown assertTrue ClientBase waitForServerDown HOSTPORT CONNECTION_TIMEOUT zks ZooKeeperServer tmpDir tmpDir f ServerCnxnFactory createFactory PORT startSignal CountDownLatch f startup zks assertTrue ClientBase waitForServerUp HOSTPORT CONNECTION_TIMEOUT startSignal await CONNECTION_TIMEOUT TimeUnit MILLISECONDS assertTrue startSignal getCount Stat stat Stat i i i path i
useCache ServerMetrics getMetrics resetAll Stat writeStat Stat Stat readStat Stat readData reads expectedHits expectedMisses ZooKeeperServer zks serverFactory getZooKeeperServer zks setResponseCachingEnabled useCache
data minExpectedSnapshots File tmpDir ClientBase createTmpDir ClientBase setupTestEnv ZooKeeperServer zks ZooKeeperServer tmpDir tmpDir PORT Integer parseInt HOSTPORT split ServerCnxnFactory f ServerCnxnFactory createFactory PORT f startup zks assertTrue ClientBase waitForServerUp HOSTPORT CONNECTION_TIMEOUT ZooKeeper zk ClientBase createZKClient HOSTPORT i i i zk create i data Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk close numSnaps zks getTxnLogFactory findNRecentSnapshots minExpectedSnapshots size
i i i zk create i data Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT zk close numSnaps zks getTxnLogFactory findNRecentSnapshots minExpectedSnapshots size LOG info numSnaps f shutdown zks shutdown assertTrue ClientBase waitForServerDown HOSTPORT CONNECTION_TIMEOUT assertTrue numSnaps minExpectedSnapshots assertTrue numSnaps minExpectedSnapshots zks ZooKeeperServer tmpDir tmpDir zks startdata Collection Proposal committedLog zks getZKDatabase getCommittedLog logsize committedLog size
File tmpDir createTmpDir saslConfFile File tmpDir PrintWriter saslConf PrintWriter FileWriter saslConfFile saslConf println saslConf println saslConf println saslConf println saslConf println saslConf println saslConf println saslConf println saslConf println saslConf close System setProperty Environment JAAS_CONF_KEY saslConfFile getAbsolutePath
saslConf println saslConf println saslConf println saslConf println saslConf println saslConf println saslConf println saslConf println saslConf println saslConf println keytabFileForKerberosPrincipals getAbsolutePath saslConf println KerberosTestUtils getClientPrincipal saslConf println saslConf close System setProperty Environment JAAS_CONF_KEY saslConfFile getAbsolutePath
String cmd String String resp sendRequest cmd
host port LOG info host port Socket sock Socket host port BufferedReader reader
DisconnectableZooKeeper zk createClient zk create Ids OPEN_ACL_UNSAFE CreateMode EPHEMERAL
DisconnectableZooKeeper zk createClient zk create Ids OPEN_ACL_UNSAFE CreateMode EPHEMERAL LOG info Long toHexString zk getSessionId zk disconnect Stat stat Stat startSignal CountDownLatch zk DisconnectableZooKeeper HOSTPORT CONNECTION_TIMEOUT MyWatcher zk getSessionId zk getSessionPasswd startSignal await
DisconnectableZooKeeper zk createClient zk create Ids OPEN_ACL_UNSAFE CreateMode EPHEMERAL LOG info Long toHexString zk getSessionId zk disconnect Stat stat Stat startSignal CountDownLatch zk DisconnectableZooKeeper HOSTPORT CONNECTION_TIMEOUT MyWatcher zk getSessionId zk getSessionPasswd startSignal await LOG info Long toHexString zk getSessionId zk getData stat LOG info zk close zk createClient assertEquals zk exists
DisconnectableZooKeeper zk createClient TICK_TIME assertEquals TICK_TIME zk getSessionTimeout
DisconnectableZooKeeper zk createClient TICK_TIME assertEquals TICK_TIME zk getSessionTimeout LOG info zk toString zk close
DisconnectableZooKeeper zk createClient TICK_TIME assertEquals TICK_TIME zk getSessionTimeout LOG info zk toString zk close LOG info zk toString zk createClient TICK_TIME assertEquals TICK_TIME zk getSessionTimeout
DisconnectableZooKeeper zk createClient TICK_TIME assertEquals TICK_TIME zk getSessionTimeout LOG info zk toString zk close LOG info zk toString zk createClient TICK_TIME assertEquals TICK_TIME zk getSessionTimeout LOG info zk toString zk close
DisconnectableZooKeeper zk createClient TICK_TIME assertEquals TICK_TIME zk getSessionTimeout LOG info zk toString zk close LOG info zk toString zk createClient TICK_TIME assertEquals TICK_TIME zk getSessionTimeout LOG info zk toString zk close LOG info zk toString zk createClient TICK_TIME assertEquals TICK_TIME zk getSessionTimeout
DisconnectableZooKeeper zk createClient TICK_TIME assertEquals TICK_TIME zk getSessionTimeout LOG info zk toString zk close LOG info zk toString zk createClient TICK_TIME assertEquals TICK_TIME zk getSessionTimeout LOG info zk toString zk close LOG info zk toString zk createClient TICK_TIME assertEquals TICK_TIME zk getSessionTimeout LOG info zk toString zk close
MINSESS MAXSESS ZooKeeperServer zs serverFactory getZooKeeperServer zs setMinSessionTimeout MINSESS zs setMaxSessionTimeout MAXSESS timeout DisconnectableZooKeeper zk createClient timeout assertEquals timeout zk getSessionTimeout LOG info zk toString zk close LOG info zk toString zk createClient MINSESS assertEquals MINSESS zk getSessionTimeout LOG info zk toString zk close
ZooKeeperServer zs serverFactory getZooKeeperServer zs setMinSessionTimeout MINSESS zs setMaxSessionTimeout MAXSESS timeout DisconnectableZooKeeper zk createClient timeout assertEquals timeout zk getSessionTimeout LOG info zk toString zk close LOG info zk toString zk createClient MINSESS assertEquals MINSESS zk getSessionTimeout LOG info zk toString zk close LOG info zk toString zk createClient MAXSESS
zs setMaxSessionTimeout MAXSESS timeout DisconnectableZooKeeper zk createClient timeout assertEquals timeout zk getSessionTimeout LOG info zk toString zk close LOG info zk toString zk createClient MINSESS assertEquals MINSESS zk getSessionTimeout LOG info zk toString zk close LOG info zk toString zk createClient MAXSESS assertEquals MAXSESS zk getSessionTimeout LOG info zk toString
