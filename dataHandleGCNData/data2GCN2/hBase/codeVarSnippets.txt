SaslDataTransferClient saslClient client getSaslDataTransferClient SaslPropertiesResolver saslPropsResolver SASL_ADAPTOR getSaslPropsResolver saslClient TrustedChannelResolver trustedChannelResolver SASL_ADAPTOR getTrustedChannelResolver saslClient AtomicBoolean fallbackToSimpleAuth SASL_ADAPTOR getFallbackToSimpleAuth saslClient InetAddress addr InetSocketAddress channel remoteAddress getAddress trustedChannelResolver trustedChannelResolver addr saslPromise trySuccess DataEncryptionKey encryptionKey client newDataEncryptionKey encryptionKey LOG LOG debug addr dnInfo doSaslNegotiation conf channel timeoutMs getUserNameFromEncryptionKey encryptionKey encryptionKeyToPassword encryptionKey encryptionKey createSaslPropertiesForEncryption encryptionKey encryptionAlgorithm saslPromise client LOG
InetAddress addr InetSocketAddress channel remoteAddress getAddress addr saslPromise trySuccess DataEncryptionKey encryptionKey client newDataEncryptionKey encryptionKey LOG LOG debug addr dnInfo doSaslNegotiation conf channel timeoutMs getUserNameFromEncryptionKey encryptionKey encryptionKeyToPassword encryptionKey encryptionKey createSaslPropertiesForEncryption encryptionKey encryptionAlgorithm saslPromise client LOG LOG debug addr dnInfo saslPromise trySuccess dnInfo LOG
DataEncryptionKey encryptionKey client newDataEncryptionKey encryptionKey LOG LOG debug addr dnInfo doSaslNegotiation conf channel timeoutMs getUserNameFromEncryptionKey encryptionKey encryptionKeyToPassword encryptionKey encryptionKey createSaslPropertiesForEncryption encryptionKey encryptionAlgorithm saslPromise client LOG LOG debug addr dnInfo saslPromise trySuccess dnInfo LOG LOG debug addr dnInfo saslPromise trySuccess LOG
LOG debug addr dnInfo doSaslNegotiation conf channel timeoutMs getUserNameFromEncryptionKey encryptionKey encryptionKeyToPassword encryptionKey encryptionKey createSaslPropertiesForEncryption encryptionKey encryptionAlgorithm saslPromise client LOG LOG debug addr dnInfo saslPromise trySuccess dnInfo LOG LOG debug addr dnInfo saslPromise trySuccess LOG LOG debug addr dnInfo saslPromise trySuccess
LOG LOG debug addr dnInfo saslPromise trySuccess dnInfo LOG LOG debug addr dnInfo saslPromise trySuccess LOG LOG debug addr dnInfo saslPromise trySuccess LOG LOG debug addr dnInfo
recoverLease dfs p recovered recovered dfs recoverLease p
String String relPath String property String path UTIL getDataTestDir relPath toString System setProperty property path UTIL getConfiguration set property path File path mkdirs
conf put MiniKdc DEBUG MiniKdc kdc File dir bindException numTries bindException dir File UTIL getDataTestDir toUri getPath kdc MiniKdc conf dir kdc start FileUtils deleteDirectory dir numTries numTries
args Objects requireNonNull conf CommandLine cmd cmd parseArgs args cmdLineArgs args e System err println e getMessage printToolUsage EXIT_FAILURE processOptions cmd ret EXIT_FAILURE ret doWork e
files files tbl fullyBackedUpTables tbl getTablesForBackupType BackupType FULL ioe LOG error ioe Collections emptyList Collections sort fullyBackedUpTables Set String hfileRefs hfileRefs loadHFileRefs fullyBackedUpTables ioe
finalPaths LOG debug tbl List TableName fullyBackedUpTables tbl getTablesForBackupType BackupType FULL RegionInfo info ctx getEnvironment getRegionInfo TableName tableName info getTable fullyBackedUpTables tableName LOG LOG trace tableName tbl writePathsPostBulkLoad tableName info getEncodedNameAsBytes finalPaths
conn conf conn cmd OPTION_SET String setName cmd getOptionValue OPTION_SET tables getTablesForSet conn setName conf e System out println e getMessage setName printToolUsage tables System out println setName printToolUsage tables cmd getOptionValue OPTION_TABLE
cmd parseArgs args cmdLineArgs args e System out println e getMessage printToolUsage EXIT_FAILURE cmd cmd printToolUsage EXIT_FAILURE processOptions cmd ret EXIT_FAILURE ret doWork e
backupId sysTable BackupInfo backupInfo sysTable readBackupInfo backupId totalDeleted backupInfo
isLastBackupSession isLastBackupSession sysTable tn startTime isLastBackupSession List BackupInfo affectedBackups getAffectedBackupSessions backupInfo tn sysTable BackupInfo info affectedBackups info backupInfo removeTableFromBackupImage info tn sysTable Map String map sysTable readBulkLoadedFiles backupId FileSystem fs FileSystem get conn getConfiguration success numDeleted String f map Path p Path f
Map String map sysTable readBulkLoadedFiles backupId FileSystem fs FileSystem get conn getConfiguration success numDeleted String f map Path p Path f LOG debug p backupInfo getBackupId fs p fs p LOG warn f success numDeleted
numDeleted f Path p Path f LOG debug p backupInfo getBackupId p p LOG warn f success numDeleted ioe LOG warn f ioe success LOG
info TableName List TableName tables info getTableNames
info TableName tn List TableName tables info getTableNames LOG debug tn info getBackupId info getTableListAsString tables tn tables remove tn tables
removeFromBackupSet name tables LOG info StringUtils join tables name table table removeFromBackupSet name toStringArray tables
conf String plugins conf get HConstants HBASE_MASTER_LOGCLEANER_PLUGINS String cleanerClass BackupLogCleaner getCanonicalName plugins cleanerClass conf set HConstants HBASE_MASTER_LOGCLEANER_PLUGINS plugins cleanerClass String classes conf get ProcedureManagerHost MASTER_PROCEDURE_CONF_KEY String masterProcedureClass LogRollMasterProcedureManager getName classes conf set ProcedureManagerHost MASTER_PROCEDURE_CONF_KEY masterProcedureClass classes masterProcedureClass conf set ProcedureManagerHost MASTER_PROCEDURE_CONF_KEY classes masterProcedureClass plugins conf get HFileCleaner MASTER_HFILE_CLEANER_PLUGINS conf set HFileCleaner MASTER_HFILE_CLEANER_PLUGINS plugins plugins BackupHFileCleaner getName
tableList tableList List TableDescriptor htds admin htds admin listTableDescriptors e BackupException e htds BackupException tableList ArrayList TableDescriptor hTableDescriptor htds TableName tn hTableDescriptor getTableName tn getTableName tableList add hTableDescriptor getTableName
String ongoingBackupId getOngoingBackupId ongoingBackupId
ArrayList BackupImage ancestors ArrayList getType LOG debug ancestors ArrayList BackupInfo allHistoryList getBackupHistory BackupInfo backup allHistoryList BackupImage Builder builder BackupImage newBuilder BackupImage image builder withBackupId backup getBackupId withType backup getType withRootDir backup getBackupRootDir withTableList backup getTableNames withStartTime backup getStartTs withCompleteTime backup getCompleteTs build backup getType ancestors image ancestors add image ancestors image LOG debug BackupImage ancestors
ancestors ArrayList BackupInfo allHistoryList getBackupHistory BackupInfo backup allHistoryList BackupImage Builder builder BackupImage newBuilder BackupImage image builder withBackupId backup getBackupId withType backup getType withRootDir backup getBackupRootDir withTableList backup getTableNames withStartTime backup getStartTs withCompleteTime backup getCompleteTs build backup getType ancestors image ancestors add image ancestors image LOG debug BackupImage image1 ancestors LOG debug image1 getBackupId image1 getRootDir Path logBackupPath HBackupFileSystem getBackupPath backup getBackupRootDir backup getBackupId
BackupImage Builder builder BackupImage newBuilder BackupImage image builder withBackupId backup getBackupId withType backup getType withRootDir backup getBackupRootDir withTableList backup getTableNames withStartTime backup getStartTs withCompleteTime backup getCompleteTs build backup getType BackupManifest ancestors image ancestors add image BackupManifest ancestors image LOG debug BackupImage image1 ancestors LOG debug image1 getBackupId image1 getRootDir Path logBackupPath HBackupFileSystem getBackupPath backup getBackupRootDir backup getBackupId LOG debug logBackupPath toString BackupManifest lastIncrImgManifest BackupManifest conf logBackupPath BackupImage lastIncrImage lastIncrImgManifest getBackupImage
backup BackupManifest ancestors image ancestors add image BackupManifest ancestors image LOG debug BackupImage image1 ancestors LOG debug image1 getBackupId image1 getRootDir Path logBackupPath HBackupFileSystem getBackupPath backup getBackupRootDir backup getBackupId LOG debug logBackupPath toString BackupManifest lastIncrImgManifest BackupManifest conf logBackupPath BackupImage lastIncrImage lastIncrImgManifest getBackupImage ancestors add lastIncrImage LOG debug lastIncrImage getBackupId lastIncrImage getRootDir
fam CellUtil cloneValue cell CellUtil cell path Bytes toString CellUtil cloneValue cell srcIdx IncrementalTableBackupClient getIndex tbl sTableList srcIdx mapForSrc srcIdx mapForSrc srcIdx TreeMap Bytes BYTES_COMPARATOR List Path files mapForSrc srcIdx fam files ArrayList Path mapForSrc srcIdx put fam files files mapForSrc srcIdx get fam files add Path path
List List Delete lstDels ArrayList row Delete del Delete row lstDels add del
path Bytes toString CellUtil cloneValue cell CellUtil cell state CellUtil cloneValue cell Bytes state raw raw map get tTable map put tTable HashMap tblMap map get tTable tblMap get region tblMap put region HashMap Map String List Pair String Boolean famMap tblMap get region famMap get fam famMap put fam ArrayList
table Get get createGetForBackupSet name Result res table get get res LOG warn name res advance tables cellValueToBackupSet res current disjoint disjoin tables toRemove disjoint disjoint tables Put put createPutForBackupSet name disjoint table put put disjoint tables LOG warn name StringUtils join toRemove
List Put table region List List Put puts ArrayList List entry path entry String file path toString lastSlash file lastIndexOf String filename file substring lastSlash Put put Put rowkey BULK_LOAD_PREFIX table toString BLK_LD_DELIM Bytes toString region BLK_LD_DELIM filename put addColumn BackupSystemTable META_FAMILY TBL_COL table getName put addColumn BackupSystemTable META_FAMILY FAM_COL entry getKey put addColumn BackupSystemTable META_FAMILY PATH_COL Bytes toBytes file put addColumn BackupSystemTable META_FAMILY STATE_COL BL_COMMIT puts add put
conn Configuration conf conn getConfiguration
conn Configuration conf conn getConfiguration
List Put table region family List Path Path pairs List Put puts ArrayList pairs size Path Path pair pairs Path path pair getSecond String file path toString lastSlash file lastIndexOf String filename file substring lastSlash Put put Put rowkey BULK_LOAD_PREFIX table toString BLK_LD_DELIM Bytes toString region BLK_LD_DELIM filename put addColumn BackupSystemTable META_FAMILY TBL_COL table getName put addColumn BackupSystemTable META_FAMILY FAM_COL family put addColumn BackupSystemTable META_FAMILY PATH_COL Bytes toBytes file put addColumn BackupSystemTable META_FAMILY STATE_COL BL_PREPARE puts add put
backupInfo LOG info backupInfo setPhase BackupPhase SNAPSHOTCOPY BackupCopyJob copyService BackupRestoreFactory getBackupCopyJob conf numOfSnapshots backupInfo getSnapshotNames size LOG debug numOfSnapshots table backupInfo res String args String args args backupInfo getSnapshotName table args args backupInfo getTableBackupDir table String jobname backupInfo getBackupId table getNameAsString LOG
LOG debug numOfSnapshots table backupInfo res String args String args args backupInfo getSnapshotName table args args backupInfo getTableBackupDir table String jobname backupInfo getBackupId table getNameAsString LOG LOG debug jobname conf set JOB_NAME_CONF_KEY jobname LOG debug args args res copyService copy backupInfo backupManager conf BackupType FULL args res
HashMap String Long List String logList HashMap String Long newTimestamps HashMap String Long previousTimestampMins String savedStartCode readBackupStartCode HashMap TableName HashMap String Long previousTimestampMap readLogTimestampMap previousTimestampMins BackupUtils getRSLogTimestampMins previousTimestampMap
List String List String logList HashMap String Long newTimestamps HashMap String Long previousTimestampMins String savedStartCode readBackupStartCode HashMap TableName HashMap String Long previousTimestampMap readLogTimestampMap previousTimestampMins BackupUtils getRSLogTimestampMins previousTimestampMap
currentLogFile log getPath toString resultLogFiles add currentLogFile currentLogTS BackupUtils getCreationTime log getPath Long ts newestTimestamps get host ts LOG warn log host LOG debug s newestTimestamps LOG debug s ts currentLogTS ts newestLogs add currentLogFile FileStatus oldlogs fs listStatus oldLogDir FileStatus oldlog oldlogs p oldlog getPath
Path archiveDir HFileArchiveUtil getStoreArchivePath conf srcTable regionName fam String tblName srcTable getQualifierAsString Path tgtFam Path Path tgtTable regionName fam tgtFam IOException tgtFam String fileWithState String file fileWithState getFirst idx file lastIndexOf String filename file idx filename file substring idx Path p Path famDir filename Path tgt Path tgtFam filename Path archive Path archiveDir filename p
beginBackup backupManager backupInfo backupInfo setPhase BackupPhase PREPARE_INCREMENTAL
String files String backupDest LOG debug backupDest backupInfo setPhase BackupPhase INCREMENTAL_COPY String strArr String files length System arraycopy files strArr files length strArr strArr length backupDest String jobname backupInfo getBackupId LOG
tableName tableName existTableList add tableName tableName disabledTableList add tableName LOG info tableName existTableList LOG error existTableList IOException disabledTableList LOG error
BackupImage images sTable BackupImage image images String rootDir image getRootDir String backupId image getBackupId Path backupRoot Path rootDir RestoreTool restoreTool RestoreTool conf backupRoot backupId Path tableBackupPath HBackupFileSystem getTableBackupPath sTable backupRoot backupId String lastIncrBackupId images length images images length getBackupId BackupManifest manifest HBackupFileSystem getManifest conf backupRoot backupId manifest
LOG info sTable tTable tableBackupPath toString conf set JOB_NAME_CONF_KEY backupId tTable restoreTool fullRestoreTable conn tableBackupPath sTable tTable truncateIfExists lastIncrBackupId conf unset JOB_NAME_CONF_KEY IOException image getType images List Path dirList ArrayList i i images i BackupImage im images i String fileBackupDir HBackupFileSystem getTableBackupDir im getRootDir im getBackupId sTable List Path list getFilesRecursively fileBackupDir dirList addAll list String dirs StringUtils join dirList
IOException image getType images List Path dirList ArrayList i i images i BackupImage im images i String fileBackupDir HBackupFileSystem getTableBackupDir im getRootDir im getBackupId sTable List Path list getFilesRecursively fileBackupDir dirList addAll list String dirs StringUtils join dirList LOG info sTable tTable dirs Path paths Path dirList size dirList toArray paths conf set JOB_NAME_CONF_KEY backupId tTable
i i sTableArray i TableName table sTableArray i BackupManifest manifest backupManifestMap get table List BackupImage list ArrayList list add manifest getBackupImage TreeSet BackupImage set TreeSet list List BackupImage depList manifest getDependentListByTable table set addAll depList BackupImage arr BackupImage set size set toArray arr restoreImages arr table tTableArray i isOverwrite restoreImageSet addAll list restoreImageSet restoreImageSet LOG info BackupImage restoreImageSet
backupManager backupInfo BackupSystemTable snapshot conn backupManager setBackupInfo backupInfo startTs EnvironmentEdgeManager currentTime backupInfo setStartTs startTs backupInfo setState BackupState RUNNING backupInfo setPhase BackupPhase REQUEST
backupManager backupInfo BackupSystemTable snapshot conn backupManager setBackupInfo backupInfo startTs EnvironmentEdgeManager currentTime backupInfo setStartTs startTs backupInfo setState BackupState RUNNING backupInfo setPhase BackupPhase REQUEST LOG info backupInfo getBackupId startTs backupManager updateBackupInfo backupInfo LOG
backupInfo conf LOG debug backupInfo getPhase backupInfo getPhase backupInfo getPhase backupInfo getPhase FileSystem outputFs FileSystem get Path backupInfo getBackupRootDir toUri conf table backupInfo Path targetDirPath Path HBackupFileSystem getTableBackupDir backupInfo getBackupRootDir backupInfo getBackupId table outputFs targetDirPath
backupInfo conf LOG debug backupInfo getPhase backupInfo getPhase backupInfo getPhase backupInfo getPhase FileSystem outputFs FileSystem get Path backupInfo getBackupRootDir toUri conf table backupInfo Path targetDirPath Path HBackupFileSystem getTableBackupDir backupInfo getBackupRootDir backupInfo getBackupId table outputFs delete targetDirPath LOG debug targetDirPath toString LOG debug targetDirPath toString Path tableDir targetDirPath getParent FileStatus backups CommonFSUtils listStatus outputFs tableDir backups backups outputFs delete tableDir
LOG debug backupInfo getPhase backupInfo getPhase backupInfo getPhase backupInfo getPhase FileSystem outputFs FileSystem get Path backupInfo getBackupRootDir toUri conf table backupInfo Path targetDirPath Path HBackupFileSystem getTableBackupDir backupInfo getBackupRootDir backupInfo getBackupId table outputFs delete targetDirPath LOG debug targetDirPath toString LOG debug targetDirPath toString Path tableDir targetDirPath getParent FileStatus backups CommonFSUtils listStatus outputFs tableDir backups backups outputFs delete tableDir LOG debug tableDir toString
backupInfo e String msg LOG error msg getMessage e e backupInfo setCompleteTs EnvironmentEdgeManager currentTime backupInfo setFailedMsg e getMessage backupInfo setState BackupState FAILED String backupFailedData backupInfo getBackupId backupInfo getStartTs backupInfo getCompleteTs backupInfo getPhase backupInfo getFailedMsg
conn backupInfo backupManager e String msg conf LOG error msg getMessage e e backupInfo setCompleteTs EnvironmentEdgeManager currentTime backupInfo setFailedMsg e getMessage backupInfo setState BackupState FAILED String backupFailedData backupInfo getBackupId backupInfo getStartTs backupInfo getCompleteTs backupInfo getPhase backupInfo getFailedMsg LOG error backupFailedData cleanupAndRestoreBackupSystem conn backupInfo conf backupManager updateBackupInfo backupInfo backupManager finishBackupSession
backupInfo backupManager type conf backupInfo setCompleteTs EnvironmentEdgeManager currentTime backupInfo setState BackupState COMPLETE backupInfo setProgress addManifest backupInfo backupManager type conf String backupCompleteData obtainBackupMetaDataStr backupInfo backupInfo getStartTs backupInfo getCompleteTs backupInfo getTotalBytesCopied
backupInfo setCompleteTs EnvironmentEdgeManager currentTime backupInfo setState BackupState COMPLETE backupInfo setProgress addManifest backupInfo backupManager type conf String backupCompleteData obtainBackupMetaDataStr backupInfo backupInfo getStartTs backupInfo getCompleteTs backupInfo getTotalBytesCopied LOG LOG debug backupInfo getBackupId backupCompleteData type deleteSnapshots conn backupInfo conf cleanupExportSnapshotLog conf type cleanupDistCpLog backupInfo conf BackupSystemTable deleteSnapshot conn backupManager updateBackupInfo backupInfo backupManager finishBackupSession
backupInfo backupManager newProgress String backupProgressData newProgress backupInfo setProgress newProgress backupManager updateBackupInfo backupInfo
jobId JobID id JobID forName jobId Cluster cluster Cluster getConf Job job cluster getJob id job
String backupIds String bulkOutputConfKey player MapReduceHFileSplitterJob bulkOutputConfKey MapReduceHFileSplitterJob BULK_OUTPUT_CONF_KEY String bids StringUtils join backupIds
i i tableNames i LOG info tableNames i Path dirPaths findInputDirectories fs backupRoot tableNames i backupIds String dirs StringUtils join dirPaths Path bulkOutputPath BackupUtils getBulkOutputDir BackupUtils getFileNameCompatibleString tableNames i getConf fs bulkOutputPath fs bulkOutputPath LOG warn bulkOutputPath Configuration conf getConf conf set bulkOutputConfKey bulkOutputPath toString String playerArgs dirs tableNames i getNameAsString player setConf getConf result player run playerArgs result IOException dirs result
Configuration conf getConf conf set bulkOutputConfKey bulkOutputPath toString String playerArgs dirs tableNames i getNameAsString player setConf getConf result player run playerArgs result IOException dirs result processedTableList add Pair tableNames i bulkOutputPath LOG debug result List TableName tableList toTableNameList processedTableList table updateProcessedTablesForMerge tableList finishedTables Path tmpBackupDir HBackupFileSystem getBackupTmpDirPathForBackupId backupRoot mergedBackupId Path backupDirPath HBackupFileSystem getBackupPath backupRoot mergedBackupId backupDirPath tmpBackupDir
Job String args Configuration conf getConf String inputDirs args String tabName args conf setStrings TABLES_KEY tabName conf set FileInputFormat INPUT_DIR inputDirs Job job Job getInstance conf conf get JOB_NAME_CONF_KEY NAME EnvironmentEdgeManager currentTime job setJarByClass MapReduceHFileSplitterJob job setInputFormatClass HFileInputFormat job setMapOutputKeyClass ImmutableBytesWritable String hfileOutPath conf get BULK_OUTPUT_CONF_KEY hfileOutPath
dirPaths String bulkOutputConfKey player MapReduceHFileSplitterJob bulkOutputConfKey MapReduceHFileSplitterJob BULK_OUTPUT_CONF_KEY String dirs StringUtils join dirPaths
LOG LOG debug fullBackupRestore dirs StringUtils join tableNames BackupRestoreConstants TABLENAME_DELIMITER_IN_COMMAND StringUtils join newTableNames BackupRestoreConstants TABLENAME_DELIMITER_IN_COMMAND i i tableNames i LOG info tableNames i newTableNames i Path bulkOutputPath BackupUtils getBulkOutputDir BackupUtils getFileNameCompatibleString newTableNames i getConf Configuration conf getConf conf set bulkOutputConfKey bulkOutputPath toString String playerArgs dirs fullBackupRestore newTableNames i getNameAsString tableNames i getNameAsString result player setConf getConf result player run playerArgs result BulkLoadHFiles loader BackupUtils createLoader getConf LOG
Configuration conf getConf conf set bulkOutputConfKey bulkOutputPath toString String playerArgs dirs fullBackupRestore newTableNames i getNameAsString tableNames i getNameAsString result player setConf getConf result player run playerArgs result BulkLoadHFiles loader BackupUtils createLoader getConf LOG LOG debug bulkOutputPath loader newTableNames i bulkOutputPath IOException dirs IOException dirs result
table table LOG trace files tnfe LOG warn tnfe getMessage files List FileStatus list ArrayList Map FileStatus Boolean walFilesDeletableMap table areWALFilesDeletable files Map FileStatus Boolean entry walFilesDeletableMap FileStatus file entry getKey String wal file getPath toString deletable entry getValue deletable
table LOG trace files tnfe LOG warn tnfe getMessage files List FileStatus list ArrayList Map FileStatus Boolean walFilesDeletableMap table areWALFilesDeletable files Map FileStatus Boolean entry walFilesDeletableMap FileStatus file entry getKey String wal file getPath toString deletable entry getValue deletable LOG debug wal list add file
LOG warn BackupRestoreConstants BACKUP_ENABLE_KEY done ForeignExceptionDispatcher monitor ForeignExceptionDispatcher desc getInstance List ServerName serverNames master getServerManager getOnlineServersList List String servers ArrayList ServerName sn serverNames servers add sn toString List NameStringPair conf desc getConfigurationList data conf data Bytes toBytes conf get getValue Procedure proc coordinator startProcedure monitor desc getInstance data servers proc String msg desc getInstance
ForeignExceptionDispatcher monitor ForeignExceptionDispatcher desc getInstance List ServerName serverNames master getServerManager getOnlineServersList List String servers ArrayList ServerName sn serverNames servers add sn toString List NameStringPair conf desc getConfigurationList data conf data Bytes toBytes conf get getValue Procedure proc coordinator startProcedure monitor desc getInstance data servers proc String msg desc getInstance LOG error msg IOException msg
Path rootDir CommonFSUtils getRootDir conf FileSystem fs rootDir getFileSystem conf conn table backupInfo table LOG warn table TableDescriptor orig FSTableDescriptors getTableDescriptorFromFs fs rootDir table Path target Path backupInfo getTableBackupDir table FileSystem targetFs target getFileSystem conf FSTableDescriptors descriptors FSTableDescriptors targetFs CommonFSUtils getRootDir conf descriptors createTableDescriptorForTableDirectory target orig LOG debug table target orig LOG debug List RegionInfo regions MetaTableAccessor getTableRegions conn table
targetExists targetExists checkPathExist backupRootPath conf IOException e String expMsg e getMessage String newMsg expMsg newMsg expMsg LOG error newMsg IOException newMsg e targetExists LOG info backupRootPath
String targetDir backupInfo getBackupRootDir targetDir LOG warn backupInfo getBackupId FileSystem outputFs FileSystem get Path backupInfo getBackupRootDir toUri conf table backupInfo Path targetDirPath Path getTableBackupDir backupInfo getBackupRootDir backupInfo getBackupId table outputFs delete targetDirPath LOG info targetDirPath toString LOG info targetDirPath toString Path tableDir targetDirPath getParent FileStatus backups listStatus outputFs tableDir backups backups outputFs delete tableDir
FileSystem outputFs FileSystem get Path backupInfo getBackupRootDir toUri conf table backupInfo Path targetDirPath Path getTableBackupDir backupInfo getBackupRootDir backupInfo getBackupId table outputFs delete targetDirPath LOG info targetDirPath toString LOG info targetDirPath toString Path tableDir targetDirPath getParent FileStatus backups listStatus outputFs tableDir backups backups outputFs delete tableDir LOG debug tableDir toString outputFs delete Path targetDir backupInfo getBackupId
Path tableName Path baseDir Path HBackupFileSystem getTableBackupPath tableName backupRootPath backupId HConstants HFILE_ARCHIVE_DIRECTORY Path dataDir Path baseDir HConstants BASE_NAMESPACE_DIR Path archivePath Path dataDir tableName getNamespaceAsString Path tableArchivePath Path archivePath tableName getQualifierAsString tableArchivePath tableArchivePath
IOException tableName LOG debug tableDescriptor incrBackupId TableName newTableName newTableNames i TableDescriptor newTableDescriptor admin getDescriptor newTableName List ColumnFamilyDescriptor families Arrays asList tableDescriptor getColumnFamilies List ColumnFamilyDescriptor existingFamilies Arrays asList newTableDescriptor getColumnFamilies TableDescriptorBuilder builder TableDescriptorBuilder newBuilder newTableDescriptor schemaChangeNeeded ColumnFamilyDescriptor family families existingFamilies family builder setColumnFamily family schemaChangeNeeded ColumnFamilyDescriptor family existingFamilies families family builder removeColumnFamily family getName
TableDescriptor tableName Path tableInfoPath getTableInfoPath tableName SnapshotDescription desc SnapshotDescriptionUtils readSnapshotInfo fs tableInfoPath SnapshotManifest manifest SnapshotManifest open conf fs tableInfoPath desc TableDescriptor tableDescriptor manifest getTableDescriptor tableDescriptor tableName
Path tableSnapshotPath getTableSnapshotPath backupRootPath tableName backupId fileSys tableSnapshotPath snapshotMap tableName SnapshotDescription desc SnapshotDescriptionUtils readSnapshotInfo fileSys tableSnapshotPath SnapshotManifest manifest SnapshotManifest open conf fileSys tableSnapshotPath desc tableDescriptor manifest getTableDescriptor tableDescriptor getTableDesc tableName snapshotMap put tableName getTableInfoPath tableName tableDescriptor LOG debug IOException tableSnapshotPath Path tableArchivePath getTableArchivePath tableName tableArchivePath
TreeMap Integer map TreeMap Bytes BYTES_COMPARATOR
LOG warn pathName isIgnore isIgnore Path familyDir stat getPath LOG debug familyDir toString regionDir familyDir familyDir Path hfiles FileUtil stat2Paths fs listStatus familyDir Path hfile hfiles hfile hfile hfile hfile HFile Reader reader HFile createReader fs hfile conf first last
createNew
LOG info List TableName tables Lists newArrayList table3
LOG info List TableName tableList Lists newArrayList table1 String backupId fullTableBackup tableList assertTrue checkSucceeded backupId LOG info ByteArrayOutputStream baos ByteArrayOutputStream System setOut PrintStream baos String args String backupId ret ToolRunner run conf1 BackupDriver args assertTrue ret e LOG error e LOG info String output baos toString
EnvironmentEdgeManager System currentTimeMillis String backupId fullTableBackup tableList assertTrue checkSucceeded backupId EnvironmentEdgeManager reset LOG info ByteArrayOutputStream baos ByteArrayOutputStream System setOut PrintStream baos String args String ret ToolRunner run conf1 BackupDriver args assertTrue ret
String backupId fullTableBackup tableList assertTrue checkSucceeded backupId EnvironmentEdgeManager reset LOG info ByteArrayOutputStream baos ByteArrayOutputStream System setOut PrintStream baos String args String ret ToolRunner run conf1 BackupDriver args assertTrue ret e LOG error e Assert fail e getMessage String output baos toString
System setOut PrintStream baos String args String ret ToolRunner run conf1 BackupDriver args assertTrue ret e LOG error e Assert fail e getMessage String output baos toString LOG info baos toString assertTrue output indexOf args String baos reset ret ToolRunner run conf1 BackupDriver args
ret ToolRunner run conf1 BackupDriver args assertTrue ret e LOG error e Assert fail e getMessage String output baos toString LOG info baos toString assertTrue output indexOf args String baos reset ret ToolRunner run conf1 BackupDriver args assertTrue ret e LOG error e
LOG info String args String ret ToolRunner run conf1 BackupDriver args assertTrue ret ByteArrayOutputStream baos ByteArrayOutputStream System setErr PrintStream baos args String ToolRunner run TEST_UTIL getConfiguration BackupDriver args String output baos toString
ADD_ROWS LOG info List TableName tables Lists newArrayList table1 table2 Connection conn ConnectionFactory createConnection conf1 Admin admin conn getAdmin BackupAdminImpl client BackupAdminImpl conn BackupRequest request createBackupRequest BackupType FULL tables BACKUP_ROOT_DIR String backupIdFull client backupTables request assertTrue checkSucceeded backupIdFull Table t1 insertIntoTable conn table1 famName ADD_ROWS
ADD_ROWS LOG info List TableName tables Lists newArrayList table1 table2 Connection conn ConnectionFactory createConnection conf1 Admin admin conn getAdmin BackupAdminImpl client BackupAdminImpl conn BackupRequest request createBackupRequest BackupType FULL tables BACKUP_ROOT_DIR String backupIdFull client backupTables request assertTrue checkSucceeded backupIdFull Table t1 insertIntoTable conn table1 famName ADD_ROWS LOG debug ADD_ROWS table1 Assert assertEquals TEST_UTIL countRows t1 NB_ROWS_IN_BATCH ADD_ROWS t1 close
List TableName tables Lists newArrayList table1 table2 Connection conn ConnectionFactory createConnection conf1 Admin admin conn getAdmin BackupAdminImpl client BackupAdminImpl conn BackupRequest request createBackupRequest BackupType FULL tables BACKUP_ROOT_DIR String backupIdFull client backupTables request assertTrue checkSucceeded backupIdFull Table t1 insertIntoTable conn table1 famName ADD_ROWS LOG debug ADD_ROWS table1 Assert assertEquals TEST_UTIL countRows t1 NB_ROWS_IN_BATCH ADD_ROWS t1 close LOG debug ADD_ROWS table1 Table t2 insertIntoTable conn table2 famName ADD_ROWS Assert assertEquals TEST_UTIL countRows t2 NB_ROWS_IN_BATCH ADD_ROWS t2 close
assertTrue checkSucceeded backupIdIncMultiple t1 insertIntoTable conn table1 famName ADD_ROWS t1 close t2 insertIntoTable conn table2 famName ADD_ROWS t2 close request createBackupRequest BackupType INCREMENTAL tables BACKUP_ROOT_DIR String backupIdIncMultiple2 client backupTables request assertTrue checkSucceeded backupIdIncMultiple2 bAdmin conn String backups String backupIdIncMultiple backupIdIncMultiple2 bAdmin mergeBackups backups TableName tablesRestoreIncMultiple TableName table1 table2 TableName tablesMapIncMultiple TableName table1_restore table2_restore client restore BackupUtils createRestoreRequest BACKUP_ROOT_DIR backupIdIncMultiple2 tablesRestoreIncMultiple tablesMapIncMultiple Table hTable conn getTable table1_restore
t1 close t2 insertIntoTable conn table2 famName ADD_ROWS t2 close request createBackupRequest BackupType INCREMENTAL tables BACKUP_ROOT_DIR String backupIdIncMultiple2 client backupTables request assertTrue checkSucceeded backupIdIncMultiple2 bAdmin conn String backups String backupIdIncMultiple backupIdIncMultiple2 bAdmin mergeBackups backups TableName tablesRestoreIncMultiple TableName table1 table2 TableName tablesMapIncMultiple TableName table1_restore table2_restore client restore BackupUtils createRestoreRequest BACKUP_ROOT_DIR backupIdIncMultiple2 tablesRestoreIncMultiple tablesMapIncMultiple Table hTable conn getTable table1_restore LOG debug hTable getDescriptor countRows TEST_UTIL countRows hTable famName
autoRestoreOnFailure conf1 set TableBackupClient BACKUP_CLIENT_IMPL_CLASS FullTableBackupClientForTest getName maxStage Stage values length maxStage
String backupId fullTableBackup tableList assertTrue checkSucceeded backupId LOG info List BackupInfo history getBackupAdmin getHistory assertTrue findBackup history backupId BackupInfo Filter nullFilter info history BackupUtils getHistory conf1 Path BACKUP_ROOT_DIR nullFilter assertTrue findBackup history backupId ByteArrayOutputStream baos ByteArrayOutputStream System setOut PrintStream baos String args String BACKUP_ROOT_DIR ret ToolRunner run conf1 BackupDriver args assertTrue ret LOG info String output baos toString
history BackupUtils getHistory conf1 Path BACKUP_ROOT_DIR nullFilter assertTrue findBackup history backupId ByteArrayOutputStream baos ByteArrayOutputStream System setOut PrintStream baos String args String BACKUP_ROOT_DIR ret ToolRunner run conf1 BackupDriver args assertTrue ret LOG info String output baos toString LOG info output baos close assertTrue output indexOf backupId tableList Lists newArrayList table2 String backupId2 fullTableBackup tableList assertTrue checkSucceeded backupId2
LOG info List TableName tableList Lists newArrayList table1 String backupId fullTableBackup tableList LOG info assertTrue checkSucceeded backupId BackupInfo info getBackupAdmin getBackupInfo backupId assertTrue info getState BackupState COMPLETE
String fooGroupName UserGroupInformation ugi UserGroupInformation createUserForTesting fooUserName String fooGroupName ugi fs conf fs getHomeDirectory ioe LOG error ioe ugi BackupUtils getBulkOutputDir conf ioe
conf1 set TableBackupClient BACKUP_CLIENT_IMPL_CLASS FullTableBackupClientForTest getName maxStage Stage values length maxStage
List TableName tables Lists newArrayList table1 table2 fam3Name Bytes toBytes mobName Bytes toBytes TableDescriptor newTable1Desc TableDescriptorBuilder newBuilder table1Desc setColumnFamily ColumnFamilyDescriptorBuilder of fam3Name setColumnFamily ColumnFamilyDescriptorBuilder newBuilder mobName setMobEnabled setMobThreshold build build TEST_UTIL getAdmin modifyTable newTable1Desc conn NB_ROWS_FAM3 insertIntoTable conn table1 fam3Name NB_ROWS_FAM3 close insertIntoTable conn table1 mobName NB_ROWS_FAM3 close Admin admin conn getAdmin BackupAdminImpl client BackupAdminImpl conn BackupRequest request createBackupRequest BackupType FULL tables BACKUP_ROOT_DIR String backupIdFull client backupTables request assertTrue checkSucceeded backupIdFull Table t1 insertIntoTable conn table1 famName ADD_ROWS
mobName Bytes toBytes TableDescriptor newTable1Desc TableDescriptorBuilder newBuilder table1Desc setColumnFamily ColumnFamilyDescriptorBuilder of fam3Name setColumnFamily ColumnFamilyDescriptorBuilder newBuilder mobName setMobEnabled setMobThreshold build build TEST_UTIL getAdmin modifyTable newTable1Desc conn NB_ROWS_FAM3 insertIntoTable conn table1 fam3Name NB_ROWS_FAM3 close insertIntoTable conn table1 mobName NB_ROWS_FAM3 close Admin admin conn getAdmin BackupAdminImpl client BackupAdminImpl conn BackupRequest request createBackupRequest BackupType FULL tables BACKUP_ROOT_DIR String backupIdFull client backupTables request assertTrue checkSucceeded backupIdFull Table t1 insertIntoTable conn table1 famName ADD_ROWS LOG debug ADD_ROWS table1 Assert assertEquals HBaseTestingUtility countRows t1 NB_ROWS_IN_BATCH ADD_ROWS NB_ROWS_FAM3
conn NB_ROWS_FAM3 insertIntoTable conn table1 fam3Name NB_ROWS_FAM3 close insertIntoTable conn table1 mobName NB_ROWS_FAM3 close Admin admin conn getAdmin BackupAdminImpl client BackupAdminImpl conn BackupRequest request createBackupRequest BackupType FULL tables BACKUP_ROOT_DIR String backupIdFull client backupTables request assertTrue checkSucceeded backupIdFull Table t1 insertIntoTable conn table1 famName ADD_ROWS LOG debug ADD_ROWS table1 Assert assertEquals HBaseTestingUtility countRows t1 NB_ROWS_IN_BATCH ADD_ROWS NB_ROWS_FAM3 LOG debug ADD_ROWS table1 NB_ROWS_MOB insertIntoTable conn table1 mobName NB_ROWS_MOB
Assert assertEquals HBaseTestingUtility countRows t1 NB_ROWS_IN_BATCH ADD_ROWS NB_ROWS_FAM3 LOG debug ADD_ROWS table1 NB_ROWS_MOB insertIntoTable conn table1 mobName NB_ROWS_MOB LOG debug NB_ROWS_MOB table1 t1 close Assert assertEquals HBaseTestingUtility countRows t1 NB_ROWS_IN_BATCH ADD_ROWS NB_ROWS_MOB Table t2 conn getTable table2 Put p2 i i i p2 Put Bytes toBytes i p2 addColumn famName qualName Bytes toBytes i t2 put p2 Assert assertEquals NB_ROWS_IN_BATCH HBaseTestingUtility countRows t2 t2 close
Put p2 i i i p2 Put Bytes toBytes i p2 addColumn famName qualName Bytes toBytes i t2 put p2 Assert assertEquals NB_ROWS_IN_BATCH HBaseTestingUtility countRows t2 t2 close LOG debug table2 MiniHBaseCluster cluster TEST_UTIL getHBaseCluster List HRegion regions cluster getRegions table1 name regions get getRegionInfo getRegionName startSplitTime EnvironmentEdgeManager currentTime admin splitRegionAsync name get
assertTrue checkSucceeded backupIdIncMultiple2 TableName tablesRestoreFull TableName table1 table2 TableName tablesMapFull TableName table1_restore table2_restore LOG debug backupIdFull client restore BackupUtils createRestoreRequest BACKUP_ROOT_DIR backupIdFull tablesRestoreFull tablesMapFull Admin hAdmin TEST_UTIL getAdmin assertTrue hAdmin tableExists table1_restore assertTrue hAdmin tableExists table2_restore hAdmin close Table hTable conn getTable table1_restore Assert assertEquals HBaseTestingUtility countRows hTable NB_ROWS_IN_BATCH NB_ROWS_FAM3 hTable close hTable conn getTable table2_restore Assert assertEquals NB_ROWS_IN_BATCH HBaseTestingUtility countRows hTable hTable close
ADD_ROWS LOG info List TableName tables Lists newArrayList table1 table2 conf1 setClass BackupRestoreFactory HBASE_BACKUP_MERGE_IMPL_CLASS BackupMergeJobWithFailures BackupMergeJob Connection conn ConnectionFactory createConnection conf1 Admin admin conn getAdmin BackupAdminImpl client BackupAdminImpl conn BackupRequest request createBackupRequest BackupType FULL tables BACKUP_ROOT_DIR String backupIdFull client backupTables request assertTrue checkSucceeded backupIdFull Table t1 insertIntoTable conn table1 famName ADD_ROWS
ADD_ROWS LOG info List TableName tables Lists newArrayList table1 table2 conf1 setClass BackupRestoreFactory HBASE_BACKUP_MERGE_IMPL_CLASS BackupMergeJobWithFailures BackupMergeJob Connection conn ConnectionFactory createConnection conf1 Admin admin conn getAdmin BackupAdminImpl client BackupAdminImpl conn BackupRequest request createBackupRequest BackupType FULL tables BACKUP_ROOT_DIR String backupIdFull client backupTables request assertTrue checkSucceeded backupIdFull Table t1 insertIntoTable conn table1 famName ADD_ROWS LOG debug ADD_ROWS table1 Assert assertEquals TEST_UTIL countRows t1 NB_ROWS_IN_BATCH ADD_ROWS t1 close
conf1 setClass BackupRestoreFactory HBASE_BACKUP_MERGE_IMPL_CLASS BackupMergeJobWithFailures BackupMergeJob Connection conn ConnectionFactory createConnection conf1 Admin admin conn getAdmin BackupAdminImpl client BackupAdminImpl conn BackupRequest request createBackupRequest BackupType FULL tables BACKUP_ROOT_DIR String backupIdFull client backupTables request assertTrue checkSucceeded backupIdFull Table t1 insertIntoTable conn table1 famName ADD_ROWS LOG debug ADD_ROWS table1 Assert assertEquals TEST_UTIL countRows t1 NB_ROWS_IN_BATCH ADD_ROWS t1 close LOG debug ADD_ROWS table1 Table t2 insertIntoTable conn table2 famName ADD_ROWS Assert assertEquals TEST_UTIL countRows t2 NB_ROWS_IN_BATCH ADD_ROWS t2 close
BackupSystemTable table BackupSystemTable conn assertFalse table isMergeInProgress table finishBackupExclusiveOperation Assert fail assertTrue table isMergeInProgress table startBackupExclusiveOperation Assert fail table close
Table t1 conn getTable table1 Put p1 i i NB_ROWS_IN_BATCH i p1 Put Bytes toBytes i p1 addColumn famName qualName Bytes toBytes i t1 put p1 Assert assertEquals TEST_UTIL countRows t1 NB_ROWS_IN_BATCH t1 close NB_ROWS2 LOG debug testName actual TestBulkLoadHFiles loadHFiles testName table1Desc TEST_UTIL famName qualName Bytes toBytes Bytes toBytes Bytes toBytes Bytes toBytes NB_ROWS_IN_BATCH NB_ROWS2 tables Lists newArrayList table1 request createBackupRequest BackupType INCREMENTAL tables BACKUP_ROOT_DIR String backupIdIncMultiple client backupTables request assertTrue checkSucceeded backupIdIncMultiple
ADD_ROWS LOG info List TableName tables Lists newArrayList table1 table2 fam3Name Bytes toBytes TableDescriptor newTable1Desc TableDescriptorBuilder newBuilder table1Desc setColumnFamily ColumnFamilyDescriptorBuilder of fam3Name build TEST_UTIL getAdmin modifyTable newTable1Desc Connection conn ConnectionFactory createConnection conf1 NB_ROWS_FAM3 insertIntoTable conn table1 fam3Name NB_ROWS_FAM3 close Admin admin conn getAdmin BackupAdminImpl client BackupAdminImpl conn BackupRequest request createBackupRequest BackupType FULL tables BACKUP_ROOT_DIR String backupIdFull client backupTables request assertTrue checkSucceeded backupIdFull Table t1 insertIntoTable conn table1 famName ADD_ROWS
fam3Name Bytes toBytes TableDescriptor newTable1Desc TableDescriptorBuilder newBuilder table1Desc setColumnFamily ColumnFamilyDescriptorBuilder of fam3Name build TEST_UTIL getAdmin modifyTable newTable1Desc Connection conn ConnectionFactory createConnection conf1 NB_ROWS_FAM3 insertIntoTable conn table1 fam3Name NB_ROWS_FAM3 close Admin admin conn getAdmin BackupAdminImpl client BackupAdminImpl conn BackupRequest request createBackupRequest BackupType FULL tables BACKUP_ROOT_DIR String backupIdFull client backupTables request assertTrue checkSucceeded backupIdFull Table t1 insertIntoTable conn table1 famName ADD_ROWS LOG debug ADD_ROWS table1 Assert assertEquals TEST_UTIL countRows t1 NB_ROWS_IN_BATCH ADD_ROWS NB_ROWS_FAM3 t1 close
String backupIdFull client backupTables request assertTrue checkSucceeded backupIdFull Table t1 insertIntoTable conn table1 famName ADD_ROWS LOG debug ADD_ROWS table1 Assert assertEquals TEST_UTIL countRows t1 NB_ROWS_IN_BATCH ADD_ROWS NB_ROWS_FAM3 t1 close LOG debug ADD_ROWS table1 Table t2 conn getTable table2 Put p2 i i i p2 Put Bytes toBytes i p2 addColumn famName qualName Bytes toBytes i t2 put p2 Assert assertEquals TEST_UTIL countRows t2 NB_ROWS_IN_BATCH t2 close
conf1 set TableBackupClient BACKUP_CLIENT_IMPL_CLASS IncrementalTableBackupClientForTest getName maxStage Stage values length maxStage
List FileStatus c Path logRoot Path CommonFSUtils getWALRootDir c HConstants HREGION_LOGDIR_NAME FileSystem fs logRoot getFileSystem c RemoteIterator LocatedFileStatus it fs listFiles logRoot List FileStatus logFiles ArrayList FileStatus it LocatedFileStatus lfs it next lfs lfs logFiles add lfs
regionInfo splitA splitB meta Put put makePutFromRegionInfo regionInfo EnvironmentEdgeManager currentTime addDaughtersToPut put splitA splitB meta put put debugLogMutation put
connection state Put put makePutFromTableState state EnvironmentEdgeManager currentTime putToMetaTable connection put
connection table time EnvironmentEdgeManager currentTime Delete delete Delete table getName delete addColumns HConstants TABLE_FAMILY HConstants TABLE_STATE_QUALIFIER time deleteFromMetaTable connection delete
connection regionInfo sn openSeqNum masterSystemTime Put put Put CatalogFamilyFormat getMetaKeyForRegion regionInfo masterSystemTime addRegionInfo put regionInfo addLocation put sn openSeqNum regionInfo getReplicaId putToMetaTable connection put
connection regionInfo Delete delete Delete regionInfo getRegionName delete addFamily HConstants CATALOG_FAMILY HConstants LATEST_TIMESTAMP deleteFromMetaTable connection delete
connection regionInfos regionReplication now EnvironmentEdgeManager currentTime deleteRegionInfos connection regionInfos now addRegionsToMeta connection regionInfos regionReplication now
connection regionInfos regionReplication now EnvironmentEdgeManager currentTime deleteRegionInfos connection regionInfos now addRegionsToMeta connection regionInfos regionReplication now LOG info regionInfos size
Delete delete Delete mergeRegion getRegionName Cell cells getRegionResult connection mergeRegion getRegionName rawCells cells cells List qualifiers ArrayList Cell cell cells cell qualifier CellUtil cloneQualifier cell qualifiers add qualifier delete addColumns HConstants CATALOG_FAMILY qualifier HConstants LATEST_TIMESTAMP qualifiers LOG info mergeRegion getRegionNameAsString deleteFromMetaTable connection delete
Put makePutFromRegionInfo regionInfo favoredNodeList Put put favoredNodeList time EnvironmentEdgeManager currentTime put MetaTableAccessor makePutFromRegionInfo regionInfo time favoredNodes getFavoredNodes favoredNodeList put add CellBuilderFactory create CellBuilderType SHALLOW_COPY setRow put getRow setFamily HConstants CATALOG_FAMILY setQualifier FAVOREDNODES_QUALIFIER setTimestamp time setType Type Put setValue favoredNodes build
Map RegionInfo ServerName Map RegionInfo ServerName Map RegionInfo ServerName secondaryAndTertiaryMap HashMap Map RegionInfo ServerName entry RegionInfo regionInfo entry getKey ServerName primaryRS entry getValue ServerName favoredNodes getSecondaryAndTertiary regionInfo primaryRS favoredNodes secondaryAndTertiaryMap put regionInfo favoredNodes
Map RegionInfo ServerName Map RegionInfo ServerName primaryRSMap Map ServerName Set RegionInfo serverToPrimaries mapRSToPrimaries primaryRSMap Map RegionInfo ServerName secondaryAndTertiaryMap HashMap RegionInfo ServerName entry primaryRSMap RegionInfo regionInfo entry getKey ServerName primaryRS entry getValue String primaryRack getRackOfServer primaryRS ServerName favoredNodes favoredNodes singleRackCase regionInfo primaryRS primaryRack favoredNodes multiRackCaseWithRestrictions serverToPrimaries secondaryAndTertiaryMap primaryRack primaryRS regionInfo favoredNodes secondaryAndTertiaryMap put regionInfo favoredNodes
hri addAssignment hri hrls i getServerName addRegion hri hri rl getRegionLocation getRegion favoredNodes result getValue HConstants CATALOG_FAMILY FavoredNodeAssignmentHelper FAVOREDNODES_QUALIFIER favoredNodes ServerName favoredServerList FavoredNodeAssignmentHelper getFavoredNodesList favoredNodes existingAssignmentPlan updateFavoredNodesMap hri Arrays asList favoredServerList favoredServerList FavoredNodeAssignmentHelper LOG warn hri Arrays toString favoredServerList i i favoredServerList i i PRIMARY ordinal addPrimaryAssignment hri favoredServerList i i SECONDARY ordinal addSecondaryAssignment hri favoredServerList i i TERTIARY ordinal addTeritiaryAssignment hri favoredServerList i
action regionResult regionException Object result regionResult result getOrDefault action getOriginalIndex regionException result
RegionLocations oldLocs tableCache cache putIfAbsent startKey locs oldLocs locs RegionInfo region locs getRegionLocation getRegion RegionInfo oldRegion oldLocs getRegionLocation getRegion region oldRegion RegionLocations mergedLocs oldLocs mergeLocations locs mergedLocs oldLocs LOG trace locs oldLocs oldLocs tableCache cache startKey oldLocs mergedLocs mergedLocs LOG
result RegionLocations locs CatalogFamilyFormat getRegionLocations result
HRegionLocation loc HRegionLocation HRegionLocation cachedLocationSupplier HRegionLocation HRegionLocation HRegionLocation oldLoc cachedLocationSupplier apply loc
HRegionLocation loc Throwable exception HRegionLocation HRegionLocation cachedLocationSupplier HRegionLocation HRegionLocation HRegionLocation oldLoc cachedLocationSupplier apply loc LOG LOG debug loc oldLoc exception exception toString loc oldLoc Throwable cause findException exception LOG LOG debug loc cause cause toString cause cause LOG debug loc cause RegionMovedException RegionMovedException rme RegionMovedException cause HRegionLocation newLoc HRegionLocation loc getRegion rme getServerName rme getLocationSeqNum
LOG debug loc oldLoc exception exception toString loc oldLoc Throwable cause findException exception LOG LOG debug loc cause cause toString cause cause LOG debug loc cause RegionMovedException RegionMovedException rme RegionMovedException cause HRegionLocation newLoc HRegionLocation loc getRegion rme getServerName rme getLocationSeqNum LOG debug loc newLoc rme toString addToCache accept newLoc
c hcRetries c getInt HConstants HBASE_CLIENT_RETRIES_NUMBER HConstants DEFAULT_HBASE_CLIENT_RETRIES_NUMBER serversideMultiplier c getInt HConstants HBASE_CLIENT_SERVERSIDE_RETRIES_MULTIPLIER HConstants DEFAULT_HBASE_CLIENT_SERVERSIDE_RETRIES_MULTIPLIER retries hcRetries serversideMultiplier c setInt HConstants HBASE_CLIENT_RETRIES_NUMBER retries
error error future complete future completeExceptionally error future complete locations error1 error1 future completeExceptionally error1 List HRegionLocation notDeployedRegions locations stream filter loc loc getServerName collect Collectors toList notDeployedRegions
CompletableFuture Void String snapshotName TableName tableName CompletableFuture Void future CompletableFuture String failSafeSnapshotSnapshotNameFormat connection getConfiguration get HConstants SNAPSHOT_RESTORE_FAILSAFE_NAME HConstants DEFAULT_SNAPSHOT_RESTORE_FAILSAFE_NAME String failSafeSnapshotSnapshotName failSafeSnapshotSnapshotNameFormat replace snapshotName replace tableName toString replace TableName NAMESPACE_DELIM replace String valueOf EnvironmentEdgeManager currentTime
LOG info failSafeSnapshotSnapshotName failSafeSnapshotSnapshotName err err future completeExceptionally err snapshotName err2 err2 failSafeSnapshotSnapshotName err3 err3 future completeExceptionally err3 String msg snapshotName failSafeSnapshotSnapshotName future completeExceptionally RestoreSnapshotException msg err2
future completeExceptionally err snapshotName err2 err2 failSafeSnapshotSnapshotName err3 err3 future completeExceptionally err3 String msg snapshotName failSafeSnapshotSnapshotName future completeExceptionally RestoreSnapshotException msg err2 LOG info failSafeSnapshotSnapshotName failSafeSnapshotSnapshotName err3 err3
Filter filterStringAsByteArray String filterName Bytes toString getFilterName filterStringAsByteArray ArrayList filterArguments getFilterArguments filterStringAsByteArray filterHashMap filterName IllegalArgumentException filterName filterName filterHashMap get filterName String methodName Class c Class forName filterName Class argTypes Class ArrayList Method m c getDeclaredMethod methodName argTypes Filter m invoke filterArguments e LOG error filterName e e
ArrayList filterArguments getFilterArguments filterStringAsByteArray filterHashMap filterName IllegalArgumentException filterName filterName filterHashMap get filterName String methodName Class c Class forName filterName Class argTypes Class ArrayList Method m c getDeclaredMethod methodName argTypes Filter m invoke filterArguments e LOG error filterName e e LOG error methodName filterName e e
IllegalArgumentException filterName filterName filterHashMap get filterName String methodName Class c Class forName filterName Class argTypes Class ArrayList Method m c getDeclaredMethod methodName argTypes Filter m invoke filterArguments e LOG error filterName e e LOG error methodName filterName e e LOG error filterName e e
proto ComparatorProtos RegexStringComparator parseFrom pbBytes e DeserializationException e RegexStringComparator comparator proto EngineType engine EngineType valueOf proto getEngine comparator RegexStringComparator proto getPattern proto getPatternFlags engine comparator RegexStringComparator proto getPattern proto getPatternFlags String charset proto getCharset charset comparator getEngine setCharset charset e
connection ConnectionId remoteId connection remoteId remoteId remoteId
ioFailures timeoutFailures socket rpcClient socketFactory createSocket socket setTcpNoDelay rpcClient isTcpNoDelay socket setKeepAlive rpcClient tcpKeepAlive rpcClient localAddr socket bind rpcClient localAddr NetUtils connect socket remoteId getAddress rpcClient connectTO socket setSoTimeout rpcClient readTO
socket rpcClient socketFactory createSocket socket setTcpNoDelay rpcClient isTcpNoDelay socket setKeepAlive rpcClient tcpKeepAlive rpcClient localAddr socket bind rpcClient localAddr NetUtils connect socket remoteId getAddress rpcClient connectTO socket setSoTimeout rpcClient readTO toe LOG LOG debug StringUtils stringifyException toe handleConnectionFailure timeoutFailures rpcClient maxRetries toe LOG
waitingConnectionHeaderResponse len in readInt buff len readSize in read buff
address expiry EnvironmentEdgeManager currentTime recheckServersTimeout failedServers put address toString expiry latestExpiry expiry
LOG trace TextFormat shortDebugString responseHeader totalSize RemoteException remoteExc responseHeader ExceptionResponse exceptionResponse responseHeader getException remoteExc IPCUtil createRemoteException exceptionResponse IPCUtil exceptionResponse exceptionCaught ctx remoteExc remoteExc Call call id2Call remove id call readSoFar IPCUtil getTotalSizeWhenWrittenDelimited responseHeader whatIsLeftToRead totalSize readSoFar LOG
inS outS DataInputStream inStream DataInputStream BufferedInputStream inS DataOutputStream outStream DataOutputStream BufferedOutputStream outS saslToken getInitialResponse saslToken outStream writeInt saslToken length outStream write saslToken saslToken length outStream flush
outStream flush LOG LOG debug saslToken length readStatus inStream len inStream readInt len IOException LOG LOG debug dispose saslToken len LOG
readStatus inStream len inStream readInt len IOException LOG LOG debug dispose saslToken len LOG LOG debug saslToken length inStream readFully saslToken saslToken evaluateChallenge saslToken
dispose saslToken len LOG LOG debug saslToken length inStream readFully saslToken saslToken evaluateChallenge saslToken saslToken LOG LOG debug saslToken length outStream writeInt saslToken length outStream write saslToken saslToken length outStream flush
conf serverAddr securityInfo String String String serverPrincipal getServerPrincipal conf securityInfo serverAddr
Result cellScanner response response noOfResults cellScanner response getCellsPerResultCount response getResultsCount Result results Result noOfResults i i noOfResults i cellScanner noOfCells response getCellsPerResult i isPartial response getPartialFlagPerResultCount i response getPartialFlagPerResult i List Cell cells ArrayList noOfCells noOfCells cellScanner String msg noOfResults i
response noOfResults cellScanner response getCellsPerResultCount response getResultsCount Result results Result noOfResults i i noOfResults i cellScanner noOfCells response getCellsPerResult i isPartial response getPartialFlagPerResultCount i response getPartialFlagPerResult i List Cell cells ArrayList noOfCells noOfCells cellScanner String msg noOfResults i LOG error msg DoNotRetryIOException msg
Map Method Enum getMethod2Value HashMap ColumnFamilyDescriptorBuilder builder ColumnFamilyDescriptorBuilder newBuilder Bytes toBytes Method
Map Method Enum getMethod2Value HashMap ColumnFamilyDescriptorBuilder builder ColumnFamilyDescriptorBuilder newBuilder Bytes toBytes Method method method method getReturnType LOG info method Class enumType method getReturnType Method setMethod getSetMethod method enumType Enum enumConst getEnumValue enumType
Map Method Enum getMethod2Value HashMap ColumnFamilyDescriptorBuilder builder ColumnFamilyDescriptorBuilder newBuilder Bytes toBytes Method method ColumnFamilyDescriptor method method getReturnType LOG info method Class enumType method getReturnType Method setMethod getSetMethod method enumType Enum enumConst getEnumValue enumType LOG info setMethod enumConst setMethod invoke builder enumConst getMethod2Value put method enumConst ColumnFamilyDescriptor desc builder build ColumnFamilyDescriptorBuilder builder2 ColumnFamilyDescriptorBuilder newBuilder Bytes toBytes desc
Method method ColumnFamilyDescriptor method method getReturnType LOG info method Class enumType method getReturnType Method setMethod getSetMethod method enumType Enum enumConst getEnumValue enumType LOG info setMethod enumConst setMethod invoke builder enumConst getMethod2Value put method enumConst ColumnFamilyDescriptor desc builder build ColumnFamilyDescriptorBuilder builder2 ColumnFamilyDescriptorBuilder newBuilder Bytes toBytes desc k v LOG info k toString v toString String str Bytes toString v get v getOffset v getLength getMethod2Value str
Scan Scan Method methods Scan getMethods Method methods
String Configuration conf String alias String String passwd Method m Configuration getMethod String p m invoke conf alias p
conf key ZKConfig ZKClusterKey zkClusterKey ZKConfig transformClusterKey key conf set HConstants ZOOKEEPER_QUORUM zkClusterKey getQuorumString conf setInt HConstants ZOOKEEPER_CLIENT_PORT zkClusterKey getClientPort conf set HConstants ZOOKEEPER_ZNODE_PARENT zkClusterKey getZnodeParent
cancel cleanup LOG info getName start LOG start System nanoTime initialChoreComplete initialChoreComplete initialChore chore LOG start end System nanoTime
Objects requireNonNull conf CommandLine cmd List String argsList ArrayList args length String arg args argsList add arg processOldArgs argsList addOptions args printUsage EXIT_SUCCESS String remainingArgs String argsList size argsList toArray remainingArgs cmd newParser parse options remainingArgs
argsList add arg processOldArgs argsList addOptions printUsage EXIT_SUCCESS String remainingArgs String argsList size argsList toArray remainingArgs cmd newParser parse options remainingArgs e LOG error e getMessage LOG error EXIT_FAILURE e
String remainingArgs String argsList size argsList toArray remainingArgs cmd newParser parse options remainingArgs e LOG error e getMessage LOG error EXIT_FAILURE e LOG error e LOG error EXIT_FAILURE processOptions cmd ret ret doWork
coeff prealign_size OBJECT coeff coeff REFERENCE size align prealign_size align coeff ARRAY
fs path storagePolicy Exception toThrow fs setStoragePolicy path storagePolicy
CoprocessorClassLoader path String CoprocessorClassLoader cl getIfCached path String pathStr path toString cl
LOG LOG debug name parent loadClass name name Class clasz findLoadedClass name clasz LOG LOG debug name LOG LOG debug name clasz findClass name LOG
name Class clasz findLoadedClass name clasz LOG LOG debug name LOG LOG debug name clasz findClass name LOG LOG debug name clasz parent loadClass name
URL URL resource parentLoaded
Class name name Class clasz findLoadedClass name clasz
name Class clasz findLoadedClass name clasz LOG LOG debug name LOG LOG debug name clasz findClass name LOG LOG debug loadNewJars LOG
mue LOG warn fileName mue FileStatus statuses remoteDir statuses remoteDirFs listStatus remoteDir ioe LOG warn remoteDir ioe statuses statuses FileStatus status statuses status Path path status getPath String fileName path getName
IllegalArgumentException arge LOG error HBaseMarkers FATAL clazz getName methodName Classes stringify types arge arge nsme IllegalArgumentException methodName clazz getName nsme ite ite getTargetException ite getTargetException Exception Exception ite getTargetException ite getTargetException Error Error ite getTargetException UndeclaredThrowableException ite clazz getName methodName iae IllegalArgumentException clazz getName methodName iae
String packageName String path packageName replace Pattern jarResourceRe Pattern compile path Enumeration URL resources classLoader getResources path List File dirs ArrayList List String jars ArrayList resources URL resource resources nextElement String resourcePath resource getFile Matcher matcher jarResourceRe matcher resourcePath isJar matcher find resourcePath isJar matcher group resourcePath resourcePath isJar
clazz Category categories clazz getAnnotationsByType Category numParams getNumParameters clazz categories categories timeout numParams PER_UNIT_TEST_TIMEOUT_MINS
counter testCounter incrementAndGet String classNamePrefix name getMethodName
counter testCounter incrementAndGet String classNamePrefix name getMethodName
counter testCounter incrementAndGet String classNamePrefix name getMethodName String pkgNameSuffix name getMethodName
counter testCounter incrementAndGet String classNamePrefix name getMethodName String pkgNameSuffix name getMethodName
counter testCounter incrementAndGet String classNamePrefix name getMethodName String pkgNameSuffix name getMethodName
row family qualifier timestamp value KeyValue kv KeyValue row family qualifier timestamp value assertTrue Bytes compareTo kv getRowArray kv getRowOffset kv getRowLength row row length assertTrue CellUtil matchingColumn kv family qualifier
conf timeout started System currentTimeMillis adjustedTimeout getWaitForRatio conf timeout mustEnd started adjustedTimeout remainderWait sleepInterval eval interrupted
JarEntry jarAdd JarEntry file getName jarAdd setTime file lastModified out putNextEntry jarAdd FileInputStream in FileInputStream file nRead in read buffer buffer length nRead out write buffer nRead in close out close stream close LOG info
srcDirPath mkdirs File sourceCodeFile File srcDir toString className BufferedWriter bw Files newBufferedWriter sourceCodeFile toPath StandardCharsets UTF_8 bw write javaCode bw close JavaCompiler compiler ToolProvider getSystemJavaCompiler ArrayList String srcFileNames ArrayList srcFileNames add sourceCodeFile toString StandardJavaFileManager fm compiler getStandardFileManager Iterable JavaFileObject cu fm getJavaFileObjects sourceCodeFile List String options ArrayList options add String currentDir File getAbsolutePath String classpath currentDir File separator File separator System getProperty System getProperty System getProperty System getProperty options add classpath
value seedStrings expectedData getValueForRowColumn value length seedStrings equals Bytes equals expectedData value equals
SimpleKdcServer File testDir randomPortGenerator portClash File kdcDir File testDir SimpleKdcServer getSimpleName Preconditions checkArgument kdcDir mkdirs kdcDir String hostName InetAddress getLoopbackAddress getHostName BoundSocketMaker bsm portClash BoundSocketMaker randomPortGenerator retries retries SimpleKdcServer kdc SimpleKdcServer kdc setWorkDir kdcDir kdc setKdcHost hostName kdc setAllowTcp kdc setAllowUdp kdcPort bsm bsm getPort randomPortGenerator get kdc setKdcTcpPort kdcPort
kdc setWorkDir kdcDir kdc setKdcHost hostName kdc setAllowTcp kdc setAllowUdp kdcPort bsm bsm getPort randomPortGenerator get kdc setKdcTcpPort kdcPort LOG info hostName kdcPort kdc init kdc start kdc kdc kdc stop
maxAttempts RetryCounterFactory factory RetryCounterFactory maxAttempts RetryCounter retryCounter factory create retryCounter
Properties properties System getProperties properties
LOG debug SLEEP_TIME_MS sleeper start startTime System currentTimeMillis LOG debug Threads sleep LOG debug sleeper interrupt Threads sleep LOG debug sleeper interrupt Threads sleep LOG debug sleeper interrupt sleeper join assertTrue wasInterrupted get
min min result ci compare result min result min MinCallBack minCallBack MinCallBack instance IOException RpcController controller AggregationClientRpcController CoprocessorRpcUtils BlockingRpcCallback AggregateResponse rpcCallback CoprocessorRpcUtils BlockingRpcCallback instance getMin controller requestArg rpcCallback AggregateResponse response rpcCallback get controller IOException controller errorText response ByteString b response getFirstPart Q q getParsedGenericInstance ci getClass b ci getCellValueFromProto q
temp ci getValue colFamily qualifier results get i max max temp ci compare temp max temp max results clear hasMoreRows max AggregateResponse Builder builder AggregateResponse newBuilder builder addFirstPart ci getProtoForCellType max toByteString response builder build e CoprocessorRpcUtils setControllerException controller e scanner scanner close
listSize results size i i listSize i temp ci getValue colFamily qualifier results get i min min temp ci compare temp min temp min results clear hasMoreRows min response AggregateResponse newBuilder addFirstPart ci getProtoForCellType min toByteString build e CoprocessorRpcUtils setControllerException controller e scanner scanner close
hasMoreRows scanner next results results counter results clear hasMoreRows ByteBuffer bb ByteBuffer allocate putLong counter bb rewind response AggregateResponse newBuilder addFirstPart ByteString copyFrom bb build e CoprocessorRpcUtils setControllerException controller e scanner scanner close
controller ExportProtos request ExportProtos ExportResponse done Region region env getRegion Configuration conf HBaseConfiguration create env getConfiguration conf setStrings conf get ResultSerialization getName Scan scan validateKey region getRegionInfo request Token userToken userProvider request LOG warn userProvider userToken Token request getFsToken getIdentifier toByteArray request getFsToken getPassword toByteArray Text request getFsToken getKind Text request getFsToken getService ExportProtos ExportResponse response processData region conf userProvider scan userToken getWriterOptions conf region getRegionInfo request done run response e CoprocessorRpcUtils setControllerException controller e
sumResult InternalScanner scanner scanner env getRegion getScanner scan List Cell curVals ArrayList hasMore curVals clear hasMore scanner next curVals Cell kv curVals kv sumResult Bytes toInt kv getValueArray kv getValueOffset hasMore e CoprocessorRpcUtils setControllerException controller e
curVals clear hasMore scanner next curVals kv curVals kv sumResult Bytes toInt kv getValueArray kv getValueOffset hasMore e CoprocessorRpcUtils setControllerException controller e sumResult LOG info e scanner scanner close e
kv kv sumResult Bytes toInt kv getValueArray kv getValueOffset hasMore e CoprocessorRpcUtils setControllerException controller e sumResult LOG info e scanner scanner close e CoprocessorRpcUtils setControllerException controller e sumResult
Region region env getRegion Bytes region done run scanner region getScanner scan List Cell curVals ArrayList hasMore curVals clear hasMore scanner next curVals Cell kv curVals kv sumResult Bytes toInt kv getValueArray kv getValueOffset hasMore
curVals clear hasMore scanner next curVals kv curVals kv sumResult Bytes toInt kv getValueArray kv getValueOffset hasMore e CoprocessorRpcUtils setControllerException controller e sumResult LOG info e scanner scanner close
hasMore scanner next curVals kv curVals kv sumResult Bytes toInt kv getValueArray kv getValueOffset hasMore e CoprocessorRpcUtils setControllerException controller e sumResult LOG info e scanner scanner close e CoprocessorRpcUtils setControllerException controller e
Region region env getRegion Bytes region DoNotRetryIOException scanner region getScanner scan List Cell curVals ArrayList hasMore curVals clear hasMore scanner next curVals Cell kv curVals kv sumResult Bytes toInt kv getValueArray kv getValueOffset hasMore
curVals clear hasMore scanner next curVals kv curVals kv sumResult Bytes toInt kv getValueArray kv getValueOffset hasMore e CoprocessorRpcUtils setControllerException controller e sumResult LOG info e scanner scanner close
FileSystem fs cluster getFileSystem File jarFile1 buildCoprocessorJar cpName1 File jarFile2 buildCoprocessorJar cpName2 fs copyFromLocalFile Path jarFile1 getPath Path fs getUri toString Path SEPARATOR String jarFileOnHDFS1 fs getUri toString Path SEPARATOR jarFile1 getName Path pathOnHDFS1 Path jarFileOnHDFS1 assertTrue fs exists pathOnHDFS1
FileSystem fs cluster getFileSystem File jarFile1 buildCoprocessorJar cpName1 File jarFile2 buildCoprocessorJar cpName2 fs copyFromLocalFile Path jarFile1 getPath Path fs getUri toString Path SEPARATOR String jarFileOnHDFS1 fs getUri toString Path SEPARATOR jarFile1 getName Path pathOnHDFS1 Path jarFileOnHDFS1 assertTrue fs exists pathOnHDFS1 LOG info jarFileOnHDFS1 fs copyFromLocalFile Path jarFile2 getPath Path fs getUri toString Path SEPARATOR String jarFileOnHDFS2 fs getUri toString Path SEPARATOR jarFile2 getName Path pathOnHDFS2 Path jarFileOnHDFS2 assertTrue fs exists pathOnHDFS2
String libPrefix FileSystem fs cluster getFileSystem File innerJarFile1 buildCoprocessorJar cpName1 File innerJarFile2 buildCoprocessorJar cpName2 File outerJarFile File TEST_UTIL getDataTestDir toString ClassLoaderTestHelper addJarFilesToJar outerJarFile libPrefix innerJarFile1 innerJarFile2 fs copyFromLocalFile Path outerJarFile getPath Path fs getUri toString Path SEPARATOR String jarFileOnHDFS fs getUri toString Path SEPARATOR outerJarFile getName assertTrue fs exists Path jarFileOnHDFS
servers serversForTable tableName any_failed server servers String actualCoprocessors server getValue getCoprocessorNames stream toArray size String size Arrays actualCoprocessors expectedCoprocessors LOG debug Arrays toString actualCoprocessors Arrays toString expectedCoprocessors any_failed expectedCoprocessors switchExpectedCoprocessors expectedCoprocessors expectedCoprocessors switchExpectedCoprocessors expectedCoprocessors any_failed success
Table table util getConnection getTable TEST_TABLE Map Long results sum table TEST_FAMILY TEST_QUALIFIER ROWS ROWS ROWS length sumResult expectedResult Map Long results
Table table util getConnection getTable TEST_TABLE Map Long results sum table TEST_FAMILY TEST_QUALIFIER ROWS ROWS ROWS length sumResult expectedResult Map Long e results LOG info e getValue Bytes toStringBinary e getKey sumResult e getValue i i i expectedResult i assertEquals expectedResult sumResult results clear results sum table TEST_FAMILY TEST_QUALIFIER ROWS rowSeperator1 ROWS ROWS length sumResult expectedResult Map Long e results
Table table util getConnection getTable TEST_TABLE List HRegionLocation regions rl util getConnection TEST_TABLE regions rl getAllRegionLocations TestProtos EchoRequestProto request TestProtos EchoRequestProto newBuilder setMessage build Map String results Collections synchronizedMap TreeMap String Bytes BYTES_COMPARATOR RpcController controller ServerRpcController table TestProtos EchoResponseProto TestProtos EchoResponseProto instance LOG debug TestProtos EchoRequestProto getDefaultInstance CoprocessorRpcUtils BlockingRpcCallback TestProtos EchoResponseProto callback CoprocessorRpcUtils BlockingRpcCallback instance echo controller request callback TestProtos EchoResponseProto response callback get
List HRegionLocation regions rl regions rl getAllRegionLocations TestProtos EchoRequestProto request TestProtos EchoRequestProto newBuilder setMessage build RpcController controller ServerRpcController instance CoprocessorRpcUtils BlockingRpcCallback TestProtos EchoResponseProto callback CoprocessorRpcUtils BlockingRpcCallback instance echo controller request callback TestProtos EchoResponseProto response callback get LOG debug response
TestProtos EchoRequestProto request TestProtos EchoRequestProto newBuilder setMessage build RpcController controller ServerRpcController results instance CoprocessorRpcUtils BlockingRpcCallback TestProtos EchoResponseProto callback CoprocessorRpcUtils BlockingRpcCallback instance echo controller request callback TestProtos EchoResponseProto response callback get LOG debug response e results LOG info e getValue Bytes toStringBinary e getKey assertEquals results size
prepareTestData failures set numThreads concurrentExec IncrementRunner numThreads Get get Get ROW LOG debug stringifyKvs table get get listCells finalCounter incrementCounter table failureNumber failures get failureNumber
prepareTestData failures set numThreads concurrentExec SwapRowsRunner numThreads LOG debug stringifyKvs table get Get ROW listCells LOG debug stringifyKvs table get Get ROW2 listCells failureNumber failures get failureNumber
fs setPermission openDir FsPermission FsAction ALL FsAction ALL FsAction ALL Path output fs makeQualified Path openDir String args String exportTable output toString Map Export Response result Export run Configuration UTIL getConfiguration args rowCount cellCount Export Response r result rowCount r getRowCount cellCount r getCellCount assertEquals rowCount assertEquals cellCount
ExecutorService threadPool Executors newFixedThreadPool THREAD_POOL_SIZE ThreadFactoryBuilder setNameFormat setUncaughtExceptionHandler Threads LOGGING_EXCEPTION_HANDLER build CountDownLatch latch CountDownLatch numOps numOps i CompletableFuture AsyncConnection future getConn future conn error error LOG warn i error latch countDown AsyncTable table conn getTable tableName threadPool table i i putErr putErr LOG warn i putErr latch countDown
latch countDown LOG info i i result LOG warn i latch countDown result LOG warn i result FAMILY QUAL LOG warn i Bytes toString FAMILY Bytes toString QUAL v Bytes toInt result getValue FAMILY QUAL v i
i deleteRow deleteArr i createDeleteMutation deleteRow deleteType timestamp OperationStatus opStatus region batchMutate deleteArr i i opStatus i opStatus i totalRowsDeleted deleteType versionsDeleted deleteArr i getAttribute NO_OF_VERSIONS_TO_DELETE versionsDeleted totalVersionsDeleted Bytes toInt versionsDeleted ioe LOG error ioe toString ioe CoprocessorRpcUtils setControllerException controller ioe
createTableStartTime time System currentTimeMillis createTableStartTime
Exception List Pair String Class Exception params ArrayList params add Pair String Class Exception MasterRegistry getName MasterRegistryFetchException params add Pair String Class Exception HConstants ZK_CONNECTION_REGISTRY_CLASS RetriesExhaustedException params
pair LOG info pair getFirst pair getSecond getName Configuration clientConf Configuration CONF clientConf setInt HConstants HBASE_CLIENT_RETRIES_NUMBER clientConf set HConstants CLIENT_CONNECTION_REGISTRY_IMPL_CONF_KEY pair getFirst conn clientConf UserGroupInformation user1 UserGroupInformation createUserForTesting String user1 addToken ShadeClientTokenUtil obtainToken conn toCharArray LOG info user1 conn clientConf conn getAdmin listTableDescriptors fail
conn getAdmin listTableDescriptors fail e LOG info e assertEquals pair getSecond e getClass validateRootCause Throwables getRootCause e LOG info conn t conn t get Get Bytes toBytes fail e
validateRootCause Throwables getRootCause e LOG info t t get Get Bytes toBytes fail e LOG info e assertEquals pair getSecond e getClass validateRootCause Throwables getRootCause e
executor stop LOG LOG trace registeredSources Collection MetricRegistry registries MetricRegistries global getMetricRegistries MetricRegistry registry registries MetricRegistryInfo info registry getMetricRegistryInfo info registeredSources info LOG LOG debug info getMetricsJmxContext MetricsSourceAdapter adapter MetricsSourceAdapter registry
MetricRegistryInfo info registry getMetricRegistryInfo info registeredSources info LOG LOG debug info getMetricsJmxContext MetricsSourceAdapter adapter MetricsSourceAdapter registry LOG info info getMetricsJmxContext info getMetricsDescription DefaultMetricsSystem instance register info getMetricsJmxContext info getMetricsDescription adapter registeredSources put info adapter removed Entry MetricRegistryInfo MetricsSourceAdapter it registeredSources it Entry MetricRegistryInfo MetricsSourceAdapter entry it next MetricRegistryInfo info entry getKey Optional MetricRegistry found MetricRegistries global get info
n inputStream available n readBuffer length n readBuffer readBuffer length rc input read readBuffer readBuffer length rc done i i rc i ch readBuffer i inputCharacterQueue offer ch Thread sleep
String cmd sttyOptionsString Process process Runtime getRuntime exec cmd String ret stdout process ret stdout readLine stderr process String line stderr readLine line line LOGGER error line process waitFor exitValue process exitValue exitValue
String name String classname String String parameters String USER_FACING_URLS defineFilter webAppContext name classname parameters USER_FACING_URLS
String name String classname String String parameters String USER_FACING_URLS defineFilter webAppContext name classname parameters USER_FACING_URLS LOG info name classname webAppContext getDisplayName String ALL_URLS ServletContextHandler e e ServletContextHandler handler e getKey defineFilter handler name classname parameters ALL_URLS
li listener close e LOG error webAppContext getDisplayName e exception addMultiException exception e webAppContext clearAttributes webAppContext stop e LOG error webAppContext getDisplayName e exception addMultiException exception e webServer stop e
req String absoluteDiskPath getServletContext getRealPath req getPathInfo File requestedFile File absoluteDiskPath requestedFile
HttpServletRequest request HttpServletRequest lowerCaseRequest toLowerCase request String doAsUser lowerCaseRequest getParameter DO_AS doAsUser doAsUser request
descriptionStr minfo getDescription String prs code prs code String mBeanServer getAttribute oname prs attribute prs attribute attributeinfo mBeanServer getAttribute oname prs e e LOG LOG trace prs oname e
String prs code prs code String mBeanServer getAttribute oname prs attribute prs attribute attributeinfo mBeanServer getAttribute oname prs e e LOG LOG trace prs oname e LOG error prs oname e
code prs code String mBeanServer getAttribute oname prs attribute prs attribute attributeinfo mBeanServer getAttribute oname prs e e LOG LOG trace prs oname e LOG error prs oname e e LOG error prs oname e
code String mBeanServer getAttribute oname prs attribute prs attribute attributeinfo mBeanServer getAttribute oname prs e e LOG LOG trace prs oname e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e
attribute prs attribute attributeinfo mBeanServer getAttribute oname prs e e LOG LOG trace prs oname e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e e
e e LOG LOG trace prs oname e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e
LOG LOG trace prs oname e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e e
String attName attr getName attName attName attName attName String descriptionStr description attr getDescription Object value value mBeanServer getAttribute oname attName e e LOG LOG trace attName oname e
attName attName attName attName String descriptionStr description attr getDescription Object value value mBeanServer getAttribute oname attName e e LOG LOG trace attName oname e LOG error attName oname e
String descriptionStr description attr getDescription Object value value mBeanServer getAttribute oname attName e e LOG LOG trace attName oname e LOG error attName oname e e LOG debug attName oname e e
value mBeanServer getAttribute oname attName e e LOG LOG trace attName oname e LOG error attName oname e e LOG debug attName oname e e e
e e LOG LOG trace attName oname e LOG error attName oname e e LOG debug attName oname e e e LOG error attName oname e
Configuration conf Configuration conf setInt HttpServer HTTP_MAX_THREADS MAX_THREADS server createTestServer conf server addUnprivilegedServlet EchoServlet server addUnprivilegedServlet EchoMapServlet server addUnprivilegedServlet HtmlContentServlet server addUnprivilegedServlet LongHeaderServlet server addJerseyResourcePackage JerseyResource getPackage getName server start baseUrl getServerURL server
clientThreads MAX_THREADS Executor executor Executors newFixedThreadPool clientThreads CountDownLatch ready CountDownLatch clientThreads CountDownLatch start CountDownLatch clientThreads executor ready countDown start await assertEquals readOutput URL baseUrl serverThreads server webServer getThreadPool getThreads assertTrue serverThreads serverThreads MAX_THREADS
LOG info String js readOutput URL baseUrl Map String Object m parse js
serverConf setInt HttpServer HTTP_MAX_THREADS TestHttpServer MAX_THREADS keystoresDir File HTU getDataTestDir toString keystoresDir mkdirs sslConfDir KeyStoreTestUtil getClasspathDir TestSSLHttpServer KeyStoreTestUtil setupSSLConfig keystoresDir getAbsolutePath sslConfDir serverConf Configuration clientConf Configuration clientConf addResource serverConf get SSLFactory SSL_CLIENT_CONF_KEY serverConf addResource serverConf get SSLFactory SSL_SERVER_CONF_KEY clientConf set SSLFactory SSL_CLIENT_CONF_KEY serverConf get SSLFactory SSL_CLIENT_CONF_KEY clientSslFactory SSLFactory SSLFactory Mode CLIENT clientConf clientSslFactory init server HttpServer Builder setName addEndpoint URI setConf serverConf keyPassword HBaseConfiguration getPassword serverConf keyStore serverConf get HBaseConfiguration getPassword serverConf clientConf get trustStore serverConf get HBaseConfiguration getPassword serverConf serverConf get build server addUnprivilegedServlet TestHttpServer EchoServlet server start baseUrl URL NetUtils getHostPortString server getConnectorAddress
kdc SimpleKdcServerUtil getRunningSimpleKdcServer File htu getDataTestDir toString HBaseCommonTestingUtility randomFreePort File keytabDir File htu getDataTestDir toString keytabDir deleteRecursively keytabDir keytabDir mkdirs infoServerKeytab File keytabDir serverPrincipal replace clientKeytab File keytabDir CLIENT_PRINCIPAL setupUser kdc clientKeytab CLIENT_PRINCIPAL setupUser kdc infoServerKeytab serverPrincipal buildSpnegoConfiguration conf serverPrincipal infoServerKeytab server createTestServerWithSecurity conf server addUnprivilegedServlet EchoServlet server addJerseyResourcePackage JerseyResource getPackage getName server start baseUrl getServerURL server
String result readOutput URL baseUrl
String result readOutput URL baseUrl LOG info result assertReFind result assertReFind result result readOutput URL baseUrl
String result readOutput URL baseUrl LOG info result assertReFind result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result assertReFind result result readOutput URL baseUrl
String result readOutput URL baseUrl LOG info result assertReFind result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result result readOutput URL baseUrl
LOG info result assertReFind result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result assertReFind result result readOutput URL baseUrl
result readOutput URL baseUrl LOG info result assertReFind result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result result readOutput URL baseUrl
result readOutput URL baseUrl LOG info result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result assertReFind result result readOutput URL baseUrl
assertReFind result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result assertReFind result result readOutput URL baseUrl LOG info result assertReFind result assertReFind result assertReFind result result readOutput URL baseUrl
conf put MiniKdc DEBUG MiniKdc kdc File dir bindException numTries bindException dir File HTU getDataTestDir toUri getPath kdc MiniKdc conf dir kdc start FileUtils deleteDirectory dir numTries numTries
unsupportedServiceType service String command StringUtils join cmd LOG info command hostname conn join AsyncAdmin admin conn getAdmin ShellExecRequest req ShellExecRequest newBuilder setCommand command setAwaitResponse build ShellExecResponse resp service resp admin req targetHost admin hostname resp regionServerExec admin req targetHost LOG
String command StringUtils join cmd LOG info command hostname conn join AsyncAdmin admin conn getAdmin ShellExecRequest req ShellExecRequest newBuilder setCommand command setAwaitResponse build ShellExecResponse resp resp admin req targetHost admin hostname resp regionServerExec admin req targetHost LOG LOG debug command resp getExitCode resp getStdout
initial List IOException deferred ArrayList ServerName initMaster initial getMasterName ServerName initMaster getMasterName
initial current List IOException deferred ArrayList ServerName initMaster initial getMasterName ServerName initMaster current getMasterName LOG info initMaster getAddress current getMasterName getAddress initMaster initMaster
initMaster getHostname initMaster getPort LOG info initMaster getAddress startMaster initMaster getHostname initMaster getPort currentBackup current currentBackup initMaster LOG info currentBackup stopMaster currentBackup LOG info current getMasterName stopMaster current getMasterName waitForActiveAndReadyMaster ex deferred add ex getHostname getPort
ex deferred add ex Set ServerName toStart TreeSet ServerNameIgnoreStartCodeComparator Set ServerName toKill TreeSet ServerNameIgnoreStartCodeComparator toStart addAll initial getBackupMasterNames toKill addAll current getBackupMasterNames ServerName server current getBackupMasterNames toStart remove server ServerName server initial getBackupMasterNames toKill remove server ServerName sn toStart sn sn LOG info sn getAddress
server toStart remove server server toKill remove server List IOException deferred ArrayList sn toStart sn getHostname sn getPort getPort sn getPort LOG info sn getAddress startRegionServer sn getHostname sn getPort IOException ex deferred add ex sn toKill sn getHostname sn getPort getPort sn getPort
util IntegrationTestingUtility Configuration conf util getConfiguration regionsCountPerServer conf getInt REGION_COUNT_KEY DEFAULT_REGION_COUNT regionServerCount conf getInt REGIONSERVER_COUNT_KEY DEFAULT_REGIONSERVER_COUNT rowsInIteration conf getInt ROWS_PER_ITERATION_KEY DEFAULT_ROWS_IN_ITERATION numIterations conf getInt NUM_ITERATIONS_KEY DEFAULT_NUM_ITERATIONS numTables conf getInt NUMBER_OF_TABLES_KEY DEFAULT_NUMBER_OF_TABLES sleepTime conf getLong SLEEP_TIME_KEY SLEEP_TIME_DEFAULT enableBackup conf
tableName startTime endTime TableDescriptorBuilder builder TableDescriptorBuilder newBuilder tableName TableDescriptor desc builder build ColumnFamilyDescriptorBuilder cbuilder ColumnFamilyDescriptorBuilder newBuilder COLUMN_NAME getBytes Charset defaultCharset ColumnFamilyDescriptor columns ColumnFamilyDescriptor cbuilder build
tableName startTime endTime TableDescriptorBuilder builder TableDescriptorBuilder newBuilder tableName TableDescriptor desc builder build ColumnFamilyDescriptorBuilder cbuilder ColumnFamilyDescriptorBuilder newBuilder COLUMN_NAME getBytes Charset defaultCharset ColumnFamilyDescriptor columns ColumnFamilyDescriptor cbuilder build LOG info tableName regionsCountPerServer regionServerCount startTime System currentTimeMillis HBaseTestingUtility createPreSplitLoadTestTable util getConfiguration desc columns regionsCountPerServer util waitTableAvailable tableName endTime System currentTimeMillis
table List String backupIds ArrayList String List Integer tableSizes ArrayList Integer loadData table rowsInIteration tableSizes add rowsInIteration
request builder withBackupType BackupType INCREMENTAL withTableList tables withTargetRootDir BACKUP_ROOT_DIR build String backupId backup request client assertTrue checkSucceeded backupId backupIds add backupId String previousBackupId backupIds get backupIds size restoreVerifyTable conn client table previousBackupId rowsInIteration count restoreVerifyTable conn client table backupId rowsInIteration count String incBackupIds allIncremental backupIds merge incBackupIds client String backupId incBackupIds incBackupIds length TableName tablesRestoreIncMultiple TableName table restore createRestoreRequest BACKUP_ROOT_DIR backupId tablesRestoreIncMultiple client Table hTable conn getTable table Assert assertEquals util countRows hTable rowsInIteration numIterations hTable close
workers workers workers isEmpty worker workers Exception e worker getSavedException e
LOG info String runtimeKey String format RUN_TIME_KEY getClass getSimpleName runtime util getConfiguration getLong runtimeKey DEFAULT_RUN_TIME String numThreadKey String format NUM_THREADS_KEY getClass getSimpleName numThreads util getConfiguration getInt numThreadKey DEFAULT_NUM_THREADS ArrayList Worker workers ArrayList numThreads numThreads checkException workers Worker worker Worker
defaultRunTime keysPerServerPerIter colsPerKey recordSize writeThreads LOG info LOG info util getHBaseClusterInterface getClusterMetrics getLiveServerMetrics size start System currentTimeMillis String runtimeKey String format RUN_TIME_KEY getClass getSimpleName runtime util getConfiguration getLong runtimeKey defaultRunTime startKey numKeys getNumKeys keysPerServerPerIter System currentTimeMillis start runtime LOG info runtime runtime System currentTimeMillis start ret ret loadTool run getArgsForLoadTestTool String format colsPerKey recordSize writeThreads startKey numKeys ret String errorMsg ret
String runtimeKey String format RUN_TIME_KEY getClass getSimpleName runtime util getConfiguration getLong runtimeKey defaultRunTime startKey numKeys getNumKeys keysPerServerPerIter System currentTimeMillis start runtime LOG info runtime runtime System currentTimeMillis start ret ret loadTool run getArgsForLoadTestTool String format colsPerKey recordSize writeThreads startKey numKeys ret String errorMsg ret LOG error errorMsg Assert fail errorMsg ret loadTool run getArgsForLoadTestTool String format writeThreads startKey numKeys ret String errorMsg ret
LOG info runtime runtime System currentTimeMillis start ret ret loadTool run getArgsForLoadTestTool String format colsPerKey recordSize writeThreads startKey numKeys ret String errorMsg ret LOG error errorMsg Assert fail errorMsg ret loadTool run getArgsForLoadTestTool String format writeThreads startKey numKeys ret String errorMsg ret LOG error errorMsg Assert fail errorMsg ret loadTool run getArgsForLoadTestTool String format readThreads startKey numKeys ret String errorMsg ret
String errorMsg ret LOG error errorMsg Assert fail errorMsg ret loadTool run getArgsForLoadTestTool String format writeThreads startKey numKeys ret String errorMsg ret LOG error errorMsg Assert fail errorMsg ret loadTool run getArgsForLoadTestTool String format readThreads startKey numKeys ret String errorMsg ret LOG error errorMsg Threads sleep ret loadTool run getArgsForLoadTestTool String format readThreads startKey numKeys ret
Configuration conf util getConfiguration String timeoutKey String format TIMEOUT_KEY getClass getSimpleName maxRuntime conf getLong timeoutKey DEFAULT_TIMEOUT_MINUTES serverCount util getHBaseClusterInterface getClusterMetrics getLiveServerMetrics size keysToWrite serverCount KEYS_TO_WRITE_PER_SERVER Connection connection ConnectionFactory createConnection conf Table table connection getTable TABLE_NAME MultiThreadedWriter writer MultiThreadedWriter dataGen conf TABLE_NAME writer setMultiPut
Configuration conf util getConfiguration String timeoutKey String format TIMEOUT_KEY getClass getSimpleName maxRuntime conf getLong timeoutKey DEFAULT_TIMEOUT_MINUTES serverCount util getHBaseClusterInterface getClusterMetrics getLiveServerMetrics size keysToWrite serverCount KEYS_TO_WRITE_PER_SERVER Connection connection ConnectionFactory createConnection conf Table table connection getTable TABLE_NAME MultiThreadedWriter writer MultiThreadedWriter dataGen conf TABLE_NAME writer setMultiPut LOG info keysToWrite writer start keysToWrite WRITER_THREADS now EnvironmentEdgeManager currentTime timeLimit now maxRuntime isWriterDone now timeLimit isWriterDone
onesGennedBeforeScan dataGen getExpectedNumberOfKeys startTs EnvironmentEdgeManager currentTime ResultScanner results table getScanner scan resultCount Result result result results isOk writer verifyResultAgainstDataGenerator result Assert assertTrue Bytes toString result getRow isOk resultCount timeTaken EnvironmentEdgeManager currentTime startTs onesGennedAfterScan dataGen getExpectedNumberOfKeys Assert assertTrue resultCount onesGennedAfterScan onesGennedAfterScan resultCount Assert assertTrue resultCount onesGennedAfterScan onesGennedAfterScan resultCount onesGennedBeforeScan resultCount
LOG info String format REGION_SERVER_COUNT UTIL initializeCluster REGION_SERVER_COUNT LOG info admin UTIL getAdmin admin
LOG info String format REGION_SERVER_COUNT UTIL initializeCluster REGION_SERVER_COUNT LOG info admin UTIL getAdmin admin TABLE_NAME LOG info String format TABLE_NAME admin isTableEnabled TABLE_NAME admin disableTable TABLE_NAME admin deleteTable TABLE_NAME
ColumnFamilyDescriptor columnFamilyDescriptor ColumnFamilyDescriptorBuilder newBuilder Bytes toBytes build TableDescriptor tableDescriptor TableDescriptorBuilder newBuilder TABLE_NAME setColumnFamily columnFamilyDescriptor build SplitAlgorithm algo RegionSplitter HexStringSplit splits algo split REGION_COUNT
ColumnFamilyDescriptor columnFamilyDescriptor ColumnFamilyDescriptorBuilder newBuilder Bytes toBytes build TableDescriptor tableDescriptor TableDescriptorBuilder newBuilder TABLE_NAME setColumnFamily columnFamilyDescriptor build SplitAlgorithm algo RegionSplitter HexStringSplit splits algo split REGION_COUNT LOG info String format TABLE_NAME REGION_COUNT startTime System currentTimeMillis admin createTable tableDescriptor splits
util getTestingUtil getConf conf util getConfiguration initConf conf regionServerCount conf getInt REGIONSERVER_COUNT_KEY DEFAULT_REGIONSERVER_COUNT
conf tableName family FileSystem fs FileSystem get conf Path dir MobUtils getMobFamilyPath conf tableName family FileStatus stat fs listStatus dir FileStatus stat
Result result ResultScanner scanner table getScanner fam counter result scanner assertTrue Arrays equals result getValue fam qualifier mobVal counter
stat sum count r assertNotNull r hist sum stat apply r hist count
maxIters String replicas replicaCount String splitPolicy DisabledRegionSplitPolicy getName String writeOpts format splitPolicy tableName String readOpts format tableName String replicaReadOpts format replicas readOpts ArrayList TimingResult resultsWithoutReplicas ArrayList maxIters ArrayList TimingResult resultsWithReplicas ArrayList maxIters LOG debug PerfEvalCallable util getAdmin writeOpts call assertEquals DisabledRegionSplitPolicy getName util getAdmin getDescriptor tableName getRegionSplitPolicyClassName startMonkey maxIters
String splitPolicy DisabledRegionSplitPolicy getName String writeOpts format splitPolicy tableName String readOpts format tableName String replicaReadOpts format replicas readOpts ArrayList TimingResult resultsWithoutReplicas ArrayList maxIters ArrayList TimingResult resultsWithReplicas ArrayList maxIters LOG debug PerfEvalCallable util getAdmin writeOpts call assertEquals DisabledRegionSplitPolicy getName util getAdmin getDescriptor tableName getRegionSplitPolicyClassName startMonkey i i maxIters i LOG debug i maxIters resultsWithoutReplicas add PerfEvalCallable util getAdmin readOpts call Thread sleep cleanUpMonkey
ArrayList TimingResult resultsWithReplicas ArrayList maxIters LOG debug PerfEvalCallable util getAdmin writeOpts call assertEquals DisabledRegionSplitPolicy getName util getAdmin getDescriptor tableName getRegionSplitPolicyClassName startMonkey i i maxIters i LOG debug i maxIters resultsWithoutReplicas add PerfEvalCallable util getAdmin readOpts call Thread sleep cleanUpMonkey LOG debug tableName replicaCount IntegrationTestingUtility setReplicas util getAdmin tableName replicaCount setUpMonkey startMonkey i i maxIters i
ret regionReplicaId conf getInt String format TEST_NAME LoadTestTool OPT_REGION_REPLICA_ID List String args Lists newArrayList getArgsForLoadTestTool startKey numKeys args add args add String format colsPerKey recordSize writeThreads args add LoadTestTool OPT_MULTIPUT args add args add DelayingMultiThreadedWriter getName args add args add String format verifyPercent readThreads args add LoadTestTool OPT_REGION_REPLICA_ID args add String valueOf regionReplicaId ret loadTool run args toArray String args size ret String errorMsg ret
String errorMsg ret LOG error errorMsg Assert fail errorMsg args Lists newArrayList getArgsForLoadTestTool startKey numKeys args add args add String format updatePercent writeThreads args add args add DelayingMultiThreadedUpdater getName args add args add String format verifyPercent readThreads args add LoadTestTool OPT_REGION_REPLICA_ID args add String valueOf regionReplicaId ret loadTool run args toArray String args size ret String errorMsg ret
IntegrationTestingUtility setUseDistributedCluster conf Class classes findIntegrationTestClasses
IntegrationTestingUtility setUseDistributedCluster conf Class classes findIntegrationTestClasses LOG info classes length Class classes
val isActive val get getAsBoolean isActive
val isActive val get getAsBoolean isActive
ServerName servers ServerName destServerName servers RandomUtils nextInt servers length
suspendedServers action SuspendOrResume RESUME action RandomUtils nextBoolean SuspendOrResume SUSPEND SuspendOrResume RESUME ServerName server action SUSPEND server suspendRs server e LOG warn e getExitCode e suspendedServers add server RESUME server suspendedServers
MonkeyFactory factoryName MonkeyFactory fact FACTORIES get factoryName fact factoryName factoryName Class klass klass Class forName factoryName klass
jitter RandomUtils nextInt periodMs
jitter RandomUtils nextInt periodMs LOG info jitter Threads sleep jitter isStopped start System currentTimeMillis runOneIteration isStopped sleepTime periodMs System currentTimeMillis start sleepTime
i i i String clientId i LOG info clientId SimpleClient client SimpleClient cluster rpcClient clientId client start clients add client LOG info MiniChaosMonkey cm MiniChaosMonkey cluster cm start Threads sleep LOG info cm stopRunning cm join cm rethrowException LOG info
String clientId i LOG info clientId SimpleClient client SimpleClient cluster rpcClient clientId client start clients add client LOG info MiniChaosMonkey cm MiniChaosMonkey cluster cm start Threads sleep LOG info cm stopRunning cm join cm rethrowException LOG info SimpleClient client clients
setupTable numImportRounds getConf getInt NUM_IMPORT_ROUNDS_KEY NUM_IMPORT_ROUNDS
util getTestingUtil getConf util initializeCluster replicaCount getConf getInt NUM_REPLICA_COUNT_KEY NUM_REPLICA_COUNT_DEFAULT replicaCount NUM_REPLICA_COUNT_DEFAULT
hfiles tableName String args hfiles toString tableName getNameAsString
maxIters util getHBaseClusterInterface isDistributedCluster
Future TimingResult putFuture executorService submit PutCallable monkeyFuture Future TimingResult scanFuture executorService submit ScanCallable monkeyFuture Future TimingResult adminFuture executorService submit AdminCallable monkeyFuture Future Boolean loadFuture executorService submit LoadCallable monkeyFuture monkeyFuture get loadFuture get TimingResult putTime putFuture get TimingResult scanTime scanFuture get TimingResult adminTime adminFuture get resultPuts add putTime resultScan add scanTime resultAdmin add adminTime Thread sleep runtimeMs TimeUnit MILLISECONDS convert System nanoTime start TimeUnit NANOSECONDS
monkeyFuture get loadFuture get TimingResult putTime putFuture get TimingResult scanTime scanFuture get TimingResult adminTime adminFuture get resultPuts add putTime resultScan add scanTime resultAdmin add adminTime Thread sleep e runtimeMs TimeUnit MILLISECONDS convert System nanoTime start TimeUnit NANOSECONDS LOG info testName runtimeMs e e runtimeMs TimeUnit MILLISECONDS convert System nanoTime start TimeUnit NANOSECONDS MoreObjects ToStringHelper helper MoreObjects toStringHelper add resultPuts add resultScan add resultAdmin add runtimeMs add testName
Path outputDir getTestDir TEST_NAME
Path outputDir getTestDir TEST_NAME
keysDir Path inputDir Path keysDir getConf set SEARCHER_INPUTDIR_KEY inputDir toString SortedSet keys readKeysToSearch getConf keys isEmpty RuntimeException
keysDir Path inputDir Path keysDir getConf set SEARCHER_INPUTDIR_KEY inputDir toString SortedSet keys readKeysToSearch getConf keys isEmpty RuntimeException LOG info keys size key keys LOG info Bytes toStringBinary key Path walsDir Path CommonFSUtils getWALRootDir getConf HConstants HREGION_LOGDIR_NAME Path oldWalsDir Path CommonFSUtils getWALRootDir getConf HConstants HREGION_OLDLOGDIR_NAME
colsPerKey recordSize writeThreads startKey numKeys ret loadTool run getArgsForLoadTestTool String format colsPerKey recordSize writeThreads startKey numKeys ret String errorMsg ret
defaultRunTime keysPerServerPerIter colsPerKey recordSize writeThreads LOG info util getHBaseClusterInterface getClusterMetrics getLiveServerMetrics size start System currentTimeMillis String runtimeKey String format RUN_TIME_KEY getClass getSimpleName runtime util getConfiguration getLong runtimeKey defaultRunTime startKey numKeys getNumKeys keysPerServerPerIter LOG info writeData colsPerKey recordSize writeThreads startKey numKeys LOG info Admin admin util getAdmin admin flush getTablename refreshTime conf getLong StorefileRefresherChore REGIONSERVER_STOREFILE_REFRESH_PERIOD refreshTime refreshTime
ZKWatcher watcher ZKWatcher conf RecoverableZooKeeper zk ZKUtil connect conf watcher String baseZNode watcher getZNodePaths baseZNode LOG info LOG info
Path rootDir CommonFSUtils getRootDir conf LOG info LOG info
exception IOException INITIALIZATION_ERROR exception startKeys regionLocator getStartKeys startKeys startKeys length IOException length IOException realNumSplits numSplits startKeys length startKeys length numSplits InputSplit splits InputSplit realNumSplits middle startKeys length realNumSplits startPos i i realNumSplits i lastPos startPos middle lastPos startKeys length realNumSplits i lastPos lastPos String regionLocation regionLocator getRegionLocation startKeys startPos getHostname
job setInputFormat inputFormat job setMapOutputValueClass outputValueClass job setMapOutputKeyClass outputKeyClass job setMapperClass mapper job setStrings job get MutationSerialization getName ResultSerialization getName FileInputFormat addInputPaths job table job set TableInputFormat COLUMN_LIST columns addDependencyJars addDependencyJars job e LOG error e initCredentials job
endRow endRow trrRowFilter Scan scan Scan withStartRow firstRow withStopRow endRow TableInputFormat addColumns scan trrInputColumns scan setFilter trrRowFilter scan setCacheBlocks scanner htable getScanner scan currentScan scan LOG debug Bytes toStringBinary firstRow Bytes toStringBinary endRow Scan scan Scan withStartRow firstRow withStopRow endRow TableInputFormat addColumns scan trrInputColumns scanner htable getScanner scan currentScan scan
currentScan scan LOG debug Bytes toStringBinary firstRow Bytes toStringBinary endRow Scan scan Scan withStartRow firstRow withStopRow endRow TableInputFormat addColumns scan trrInputColumns scanner htable getScanner scan currentScan scan LOG debug Bytes toStringBinary firstRow Scan scan Scan withStartRow firstRow TableInputFormat addColumns scan trrInputColumns scan setFilter trrRowFilter scanner htable getScanner scan currentScan scan
next Result Result result result scanner next rowcount rowcount now System currentTimeMillis
args Job job createSubmittableJob args job job LOG info LOG info code LOG info dstTableName LOG info BulkLoadHFilesTool NAME bulkloadDir toString dstTableName getConf dstTableName bulkloadDir FileSystem fs CommonFSUtils getCurrentFileSystem getConf fs bulkloadDir
LOG error e Scan scan Scan scan setAuthorizations Authorizations VisibilityUtils SYSTEM_LABEL scan addColumn LABELS_TABLE_FAMILY LABEL_QUALIFIER ResultScanner scanner scanner labelsTable getScanner scan Result next next scanner next row next getRow value next getValue LABELS_TABLE_FAMILY LABEL_QUALIFIER labels put Bytes toString value Bytes toInt row e
exportFilter LOG info s setFilter exportFilter List String labels conf EXPORT_VISIBILITY_LABELS labels Arrays asList conf getStrings EXPORT_VISIBILITY_LABELS labels s setAuthorizations Authorizations labels batching conf getInt EXPORT_BATCHING batching s setBatch batching e LOG error e caching conf getInt EXPORT_CACHING
s setFilter exportFilter List String labels conf EXPORT_VISIBILITY_LABELS labels Arrays asList conf getStrings EXPORT_VISIBILITY_LABELS labels s setAuthorizations Authorizations labels batching conf getInt EXPORT_BATCHING batching s setBatch batching e LOG error e caching conf getInt EXPORT_CACHING caching
writerPath Path outputDir Bytes toString family fs mkdirs writerPath configureStoragePolicy conf fs tableAndFamily writerPath wl wl Bytes family rowKey rollWriters wl wl wl InetSocketAddress favoredNodes conf HRegionLocation loc String tableName Bytes toString tableNameBytes tableName conf locator tableName loc locator getRegionLocation rowKey
ImmutableBytesWritable ArrayList ImmutableBytesWritable ret ArrayList regionLocator TableName tableName regionLocator getName
LOG info List String allTableNames ArrayList multiTableInfo size List RegionLocator regionLocators ArrayList multiTableInfo size List TableDescriptor tableDescriptors ArrayList multiTableInfo size tableInfo multiTableInfo regionLocators add tableInfo getRegionLocator String tn writeMultipleTables tableInfo getRegionLocator getName getNameWithNamespaceInclAsString tableInfo getRegionLocator getName getNameAsString allTableNames add tn tableDescriptors add tableInfo getTableDescriptor conf set OUTPUT_TABLE_NAME_CONF_KEY StringUtils join allTableNames Bytes toString tableSeparator List ImmutableBytesWritable startKeys getRegionStartKeys regionLocators writeMultipleTables LOG info startKeys size job setNumReduceTasks startKeys size configurePartitioner job startKeys writeMultipleTables conf set COMPRESSION_FAMILIES_CONF_KEY serializeColumnFamilyAttribute compressionDetails tableDescriptors
job TableDescriptor tableDescriptor Configuration conf job getConfiguration job setOutputKeyClass ImmutableBytesWritable job setOutputValueClass MapReduceExtendedCell job setOutputFormatClass HFileOutputFormat2 ArrayList TableDescriptor singleTableDescriptor ArrayList singleTableDescriptor add tableDescriptor conf set OUTPUT_TABLE_NAME_CONF_KEY tableDescriptor getTableName getNameAsString conf set COMPRESSION_FAMILIES_CONF_KEY serializeColumnFamilyAttribute compressionDetails singleTableDescriptor conf set BLOCK_SIZE_FAMILIES_CONF_KEY serializeColumnFamilyAttribute blockSizeDetails singleTableDescriptor conf set BLOOM_TYPE_FAMILIES_CONF_KEY serializeColumnFamilyAttribute bloomTypeDetails singleTableDescriptor conf set BLOOM_PARAM_FAMILIES_CONF_KEY serializeColumnFamilyAttribute bloomParamDetails singleTableDescriptor conf set DATABLOCK_ENCODING_FAMILIES_CONF_KEY serializeColumnFamilyAttribute dataBlockEncodingDetails singleTableDescriptor TableMapReduceUtil addDependencyJars job TableMapReduceUtil initCredentials job
Connection connection ConnectionFactory createConnection getConf Pair regionKeys connection getRegionLocator TableName valueOf tableHash tableName getStartEndKeys connection close tableHash selectPartitions regionKeys
Filter conf Class Filter filterClass conf getClass FILTER_CLASS_CONF_KEY Filter filterClass LOG debug LOG debug filterClass String filterArgs conf getStrings FILTER_ARGS_CONF_KEY ArrayList quotedArgs toQuotedByteArrays filterArgs Method m filterClass getMethod ArrayList Filter m invoke quotedArgs e LOG error e RuntimeException e e
LOG debug LOG debug filterClass String filterArgs conf getStrings FILTER_ARGS_CONF_KEY ArrayList quotedArgs toQuotedByteArrays filterArgs Method m filterClass getMethod ArrayList Filter m invoke quotedArgs e LOG error e RuntimeException e e LOG error e RuntimeException e e
LOG debug filterClass String filterArgs conf getStrings FILTER_ARGS_CONF_KEY ArrayList quotedArgs toQuotedByteArrays filterArgs Method m filterClass getMethod ArrayList Filter m invoke quotedArgs e LOG error e RuntimeException e e LOG error e RuntimeException e e LOG error e RuntimeException e
Method m filterClass getMethod ArrayList Filter m invoke quotedArgs e LOG error e RuntimeException e e LOG error e RuntimeException e e LOG error e RuntimeException e e LOG error e RuntimeException e
split TableSplit tSplit TableSplit split
conf String Path Path rootDir CommonFSUtils getRootDir conf String Path entry String snapshotName entry getKey Path restoreDir entry getValue
context outer context numberOfThreads getNumberOfThreads context mapClass getMapperClass context
familyMap put getFamilyCellMap List Cell entry getFamilyCellMap List Cell cells familyMap get entry getKey List Cell kvs cells List Cell cells Cell cell entry getValue KeyValue kv KeyValueUtil ensureKeyValue cell curSize kv heapSize kvs kvs add kv cells familyMap put entry getKey entry getValue cnt context setStatus cnt curSize
KeyValue kv KeyValueUtil ensureKeyValue cell curSize kv heapSize kvs kvs add kv familyMap put entry getKey entry getValue cnt context setStatus cnt curSize LOG LOG debug String format cnt context write row put put curSize cnt put
regionLocator LOG info regionLocator getName LOG info LOG info regionLocator getName Set ServerName tableServers getRegionServersOfTable regionLocator ServerName tableServers regionLoad regionLocator getName regionId regionLoad getRegionName regionSizeBytes regionLoad getStoreFileSize get Size Unit MEGABYTE MEGABYTE sizeMap put regionId regionSizeBytes LOG
regionId Long size sizeMap get regionId size
reduces reduces reduces splits Bytes split startkey endkey reduces splits
startRow scan getStartRow stopRow scan getStopRow startRow length keys getSecond i length Bytes compareTo startRow keys getSecond i stopRow length Bytes compareTo stopRow keys getFirst i splitStart startRow length Bytes compareTo keys getFirst i startRow keys getFirst i startRow splitStop stopRow length Bytes compareTo keys getSecond i stopRow keys getSecond i length keys getSecond i stopRow HRegionLocation location getRegionLocator getRegionLocation keys getFirst i InetSocketAddress isa InetSocketAddress location getHostname location getPort isa LOG warn isa InetAddress regionAddress isa getAddress String regionLocation regionLocation reverseDNS regionAddress regionName location getRegion getRegionName String encodedRegionName location getRegion getEncodedName regionSize sizeCalculator getRegionSize regionName
otherConf String tableName otherConf get OUTPUT_TABLE tableName tableName IllegalArgumentException String address otherConf get QUORUM_ADDRESS zkClientPort otherConf getInt QUORUM_PORT String serverClass otherConf get REGION_SERVER_CLASS String serverImpl otherConf get REGION_SERVER_IMPL conf HBaseConfiguration createClusterConf otherConf address OUTPUT_CONF_PREFIX serverClass conf set HConstants REGION_SERVER_IMPL serverImpl zkClientPort conf setInt HConstants ZOOKEEPER_CLIENT_PORT zkClientPort
value scanner next value value numStale rowcount rowcount now System currentTimeMillis LOG info now timestamp rowcount timestamp now rowcount updateCounters
List FileStatus List FileStatus result ArrayList
List FileStatus result ArrayList LOG debug dir toString RemoteIterator LocatedFileStatus iter fs listLocatedStatus dir iter hasNext Collections emptyList iter hasNext LocatedFileStatus file iter next file result addAll getFiles fs file getPath startTime endTime String name file getPath toString idx name lastIndexOf idx fileStartTime Long parseLong name substring idx fileStartTime endTime
args tableMap args split tableMap tables IOException tableMap tables conf setStrings TABLES_KEY tables conf setStrings TABLE_MAP_KEY tableMap conf set FileInputFormat INPUT_DIR inputDirs Job job Job getInstance conf conf get JOB_NAME_CONF_KEY NAME System currentTimeMillis job setJarByClass WALPlayer job setInputFormatClass WALInputFormat job setMapOutputKeyClass ImmutableBytesWritable String hfileOutPath conf get BULK_OUTPUT_CONF_KEY hfileOutPath
String output args String tableName args String familyName args reportStartTime EnvironmentEdgeManager currentTime Configuration conf getConf FileSystem fs FileSystem get conf String currentUserName UserGroupInformation getCurrentUser getShortUserName FileStatus hbaseRootFileStat fs listStatus Path conf get HConstants HBASE_DIR hbaseRootFileStat String owner hbaseRootFileStat getOwner owner currentUserName String errorMsg currentUserName LOG warn errorMsg
String id getClass getSimpleName UUID randomUUID toString replace Job job Scan scan Scan scan addFamily family scan setAttribute MobConstants MOB_SCAN_RAW Bytes toBytes Boolean TRUE scan setAttribute MobConstants MOB_SCAN_REF_ONLY Bytes toBytes Boolean TRUE scan setCaching conf getInt HConstants HBASE_CLIENT_SCANNER_CACHING scan setCacheBlocks scan readVersions maxVersions conf set REPORT_JOB_ID id job Job getInstance conf job setJarByClass getClass TableMapReduceUtil initTableMapperJob tn scan MobRefMapper Text ImmutableBytesWritable job job setReducerClass MobRefReducer job setOutputFormatClass TextOutputFormat
List Pair SnapshotFileInfo Long fs snapshotDir SnapshotDescription snapshotDesc SnapshotDescriptionUtils readSnapshotInfo fs snapshotDir List Pair SnapshotFileInfo Long files ArrayList TableName table TableName valueOf snapshotDesc getTable
g fileGroups group LinkedList fileGroups add group group fileGroups get g Pair SnapshotFileInfo Long fileInfo files get hi sizeGroups g fileInfo getSecond group add fileInfo g dir g ngroups dir g ngroups g dir g
targetName targetName snapshotName inputRoot inputRoot CommonFSUtils getRootDir conf CommonFSUtils setRootDir conf inputRoot Configuration srcConf HBaseConfiguration createClusterConf conf CONF_SOURCE_PREFIX srcConf setBoolean inputRoot toUri getScheme FileSystem inputFs FileSystem get inputRoot toUri srcConf Configuration destConf HBaseConfiguration createClusterConf conf CONF_DEST_PREFIX destConf setBoolean outputRoot toUri getScheme FileSystem outputFs FileSystem get outputRoot toUri destConf skipTmp conf getBoolean CONF_SKIP_TMP conf get SnapshotDescriptionUtils SNAPSHOT_WORKING_DIR Path snapshotDir SnapshotDescriptionUtils getCompletedSnapshotDir snapshotName inputRoot Path snapshotTmpDir SnapshotDescriptionUtils getWorkingSnapshotDir targetName outputRoot destConf
targetName snapshotName inputRoot inputRoot CommonFSUtils getRootDir conf CommonFSUtils setRootDir conf inputRoot Configuration srcConf HBaseConfiguration createClusterConf conf CONF_SOURCE_PREFIX srcConf setBoolean inputRoot toUri getScheme FileSystem inputFs FileSystem get inputRoot toUri srcConf Configuration destConf HBaseConfiguration createClusterConf conf CONF_DEST_PREFIX destConf setBoolean outputRoot toUri getScheme FileSystem outputFs FileSystem get outputRoot toUri destConf skipTmp conf getBoolean CONF_SKIP_TMP conf get SnapshotDescriptionUtils SNAPSHOT_WORKING_DIR Path snapshotDir SnapshotDescriptionUtils getCompletedSnapshotDir snapshotName inputRoot Path snapshotTmpDir SnapshotDescriptionUtils getWorkingSnapshotDir targetName outputRoot destConf Path outputSnapshotDir SnapshotDescriptionUtils getCompletedSnapshotDir targetName outputRoot
LOG info snapshotDir initialOutputSnapshotDir travesedPaths FSUtils copyFilesParallel inputFs snapshotDir outputFs initialOutputSnapshotDir conf conf getInt CONF_COPY_MANIFEST_THREADS DEFAULT_COPY_MANIFEST_THREADS copySucceeded e ExportSnapshotException snapshotDir initialOutputSnapshotDir e copySucceeded filesUser filesGroup LOG warn filesUser needSetOwnerDir filesUser filesGroup needSetOwnerDir filesGroup setOwnerParallel outputFs filesUser filesGroup conf travesedPaths filesMode LOG warn needSetOwnerDir filesMode setPermissionParallel outputFs filesMode travesedPaths conf
IllegalStateException TableDescriptor desc exists admin getDescriptor TableName valueOf opts tableName splits getSplits opts exists opts presplitRegions presplitRegions isReadCmd desc desc opts splitPolicy isReadCmd desc desc opts replicas desc desc opts families needsDelete LOG debug MoreObjects toStringHelper add needsDelete add isReadCmd add exists add desc add opts presplitRegions add opts splitPolicy add opts replicas add opts families toString needsDelete admin tableName admin disableTable tableName admin deleteTable tableName exists needsDelete desc getTableDescriptor opts splits LOG splits
LOG debug MoreObjects toStringHelper add needsDelete add isReadCmd add exists add desc add opts presplitRegions add opts splitPolicy add opts replicas add opts families toString needsDelete admin tableName admin disableTable tableName admin deleteTable tableName exists needsDelete desc getTableDescriptor opts splits LOG i i splits i LOG debug i Bytes toStringBinary splits i splits admin createTable desc splits admin createTable desc
Path jobdir Path Path basedir PERF_EVAL_DIR formatter format Date Path inputDir Path jobdir FileSystem fs FileSystem get c fs mkdirs inputDir Path inputFile Path inputDir JOB_INPUT_FILENAME PrintStream out PrintStream fs create inputFile Map Integer String m TreeMap Hash h MurmurHash getInstance perClientRows opts totalRows opts numClientThreads j j opts numClientThreads j TestOptions next TestOptions opts next startRow j perClientRows next perClientRunRows perClientRows String s GSON toJson next
jobName scans JobConf job JobConf TEST_UTIL getConfiguration job setJobName jobName job setMapperClass Mapper job setReducerClass Reducer TableMapReduceUtil initMultiTableSnapshotMapperJob getSnapshotScanMapping scans Mapper ImmutableBytesWritable ImmutableBytesWritable job restoreDir TableMapReduceUtil addDependencyJars job job setReducerClass Reducer job setNumReduceTasks FileOutputFormat setOutputPath job Path job getJobName
runJob jobName scans JobConf job JobConf TEST_UTIL getConfiguration job setJobName jobName job setMapperClass Mapper job setReducerClass Reducer TableMapReduceUtil initMultiTableSnapshotMapperJob getSnapshotScanMapping scans Mapper ImmutableBytesWritable ImmutableBytesWritable job restoreDir TableMapReduceUtil addDependencyJars job job setReducerClass Reducer job setNumReduceTasks FileOutputFormat setOutputPath job Path job getJobName LOG info job getJobName RunningJob runningJob JobClient runJob job runningJob waitForCompletion assertTrue runningJob isSuccessful
table JobConf jobConf LOG info jobConf JobConf UTIL getConfiguration TestTableMapReduce jobConf setJobName jobConf setNumReduceTasks TableMapReduceUtil initTableMapJob table getName getNameAsString Bytes toString INPUT_FAMILY ProcessContentsMapper ImmutableBytesWritable Put jobConf TableMapReduceUtil initTableReduceJob table getName getNameAsString IdentityTableReduce jobConf
String start String stop String String jobName start start toUpperCase Locale ROOT stop stop toUpperCase Locale ROOT
String jobName start start toUpperCase Locale ROOT stop stop toUpperCase Locale ROOT LOG info jobName Configuration c Configuration TEST_UTIL getConfiguration c set KEY_STARTROW start start c set KEY_LASTROW last last List Scan scans ArrayList String tableName Scan scan Scan scan addFamily INPUT_FAMILY scan setAttribute Scan SCAN_ATTRIBUTES_TABLE_NAME Bytes toBytes tableName start scan withStartRow Bytes toBytes start stop scan withStopRow Bytes toBytes stop scans add scan
jobName c scans Job job Job c jobName initJob scans job job setReducerClass ScanReducer job setNumReduceTasks FileOutputFormat setOutputPath job Path job getJobName
jobName c scans Job job Job c jobName initJob scans job job setReducerClass ScanReducer job setNumReduceTasks FileOutputFormat setOutputPath job Path job getJobName LOG info job getJobName job waitForCompletion assertTrue job isSuccessful
Configuration conf Configuration util getConfiguration RecordWriter ImmutableBytesWritable Cell writer TaskAttemptContext context Path dir util getDataTestDir
assertEquals original kv kv KeyValue b b b b original kv clone writer write ImmutableBytesWritable kv assertEquals original kv writer close context FileSystem fs FileSystem get conf Path attemptDirectory hof getDefaultWorkFile context getParent FileStatus sub1 fs listStatus attemptDirectory FileStatus file fs listStatus sub1 getPath HFile Reader rd HFile createReader fs file getPath CacheConfig conf conf Map finfo rd getHFileInfo range finfo get Bytes toBytes assertNotNull range TimeRangeTracker timeRangeTracker TimeRangeTracker parseFrom range
util HBaseTestingUtility Configuration conf util getConfiguration conf set HFileOutputFormat2 STORAGE_POLICY_PROPERTY conf set HFileOutputFormat2 STORAGE_POLICY_PROPERTY_CF_PREFIX Bytes toString HFileOutputFormat2 combineTableNameSuffix TABLE_NAMES getName FAMILIES Path cf1Dir Path util getDataTestDir Bytes toString FAMILIES Path cf2Dir Path util getDataTestDir Bytes toString FAMILIES util startMiniDFSCluster FileSystem fs util getDFSCluster getFileSystem fs mkdirs cf1Dir fs mkdirs cf2Dir String spA getStoragePolicyName fs cf1Dir String spB getStoragePolicyName fs cf2Dir
util HBaseTestingUtility Configuration conf util getConfiguration conf set HFileOutputFormat2 STORAGE_POLICY_PROPERTY conf set HFileOutputFormat2 STORAGE_POLICY_PROPERTY_CF_PREFIX Bytes toString HFileOutputFormat2 combineTableNameSuffix TABLE_NAMES getName FAMILIES Path cf1Dir Path util getDataTestDir Bytes toString FAMILIES Path cf2Dir Path util getDataTestDir Bytes toString FAMILIES util startMiniDFSCluster FileSystem fs util getDFSCluster getFileSystem fs mkdirs cf1Dir fs mkdirs cf2Dir String spA getStoragePolicyName fs cf1Dir String spB getStoragePolicyName fs cf2Dir LOG debug spA
util startMiniDFSCluster FileSystem fs util getDFSCluster getFileSystem fs mkdirs cf1Dir fs mkdirs cf2Dir String spA getStoragePolicyName fs cf1Dir String spB getStoragePolicyName fs cf2Dir LOG debug spA LOG debug spB assertEquals spA assertEquals spB HFileOutputFormat2 configureStoragePolicy conf fs HFileOutputFormat2 combineTableNameSuffix TABLE_NAMES getName FAMILIES cf1Dir HFileOutputFormat2 configureStoragePolicy conf fs HFileOutputFormat2 combineTableNameSuffix TABLE_NAMES getName FAMILIES cf2Dir spA getStoragePolicyName fs cf1Dir spB getStoragePolicyName fs cf2Dir
FileSystem fs util getDFSCluster getFileSystem fs mkdirs cf1Dir fs mkdirs cf2Dir String spA getStoragePolicyName fs cf1Dir String spB getStoragePolicyName fs cf2Dir LOG debug spA LOG debug spB assertEquals spA assertEquals spB HFileOutputFormat2 configureStoragePolicy conf fs HFileOutputFormat2 combineTableNameSuffix TABLE_NAMES getName FAMILIES cf1Dir HFileOutputFormat2 configureStoragePolicy conf fs HFileOutputFormat2 combineTableNameSuffix TABLE_NAMES getName FAMILIES cf2Dir spA getStoragePolicyName fs cf1Dir spB getStoragePolicyName fs cf2Dir LOG debug spA
fs makeQualified fs getHomeDirectory ioe LOG error ioe Job job Mockito mock Job Mockito doReturn conf when job getConfiguration ImmutableBytesWritable writable ImmutableBytesWritable List ImmutableBytesWritable splitPoints LinkedList ImmutableBytesWritable splitPoints add writable HFileOutputFormat2 configurePartitioner job splitPoints ioe
MapFile Reader reader MapFile Reader hashPath fs getConf ImmutableBytesWritable key ImmutableBytesWritable ImmutableBytesWritable hash ImmutableBytesWritable reader key hash String keyString Bytes toHex key get key getOffset key getLength LOG debug keyString isEmpty Integer parseInt keyString Bytes toHex hash get hash getOffset hash getLength intKey key getLength intKey Bytes toInt key get key getOffset key getLength actualHashes intKey Assert fail intKey actualHashes put intKey ImmutableBytesWritable hash copyBytes reader close FileStatus files fs listStatus testDir FileStatus files
ImmutableBytesWritable hash ImmutableBytesWritable reader key hash String keyString Bytes toHex key get key getOffset key getLength LOG debug keyString isEmpty Integer parseInt keyString Bytes toHex hash get hash getOffset hash getLength intKey key getLength intKey Bytes toInt key get key getOffset key getLength actualHashes intKey Assert fail intKey actualHashes put intKey ImmutableBytesWritable hash copyBytes reader close FileStatus files fs listStatus testDir FileStatus file files LOG debug file getPath files fs listStatus dataDir
util String String data String args String table args args length Configuration conf Configuration util getConfiguration FileSystem fs FileSystem get conf Path inputPath fs makeQualified Path util getDataTestDirOnTestFS table FSDataOutputStream op fs create inputPath op write Bytes toBytes data op close
Tool util String String data String args String table args args length Configuration conf Configuration util getConfiguration FileSystem fs FileSystem get conf Path inputPath fs makeQualified Path util getDataTestDirOnTestFS table FSDataOutputStream op fs create inputPath op write Bytes toBytes data op close LOG debug String format inputPath conf LOG debug conf setInt List String argv ArrayList Arrays asList args argv add inputPath toString Tool tool ImportTsv
conf tableName family LOG debug Connection connection ConnectionFactory createConnection conf Table table connection getTable tableName verified pause conf getLong numRetries conf getInt HConstants HBASE_CLIENT_RETRIES_NUMBER numRetries Scan scan Scan scan addFamily Bytes toBytes family ResultScanner resScanner table getScanner scan resScanner
util data args TableName table TableName valueOf args args length Configuration conf Configuration util getConfiguration FileSystem fs FileSystem get conf Path inputPath fs makeQualified Path util getDataTestDirOnTestFS table getNameAsString FSDataOutputStream op fs create inputPath op write Bytes toBytes data op close
Tool util String String data String args TableName table TableName valueOf args args length Configuration conf Configuration util getConfiguration FileSystem fs FileSystem get conf Path inputPath fs makeQualified Path util getDataTestDirOnTestFS table getNameAsString FSDataOutputStream op fs create inputPath op write Bytes toBytes data op close LOG debug String format inputPath conf LOG debug conf setInt List String argv ArrayList Arrays asList args argv add inputPath toString Tool tool ImportTsv
Configuration conf Configuration util getConfiguration FileSystem fs FileSystem get conf Path inputPath fs makeQualified Path util getDataTestDirOnTestFS table getNameAsString FSDataOutputStream op fs create inputPath data data op write Bytes toBytes data op close LOG debug String format inputPath conf LOG debug conf setInt List String argv ArrayList Arrays asList args argv add inputPath toString Tool tool ImportTsv
conf LOG debug conf setInt List String argv ArrayList Arrays asList args argv add inputPath toString Tool tool ImportTsv LOG debug argv assertEquals ToolRunner run conf tool argv toArray args createdHFiles String outputPath String arg argv arg ImportTsv createdHFiles outputPath arg split
conf tableName family LOG debug Table table util getConnection getTable tableName verified pause conf getLong numRetries conf getInt HConstants HBASE_CLIENT_RETRIES_NUMBER numRetries Scan scan Scan scan addFamily Bytes toBytes family scan setAuthorizations Authorizations ResultScanner resScanner table getScanner scan Result next resScanner next assertEquals next length Result resScanner
op write Bytes toBytes data op close LOG debug String format inputPath conf LOG debug conf setInt String argsArray String args size Iterator it args entrySet iterator i it Map Entry pair Map Entry it next argsArray i pair getKey pair getValue i argsArray i table getNameAsString argsArray i inputPath toString
table Job job LOG info job Job table getConfiguration job setNumReduceTasks Scan scan Scan scan addFamily INPUT_FAMILY TableMapReduceUtil initTableMapperJob table getName scan MultithreadedTableMapper ImmutableBytesWritable Put job MultithreadedTableMapper setMapperClass job ProcessContentsMapper MultithreadedTableMapper setNumberOfThreads job NUMBER_OF_THREADS TableMapReduceUtil initTableReducerJob table getName getNameAsString IdentityTableReducer job FileOutputFormat setOutputPath job Path
tableName Table table UTIL getConnection getTable tableName verified pause UTIL getConfiguration getLong numRetries UTIL getConfiguration getInt HConstants HBASE_CLIENT_RETRIES_NUMBER numRetries
count secondValue CellUtil cloneValue kv count count String first firstValue NullPointerException Bytes toString r getRow first Bytes toString firstValue String second secondValue NullPointerException Bytes toString r getRow secondReversed secondValue length i j secondValue length j j i secondReversed i secondValue j
args expectedCount RowCounter rowCounter RowCounter rowCounter setConf TEST_UTIL getConfiguration args Arrays copyOf args args length args args length expectedCount start System currentTimeMillis result rowCounter run args duration System currentTimeMillis start
args Job job RowCounter createSubmittableJob TEST_UTIL getConfiguration args start System currentTimeMillis job waitForCompletion duration System currentTimeMillis start
sourceTableName targetTableName Table sourceTable TEST_UTIL getConnection getTable sourceTableName Table targetTable TEST_UTIL getConnection getTable targetTableName ResultScanner sourceScanner sourceTable getScanner Scan ResultScanner targetScanner targetTable getScanner Scan Result sourceRow sourceScanner next Result targetRow targetScanner next
sourceTableName targetTableName Table sourceTable TEST_UTIL getConnection getTable sourceTableName Table targetTable TEST_UTIL getConnection getTable targetTableName ResultScanner sourceScanner sourceTable getScanner Scan ResultScanner targetScanner targetTable getScanner Scan Result sourceRow sourceScanner next Result targetRow targetScanner next LOG debug sourceRow Bytes toInt sourceRow getRow sourceRow
Table targetTable TEST_UTIL getConnection getTable targetTableName ResultScanner sourceScanner sourceTable getScanner Scan ResultScanner targetScanner targetTable getScanner Scan i i expectedRows i Result sourceRow sourceScanner next Result targetRow targetScanner next LOG debug sourceRow Bytes toInt sourceRow getRow sourceRow LOG debug targetRow Bytes toInt targetRow getRow targetRow sourceRow Assert fail expectedRows i targetRow Assert fail expectedRows i Cell sourceCells sourceRow rawCells Cell targetCells targetRow rawCells sourceCells targetCells
ResultScanner sourceScanner sourceTable getScanner Scan ResultScanner targetScanner targetTable getScanner Scan i i expectedRows i Result sourceRow sourceScanner next Result targetRow targetScanner next LOG debug sourceRow Bytes toInt sourceRow getRow sourceRow LOG debug targetRow Bytes toInt targetRow getRow targetRow sourceRow Assert fail expectedRows i targetRow Assert fail expectedRows i Cell sourceCells sourceRow rawCells Cell targetCells targetRow rawCells sourceCells targetCells LOG debug Arrays toString sourceCells
LOG debug Arrays toString targetCells Assert fail Bytes toInt sourceRow getRow sourceCells length targetCells length j j sourceCells length j Cell sourceCell sourceCells j Cell targetCell targetCells j sourceCell targetCell Assert fail sourceCell targetCell Assert fail sourceCell targetCell Assert fail sourceCell targetCell Assert fail sourceCell targetCell
Result targetRow targetScanner next Result sourceRow sourceScanner next rowsCount targetRow rowsCount Bytes toInt sourceRow getRow Bytes toInt targetRow getRow targetRow targetScanner next LOG debug sourceRow Bytes toInt sourceRow getRow sourceRow LOG debug targetRow Bytes toInt targetRow getRow targetRow Cell sourceCells sourceRow rawCells Cell targetCells targetRow rawCells targetRowKey Bytes toInt targetRow getRow targetRowKey targetRowKey sourceCells targetCells
Result sourceRow sourceScanner next rowsCount targetRow rowsCount Bytes toInt sourceRow getRow Bytes toInt targetRow getRow targetRow targetScanner next LOG debug sourceRow Bytes toInt sourceRow getRow sourceRow LOG debug targetRow Bytes toInt targetRow getRow targetRow Cell sourceCells sourceRow rawCells Cell targetCells targetRow rawCells targetRowKey Bytes toInt targetRow getRow targetRowKey targetRowKey sourceCells targetCells LOG debug Arrays toString sourceCells
Bytes toInt sourceRow getRow Bytes toInt targetRow getRow targetRow targetScanner next LOG debug sourceRow Bytes toInt sourceRow getRow sourceRow LOG debug targetRow Bytes toInt targetRow getRow targetRow Cell sourceCells sourceRow rawCells Cell targetCells targetRow rawCells targetRowKey Bytes toInt targetRow getRow targetRowKey targetRowKey sourceCells targetCells LOG debug Arrays toString sourceCells LOG debug Arrays toString targetCells Assert fail targetRowKey sourceCells targetCells
targetRow targetScanner next LOG debug sourceRow Bytes toInt sourceRow getRow sourceRow LOG debug targetRow Bytes toInt targetRow getRow targetRow Cell sourceCells sourceRow rawCells Cell targetCells targetRow rawCells targetRowKey Bytes toInt targetRow getRow targetRowKey targetRowKey sourceCells targetCells LOG debug Arrays toString sourceCells LOG debug Arrays toString targetCells Assert fail targetRowKey sourceCells targetCells LOG debug Arrays toString sourceCells
LOG debug Arrays toString targetCells Assert fail Bytes toInt sourceRow getRow sourceCells length targetCells length j j sourceCells length j Cell sourceCell sourceCells j Cell targetCell targetCells j sourceCell targetCell Assert fail sourceCell targetCell Assert fail sourceCell targetCell Assert fail sourceCell targetCell Assert fail
ResultScanner targetScanner targetTable getScanner Scan Result targetRow targetScanner next Result sourceRow sourceScanner next rowsCount targetRow Bytes toInt sourceRow getRow Bytes toInt targetRow getRow sourceRow sourceScanner next LOG debug sourceRow Bytes toInt sourceRow getRow sourceRow LOG debug targetRow Bytes toInt targetRow getRow targetRow LOG debug rowsCount Cell sourceCells sourceRow rawCells Cell targetCells targetRow rawCells targetRowKey Bytes toInt targetRow getRow targetRowKey targetRowKey
Result targetRow targetScanner next Result sourceRow sourceScanner next rowsCount targetRow Bytes toInt sourceRow getRow Bytes toInt targetRow getRow sourceRow sourceScanner next LOG debug sourceRow Bytes toInt sourceRow getRow sourceRow LOG debug targetRow Bytes toInt targetRow getRow targetRow LOG debug rowsCount Cell sourceCells sourceRow rawCells Cell targetCells targetRow rawCells targetRowKey Bytes toInt targetRow getRow targetRowKey targetRowKey LOG debug Arrays toString sourceCells
Bytes toInt sourceRow getRow Bytes toInt targetRow getRow sourceRow sourceScanner next LOG debug sourceRow Bytes toInt sourceRow getRow sourceRow LOG debug targetRow Bytes toInt targetRow getRow targetRow LOG debug rowsCount Cell sourceCells sourceRow rawCells Cell targetCells targetRow rawCells targetRowKey Bytes toInt targetRow getRow targetRowKey targetRowKey LOG debug Arrays toString sourceCells LOG debug Arrays toString targetCells Assert fail targetRowKey targetRowKey sourceCells targetCells
sourceRow sourceScanner next LOG debug sourceRow Bytes toInt sourceRow getRow sourceRow LOG debug targetRow Bytes toInt targetRow getRow targetRow LOG debug rowsCount Cell sourceCells sourceRow rawCells Cell targetCells targetRow rawCells targetRowKey Bytes toInt targetRow getRow targetRowKey targetRowKey LOG debug Arrays toString sourceCells LOG debug Arrays toString targetCells Assert fail targetRowKey targetRowKey sourceCells targetCells LOG debug Arrays toString sourceCells
LOG debug sourceRow Bytes toInt sourceRow getRow sourceRow LOG debug targetRow Bytes toInt targetRow getRow targetRow LOG debug rowsCount Cell sourceCells sourceRow rawCells Cell targetCells targetRow rawCells targetRowKey Bytes toInt targetRow getRow targetRowKey targetRowKey LOG debug Arrays toString sourceCells LOG debug Arrays toString targetCells Assert fail targetRowKey targetRowKey sourceCells targetCells LOG debug Arrays toString sourceCells LOG debug Arrays toString targetCells Assert fail Bytes toInt sourceRow getRow
LOG debug targetRow Bytes toInt targetRow getRow targetRow LOG debug rowsCount Cell sourceCells sourceRow rawCells Cell targetCells targetRow rawCells targetRowKey Bytes toInt targetRow getRow targetRowKey targetRowKey LOG debug Arrays toString sourceCells LOG debug Arrays toString targetCells Assert fail targetRowKey targetRowKey sourceCells targetCells LOG debug Arrays toString sourceCells LOG debug Arrays toString targetCells Assert fail Bytes toInt sourceRow getRow targetRowKey targetRowKey
Cell sourceCell sourceCells j Cell targetCell targetCells j sourceCell targetCell Assert fail Bytes toInt targetRow getRow j j sourceCells j Cell sourceCell sourceCells j Cell targetCell targetCells j sourceCell targetCell Assert fail sourceCell targetCell Assert fail sourceCell targetCell Assert fail
String start String stop String String jobName start start toUpperCase Locale ROOT stop stop toUpperCase Locale ROOT
Scan scan Scan scan addFamily INPUT_FAMILYS scan addFamily INPUT_FAMILYS start scan withStartRow Bytes toBytes start c set KEY_STARTROW start start stop scan withStopRow Bytes toBytes stop c set KEY_LASTROW last last LOG info scan Job job Job getInstance c jobName TableMapReduceUtil initTableMapperJob TABLE_NAME scan ScanMapper ImmutableBytesWritable ImmutableBytesWritable job job setReducerClass ScanReducer job setNumReduceTasks FileOutputFormat setOutputPath job Path job getJobName
scan addFamily INPUT_FAMILYS start scan withStartRow Bytes toBytes start c set KEY_STARTROW start start stop scan withStopRow Bytes toBytes stop c set KEY_LASTROW last last LOG info scan Job job Job getInstance c jobName TableMapReduceUtil initTableMapperJob TABLE_NAME scan ScanMapper ImmutableBytesWritable ImmutableBytesWritable job job setReducerClass ScanReducer job setNumReduceTasks FileOutputFormat setOutputPath job Path job getJobName LOG info job getJobName assertTrue job waitForCompletion
String jobName
String jobName
table Scan scan Scan scan addColumn FAMILY_NAME COLUMN_NAME scan readVersions ResultScanner scanner table getScanner scan scanner
WALFactory walfactory WALFactory conf getName WAL log walfactory getWAL info ts System currentTimeMillis WALEdit edit WALEdit edit add KeyValue rowName family Bytes toBytes ts value log appendData info getWalKeyImpl ts scopes edit edit WALEdit edit add KeyValue rowName family Bytes toBytes ts value log appendData info getWalKeyImpl ts scopes edit log sync
WALFactory walfactory WALFactory conf getName WAL log walfactory getWAL info ts System currentTimeMillis WALEdit edit WALEdit edit add KeyValue rowName family Bytes toBytes ts value log appendData info getWalKeyImpl ts scopes edit edit WALEdit edit add KeyValue rowName family Bytes toBytes ts value log appendData info getWalKeyImpl ts scopes edit log sync LOG info log toString log rollWriter
log sync LOG info log toString log rollWriter LOG info log toString Thread sleep ts1 System currentTimeMillis edit WALEdit edit add KeyValue rowName family Bytes toBytes ts1 value log appendData info getWalKeyImpl ts1 scopes edit edit WALEdit edit add KeyValue rowName family Bytes toBytes ts1 value log appendData info getWalKeyImpl ts1 scopes edit log sync log shutdown walfactory shutdown
edit add KeyValue rowName family Bytes toBytes System currentTimeMillis value txid log appendData info getWalKeyImpl System currentTimeMillis scopes edit log sync txid Thread sleep edit WALEdit edit add KeyValue rowName family Bytes toBytes System currentTimeMillis value txid log appendData info getWalKeyImpl System currentTimeMillis scopes edit log sync txid log shutdown WALInputFormat input WALInputFormat Configuration jobConf Configuration conf jobConf set logDir toString List InputSplit splits input getSplits MapreduceTestingShim createJobContext jobConf assertEquals splits size WALInputFormat WALSplit split WALInputFormat WALSplit splits get
htable1 put put Scan scan Scan scan readVersions ResultScanner scanner1 htable1 getScanner scan Result res1 scanner1 next scanner1 close assertEquals res1 length assertEquals res1 getColumnCells famName qualifierName size scan Scan scan readVersions scanner1 htable2 getScanner scan res1 scanner1 next scanner1 close res1 length
scanner1 close assertEquals res1 length assertEquals res1 getColumnCells famName qualifierName size scan Scan scan readVersions scanner1 htable2 getScanner scan res1 scanner1 next scanner1 close res1 length LOG info res1 length Thread sleep SLEEP_TIME cellNumber res1 getColumnCells famName Bytes toBytes size cellNumber
htable1 put put Scan scan Scan scan readVersions ResultScanner scanner1 htable1 getScanner scan Result res1 scanner1 next scanner1 close assertEquals res1 length assertEquals res1 getColumnCells famName qualifierName size scan Scan scan readVersions scanner1 htable2 getScanner scan res1 scanner1 next scanner1 close res1 length
scanner1 close assertEquals res1 length assertEquals res1 getColumnCells famName qualifierName size scan Scan scan readVersions scanner1 htable2 getScanner scan res1 scanner1 next scanner1 close res1 length LOG info res1 length Thread sleep SLEEP_TIME cellNumber res1 getColumnCells famName Bytes toBytes size cellNumber
conf Path srcDir Path rawTgtDir FileSystem tgtFs rawTgtDir getFileSystem conf FileSystem srcFs srcDir getFileSystem conf Path tgtDir rawTgtDir makeQualified tgtFs getUri tgtFs getWorkingDirectory
Set String Set String files HashSet
Set String fs root dir Set String files HashSet LOG debug fs root dir rootPrefix root makeQualified fs getUri fs getWorkingDirectory toString length FileStatus list CommonFSUtils listStatus fs dir list FileStatus list
Path Path rootDir TEST_UTIL getHBaseCluster getMaster getMasterFileSystem getRootDir Path path Path Path rootDir System currentTimeMillis
Path htu Path path htu getDataTestDir System currentTimeMillis FileSystem fs FileSystem getLocal htu getConfiguration
Path fs Path testDir Path path Path Path testDir System currentTimeMillis makeQualified fs getUri fs getWorkingDirectory
tableName admin TableDescriptor tableDesc admin getDescriptor tableName
dataBlockEncodingAlgo columnDescBuilder setDataBlockEncoding dataBlockEncodingAlgo inMemoryCF columnDescBuilder setInMemory inMemoryCF cipher keyBytes cipher getKeyLength SecureRandom nextBytes keyBytes columnDescBuilder setEncryptionType cipher getName columnDescBuilder setEncryptionKey EncryptionUtil wrapKey conf User getCurrent getShortName SecretKeySpec keyBytes cipher getName mobThreshold columnDescBuilder setMobEnabled columnDescBuilder setMobThreshold mobThreshold admin addColumnFamily tableName columnDescBuilder build
cmd String dataBlockEncodingStr cmd getOptionValue HFileTestUtil OPT_DATA_BLOCK_ENCODING dataBlockEncodingAlgo dataBlockEncodingStr DataBlockEncoding valueOf dataBlockEncodingStr String compressStr cmd getOptionValue OPT_COMPRESSION compressAlgo compressStr Compression Algorithm NONE Compression Algorithm valueOf compressStr String bloomStr cmd getOptionValue OPT_BLOOM bloomType bloomStr BloomType ROW BloomType valueOf bloomStr bloomType BloomType cmd
Properties authConfig Properties authConfig load getClass getClassLoader getResourceAsStream authnFileName addAuthInfoToConf authConfig conf superUser userNames exp LOG error exp toString exp EXIT_FAILURE userOwner User create HBaseKerberosUtils loginAndReturnUGI conf superUser superUser clazzAndArgs userNames clazzAndArgs args Arrays copyOfRange clazzAndArgs clazzAndArgs length userOwner User createUserForTesting conf superUser String args clazzAndArgs length String Arrays copyOfRange clazzAndArgs clazzAndArgs length
exp LOG error exp toString exp EXIT_FAILURE userOwner User create HBaseKerberosUtils loginAndReturnUGI conf superUser superUser clazzAndArgs userNames clazzAndArgs args Arrays copyOfRange clazzAndArgs clazzAndArgs length userOwner User createUserForTesting conf superUser String args clazzAndArgs length String Arrays copyOfRange clazzAndArgs clazzAndArgs length dataGen initialize args dataGen MultiThreadedAction DefaultDataGenerator minColDataSize maxColDataSize minColsPerKey maxColsPerKey families userOwner
System arraycopy cmdLineArgs newArgs cmdLineArgs length newArgs cmdLineArgs tableNameValueIndex j j newArgs length j newArgs j tableNameValueIndex j newArgs j newArgs j List WorkerThread workers ArrayList i i i String workerArgs newArgs clone workerArgs tableNameValueIndex tableName i WorkerThread worker WorkerThread i workerArgs workers add worker
MetricRegistries MetricRegistries availableImplementations availableImplementations MetricRegistries impl availableImplementations get
procId IdLock Entry lockEntry procExecutionLock getLockEntry procId Procedure TEnvironment proc procedures get procId proc proc proc proc
IdLock Entry lockEntry procExecutionLock getLockEntry procId Procedure TEnvironment proc procedures get procId proc proc proc proc LOG debug proc CompletedProcedureRetainer TEnvironment retainer completed get procId retainer retainer LOG debug procId evictTtl conf getInt EVICT_TTL_CONF_KEY DEFAULT_EVICT_TTL evictAckTtl conf getInt EVICT_ACKED_TTL_CONF_KEY DEFAULT_ACKED_EVICT_TTL retainer evictTtl evictAckTtl
numThreads corePoolSize numThreads maxPoolSize numThreads
pid lockWait Preconditions checkArgument lockWait Procedure TEnvironment procedure getProcedure pid procedure
pid lockWait override recursive Preconditions checkArgument lockWait Procedure TEnvironment procedure getProcedure pid procedure LOG debug pid LOG debug procedure lockWait override recursive IdLock Entry lockEntry procExecutionLock tryLockEntry procedure getProcId lockWait lockEntry override LOG debug lockWait procedure override lockEntry LOG debug lockWait procedure override procedure
LOG debug pid LOG debug procedure lockWait override recursive IdLock Entry lockEntry procExecutionLock tryLockEntry procedure getProcId lockWait lockEntry override LOG debug lockWait procedure override lockEntry LOG debug lockWait procedure override procedure LOG debug procedure procedure recursive
LOG debug lockWait procedure override procedure LOG debug procedure procedure recursive LOG info procedure getProcId v v procedure getProcId v v bypassProcedure v getProcId lockWait override recursive e LOG warn v getProcId e
procedure LOG debug procedure procedure recursive LOG info procedure getProcId v v procedure getProcId v v bypassProcedure v getProcId lockWait override recursive e LOG warn v getProcId e LOG debug procedure
e LOG warn v getProcId e LOG debug procedure procedure procedure procedure procedure LOG debug procedure Procedure TEnvironment current procedure current LOG debug current current bypass getEnvironment store update procedure parentID current getParentProcId
LOG debug procedure procedure procedure procedure procedure LOG debug procedure Procedure TEnvironment current procedure current LOG debug current current bypass getEnvironment store update procedure parentID current getParentProcId current getProcedure parentID procedure
LOG debug procedure procedure procedure ProcedureState RUNNABLE procedure ProcedureState procedure ProcedureState LOG debug procedure Procedure TEnvironment current procedure current LOG debug current current bypass getEnvironment store update procedure parentID current getParentProcId current getProcedure parentID procedure ProcedureState procedure setState ProcedureState RUNNABLE
procedure procedure ProcedureState RUNNABLE procedure ProcedureState procedure ProcedureState LOG debug procedure Procedure TEnvironment current procedure current LOG debug current current bypass getEnvironment store update procedure parentID current getParentProcId current getProcedure parentID procedure ProcedureState procedure setState ProcedureState RUNNABLE store update procedure procedure ProcedureState
rootEntry rootEntry subProcs LOG error rootEntry rootEntry subProcs forEach e LOG error e addAllToCorruptedAndRemoveFromProcMap rootEntry remainingProcMap addAllToValidAndRemoveFromProcMap rootEntry remainingProcMap Map Integer List Entry stackId2Proc HashMap MutableInt maxStackId MutableInt Integer MIN_VALUE collectStackId rootEntry stackId2Proc maxStackId valid i i maxStackId i List Entry entries stackId2Proc get i entries
rootEntry subProcs forEach e LOG error e addAllToCorruptedAndRemoveFromProcMap rootEntry remainingProcMap addAllToValidAndRemoveFromProcMap rootEntry remainingProcMap Map Integer List Entry stackId2Proc HashMap MutableInt maxStackId MutableInt Integer MIN_VALUE collectStackId rootEntry stackId2Proc maxStackId valid i i maxStackId i List Entry entries stackId2Proc get i entries LOG error i maxStackId rootEntry valid entries
Path walArchiveDir close archived walArchiveDir Path archivedFile Path walArchiveDir logFile getName
log localTracker log getTracker localTracker
LOG warn log count
count LOG info count log
LOG debug afterFirstAttempt afterFirstAttempt LOG trace waitBeforeRoll Threads sleepWithoutInterrupt waitBeforeRoll afterFirstAttempt FileStatus oldLogs getLogFiles flushLogId initOldLogs oldLogs e LOG warn e flushLogId
LOG trace waitBeforeRoll Threads sleepWithoutInterrupt waitBeforeRoll afterFirstAttempt FileStatus oldLogs getLogFiles flushLogId initOldLogs oldLogs e LOG warn e flushLogId LOG debug flushLogId oldLogs getLogFiles oldLogs flushLogId
afterFirstAttempt FileStatus oldLogs getLogFiles flushLogId initOldLogs oldLogs e LOG warn e flushLogId LOG debug flushLogId oldLogs getLogFiles oldLogs flushLogId LOG debug flushLogId logs getLast removeFile walArchiveDir
stream logs ProcedureWALFile log logs getLast log setProcIds storeTracker getModifiedMinProcId storeTracker getModifiedMaxProcId log updateLocalTracker storeTracker trailerSize ProcedureWALFormat writeTrailer stream storeTracker log addToSize trailerSize e LOG warn e stream close e
ProcedureWALFile logFile walArchiveDir ProcedureWALFile log ProcedureWALFile fs logFile logFile LOG warn logFile log removeFile walArchiveDir LOG debug logFile log open e LOG warn logFile e log removeFile walArchiveDir e String msg logFile
result assertEquals result isFailed
procExec procId Procedure proc procExec getProcedure procId waitProcedure procExec procId assertEquals procExec isRunning procExec procId proc procExec getProcedure procId
SuspendProcedure proc SuspendProcedure id procExecutor submitProcedure proc Thread sleep assertTrue procExecutor bypassProcedure id htu waitFor proc isSuccess proc isBypass
StuckProcedure proc StuckProcedure id procExecutor submitProcedure proc Thread sleep assertTrue procExecutor bypassProcedure id ProcedureTestingUtility restart procExecutor htu waitFor proc isSuccess proc isBypass
RootProcedure proc RootProcedure rootId procExecutor submitProcedure proc htu waitFor procExecutor getProcedures stream filter p p getParentProcId rootId collect Collectors toList size SuspendProcedure suspendProcedure SuspendProcedure procExecutor getProcedures stream filter p p getParentProcId rootId collect Collectors toList get assertTrue procExecutor bypassProcedure suspendProcedure getProcId htu waitFor proc isSuccess proc isBypass
StuckStateMachineProcedure proc StuckStateMachineProcedure procEnv StuckStateMachineState START id procExecutor submitProcedure proc Thread sleep assertFalse procExecutor bypassProcedure id assertTrue procExecutor bypassProcedure id htu waitFor proc isSuccess proc isBypass
RootProcedure proc RootProcedure rootId procExecutor submitProcedure proc htu waitFor procExecutor getProcedures stream filter p p getParentProcId rootId collect Collectors toList size SuspendProcedure suspendProcedure SuspendProcedure procExecutor getProcedures stream filter p p getParentProcId rootId collect Collectors toList get assertTrue procExecutor bypassProcedure rootId htu waitFor proc isSuccess proc isBypass
WaitingTimeoutProcedure proc WaitingTimeoutProcedure id procExecutor submitProcedure proc Thread sleep assertTrue procExecutor bypassProcedure id htu waitFor proc isSuccess proc isBypass
createProcExecutor RootProcedure proc RootProcedure rootProc procExecutor submitProcedure proc
createProcExecutor SuspendProcedure suspendProcedure SuspendProcedure suspendProc procExecutor submitProcedure suspendProcedure
createProcExecutor WaitProcedure waitProcedure WaitProcedure waitProce procExecutor submitProcedure waitProcedure
List String state ArrayList Procedure Void subProc2 TestSequentialProcedure state Procedure Void subProc1 TestSequentialProcedure state subProc2 NULL_PROC Procedure Void rootProc TestSequentialProcedure state subProc1 rootId ProcedureTestingUtility submitAndWait procExecutor rootProc
List String state ArrayList Procedure Void subProc2 TestSequentialProcedure state Procedure Void subProc1 TestSequentialProcedure state subProc2 Procedure Void rootProc TestSequentialProcedure state subProc1 rootId ProcedureTestingUtility submitAndWait procExecutor rootProc
List String state ArrayList Procedure Void subProc2 TestSequentialProcedure state TestProcedureException Procedure Void subProc1 TestSequentialProcedure state subProc2 Procedure Void rootProc TestSequentialProcedure state subProc1 rootId ProcedureTestingUtility submitAndWait procExecutor rootProc
PROC_TIMEOUT_MSEC List String state ArrayList Procedure Void proc TestWaitingProcedure state proc setTimeout PROC_TIMEOUT_MSEC startTime EnvironmentEdgeManager currentTime rootId ProcedureTestingUtility submitAndWait procExecutor proc execTime EnvironmentEdgeManager currentTime startTime
List String state ArrayList Procedure Void proc TestWaitingProcedure state proc setTimeout rootId ProcedureTestingUtility submitAndWait procExecutor proc
timeoutMSec nCountDown CountDownLatch latch CountDownLatch nCountDown TestLatchChore chore TestLatchChore timeoutMSec latch procExecutor addChore chore assertTrue chore isWaiting latch await assertTrue chore isWaiting procExecutor removeChore chore latch CountDownLatch nCountDown chore setLatch latch latch await timeoutMSec nCountDown TimeUnit MILLISECONDS
FileStatus files fs listStatus logDir files files FileStatus file files assertTrue file toString file isFile
i i i sched addBack TestProcedureWithEvent i Thread threads Thread AtomicInteger waitCount AtomicInteger AtomicInteger wakeCount AtomicInteger ConcurrentSkipListSet TestProcedureWithEvent waitQueue ConcurrentSkipListSet threads Thread lastUpdate oldWakeCount wakeCount get ProcedureEvent ev ProcedureEvent waitQueue size i i ev i ev i waitQueue pollFirst getEvent
lastUpdate oldWakeCount wakeCount get ProcedureEvent ev ProcedureEvent waitQueue size i i ev length i ev i waitQueue pollFirst getEvent LOG debug ev i wakeCount get ProcedureEvent wakeEvents AbstractProcedureScheduler sched ev wakeCount addAndGet ev length size waitQueue size size ProcedureEvent ev waitQueue pollFirst getEvent
LOG debug ev wakeCount get wakeCount incrementAndGet wakeCount get lastUpdate System currentTimeMillis wakeCount get System currentTimeMillis lastUpdate Threads sleepWithoutInterrupt TestProcedureWithEvent proc TestProcedureWithEvent sched poll proc
MAX_PROCS ProcedureStoreTracker tracker ProcedureStoreTracker MAX_PROCS assertTrue tracker isEmpty
NITEMS i i NITEMS i data i
procStore rollWriterForTesting procStore delete procs getProcId procStore insert procs procStore stop FileStatus logs fs listStatus logDir assertEquals logs length i i logs length i corruptLog logs i htu getConfiguration setBoolean WALProcedureStore EXEC_WAL_CLEANUP_ON_LOAD_CONF_KEY LoadCounter loader LoadCounter storeRestart loader assertEquals loader getLoadedCount assertEquals loader getCorruptedCount ArrayList ProcedureWALFile walFiles procStore getActiveLogs LOG info walFiles
procStore insert procs procStore stop FileStatus logs fs listStatus logDir assertEquals logs length i i logs length i corruptLog logs i htu getConfiguration setBoolean WALProcedureStore EXEC_WAL_CLEANUP_ON_LOAD_CONF_KEY LoadCounter loader LoadCounter storeRestart loader assertEquals loader getLoadedCount assertEquals loader getCorruptedCount ArrayList ProcedureWALFile walFiles procStore getActiveLogs LOG info walFiles assertEquals walFiles size LOG info walFiles get
FileStatus logs fs listStatus logDir assertEquals logs length i i logs length i corruptLog logs i htu getConfiguration setBoolean WALProcedureStore EXEC_WAL_CLEANUP_ON_LOAD_CONF_KEY LoadCounter loader LoadCounter storeRestart loader assertEquals loader getLoadedCount assertEquals loader getCorruptedCount ArrayList ProcedureWALFile walFiles procStore getActiveLogs LOG info walFiles assertEquals walFiles size LOG info walFiles get assertUpdated walFiles get getTracker procs LOG info walFiles get
i i procs length i procs i TestProcedure i procStore insert procs i procStore rollWriterForTesting i i procs length i procStore update procs i procStore rollWriterForTesting procStore stop FileStatus status fs listStatus logDir assertEquals procs length status length procStore logDir count fs path count fs delete path
logFile dropBytes assertTrue logFile getLen dropBytes
deadServerListStr result deadServerListStr seenCommaCnt startIndex len deadServerListStr length i i len i deadServerListStr i seenCommaCnt seenCommaCnt i startIndex String serverName deadServerListStr substring startIndex i ServerName serverName result add ServerName valueOf serverName
seenCommaCnt i startIndex String serverName deadServerListStr substring startIndex i ServerName serverName result add ServerName valueOf serverName LOG error serverName startIndex i seenCommaCnt startIndex len String serverName deadServerListStr substring startIndex len ServerName serverName result add ServerName valueOf serverName
String serverName deadServerListStr substring startIndex i ServerName serverName result add ServerName valueOf serverName LOG error serverName startIndex i seenCommaCnt startIndex len String serverName deadServerListStr substring startIndex len ServerName serverName result add ServerName valueOf serverName LOG error serverName
ReplicationException queueId sourceServerName destServerName destServerName e String newQueueId queueId sourceServerName String oldQueueNode getQueueNode sourceServerName queueId List String wals ZKUtil listChildrenNoWatch zookeeper oldQueueNode wals ZKUtil deleteNodeFailSilent zookeeper oldQueueNode LOG info sourceServerName queueId Pair newQueueId Collections emptySortedSet String newQueueNode getQueueNode destServerName newQueueId List ZKUtilOp listOfOps ArrayList SortedSet String logQueue TreeSet listOfOps add ZKUtilOp createAndFailSilent newQueueNode HConstants EMPTY_BYTE_ARRAY String wal wals String oldWalNode getFileNode oldQueueNode wal
LOG info sourceServerName queueId Pair newQueueId Collections emptySortedSet String newQueueNode getQueueNode destServerName newQueueId List ZKUtilOp listOfOps ArrayList SortedSet String logQueue TreeSet listOfOps add ZKUtilOp createAndFailSilent newQueueNode HConstants EMPTY_BYTE_ARRAY String wal String oldWalNode getFileNode oldQueueNode wal logOffset ZKUtil getData zookeeper oldWalNode LOG debug wal Bytes toStringBinary logOffset String newWalNode getFileNode newQueueNode wal listOfOps add ZKUtilOp createAndFailSilent newWalNode logOffset listOfOps add ZKUtilOp deleteNodeFailSilent oldWalNode logQueue add wal listOfOps add ZKUtilOp deleteNodeFailSilent oldQueueNode
String newQueueNode getQueueNode destServerName newQueueId List ZKUtilOp listOfOps ArrayList SortedSet String logQueue TreeSet listOfOps add ZKUtilOp createAndFailSilent newQueueNode HConstants EMPTY_BYTE_ARRAY String wal String oldWalNode getFileNode oldQueueNode wal logOffset ZKUtil getData zookeeper oldWalNode LOG debug wal Bytes toStringBinary logOffset String newWalNode getFileNode newQueueNode wal listOfOps add ZKUtilOp createAndFailSilent newWalNode logOffset listOfOps add ZKUtilOp deleteNodeFailSilent oldWalNode logQueue add wal listOfOps add ZKUtilOp deleteNodeFailSilent oldQueueNode LOG trace listOfOps size ZKUtil multiOrSequential zookeeper listOfOps
String peerId String peerNode getHFileRefsPeerNode peerId peerNode
String peerId String peerNode getHFileRefsPeerNode peerId peerNode
String peerId String peerNode getHFileRefsPeerNode peerId
String peerId List pairs String peerNode getHFileRefsPeerNode peerId LOG debug pairs peerNode List ZKUtilOp listOfOps pairs stream map p p getSecond getName map n getHFileNode peerNode n map f ZKUtilOp createAndFailSilent f HConstants EMPTY_BYTE_ARRAY collect toList
String peerId String String peerNode getHFileRefsPeerNode peerId
String peerId List String files String peerNode getHFileRefsPeerNode peerId LOG debug files peerNode List ZKUtilOp listOfOps files stream map n getHFileNode peerNode n map ZKUtilOp deleteNodeFailSilent collect toList
String args conf Options options Options options addOption DEFAULT_LISTEN_PORT options addOption options addOption CommandLine commandLine commandLine PosixParser parse options args e LOG error e printUsageAndExit options commandLine commandLine String val commandLine getOptionValue conf setInt Integer parseInt val LOG
e LOG error e printUsageAndExit options commandLine commandLine String val commandLine getOptionValue conf setInt Integer parseInt val LOG LOG debug val commandLine commandLine conf setBoolean LOG LOG debug commandLine commandLine String val commandLine getOptionValue conf setInt Integer parseInt val
append setReturnResults returnResult i cell col cell getColumn col col rowspec getColumns i col col servlet getMetrics incrementFailedAppendRequests Response status Response Status BAD_REQUEST type MIMETYPE_TEXT entity CRLF build parts CellUtil parseColumn col parts servlet getMetrics incrementFailedAppendRequests
LOG LOG debug append toString Result result table append append result servlet getMetrics incrementFailedAppendRequests Response status Response Status NOT_MODIFIED type MIMETYPE_TEXT entity CRLF build CellSetModel rModel CellSetModel RowModel rRowModel RowModel result getRow cell result rRowModel addCell CellModel CellUtil cloneFamily cell CellUtil cloneQualifier cell cell getTimestamp CellUtil cloneValue cell rModel addRow rRowModel servlet getMetrics incrementSucessfulAppendRequests Response ok rModel build servlet getMetrics incrementSucessfulAppendRequests
increment setReturnResults returnResult i cell col cell getColumn col col rowspec getColumns i col col servlet getMetrics incrementFailedIncrementRequests Response status Response Status BAD_REQUEST type MIMETYPE_TEXT entity CRLF build parts CellUtil parseColumn col parts servlet getMetrics incrementFailedIncrementRequests
LOG LOG debug increment toString Result result table increment increment result servlet getMetrics incrementFailedIncrementRequests Response status Response Status NOT_MODIFIED type MIMETYPE_TEXT entity CRLF build CellSetModel rModel CellSetModel RowModel rRowModel RowModel result getRow cell result rRowModel addCell CellModel CellUtil cloneFamily cell CellUtil cloneQualifier cell cell getTimestamp CellUtil cloneValue cell rModel addRow rowModel servlet getMetrics incrementSucessfulIncrementRequests Response ok rModel build ResponseBuilder response Response ok
spec RowSpec model getStartRow endRow model getColumns model getStartTime model getEndTime model getMaxVersions Filter filter ScannerResultGenerator buildFilterFromModel model String tableName tableResource getName ScannerResultGenerator gen ScannerResultGenerator tableName spec filter model getCaching model getCacheBlocks model getLimit String id gen getID ScannerInstanceResource instance ScannerInstanceResource tableName id gen model getBatch scanners put id instance LOG LOG trace id UriBuilder builder uriInfo getAbsolutePathBuilder URI uri builder path id build servlet getMetrics incrementSucessfulPutRequests Response created uri build
rowI cached rowI cached listCells iterator loop cached Result result result scanner next e IllegalArgumentException e tnee IllegalStateException tnee
e columnFamilyDescriptorBuilder setValue e getKey getLocalPart e getValue toString tableDescriptorBuilder setColumnFamily columnFamilyDescriptorBuilder build TableDescriptor tableDescriptor tableDescriptorBuilder build admin name admin disableTable name admin modifyTable tableDescriptor admin enableTable name servlet getMetrics incrementSucessfulPutRequests admin createTable tableDescriptor servlet getMetrics incrementSucessfulPutRequests e Response status Response Status NOT_MODIFIED type MIMETYPE_TEXT entity CRLF build
cluster sslEnabled cluster cluster sslEnabled sslEnabled extraHeaders ConcurrentHashMap String clspath System getProperty
paramServletRequest paramServletResponse paramServletRequest HttpServletRequest paramServletResponse HttpServletResponse HttpServletRequest request HttpServletRequest paramServletRequest HttpServletResponse response HttpServletResponse paramServletResponse String path request getRequestURI
run PerformanceEvaluation pe PerformanceEvaluation getConf pe tableName tableName pe blockEncoding encoding pe flushCommits flushCommits pe compression compression pe writeToWAL writeToWal pe presplitRegions preSplitRegions pe N N pe connection connection pe useTags useTags pe noOfTags numTags elapsedTime pe runOneClient cmd index perClientRows perClientRows R flushCommits writeToWAL useTags noOfTags connection msg LOG info getName msg timings index elapsedTime
elapsedTime pe runOneClient cmd index perClientRows perClientRows R flushCommits writeToWAL useTags noOfTags connection msg LOG info getName msg timings index elapsedTime LOG info getName elapsedTime perClientRows e RuntimeException e threads add t t threads t start t threads t t join e
timings index elapsedTime LOG info getName elapsedTime perClientRows e RuntimeException e threads add t t threads t start t threads t t join e LOG debug e toString String test cmd getSimpleName
threads add t t threads t start t threads t t join e LOG debug e toString String test cmd getSimpleName LOG info test Arrays toString timings Arrays sort timings total
s ScannerModel model ScannerModel fromScan s model setBatch Integer MAX_VALUE StringWriter writer StringWriter marshaller marshal model writer
s ScannerModel model ScannerModel fromScan s model setBatch Integer MAX_VALUE StringWriter writer StringWriter marshaller marshal model writer
s ScannerModel model ScannerModel fromScan s model setBatch Integer MAX_VALUE StringWriter writer StringWriter marshaller marshal model writer
server server stop e LOG info e CLUSTER CLUSTER shutdown e LOG info e KDC KDC stop e
k b1 k b2 k b3 Put put Put k put setDurability Durability SKIP_WAL put addColumn famAndQf famAndQf k puts add put Connection connection TEST_UTIL getConnection Table table connection getTable TABLE table put puts table close RegionLocator regionLocator connection getRegionLocator TABLE List HRegionLocation m regionLocator getAllRegionLocations assertEquals NUM_REGIONS m size regionMap m
model assertEquals model getName TABLE getNameAsString Iterator TableRegionModel regions model getRegions iterator assertTrue regions hasNext regions hasNext TableRegionModel region regions next found
model assertEquals model getName TABLE getNameAsString Iterator TableRegionModel regions model getRegions iterator assertTrue regions hasNext regions hasNext TableRegionModel region regions next found LOG debug region getName e RegionInfo hri e getRegion String hriRegionName Bytes toString hri getRegionName String regionName region getName
Map String ExecutorStatus statuses service getAllExecutorStatuses Map String ExecutorStatus statusEntry statuses String name statusEntry getKey String poolName name split ExecutorStatus status statusEntry getValue MutableGaugeLong queued metricsRegistry getGauge poolName MutableGaugeLong running metricsRegistry getGauge poolName queueSize status getQueuedEvents size runningSize status getRunning size queueSize LOG warn poolName queueSize runningSize queued set queueSize running set runningSize
String location timeout healthCheckScript location scriptTimeout timeout ArrayList String execScript ArrayList execScript add healthCheckScript shexec ShellCommandExecutor execScript toArray String execScript size scriptTimeout
rmiSSL authenticate String passwordFile String accessFile System setProperty String rmiSSLValue System getProperty rmiSSL Boolean parseBoolean rmiSSLValue String authenticateValue System getProperty authenticate Boolean parseBoolean authenticateValue passwordFile System getProperty accessFile System getProperty
env rmiRegistryPort rmiConnectorPort Configuration conf env getConfiguration env rmiRegistryPort conf getInt RMI_REGISTRY_PORT_CONF_KEY defMasterRMIRegistryPort rmiConnectorPort conf getInt RMI_CONNECTOR_PORT_CONF_KEY rmiRegistryPort
rmiConnectorPort Configuration conf env getConfiguration env rmiRegistryPort conf getInt RMI_REGISTRY_PORT_CONF_KEY defMasterRMIRegistryPort rmiConnectorPort conf getInt RMI_CONNECTOR_PORT_CONF_KEY rmiRegistryPort LOG info rmiRegistryPort rmiConnectorPort env rmiRegistryPort conf getInt RMI_REGISTRY_PORT_CONF_KEY defRegionserverRMIRegistryPort rmiConnectorPort conf getInt RMI_CONNECTOR_PORT_CONF_KEY rmiRegistryPort LOG info rmiRegistryPort rmiConnectorPort env LOG error
regionDir deleteRegionWithoutArchiving fs regionDir LOG debug regionDir Preconditions checkArgument regionDir toString startsWith tableDir toString Path regionArchiveDir HFileArchiveUtil getRegionArchiveDir rootdir CommonFSUtils getTableName tableDir regionDir getName FileStatusConverter getAsFile FileStatusConverter fs Collection File toArchive ArrayList PathFilter dirFilter FSUtils DirFilter fs PathFilter nonHidden PathFilter accept Path file dirFilter accept file file getName startsWith FileStatus storeDirs CommonFSUtils listStatus fs regionDir nonHidden storeDirs
LOG debug regionDir Preconditions checkArgument regionDir toString startsWith tableDir toString Path regionArchiveDir HFileArchiveUtil getRegionArchiveDir rootdir CommonFSUtils getTableName tableDir regionDir getName FileStatusConverter getAsFile FileStatusConverter fs Collection File toArchive ArrayList PathFilter dirFilter FSUtils DirFilter fs PathFilter nonHidden PathFilter accept Path file dirFilter accept file file getName startsWith FileStatus storeDirs CommonFSUtils listStatus fs regionDir nonHidden storeDirs LOG debug regionDir deleteRegionWithoutArchiving fs regionDir
fs familyDir FileStatus storeFiles CommonFSUtils listStatus fs familyDir storeFiles
Path archiveDir currentFile String String filename currentFile getName Path archiveFile Path archiveDir filename FileSystem fs currentFile getFileSystem fs archiveFile
Path archiveDir currentFile String archiveStartTime String filename currentFile getName Path archiveFile Path archiveDir filename FileSystem fs currentFile getFileSystem fs archiveFile LOG debug archiveFile Path backedupArchiveFile Path archiveDir filename SEPARATOR archiveStartTime fs archiveFile backedupArchiveFile
archiveFile LOG debug archiveFile Path backedupArchiveFile Path archiveDir filename SEPARATOR archiveStartTime archiveFile backedupArchiveFile LOG error backedupArchiveFile archiveFile IOException archiveFile backedupArchiveFile LOG debug archiveFile LOG trace archiveFile success success archiveDir archiveDir
success success archiveDir archiveDir LOG debug archiveDir e LOG warn archiveDir e success currentFile moveAndClose archiveFile fnfe LOG warn currentFile fnfe success e
archiveDir archiveDir LOG debug archiveDir e LOG warn archiveDir e success currentFile moveAndClose archiveFile fnfe LOG warn currentFile fnfe success e LOG warn currentFile i e success success
zooKeeper table LOG debug ZKUtil createAndFailSilent zooKeeper archiveZnode String tableNode getTableNode table
fStat Path file fStat getPath FileStatus deleteStatus CommonFSUtils listStatus fs file deleteStatus Path family file getParent Path region family getParent Path table region getParent String tableName table getName ret archiveTracker keepHFiles tableName LOG debug ret tableName ret
LOG debug List String tables ZKUtil listChildrenAndWatchThem watcher archiveHFileZNode
await timeout timeUnit result latch await timeout timeUnit String lockRequestStr lockRequest toString replace result
List Constraint List Constraint constraints ArrayList Bytes Bytes e String key Bytes toString e getKey get trim String className CONSTRAINT_HTD_ATTR_KEY_PATTERN split key className key className
List Constraint constraints ArrayList Bytes Bytes e String key Bytes toString e getKey get trim String className CONSTRAINT_HTD_ATTR_KEY_PATTERN split key className key className LOG LOG debug key Configuration conf conf readConfiguration e getValue get LOG warn key conf
time EnvironmentEdgeManager currentTime task last_update alive details getMaster getServerManager details getMaster getServerManager isServerOnline task cur_worker_name alive time timeout LOG trace task toString task cur_worker_name time timeout task resubmitThreshold task resubmitThresholdReached task resubmitThresholdReached SplitLogCounters tot_mgr_resubmit_threshold_reached increment LOG info path resubmitThreshold version task last_version SplitLogCounters tot_mgr_resubmit_force increment version
version setDone path SUCCESS SplitLogCounters tot_mgr_null_data increment LOG error HBaseMarkers FATAL path setDone path FAILURE data ZKMetadata removeMetaData data SplitLogTask slt SplitLogTask parseFrom data slt LOG debug path version handleUnassignedTask path slt heartbeat path version slt getServerName slt
SplitLogCounters tot_mgr_null_data increment LOG error HBaseMarkers FATAL path setDone path FAILURE data ZKMetadata removeMetaData data SplitLogTask slt SplitLogTask parseFrom data slt LOG debug path version handleUnassignedTask path slt heartbeat path version slt getServerName slt LOG info path slt toString resubmitOrFail path FORCE slt
LOG debug path version handleUnassignedTask path slt heartbeat path version slt getServerName slt LOG info path slt toString resubmitOrFail path FORCE slt LOG info path slt toString path slt getServerName path setDone path SUCCESS resubmitOrFail path CHECK
slt heartbeat path version slt getServerName slt LOG info path slt toString resubmitOrFail path FORCE slt LOG info path slt toString path slt getServerName path setDone path SUCCESS resubmitOrFail path CHECK setDone path SUCCESS slt
path Task task details getTasks get path task path SplitLogCounters tot_mgr_unacquired_orphan_done increment
path Task task findOrCreateOrphanTask path task task
orphans ZKUtil listChildrenNoWatch watcher watcher getZNodePaths splitLogZNode orphans LOG warn watcher getZNodePaths splitLogZNode e LOG warn watcher getZNodePaths splitLogZNode StringUtils stringifyException e rescan_nodes listSize orphans size i i listSize i String path orphans get i String nodepath ZNodePaths joinZNode watcher getZNodePaths splitLogZNode path watcher nodepath rescan_nodes
orphans LOG warn watcher getZNodePaths splitLogZNode e LOG warn watcher getZNodePaths splitLogZNode StringUtils stringifyException e rescan_nodes listSize orphans size i i listSize i String path orphans get i String nodepath ZNodePaths joinZNode watcher getZNodePaths splitLogZNode path watcher nodepath rescan_nodes LOG debug path
SplitLogTask slt SplitLogTask Unassigned details getServerName slt
path SplitLogTask slt SplitLogTask Unassigned details getServerName path slt LOG debug path LOG warn path getDataSetWatchSuccess path Integer MIN_VALUE e1 LOG debug path e1
String String taskpath currentTask taskpath taskpath
slt SplitLogTask parseFrom data e LOG warn path e SplitLogCounters tot_wkr_failed_to_grab_task_exception increment slt SplitLogCounters tot_wkr_failed_to_grab_task_owned increment currentVersion attemptToOwnTask watcher server getServerName path stat getVersion currentVersion SplitLogCounters tot_wkr_failed_to_grab_task_lost_race increment watcher ZkSplitLogWorkerCoordination ZkSplitTaskDetails splitTaskDetails ZkSplitLogWorkerCoordination ZkSplitTaskDetails
details ZkSplitTaskDetails zkDetails ZkSplitTaskDetails details String task zkDetails getTaskNode taskZKVersion zkDetails getCurTaskZKVersion intValue task taskZKVersion
overridePriority Coprocessor PRIORITY_SYSTEM classNameAndPriority overridePriority Integer parseInt classNameAndPriority hasPriorityOverride className className trim className LOG warn className ClassLoader cl getClass getClassLoader Thread currentThread setContextClassLoader cl implClass cl loadClass className coprocPriority hasPriorityOverride overridePriority currentSystemPriority E env checkAndLoadInstance implClass coprocPriority conf env
Class implClass
String coprocessorName e String message coprocessorName e toString
env e IOException e IOException IOException e env abortServer env e env RegionCoprocessorEnvironment String tableName RegionCoprocessorEnvironment env getRegionInfo getTable getNameAsString LOG error env toString tableName e LOG error env toString e coprocEnvironments remove env shutdown env
exception
String msg eventType
delayedSubmitTimer shutdownNow entry List Runnable wasRunning entry getValue threadPoolExecutor shutdownNow wasRunning
type String name type getExecutorName servername name
eh Executor executor getExecutor eh getEventType getExecutorServiceType executor
List ServerName servers RegionInfo parent RegionInfo RegionInfo Map RegionInfo List ServerName result HashMap FavoredNodeAssignmentHelper helper FavoredNodeAssignmentHelper servers rackManager helper initialize List ServerName parentFavoredNodes getFavoredNodes parent parentFavoredNodes
String regionName dstFamilyPath getParent getName String tableName CommonFSUtils getTableName dstFamilyPath getParent getParent getNameAsString String name createHFileLinkName linkedTable linkedRegion hfileName String refName createBackReferenceName tableName regionName fs mkdirs dstFamilyPath Path archiveStoreDir HFileArchiveUtil getStoreArchivePath conf linkedTable linkedRegion familyName Path backRefPath Path backRefssDir getBackReferencesDir archiveStoreDir hfileName fs mkdirs backRefssDir backRefPath Path backRefssDir refName fs createNewFile backRefPath fs createNewFile Path dstFamilyPath name
CommonFSUtils setFsDefault getConf CommonFSUtils getRootDir getConf ex LOG error ex ex LOG error ex fileName exitCode processFile fileName exitCode exitCode
cachedBlock HFileBlock compressedBlock cachedBlock cachedBlock compressedBlock unpack hfileContext fsBlockReader compressedBlock cachedBlock compressedBlock release validateBlockType cachedBlock expectedBlockType e returnAndEvictBlock cache cacheKey cachedBlock e cachedBlock DataBlockEncoding actualDataBlockEncoding cachedBlock getDataBlockEncoding cachedBlock actualDataBlockEncoding DataBlockEncoding actualDataBlockEncoding DataBlockEncoding
path prefetchFutures remove path
cancel path Future future prefetchFutures get path future future cancel prefetchFutures remove path
IndexStatistics total IndexStatistics IndexStatistics stats getIndexStatistics total LOG info
IndexStatistics total IndexStatistics IndexStatistics stats getIndexStatistics total LOG info LOG info total freeBytes total usedBytes total totalBytes IndexStatistics stats
BucketEntry bucketEntry backingMap get key bucketEntry start System nanoTime ReentrantReadWriteLock lock offsetLock getLock bucketEntry offset lock readLock lock bucketEntry backingMap get key Cacheable cachedBlock ioEngine read bucketEntry ioEngine cachedBlock retain cacheStats hit caching key isPrimary key getBlockType cacheStats ioHit System nanoTime start bucketEntry access accessCount incrementAndGet
totalSize bucketAllocator getTotalSize usedSize bucketAllocator getUsedSize freeSize totalSize usedSize cacheSize getRealCacheSize
i i stats i bytesToFreeForBucket i freeGoal Math floor stats i totalCount minFactor freeGoal Math max freeGoal stats i freeCount freeGoal bytesToFreeForBucket i stats i itemSize freeGoal stats i freeCount bytesToFreeWithoutExtra bytesToFreeForBucket i msgBuffer msgBuffer append stats i itemSize StringUtils byteDesc bytesToFreeForBucket i msgBuffer msgBuffer append StringUtils byteDesc bytesToFreeWithoutExtra bytesToFreeWithoutExtra currentSize bucketAllocator getUsedSize totalSize bucketAllocator getTotalSize
bucketQueue add bucketMulti bucketQueue add bucketMemory remainingBuckets bucketQueue size bytesFreed BucketEntryGroup bucketGroup bucketGroup bucketQueue overflow bucketGroup overflow overflow bucketBytesToFree Math min overflow bytesToFreeWithoutExtra bytesFreed remainingBuckets bytesFreed bucketGroup free bucketBytesToFree remainingBuckets bucketQueue clear remainingBuckets bucketQueue add bucketSingle
now EnvironmentEdgeManager currentTime ioErrorStartTimeTmp ioErrorStartTime ioErrorStartTimeTmp now ioErrorStartTimeTmp
algorithm StringBuilder sb StringBuilder filePath File file File filePath sb append filePath sb append getFileSize filePath sb append file lastModified MessageDigest messageDigest MessageDigest getInstance algorithm messageDigest update Bytes toBytes sb toString messageDigest digest ioex LOG error ioex
conf String lowMarkPercentStr conf get MEMSTORE_SIZE_LOWER_LIMIT_KEY lowMarkPercentStr lowMarkPercent Float parseFloat lowMarkPercentStr lowMarkPercent
String lowMarkPercentStr conf get MEMSTORE_SIZE_LOWER_LIMIT_KEY lowMarkPercentStr lowMarkPercent Float parseFloat lowMarkPercentStr lowMarkPercent LOG error MEMSTORE_SIZE_LOWER_LIMIT_KEY lowMarkPercent lowMarkPercent lowMarkPercent honorOldConfig DEFAULT_MEMSTORE_SIZE_LOWER_LIMIT String lowerWaterMarkOldValStr conf get MEMSTORE_SIZE_LOWER_LIMIT_OLD_KEY lowerWaterMarkOldValStr LOG warn MEMSTORE_SIZE_LOWER_LIMIT_OLD_KEY MEMSTORE_SIZE_LOWER_LIMIT_KEY lowerWaterMarkOldVal Float parseFloat lowerWaterMarkOldValStr upperMarkPercent getGlobalMemStoreHeapPercent conf lowerWaterMarkOldVal upperMarkPercent lowerWaterMarkOldVal upperMarkPercent
metrics dequeuedCall qTime metrics processedCall processingTime metrics totalCall totalTime metrics receivedRequest requestSize metrics sentResponse responseSize tooSlow processingTime warnResponseTime warnResponseTime tooLarge responseSize warnResponseSize warnResponseSize tooSlow tooLarge String userName call getRequestUserName orElse StringUtils EMPTY logResponse param md getName md getName param getClass getName tooLarge tooSlow status getClient startTime processingTime qTime responseSize userName namedQueueRecorder String className server StringUtils EMPTY server getClass getSimpleName namedQueueRecorder addRecord RpcLogDetails call param status getClient responseSize className tooSlow tooLarge Pair result controller cellScanner
tooLarge responseSize warnResponseSize warnResponseSize tooSlow tooLarge String userName call getRequestUserName orElse StringUtils EMPTY logResponse param md getName md getName param getClass getName tooLarge tooSlow status getClient startTime processingTime qTime responseSize userName namedQueueRecorder String className server StringUtils EMPTY server getClass getSimpleName namedQueueRecorder addRecord RpcLogDetails call param status getClient responseSize className tooSlow tooLarge Pair result controller cellScanner e e e getCause LOG debug e e e getCause metrics exception e
startupStatus String backupZNode ZNodePaths joinZNode watcher getZNodePaths backupMasterAddressesZNode sn toString startupStatus setStatus watcher watcher getZNodePaths sn watcher backupZNode
bytes ZKUtil getDataAndWatch watcher watcher getZNodePaths masterAddressZNode bytes msg ServerName currentMaster currentMaster ProtobufUtil parseServerNameFrom bytes e LOG warn e ServerName currentMaster msg currentMaster ZKUtil deleteNode watcher watcher getZNodePaths masterAddressZNode ZNodeClearer deleteMyEphemeralNodeOnDisk
e LOG warn e currentMaster msg currentMaster ZKUtil deleteNode watcher watcher getZNodePaths masterAddressZNode ZNodeClearer deleteMyEphemeralNodeOnDisk msg currentMaster LOG info msg startupStatus setStatus msg ke master abort ke
Path daughterRegionDir Path tabledir daughter getEncodedName HRegionFileSystem regionFs fs daughterRegionDir Pair Boolean FALSE Boolean FALSE ioe LOG error ioe Pair Boolean TRUE Boolean TRUE references TableDescriptor parentDescriptor getDescriptor parent getTable regionFs HRegionFileSystem openRegionFromFileSystem services getConfiguration fs tabledir daughter parentDescriptor references regionFs
add drainingServers drainingServers clear n ServerName sn ServerName valueOf ZKUtil getNodeName n drainingServers add sn serverManager addServerToDrainList sn
path path ServerName sn ServerName valueOf ZKUtil getNodeName path
status setStatus cpHost MasterCoprocessorHost conf status setStatus InitMetaProcedure initMetaProc RegionState rs assignmentManager getRegionStates getRegionState RegionInfoBuilder FIRST_META_REGIONINFO LOG info rs rs rs Optional InitMetaProcedure optProc procedureExecutor getProcedures stream filter p p InitMetaProcedure map o InitMetaProcedure o findAny initMetaProc optProc InitMetaProcedure temp InitMetaProcedure procedureExecutor submitProcedure temp temp balancer setMasterServices balancer setClusterMetrics getClusterMetricsWithoutCoprocessor
getChoreService scheduleChore catalogJanitorChore hbckChore HbckChore getChoreService scheduleChore hbckChore serverManager startChore status setStatus initClusterSchemaService cpHost cpHost preMasterInitialization e LOG error e status markComplete LOG info String format System currentTimeMillis masterActiveTime
startProcedureExecutor cleanerPool DirScanPool conf cleanerInterval conf getInt HBASE_MASTER_CLEANER_INTERVAL DEFAULT_HBASE_MASTER_CLEANER_INTERVAL logCleaner LogCleaner cleanerInterval conf getMasterWalManager getFileSystem getMasterWalManager getOldLogDir cleanerPool getChoreService scheduleChore logCleaner Path archiveDir HFileArchiveUtil getArchivePath conf Map String Object params HashMap params put MASTER hfileCleaner HFileCleaner cleanerInterval conf getMasterFileSystem getFileSystem archiveDir cleanerPool params getChoreService scheduleChore hfileCleaner maxStoreFileRefCount conf getInt HConstants STORE_FILE_REF_COUNT_THRESHOLD HConstants DEFAULT_STORE_FILE_REF_COUNT_THRESHOLD maxStoreFileRefCount regionsRecoveryChore RegionsRecoveryChore conf getChoreService scheduleChore regionsRecoveryChore
LOG debug ioe LOG error ioe Map TableName Map ServerName List RegionInfo assignments assignmentManager getRegionStates getAssignmentsForBalancer tableStateManager serverManager getOnlineServersList Map ServerName List RegionInfo serverMap assignments serverMap keySet removeAll serverManager getDrainingServersList balancer setClusterMetrics getClusterMetricsWithoutCoprocessor List RegionPlan plans balancer balanceCluster assignments
List RegionPlan List RegionPlan plans List RegionPlan successRegionPlans ArrayList maxRegionsInTransition getMaxRegionsInTransition balanceStartTime System currentTimeMillis cutoffTime balanceStartTime maxBalancingTime rpCount plans plans balanceInterval maxBalancingTime plans size
List RegionPlan List RegionPlan plans List RegionPlan successRegionPlans ArrayList maxRegionsInTransition getMaxRegionsInTransition balanceStartTime System currentTimeMillis cutoffTime balanceStartTime maxBalancingTime rpCount plans plans balanceInterval maxBalancingTime plans size LOG info plans size balanceInterval maxRegionsInTransition RegionPlan plans
LOG info affectedTables Set TableName matchingTables getTableDescriptors LinkedList ntfp getNamespace ntfp getRegex ntfp getTableNames stream map TableDescriptor getTableName collect Collectors toSet Set TableName allEnabledTables tableStateManager getTablesInStates TableState State ENABLED List TableName targetTables ArrayList Sets intersection matchingTables allEnabledTables Collections shuffle targetTables List Long submittedPlanProcIds ArrayList TableName targetTables
affectedTables Set TableName matchingTables getTableDescriptors LinkedList ntfp getNamespace ntfp getRegex ntfp getTableNames stream map TableDescriptor getTableName collect Collectors toSet Set TableName allEnabledTables tableStateManager getTablesInStates TableState State ENABLED List TableName targetTables ArrayList Sets intersection matchingTables allEnabledTables Collections shuffle targetTables List Long submittedPlanProcIds ArrayList TableName table targetTables table TableDescriptor tblDesc getTableDescriptors get table tblDesc tblDesc LOG debug table
TableDescriptor tblDesc getTableDescriptors get table tblDesc tblDesc LOG debug table List NormalizationPlan plans normalizer computePlansForTable table plans LOG debug table affectedTables NormalizationPlan plan plans procId plan submit submittedPlanProcIds add procId plan
TableDescriptor tblDesc getTableDescriptors get table tblDesc tblDesc LOG debug table List NormalizationPlan plans normalizer computePlansForTable table plans LOG debug table affectedTables NormalizationPlan plan plans procId plan submit submittedPlanProcIds add procId plan
String backupZNode ZNodePaths joinZNode zooKeeper getZNodePaths backupMasterAddressesZNode serverName toString
LOG warn backupZNode serverName activeMasterManager setInfoPort infoPort timeout conf getInt HConstants ZK_SESSION_TIMEOUT HConstants DEFAULT_ZK_SESSION_TIMEOUT conf HConstants HConstants LOG debug activeMasterManager LOG debug Threads sleep timeout MonitoredTask status TaskMonitor get createStatus status setDescription activeMasterManager timeout status finishActiveMasterInitialization status t status setStatus t getMessage
tableName checkInitialized getMaster getMasterCoprocessorHost preDeleteTable tableName
tableName checkInitialized getMaster getMasterCoprocessorHost preTruncateTable tableName
tableName checkInitialized getMaster getMasterCoprocessorHost preDisableTable tableName
tableName newDescriptorGetter TableDescriptor oldDescriptor getMaster getTableDescriptors get tableName TableDescriptor newDescriptor getMaster getMasterCoprocessorHost preModifyTable tableName oldDescriptor newDescriptorGetter get TableDescriptorChecker sanityCheck conf newDescriptor
instance Descriptors ServiceDescriptor serviceDesc instance getDescriptorForType String serviceName CoprocessorRpcUtils getServiceName serviceDesc serviceName
namespaceDescriptor checkInitialized TableName isLegalNamespaceName Bytes toBytes namespaceDescriptor getName getMaster getMasterCoprocessorHost preCreateNamespace namespaceDescriptor ProcedurePrepareLatch latch ProcedurePrepareLatch createBlockingLatch
NamespaceDescriptor newNsDescriptor checkInitialized TableName isLegalNamespaceName Bytes toBytes newNsDescriptor getName NamespaceDescriptor oldNsDescriptor getNamespace newNsDescriptor getName getMaster getMasterCoprocessorHost preModifyNamespace oldNsDescriptor newNsDescriptor ProcedurePrepareLatch latch ProcedurePrepareLatch createBlockingLatch
name checkInitialized getMaster getMasterCoprocessorHost preDeleteNamespace name
ZKUtil deleteNodeFailSilent getZooKeeper node ke HBaseIOException zooKeeper prefix server getServerName ke serverManager removeServerFromDrainList server serverManager server encodedRegionName RegionState regionState assignmentManager getRegionStates getRegionState Bytes toString encodedRegionName regionState LOG warn Bytes toStringBinary encodedRegionName RegionInfo hri regionState getRegion server regionState getServerName
Options opt Options opt addOption opt addOption opt addOption opt addOption CommandLine cmd cmd GnuParser parse opt args e LOG error e usage cmd String val cmd getOptionValue getConf setInt Integer parseInt val
opt addOption CommandLine cmd cmd GnuParser parse opt args e LOG error e usage cmd String val cmd getOptionValue getConf setInt Integer parseInt val LOG debug val cmd String val cmd getOptionValue getConf setInt Integer parseInt val
LOG error e usage cmd String val cmd getOptionValue getConf setInt Integer parseInt val LOG debug val cmd String val cmd getOptionValue getConf setInt Integer parseInt val LOG debug val cmd getConf setBoolean HConstants MASTER_TYPE_BACKUP cmd String val cmd getOptionValue
cmd String val cmd getOptionValue getConf setInt Integer parseInt val LOG debug val cmd String val cmd getOptionValue getConf setInt Integer parseInt val LOG debug val cmd getConf setBoolean HConstants MASTER_TYPE_BACKUP cmd String val cmd getOptionValue getConf setInt Integer parseInt val LOG debug val cmd
Configuration conf getConf conf setInt HConstants HBASE_CLIENT_RETRIES_NUMBER conf admin admin shutdown t LOG error t LOG error LOG error
status fs getFileStatus rd status versionFileWriteAttempts c getInt HConstants VERSION_FILE_WRITE_ATTEMPTS HConstants DEFAULT_VERSION_FILE_WRITE_ATTEMPTS status fs rd IOException HConstants HBASE_DIR rd FSUtils setVersion fs rd threadWakeFrequency versionFileWriteAttempts status IllegalArgumentException HConstants HBASE_DIR rd FSUtils checkVersion fs rd threadWakeFrequency versionFileWriteAttempts
status versionFileWriteAttempts c getInt HConstants VERSION_FILE_WRITE_ATTEMPTS HConstants DEFAULT_VERSION_FILE_WRITE_ATTEMPTS status fs rd IOException HConstants HBASE_DIR rd FSUtils setVersion fs rd threadWakeFrequency versionFileWriteAttempts status IllegalArgumentException HConstants HBASE_DIR rd FSUtils checkVersion fs rd threadWakeFrequency versionFileWriteAttempts de LOG error HBaseMarkers FATAL HConstants HBASE_DIR rd de IOException de
ZKWatcher zooKeeper master getZooKeeper List String metaReplicaZnodes zooKeeper getMetaReplicaNodes String metaReplicaZnode metaReplicaZnodes replicaId zooKeeper getZNodePaths getMetaReplicaIdFromZnode metaReplicaZnode replicaId RegionState r MetaTableLocator getMetaRegionState zooKeeper replicaId
createTable req TableDescriptor tableDescriptor ProtobufUtil toTableDescriptor req getTableSchema splitKeys ProtobufUtil getSplitKeysArray req procId master createTable tableDescriptor splitKeys req getNonceGroup req getNonce
master checkInitialized master snapshotManager checkSnapshotSupport
switchSnapshotCleanup enabledNewVal synchronous oldValue master snapshotCleanupTracker isSnapshotCleanupEnabled master switchSnapshotCleanup enabledNewVal synchronous
master checkInitialized master snapshotManager checkSnapshotSupport
master cpHost master cpHost preClearDeadServers master getServerManager LOG debug response addAllServerName request getServerNameList DeadServer deadServer master getServerManager getDeadServers Set Address clearedServers HashSet ServerName pbServer request getServerNameList ServerName server ProtobufUtil toServerName pbServer deadServer server response addServerName pbServer clearedServers add server getAddress master getRSGroupInfoManager removeServers clearedServers
request TableName tn ProtobufUtil toTableName request getTableName TableState prevState master getTableStateManager getTableState tn TableState newState TableState convert tn request getTableState
MasterProtos AssignsResponse MasterProtos request checkMasterProcedureExecutor MasterProtos AssignsResponse Builder responseBuilder MasterProtos AssignsResponse newBuilder override request getOverride
MasterProtos AssignsResponse MasterProtos request checkMasterProcedureExecutor MasterProtos AssignsResponse Builder responseBuilder MasterProtos AssignsResponse newBuilder override request getOverride LOG info master getClientIdAuditPrefix override rs request pid Procedure NO_PROC_ID RegionInfo ri getRegionInfo rs ri
MasterProtos UnassignsResponse MasterProtos request checkMasterProcedureExecutor MasterProtos UnassignsResponse Builder responseBuilder MasterProtos UnassignsResponse newBuilder override request getOverride
MasterProtos UnassignsResponse MasterProtos request checkMasterProcedureExecutor MasterProtos UnassignsResponse Builder responseBuilder MasterProtos UnassignsResponse newBuilder override request getOverride LOG info master getClientIdAuditPrefix override rs request pid Procedure NO_PROC_ID RegionInfo ri getRegionInfo rs ri
List Long pids ArrayList ServerName sn ServerName serverName ProtobufUtil toServerName sn
List Procedure MasterProcedureEnv procedures master getMasterProcedureExecutor getProcedures Procedure MasterProcedureEnv procedures
request String groupName request getRSGroupName
request TableName tableName ProtobufUtil toTableName request getTableName
request Address hp Address fromParts request getServer getHostName request getServer getPort
AddRSGroupResponse AddRSGroupResponse Builder builder AddRSGroupResponse newBuilder
RemoveRSGroupResponse RemoveRSGroupResponse Builder builder RemoveRSGroupResponse newBuilder
BalanceRSGroupResponse BalanceRSGroupResponse Builder builder BalanceRSGroupResponse newBuilder
ListTablesInRSGroupResponse request ListTablesInRSGroupResponse Builder builder ListTablesInRSGroupResponse newBuilder String groupName request getGroupName
GetConfiguredNamespacesAndTablesInRSGroupResponse request GetConfiguredNamespacesAndTablesInRSGroupResponse Builder builder GetConfiguredNamespacesAndTablesInRSGroupResponse newBuilder String groupName request getGroupName
RenameRSGroupResponse request RenameRSGroupResponse Builder builder RenameRSGroupResponse newBuilder String oldRSGroup request getOldRsgroupName String newRSGroup request getNewRsgroupName
UpdateRSGroupConfigResponse request UpdateRSGroupConfigResponse Builder builder UpdateRSGroupConfigResponse newBuilder String groupName request getGroupName Map String String configuration HashMap request getConfigurationList forEach p configuration put p getName p getValue
fs exists logsDirPath serverNames FileStatus logFolders CommonFSUtils listStatus fs logsDirPath Set ServerName onlineServers services getServerManager getOnlineServers keySet logFolders logFolders LOG debug serverNames FileStatus status logFolders FileStatus curLogFiles CommonFSUtils listStatus fs status getPath curLogFiles curLogFiles ServerName serverName AbstractFSWALProvider getServerNameFromWALDirectoryName status getPath serverName LOG warn status getPath onlineServers serverName
FileStatus logFolders CommonFSUtils listStatus fs logsDirPath Set ServerName onlineServers services getServerManager getOnlineServers keySet logFolders logFolders LOG debug serverNames FileStatus status logFolders FileStatus curLogFiles CommonFSUtils listStatus fs status getPath curLogFiles curLogFiles ServerName serverName AbstractFSWALProvider getServerNameFromWALDirectoryName status getPath serverName LOG warn status getPath onlineServers serverName LOG info status getPath serverNames add serverName
List Path logDirs ArrayList needReleaseLock splitLogLock lock needReleaseLock serverName Path logDir Path rootDir AbstractFSWALProvider getWALDirectoryName serverName toString Path splitDir logDir suffix AbstractFSWALProvider SPLITTING_EXT logDir logDir splitDir IOException logDir logDir splitDir LOG debug splitDir splitDir
List RegionInfo List RegionInfo RegionInfo holes List RegionInfo newRegionInfos holes stream map MetaFixer getHoleCover filter Optional isPresent map Optional get collect Collectors toList
path opType path LOG debug path opType name replicaId watcher getZNodePaths getMetaReplicaIdFromPath path RetryCounter retryCounter retryCounterFactory create HRegionLocation location retryCounter opType watcher path location getMetaRegionLocation replicaId
tableName assignmentSnapshot Map Map List RegionInfo regions assignmentSnapshot getTableToRegionMap get tableName numRegions regions size Map RegionInfo ServerName currentAssignmentMap assignmentSnapshot getRegionToRegionServerMap List ServerName servers ArrayList servers addAll FutureUtils get getConnection getAdmin getRegionServers
m m slotsPerServer m secondaryCost i k slotsPerServer m AVOID_COST tertiaryCost i k slotsPerServer m AVOID_COST randomizedMatrix RandomizedMatrix numRegions regionSlots secondaryCost randomizedMatrix transform secondaryCost secondaryAssignment MunkresAssignment secondaryCost solve secondaryAssignment randomizedMatrix invertIndices secondaryAssignment i i numRegions i slot secondaryAssignment i String rack rackManager getRack servers get slot slotsPerServer k k servers k k slot slotsPerServer m m slotsPerServer m
m m slotsPerServer m tertiaryCost i k slotsPerServer m MAX_COST servers get k m m slotsPerServer m tertiaryCost i k slotsPerServer m AVOID_COST randomizedMatrix RandomizedMatrix numRegions regionSlots tertiaryCost randomizedMatrix transform tertiaryCost tertiaryAssignment MunkresAssignment tertiaryCost solve tertiaryAssignment randomizedMatrix invertIndices tertiaryAssignment i i numRegions i List ServerName favoredServers ArrayList FavoredNodeAssignmentHelper FAVORED_NODES_NUM ServerName s servers get primaryAssignment i slotsPerServer favoredServers add ServerName valueOf s getHostname s getPort ServerName NON_STARTCODE
plan plan LOG info Map String List ServerName assignmentMap TreeMap plan getAssignmentMap Map String List ServerName entry assignmentMap String serverList FavoredNodeAssignmentHelper getFavoredNodesAsString entry getValue String regionName entry getKey
plan plan LOG info Map String List ServerName assignmentMap TreeMap plan getAssignmentMap Map String List ServerName entry assignmentMap String serverList FavoredNodeAssignmentHelper getFavoredNodesAsString entry getValue String regionName entry getKey LOG info regionName
ServerName List RegionInfo entry List Pair RegionInfo List ServerName regionUpdateInfos ArrayList FavoredNodesPlan singleServerPlan RegionInfo region entry List ServerName favoredServerList plan getFavoredNodes region favoredServerList favoredServerList singleServerPlan singleServerPlan FavoredNodesPlan singleServerPlan updateFavoredNodesMap region favoredServerList regionUpdateInfos add Pair region favoredServerList singleServerPlan AsyncRegionServerAdmin rsAdmin getConnection getRegionServerAdmin entry getKey UpdateFavoredNodesRequest request RequestConverter buildUpdateFavoredNodesRequest regionUpdateInfos UpdateFavoredNodesResponse updateFavoredNodesResponse FutureUtils get rsAdmin updateFavoredNodes request
singleServerPlan singleServerPlan FavoredNodesPlan singleServerPlan updateFavoredNodesMap region favoredServerList regionUpdateInfos add Pair region favoredServerList singleServerPlan AsyncRegionServerAdmin rsAdmin getConnection getRegionServerAdmin entry getKey UpdateFavoredNodesRequest request RequestConverter buildUpdateFavoredNodesRequest regionUpdateInfos UpdateFavoredNodesResponse updateFavoredNodesResponse FutureUtils get rsAdmin updateFavoredNodes request LOG info FutureUtils get rsAdmin getServerInfo RequestConverter buildGetServerInfoRequest getServerInfo updateFavoredNodesResponse getResponse singleServerPlan size succeededNum e failedUpdateMap put entry getKey e LOG info succeededNum failedNum failedUpdateMap size failedNum
ServerName server servers get p ordinal Float currentLocality servers currentLocality regionLocality get server getHostname currentLocality currentLocality locality i currentLocality i i i locality i String copy i copy i copy i
opt addOption opt addOption opt addOption CommandLine cmd GnuParser parse opt args Configuration conf HBaseConfiguration create enforceMinAssignmentMove enforceLocality verificationDetails cmd cmd getOptionValue cmd cmd getOptionValue enforceLocality cmd cmd getOptionValue cmd cmd getOptionValue enforceMinAssignmentMove cmd conf set HConstants ZOOKEEPER_QUORUM cmd getOptionValue
CommandLine cmd GnuParser parse opt args Configuration conf HBaseConfiguration create enforceMinAssignmentMove enforceLocality verificationDetails cmd cmd getOptionValue cmd cmd getOptionValue enforceLocality cmd cmd getOptionValue cmd cmd getOptionValue enforceMinAssignmentMove cmd conf set HConstants ZOOKEEPER_QUORUM cmd getOptionValue LOG info conf get HConstants ZOOKEEPER_QUORUM cmd conf set FileSystem FS_DEFAULT_NAME_KEY cmd getOptionValue
enforceMinAssignmentMove enforceLocality verificationDetails cmd cmd getOptionValue cmd cmd getOptionValue enforceLocality cmd cmd getOptionValue cmd cmd getOptionValue enforceMinAssignmentMove cmd conf set HConstants ZOOKEEPER_QUORUM cmd getOptionValue LOG info conf get HConstants ZOOKEEPER_QUORUM cmd conf set FileSystem FS_DEFAULT_NAME_KEY cmd getOptionValue LOG info conf get FileSystem FS_DEFAULT_NAME_KEY cmd conf set HConstants HBASE_DIR cmd getOptionValue
names ZKUtil listChildrenAndWatchForNewChildren watcher watcher getZNodePaths rsZNode e server abort e Set ServerName servers names stream map ServerName parseServerName collect Collectors toSet ServerName iter iter ServerName sn iter next servers sn LOG info sn serverManager expireServer sn iter remove newServerAdded ServerName sn servers sn newServerAdded
ClusterMetrics clusterMetrics hMaster getClusterMetrics Map ServerName ServerMetrics serverMetricsMap clusterMetrics getLiveServerMetrics Map TableName List tableToReopenRegionsMap getTableToRegionsByRefCount serverMetricsMap tableToReopenRegionsMap tableToReopenRegionsMap tableName regionNames LOG warn tableName regionNames size hMaster reopenRegions tableName regionNames NONCE_GENERATOR getNonceGroup NONCE_GENERATOR newNonce e LOG error ERROR_REOPEN_REIONS_MSG tableName regionNames e LOG LOG debug HConstants STORE_FILE_REF_COUNT_THRESHOLD
sn checkIsDead sn sn sn
ServerName serverName ServerName existingServer existingServer findServerWithSameHostnamePortWithLock serverName existingServer existingServer serverName
serverName String what serverName String message what serverName
serverName master getServerName master master master stop Procedure NO_PROC_ID serverName LOG warn serverName Procedure NO_PROC_ID moveFromOnlineToDeadServers serverName master getZooKeeper String drainingZnode ZNodePaths joinZNode master getZooKeeper getZNodePaths drainingZNode serverName getServerName ZKUtil deleteNodeFailSilent master getZooKeeper drainingZnode e LOG warn serverName getServerName e
serverName LOG warn serverName Procedure NO_PROC_ID moveFromOnlineToDeadServers serverName master getZooKeeper String drainingZnode ZNodePaths joinZNode master getZooKeeper getZNodePaths drainingZNode serverName getServerName ZKUtil deleteNodeFailSilent master getZooKeeper drainingZnode e LOG warn serverName getServerName e LOG info serverName onlineServers size onlineServers master stop Procedure NO_PROC_ID
LOG warn String format WAIT_ON_REGIONSERVERS_MAXTOSTART maxToStart WAIT_ON_REGIONSERVERS_MINTOSTART minToStart maxToStart Integer MAX_VALUE now System currentTimeMillis startTime now slept lastLogTime lastCountChange startTime count countOfRegionServers oldCount listener listener waiting count maxToStart lastCountChange now timeout slept count minToStart oldCount count lastLogTime now lastLogTime now String msg count slept minToStart getStrForMax maxToStart timeout lastCountChange now
count maxToStart lastCountChange now timeout slept count minToStart oldCount count lastLogTime now lastLogTime now String msg count slept minToStart getStrForMax maxToStart timeout lastCountChange now LOG info msg status setStatus msg sleepTime Thread sleep sleepTime now System currentTimeMillis slept now startTime oldCount count count countOfRegionServers count oldCount lastCountChange now
String statusStr master getServerName
Configuration conf master getConfiguration Path rootDir CommonFSUtils getRootDir conf Path lastFlushedSeqIdPath Path rootDir LAST_FLUSHED_SEQ_ID_FILE FileSystem fs FileSystem get conf fs lastFlushedSeqIdPath LOG info lastFlushedSeqIdPath LOG info lastFlushedSeqIdPath FSDataInputStream in fs open lastFlushedSeqIdPath FlushedSequenceId flushedSequenceId FlushedSequenceId parseDelimitedFrom in flushedSequenceId
serverNames logDirs filter MonitoredTask status TaskMonitor get createStatus logDirs serverNames totalSize TaskBatch batch startTime FileStatus logfiles getFileList logDirs filter logfiles status setStatus SplitLogCounters tot_mgr_log_split_batch_start increment
String msg logDirs batch status abort msg IOException msg logDir logDirs status setStatus FileSystem fs logDir getFileSystem conf fs logDir fs logDir LOG warn logDir IOException ioe FileStatus files fs listStatus logDir files files LOG warn logDir Arrays toString files ioe LOG warn logDir ioe
List FileStatus serverName splitMeta List Path logDirs master getMasterWalManager getLogDirs Collections singleton serverName FileStatus fileStatuses SplitLogManager getFileList conf logDirs splitMeta META_FILTER NON_META_FILTER
ServerName Optional ServerName worker splitWorkerAssigner acquire worker
TableState State entry entry getKey deleteZooKeeper entry getKey LOG info entry getKey TableState ts ts getTableState entry getKey ts TableState State zkstate entry getValue zkstate TableState State zkstate TableState State
List RegionPlan plans ArrayList server server List RegionInfo regionsShouldMove getSystemTables server regionsShouldMove RegionInfo regionInfo regionsShouldMove RegionPlan plan RegionPlan regionInfo server regionInfo
List RegionPlan plans ArrayList server server List RegionInfo regionsShouldMove getSystemTables server regionsShouldMove RegionInfo regionInfo regionsShouldMove RegionPlan plan RegionPlan regionInfo server regionInfo LOG info regionInfo getEncodedName server moveAsync plan plans add plan
ProcedureExecutor MasterProcedureEnv procExec master getMasterProcedureExecutor carryingMeta isCarryingMeta serverName serverNode serverNode ServerState LOG info serverNode carryingMeta Procedure NO_PROC_ID MasterProcedureEnv mpe procExec getEnvironment ServerState oldState serverNode oldState serverNode getState serverNode setState ServerState CRASHED pid procExec submitProcedure HBCKServerCrashProcedure mpe serverName shouldSplitWal carryingMeta
LOG trace regions size HashMap RegionInfo ServerName retainMap HashMap List RegionInfo userHRIs ArrayList regions size List RegionInfo systemHRIs ArrayList regionStateNode regions sysTable regionStateNode isSystemTable List RegionInfo hris sysTable systemHRIs userHRIs regionStateNode getRegionLocation retainMap put regionStateNode getRegionInfo regionStateNode getRegionLocation hris add regionStateNode getRegionInfo List ServerName servers master getServerManager createDestinationServersList servers size LOG warn regions size
hris add regionStateNode getRegionInfo List ServerName servers master getServerManager createDestinationServersList servers size LOG warn regions size LOG debug regions size Threads sleep servers master getServerManager createDestinationServersList List ServerName excludeServers getExcludedServersForSystemTable List ServerName serversForSysTables servers stream filter s excludeServers contains s collect Collectors toList serversForSysTables
MasterServices masterServices env getMasterServices mfs masterServices FileSystem fs mfs getFileSystem HFileArchiver masterServices getConfiguration fs getRegion LOG LOG debug getRegion getShortNameToLog HFileArchiver archiveRegion masterServices getConfiguration fs getRegion FileSystem walFs mfs getWALFileSystem Path regionWALDir CommonFSUtils getWALRegionDir env getMasterConfiguration getRegion getTable getRegion getEncodedName walFs regionWALDir walFs regionWALDir
mfs masterServices FileSystem fs mfs getFileSystem HFileArchiver masterServices getConfiguration fs getRegion LOG LOG debug getRegion getShortNameToLog HFileArchiver archiveRegion masterServices getConfiguration fs getRegion FileSystem walFs mfs getWALFileSystem Path regionWALDir CommonFSUtils getWALRegionDir env getMasterConfiguration getRegion getTable getRegion getEncodedName walFs regionWALDir walFs regionWALDir LOG debug regionWALDir Path wrongRegionWALDir CommonFSUtils getWrongWALRegionDir env getMasterConfiguration getRegion getTable getRegion getEncodedName walFs wrongRegionWALDir
RegionInfo lockRegions Arrays copyOf regionsToMerge regionsToMerge length lockRegions lockRegions length mergedRegion lockRegions
env RegionStateNode regionNode getRegionNode env regionNode lock env
result RegionLocations rl CatalogFamilyFormat getRegionLocations result rl HRegionLocation locations rl getRegionLocations locations i i locations i HRegionLocation hrl locations i hrl RegionInfo regionInfo hrl getRegion regionInfo replicaId regionInfo getReplicaId State state getRegionState result regionInfo ServerName lastHost hrl getServerName ServerName regionLocation MetaTableAccessor getTargetServerName result replicaId openSeqNum hrl getSeqNum
Put put Put CatalogFamilyFormat getMetaKeyForRegion regionInfo time MetaTableAccessor addRegionInfo put regionInfo StringBuilder info StringBuilder append pid append append regionInfo getEncodedName append append state openSeqNum Preconditions checkArgument state State OPEN regionLocation MetaTableAccessor addLocation put regionLocation openSeqNum replicaId regionInfo regionInfo MetaTableAccessor addReplicationBarrier put openSeqNum info append append openSeqNum info append append openSeqNum info append append regionLocation regionLocation put add CellBuilderFactory create CellBuilderType SHALLOW_COPY setRow put getRow setFamily HConstants CATALOG_FAMILY setQualifier CatalogFamilyFormat getServerNameColumn replicaId setTimestamp put getTimestamp setType Cell Type Put setValue Bytes toBytes regionLocation getServerName build info append append regionLocation put add CellBuilderFactory create CellBuilderType SHALLOW_COPY setRow put getRow setFamily HConstants CATALOG_FAMILY setQualifier getStateColumn replicaId setTimestamp put getTimestamp setType Cell Type Put setValue Bytes toBytes state name build
IllegalArgumentException RegionStateNode node env getAssignmentManager getRegionStates getRegionStateNode getParentRegion IOException splittableCheckIOE splittable node GetRegionInfoResponse response hasBestSplitRow LOG info node getRegionInfo getRegionNameAsString node getRegionLocation response AssignmentManagerUtil getRegionInfoResponse env node getRegionLocation node getRegionInfo bestSplitRow response hasBestSplitRow response getBestSplitRow toByteArray response AssignmentManagerUtil getRegionInfoResponse env node getRegionLocation node getRegionInfo splittable response hasSplittable response getSplittable LOG
setNextState SplitTableRegionState SPLIT_TABLE_REGION_PRE_OPERATION_AFTER_META SPLIT_TABLE_REGION_PRE_OPERATION_AFTER_META setNextState SplitTableRegionState SPLIT_TABLE_REGION_OPEN_CHILD_REGIONS SPLIT_TABLE_REGION_OPEN_CHILD_REGIONS setNextState SplitTableRegionState SPLIT_TABLE_REGION_POST_OPERATION SPLIT_TABLE_REGION_POST_OPERATION Flow NO_MORE_STATE String msg getParentRegion getEncodedName
env IOException env getParentRegion getTable setFailure IOException getParentRegion getShortNameToLog getParentRegion getTable RegionStateNode node env getAssignmentManager getRegionStates getRegionStateNode getParentRegion node UnknownRegionException getParentRegion getRegionNameAsString RegionInfo parentHRI node getRegionInfo parentHRI LOG info node node LOG info parentHRI parentHRI parentHRI
sfis Collection StoreFileInfo filteredSfis StoreFileInfo sfi sfis sfi LOG info sfi filteredSfis filteredSfis ArrayList StoreFileInfo sfis size files put family filteredSfis filteredSfis add sfi nbFiles nbFiles Pair Integer Integer maxThreads Math min conf getInt HConstants REGION_SPLIT_THREADS_MAX conf getInt HStore BLOCKING_STOREFILES_KEY HStore DEFAULT_BLOCKING_STOREFILE_COUNT nbFiles
threadPool shutdown fileSplitTimeout conf getLong conf getLong stillRunning threadPool awaitTermination fileSplitTimeout TimeUnit MILLISECONDS stillRunning threadPool shutdownNow threadPool Thread sleep IOException e InterruptedIOException InterruptedIOException initCause e daughterA daughterB
env RegionStateNode regionNode getRegionStateNode env RegionReplicaUtil regionNode getRegionInfo RegionInfo defaultRI RegionReplicaUtil getRegionInfoForDefaultReplica regionNode getRegionInfo env getRegionStateNode defaultRI
c ClusterLoadState cs ClusterLoadState c clusterState cs
ServerName target ServerName tmp tmp target tmp assignments get tmp add region numRetainedAssigments target randomAssignRegions add region randomAssignRegions Cluster cluster createCluster servers regions keySet ServerName entry assignments ServerName sn entry getKey region entry
List RegionPlan List List RegionPlan result ArrayList
servers servers masterServerName servers ArrayList servers servers remove masterServerName FavoredNodeAssignmentHelper helper FavoredNodeAssignmentHelper servers getConf helper initialize LOG debug Map RegionInfo List ServerName regionFNMap Maps newHashMap ServerName List RegionInfo entry ServerName sn entry getKey ServerName primary ServerName valueOf sn getHostname sn getPort NON_STARTCODE RegionInfo hri entry hri List ServerName favoredNodes fnm getFavoredNodes hri favoredNodes favoredNodes
List ServerName servers RegionInfo parent RegionInfo RegionInfo Map RegionInfo List ServerName result HashMap FavoredNodeAssignmentHelper helper FavoredNodeAssignmentHelper servers rackManager helper initialize List ServerName parentFavoredNodes fnm getFavoredNodes parent parentFavoredNodes
LOG info rulesPath limitPerRule clear String line line line String splits line split splits IOException line Pattern pattern Pattern compile splits Integer limit Integer parseInt splits limitPerRule put pattern limit IOException
conf originSlop slop originOverallSlop overallSlop setConf conf
loadOfOneTable HashMap loadOfOneTable loadOfOneTable remove masterServerName startTime System currentTimeMillis Cluster c Cluster loadOfOneTable regionFinder rackManager c ClusterLoadState cs ClusterLoadState loadOfOneTable numServers cs getNumServers NavigableMap ServerAndLoad List RegionInfo serversByLoad cs getServersByLoad numRegions cs getNumRegions average cs getLoadAverage max Math ceil average min average StringBuilder strBalanceParam StringBuilder
i i regionsToReturn i List Integer pos returnMap get regionsToReturn get i getDestination pos pos ArrayList returnMap put regionsToReturn get i getDestination pos pos add i i i serverLoadList i ServerAndLoad serverload serverLoadList get i BalanceInfo balanceInfo serverBalanceInfo get serverload getServerName balanceInfo setLoad serverLoadList i balanceInfo getNumRegionsAdded balanceInfo balanceInfo getNumRegionsAdded RegionInfo hriToPlan balanceInfo
cluster ClusterLoadState cs ClusterLoadState cluster clusterState cs
total sumMultiplier c multiplier c getMultiplier multiplier LOG trace c getClass getSimpleName c LOG trace c getClass getSimpleName sumMultiplier multiplier total c cost multiplier
Cluster cluster Cluster loadOfOneTable loads finder rackManager startTime EnvironmentEdgeManager currentTime initCosts cluster cluster currentCost computeCost cluster Double MAX_VALUE curOverallCost currentCost System arraycopy tempFunctionCosts curFunctionCosts curFunctionCosts length initCost currentCost newCost currentCost computedMaxSteps computedMaxSteps Math max maxSteps cluster numRegions stepsPerRegion cluster numServers calculatedMaxSteps cluster numRegions stepsPerRegion cluster numServers
step step step step Cluster Action action nextAction cluster action cluster doAction action updateCostsWithAction cluster action newCost computeCost cluster currentCost newCost currentCost currentCost newCost curOverallCost currentCost System arraycopy tempFunctionCosts curFunctionCosts curFunctionCosts length Action undoAction action undoAction cluster doAction undoAction
CompletableFuture futures CompletableFuture futures e e result completeExceptionally e allSubDirsDeleted futures stream allMatch CompletableFuture join deleted allFilesDeleted allSubDirsDeleted isEmptyDirDeletable dir deleted deleted deleteAction fs delete dir dir result complete deleted ie result completeExceptionally ie e
consumerLoop largeFileQueue large setDaemon large setName n i System currentTimeMillis large start LOG debug large threads add large i i i small consumerLoop smallFileQueue small setDaemon small setName n i System currentTimeMillis small start
conf updated throttlePoint conf getInt HFILE_DELETE_THROTTLE_THRESHOLD DEFAULT_HFILE_DELETE_THROTTLE_THRESHOLD throttlePoint throttlePoint
LOG debug throttlePoint throttlePoint throttlePoint throttlePoint updated largeQueueInitSize conf getInt LARGE_HFILE_QUEUE_INIT_SIZE DEFAULT_LARGE_HFILE_QUEUE_INIT_SIZE largeQueueInitSize largeQueueInitSize LOG debug largeQueueInitSize largeQueueInitSize largeQueueInitSize largeQueueInitSize updated smallQueueInitSize conf getInt SMALL_HFILE_QUEUE_INIT_SIZE DEFAULT_SMALL_HFILE_QUEUE_INIT_SIZE smallQueueInitSize smallQueueInitSize LOG debug smallQueueInitSize smallQueueInitSize smallQueueInitSize smallQueueInitSize updated largeFileDeleteThreadNumber conf getInt LARGE_HFILE_DELETE_THREAD_NUMBER DEFAULT_LARGE_HFILE_DELETE_THREAD_NUMBER largeFileDeleteThreadNumber largeFileDeleteThreadNumber
largeQueueInitSize largeQueueInitSize LOG debug largeQueueInitSize largeQueueInitSize largeQueueInitSize largeQueueInitSize updated smallQueueInitSize conf getInt SMALL_HFILE_QUEUE_INIT_SIZE DEFAULT_SMALL_HFILE_QUEUE_INIT_SIZE smallQueueInitSize smallQueueInitSize LOG debug smallQueueInitSize smallQueueInitSize smallQueueInitSize smallQueueInitSize updated largeFileDeleteThreadNumber conf getInt LARGE_HFILE_DELETE_THREAD_NUMBER DEFAULT_LARGE_HFILE_DELETE_THREAD_NUMBER largeFileDeleteThreadNumber largeFileDeleteThreadNumber LOG debug largeFileDeleteThreadNumber largeFileDeleteThreadNumber largeFileDeleteThreadNumber largeFileDeleteThreadNumber updated smallFileDeleteThreadNumber conf getInt SMALL_HFILE_DELETE_THREAD_NUMBER DEFAULT_SMALL_HFILE_DELETE_THREAD_NUMBER
HFileLink isHFileLink filePath Path parentDir filePath getParent HFileLink parentDir Path hfilePath hfilePath HFileLink getHFileFromBackReference Path CommonFSUtils getRootDir getConf HConstants HBASE_TEMP_DIRECTORY filePath fs exists hfilePath hfilePath HFileLink getHFileFromBackReference MobUtils getMobHome getConf filePath fs exists hfilePath hfilePath HFileLink getHFileFromBackReference CommonFSUtils getRootDir getConf filePath fs exists hfilePath
hfilePath HFileLink getHFileFromBackReference MobUtils getMobHome getConf filePath fs exists hfilePath hfilePath HFileLink getHFileFromBackReference CommonFSUtils getRootDir getConf filePath fs exists hfilePath LOG LOG debug hfilePath Path backRefDir backRefDir HFileLink getBackReferencesDir parentDir filePath getName CommonFSUtils listStatus fs backRefDir LOG
conf newSize conf getInt OLD_WALS_CLEANER_THREAD_SIZE DEFAULT_OLD_WALS_CLEANER_THREAD_SIZE newSize
CleanerContext context pendingDelete take Preconditions checkNotNull context FileStatus oldWalFile context getTargetToClean
index index index index index barriers length barriers barriers length metaTable regionName addFamily HConstants ReplicationQueueStorage queueStorage peerManager getQueueStorage peerId queueStorage removeLastSequenceIds peerId Arrays asList encodedRegionName deletedLastPushedSeqIds metaTable delete Delete regionName addFamily HConstants REPLICATION_BARRIER_FAMILY deletedRows deletedBarriers barriers length index
Collections emptyList proceedWithSplitPlanning proceedWithSplitPlanning proceedWithMergePlanning proceedWithMergePlanning proceedWithMergePlanning proceedWithSplitPlanning LOG debug table Collections emptyList NormalizeContext ctx NormalizeContext table ctx getTableRegions Collections emptyList LOG debug table ctx getTableRegions size List NormalizationPlan plans ArrayList proceedWithSplitPlanning plans addAll computeSplitNormalizationPlans ctx proceedWithMergePlanning plans addAll computeMergeNormalizationPlans ctx
hri ServerName sn masterServices getAssignmentManager getRegionStates getRegionServerOfRegion hri RegionMetrics regionLoad masterServices getServerManager getLoad sn getRegionMetrics get hri getRegionName regionLoad
TableDescriptor tableDescriptor masterServices getTableDescriptors get table tableDescriptor LOG targetRegionCount tableDescriptor getNormalizerTargetRegionCount targetRegionSize tableDescriptor getNormalizerTargetRegionSize LOG debug table targetRegionCount targetRegionSize e LOG warn table e avgRegionSize targetRegionSize avgRegionSize targetRegionSize targetRegionCount avgRegionSize totalSizeMb targetRegionCount avgRegionSize totalSizeMb regionCount
ctx avgRegionSize ctx getAverageRegionSizeMb
env Path tableRootDir tableName MasterFileSystem mfs env getMasterServices getMasterFileSystem FileSystem fs mfs getFileSystem Path rootDir mfs getRootDir Configuration conf env getMasterConfiguration ForeignExceptionDispatcher monitorException ForeignExceptionDispatcher getMonitorStatus setStatus tableName Path snapshotDir SnapshotDescriptionUtils getCompletedSnapshotDir snapshot rootDir SnapshotManifest manifest SnapshotManifest open conf fs snapshotDir snapshot RestoreSnapshotHelper restoreHelper RestoreSnapshotHelper conf fs manifest tableDescriptor tableRootDir monitorException monitorStatus RestoreSnapshotHelper RestoreMetaChanges metaChanges restoreHelper restoreHdfsRegions Preconditions checkArgument metaChanges hasRegionsToRestore Preconditions checkArgument metaChanges hasRegionsToRemove String msg snapshot getName tableName
ForeignExceptionDispatcher monitorException ForeignExceptionDispatcher getMonitorStatus setStatus tableName Path snapshotDir SnapshotDescriptionUtils getCompletedSnapshotDir snapshot rootDir SnapshotManifest manifest SnapshotManifest open conf fs snapshotDir snapshot RestoreSnapshotHelper restoreHelper RestoreSnapshotHelper conf fs manifest tableDescriptor tableRootDir monitorException monitorStatus RestoreSnapshotHelper RestoreMetaChanges metaChanges restoreHelper restoreHdfsRegions Preconditions checkArgument metaChanges hasRegionsToRestore Preconditions checkArgument metaChanges hasRegionsToRemove String msg snapshot getName tableName LOG info msg monitorStatus setStatus msg metaChanges getRegionsToAdd e String msg ClientSnapshotDescriptionUtils toString snapshot e getMessage
env tableName LOG debug tableName env getMasterServices getAssignmentManager deleteTable tableName
env tableName env getMasterServices getTableStateManager setTableState tableName TableState State DISABLING
env tableName env getMasterServices getTableStateManager setTableState tableName TableState State DISABLED
env tableName env getMasterServices getTableStateManager setTableState tableName TableState State ENABLED
env MasterFileSystem mfs env getMasterServices getMasterFileSystem
master LOG debug ServerManager sm master getServerManager sm LOG debug sm registerListener ProcedureExecutor MasterProcedureEnv pe master getMasterProcedureExecutor pe LOG debug procedureEnv pe getEnvironment procedureEnv
proc TransitRegionStateProcedure reopen env regionNode getRegionInfo regionNode setProcedure proc regionNode unlock addChildProcedure proc setNextState ReopenTableRegionsState REOPEN_TABLE_REGIONS_CONFIRM_REOPENED Flow HAS_MORE_STATE REOPEN_TABLE_REGIONS_CONFIRM_REOPENED env Flow NO_MORE_STATE env retryCounter setNextState ReopenTableRegionsState REOPEN_TABLE_REGIONS_REOPEN_REGIONS Flow HAS_MORE_STATE retryCounter
FileSystem fs fileSystemManager getFileSystem Path rootDir fileSystemManager getRootDir ForeignExceptionDispatcher monitorException ForeignExceptionDispatcher LOG info ClientSnapshotDescriptionUtils toString snapshot Path snapshotDir SnapshotDescriptionUtils getCompletedSnapshotDir snapshot rootDir SnapshotManifest manifest SnapshotManifest open env getMasterServices getConfiguration fs snapshotDir snapshot RestoreSnapshotHelper restoreHelper RestoreSnapshotHelper env getMasterServices getConfiguration fs manifest modifiedTableDescriptor rootDir monitorException getMonitorStatus RestoreSnapshotHelper RestoreMetaChanges metaChanges restoreHelper restoreHdfsRegions regionsToRestore metaChanges getRegionsToRestore regionsToRemove metaChanges getRegionsToRemove regionsToAdd metaChanges getRegionsToAdd parentsToChildrenPairMap metaChanges getParentToChildrenPairMap String msg ClientSnapshotDescriptionUtils toString snapshot
MetaTableAccessor deleteRegionInfos conn regionsToRemove deleteRegionsFromInMemoryStates regionsToRemove env regionReplication regionsToAdd MetaTableAccessor addRegionsToMeta conn regionsToAdd regionReplication addRegionsToInMemoryStates regionsToAdd env regionReplication regionsToRestore MetaTableAccessor overwriteRegions conn regionsToRestore regionReplication deleteRegionsFromInMemoryStates regionsToRestore env regionReplication addRegionsToInMemoryStates regionsToRestore env regionReplication RestoreSnapshotHelper RestoreMetaChanges metaChanges RestoreSnapshotHelper RestoreMetaChanges modifiedTableDescriptor parentsToChildrenPairMap metaChanges updateMetaParentRegions conn regionsToAdd LOG info ClientSnapshotDescriptionUtils toString snapshot getTableName ForeignExceptionDispatcher monitorException ForeignExceptionDispatcher String msg ClientSnapshotDescriptionUtils toString snapshot
SERVER_CRASH_SPLIT_META_LOGS env zkCoordinatedSplitMetaLogs env setNextState ServerCrashState SERVER_CRASH_ASSIGN_META am getRegionStates metaLogSplitting serverName addChildProcedure createSplittingWalProcedures env setNextState ServerCrashState SERVER_CRASH_DELETE_SPLIT_META_WALS_DIR SERVER_CRASH_DELETE_SPLIT_META_WALS_DIR env setNextState ServerCrashState SERVER_CRASH_ASSIGN_META am getRegionStates metaLogSplit serverName setNextState ServerCrashState SERVER_CRASH_SPLIT_META_LOGS
env splitMeta SplitWALManager splitWALManager env getMasterServices getSplitWALManager wals splitWALManager getWALsToSplit serverName splitMeta size
env LOG debug MasterWalManager mwm env getMasterServices getMasterWalManager AssignmentManager am env getMasterServices getAssignmentManager am getRegionStates metaLogSplitting serverName mwm splitMetaLog serverName am getRegionStates metaLogSplit serverName
region RegionStateNode regionNode am getRegionStates getOrCreateRegionStateNode region regionNode lock regionNode am DoNotRetryIOException LOG info regionNode serverName regionNode getProcedure LOG info regionNode getProcedure regionNode regionNode getProcedure serverCrashed env regionNode getServerName env regionNode env getAssignmentManager regionClosedAbnormally regionNode
String serverName Path walRootDir String logName AbstractFSWALProvider getWALDirectoryName serverName Path walDir Path walRootDir logName
IOException replayEditsDir Path walsDir Path walRootDir HREGION_LOGDIR_NAME walDir walsDir walDir walDir getPath getName LOG warn Path deadWALDir walDir getPath getName DEAD_WAL_DIR_SUFFIX deadWALDir Path walDir getPath getParent walDir getPath getName DEAD_WAL_DIR_SUFFIX walDir getPath deadWALDir IOException walDir deadWALDir LOG info walDir getPath deadWALDir deadWALDir walDir getPath
walDir getPath getName LOG warn Path deadWALDir walDir getPath getName DEAD_WAL_DIR_SUFFIX deadWALDir Path walDir getPath getParent walDir getPath getName DEAD_WAL_DIR_SUFFIX walFs walDir getPath deadWALDir IOException walDir deadWALDir LOG info walDir getPath deadWALDir deadWALDir walDir getPath LOG info deadWALDir walFile walFs deadWALDir Path replayEditsFile Path replayEditsDir walFile getPath getName RecoverLeaseFSUtils recoverFileLease walFs walFile getPath conf walFs walFile getPath replayEditsFile
LOG warn Path deadWALDir walDir getPath getName DEAD_WAL_DIR_SUFFIX deadWALDir Path walDir getPath getParent walDir getPath getName DEAD_WAL_DIR_SUFFIX walFs walDir getPath deadWALDir IOException walDir deadWALDir LOG info walDir getPath deadWALDir deadWALDir walDir getPath LOG info deadWALDir walFile walFs deadWALDir Path replayEditsFile Path replayEditsDir walFile getPath getName RecoverLeaseFSUtils recoverFileLease walFs walFile getPath conf walFs walFile getPath replayEditsFile IOException walFile getPath replayEditsFile
params TableDescriptor td params tableDescriptor
conf flushSize flushPerChanges flushIntervalMs conf setLong HConstants HREGION_MEMSTORE_FLUSH_SIZE flushSize conf setLong HRegion MEMSTORE_FLUSH_PER_CHANGES flushPerChanges conf setLong HRegion MEMSTORE_PERIODIC_FLUSH_INTERVAL flushIntervalMs
flushCond await waitTimeMs TimeUnit MILLISECONDS Thread currentThread interrupt flushLock unlock assert flushRequest changesAfterLastFlush set region flush lastFlushTime EnvironmentEdgeManager currentTime
env TableStateManager tsm env getMasterServices getTableStateManager ReplicationQueueStorage queueStorage env getReplicationPeerManager getQueueStorage Connection conn env getMasterServices getConnection tsm
String msg ClientSnapshotDescriptionUtils toString snapshot LOG info msg status setStatus msg ThreadPoolExecutor exec SnapshotManifest createExecutor conf exec regionInfo snapshotManifest addRegion CommonFSUtils getTableDir rootDir snapshotTable regionInfo exec shutdown e String reason ClientSnapshotDescriptionUtils toString snapshot e getMessage ForeignException ee ForeignException reason e monitor receive ee
region region getFirst region getSecond RegionInfo hri region getFirst hri isOffline hri isSplit hri isSplitParent regionServers add region getSecond toString Procedure proc coordinator startProcedure monitor snapshot getName snapshot toByteArray Lists newArrayList regionServers proc String msg snapshot getName LOG error msg HBaseSnapshotException msg proc waitForCompleted LOG info snapshot getName RegionInfo region RegionInfo regionInfo region getFirst regionInfo isOffline regionInfo isSplit regionInfo isSplitParent regionInfo
Procedure proc coordinator startProcedure monitor snapshot getName snapshot toByteArray Lists newArrayList regionServers proc String msg snapshot getName LOG error msg HBaseSnapshotException msg proc waitForCompleted LOG info snapshot getName RegionInfo region RegionInfo regionInfo region getFirst regionInfo regionInfo regionInfo regionInfo LOG info regionInfo snapshotDisabledRegion regionInfo mobEnabled MobUtils hasMobColumns htd mobEnabled
regions MetaTableAccessor getTableRegions services getConnection tableName RegionReplicaUtil removeNonDefaultRegions regions Map String SnapshotRegionManifest regionManifests manifest getRegionManifestsMap regionManifests String msg ClientSnapshotDescriptionUtils toString snapshot LOG error msg CorruptedSnapshotException msg String errorMsg hasMobStore regionManifests tableName hasMobStore realRegionCount hasMobStore regionManifests size regionManifests size realRegionCount regions size errorMsg ClientSnapshotDescriptionUtils toString snapshot regions size realRegionCount
cleanupSentinels handler expected UnknownSnapshotException ssString handler rethrowExceptionIfFailed e String status Procedure p coordinator getProcedure expected getName p status p getStatus status expected getName coordinator getProcedureNames HBaseSnapshotException ssString status e ProtobufUtil createSnapshotDesc expected
UnknownSnapshotException ssString handler rethrowExceptionIfFailed e String status Procedure p coordinator getProcedure expected getName p status p getStatus status expected getName coordinator getProcedureNames HBaseSnapshotException ssString status e ProtobufUtil createSnapshotDesc expected handler LOG debug ssString
desc SnapshotCreationException snapshot getTable ProtobufUtil createSnapshotDesc snapshot SnapshotDescription Builder builder snapshot toBuilder snapshot builder setVersion SnapshotDescriptionUtils SNAPSHOT_LAYOUT_VERSION user master builder setOwner user getShortName snapshot builder build MasterCoprocessorHost cpHost master getMasterCoprocessorHost org apache hadoop hbase client SnapshotDescription snapshotPOJO cpHost snapshotPOJO ProtobufUtil createSnapshotDesc snapshot cpHost preSnapshot snapshotPOJO desc
SnapshotDescription Builder builder snapshot toBuilder snapshot builder setVersion SnapshotDescriptionUtils SNAPSHOT_LAYOUT_VERSION user master builder setOwner user getShortName snapshot builder build MasterCoprocessorHost cpHost master getMasterCoprocessorHost org apache hadoop hbase client SnapshotDescription snapshotPOJO cpHost snapshotPOJO ProtobufUtil createSnapshotDesc snapshot cpHost preSnapshot snapshotPOJO desc TableName snapshotTable TableName valueOf snapshot getTable master snapshotTable
builder setVersion SnapshotDescriptionUtils SNAPSHOT_LAYOUT_VERSION user master builder setOwner user getShortName snapshot builder build MasterCoprocessorHost cpHost master getMasterCoprocessorHost org apache hadoop hbase client SnapshotDescription snapshotPOJO cpHost snapshotPOJO ProtobufUtil createSnapshotDesc snapshot cpHost preSnapshot snapshotPOJO desc TableName snapshotTable TableName valueOf snapshot getTable master snapshotTable LOG LOG debug ClientSnapshotDescriptionUtils toString snapshot
master builder setOwner user getShortName snapshot builder build MasterCoprocessorHost cpHost master getMasterCoprocessorHost org apache hadoop hbase client SnapshotDescription snapshotPOJO cpHost snapshotPOJO ProtobufUtil createSnapshotDesc snapshot cpHost preSnapshot snapshotPOJO desc TableName snapshotTable TableName valueOf snapshot getTable master snapshotTable LOG LOG debug ClientSnapshotDescriptionUtils toString snapshot snapshotEnabledTable snapshot LOG
snapshot builder build MasterCoprocessorHost cpHost master getMasterCoprocessorHost org apache hadoop hbase client SnapshotDescription snapshotPOJO cpHost snapshotPOJO ProtobufUtil createSnapshotDesc snapshot cpHost preSnapshot snapshotPOJO desc TableName snapshotTable TableName valueOf snapshot getTable master snapshotTable LOG LOG debug ClientSnapshotDescriptionUtils toString snapshot snapshotEnabledTable snapshot LOG LOG debug ClientSnapshotDescriptionUtils toString snapshot master snapshotTable
reqSnapshot FileSystem fs master getMasterFileSystem getFileSystem Path snapshotDir SnapshotDescriptionUtils getCompletedSnapshotDir reqSnapshot rootDir fs snapshotDir
conf mfs String enabled conf get HBASE_SNAPSHOT_ENABLED snapshotEnabled conf getBoolean HBASE_SNAPSHOT_ENABLED userDisabled enabled enabled trim length snapshotEnabled Set String hfileCleaners HashSet String cleaners conf getStrings HFileCleaner MASTER_HFILE_CLEANER_PLUGINS cleaners Collections addAll hfileCleaners cleaners Set String logCleaners HashSet cleaners conf getStrings HConstants HBASE_MASTER_LOGCLEANER_PLUGINS cleaners Collections addAll logCleaners cleaners Path oldSnapshotDir Path mfs getRootDir HConstants OLD_SNAPSHOT_DIR_NAME FileSystem fs mfs getFileSystem List SnapshotDescription ss getCompletedSnapshots Path rootDir oldSnapshotDir ss ss
conf mfs String enabled conf get HBASE_SNAPSHOT_ENABLED snapshotEnabled conf getBoolean HBASE_SNAPSHOT_ENABLED userDisabled enabled enabled trim length snapshotEnabled Set String hfileCleaners HashSet String cleaners conf getStrings HFileCleaner MASTER_HFILE_CLEANER_PLUGINS cleaners Collections addAll hfileCleaners cleaners Set String logCleaners HashSet cleaners conf getStrings HConstants HBASE_MASTER_LOGCLEANER_PLUGINS cleaners Collections addAll logCleaners cleaners Path oldSnapshotDir Path mfs getRootDir HConstants OLD_SNAPSHOT_DIR_NAME FileSystem fs mfs getFileSystem List SnapshotDescription ss getCompletedSnapshots Path rootDir oldSnapshotDir ss ss LOG error oldSnapshotDir
String msg snapshot getType snapshot getName eventType snapshotTable
status setStatus snapshot getName snapshotManifest consolidate status setStatus snapshot getName verifier verifySnapshot workingDir serverNames SnapshotDescriptionUtils completeSnapshot snapshotDir workingDir rootFs workingDirFs conf finished msg snapshot getName snapshotTable status markComplete msg LOG info msg metricsSnapshot addSnapshot status getCompletionTimestamp status getStartTime master getMasterCoprocessorHost master getMasterCoprocessorHost postCompletedSnapshotAction ProtobufUtil createSnapshotDesc snapshot htd e status abort snapshot getName snapshotTable e getMessage String reason ClientSnapshotDescriptionUtils toString snapshot e getMessage
verifier verifySnapshot workingDir serverNames SnapshotDescriptionUtils completeSnapshot snapshotDir workingDir rootFs workingDirFs conf finished msg snapshot getName snapshotTable status markComplete msg LOG info msg metricsSnapshot addSnapshot status getCompletionTimestamp status getStartTime master getMasterCoprocessorHost master getMasterCoprocessorHost postCompletedSnapshotAction ProtobufUtil createSnapshotDesc snapshot htd e status abort snapshot getName snapshotTable e getMessage String reason ClientSnapshotDescriptionUtils toString snapshot e getMessage LOG error reason e ForeignException ee ForeignException reason e monitor receive ee
status markComplete msg LOG info msg metricsSnapshot addSnapshot status getCompletionTimestamp status getStartTime master getMasterCoprocessorHost master getMasterCoprocessorHost postCompletedSnapshotAction ProtobufUtil createSnapshotDesc snapshot htd e status abort snapshot getName snapshotTable e getMessage String reason ClientSnapshotDescriptionUtils toString snapshot e getMessage LOG error reason e ForeignException ee ForeignException reason e monitor receive ee cancel reason LOG debug workingDir
finished finished
LOG debug getClass getSimpleName watcher registerListener ZKUtil createWithParents clientZkWatcher watcher getZNodePaths baseZNode Collection String nodes getNodesToWatch
LOG debug node clientZkWatcher ZKUtil setData clientZkWatcher node data ZKUtil createNodeIfNotExistsNoWatch clientZkWatcher node data CreateMode PERSISTENT reconnectAfterExpiration e LOG warn node e getMessage reconnectAfterExpiration e
String tableName store getTableName toString String regionName store getRegionInfo getRegionNameAsString String familyName store getColumnFamilyName
TableName String file value file getMetadataValue HStoreFile MOB_FILE_REFS ImmutableSetMultimap Builder TableName String builder value builder ImmutableSetMultimap builder builder MobUtils deserializeMobFileRefs value RuntimeException exception RuntimeException file exception builder ImmutableSetMultimap builder disableIO set Boolean FALSE
map clear TableName String reference TableName table reference getKey String mobfile reference getValue mobfile disableIO set Boolean TRUE List Path locations mobStore getLocations table Path p locations FileStatus st fs getFileStatus Path p mobfile size st getLen LOG debug mobfile size map put mobfile size
fileName Bytes toBytes mobFileWriter getPath getName hasMore scanner next cells scannerContext currentTime EnvironmentEdgeManager currentTime now currentTime currentTime progress cancel c cells MobUtils c String fName MobUtils getMobFileName c mobCell mobStore resolve c getCell
now currentTime currentTime progress cancel c MobUtils c String fName MobUtils getMobFileName c mobCell mobStore resolve c getCell LOG error fName c
mobCells mobFileWriter append c Cell reference MobUtils createMobRefCell c fileName mobStore getRefCellTags writer append reference cellsCountCompactedToMob cellsSizeCompactedToMob c getValueLength len mobFileWriter getPos len commitOrAbortMobWriter mobFileWriter fd maxSeqId mobCells major mobFileWriter newMobWriter fd fileName Bytes toBytes mobFileWriter getPath getName mobCells len c getSerializedSize
ioe e e throughputController finish flushName ioe mobFileWriter close mobCount status setStatus store mobFileWriter appendMetadata cacheFlushId mobCount status setStatus store mobFileWriter close mobStore commitFile mobFileWriter getPath targetPath LOG debug writer getPath getStoreInfo mobStore updateMobFlushCount
tableName Configuration conf getConf TableName tn TableName valueOf tableName FileSystem fs FileSystem get conf
TableName tableName CommonFSUtils getTableName table String mobRegion MOB_REGIONS get tableName mobRegion String tmp MobUtils getMobRegionInfo tableName getEncodedName tmp LOG error tableName mobRegion MOB_REGIONS putIfAbsent tableName tmp mobRegion mobRegion tmp LOG debug tableName mobRegion ret mobRegion equals region getName LOG ret LOG debug fStat getPath ret
access count get lastAccess missed miss sum lastMiss evicted evictedFileCount sum lastEvictedFileCount hitRatio access access missed access
TableDescriptors htds master getTableDescriptors Map String TableDescriptor map map htds getAll e LOG error e TableDescriptor htd map hcd htd hcd hcd cleaner cleanExpiredMobFiles htd getTableName getNameAsString hcd e LOG error htd getTableName getNameAsString hcd getNameAsString e
map htds getAll e LOG error e htd map hcd htd hcd hcd cleaner cleanExpiredMobFiles htd getTableName getNameAsString hcd e LOG error htd getTableName getNameAsString hcd getNameAsString e LOG info htd getTableName cleanupObsoleteMobFiles master getConfiguration htd getTableName
e LOG error e htd hcd htd hcd hcd cleaner cleanExpiredMobFiles htd getTableName getNameAsString hcd e LOG error htd getTableName getNameAsString hcd getNameAsString e LOG info htd getTableName cleanupObsoleteMobFiles master getConfiguration htd getTableName LOG info htd getTableName e
conf table minAgeToArchive conf getLong MobConstants MIN_AGE_TO_ARCHIVE_KEY MobConstants DEFAULT_MIN_AGE_TO_ARCHIVE maxCreationTimeToArchive EnvironmentEdgeManager currentTime minAgeToArchive conf admin TableDescriptor htd admin getDescriptor table List ColumnFamilyDescriptor list MobUtils getMobColumnFamilies htd list
Path regionPath hcd String family hcd getNameAsString Path storePath Path regionPath family succeed Set String regionMobs HashSet String succeed fs storePath String errMsg String format storePath IOException errMsg RemoteIterator LocatedFileStatus rit fs listLocatedStatus storePath List Path storeFiles ArrayList Path rit Path p rit next getPath fs p
fs p storeFiles add p LOG info storeFiles size storePath Path currentPath Path pp storeFiles currentPath pp LOG trace pp HStoreFile sf HStoreFile fs pp conf CacheConfig DISABLED BloomType NONE sf initReader mobRefData sf getMetadataValue HStoreFile MOB_FILE_REFS bulkloadMarkerData sf getMetadataValue HStoreFile BULKLOAD_TASK_KEY sf closeStoreFile mobRefData bulkloadMarkerData
LOG info storeFiles size storePath Path currentPath Path pp storeFiles currentPath pp LOG trace pp HStoreFile sf HStoreFile fs pp conf CacheConfig DISABLED BloomType NONE sf initReader mobRefData sf getMetadataValue HStoreFile MOB_FILE_REFS bulkloadMarkerData sf getMetadataValue HStoreFile BULKLOAD_TASK_KEY sf closeStoreFile mobRefData bulkloadMarkerData LOG warn pp
LOG warn currentPath e regionMobs clear succeed allActiveMobFileName addAll regionMobs allActiveMobFileName size LOG warn allActiveMobFileName size table LOG debug allActiveMobFileName size table allActiveMobFileName stream forEach LOG trace hcd List Path toArchive ArrayList Path String family hcd getNameAsString Path dir MobUtils getMobFamilyPath conf table family RemoteIterator LocatedFileStatus rit fs listLocatedStatus dir rit
regionMobs clear succeed allActiveMobFileName addAll regionMobs allActiveMobFileName size LOG warn allActiveMobFileName size table LOG debug allActiveMobFileName size table allActiveMobFileName stream forEach LOG trace hcd List Path toArchive ArrayList Path String family hcd getNameAsString Path dir MobUtils getMobFamilyPath conf table family RemoteIterator LocatedFileStatus rit fs listLocatedStatus dir rit LocatedFileStatus lfs rit next
reported master TableDescriptors htds master getTableDescriptors Map String TableDescriptor map htds getAll TableDescriptor map master
Map String TableDescriptor map htds getAll TableDescriptor htd map master htd getTableName LOG info htd getTableName LOG info htd getTableName htd getColumnFamilyCount hcd htd hcd reported master reportMobCompactionStart htd getTableName reported LOG info htd getTableName hcd getNameAsString
LOG info htd getTableName LOG info htd getTableName htd getColumnFamilyCount hcd htd hcd reported master reportMobCompactionStart htd getTableName reported LOG info htd getTableName hcd getNameAsString LOG debug htd getTableName hcd getNameAsString admin majorCompact htd getTableName hcd getName
LOG info htd getTableName htd getColumnFamilyCount hcd htd hcd reported master reportMobCompactionStart htd getTableName reported LOG info htd getTableName hcd getNameAsString regionBatchSize LOG debug htd getTableName hcd getNameAsString admin majorCompact htd getTableName hcd getName LOG info htd getTableName hcd getNameAsString regionBatchSize performMajorCompactionInBatches admin htd hcd
hcd htd hcd reported master reportMobCompactionStart htd getTableName reported LOG info htd getTableName hcd getNameAsString regionBatchSize LOG debug htd getTableName hcd getNameAsString admin majorCompact htd getTableName hcd getName LOG info htd getTableName hcd getNameAsString regionBatchSize performMajorCompactionInBatches admin htd hcd LOG debug htd getTableName hcd getNameAsString
LOG debug htd getTableName hcd getNameAsString admin majorCompact htd getTableName hcd getName LOG info htd getTableName hcd getNameAsString regionBatchSize performMajorCompactionInBatches admin htd hcd LOG debug htd getTableName hcd getNameAsString e LOG error htd getTableName hcd getNameAsString e ee Thread currentThread interrupt master reportMobCompactionEnd htd getTableName LOG warn htd getTableName hcd getNameAsString ee
admin htd List RegionInfo regions admin getRegions htd getTableName regions
Collections shuffle regions List RegionInfo toCompact ArrayList RegionInfo regionBatchSize regionBatchSize toCompact add regions remove RegionInfo ri toCompact startCompaction admin htd getTableName ri hcd getName List RegionInfo compacted ArrayList RegionInfo toCompact size List RegionInfo failed ArrayList RegionInfo totalCompacted toCompact RegionInfo ri toCompact admin ri totalCompacted
List RegionInfo toCompact ArrayList RegionInfo regionBatchSize regionBatchSize toCompact add regions remove RegionInfo ri toCompact startCompaction admin htd getTableName ri hcd getName List RegionInfo compacted ArrayList RegionInfo toCompact size List RegionInfo failed ArrayList RegionInfo totalCompacted toCompact RegionInfo ri toCompact admin ri totalCompacted LOG info htd getTableName hcd getNameAsString ri getRegionNameAsString totalCompacted compacted add ri
toCompact add regions remove RegionInfo ri toCompact startCompaction admin htd getTableName ri hcd getName List RegionInfo compacted ArrayList RegionInfo toCompact size List RegionInfo failed ArrayList RegionInfo totalCompacted toCompact RegionInfo ri toCompact admin ri totalCompacted LOG info htd getTableName hcd getNameAsString ri getRegionNameAsString totalCompacted compacted add ri
ri totalCompacted LOG info htd getTableName hcd getNameAsString ri getRegionNameAsString totalCompacted compacted add ri e LOG error htd getTableName hcd getNameAsString ri getEncodedName LOG error e failed add ri toCompact removeAll failed failed clear RegionInfo ri compacted toCompact remove ri regions RegionInfo region regions remove
LOG info htd getTableName hcd getNameAsString ri getRegionNameAsString totalCompacted compacted add ri e LOG error htd getTableName hcd getNameAsString ri getEncodedName LOG error e failed add ri toCompact removeAll failed failed clear RegionInfo ri compacted toCompact remove ri regions RegionInfo region regions remove toCompact add region startCompaction admin htd getTableName region hcd getName compacted clear
stats fs listStatus path e LOG warn path e stats List HStoreFile filesToClean ArrayList deletedFileCount file stats String fileName file getPath getName HFileLink file getPath HFileLink hfileLink HFileLink buildFromHFileLinkPattern conf file getPath fileName hfileLink getOriginPath getName Date fileDate parseDate MobFileName getDateFromName fileName
e LOG warn path e List HStoreFile filesToClean ArrayList deletedFileCount file String fileName file getPath getName HFileLink file getPath HFileLink hfileLink HFileLink buildFromHFileLinkPattern conf file getPath fileName hfileLink getOriginPath getName Date fileDate parseDate MobFileName getDateFromName fileName LOG LOG debug fileName
List HStoreFile filesToClean ArrayList deletedFileCount file String fileName file getPath getName HFileLink file getPath HFileLink hfileLink HFileLink buildFromHFileLinkPattern conf file getPath fileName hfileLink getOriginPath getName Date fileDate parseDate MobFileName getDateFromName fileName LOG LOG debug fileName fileDate LOG
String fileName file getPath getName HFileLink file getPath HFileLink hfileLink HFileLink buildFromHFileLinkPattern conf file getPath fileName hfileLink getOriginPath getName Date fileDate parseDate MobFileName getDateFromName fileName LOG LOG debug fileName fileDate LOG LOG debug fileName filesToClean add HStoreFile fs file getPath conf cacheConfig BloomType NONE e LOG error fileName e filesToClean
ImmutableSetMultimap Builder TableName String bytes IllegalStateException ImmutableSetMultimap Builder TableName String map ImmutableSetMultimap builder bytes String s Bytes toString bytes String tables s split String tableEnc tables delim tableEnc indexOf delim IllegalStateException TableName table TableName valueOf tableEnc substring delim String refs tableEnc substring delim split map putAll table refs bytes
TooSlowLog SlowLogPayload Type rpcCallDetails isSlowLog rpcCallDetails isSlowLog isLargeLog rpcCallDetails isLargeLog TooSlowLog SlowLogPayload Type type isSlowLog isLargeLog
LOG info procName timeoutInjector start monitor rethrowException
LOG info procName timeoutInjector start monitor rethrowException LOG debug procName sendGlobalBarrierStart LOG debug waitForLatch acquiredBarrierLatch monitor wakeFrequency monitor rethrowException
LOG info procName timeoutInjector start monitor rethrowException LOG debug procName sendGlobalBarrierStart LOG debug waitForLatch acquiredBarrierLatch monitor wakeFrequency monitor rethrowException LOG debug procName sendGlobalBarrierReached LOG debug waitForLatch releasedBarrierLatch monitor wakeFrequency monitor rethrowException
LOG debug procName sendGlobalBarrierStart LOG debug waitForLatch acquiredBarrierLatch monitor wakeFrequency monitor rethrowException LOG debug procName sendGlobalBarrierReached LOG debug waitForLatch releasedBarrierLatch monitor wakeFrequency monitor rethrowException LOG info procName Thread currentThread interrupt String msg procName
proc String procName proc getName Procedure oldProc procedures get procName oldProc oldProc LOG warn procName LOG debug procName procedures procName oldProc LOG warn procName
LOG warn procName LOG debug procName procName LOG warn procName LOG debug procName procName LOG warn procName
LOG debug procName procName LOG warn procName LOG debug procName procName LOG warn procName procName proc LOG debug procName pool submit proc
Collection Procedure toNotify procedures values isTraceEnabled LOG isTraceEnabled
Procedure fed procName procArgs expectedMembers Procedure proc createProcedure fed procName procArgs expectedMembers proc
conf String confKey Class implClass String defaultProcClasses conf getStrings confKey defaultProcClasses defaultProcClasses length List E configured ArrayList String className defaultProcClasses className className trim ClassLoader cl getClass getClassLoader Thread currentThread setContextClassLoader cl implClass cl loadClass className configured add loadInstance implClass
Subprocedure subproc subproc LOG warn String procName subproc getName procName procName LOG error Subprocedure rsub subprocs get procName rsub rsub LOG error procName LOG warn procName subprocs procName rsub
Subprocedure rsub subprocs get procName rsub rsub LOG error procName LOG warn procName subprocs procName rsub LOG error procName LOG debug procName subprocs procName subproc pool submit subproc
LOG warn procName subprocs remove procName LOG error procName LOG debug procName subprocs procName subproc pool submit subproc LOG error procName subprocs remove procName subproc String msg
procName ee LOG debug procName ee Subprocedure sub subprocs get procName sub
initialize rss proc LOG debug proc getProcedureSignature proc initialize rss
start proc LOG debug proc getProcedureSignature proc start
LOG debug barrierName executionTimeoutTimer getMaxTime executionTimeoutTimer start rethrowException
LOG debug barrierName executionTimeoutTimer getMaxTime executionTimeoutTimer start rethrowException LOG debug barrierName acquireBarrier
LOG debug barrierName executionTimeoutTimer getMaxTime executionTimeoutTimer start rethrowException LOG debug barrierName acquireBarrier LOG debug barrierName rethrowException rpcs sendMemberAcquired
LOG debug barrierName executionTimeoutTimer getMaxTime executionTimeoutTimer start rethrowException LOG debug barrierName acquireBarrier LOG debug barrierName rethrowException rpcs sendMemberAcquired LOG debug barrierName waitForReachedGlobalBarrier rethrowException
LOG debug barrierName executionTimeoutTimer getMaxTime executionTimeoutTimer start rethrowException LOG debug barrierName acquireBarrier LOG debug barrierName rethrowException rpcs sendMemberAcquired LOG debug barrierName waitForReachedGlobalBarrier rethrowException LOG debug barrierName dataToCoordinator insideBarrier
rethrowException LOG debug barrierName acquireBarrier LOG debug barrierName rethrowException rpcs sendMemberAcquired LOG debug barrierName waitForReachedGlobalBarrier rethrowException LOG debug barrierName dataToCoordinator insideBarrier LOG debug barrierName rethrowException rpcs sendMemberCompleted dataToCoordinator
LOG debug barrierName rethrowException rpcs sendMemberCompleted dataToCoordinator LOG debug barrierName rethrowException e String msg e msg barrierName Thread currentThread interrupt e msg barrierName msg barrierName cancel msg e
e String msg e msg barrierName Thread currentThread interrupt e msg barrierName msg barrierName cancel msg e LOG debug barrierName cleanup e releasedLocalBarrier countDown executionTimeoutTimer complete
String abortNode zkProc getAbortZNode procName ZKUtil zkProc getWatcher abortNode abort abortNode e String msg abortNode LOG error msg e IOException msg e String acquire zkProc getAcquiredBarrierNode procName LOG debug acquire data ProtobufUtil prependPBMagic info ZKUtil createWithParents zkProc getWatcher acquire data String node String znode ZNodePaths joinZNode acquire node
e String msg abortNode LOG error msg e IOException msg e String acquire zkProc getAcquiredBarrierNode procName LOG debug acquire data ProtobufUtil prependPBMagic info ZKUtil createWithParents zkProc getWatcher acquire data String node String znode ZNodePaths joinZNode acquire node LOG debug znode ZKUtil zkProc getWatcher znode coordinator memberAcquiredBarrier procName node e
proc String String procName proc getName String reachedNode zkProc getReachedBarrierNode procName
proc String String procName proc getName String reachedNode zkProc getReachedBarrierNode procName LOG debug reachedNode ZKUtil createWithParents zkProc getWatcher reachedNode String node String znode ZNodePaths joinZNode reachedNode node ZKUtil zkProc getWatcher znode dataFromMember ZKUtil getData zkProc getWatcher znode dataFromMember dataFromMember dataFromMember String msg znode
String znode ZNodePaths joinZNode reachedNode node ZKUtil zkProc getWatcher znode dataFromMember ZKUtil getData zkProc getWatcher znode dataFromMember dataFromMember length ProtobufUtil dataFromMember String msg znode LOG error msg IOException msg dataFromMember Arrays copyOfRange dataFromMember ProtobufUtil lengthOfPBMagic dataFromMember length coordinator memberFinishedBarrier procName node dataFromMember coordinator memberFinishedBarrier procName node dataFromMember String msg reachedNode
ProtobufUtil dataFromMember String msg znode LOG error msg IOException msg dataFromMember Arrays copyOfRange dataFromMember ProtobufUtil lengthOfPBMagic dataFromMember length coordinator memberFinishedBarrier procName node dataFromMember coordinator memberFinishedBarrier procName node dataFromMember e String msg reachedNode LOG error msg e IOException msg e e String msg reachedNode
proc String procName proc getName stillGettingNotifications
isInProcedurePath path LOG debug path logZKTree baseZNode path coordinator memberAcquiredBarrier ZKUtil getNodeName ZKUtil getParent path ZKUtil getNodeName path path String procName ZKUtil getNodeName ZKUtil getParent path String member ZKUtil getNodeName path dataFromMember ZKUtil getData watcher path dataFromMember dataFromMember dataFromMember ForeignException ee ForeignException coordName path coordinator abortProcedure procName ee
ForeignException ee ForeignException coordName path coordinator abortProcedure procName ee dataFromMember Arrays copyOfRange dataFromMember ProtobufUtil lengthOfPBMagic dataFromMember length LOG debug procName member String dataFromMember StandardCharsets UTF_8 coordinator memberFinishedBarrier procName member dataFromMember coordinator memberFinishedBarrier procName member dataFromMember e ForeignException ee ForeignException coordName e coordinator abortProcedure procName ee e ForeignException ee ForeignException coordName e coordinator abortProcedure procName ee path
dataFromMember Arrays copyOfRange dataFromMember ProtobufUtil lengthOfPBMagic dataFromMember length LOG debug procName member String dataFromMember StandardCharsets UTF_8 coordinator memberFinishedBarrier procName member dataFromMember coordinator memberFinishedBarrier procName member dataFromMember e ForeignException ee ForeignException coordName e coordinator abortProcedure procName ee e ForeignException ee ForeignException coordName e coordinator abortProcedure procName ee path abort path LOG debug path
coordinator memberFinishedBarrier procName member dataFromMember e ForeignException ee ForeignException coordName e coordinator abortProcedure procName ee e ForeignException ee ForeignException coordName e coordinator abortProcedure procName ee path abort path LOG debug path zkProc clearChildZNodes e
proc String procName proc getName
proc String procName proc getName LOG debug procName String procAbortNode zkProc getAbortZNode procName
proc ForeignException ee String procName proc getName LOG debug procName String procAbortNode zkProc getAbortZNode procName LOG debug procAbortNode String source ee getSource coordName ee getSource errorInfo ProtobufUtil prependPBMagic ForeignException serialize source ee ZKUtil createAndFailSilent zkProc getWatcher procAbortNode errorInfo
String path LOG debug path String opName ZKUtil getNodeName path String abortZNode zkController getAbortZNode opName ZKUtil zkController abortZNode
LOG debug path String opName ZKUtil getNodeName path String abortZNode zkController getAbortZNode opName ZKUtil zkController getWatcher abortZNode LOG debug opName e member controllerConnectionFailure abortZNode opName e opName Subprocedure subproc data ZKUtil getData zkController getWatcher path data String msg opName Bytes toString data
ZKUtil zkController getWatcher abortZNode LOG debug opName e member controllerConnectionFailure abortZNode opName e opName Subprocedure subproc data ZKUtil getData zkController getWatcher path ProtobufUtil data String msg opName Bytes toString data LOG error msg IllegalArgumentException msg LOG debug data length data Arrays copyOfRange data ProtobufUtil lengthOfPBMagic data length
sub String procName sub getName
sub String procName sub getName LOG debug memberName procName String acquiredZNode ZNodePaths joinZNode ZKProcedureUtil getAcquireBarrierNode zkController procName memberName ZKUtil createAndFailSilent zkController getWatcher acquiredZNode String reachedBarrier zkController getReachedBarrierNode procName
sub String procName sub getName
String LOG isDebugEnabled LOG debug String prefix
String root String List String children ZKUtil listChildrenNoWatch watcher root children String children
RegionInfo hri region getFirst hri isOffline hri isSplit hri isSplitParent regionServers add region getSecond toString ForeignExceptionDispatcher monitor ForeignExceptionDispatcher desc getInstance HBaseProtos NameStringPair family HBaseProtos NameStringPair nsp desc nsp family nsp procArgs family family toByteArray Procedure proc coordinator startProcedure monitor desc getInstance procArgs Lists newArrayList regionServers monitor rethrowException proc String msg desc getSignature desc getInstance LOG error msg IOException msg
force String mode force
List Procedure procsByType clazz List Procedure procs procsByType get clazz procs
store recoverLease MutableLong maxProcIdSet MutableLong List Procedure procs ArrayList Map Class List Procedure activeProcsByType HashMap store maxProcId maxProcIdSet setValue maxProcId procIter procIter Procedure proc procIter next procs add proc proc activeProcsByType computeIfAbsent proc getClass k ArrayList add proc procIter corruptedCount
proc activeProcsByType computeIfAbsent proc getClass k ArrayList add proc procIter IOException corruptedCount procIter LOG error procIter next corruptedCount corruptedCount IOException corruptedCount checkUnsupportedProcedure activeProcsByType MutableLong maxProcIdFromProcs MutableLong proc update proc proc maxProcIdFromProcs
proc activeProcsByType computeIfAbsent proc getClass k ArrayList add proc procIter IOException corruptedCount procIter LOG error procIter next corruptedCount corruptedCount IOException corruptedCount checkUnsupportedProcedure activeProcsByType MutableLong maxProcIdFromProcs MutableLong proc update proc proc maxProcIdFromProcs
request rpcThrottle request getRpcThrottleEnabled masterServices getMasterCoprocessorHost preSwitchRpcThrottle rpcThrottle oldRpcThrottle rpcThrottleStorage isRpcThrottleEnabled rpcThrottle oldRpcThrottle
numTablesInViolation table SpaceQuota spaceQuota tableSnapshotStore getSpaceQuota table spaceQuota
numNamespacesInViolation namespace SpaceQuota spaceQuota namespaceSnapshotStore getSpaceQuota namespace spaceQuota
snapshotNotifier transitionTable table targetSnapshot tableSnapshotStore setCurrentState table targetSnapshot SpaceViolationPolicy currPolicy currentStatus getPolicy orElse SpaceViolationPolicy targetPolicy targetStatus getPolicy orElse targetStatus currPolicy targetPolicy QuotaUtil enableTableIfNotEnabled conn table LOG LOG debug table currPolicy targetPolicy SpaceViolationPolicy currPolicy QuotaUtil enableTableIfNotEnabled conn table SpaceViolationPolicy targetPolicy QuotaUtil disableTableIfNotDisabled conn table LOG
tableInNS tableSnapshotStore getCurrentState tableInNS LOG LOG trace tableInNS LOG info tableInNS snapshotNotifier transitionTable tableInNS targetSnapshot tableInNS SpaceQuotaSnapshot tableQuotaSnapshot tableSnapshotStore getCurrentState tableInNS hasTableQuota Objects equals QuotaSnapshotStore NO_QUOTA tableQuotaSnapshot hasTableQuota tableQuotaSnapshot LOG LOG trace tableInNS
tableInNS namespace SpaceQuotaSnapshot tableQuotaSnapshot tableSnapshotStore getCurrentState tableInNS hasTableQuota Objects equals QuotaSnapshotStore NO_QUOTA tableQuotaSnapshot hasTableQuota tableQuotaSnapshot LOG LOG trace tableInNS LOG info tableInNS targetStatus getPolicy snapshotNotifier transitionTable tableInNS targetSnapshot namespaceSnapshotStore setCurrentState namespace targetSnapshot targetStatus LOG LOG trace namespace
rpcThrottleEnabled previousEnabled rpcThrottleEnabled rpcThrottleEnabled rpcThrottleStorage isRpcThrottleEnabled
Collection preCommitWriters Collection StoreFileWriter writers writers
CompactionContext compaction Optional CompactionContext c selectCompaction region store priority tracker completeTracker user c compaction c get compaction ThreadPoolExecutor pool pool store throttleCompaction compaction getRequest getSize longCompactions shortCompactions pool shortCompactions pool execute CompactionRunner store region compaction tracker completeTracker pool user region incrementCompactionsQueuedCount
t done done done t awaitTermination TimeUnit SECONDS
newConf largeThreads Math max newConf getInt LARGE_COMPACTION_THREADS LARGE_COMPACTION_THREADS_DEFAULT largeThreads
longCompactions setCorePoolSize largeThreads longCompactions setCorePoolSize largeThreads longCompactions setMaximumPoolSize largeThreads smallThreads newConf getInt SMALL_COMPACTION_THREADS SMALL_COMPACTION_THREADS_DEFAULT shortCompactions getCorePoolSize smallThreads LOG info SMALL_COMPACTION_THREADS shortCompactions getCorePoolSize smallThreads shortCompactions getCorePoolSize smallThreads shortCompactions setMaximumPoolSize smallThreads shortCompactions setCorePoolSize smallThreads shortCompactions setCorePoolSize smallThreads shortCompactions setMaximumPoolSize smallThreads splitThreads newConf getInt SPLIT_THREADS SPLIT_THREADS_DEFAULT getCorePoolSize splitThreads
List HRegion onlineRegions List HRegion regionServerServices getRegions onlineRegions HRegion region onlineRegions LOG LOG trace region getRegionInfo store region regionServerServices CompactedHFilesDischargeHandler handler CompactedHFilesDischargeHandler Server regionServerServices EventType RS_COMPACTED_FILES_DISCHARGER store regionServerServices getExecutorService submit handler store closeAndArchiveCompactedFiles LOG LOG trace region getRegionInfo store getColumnFamilyName
String msg getActive getDataSize msg allowCompaction get msg inMemoryCompactionInProgress get
tunerLog append isReverting isReverting newTuneDirection StepDirection NEUTRAL newTuneDirection StepDirection INCREASE_BLOCK_CACHE_SIZE tunerLog append newTuneDirection StepDirection INCREASE_MEMSTORE_SIZE tunerLog append StepDirection NEUTRAL
RuntimeMXBean runtime ManagementFactory getRuntimeMXBean
RuntimeMXBean runtime ManagementFactory getRuntimeMXBean LOG info runtime getVmName runtime getVmVendor runtime getVmVersion
qf Bytes toBytes empty MemStoreSizing memStoreSizing NonThreadSafeMemStoreSizing i i i memstore1 add KeyValue Bytes toBytes i fam qf i empty memStoreSizing LOG info memStoreSizing getMemStoreSize getDataSize memStoreSizing getMemStoreSize getHeapSize i i i memstore1 add KeyValue Bytes toBytes i fam qf i empty memStoreSizing LOG info memStoreSizing getMemStoreSize getDataSize memStoreSizing getMemStoreSize getHeapSize DefaultMemStore memstore2 DefaultMemStore memStoreSizing NonThreadSafeMemStoreSizing i i i memstore2 add KeyValue Bytes toBytes i fam qf i i memStoreSizing LOG info memStoreSizing getMemStoreSize getDataSize memStoreSizing getMemStoreSize getHeapSize seconds
HStoreFile HStoreFile ImmutableList HStoreFile files storefiles files files sf fileTs sf getReader getMaxTimestamp fileTs sf
configureForRegion region configureForRegion region String delimiterString region getTableDescriptor getValue DELIMITER_KEY delimiterString delimiterString
readCell Path fileName search cacheMobBlocks readPt FileSystem fs getFileSystem Throwable throwable Path location MobFile file Path path Path location fileName file mobFileCache openFile fs path cacheConf readPt file readCell search cacheMobBlocks readPt file readCell search cacheMobBlocks e mobFileCache evictFile fileName throwable e e e LOG debug path e e
file mobFileCache openFile fs path cacheConf readPt file readCell search cacheMobBlocks readPt file readCell search cacheMobBlocks e mobFileCache evictFile fileName throwable e e e LOG debug path e e LOG error path e e e mobFileCache evictFile fileName
e mobFileCache evictFile fileName throwable e e e LOG debug path e e LOG error path e e e mobFileCache evictFile fileName LOG debug e throwable e e
e LOG error path e e e mobFileCache evictFile fileName LOG debug e throwable e e mobFileCache evictFile fileName LOG debug e throwable e
LOG debug getRegionInfo getEncodedName fs cleanupAnySplitDetritus fs cleanupMergesDir splitPolicy RegionSplitPolicy create conf flushPolicy FlushPolicyFactory create conf lastFlushTime EnvironmentEdgeManager currentTime store lastStoreFlushTimeMap put store lastFlushTime nextSeqId maxSeqId maxSeqIdFromFile WALSplitUtil getMaxRegionSequenceId conf RegionReplicaUtil getRegionInfoForDefaultReplica getRegionInfo getFilesystem getWalFileSystem nextSeqId Math max maxSeqId maxSeqIdFromFile RegionReplicaUtil getRegionInfo LOG debug getRegionInfo getEncodedName WALSplitUtil writeRegionSequenceIdFile getWalFileSystem getWALRegionDir nextSeqId
hasSloppyStores Future HStore future completionService take HStore store future get stores put store getColumnFamilyDescriptor getName store store hasSloppyStores storeMaxSequenceId store getMaxSequenceId orElse maxSeqIdInStores put Bytes toBytes store getColumnFamilyName storeMaxSequenceId maxSeqId storeMaxSequenceId maxSeqId maxSeqId storeMaxSequenceId maxStoreMemstoreTS store getMaxMemStoreTS orElse maxStoreMemstoreTS maxMemstoreTS maxMemstoreTS maxStoreMemstoreTS
storeMaxSequenceId store getMaxSequenceId orElse maxSeqIdInStores put Bytes toBytes store getColumnFamilyName storeMaxSequenceId maxSeqId storeMaxSequenceId maxSeqId maxSeqId storeMaxSequenceId maxStoreMemstoreTS store getMaxMemStoreTS orElse maxStoreMemstoreTS maxMemstoreTS maxMemstoreTS maxStoreMemstoreTS allStoresOpened htableDescriptor TableDescriptorBuilder newBuilder htableDescriptor setFlushPolicyClassName FlushNonSloppyStoresFirstPolicy getName build LOG info e InterruptedIOException InterruptedIOException initCause e e IOException e getCause
status setStatus LOG info getRegionInfo getEncodedName internalFlushcache status IOException ioe status setStatus ioe getMessage timeoutForWriteLock timeoutForWriteLock lock writeLock lock succeed lock writeLock tryLock timeoutForWriteLock TimeUnit SECONDS succeed IOException
IOException ioe status setStatus ioe getMessage timeoutForWriteLock timeoutForWriteLock lock writeLock lock succeed lock writeLock tryLock timeoutForWriteLock TimeUnit SECONDS succeed IOException e InterruptedIOException InterruptedIOException initCause e closing set LOG info status setStatus
succeed lock writeLock tryLock timeoutForWriteLock TimeUnit SECONDS succeed IOException e InterruptedIOException InterruptedIOException initCause e closing set LOG info status setStatus status abort LOG debug abort failedfFlushCount
CompletionService Pair Collection HStoreFile completionService ExecutorCompletionService storeCloserThreadPool store MemStoreSize mss store getFlushableSize abort mss getRegionServerServices getRegionServerServices abort getRegionInfo getRegionNameAsString store mss memStoreSizing getMemStoreSize completionService Pair Collection HStoreFile Pair Collection HStoreFile Pair store getColumnFamilyDescriptor getName store close Future Pair Collection HStoreFile future completionService take Pair Collection HStoreFile storeFiles future get List HStoreFile familyFiles result get storeFiles getFirst
writestate timeout duration timeout toWait timeout timeout duration writestate wait toWait LOG warn interrupted duration System currentTimeMillis start interrupted Thread currentThread interrupt
String msg
String msg LOG debug msg status abort msg FlushResultImpl FlushResult Result CANNOT_FLUSH msg coprocessorHost status setStatus coprocessorHost preFlush tracker numMutationsWithoutWAL numMutationsWithoutWAL reset dataInMemoryWithoutWAL reset writestate writestate flushing writestate writestate flushing
store earliest wal getEarliestMemStoreSeqNum getRegionInfo getEncodedNameAsBytes store getColumnFamilyDescriptor getName earliest earliest
NavigableSet Path files WALSplitUtil getSplitEditFilesSorted walFS regionWALDir seqId Math max seqId replayRecoveredEditsForPaths minSeqIdForTheRegion walFS files reporter regionWALDir seqId minSeqIdForTheRegion internalFlushcache seqId stores values status FlushLifeCycleTracker DUMMY files size conf String fakeFamilyName WALSplitUtil getRegionDirRecoveredEditsDir regionWALDir getName Set HStoreFile fakeStoreFiles HashSet files size Path file files fakeStoreFiles add HStoreFile walFS file conf getRegionWALFileSystem archiveRecoveredEdits fakeFamilyName fakeStoreFiles deleteRecoveredEdits walFS Iterables concat files filesUnderWrongRegionWALDir deleteRecoveredEdits rootFS filesUnderRootDir Path recoveredEditsDir Path specialRecoveredEditsDirStr
minSeqIdForTheRegion seqid minSeqIdForTheRegion
LOG debug files files size regionDir files files minSeqIdForTheRegion edits files edits edits LOG warn edits edits edits maxSeqId String fileName edits getName maxSeqId Math abs Long parseLong fileName maxSeqId minSeqIdForTheRegion LOG String msg maxSeqId minSeqIdForTheRegion edits
edits String msg edits
intervalEdits val size intervalEdits intervalEdits cur EnvironmentEdgeManager currentTime lastReport cur status setStatus skippedEdits editsCount msg LOG warn msg status abort msg IOException msg reported_once lastReport cur
checkTargetRegion compaction getEncodedRegionName toByteArray compaction wre getRegionInfo wre replaySeqId lastReplayedOpenRegionSeqId LOG warn getRegionInfo getEncodedName TextFormat shortDebugString compaction replaySeqId lastReplayedOpenRegionSeqId replaySeqId lastReplayedCompactionSeqId LOG warn getRegionInfo getEncodedName TextFormat shortDebugString compaction replaySeqId lastReplayedCompactionSeqId lastReplayedCompactionSeqId replaySeqId LOG
MemStoreSize MemStoreSizing totalFreedSize NonThreadSafeMemStoreSizing updatesLock writeLock lock s MemStoreSize memStoreSize doDropStoreMemStoreContentsForSeqId s HConstants NO_SEQNUM
MemStoreSizing totalFreedSize NonThreadSafeMemStoreSizing updatesLock writeLock lock currentSeqId mvcc getReadPoint currentSeqId
List Pair String failures ArrayList Pair String p familyName p getFirst String path p getSecond HStore store getStore familyName store ioException org apache hadoop hbase DoNotRetryIOException Bytes toStringBinary familyName store assertBulkLoadHFileOk Path path failures add p ioe ioException ioe ioException
FlushResult fs flushcache FlushLifeCycleTracker DUMMY fs seqId FlushResultImpl fs flushSequenceId fs FlushResult seqId FlushResultImpl fs flushSequenceId fs FlushResult waitForFlushes IOException FlushResultImpl fs failureReason Map List Pair Path Path familyWithFinalPath TreeMap Bytes BYTES_COMPARATOR Pair String p familyName p getFirst String path p getSecond HStore store getStore familyName familyWithFinalPath familyName
seqId FlushResultImpl fs flushSequenceId fs waitForFlushes IOException FlushResultImpl fs failureReason Map List Pair Path Path familyWithFinalPath TreeMap Bytes BYTES_COMPARATOR Pair String p familyName p getFirst String path p getSecond HStore store getStore familyName familyWithFinalPath familyName familyWithFinalPath put familyName ArrayList List Pair Path Path lst familyWithFinalPath get familyName String finalPath path
bulkLoadListener bulkLoadListener failedBulkLoad familyName path ex LOG error Bytes toString familyName path ex ioe getCoprocessorHost Path Path entry getCoprocessorHost preCommitStoreFile entry getKey entry getValue Path Path entry familyName entry getKey Path Path p entry getValue String path p getFirst toString Path commitedStoreFile p getSecond HStore store getStore familyName
LOG error Bytes toString familyName path ex ioe getCoprocessorHost Path Path entry getCoprocessorHost preCommitStoreFile entry getKey entry getValue Path Path entry familyName entry getKey Path Path p entry getValue String path p getFirst toString Path commitedStoreFile p getSecond HStore store getStore familyName store bulkLoadHFile familyName path commitedStoreFile FileSystem fs commitedStoreFile getFileSystem baseConf
info Objects requireNonNull info
info Objects requireNonNull info
info Objects requireNonNull info
task processor process now region mutations walEdit e String row processor getRowsToLock isEmpty Bytes toStringBinary processor getRowsToLock iterator next LOG warn processor getClass getName getRegionInfo getRegionNameAsString row e e rowProcessorExecutor execute task task get timeout TimeUnit MILLISECONDS
instance ServiceDescriptor serviceDesc instance getDescriptorForType String serviceName CoprocessorRpcUtils getServiceName serviceDesc serviceName
srcPath FileSystem srcFs srcPath getFileSystem conf srcPath srcFs resolvePath srcPath FileSystem realSrcFs srcPath getFileSystem conf FileSystem desFs fs HFileSystem HFileSystem fs getBackingFs fs conf realSrcFs desFs
Path Path Path srcPath FileSystem srcFs srcPath getFileSystem conf srcPath srcFs resolvePath srcPath FileSystem realSrcFs srcPath getFileSystem conf FileSystem desFs fs HFileSystem HFileSystem fs getBackingFs fs conf realSrcFs desFs LOG info srcPath Path tmpPath createTempName FileUtil copy realSrcFs srcPath fs tmpPath conf
Path splitdir getSplitsDir splitdir
Path mergesdir getMergesDir mergesdir
instance ServiceDescriptor serviceDesc instance getDescriptorForType String serviceName CoprocessorRpcUtils getServiceName serviceDesc serviceName
se IOException ioe ProtobufUtil getRemoteException se ioe LOG trace ioe rssStub rssStub createRegionServerStatusStub ioe DoNotRetryIOException DoNotRetryIOException doNotRetryEx DoNotRetryIOException ioe doNotRetryEx getCause Throwable t doNotRetryEx getCause t LOG debug
lastCount previousLogTime Set String closedRegions HashSet interrupted count getNumberOfOnlineRegions count lastCount System currentTimeMillis previousLogTime previousLogTime System currentTimeMillis lastCount count
updateRootDir e String key e getName key String hostnameFromMasterPOV e getValue serverName ServerName valueOf hostnameFromMasterPOV rpcServices isa getPort startcode useThisHostnameInstead hostnameFromMasterPOV useThisHostnameInstead String msg useThisHostnameInstead hostnameFromMasterPOV
String hostnameFromMasterPOV e getValue serverName ServerName valueOf hostnameFromMasterPOV rpcServices isa getPort startcode useThisHostnameInstead hostnameFromMasterPOV useThisHostnameInstead String msg useThisHostnameInstead hostnameFromMasterPOV LOG error msg IOException msg useThisHostnameInstead hostnameFromMasterPOV rpcServices isa getHostName String msg rpcServices isa getHostName hostnameFromMasterPOV LOG error msg String value e getValue value value updateRootDir LOG
isMasterNoTableOrSystemTableOnly HMaster LoadBalancer isMasterCanHostUserRegions conf WALFactory factory WALFactory conf serverName toString isMasterNoTableOrSystemTableOnly isMasterNoTableOrSystemTableOnly Path oldLogDir Path walRootDir HConstants HREGION_OLDLOGDIR_NAME String logName AbstractFSWALProvider getWALDirectoryName serverName toString Path logDir Path walRootDir logName
port addr String msg addr LOG error msg IOException msg auto conf getBoolean HConstants REGIONSERVER_INFO_PORT_AUTO infoServer InfoServer getProcessName addr port conf infoServer addPrivilegedServlet getDumpServlet configureInfoServer infoServer start
addr String msg addr LOG error msg IOException msg auto conf getBoolean HConstants REGIONSERVER_INFO_PORT_AUTO infoServer InfoServer getProcessName addr port conf infoServer addPrivilegedServlet getDumpServlet configureInfoServer infoServer start auto LOG error port
context HRegion r context getRegion openProcId context getOpenProcId masterSystemTime context getMasterSystemTime rpcServices checkOpen
openSeqNum context getOpenSeqNum masterSystemTime context getMasterSystemTime RegionInfo hris context getHris Preconditions checkArgument hris hris length hris MetaTableLocator setMetaLocation getZooKeeper serverName hris getReplicaId RegionState State OPEN e LOG info e MetaTableAccessor updateRegionLocation asyncClusterConnection toConnection hris serverName openSeqNum masterSystemTime e
reportRegionStateTransition context skipReportingTransition context ReportRegionStateTransitionRequest request createReportRegionStateTransitionRequest context initPauseTime tries pauseTime RegionServerStatusService BlockingInterface rss rssStub rss createRegionServerStatusStub ReportRegionStateTransitionResponse response rss reportRegionStateTransition request response
ReportRegionStateTransitionRequest request createReportRegionStateTransitionRequest context initPauseTime tries pauseTime RegionServerStatusService BlockingInterface rss rssStub rss createRegionServerStatusStub ReportRegionStateTransitionResponse response rss reportRegionStateTransition request response LOG info request response getErrorMessage tries LOG
ReportRegionStateTransitionResponse response rss reportRegionStateTransition request response LOG info request response getErrorMessage tries LOG LOG info request se IOException ioe ProtobufUtil getRemoteException se pause ioe ServerNotRunningYetException ioe PleaseHoldException ioe CallQueueTooBigException pause pauseTime ConnectionUtils getPauseTime initPauseTime tries pauseTime initPauseTime
RegionServerStartupResponse masterless RegionServerStartupResponse getDefaultInstance ServerName masterServerName createRegionServerStatusStub RegionServerStatusService BlockingInterface rss rssStub masterServerName rss RegionServerStartupResponse result rpcServices requestCount reset rpcServices rpcGetRequestCount reset rpcServices rpcScanRequestCount reset rpcServices rpcMultiRequestCount reset rpcServices rpcMutateRequestCount reset
rpcServices rpcMultiRequestCount reset rpcServices rpcMutateRequestCount reset LOG info masterServerName rpcServices isa getPort startcode now EnvironmentEdgeManager currentTime port rpcServices isa getPort RegionServerStartupRequest Builder request RegionServerStartupRequest newBuilder useThisHostnameInstead request setUseThisHostnameInstead useThisHostnameInstead request setPort port request setServerStartCode startcode request setServerCurrentTime now result rss regionServerStartup request build se IOException ioe ProtobufUtil getRemoteException se ioe
actualRegion getCoprocessorHost preClose exp LOG warn exp Boolean previous regionsInTransitionInRS putIfAbsent Bytes toBytes encodedName Boolean FALSE Boolean previous LOG info encodedName regionsInTransitionInRS Bytes toBytes encodedName previous Boolean FALSE LOG warn encodedName closeRegion encodedName abort destination actualRegion getRegion encodedName actualRegion LOG info NotServingRegionException encodedName previous
exp LOG warn exp Boolean previous regionsInTransitionInRS putIfAbsent Bytes toBytes encodedName Boolean FALSE Boolean previous LOG info encodedName regionsInTransitionInRS Bytes toBytes encodedName previous Boolean FALSE LOG warn encodedName closeRegion encodedName abort destination actualRegion getRegion encodedName actualRegion LOG info NotServingRegionException encodedName previous LOG info encodedName
rss rsSpaceQuotaManager LOG trace RegionServerStatusProtos FileArchiveNotificationRequest request rsSpaceQuotaManager buildFileArchiveRequest tableName archivedFiles rss reportFileArchival request se IOException ioe ProtobufUtil getRemoteException se ioe LOG LOG trace ioe rssStub rss rssStub createRegionServerStatusStub
family cacheConf CacheConfig conf family region getBlockCache region getRegionServicesForStores getByteBuffAllocator
Collections emptyList ThreadPoolExecutor storeFileOpenerThreadPool region getStoreFileOpenAndCloseThreadPool region getRegionInfo getEncodedName getColumnFamilyName CompletionService HStoreFile completionService ExecutorCompletionService storeFileOpenerThreadPool totalValidStoreFile storeFileInfo files completionService submit createStoreFileAndReader storeFileInfo totalValidStoreFile Set String compactedStoreFiles HashSet ArrayList HStoreFile results ArrayList files size IOException ioe totalValidStoreFile HStoreFile storeFile completionService take get storeFile
ioe IOException e getCause storeFileOpenerThreadPool shutdownNow ioe evictOnClose cacheConf cacheConf shouldEvictOnClose HStoreFile file file file closeStoreFile evictOnClose IOException e LOG warn file e ioe List HStoreFile filesToRemove ArrayList compactedStoreFiles size HStoreFile
newFiles Collections emptySet compactedFiles compactedFiles Collections emptySet HashMap StoreFileInfo HStoreFile currentFilesSet HashMap currentFiles size HStoreFile sf currentFiles currentFilesSet put sf getFileInfo sf HashMap StoreFileInfo HStoreFile compactedFilesSet HashMap compactedFiles size HStoreFile sf compactedFiles compactedFilesSet put sf getFileInfo sf Set StoreFileInfo newFilesSet HashSet StoreFileInfo newFiles newFilesSet Sets difference newFilesSet compactedFilesSet keySet Set StoreFileInfo toBeAddedFiles Sets difference newFilesSet currentFilesSet keySet Set StoreFileInfo toBeRemovedFiles Sets difference currentFilesSet keySet newFilesSet toBeAddedFiles toBeRemovedFiles
HFile Reader reader
srcPath HFile Reader reader LOG info srcPath FileSystem srcFs srcPath getFileSystem conf srcFs access srcPath FsAction READ_WRITE reader HFile createReader srcFs srcPath cacheConf isPrimaryReplicaStore conf Optional firstKey reader getFirstRowKey Preconditions checkState firstKey isPresent Optional Cell lk reader getLastKey Preconditions checkState lk isPresent lastKey CellUtil cloneRow lk get LOG
srcPath HFile Reader reader LOG info srcPath FileSystem srcFs srcPath getFileSystem conf srcFs access srcPath FsAction READ_WRITE reader HFile createReader srcFs srcPath cacheConf isPrimaryReplicaStore conf Optional firstKey reader getFirstRowKey Preconditions checkState firstKey isPresent Optional Cell lk reader getLastKey Preconditions checkState lk isPresent lastKey CellUtil cloneRow lk get LOG LOG debug Bytes toStringBinary firstKey get Bytes toStringBinary lastKey
reader HFile createReader srcFs srcPath cacheConf isPrimaryReplicaStore conf Optional firstKey reader getFirstRowKey Preconditions checkState firstKey isPresent Optional Cell lk reader getLastKey Preconditions checkState lk isPresent lastKey CellUtil cloneRow lk get LOG LOG debug Bytes toStringBinary firstKey get Bytes toStringBinary lastKey LOG debug Bytes toStringBinary getRegionInfo getStartKey Bytes toStringBinary getRegionInfo getEndKey getRegionInfo firstKey get lastKey WrongRegionException srcPath toString getRegionInfo getRegionNameAsString reader length conf LOG warn srcPath reader length verificationStartTime EnvironmentEdgeManager currentTime
reader length LOG warn srcPath reader length verificationStartTime EnvironmentEdgeManager currentTime LOG info srcPath Cell prevCell HFileScanner scanner reader getScanner scanner seekTo Cell cell scanner getCell prevCell prevCell cell InvalidHFileException srcPath CellUtil getCellKeyAsString prevCell CellUtil getCellKeyAsString cell prevCell cell InvalidHFileException srcPath Bytes toStringBinary prevCell getFamilyArray prevCell getFamilyOffset prevCell getFamilyLength Bytes toStringBinary cell getFamilyArray cell getFamilyOffset cell getFamilyLength
HStoreFile Path path status Path dstPath fs commitStoreFile getColumnFamilyName path status setStatus HStoreFile sf createStoreFileAndReader dstPath StoreFileReader r sf getReader storeSize addAndGet r length totalUncompressedBytes addAndGet r getTotalUncompressedBytes
cacheCompactedBlocksOnWrite cacheConf shouldCacheCompactedBlocksOnWrite cacheCompactedBlocksOnWrite totalCompactedFilesSize cacheConf getCacheCompactedBlocksOnWriteThreshold writerCacheConf enableCacheOnWrite cacheOnWriteLogged LOG info cacheOnWriteLogged writerCacheConf setCacheDataOnWrite totalCompactedFilesSize cacheConf getCacheCompactedBlocksOnWriteThreshold LOG debug totalCompactedFilesSize cacheConf getCacheCompactedBlocksOnWriteThreshold shouldCacheDataOnWrite cacheConf shouldCacheDataOnWrite shouldCacheDataOnWrite writerCacheConf enableCacheOnWrite cacheOnWriteLogged
Path inputPath fs getStoreFilePath familyName compactionInput inputFiles add inputPath getName List HStoreFile inputStoreFiles ArrayList compactionInputs size HStoreFile sf inputFiles sf getPath getName inputStoreFiles add sf List HStoreFile outputStoreFiles ArrayList compactionOutputs size HStoreFile sf compactionOutputs remove sf getPath getName compactionOutput compactionOutputs StoreFileInfo storeFileInfo fs getStoreFileInfo getColumnFamilyName compactionOutput HStoreFile storeFile createStoreFileAndReader storeFileInfo outputStoreFiles add storeFile inputStoreFiles outputStoreFiles
lock readLock lock Collection HStoreFile delSfs filesCompacting cfTtl getStoreFileTtl cfTtl delSfs storeEngine getStoreFileManager getUnneededFiles EnvironmentEdgeManager currentTime cfTtl filesCompacting addToCompactingFiles delSfs lock readLock unlock delSfs Collection HStoreFile newFiles Collections emptyList writeCompactionWalRecord delSfs newFiles replaceStoreFiles delSfs newFiles
HStoreFile compactedfiles List HStoreFile filesToRemove ArrayList compactedfiles size List Long storeFileSizes ArrayList compactedfiles size HStoreFile file compactedfiles file StoreFileReader r file getReader r
StoreFileReader r file getReader r LOG debug file length getStoreFileSize file filesToRemove add file storeFileSizes add length file file LOG trace file length r length r close evictOnClose filesToRemove add file storeFileSizes add length
r LOG debug file length getStoreFileSize file filesToRemove add file storeFileSizes add length file isCompactedAway file isReferencedInReads LOG trace file length r length r close evictOnClose filesToRemove add file storeFileSizes add length LOG info file getPath file isCompactedAway file isReferencedInReads r getRefCount
filesToRemove add file storeFileSizes add length file isCompactedAway file isReferencedInReads LOG trace file length r length r close evictOnClose filesToRemove add file storeFileSizes add length LOG info file getPath file isCompactedAway file isReferencedInReads r getRefCount e LOG error file getPath e filesToRemove
configureForRegion region configureForRegion region prefixLength String prefixLengthString region getTableDescriptor getValue PREFIX_LENGTH_KEY prefixLengthString prefixLengthString region getTableDescriptor getValue PREFIX_LENGTH_KEY_DEPRECATED prefixLengthString
configureForRegion region configureForRegion region prefixLength String prefixLengthString region getTableDescriptor getValue PREFIX_LENGTH_KEY prefixLengthString prefixLengthString region getTableDescriptor getValue PREFIX_LENGTH_KEY_DEPRECATED prefixLengthString LOG error PREFIX_LENGTH_KEY region getTableDescriptor getTableName prefixLength Integer parseInt prefixLengthString nfe LOG error PREFIX_LENGTH_KEY region getTableDescriptor getTableName prefixLengthString nfe prefixLength
e e LOG error HBaseMarkers FATAL e nextLease nextLeaseDelay Long MAX_VALUE Map Entry String Lease it it Map Entry String Lease entry it next Lease lease entry getValue thisLeaseDelay lease getDelay TimeUnit MILLISECONDS thisLeaseDelay nextLease thisLeaseDelay nextLeaseDelay nextLease lease nextLeaseDelay thisLeaseDelay
LOG error HRegion regionToFlush bestAnyRegionSize bestFlushableRegionSize bestAnyRegionSize getMemStoreOffHeapSize bestFlushableRegionSize getMemStoreOffHeapSize bestFlushableRegion bestAnyRegionSize getMemStoreHeapSize bestFlushableRegionSize getMemStoreHeapSize bestFlushableRegion bestAnyRegionSize getMemStoreDataSize bestFlushableRegionSize getMemStoreDataSize bestFlushableRegion
bestFlushableRegion regionToFlush bestAnyRegion regionToFlush bestFlushableRegion regionToFlushSize bestRegionReplicaSize regionToFlushSize regionToFlush getMemStoreOffHeapSize bestRegionReplicaSize getMemStoreOffHeapSize bestRegionReplica regionToFlushSize regionToFlush getMemStoreHeapSize bestRegionReplicaSize getMemStoreHeapSize bestRegionReplica regionToFlushSize regionToFlush
regionToFlush bestAnyRegion regionToFlush bestFlushableRegion regionToFlushSize bestRegionReplicaSize regionToFlushSize regionToFlush getMemStoreOffHeapSize bestRegionReplicaSize getMemStoreOffHeapSize bestRegionReplica regionToFlushSize regionToFlush getMemStoreHeapSize bestRegionReplicaSize getMemStoreHeapSize bestRegionReplica regionToFlushSize regionToFlush getMemStoreDataSize bestRegionReplicaSize getMemStoreDataSize bestRegionReplica regionToFlush regionToFlushSize bestRegionReplicaSize
regionToFlush bestFlushableRegion regionToFlushSize bestRegionReplicaSize regionToFlushSize regionToFlush getMemStoreOffHeapSize bestRegionReplicaSize getMemStoreOffHeapSize bestRegionReplica regionToFlushSize regionToFlush getMemStoreHeapSize bestRegionReplicaSize getMemStoreHeapSize bestRegionReplica regionToFlushSize regionToFlush getMemStoreDataSize bestRegionReplicaSize getMemStoreDataSize bestRegionReplica regionToFlush regionToFlushSize bestRegionReplicaSize LOG debug
regionToFlushSize bestRegionReplicaSize regionToFlushSize getMemStoreOffHeapSize bestRegionReplicaSize getMemStoreOffHeapSize bestRegionReplica regionToFlushSize getMemStoreHeapSize bestRegionReplicaSize getMemStoreHeapSize bestRegionReplica regionToFlushSize getMemStoreDataSize bestRegionReplicaSize getMemStoreDataSize bestRegionReplica regionToFlushSize bestRegionReplicaSize LOG debug bestRegionReplica bestRegionReplicaSize regionToFlushSize
tracker beforeExecution lock readLock lock notifyFlushRequest region emergencyFlush FlushResult flushResult region flushcache families tracker shouldCompact flushResult isCompactionNeeded shouldSplit region checkSplit isPresent shouldSplit server compactSplitThread requestSplit region shouldCompact server compactSplitThread requestSystemCompaction region Thread currentThread getName ex server abort ex ex
r m r maxCellSize CellScanner cells m cellScanner cells size PrivateCellUtil estimatedSerializedSizeOf cells current size r maxCellSize String msg size r maxCellSize
stop stop
request ServerName sn request hasDestinationServer ProtobufUtil toServerName request getDestinationServer checkOpen throwOnWrongStartCode request String encodedRegionName ProtobufUtil getRegionEncodedName request getRegion requestCount increment sn
ClearCompactionQueuesResponse LOG debug RpcServer getRequestUserName orElse RpcServer getRemoteAddress orElse ClearCompactionQueuesResponse Builder respBuilder ClearCompactionQueuesResponse newBuilder requestCount increment checkOpen regionServer getRegionServerCoprocessorHost preClearCompactionQueues
checkOpen t Thread currentThread interrupt ServiceException t e ServiceException e masterSystemTime request hasMasterSystemTime request getMasterSystemTime regionOpenInfo request RegionInfo region ProtobufUtil toRegionInfo regionOpenInfo getRegion TableDescriptor htd String encodedName region getEncodedName encodedNameBytes region getEncodedNameAsBytes HRegion onlineRegion regionServer getRegion encodedName onlineRegion
masterSystemTime request hasMasterSystemTime request getMasterSystemTime regionOpenInfo request RegionInfo region ProtobufUtil toRegionInfo regionOpenInfo getRegion TableDescriptor htd String encodedName region getEncodedName encodedNameBytes region getEncodedNameAsBytes HRegion onlineRegion regionServer getRegion encodedName onlineRegion String error region getRegionNameAsString LOG warn error builder addOpeningState RegionOpeningState OPENED LOG info region getRegionNameAsString Boolean previous regionServer getRegionsInTransitionInRS putIfAbsent encodedNameBytes Boolean TRUE
WarmupRegionResponse request RegionInfo region ProtobufUtil toRegionInfo request getRegionInfo TableDescriptor htd WarmupRegionResponse response WarmupRegionResponse getDefaultInstance checkOpen String encodedName region getEncodedName encodedNameBytes region getEncodedNameAsBytes HRegion onlineRegion regionServer getRegion encodedName onlineRegion
checkOpen String encodedName region getEncodedName encodedNameBytes region getEncodedNameAsBytes HRegion onlineRegion regionServer getRegion encodedName onlineRegion LOG info region response htd regionServer tableDescriptors get region getTable regionServer encodedNameBytes LOG info region response LOG info region getRegionNameAsString HRegion warmupHRegion region htd regionServer getWAL region regionServer getConfiguration regionServer
tableCoprocessorsEnabled conf getBoolean USER_COPROCESSORS_ENABLED_CONF_KEY DEFAULT_USER_COPROCESSORS_ENABLED tableCoprocessorsEnabled List RegionCoprocessorEnvironment configured ArrayList attr conf region getTableDescriptor RegionCoprocessorEnvironment env load attr getPath attr getClassName attr getPriority attr getConf env configured add env LOG info attr getClassName region getTableDescriptor getTableName getNameAsString t conf getBoolean abortServer attr getClassName t
procId RemoteProcedureResult Builder builder RemoteProcedureResult newBuilder setProcId procId
builder RemoteProcedureResult result results poll result builder addResult result ReportProcedureDoneRequest request builder build server reportProcedureDone builder build builder clear tries e pause e ServerNotRunningYetException e PleaseHoldException pauseTime pause pauseTime ConnectionUtils getPauseTime INIT_PAUSE_TIME_MS tries
List request List String List Pair String familyPaths ArrayList request getFamilyPathCount el request familyPaths add Pair el getFamily toByteArray el getPath Token AuthenticationTokenIdentifier userToken userToken Token request getFsToken getIdentifier toByteArray request getFsToken getPassword toByteArray Text request getFsToken getKind Text request getFsToken getService String bulkToken request getBulkToken User user getActiveUser UserGroupInformation ugi user getUGI Token AuthenticationTokenIdentifier tok ClientTokenUtil obtainToken conn get tok b ugi addToken tok
ugi addToken targetFsToken ugi Path Path FileSystem fs fs FileSystem get conf el familyPaths Path stageFamily Path bulkToken Bytes toString el getFirst fs stageFamily fs mkdirs stageFamily fs setPermission stageFamily PERM_ALL_ACCESS fsCreatedListener fsCreatedListener accept region region bulkLoadHFiles familyPaths SecureBulkLoadListener fs bulkToken conf request getCopyFile clusterIds request getReplicate
group nonce nonce HConstants NO_NONCE NonceKey nk NonceKey group nonce OperationContext ctx OperationContext OperationContext oldResult nonces putIfAbsent nk ctx oldResult oldResult oldState oldResult getState
conf fs stop Thread threadToJoin Runnable fsShutdownHook suppressHdfsShutdownHook fs Thread t ShutdownHookThread conf stop threadToJoin fsShutdownHook ShutdownHookManager affixShutdownHook t
SplitLogWorkerCoordination splitLogWorkerCoordination server getCoordinatedStateManager server getCoordinatedStateManager getSplitLogWorkerCoordination filename splitLogWorkerCoordination server Status PREEMPTED iioe LOG warn filename iioe Status RESIGNED e e LOG warn filename e Status DONE Throwable cause e getCause e cause cause cause LOG warn filename e Status RESIGNED cause
LOG info server getServerName coordination registerListener res res coordination isStop res coordination isReady coordination isStop coordination taskLoop t t LOG info coordination isStop LOG error t coordination removeListener
TableName table parent getTable RegionInfo hri_a RegionInfoBuilder newBuilder table setStartKey parent getStartKey setEndKey midKey build RegionInfo hri_b RegionInfoBuilder newBuilder table setStartKey midKey setEndKey parent getEndKey build parent hri_a hri_b
keyIsAfterLast BloomType ROWCOL keyIsAfterLast CellComparator getInstance compare kvKey lastBloomKeyOnlyKV keyIsAfterLast Bytes BYTES_RAWCOMPARATOR compare key lastBloomKey BloomType ROWCOL Cell rowBloomKey PrivateCellUtil createFirstOnRow kvKey keyIsAfterLast CellComparator getInstance compare rowBloomKey lastBloomKeyOnlyKV exists exists bloomFilter contains kvKey bloom BloomType ROWCOL bloomFilter contains rowBloomKey bloom BloomType ROWCOL exists keyIsAfterLast bloomFilter contains key key length bloom exists
bloomFilterType IOException generalBloomFilter BloomFilterFactory createFromMeta bloomMeta reader LOG LOG trace bloomFilterType toString generalBloomFilter getClass getSimpleName reader getName blockType deleteFamilyBloomFilter DataInput bloomMeta reader getDeleteBloomFilterMetadata bloomMeta deleteFamilyBloomFilter BloomFilterFactory createFromMeta bloomMeta reader LOG info deleteFamilyBloomFilter getClass getSimpleName reader getName RuntimeException blockType toString IOException
generalBloomFilter BloomFilterFactory createFromMeta bloomMeta reader LOG LOG trace bloomFilterType toString generalBloomFilter getClass getSimpleName reader getName blockType deleteFamilyBloomFilter DataInput bloomMeta reader getDeleteBloomFilterMetadata bloomMeta deleteFamilyBloomFilter BloomFilterFactory createFromMeta bloomMeta reader LOG info deleteFamilyBloomFilter getClass getSimpleName reader getName RuntimeException blockType toString e LOG error blockType e setBloomFilterFaulty blockType
scanners selectScannersFrom store allScanners flushedstoreFileScanners clear memStoreScannersAfterFlush clear flushLock unlock seekScanners scanners lastTop parallelSeekEnabled i currentScanners i i currentScanners i scannersForDelayedClose add currentScanners remove i addCurrentScanners scanners resetKVHeap currentScanners store getComparator resetQueryMatcher lastTop store getComparator lastTop
left cell left cell left left String error Bytes toString left Bytes toString cell getRowArray cell getRowOffset cell getRowLength
right cell right cell right right String error Bytes toString right Bytes toString cell getRowArray cell getRowOffset cell getRowLength
leftSize lastLeftSize leftSize rightSize String errMsg String format leftIndex leftSize rightIndex rightSize debugDumpState errMsg LOG warn errMsg getSplitPointFromAllFiles ratio rightSize leftSize ratio ratio ratio ratio Optional of state stripeEndRows leftIndex isRightLarger rightSize leftSize newRatio isRightLarger getMidStripeSplitRatio leftSize rightSize lastRightSize getMidStripeSplitRatio rightSize leftSize lastLeftSize newRatio newRatio newRatio
HStoreFile HStoreFile stripe HStoreFile HStoreFile i i stripe i HStoreFile sf stripe get i sf fileTs sf getReader getMaxTimestamp fileTs sf
mw req createWriter StripeMultiFileWriter WriterFactory factory createWriterFactory cellsCount StoreScanner storeScanner scanner StoreScanner StoreScanner scanner mw init storeScanner factory performFlush scanner mw throughputController result mw commitWriters cacheFlushSeqNum success success mw leftoverFile mw store getFileSystem delete leftoverFile
filesToCompact mcTime getNextMajorCompactTime filesToCompact filesToCompact mcTime
lowTimestamp StoreUtils getLowestTimestamp filesToCompact now EnvironmentEdgeManager currentTime lowTimestamp lowTimestamp now mcTime LOG LOG debug lowTimestamp lowTimestamp now mcTime cfTTL storeConfigInfo getStoreFileTtl HDFSBlocksDistribution hdfsBlocksDistribution HDFSBlocksDistribution List Long boundaries getCompactBoundariesForMajor filesToCompact now filesInWindow boundaries size file filesToCompact OptionalLong minTimestamp file getMinimumTimestamp oldest minTimestamp isPresent now minTimestamp getAsLong Long MIN_VALUE cfTTL Long oldest cfTTL
lowTimestamp StoreUtils getLowestTimestamp filesToCompact now EnvironmentEdgeManager currentTime lowTimestamp lowTimestamp now mcTime LOG LOG debug lowTimestamp lowTimestamp now mcTime cfTTL storeConfigInfo getStoreFileTtl HDFSBlocksDistribution hdfsBlocksDistribution HDFSBlocksDistribution List Long boundaries getCompactBoundariesForMajor filesToCompact now filesInWindow boundaries size file filesToCompact OptionalLong minTimestamp file getMinimumTimestamp oldest minTimestamp isPresent now minTimestamp getAsLong Long MIN_VALUE cfTTL Long oldest cfTTL LOG debug
cfTTL storeConfigInfo getStoreFileTtl HDFSBlocksDistribution hdfsBlocksDistribution HDFSBlocksDistribution List Long boundaries getCompactBoundariesForMajor filesToCompact now filesInWindow boundaries size file filesToCompact OptionalLong minTimestamp file getMinimumTimestamp oldest minTimestamp isPresent now minTimestamp getAsLong Long MIN_VALUE cfTTL Long MAX_VALUE oldest cfTTL LOG debug file file LOG debug now lowTimestamp lowerWindowIndex Collections binarySearch boundaries minTimestamp orElse Long MAX_VALUE upperWindowIndex Collections binarySearch boundaries file getMaximumTimestamp orElse Long MAX_VALUE
List Long boundaries getCompactBoundariesForMajor filesToCompact now filesInWindow boundaries size file filesToCompact OptionalLong minTimestamp file getMinimumTimestamp oldest minTimestamp isPresent now minTimestamp getAsLong Long MIN_VALUE Long MAX_VALUE oldest LOG debug file file LOG debug now lowTimestamp lowerWindowIndex Collections binarySearch boundaries minTimestamp orElse Long MAX_VALUE upperWindowIndex Collections binarySearch boundaries file getMaximumTimestamp orElse Long MAX_VALUE lowerWindowIndex lowerWindowIndex Math abs lowerWindowIndex lowerWindowIndex upperWindowIndex upperWindowIndex Math abs upperWindowIndex upperWindowIndex
file file LOG debug now lowTimestamp lowerWindowIndex Collections binarySearch boundaries minTimestamp orElse Long MAX_VALUE upperWindowIndex Collections binarySearch boundaries file getMaximumTimestamp orElse Long MAX_VALUE lowerWindowIndex lowerWindowIndex Math abs lowerWindowIndex lowerWindowIndex upperWindowIndex upperWindowIndex Math abs upperWindowIndex upperWindowIndex lowerWindowIndex upperWindowIndex LOG debug file getPath upperWindowIndex LOG debug
LOG debug now lowTimestamp lowerWindowIndex Collections binarySearch boundaries minTimestamp orElse Long MAX_VALUE upperWindowIndex Collections binarySearch boundaries file getMaximumTimestamp orElse Long MAX_VALUE lowerWindowIndex lowerWindowIndex Math abs lowerWindowIndex lowerWindowIndex upperWindowIndex upperWindowIndex Math abs upperWindowIndex upperWindowIndex lowerWindowIndex upperWindowIndex LOG debug file getPath filesInWindow upperWindowIndex LOG debug filesInWindow upperWindowIndex hdfsBlocksDistribution add file getHDFSBlockDistribution
CompactionRequestImpl candidateSelection tryingMajor mayUseOffPeak mayBeStuck CompactionRequestImpl result tryingMajor selectMajorCompaction candidateSelection selectMinorCompaction candidateSelection mayUseOffPeak mayBeStuck
CompactionWindow window getIncomingWindow now minThreshold comConf getDateTieredIncomingWindowMin PeekingIterator Pair HStoreFile Long it Iterators peekingIterator storefileMaxTimestampPairs iterator it window compareToTimestamp compResult window compareToTimestamp it peek getSecond compResult window window nextEarlierWindow minThreshold comConf getMinFilesToCompact ArrayList HStoreFile fileList Lists newArrayList it window compareToTimestamp it peek getSecond fileList add it next getFirst fileList minThreshold
size getTotalStoreSize potentialMatchFiles size smallestSize smallest potentialMatchFiles smallestSize size size opts size potentialMatchFiles optsInRatio bestSelection bestSize potentialMatchFiles size bestSelection potentialMatchFiles bestSize size bestStart start
size smallestSize smallest potentialMatchFiles smallestSize size size opts size potentialMatchFiles optsInRatio bestSelection bestSize potentialMatchFiles size bestSelection potentialMatchFiles bestSize size bestStart start bestSelection LOG debug smallest size smallestSize
now String regionInfo storeConfigInfo storeConfigInfo HStore regionInfo HStore storeConfigInfo getRegionInfo getRegionNameAsString regionInfo toString cfTTL HConstants FOREVER storeConfigInfo cfTTL storeConfigInfo getStoreFileTtl filesToCompact HStoreFile sf filesToCompact iterator next OptionalLong minTimestamp sf getMinimumTimestamp oldest minTimestamp isPresent now minTimestamp getAsLong Long MIN_VALUE sf cfTTL Long oldest cfTTL blockLocalityIndex sf getHDFSBlockDistribution getBlockLocalityIndex DNS getHostname comConf conf DNS ServerType REGIONSERVER
regionInfo HStore storeConfigInfo getRegionInfo getRegionNameAsString regionInfo toString cfTTL HConstants FOREVER storeConfigInfo cfTTL storeConfigInfo getStoreFileTtl filesToCompact HStoreFile sf filesToCompact iterator next OptionalLong minTimestamp sf getMinimumTimestamp oldest minTimestamp isPresent now minTimestamp getAsLong Long MIN_VALUE sf cfTTL Long oldest cfTTL blockLocalityIndex sf getHDFSBlockDistribution getBlockLocalityIndex DNS getHostname comConf conf DNS ServerType REGIONSERVER blockLocalityIndex comConf getMinLocalityToForceCompact LOG debug regionInfo blockLocalityIndex comConf getMinLocalityToForceCompact result
regionInfo toString cfTTL HConstants FOREVER storeConfigInfo cfTTL storeConfigInfo getStoreFileTtl filesToCompact HStoreFile sf filesToCompact iterator next OptionalLong minTimestamp sf getMinimumTimestamp oldest minTimestamp isPresent now minTimestamp getAsLong Long MIN_VALUE sf cfTTL Long oldest cfTTL blockLocalityIndex sf getHDFSBlockDistribution getBlockLocalityIndex DNS getHostname comConf conf DNS ServerType REGIONSERVER blockLocalityIndex comConf getMinLocalityToForceCompact LOG debug regionInfo blockLocalityIndex comConf getMinLocalityToForceCompact result
cfTTL HConstants FOREVER storeConfigInfo cfTTL storeConfigInfo getStoreFileTtl filesToCompact HStoreFile sf filesToCompact iterator next OptionalLong minTimestamp sf getMinimumTimestamp oldest minTimestamp isPresent now minTimestamp getAsLong Long MIN_VALUE sf cfTTL Long oldest cfTTL blockLocalityIndex sf getHDFSBlockDistribution getBlockLocalityIndex DNS getHostname comConf conf DNS ServerType REGIONSERVER blockLocalityIndex comConf getMinLocalityToForceCompact LOG debug regionInfo blockLocalityIndex comConf getMinLocalityToForceCompact result LOG debug regionInfo oldest cfTTL blockLocalityIndex comConf getMinLocalityToForceCompact cfTTL HConstants FOREVER oldest cfTTL
start ratio comConf getCompactionRatio ratio comConf getCompactionRatioOffPeak LOG info ratio countOfFiles candidates size fileSizes countOfFiles sumSize countOfFiles i countOfFiles i i HStoreFile file candidates get i fileSizes i file getReader length tooFar i comConf getMaxFilesToCompact sumSize i fileSizes i i countOfFiles sumSize i tooFar countOfFiles fileSizes tooFar countOfFiles start comConf fileSizes start comConf sumSize start ratio start
HStoreFile candidateFiles HStoreFile filesCompacting ArrayList HStoreFile candidateSelection ArrayList candidateFiles futureFiles filesCompacting isEmpty mayBeStuck candidateFiles size filesCompacting size futureFiles storeConfigInfo getBlockingFileCount candidateSelection getCurrentEligibleFiles candidateSelection filesCompacting
candidates excess candidates size comConf getMaxFilesToCompact excess
SplitStripeCompactionRequest request SplitStripeCompactionRequest allFiles OPEN_KEY OPEN_KEY targetKvs request setMajorRangeFull request getRequest setAfterSplit request stripeCount si getStripeCount List HStoreFile l0Files si getLevel0Files shouldCompactL0 config getLevel0MinFiles l0Files size stripeCount shouldCompactL0 selectNewStripesCompaction si canDropDeletesNoL0 l0Files isEmpty shouldCompactL0 canDropDeletesNoL0 StripeCompactionRequest result selectSingleStripeCompaction si canDropDeletesNoL0 isOffpeak result result
bqSelection LOG debug List HStoreFile filesToCompact ArrayList bqSelection targetCount targetKvs Long MAX_VALUE hasAllFiles filesToCompact size stripes get bqIndex size String splitString hasAllFiles config Pair Long Integer kvsAndCount estimateTargetKvs filesToCompact config getSplitCount targetKvs kvsAndCount getFirst targetCount kvsAndCount getSecond splitString targetCount targetKvs
si List HStoreFile l0Files si getLevel0Files Pair Long Integer kvsAndCount estimateTargetKvs l0Files config getInitialCount
bestStart start bestLength length start length OUTER start start i length length bestLength bestStart start bestLength length bestLength bestLength bestStart stripes size bestLength
HRegionServer rs getServer String encodedName regionInfo getEncodedName encodedNameBytes regionInfo getEncodedNameAsBytes String regionName regionInfo getRegionNameAsString Region onlineRegion rs getRegion encodedName onlineRegion LOG warn regionName Boolean previous rs getRegionsInTransitionInRS putIfAbsent encodedNameBytes Boolean TRUE previous previous LOG info regionName backoff retryCounter getBackoffTimeAndIncrementAttempts
backoff retryCounter getBackoffTimeAndIncrementAttempts LOG info regionName backoff rs getExecutorService delayedSubmit backoff TimeUnit MILLISECONDS LOG info regionName HRegion region TableDescriptor htd tableDesc tableDesc rs getTableDescriptors get regionInfo getTable htd IOException regionName region HRegion openHRegion regionInfo htd rs getWAL regionInfo rs getConfiguration rs IOException e cleanUpAndReportFailure e
LOG info regionName HRegion region TableDescriptor htd tableDesc tableDesc rs getTableDescriptors get regionInfo getTable htd IOException regionName region HRegion openHRegion regionInfo htd rs getWAL regionInfo rs getConfiguration rs IOException e cleanUpAndReportFailure e rs postOpenDeployTasks PostOpenDeployContext region openProcId masterSystemTime rs addRegion region LOG info regionName rs finishRegionProcedure openProcId
LOG info regionName HRegion region TableDescriptor htd tableDesc tableDesc rs getTableDescriptors get regionInfo getTable htd IOException regionName region HRegion openHRegion regionInfo htd rs getWAL regionInfo rs getConfiguration rs IOException e cleanUpAndReportFailure e rs postOpenDeployTasks PostOpenDeployContext region openProcId masterSystemTime rs addRegion region LOG info regionName rs finishRegionProcedure openProcId Boolean current rs getRegionsInTransitionInRS remove regionInfo getEncodedNameAsBytes
region openRegion region region server rsServices rsServices addRegion region openSuccessful LOG debug regionName server getServerName openSuccessful doCleanUpOnFailedOpen region Boolean current rsServices getRegionsInTransitionInRS remove regionInfo getEncodedNameAsBytes
region openRegion region region server rsServices rsServices addRegion region openSuccessful LOG debug regionName server getServerName openSuccessful doCleanUpOnFailedOpen region Boolean current rsServices getRegionsInTransitionInRS remove regionInfo getEncodedNameAsBytes openSuccessful
Boolean previous rs getRegionsInTransitionInRS putIfAbsent encodedNameBytes Boolean FALSE previous previous backoff retryCounter getBackoffTimeAndIncrementAttempts LOG warn encodedName backoff rs getExecutorService delayedSubmit backoff TimeUnit MILLISECONDS LOG info encodedName HRegion region rs getRegion encodedName region LOG debug encodedName rs getRegionsInTransitionInRS remove encodedNameBytes Boolean FALSE String regionName region getRegionInfo getEncodedName
HRegion region rs getRegion encodedName region LOG debug encodedName rs getRegionsInTransitionInRS remove encodedNameBytes Boolean FALSE String regionName region getRegionInfo getEncodedName LOG info regionName region getCoprocessorHost region getCoprocessorHost preClose abort region abort LOG warn regionName rs getRegionsInTransitionInRS remove encodedNameBytes Boolean FALSE rs removeRegion region destination rs region getRegionInfo
startTime System currentTimeMillis Status status status splitTaskExecutor exec splitTaskDetails getWALFile reporter status coordination endTask SplitLogTask serverName SplitLogCounters splitTaskDetails SplitLogCounters LOG warn splitTaskDetails getWALFile coordination endTask SplitLogTask Err serverName SplitLogCounters tot_wkr_task_err splitTaskDetails
status splitTaskExecutor exec splitTaskDetails getWALFile reporter status coordination endTask SplitLogTask serverName SplitLogCounters splitTaskDetails SplitLogCounters LOG warn splitTaskDetails getWALFile coordination endTask SplitLogTask Err serverName SplitLogCounters tot_wkr_task_err splitTaskDetails LOG info splitTaskDetails toString coordination endTask SplitLogTask Resigned serverName SplitLogCounters tot_wkr_task_resigned splitTaskDetails
force String mode force
ActiveOperation operation activeOperations get opName operation totalSize size deltaSize operation totalSize operation lastControlSize deltaSize now EnvironmentEdgeManager currentTime minTimeAllowed deltaSize maxThroughputPerOperation elapsedTime now operation lastControlTime operation lastControlSize operation totalSize elapsedTime minTimeAllowed operation lastControlTime EnvironmentEdgeManager currentTime sleepTime minTimeAllowed elapsedTime now operation
operation totalSize size deltaSize operation totalSize operation lastControlSize deltaSize now EnvironmentEdgeManager currentTime minTimeAllowed deltaSize maxThroughputPerOperation elapsedTime now operation lastControlTime operation lastControlSize operation totalSize elapsedTime minTimeAllowed operation lastControlTime EnvironmentEdgeManager currentTime sleepTime minTimeAllowed elapsedTime LOG now operation LOG debug deltaSize elapsedTime
opName ActiveOperation operation activeOperations remove opName maxThroughputPerOperation getMaxThroughput activeOperations size elapsedTime EnvironmentEdgeManager currentTime operation startTime
oldPath newPath oldFileLen oldNumEntries numEntries getAndSet String newPathString newPath CommonFSUtils getPath newPath oldPath walFile2Props put oldPath WalProps sequenceIdAccounting resetHighest oldFileLen totalLogSize addAndGet oldFileLen
timeInNanos timeInNanos String msg StringBuilder append append TimeUnit NANOSECONDS toMillis timeInNanos append append Arrays toString getPipeline toString TraceUtil addTimelineAnnotation msg
result now EnvironmentEdgeManager currentTime elapsedTime now lastTimeCheckSlowSync elapsedTime elapsedTime
waitForSafePoint closeWriter writer writer closeExecutor shutdown closeExecutor
EOFException actualCells ex String posAfterStr posAfterStr inputStream getPos t LOG trace t String message expectedCells posBefore posAfterStr IOException realEofEx extractHiddenEof ex EOFException EOFException message initCause realEofEx realEofEx ex inputStream getPos walEditsStopOffset LOG error path inputStream getPos walEditsStopOffset EOFException EOFException
Key key String walKeyName conf get HConstants CRYPTO_WAL_KEY_NAME_CONF_KEY walKeyName key EncryptionUtil unwrapWALKey conf walKeyName keyBytes LOG LOG debug walKeyName key key String masterKeyName conf get HConstants CRYPTO_MASTERKEY_NAME_CONF_KEY User getCurrent getShortName key EncryptionUtil unwrapWALKey conf masterKeyName keyBytes LOG
WALEntryFilter scopeFilter getScopeWALEntryFilter scopeFilter filters add scopeFilter WALEntryFilter tableCfFilter getNamespaceTableCfWALEntryFilter tableCfFilter filters add tableCfFilter ctx ctx getPeerConfig String filterNameCSV ctx getPeerConfig getConfiguration get REPLICATION_WALENTRYFILTER_CONFIG_KEY filterNameCSV filterNameCSV String filterNames filterNameCSV split String filterName filterNames Class clazz Class forName filterName filters add WALEntryFilter clazz getDeclaredConstructor newInstance
files Set String hfileRefs hfileRefs rqs getAllHFileRefs LOG warn Collections emptyList files file file String hfile file getPath getName foundHFileRefInQueue hfileRefs contains hfile LOG foundHFileRefInQueue
Set String hfileRefs hfileRefs rqs getAllHFileRefs LOG warn Collections emptyList file file String hfile file getPath getName foundHFileRefInQueue hfileRefs contains hfile LOG foundHFileRefInQueue LOG debug hfile
Configuration Configuration sinkConf String replicationClusterId get replicationClusterId get replicationClusterId LOG info replicationClusterId Configuration sourceClusterConf Configuration String replicationConfDir sinkConf get HConstants REPLICATION_CONF_DIR replicationConfDir
get replicationClusterId get replicationClusterId LOG info replicationClusterId Configuration sourceClusterConf Configuration String replicationConfDir sinkConf get HConstants REPLICATION_CONF_DIR replicationConfDir LOG debug HConstants REPLICATION_CONF_DIR URL resource HBaseConfiguration getClassLoader getResource resource String path resource getPath replicationConfDir path substring path lastIndexOf replicationConfDir System getenv File confDir File replicationConfDir replicationClusterId
Configuration conf getConf Connection connection ConnectionFactory createConnection conf Admin admin connection getAdmin ZKWatcher zkw ZKWatcher conf System currentTimeMillis WarnOnlyAbortable
hasPathChanged Path newPath getReplSyncUpPath path newPaths add newPath List ServerName deadRegionServers replicationQueueInfo getDeadRegionServers LOG info deadRegionServers size Path walDir CommonFSUtils getWALRootDir conf ServerName curDeadServerName deadRegionServers Path deadRsDirectory Path walDir AbstractFSWALProvider getWALDirectoryName curDeadServerName getServerName Path locs Path Path deadRsDirectory path getName Path deadRsDirectory suffix AbstractFSWALProvider SPLITTING_EXT path getName Path possibleLogLocation locs LOG info possibleLogLocation toUri toString possibleLogLocation
newPaths add newPath List ServerName deadRegionServers replicationQueueInfo getDeadRegionServers LOG info deadRegionServers size Path walDir CommonFSUtils getWALRootDir conf ServerName curDeadServerName deadRegionServers Path deadRsDirectory Path walDir AbstractFSWALProvider getWALDirectoryName curDeadServerName getServerName Path locs Path Path deadRsDirectory path getName Path deadRsDirectory suffix AbstractFSWALProvider SPLITTING_EXT path getName Path possibleLogLocation locs LOG info possibleLogLocation toUri toString possibleLogLocation LOG info path possibleLogLocation newPaths add possibleLogLocation pathsLoop
Path Path FileStatus rss fs listStatus manager getLogDir FileStatus rs rss Path p rs getPath FileStatus logs fs listStatus p FileStatus log logs p Path p log getPath getName p getName getName
queueSizePerGroup conf getInt queueStorage queueStorage replicationPeer replicationPeer manager manager fs fs metrics metrics clusterId clusterId queueId queueId replicationQueueInfo ReplicationQueueInfo queueId logQueueWarnThreshold conf getInt defaultBandwidth conf getLong currentBandwidth getCurrentBandwidth throttler ReplicationThrottler currentBandwidth totalBufferUsed manager getTotalBufferUsed walFileLengthProvider walFileLengthProvider
String peerId replicationPeer getId Set String namespaces replicationPeer getNamespaces Map TableName List String tableCFMap replicationPeer getTableCFs tableCFMap List String tableCfs tableCFMap get tableName tableCFMap tableName tableCfs tableCfs Bytes toString family queueStorage addHFileRefs peerId pairs metrics incrSizeOfHFileRefsQueue pairs size LOG debug tableName Bytes toString family peerId namespaces namespaces tableName queueStorage addHFileRefs peerId pairs metrics incrSizeOfHFileRefsQueue pairs size
e RSRpcServices exitIfOOME e
peerBandwidth getCurrentBandwidth peerBandwidth currentBandwidth currentBandwidth peerBandwidth throttler setBandwidth currentBandwidth
initAndStartReplicationEndpoint replicationEndpoint replicationEndpoint replicationEndpoint e LOG warn logPeerId e replicationEndpoint stop sleepMultiplier sleepMultiplier sleepMultiplier UUID peerClusterId peerClusterId replicationEndpoint getPeerUUID
replicationEndpoint stop sleepForRetries sleepMultiplier sleepMultiplier sleepMultiplier UUID peerClusterId peerClusterId replicationEndpoint getPeerUUID peerClusterId LOG LOG debug logPeerId sleepForRetries sleepMultiplier sleepForRetries sleepMultiplier sleepMultiplier
LOG error logPeerId queueId reason cause sourceRunning initThread Thread initThread initThread interrupt Threads shutdown initThread sleepForRetries Collection ReplicationSourceShipper workers workerThreads values ReplicationSourceShipper worker workers worker stopWorker worker entryReader worker entryReader setReaderRunning ReplicationSourceShipper worker workers worker worker entryReader Thread sleep sleepForRetries
worker entryReader worker entryReader setReaderRunning worker worker worker entryReader Thread sleep sleepForRetries LOG info logPeerId worker getName Thread currentThread interrupt worker worker interrupt worker entryReader worker entryReader interrupt replicationEndpoint replicationEndpoint stop
String peerId String terminateMessage peerId ReplicationPeer peer replicationPeers getPeer peerId ReplicationSourceInterface src createSource peerId peer ReplicationSourceInterface toRemove sources put peerId src toRemove
String wals source LOG debug wals size wals source String peerId source getPeerId String remoteWALDir source getPeer getPeerConfig getRemoteWALDir List String remoteWals wals stream filter w SyncReplicationWALProvider getSyncReplicationPeerIdFromWALName w map peerId equals orElse collect Collectors toList
source abortAndThrowIOExceptionWhenFail queueStorage addWAL server getServerName source getQueueId logName Map String Map String NavigableSet String entry String peerId entry getKey Map String NavigableSet String walsByPrefix entry getValue existingPrefix Map String NavigableSet String walsEntry walsByPrefix SortedSet String wals walsEntry getValue wals clear walsEntry getKey wals add logName existingPrefix existingPrefix
replicateContext setWalGroupId walGroupId replicateContext setTimeout getAdaptiveTimeout shipEditsTimeout sleepMultiplier startTimeNs System nanoTime replicated source getReplicationEndpoint replicate replicateContext endTimeNs System nanoTime replicated sleepMultiplier Math max sleepMultiplier entry entries cleanUpHFileRefs entry getEdit LOG trace entry updateLogPosition entryBatch source postShipEdits entries sizeExcludeBulkLoad source getSourceMetrics shipBatch entryBatch getNbOperations currentSize entryBatch getNbHFiles
Threads sleep sleepForRetries WALEntryBatch batch readWALEntries entryStream currentPosition entryStream getPosition batch LOG debug batch getNbEntries entryBatchQueue put batch sleepMultiplier handleEmptyWALEntryBatch entryStream reset sleepMultiplier
WALEntryBatch batch readWALEntries entryStream currentPosition entryStream getPosition batch LOG debug batch getNbEntries entryBatchQueue put batch sleepMultiplier handleEmptyWALEntryBatch entryStream reset e sleepMultiplier LOG debug e sleepMultiplier
entry WALEdit edit entry getEdit edit edit
Entry Entry entry Entry filtered filter filter entry entry filtered filtered
entry row String encodedNameAsString Bytes toString entry getKey getEncodedRegionName seqId entry getKey getSequenceId ReplicationBarrierResult barrierResult MetaTableAccessor getReplicationBarrierResult conn entry getKey getTableName row entry getKey getEncodedRegionName
entry row String encodedNameAsString Bytes toString entry getKey getEncodedRegionName seqId entry getKey getSequenceId ReplicationBarrierResult barrierResult MetaTableAccessor getReplicationBarrierResult conn entry getKey getTableName row entry getKey getEncodedRegionName LOG debug entry barrierResult barriers barrierResult getBarriers index Arrays binarySearch barriers seqId index
ReplicationBarrierResult barrierResult MetaTableAccessor getReplicationBarrierResult conn entry getKey getTableName row entry getKey getEncodedRegionName LOG debug entry barrierResult barriers barrierResult getBarriers index Arrays binarySearch barriers seqId index LOG debug entry pushed getUnchecked encodedNameAsString setValue seqId index index index index index barrierResult
index Arrays binarySearch barriers seqId index LOG debug entry pushed getUnchecked encodedNameAsString setValue seqId index index index index index regionName regionName LOG debug Bytes toStringBinary regionName entry index
index index index index index regionName regionName LOG debug Bytes toStringBinary regionName entry index LOG debug entry LOG debug entry recordCanPush encodedNameAsString seqId barriers
index index regionName regionName LOG debug Bytes toStringBinary regionName entry index LOG debug entry LOG debug entry recordCanPush encodedNameAsString seqId barriers barriers index encodedNameAsString LOG debug entry
regionName regionName LOG debug Bytes toStringBinary regionName entry LOG debug entry LOG debug entry recordCanPush encodedNameAsString seqId barriers barriers encodedNameAsString LOG debug entry
firstCellInEdit row CellUtil cloneRow firstCellInEdit row
Entry readEntry reader next readerPos reader getPosition OptionalLong fileLength walFileLengthProvider getLogFileSizeIfBeingWritten currentPath fileLength readerPos fileLength
Path Path path Path walRootDir CommonFSUtils getWALRootDir conf Path oldLogDir Path walRootDir HConstants HREGION_OLDLOGDIR_NAME Path archivedLogLocation Path oldLogDir path getName archivedLogLocation
conf FileSystem dfs CommonFSUtils getWALFileSystem conf dfs conf
request GetRSGroupInfoResponse GetRSGroupInfoResponse Builder builder GetRSGroupInfoResponse newBuilder String groupName request getRSGroupName
request GetRSGroupInfoOfTableResponse GetRSGroupInfoOfTableResponse Builder builder GetRSGroupInfoOfTableResponse newBuilder TableName tableName ProtobufUtil toTableName request getTableName
AddRSGroupResponse AddRSGroupResponse Builder builder AddRSGroupResponse newBuilder
RemoveRSGroupResponse RemoveRSGroupResponse Builder builder RemoveRSGroupResponse newBuilder
BalanceRSGroupResponse BalanceRSGroupResponse Builder builder BalanceRSGroupResponse newBuilder
request GetRSGroupInfoOfServerResponse GetRSGroupInfoOfServerResponse Builder builder GetRSGroupInfoOfServerResponse newBuilder Address hp Address fromParts request getServer getHostName request getServer getPort
request String oldRSGroup request getOldRsgroupName String newRSGroup request getNewRsgroupName
ConstraintException RSGroupInfoManager getSimpleName Pair Map TableName Map ServerName List RegionInfo List RegionPlan correctedStateAndRegionPlans correctAssignments loadOfAllTable Map TableName Map ServerName List RegionInfo correctedLoadOfAllTable correctedStateAndRegionPlans getFirst List RegionPlan regionPlans correctedStateAndRegionPlans getSecond RSGroupInfo defaultInfo rsGroupInfoManager getRSGroup RSGroupInfo DEFAULT_GROUP RSGroupInfo rsGroupInfoManager Map TableName Map ServerName List RegionInfo loadOfTablesInGroup HashMap Map TableName Map ServerName List RegionInfo entry correctedLoadOfAllTable TableName tableName entry getKey RSGroupInfo targetRSGInfo RSGroupUtil getRSGroupInfo masterServices rsGroupInfoManager tableName orElse defaultInfo targetRSGInfo loadOfTablesInGroup put tableName entry getValue List RegionPlan groupPlans loadOfTablesInGroup
rsGroupInfoManager rsGroupInfoManager masterServices getRSGroupInfoManager rsGroupInfoManager String msg
Set Address Set Address srcGroup dstGroup RSGroupInfo src getRSGroupInfo srcGroup RSGroupInfo dst getRSGroupInfo dstGroup Set Address onlineServers dst getName equals RSGroupInfo DEFAULT_GROUP getOnlineServers Address el src removeServer el onlineServers onlineServers el
groupInfo getName SortedSet TableName failedTables TreeSet TableName tableName groupInfo LOG debug tableName groupInfo getName TableDescriptor oldTd oldTd tds get tableName e LOG warn tableName groupInfo getName e failedTables add tableName oldTd oldTd
e LOG warn tableName groupInfo getName e failedTables add tableName oldTd oldTd getRegionServerGroup LOG debug tableName oldTd getRegionServerGroup get TableDescriptor newTd TableDescriptorBuilder newBuilder oldTd setRegionServerGroup groupInfo getName build tds update newTd e LOG warn tableName groupInfo getName e failedTables add tableName
String groupName groupName String znode ZNodePaths joinZNode groupBasePath groupName zkOps add ZKUtil ZKUtilOp deleteNodeFailSilent znode RSGroupInfo gi gi getName RSGroupInfo String znode ZNodePaths joinZNode groupBasePath gi getName RSGroupProtos RSGroupInfo proto ProtobufUtil toProtoGroupInfo gi LOG debug znode ZKUtil createAndFailSilent watcher znode zkOps add ZKUtil ZKUtilOp deleteNodeFailSilent znode zkOps add ZKUtil ZKUtilOp createAndFailSilent znode ProtobufUtil prependPBMagic proto toByteArray LOG debug zkOps size ZKUtil multiOrSequential watcher zkOps
T Set T regionsOwners String T T String IOException hasRegionsToMove retry Set T allOwners HashSet regionsOwners Set String failedRegions HashSet IOException toThrow hasRegionsToMove T iter allOwners iter T owner iter next owner
retry Set T allOwners HashSet regionsOwners Set String failedRegions HashSet IOException toThrow hasRegionsToMove T iter allOwners iter T owner iter next region owner region LOG info region getShortNameToLog targetGroupName masterServices getAssignmentManager move region failedRegions remove region getRegionNameAsString IOException
T owner iter next region owner region LOG info region getShortNameToLog targetGroupName masterServices getAssignmentManager move region failedRegions remove region getRegionNameAsString ioe LOG debug region getShortNameToLog retry ioe toThrow ioe failedRegions add region getRegionNameAsString masterServices getAssignmentManager region hasRegionsToMove hasRegionsToMove
getRSGroupInfo groupName balancer masterServices Map String RegionState groupRIT rsGroupGetRegionsInTransition groupName groupRIT size LOG debug groupRIT size StringUtils abbreviate masterServices getAssignmentManager getRegionStates getRegionsInTransition toString serverManager LOG debug serverManager getDeadServers Map TableName Map ServerName List RegionInfo assignmentsByTable getRSGroupAssignmentsByTable masterServices getTableStateManager groupName List RegionPlan plans balancer balanceCluster assignmentsByTable balancerRan plans isEmpty balancerRan
masterServices Map String RegionState groupRIT rsGroupGetRegionsInTransition groupName groupRIT size LOG debug groupRIT size StringUtils abbreviate masterServices getAssignmentManager getRegionStates getRegionsInTransition toString serverManager LOG debug serverManager getDeadServers Map TableName Map ServerName List RegionInfo assignmentsByTable getRSGroupAssignmentsByTable masterServices getTableStateManager groupName List RegionPlan plans balancer balanceCluster assignmentsByTable balancerRan plans isEmpty balancerRan LOG info groupName plans size masterServices executeRegionPlansWithThrottling plans
RSGroupInfo srcGrp getRSGroupOfServer firstServer srcGrp ConstraintException firstServer RSGroupInfo srcGrp getName srcGrp servers ConstraintException KEEP_ONE_SERVER_IN_DEFAULT_ERROR_MESSAGE checkOnlineServersOnly servers server servers String tmpGroup getRSGroupOfServer server getName tmpGroup srcGrp getName ConstraintException srcGrp getName tmpGroup srcGrp servers td Optional String optGroupName td getRegionServerGroup optGroupName optGroupName srcGrp getName
Set entries TreeSet Bytes BYTES_RAWCOMPARATOR List Cell f List Cell cells f getValue Cell cell cells CellUtil cell PermissionStorage entries add CellUtil cloneRow cell Configuration conf regionEnv getConfiguration currentEntry t PermissionStorage entry entries currentEntry entry ListMultimap String UserPermission perms PermissionStorage getPermissions conf entry t serialized PermissionStorage writePermissionsAsBytes perms conf zkPermissionWatcher writeToZookeeper entry serialized
ctx Collection String paths ctx getEnvironment getConfiguration getStringCollection CP_COPROCESSOR_WHITELIST_PATHS_KEY paths p Path wlPath Path p Path wlPath
List UserPermission perms getUserPermissions conf rowKey UserPermission currentPerm UserPermission perm perms perm currentPerm perm currentPerm currentPerm getPermission getActions actionSet addAll Arrays asList currentPerm getPermission getActions actionSet addAll Arrays asList actions value actionSet size index action actionSet value index action code p add CellBuilderFactory create CellBuilderType SHALLOW_COPY setRow p getRow setFamily ACL_LIST_FAMILY setQualifier key setTimestamp p getTimestamp setType Type Put setValue value build
List UserPermission permsList getUserPermissions conf userPermissionRowKey userPerm getPermission List Permission Action remainingActions ArrayList List Permission Action dropActions Arrays asList userPerm getPermission getActions UserPermission perm permsList perm userPerm Permission Action oldAction perm getPermission getActions dropActions oldAction remainingActions add oldAction remainingActions perm getPermission setActions remainingActions toArray Permission Action remainingActions size addUserPermission conf perm t removePermissionRecord conf userPerm t
tableName Delete d Delete tableName getName d addFamily ACL_LIST_FAMILY
namespace Delete d Delete Bytes toBytes toNamespaceEntry namespace d addFamily ACL_LIST_FAMILY
entryName entryName ACL_GLOBAL_NAME ListMultimap String UserPermission perms ArrayListMultimap create Get get Get entryName get addFamily ACL_LIST_FAMILY Result row t table row table get get row t get get row perms parsePermissions entryName row cf cq user hasFilterUser
userPermission skipNamespaces skipTables start System currentTimeMillis handleGrantOrRevokeAcl userPermission HDFSAclOperation OperationType MODIFY skipNamespaces skipTables
userPermission skipNamespaces skipTables start System currentTimeMillis handleGrantOrRevokeAcl userPermission HDFSAclOperation OperationType REMOVE skipNamespaces skipTables
namespace removeUsers start System currentTimeMillis Path archiveNsDir pathHelper getArchiveNsDir namespace HDFSAclOperation operation HDFSAclOperation fs archiveNsDir removeUsers HDFSAclOperation OperationType REMOVE HDFSAclOperation AclType DEFAULT operation handleAcl
tableName removeUsers start System currentTimeMillis Path archiveTableDir pathHelper getArchiveTableDir tableName HDFSAclOperation operation HDFSAclOperation fs archiveTableDir removeUsers HDFSAclOperation OperationType REMOVE HDFSAclOperation AclType DEFAULT operation handleAcl
String String UserGroupInformation current UserGroupInformation getCurrentUser String fullName current getUserName
Configuration conf ServiceLoader SaslServerAuthenticationProvider loader ServiceLoader load SaslServerAuthenticationProvider HashMap Byte SaslServerAuthenticationProvider providers HashMap SaslServerAuthenticationProvider provider loader addProviderIfNotExists provider providers addExtraProviders conf providers LOG String loadedProviders providers values stream map provider provider getClass getName collect Collectors joining loadedProviders loadedProviders LOG trace loadedProviders providers provider provider init Configuration conf
String path ZKUtil path String keyId ZKUtil getNodeName path Integer id Integer valueOf keyId secretManager removeKey id
path ZKUtil path data ZKUtil getDataAndWatch watcher path data data
ZKUtil ZKUtil n String path n getNode String keyId ZKUtil getNodeName path data n getData data data
labels OperationStatus opStatus visibilityLabelService addLabels labels logResult labels i OperationStatus status opStatus response i i status RegionActionResult Builder failureResultBuilder RegionActionResult newBuilder failureResultBuilder setException buildException DoNotRetryIOException status getExceptionMsg response setResult i failureResultBuilder build i e logResult e getMessage labels LOG error e
checkCallingUserAuth authBS labelAuths add authBS toByteArray OperationStatus opStatus visibilityLabelService setAuths user labelAuths logResult user labelAuths RegionActionResult successResult RegionActionResult newBuilder build OperationStatus status opStatus status response addResult successResult RegionActionResult Builder failureResultBuilder RegionActionResult newBuilder failureResultBuilder setException buildException DoNotRetryIOException status getExceptionMsg response addResult failureResultBuilder build
authBS labelAuths add authBS toByteArray OperationStatus opStatus visibilityLabelService setAuths user labelAuths logResult user labelAuths RegionActionResult successResult RegionActionResult newBuilder build OperationStatus status opStatus status response addResult successResult RegionActionResult Builder failureResultBuilder RegionActionResult newBuilder failureResultBuilder setException buildException DoNotRetryIOException status getExceptionMsg response addResult failureResultBuilder build e logResult e getMessage user labelAuths LOG error e
checkCallingUserAuth authBS labelAuths add authBS toByteArray OperationStatus opStatus visibilityLabelService clearAuths requestUser labelAuths logResult requestUser labelAuths RegionActionResult successResult RegionActionResult newBuilder build OperationStatus status opStatus status response addResult successResult RegionActionResult Builder failureResultBuilder RegionActionResult newBuilder failureResultBuilder setException buildException DoNotRetryIOException status getExceptionMsg response addResult failureResultBuilder build
authBS labelAuths add authBS toByteArray OperationStatus opStatus visibilityLabelService clearAuths requestUser labelAuths logResult requestUser labelAuths RegionActionResult successResult RegionActionResult newBuilder build OperationStatus status opStatus status response addResult successResult RegionActionResult Builder failureResultBuilder RegionActionResult newBuilder failureResultBuilder setException buildException DoNotRetryIOException status getExceptionMsg response addResult failureResultBuilder build e logResult e getMessage requestUser labelAuths LOG error e
cell getValue deleteMvcc tail firstKey SortedMap Long SortedSet Long subMap node mvccCountingMap subMap cell getSequenceId Math min duplicateMvcc deleteMvcc Long SortedSet Long seg subMap seg getValue DeleteResult VERSION_MASKED seg getValue add cell getSequenceId deleteMvcc Long DeleteResult VERSION_DELETED cell node cell node DeleteResult COLUMN_DELETED duplicateMvcc Long DeleteResult VERSION_MASKED
List Entry newEntries ArrayList entries size Entry entry entries WALEdit newEdit WALEdit ArrayList Cell cells entry getEdit getCells Cell cell cells cell visTags clear nonVisTags clear Byte serializationFormat VisibilityUtils extractAndPartitionTags cell visTags nonVisTags visTags modifiedVisExpression visibilityLabelsService encodeVisibilityForReplication visTags serializationFormat modifiedVisExpression nonVisTags add ArrayBackedTag TagType STRING_VIS_TAG_TYPE modifiedVisExpression
List RegionInfo mobRegions ArrayList mobRegions add mobRegion restoreHdfsMobRegions exec regionManifests mobRegions regionNames remove mobRegion getEncodedName status setStatus regionNames mobRegion getEncodedName monitor rethrowException status setStatus cloneHdfsMobRegion regionManifests mobRegion regionNames remove mobRegion getEncodedName status setStatus monitor rethrowException RegionInfo regionInfo String regionName regionInfo getEncodedName
status setStatus regionNames mobRegion getEncodedName monitor rethrowException status setStatus cloneHdfsMobRegion regionManifests mobRegion regionNames remove mobRegion getEncodedName status setStatus monitor rethrowException regionInfo String regionName regionInfo getEncodedName regionNames regionName LOG info regionName regionNames remove regionName metaChanges addRegionToRestore ProtobufUtil toRegionInfo regionManifests get regionName getRegionInfo
cloneHdfsMobRegion regionManifests mobRegion regionNames remove mobRegion getEncodedName status setStatus monitor rethrowException RegionInfo regionInfo String regionName regionInfo getEncodedName regionNames regionName LOG info regionName regionNames remove regionName metaChanges addRegionToRestore ProtobufUtil toRegionInfo regionManifests get regionName getRegionInfo LOG info regionName metaChanges addRegionToRemove regionInfo List RegionInfo regionsToAdd ArrayList regionNames size
family Bytes toBytes familyDir getName Set String familyFiles getTableRegionFamilyFiles familyDir List SnapshotRegionManifest StoreFile snapshotFamilyFiles snapshotFiles remove familyDir getName snapshotFamilyFiles List SnapshotRegionManifest StoreFile hfilesToAdd ArrayList SnapshotRegionManifest StoreFile storeFile snapshotFamilyFiles familyFiles storeFile getName familyFiles remove storeFile getName hfilesToAdd add storeFile String hfileName familyFiles Path hfile Path familyDir hfileName LOG trace hfileName snapshotName regionInfo getEncodedName tableName HFileArchiver archiveStoreFile conf fs regionInfo tableDir family hfile SnapshotRegionManifest StoreFile storeFile hfilesToAdd
RegionInfo Map String RegionInfo regions regions regions isEmpty Map String RegionInfo snapshotRegions HashMap regions size String snapshotName snapshotDesc getName RegionInfo clonedRegionsInfo RegionInfo regions size i i clonedRegionsInfo i RegionInfo snapshotRegionInfo regions get i clonedRegionsInfo i cloneRegionInfo snapshotRegionInfo String snapshotRegionName snapshotRegionInfo getEncodedName String clonedRegionName clonedRegionsInfo i getEncodedName regionsMap put Bytes toBytes snapshotRegionName Bytes toBytes clonedRegionName
Path regionDir String tableName tableDesc getTableName getNameAsString String snapshotName snapshotDesc getName familyFiles Path familyDir Path regionDir familyFiles getFamilyName toStringUtf8 familyFiles
storeFile Reference reference Reference convert storeFile getReference reference write fs outPath InputStream in linkPath in HFileLink buildFromHFileLinkPattern conf linkPath open fs linkPath Path Path HRegion getRegionDir snapshotManifest getSnapshotDir regionInfo getEncodedName familyDir getName hfileName in fs open linkPath OutputStream out fs create outPath IOUtils copyBytes in out conf String regionName Bytes toString regionsMap get regionInfo getEncodedNameAsBytes regionName regionName regionInfo getEncodedName
String snapshotName desc getName
String snapshotName desc getName LOG debug regionInfo snapshotName Object regionData visitor regionOpen regionInfo monitor rethrowException LOG debug Path mobRegionPath MobUtils getMobRegionPath conf regionInfo getTable hcd hcd Object familyData visitor familyOpen regionData hcd getName monitor rethrowException Path storePath MobUtils getMobFamilyPath mobRegionPath hcd getNameAsString List StoreFileInfo storeFiles getStoreFiles storePath storeFiles LOG
String snapshotName desc getName
region visitor String snapshotName desc getName LOG debug region snapshotName Object regionData visitor regionOpen region getRegionInfo monitor rethrowException LOG debug store region Object familyData visitor familyOpen regionData store getColumnFamilyDescriptor getName monitor rethrowException List HStoreFile storeFiles ArrayList store getStorefiles LOG
region visitor String snapshotName desc getName LOG debug region snapshotName Object regionData visitor regionOpen region getRegionInfo monitor rethrowException LOG debug store region Object familyData visitor familyOpen regionData store getColumnFamilyDescriptor getName monitor rethrowException List HStoreFile storeFiles ArrayList store getStorefiles LOG LOG debug storeFiles i storeFiles i i HStoreFile storeFile storeFiles get i monitor rethrowException
baseDir CommonFSUtils getTableDir MobUtils getMobHome conf regionInfo getTable HRegionFileSystem regionFs HRegionFileSystem openRegionFromFileSystem conf rootFs baseDir regionInfo monitor rethrowException LOG debug Object regionData visitor regionOpen regionInfo monitor rethrowException LOG debug Collection String familyNames regionFs getFamilies familyNames String familyName familyNames Object familyData visitor familyOpen regionData Bytes toBytes familyName monitor rethrowException Collection StoreFileInfo storeFiles regionFs getStoreFiles familyName storeFiles LOG
isMob String fileType isMob
fs snapshotDir FileStatus regions CommonFSUtils listStatus fs snapshotDir FSUtils RegionDirFilter fs regions
SnapshotRegionManifest conf fs tableDir regionInfo HRegionFileSystem regionFs HRegionFileSystem openRegionFromFileSystem conf fs tableDir regionInfo SnapshotRegionManifest Builder manifest SnapshotRegionManifest newBuilder LOG debug manifest setRegionInfo ProtobufUtil toRegionInfo regionInfo LOG debug Collection String familyNames regionFs getFamilies familyNames String familyName familyNames Collection StoreFileInfo storeFiles regionFs getStoreFiles familyName storeFiles
HRegionFileSystem regionFs HRegionFileSystem openRegionFromFileSystem conf fs tableDir regionInfo SnapshotRegionManifest Builder manifest SnapshotRegionManifest newBuilder LOG debug manifest setRegionInfo ProtobufUtil toRegionInfo regionInfo LOG debug Collection String familyNames regionFs getFamilies familyNames String familyName familyNames Collection StoreFileInfo storeFiles regionFs getStoreFiles familyName storeFiles LOG debug familyName SnapshotRegionManifest FamilyFiles Builder family SnapshotRegionManifest FamilyFiles newBuilder family setFamilyName UnsafeByteOperations unsafeWrap Bytes toBytes familyName LOG
conf fs snapshotDir desc SnapshotManifest manifest SnapshotManifest open conf fs snapshotDir desc List SnapshotRegionManifest regionManifests manifest getRegionManifests regionManifests regionManifests
manifest Path snapshotDir manifest getSnapshotDir List SnapshotRegionManifest regionManifests manifest getRegionManifests regionManifests regionManifests
manifest SnapshotDescription snapshotDesc manifest getSnapshotDescription Path snapshotDir manifest getSnapshotDir List SnapshotRegionManifest regionManifests manifest getRegionManifests regionManifests regionManifests
linkPath Path family refPath getName HFileLink fileName linkPath Path family fileName linkPath Path family HFileLink createHFileLinkName table regionInfo getEncodedName fileName HFileLink link MobUtils regionInfo link HFileLink buildFromHFileLinkPattern MobUtils getQualifiedMobRootDir conf HFileArchiveUtil getArchivePath conf linkPath link HFileLink buildFromHFileLinkPattern conf linkPath FileStatus fstat link getFileStatus fs storeFile storeFile getFileSize fstat getLen String msg fileName fstat getLen storeFile getFileSize LOG error msg
tableDesc queue Set String familyNames Arrays stream tableDesc getColumnFamilies map ColumnFamilyDescriptor getNameAsString collect Collectors toSet List String unmatchedFamilies queue stream map item Bytes toString item getFamily filter fn familyNames contains fn distinct collect Collectors toList unmatchedFamilies String msg unmatchedFamilies tableDesc getTableName familyNames
CompletableFuture Collection LoadQueueItem Collection LoadQueueItem lqis List Pair String familyPaths lqis stream map lqi Pair newPair lqi getFamily lqi getFilePath toString collect Collectors toList CompletableFuture Collection LoadQueueItem future CompletableFuture familyPaths
loadingFutures add tryAtomicRegionLoad conn tableName copyFiles first lqis item2RegionMap LoadQueueItem lqi lqis item2RegionMap put lqi entry getKey Collection LoadQueueItem future loadingFutures Collection LoadQueueItem toRetry future get item2RegionMap LoadQueueItem lqi toRetry item2RegionMap remove lqi queue addAll toRetry e1 Throwable t e1 getCause t IOException IOException t
item2RegionMap LoadQueueItem lqi item2RegionMap put lqi entry getKey Collection LoadQueueItem future Collection LoadQueueItem toRetry future get item2RegionMap LoadQueueItem lqi toRetry item2RegionMap remove lqi queue addAll toRetry e1 Throwable t e1 getCause t IOException IOException t LOG error e1
Map Map MutableInt filesMap TreeMap Bytes BYTES_COMPARATOR lqi MutableInt count filesMap computeIfAbsent lqi getFamily k MutableInt count increment count
queue LoadQueueItem item queue remove Callable Pair List LoadQueueItem String call groupOrSplit conn tableName regionGroups item startEndKeys splittingFutures add pool submit call Pair List LoadQueueItem String lqis splittingFutures Pair List LoadQueueItem String splits lqis get splits splits getFirst queue addAll splits getFirst missingHFiles add splits getSecond e1 Throwable t e1 getCause t
Pair List LoadQueueItem String lqis Pair List LoadQueueItem String splits lqis get splits splits getFirst queue addAll splits getFirst missingHFiles add splits getSecond e1 Throwable t e1 getCause t IOException LOG error e1 IOException t LOG error e1 IllegalStateException t
Path botOut Path tmpDir uniqueName Path topOut Path tmpDir uniqueName splitStoreFile getConf hfilePath familyDesc splitKey botOut topOut FileSystem fs tmpDir getFileSystem getConf fs setPermission tmpDir FsPermission valueOf fs setPermission botOut FsPermission valueOf fs setPermission topOut FsPermission valueOf List LoadQueueItem lqis ArrayList lqis add LoadQueueItem family botOut lqis add LoadQueueItem family topOut tmpDir fs delete hfilePath LOG warn hfilePath
List ColumnFamilyDescriptorBuilder familyBuilders ArrayList SortedMap Integer map TreeMap Bytes BYTES_COMPARATOR ColumnFamilyDescriptorBuilder ColumnFamilyDescriptorBuilder familyName ColumnFamilyDescriptorBuilder builder ColumnFamilyDescriptorBuilder newBuilder familyName familyBuilders add builder builder ColumnFamilyDescriptorBuilder builder hfileStatus Path hfile hfileStatus getPath reader hfile builder reader getFileContext getCompression builder setCompressionType reader getFileContext getCompression LOG info reader getFileContext getCompression name builder getNameAsString first reader getFirstRowKey get last reader getLastRowKey get
reader hfile builder reader getFileContext getCompression builder setCompressionType reader getFileContext getCompression LOG info reader getFileContext getCompression name builder getNameAsString first reader getFirstRowKey get last reader getLastRowKey get LOG info hfile Bytes toStringBinary first Bytes toStringBinary last Integer value map getOrDefault first map put first value value map containsKey last map get last map put last value keys inferBoundaries map TableDescriptorBuilder tdBuilder TableDescriptorBuilder newBuilder tableName familyBuilders stream map ColumnFamilyDescriptorBuilder build forEachOrdered tdBuilder setColumnFamily
Map LoadQueueItem ByteBuffer conn tableName LoadQueueItem queue count fsDelegationToken acquireDelegationToken queue peek getFilePath getFileSystem getConf bulkToken FutureUtils get conn prepareBulkLoad tableName Pair Multimap ByteBuffer LoadQueueItem Set String pair Map LoadQueueItem ByteBuffer item2RegionMap HashMap queue List Pair startEndKeys FutureUtils get conn getRegionLocator tableName getStartEndKeys count
tn String errorMsg format tn
port conf getInt HBASE_CANARY_INFO_PORT port LOG info LOG info String addr conf get HBASE_CANARY_INFO_BINDADDRESS InfoServer infoServer InfoServer addr port conf infoServer addUnprivilegedServlet CanaryStatusServlet infoServer setAttribute sink infoServer start
monitor newMonitor connection monitorTargets monitorThread Thread monitor System currentTimeMillis startTime System currentTimeMillis monitorThread start monitor Thread sleep monitor monitorThread interrupt monitor monitor errorCode INIT_ERROR_EXIT_CODE currentTimeLength System currentTimeMillis startTime
Configuration conf HBaseConfiguration create numThreads conf getInt MAX_THREADS_NUM
conf FileSystem fileSystem CommonFSUtils getCurrentFileSystem conf ExecutorService threadPool createThreadPool conf HFileCorruptionChecker checker checker HFileCorruptionChecker conf threadPool Path rootDir CommonFSUtils getRootDir conf
conf FileSystem fileSystem CommonFSUtils getCurrentFileSystem conf ExecutorService threadPool createThreadPool conf HFileCorruptionChecker checker checker HFileCorruptionChecker conf threadPool Path rootDir CommonFSUtils getRootDir conf LOG info rootDir Collection Path tableDirs FSUtils getTableDirs fileSystem rootDir checker checkTables tableDirs Path archiveRootDir Path rootDir HConstants HFILE_ARCHIVE_DIRECTORY
Collection Path tableDirs FSUtils getTableDirs fileSystem rootDir checker checkTables tableDirs Path archiveRootDir Path rootDir HConstants HFILE_ARCHIVE_DIRECTORY LOG info archiveRootDir List Path archiveTableDirs FSUtils getTableDirs fileSystem archiveRootDir checker checkTables archiveTableDirs threadPool shutdown threadPool awaitTermination Long MAX_VALUE TimeUnit SECONDS Thread currentThread interrupt checkedFiles checker getHFilesChecked Collection Path corrupted checker getCorrupted corrupted
List Path archiveTableDirs FSUtils getTableDirs fileSystem archiveRootDir checker checkTables archiveTableDirs threadPool shutdown threadPool awaitTermination Long MAX_VALUE TimeUnit SECONDS Thread currentThread interrupt checkedFiles checker getHFilesChecked Collection Path corrupted checker getCorrupted corrupted LOG info checkedFiles LOG info
threadPool shutdown threadPool awaitTermination Long MAX_VALUE TimeUnit SECONDS Thread currentThread interrupt checkedFiles checker getHFilesChecked Collection Path corrupted checker getCorrupted corrupted LOG info checkedFiles LOG info LOG info checkedFiles corrupted size Path corrupted
org apache hadoop fs Path Path tempPath Files createTempFile org apache hadoop fs Path destination org apache hadoop fs Path tempPath toString
admin pattern List List TableDescriptor tableDescriptors admin listTableDescriptors pattern TableDescriptor tableDescriptors
String regionCoprocessors getConf getStrings CoprocessorHost REGION_COPROCESSOR_CONF_KEY regionCoprocessors validateClasses classLoader regionCoprocessors violations error violation violations String className violation getClassName String message violation getMessage Throwable throwable violation getThrowable violation throwable LOG warn className message LOG warn className message throwable error
regionCoprocessors validateClasses classLoader regionCoprocessors violations error violation violations String className violation getClassName String message violation getMessage Throwable throwable violation getThrowable violation throwable LOG warn className message LOG warn className message throwable error
FileStatus fs Path dir FileStatus status CommonFSUtils listStatus fs dir TABLEINFO_PATHFILTER status status FileStatus mostCurrent FileStatus file status mostCurrent file mostCurrent mostCurrent file status FileStatus file status Path path file getPath file mostCurrent fs file getPath LOG warn path
fs Path dir FileStatus status CommonFSUtils listStatus fs dir TABLEINFO_PATHFILTER FileStatus file status Path path file getPath sequenceId getTableInfoSequenceId path sequenceId success CommonFSUtils delete fs path success
Path Path tableDir currentDescriptorFile Path tmpTableDir Path tableDir TMP_DIR Path tableInfoDir Path tableDir TABLEINFO_DIR currentSequenceId currentDescriptorFile getTableInfoSequenceId currentDescriptorFile getPath newSequenceId currentSequenceId retries retrymax currentSequenceId retries Path tableInfoDirPath newSequenceId String filename getTableInfoFileName newSequenceId Path tempPath Path tmpTableDir filename tempPath
newSequenceId String filename getTableInfoFileName newSequenceId Path tempPath Path tmpTableDir filename fs tempPath LOG debug tempPath retries tableInfoDirPath Path tableInfoDir filename writeTD fs tempPath htd fs mkdirs tableInfoDirPath getParent fs tempPath tableInfoDirPath IOException tempPath tableInfoDirPath LOG debug tableInfoDirPath IOException
fs tableDir FileStatus status getTableInfoPath fs tableDir status
FSDataOutputStream s fs create tempVersionFile s write toVersionByteArray version s close s fs tempVersionFile versionFile IOException versionFile s s close IOException LOG info rootdir toString version IOException
Path rootdir Path idFile Path rootdir HConstants CLUSTER_ID_FILE_NAME Path tempDir Path rootdir HConstants HBASE_TEMP_DIRECTORY Path tempIdFile Path tempDir HConstants CLUSTER_ID_FILE_NAME
Path rootdir clusterId IOException Path idFile Path rootdir HConstants CLUSTER_ID_FILE_NAME Path tempDir Path rootdir HConstants HBASE_TEMP_DIRECTORY Path tempIdFile Path tempDir HConstants CLUSTER_ID_FILE_NAME LOG debug idFile clusterId Optional IOException failure Optional empty
LOG warn dd FileStatus familyDir progressReporter progressReporter progress familyDir Path family familyDir getPath family FileStatus familyStatus fs listStatus family FileStatus sfStatus familyStatus progressReporter progressReporter progress sfStatus Path sf sfStatus getPath sf
progressReporter progressReporter progress sfStatus Path sf sfStatus getPath sf regionStoreFileMap put sf getName sf finalResultMap putAll regionStoreFileMap e LOG error dd e exceptions add e executor Future future executor submit getRegionStoreFileMapCall futures add future FutureTask future FutureTask getRegionStoreFileMapCall
Path sf sfStatus getPath sf regionStoreFileMap put sf getName sf finalResultMap putAll regionStoreFileMap e LOG error dd e exceptions add e executor Future future executor submit getRegionStoreFileMapCall futures add future FutureTask future FutureTask getRegionStoreFileMapCall future run futures add future
pathFilter Path path path Path parent path getParent parent String regionName path getName regionName regionName FileStatus statusList fs globStatus queryPath pathFilter
Pair Path FSDataOutputStream pair checkAndMarkRunningHbck getConf lockFileRetryCounterFactory create HBCK_LOCK_PATH pair getFirst hbckOutFd pair getSecond hbckOutFd setRetCode
LOG warn hfile hf hf close orphanRegionRange orphanRegionRange Pair start end orphanRegionRange start orphanRegionRange setFirst start orphanRegionRange end orphanRegionRange setSecond end orphanRegionRange LOG warn p fixes
LOG info Path path Path referredToFile StoreFileInfo getReferredToFile path fs exists referredToFile errors reportError ERROR_CODE LINGERING_REFERENCE_HFILE path shouldFixReferenceFiles success String pathStr path toString index pathStr lastIndexOf Path SEPARATOR_CHAR index index pathStr lastIndexOf Path SEPARATOR_CHAR index index Path rootDir getSidelineDir Path dst Path rootDir pathStr substring index fs mkdirs dst getParent
shouldFixReferenceFiles success String pathStr path toString index pathStr lastIndexOf Path SEPARATOR_CHAR index index pathStr lastIndexOf Path SEPARATOR_CHAR index index Path rootDir getSidelineDir Path dst Path rootDir pathStr substring index fs mkdirs dst getParent LOG info path dst setShouldRerun success fs rename path dst debugLsr dst success
Configuration conf getConf Path hbaseRoot CommonFSUtils getRootDir conf FileSystem fs hbaseRoot getFileSystem conf LOG info Map String Path allFiles FSUtils getTableStoreFilePathMap fs hbaseRoot FSUtils HFileLinkFilter executor errors errors print LOG info Path path allFiles HFileLink actualLink HFileLink buildFromHFileLinkPattern conf path actualLink exists fs errors reportError ERROR_CODE LINGERING_HFILELINK path shouldFixHFileLinks setShouldRerun success sidelineFile fs hbaseRoot path success
Map String Path allFiles FSUtils getTableStoreFilePathMap fs hbaseRoot FSUtils HFileLinkFilter executor errors errors print LOG info Path path allFiles HFileLink actualLink HFileLink buildFromHFileLinkPattern conf path actualLink exists fs errors reportError ERROR_CODE LINGERING_HFILELINK path shouldFixHFileLinks setShouldRerun success sidelineFile fs hbaseRoot path success LOG error path Path backRefPath FileLink getBackReferencesDir HFileArchiveUtil getStoreArchivePath conf HFileLink getReferencedTableName path getName toString HFileLink getReferencedRegionName path getName toString path getParent getName HFileLink getReferencedHFileName path getName toString success sidelineFile fs hbaseRoot backRefPath success
fs Path hbaseRoot Path path URI uri hbaseRoot toUri relativize path toUri uri isAbsolute String relativePath uri getPath Path rootDir getSidelineDir Path dst Path rootDir relativePath pathCreated fs mkdirs dst getParent pathCreated
orphanTableDirs List TableName tmpList ArrayList orphanTableDirs keySet size tmpList addAll orphanTableDirs keySet TableDescriptor htds getTableDescriptors tmpList Iterator Entry TableName Set String iter orphanTableDirs entrySet iterator j numFailedCase FSTableDescriptors fstd FSTableDescriptors getConf iter Entry TableName Set String entry iter next TableName tableName entry getKey
orphanTableDirs List TableName tmpList ArrayList orphanTableDirs keySet size tmpList addAll orphanTableDirs keySet TableDescriptor htds getTableDescriptors tmpList Iterator Entry TableName Set String iter orphanTableDirs entrySet iterator j numFailedCase FSTableDescriptors fstd FSTableDescriptors getConf iter Entry TableName Set String entry iter next TableName tableName entry getKey LOG info tableName j htds tableName htds j TableDescriptor htd htds j
TableName tableName entry getKey LOG info tableName j htds tableName htds j TableDescriptor htd htds j LOG info tableName fstd createTableDescriptor htd j iter remove fstd tableName entry LOG warn tableName LOG warn tableName iter remove
j iter remove tableName LOG warn tableName LOG warn tableName iter remove LOG error tableName numFailedCase fixes setShouldRerun LOG warn numFailedCase
Path sidelineRegionDir fs parentDir hi TableName tableName hi getTableName Path regionDir hi getHdfsRegionDir fs regionDir LOG warn regionDir Path rootDir getSidelineDir parentDir rootDir Path rootDir parentDir Path sidelineTableDir CommonFSUtils getTableDir rootDir tableName Path sidelineRegionDir Path sidelineTableDir regionDir getName fs mkdirs sidelineRegionDir success FileStatus cfs fs listStatus regionDir cfs
fs mkdirs sidelineRegionDir success FileStatus cfs fs listStatus regionDir cfs LOG info regionDir FileStatus cf cfs Path src cf getPath Path dst Path sidelineRegionDir src getName fs src success fs rename src dst success String msg src dst LOG error msg IOException msg
FileStatus cf Path src cf getPath Path dst Path sidelineRegionDir src getName fs src success fs rename src dst success String msg src dst LOG error msg IOException msg fs mkdirs dst LOG info src dst FileStatus hfiles fs listStatus src hfiles hfiles FileStatus hfiles
IOException msg fs mkdirs dst LOG info src dst FileStatus hfiles fs listStatus src hfiles hfiles FileStatus hfile hfiles success fs rename hfile getPath dst success String msg src dst LOG error msg IOException msg LOG debug debugLsr sidelineRegionDir LOG info regionDir
FileSystem fs rootDir getFileSystem getConf List FileStatus tableDirs Lists newArrayList foundVersionFile fs exists Path rootDir HConstants VERSION_FILE_NAME List Path paths FSUtils getTableDirs fs rootDir Path path paths TableName tableName CommonFSUtils getTableName path tableName tableName TableName tableDirs add fs getFileStatus path foundVersionFile errors reportError ERROR_CODE NO_VERSION_FILE rootDir LOG info HConstants VERSION_FILE_NAME setShouldRerun FSUtils setVersion fs rootDir getConf getInt HConstants THREAD_WAKE_FREQUENCY getConf getInt HConstants VERSION_FILE_WRITE_ATTEMPTS HConstants DEFAULT_VERSION_FILE_WRITE_ATTEMPTS FileStatus tableDirs
metaKey Delete d Delete metaKey meta delete d
fileMoves String thread Thread currentThread getName
sidelineRegionDir fs contained fileMoves fs contained getHdfsRegionDir LOG warn thread contained getHdfsRegionDir sidelineRegionDir fs contained fileMoves cf Path src cf getPath Path dst Path targetRegionDir src getName src getName src getName
fs contained getHdfsRegionDir LOG warn thread contained getHdfsRegionDir sidelineRegionDir fs contained fileMoves cf Path src cf getPath Path dst Path targetRegionDir src getName src getName src getName LOG info thread src dst fs src
LOG warn thread contained getHdfsRegionDir sidelineRegionDir fs contained fileMoves cf Path src cf getPath Path dst Path targetRegionDir src getName src getName src getName LOG info thread src dst hfile fs src success fs rename hfile getPath dst success
m HbckRegionInfo MetaEntry hri sn ts daughters getFirst daughters getSecond m HbckRegionInfo MetaEntry hri sn ts HbckRegionInfo previous regionInfoMap get hri getEncodedName previous regionInfoMap put hri getEncodedName HbckRegionInfo m previous previous setMetaEntry m IOException previous List RegionInfo mergeParents MetaTableAccessor getMergeRegions result rawCells mergeParents RegionInfo mergeRegion mergeParents mergeRegion HbckRegionInfo hbInfo getOrCreateInfo mergeRegion getEncodedName
overlap merges add HBaseFsck WorkItemOverlapMerge overlap handler rets hbck executor invokeAll merges e LOG error e i i merges i HBaseFsck WorkItemOverlapMerge work merges get i Future Void f rets get i f get e LOG warn work e getCause e
t master t master stopMaster e LOG error e LOG info t master hashCode t master isStopped activeMaster LOG warn activeMaster master hashCode activeMaster t LOG debug t master hashCode t master isStopped activeMaster activeMaster master shutdown e
activeMaster t LOG debug t master hashCode t master isStopped activeMaster activeMaster master shutdown e LOG error e wasInterrupted maxTime System currentTimeMillis t t getRegionServer stop t now System currentTimeMillis t wasInterrupted now maxTime
t join maxTime now e LOG info e wasInterrupted atLeastOneLiveServer t t atLeastOneLiveServer LOG warn t join e wasInterrupted atLeastOneLiveServer
LOG info e wasInterrupted atLeastOneLiveServer t t atLeastOneLiveServer LOG warn t join e wasInterrupted atLeastOneLiveServer t t
moved count retries admin getConfiguration getInt RegionMover MOVE_RETRIES_MAX_KEY RegionMover DEFAULT_MOVE_RETRIES_MAX maxWaitInSeconds admin getConfiguration getInt RegionMover MOVE_WAIT_MAX_KEY RegionMover DEFAULT_MOVE_WAIT_MAX startTime EnvironmentEdgeManager currentTime sameServer isSuccessfulScan region
moved count retries admin getConfiguration getInt RegionMover MOVE_RETRIES_MAX_KEY RegionMover DEFAULT_MOVE_RETRIES_MAX maxWaitInSeconds admin getConfiguration getInt RegionMover MOVE_WAIT_MAX_KEY RegionMover DEFAULT_MOVE_WAIT_MAX startTime EnvironmentEdgeManager currentTime sameServer isSuccessfulScan region LOG info region getRegionNameAsString sourceServer targetServer count retries sameServer count
sameServer isSuccessfulScan region LOG info region getRegionNameAsString sourceServer targetServer count retries sameServer count LOG debug count retries region getRegionNameAsString count count admin move region getEncodedNameAsBytes targetServer maxWait startTime maxWaitInSeconds maxWait sameServer isSameServer region sourceServer sameServer Thread sleep sameServer
count retries sameServer count LOG debug count retries region getRegionNameAsString count count admin move region getEncodedNameAsBytes targetServer maxWait startTime maxWaitInSeconds maxWait sameServer isSameServer region sourceServer sameServer Thread sleep sameServer LOG error region getRegionNameAsString sourceServer getTimeDiffInSec startTime targetServer isSuccessfulScan region
LOG info region getEncodedName sourceServer targetServer admin move region getEncodedNameAsBytes targetServer
List RegionInfo ServerName server getTargetServer List RegionInfo movedRegions Collections synchronizedList ArrayList
List RegionInfo regionsToMove ServerName server getTargetServer List RegionInfo movedRegions Collections synchronizedList ArrayList LOG info regionsToMove size server maxthreads ack ExecutorService moveRegionsPool Executors newFixedThreadPool maxthreads List Future Boolean taskList ArrayList counter counter regionsToMove size RegionInfo region regionsToMove get counter ServerName currentServer MoveWithAck getServerNameForRegion region admin conn currentServer LOG warn region getRegionNameAsString counter server currentServer
deleteFile filename ExecutorService unloadPool Executors newFixedThreadPool unloadPool List RegionInfo movedRegions Collections synchronizedList ArrayList List ServerName regionServers ArrayList RSGroupInfo rsgroup admin getRSGroup Address fromParts hostname port
deleteFile filename ExecutorService unloadPool Executors newFixedThreadPool unloadPool List RegionInfo movedRegions Collections synchronizedList ArrayList List ServerName regionServers ArrayList RSGroupInfo rsgroup admin getRSGroup Address fromParts hostname port LOG info hostname rsgroup getName regionServers addAll filterRSGroupServers rsgroup admin getRegionServers ServerName server stripServer regionServers hostname port server
deleteFile filename ExecutorService unloadPool Executors newFixedThreadPool unloadPool List RegionInfo movedRegions Collections synchronizedList ArrayList List ServerName regionServers ArrayList RSGroupInfo rsgroup admin getRSGroup Address fromParts hostname port LOG info hostname rsgroup getName regionServers addAll filterRSGroupServers rsgroup admin getRegionServers ServerName server stripServer regionServers hostname port server LOG info hostname port
List ServerName regionServers ArrayList RSGroupInfo rsgroup admin getRSGroup Address fromParts hostname port LOG info hostname rsgroup getName regionServers addAll filterRSGroupServers rsgroup admin getRegionServers ServerName server stripServer regionServers hostname port server LOG info hostname port LOG debug regionServers includeExcludeRegionServers designatedFile regionServers includeExcludeRegionServers excludeFile regionServers Set ServerName decommissionedRS HashSet admin listDecommissionedRegionServers decommissionedRS regionServers removeIf decommissionedRS contains
LOG info hostname port LOG debug regionServers includeExcludeRegionServers designatedFile regionServers includeExcludeRegionServers excludeFile regionServers Set ServerName decommissionedRS HashSet admin listDecommissionedRegionServers decommissionedRS regionServers removeIf decommissionedRS contains LOG debug decommissionedRS stripMaster regionServers regionServers LOG warn
includeExcludeRegionServers designatedFile regionServers includeExcludeRegionServers excludeFile regionServers Set ServerName decommissionedRS HashSet admin listDecommissionedRegionServers decommissionedRS regionServers removeIf decommissionedRS contains LOG debug decommissionedRS stripMaster regionServers regionServers LOG warn LOG info regionServers unloadRegions server regionServers movedRegions
pool task operation pool shutdown pool timeout TimeUnit SECONDS LOG warn operation timeout pool shutdownNow e pool shutdownNow Thread currentThread interrupt task get TimeUnit SECONDS e LOG warn operation hostname e e e
moveRegionsPool shutdownNow e moveRegionsPool shutdownNow Thread currentThread interrupt LOG error Exception e LOG error e getMessage e e e ignoreFailure ignoreRegionMoveFailure e ignoreFailure
e moveRegionsPool shutdownNow Thread currentThread interrupt LOG error Exception e LOG error e getMessage e e e ignoreFailure ignoreRegionMoveFailure e ignoreFailure LOG debug e
Thread currentThread interrupt LOG error Exception e LOG error e getMessage e e e ignoreFailure ignoreRegionMoveFailure e ignoreFailure LOG debug e LOG error e getMessage e
maxWaitInSeconds admin getConfiguration getInt SERVERSTART_WAIT_MAX_KEY DEFAULT_SERVERSTART_WAIT_MAX maxWait EnvironmentEdgeManager currentTime maxWaitInSeconds EnvironmentEdgeManager currentTime maxWait List ServerName regionServers ArrayList regionServers addAll admin getRegionServers server stripServer regionServers hostname port server LOG warn hostname port e LOG warn e Thread sleep server
range start range getStartKey end specialEndKey range end start end
columnFamilies conf splitCount conf getInt Preconditions checkArgument splitCount Preconditions checkArgument columnFamilies length
cf builder setColumnFamily ColumnFamilyDescriptorBuilder of cf connection Admin admin connection getAdmin Preconditions checkArgument admin tableExists tableName tableName admin createTable builder build splitAlgo split splitCount admin close LOG debug onlineRegions locator connection tableName onlineRegions splitCount onlineRegions locator getAllRegionLocations size
Admin admin connection getAdmin Preconditions checkArgument admin tableExists tableName tableName admin createTable builder build splitAlgo split splitCount admin close LOG debug onlineRegions locator connection tableName onlineRegions splitCount onlineRegions locator getAllRegionLocations size LOG debug onlineRegions splitCount onlineRegions splitCount Thread sleep
TreeMap ServerName LinkedList Pair daughterRegions Maps newTreeMap regionLocator Pair dr ServerName rsLocation regionLocator getRegionLocation dr getSecond getServerName daughterRegions rsLocation LinkedList Pair entry Lists newLinkedList daughterRegions put rsLocation entry daughterRegions get rsLocation add dr LOG debug startTime System currentTimeMillis rawData readFile fs splitFile FSDataOutputStream splitOut fs create splitFile splitOut write rawData
List HRegionLocation hrls regionLocator getAllRegionLocations HRegionLocation hrl hrls ServerName sn hrl getServerName rsSizes sn rsSizes put sn rsSizes get sn rsSizes put sn ServerName LinkedList Pair daughterRegion Pair dr ServerName rsLoc daughterRegion getKey LinkedList Pair regionList daughterRegion getValue LOG debug rsLoc regionList dr regionList pop split dr getSecond
ServerName LinkedList Pair daughterRegion daughterRegions Pair dr ServerName rsLoc daughterRegion getKey LinkedList Pair regionList daughterRegion getValue LOG debug rsLoc regionList dr regionList pop split dr getSecond HRegionLocation regionLoc regionLocator getRegionLocation split ServerName newRs regionLoc getServerName newRs rsLoc LOG debug splitAlgo rowToStr split newRs daughterRegions newRs LinkedList Pair entry Lists newLinkedList daughterRegions put newRs entry
LOG debug splitAlgo rowToStr split newRs daughterRegions newRs LinkedList Pair entry Lists newLinkedList daughterRegions put newRs entry daughterRegions get newRs add dr dr sk regionLoc getRegion getStartKey sk split sk LOG debug splitAlgo rowToStr split splitCount dr start dr getFirst
start dr getFirst Preconditions checkArgument Bytes equals start sk splitAlgo rowToStr start splitAlgo rowToStr sk daughterRegions remove rsLoc dr split dr getSecond LOG debug splitAlgo rowToStr split admin admin split tableName split LinkedList Pair finished Lists newLinkedList LinkedList Pair local_finished Lists newLinkedList outstanding addLast dr
split dr getSecond LOG debug splitAlgo rowToStr split admin connection admin split tableName split LinkedList Pair finished Lists newLinkedList LinkedList Pair local_finished Lists newLinkedList outstanding addLast dr outstanding size LOG debug outstanding size local_finished splitScan outstanding connection tableName splitAlgo local_finished Thread sleep finished addAll local_finished
LOG debug outstanding size local_finished splitScan outstanding connection tableName splitAlgo local_finished Thread sleep finished addAll local_finished outstanding removeAll local_finished LOG debug local_finished size finished add dr region finished splitOut writeChars splitAlgo rowToStr region getFirst splitAlgo rowToStr region getSecond splitCount splitCount tDiff System currentTimeMillis startTime splitCount
finished addAll local_finished outstanding removeAll local_finished LOG debug local_finished size finished add dr region finished splitOut writeChars splitAlgo rowToStr region getFirst splitAlgo rowToStr region getSecond splitCount splitCount tDiff System currentTimeMillis startTime splitCount LOG debug splitCount origCount org apache hadoop util StringUtils formatTime tDiff outstanding LOG debug outstanding size
FileSystem fs tableDir getFileSystem connection getConfiguration connection clearRegionLocationCache TableDescriptor htd table connection htd table getDescriptor regionLocator connection region start region getFirst split region getSecond RegionInfo dri regionLocator getRegionLocation split getRegion dri dri split logicalSplitting add region
LinkedList RegionInfo check Lists newLinkedList check add regionLocator getRegionLocation start getRegion check add regionLocator getRegionLocation split getRegion RegionInfo hri check RegionInfo check sk hri getStartKey sk length sk splitAlgo firstRow HRegionFileSystem regionFs HRegionFileSystem openRegionFromFileSystem connection getConfiguration fs tableDir hri refFound refFound regionFs refFound check remove hri check
hri check check sk hri getStartKey sk length sk splitAlgo firstRow HRegionFileSystem regionFs HRegionFileSystem openRegionFromFileSystem connection getConfiguration fs tableDir hri refFound refFound regionFs refFound check remove hri check finished add region physicalSplitting add region
Pair connection tableName Pair Path Path tableDirAndSplitFile getTableDirAndSplitFile connection getConfiguration tableName Path tableDir tableDirAndSplitFile getFirst Path splitFile tableDirAndSplitFile getSecond FileSystem fs tableDir getFileSystem connection getConfiguration Set Pair String String daughterRegions Sets newHashSet fs splitFile
tmp regionLocator getStartEndKeys Preconditions checkArgument tmp getFirst length tmp getSecond length i i tmp getFirst length i start tmp getFirst i end tmp getSecond i start length start splitAlgo firstRow end length end splitAlgo lastRow rows add Pair newPair start end LOG debug tableName rows size Path tmpFile Path tableDir FSDataOutputStream tmpOut fs create tmpFile Pair r rows splitPoint splitAlgo split r getFirst r getSecond String startStr splitAlgo rowToStr r getFirst String splitStr splitAlgo rowToStr splitPoint daughterRegions add Pair newPair startStr splitStr
LOG debug RecoverLeaseFSUtils recoverFileLease fs splitFile connection getConfiguration FSDataInputStream tmpIn fs open splitFile StringBuilder sb StringBuilder tmpIn available tmpIn available sb append tmpIn readChar tmpIn close String line sb split String cmd line split splitAlgo separator Preconditions checkArgument cmd length start splitAlgo strToRow cmd String startStr splitAlgo rowToStr start splitPoint splitAlgo strToRow cmd String splitStr splitAlgo rowToStr splitPoint Pair String String r Pair newPair startStr splitStr
sb append tmpIn readChar tmpIn close String line sb split String cmd line split splitAlgo separator Preconditions checkArgument cmd length start splitAlgo strToRow cmd String startStr splitAlgo rowToStr start splitPoint splitAlgo strToRow cmd String splitStr splitAlgo rowToStr splitPoint Pair String String r Pair newPair startStr splitStr cmd LOG debug r daughterRegions add r LOG debug r
RuntimeMXBean runtime ManagementFactory getRuntimeMXBean runtime
RuntimeMXBean runtime ManagementFactory getRuntimeMXBean runtime LOG info runtime getVmName runtime getVmVendor runtime getVmVersion
String keys String HConstants HBASE_DIR HConstants CLUSTER_DISTRIBUTED HConstants ZOOKEEPER_QUORUM String keys
cfd WALProtos ScopeType scop WALProtos ScopeType valueOf cfd getScope scop String message cfd getNameAsString cfd getScope
fileSystem family Collection StoreFileInfo storeFiles fileSystem getStoreFiles family storeFiles
fileSystem family List Path referenceFiles getReferenceFilePaths fileSystem getFileSystem fileSystem getStoreDir family Path referenceFile referenceFiles FileStatus status fileSystem getFileSystem getFileLinkStatus referenceFile status
MajorCompactionRequest htd Map String Long familiesToCompact getStoresRequiringCompaction htd MajorCompactionRequest request familiesToCompact
List Future futures Lists newArrayList clusterCompactionQueues futures clusterCompactionQueues LOG debug Thread sleep sleepForMs Optional ServerName serverToProcess clusterCompactionQueues getLargestQueueFromServersNotCompacting serverToProcess clusterCompactionQueues ServerName serverName serverToProcess get MajorCompactionRequest request clusterCompactionQueues reserveForCompaction serverName ServerName currentServer connection getRegionLocator tableName getRegionLocation request getRegion getStartKey getServerName currentServer serverName LOG info request getRegion getEncodedName serverName currentServer clusterCompactionQueues addToCompactionQueue currentServer request clusterCompactionQueues releaseCompaction serverName
shutdown executor shutdown executor awaitTermination Long MAX_VALUE TimeUnit MILLISECONDS ERRORS StringBuilder builder StringBuilder append append ERRORS size append append append append Joiner on join ERRORS
connection getTable tableName getDescriptor getColumnFamilyNames forEach a storesToCompact add Bytes toString a LOG info LOG info tableName storesToCompact Map ServerName List RegionInfo snRegionMap getServerRegionsMap ServerName sn snRegionMap List RegionInfo regions snRegionMap get sn LOG debug tableName sn regions size Collections shuffle regions regionsToCompact numRegions RegionInfo hri regions numRegions regionsToCompact LOG debug sn Optional MajorCompactionRequest request getMajorCompactionRequest hri request
conf table Connection conn ConnectionFactory createConnection conf TableName tableName TableName valueOf table TableDescriptor htd conn getAdmin getDescriptor tableName htd
rdcs add createMobRegionDirChecker tableDir rdFutures executor invokeAll rdcs ie Thread currentThread interrupt LOG warn ie i i rdFutures i Future Void f rdFutures get i f get e LOG warn rdcs get i regionDir e getCause e getCause IOException IOException e getCause
Map ServerName List String Map ServerName List String undeletedQueues HashMap Set String peerIds HashSet peerStorage listPeerIds ServerName replicator String queueId replicator ReplicationQueueInfo queueInfo ReplicationQueueInfo queueId peerIds queueInfo undeletedQueues computeIfAbsent replicator key ArrayList add queueId
Set String Set String undeletedHFileRefsPeerIds HashSet queueStorage getAllPeersFromHFileRefsQueue Set String peerIds HashSet peerStorage listPeerIds undeletedHFileRefsPeerIds removeAll peerIds String undeletedHFileRefsPeerIds
conf IllegalArgumentException String rootDir conf get HConstants HBASE_DIR rootDir rootDir IllegalArgumentException HConstants HBASE_DIR StringBuilder startPathSB StringBuilder rootDir rootDir startPathSB append startPathSB append HConstants HREGION_LOGDIR_NAME HConstants HREGION_LOGDIR_NAME startPathSB append String startPath startPathSB toString String fullPath fullPath FileSystem get conf makeQualified Path path toString
Path Path path conf Path rootDir CommonFSUtils getWALRootDir conf Path oldLogDir Path rootDir HConstants HREGION_OLDLOGDIR_NAME conf ServerName serverName getServerNameFromWALDirectoryName path serverName
Path Path path conf Path rootDir CommonFSUtils getWALRootDir conf Path oldLogDir Path rootDir HConstants HREGION_OLDLOGDIR_NAME conf ServerName serverName getServerNameFromWALDirectoryName path serverName LOG error path path oldLogDir Path oldLogDir serverName getServerName Path archivedLogLocation Path oldLogDir path getName FileSystem fs CommonFSUtils getWALFileSystem conf fs archivedLogLocation LOG info path archivedLogLocation archivedLogLocation
conf FileSystem dfs CommonFSUtils getCurrentFileSystem conf dfs conf
updateStatusWithMsg errorMsg IOException editsWriter path Path dst getCompletedRecoveredEditsFilePath editsWriter path regionMaximumEditLogSeqNum get Bytes toString editsWriter encodedRegionName dst editsWriter path dst deleteOneWithFewerEntries editsWriter dst editsWriter path editsWriter path dst String errorMsg editsWriter path dst updateStatusWithMsg errorMsg IOException errorMsg String renameEditMsg editsWriter path dst LOG info renameEditMsg updateStatusWithMsg renameEditMsg
now System currentTimeMillis checkLowReplication now now wait threadWakeFrequency Thread currentThread interrupt Entry WAL RollController iter iter Entry WAL RollController entry iter next WAL wal entry getKey RollController controller entry getValue controller
wait threadWakeFrequency Thread currentThread interrupt Entry WAL RollController iter iter Entry WAL RollController entry iter next WAL wal entry getKey RollController controller entry getValue controller LOG debug wal controller
Writer writer writer logWriterClass getDeclaredConstructor newInstance FileSystem rootFs FileSystem get path toUri conf writer init rootFs path conf overwritable blocksize writer e e CommonFSUtils LOG error e getMessage CommonFSUtils HBASE_WAL_DIR LOG debug e writer writer close
LOG debug progressFailed t writerThreads t finish t writerThreads progressFailed progressFailed t join ie IOException iie InterruptedIOException iie initCause ie iie controller checkForErrors String msg writerThreads size
startWaiting EnvironmentEdgeManager currentTime openTimeout timeoutMillis startWaiting nbAttempt AbstractFSWALProvider Reader reader reader lrClass getDeclaredConstructor newInstance reader init fs path conf reader reader reader close exception LOG warn exception getMessage
reader e reader reader close exception LOG warn exception getMessage LOG debug exception String msg e getMessage msg msg msg msg LOG warn e InterruptedIOException
cmd printer enableValues cmd printer enableJSON cmd printer setTableFilter cmd getOptionValue cmd printer setRegionFilter cmd getOptionValue cmd printer setSequenceFilter Long parseLong cmd getOptionValue cmd printer setRowFilter cmd getOptionValue cmd printer setPosition Long parseLong cmd getOptionValue
interval conf getInt outputSinkStarted cancelled editsCount editsSkipped MonitoredTask status TaskMonitor get createStatus wal status enableStatusJournal Reader walReader fileBeingSplit walStatus startTS EnvironmentEdgeManager currentTime length walStatus getLen String lengthStr StringUtils humanSize length createOutputSinkAndEntryBuffers String logStr wal lengthStr length
SplitWALResult corrupt LOG info wal EnvironmentEdgeManager currentTime startTS numOpenedFilesBeforeReporting conf getInt numOpenedFilesLastCheck outputSink setReporter cancel outputSink setStatus status outputSink startWriterThreads outputSinkStarted Entry entry startTS EnvironmentEdgeManager currentTime entry wal region entry getKey getEncodedRegionName String encodedRegionNameAsStr Bytes toString region Long lastFlushedSequenceId lastFlushedSequenceIds get encodedRegionNameAsStr lastFlushedSequenceId
entry region entry getKey getEncodedRegionName String encodedRegionNameAsStr Bytes toString region Long lastFlushedSequenceId lastFlushedSequenceIds get encodedRegionNameAsStr lastFlushedSequenceId entry getKey encodedRegionNameAsStr LOG info encodedRegionNameAsStr lastFlushedSequenceId Long MAX_VALUE sequenceIdChecker RegionStoreSequenceIds ids sequenceIdChecker getLastSequenceId region Map Long maxSeqIdInStores TreeMap Bytes BYTES_COMPARATOR storeSeqId ids maxSeqIdInStores put storeSeqId getFamilyName toByteArray storeSeqId getSequenceId regionMaxSeqIdInStores put encodedRegionNameAsStr maxSeqIdInStores
IOException iie InterruptedIOException iie initCause ie iie e LOG warn wal e splitLogWorkerCoordination splitLogWorkerCoordination markCorrupted walRootDir wal getName walFS corrupt IOException e e e RemoteException RemoteException e unwrapRemoteException e e String log wal LOG debug log status setStatus log
String propertyName String String sysValue System getProperty propertyName sysValue
MiniDFSCluster servers String racks String hosts createDirsAndSetProperties EditLogFileOutputStream setShouldSkipFsyncForTesting Log4jUtils setLogLevel org apache hadoop metrics2 util MBeans getName Log4jUtils setLogLevel org apache hadoop metrics2 impl MetricsSystemImpl getName TraceUtil initTracer conf dfsCluster MiniDFSCluster conf servers racks hosts setFs dfsCluster waitClusterUp dataTestDirOnTestFS String dataTestDir getDataTestDir toString conf set HConstants HBASE_DIR dataTestDir
String curUser System getProperty
String String relPath String property String path getDataTestDir relPath toString System setProperty property path conf set property path File path mkdirs
List Table t getConnection getTable TableName META_TABLE_NAME List rows ArrayList ResultScanner s t getScanner Scan s
List TableName Table t getConnection getTable TableName META_TABLE_NAME List rows ArrayList ResultScanner s t getScanner Scan result s RegionInfo info CatalogFamilyFormat getRegionInfo result info
nodeZK Configuration c Configuration conf String quorumServers ZKConfig getZKQuorumServersString c ZooKeeper zk nodeZK getRecoverableZooKeeper getZooKeeper password zk getSessionPasswd sessionID zk getSessionId ZooKeeper ZooKeeper quorumServers
nodeZK Configuration c Configuration conf String quorumServers ZKConfig getZKQuorumServersString c ZooKeeper zk nodeZK getRecoverableZooKeeper getZooKeeper password zk getSessionPasswd sessionID zk getSessionId ZooKeeper ZooKeeper quorumServers watchedEvent LOG info watchedEvent sessionID password ZooKeeper newZK ZooKeeper quorumServers EmptyWatcher instance sessionID password start System currentTimeMillis newZK System currentTimeMillis start Thread sleep newZK close
closeConnection String masterConfigBefore conf get HConstants MASTER_ADDRS_KEY String masterConfAfter getMiniHBaseCluster conf get HConstants MASTER_ADDRS_KEY
startedServer MiniHBaseCluster hbaseCluster getMiniHBaseCluster hbaseCluster
num startedServer ensureSomeRegionServersAvailable num nonStoppedServers rst HRegionServer hrs rst getRegionServer hrs hrs
tableFound server r getValue HConstants CATALOG_FAMILY HConstants SERVER_QUALIFIER server startCode r getValue HConstants CATALOG_FAMILY HConstants STARTCODE_QUALIFIER ServerName serverName ServerName valueOf Bytes toString server replaceFirst Bytes toLong startCode serverName r tableFound LOG warn tableName tableFound
info tableFound LOG warn tableName tableFound LOG info tableName HMaster master getHBaseCluster getMaster RegionStates states master getAssignmentManager getRegionStates explainTableAvailability tableName List RegionInfo hris states getRegionsOfTable tableName
IOException maxTimeMs maxNumAttempts maxTimeMs HConstants SOCKET_RETRY_WAIT_MS IOException savedException
host port IOException maxTimeMs maxNumAttempts maxTimeMs HConstants SOCKET_RETRY_WAIT_MS IOException savedException LOG info host port maxNumAttempts Socket sock Socket InetAddress getByName host port sock close savedException
td cd builder setColumnFamily cd td builder build totalNumberOfRegions Connection unmanagedConnection ConnectionFactory createConnection conf Admin admin unmanagedConnection getAdmin numberOfServers admin getRegionServers size numberOfServers IllegalStateException totalNumberOfRegions numberOfServers numRegionsPerServer LOG info numberOfServers totalNumberOfRegions numRegionsPerServer splits splitter split totalNumberOfRegions admin createTable td splits
conf put MiniKdc DEBUG MiniKdc kdc File dir bindException numTries bindException dir File getDataTestDir toUri getPath kdc MiniKdc conf dir kdc start FileUtils deleteDirectory dir numTries numTries
benchmark rowCount codec cipher LOG info benchmark getClass getSimpleName codec cipher rowCount elapsedTime benchmark run
masterClass HMaster regionserverClass regionserverClass MiniHBaseCluster MiniHBaseClusterRegionServer hbaseCluster LocalHBaseCluster conf nMasterNodes numAlwaysStandByMasters masterClass regionserverClass i i i Configuration rsConf HBaseConfiguration create conf rsPorts rsConf setInt HConstants REGIONSERVER_PORT rsPorts get i User user HBaseTestingUtility getDifferentUser rsConf index hbaseCluster addRegionServer rsConf i user hbaseCluster startup e shutdown e
serverName HRegionServer server getRegionServer getRegionServerIndex serverName server
serverNumber HRegionServer server getRegionServer serverNumber
JVMClusterUtil RegionServerThread serverNumber JVMClusterUtil RegionServerThread server hbaseCluster getRegionServers get serverNumber
JVMClusterUtil RegionServerThread serverNumber JVMClusterUtil RegionServerThread server hbaseCluster getRegionServers get serverNumber
JVMClusterUtil RegionServerThread serverNumber JVMClusterUtil RegionServerThread server hbaseCluster getRegionServers get serverNumber
serverNumber HMaster server getMaster serverNumber
JVMClusterUtil MasterThread serverNumber JVMClusterUtil MasterThread server hbaseCluster getMasters get serverNumber
stopping
util clazz JsonParser parser JsonParser oldTimeout timeoutIncrements timeout getProcedure util clazz parser filter o o has map o o get getAsLong orElse timeout oldTimeout
TEST_UTIL getConfiguration setBoolean LocalHBaseCluster ASSIGN_RANDOM_PORTS TEST_UTIL getConfiguration setInt HConstants MASTER_PORT masterPort TEST_UTIL getConfiguration setInt HConstants MASTER_INFO_PORT masterInfoPort TEST_UTIL getConfiguration setInt HConstants REGIONSERVER_PORT rsPort TEST_UTIL getConfiguration setInt HConstants REGIONSERVER_INFO_PORT rsInfoPort MiniHBaseCluster cluster TEST_UTIL startMiniCluster assertTrue cluster waitForActiveAndReadyMaster retry assertEquals masterPort cluster getMaster getRpcServer getListenerAddress getPort assertEquals masterInfoPort cluster getMaster getInfoServer getPort assertEquals rsPort cluster getRegionServer getRpcServer getListenerAddress getPort assertEquals rsInfoPort cluster getRegionServer getInfoServer getPort
family Bytes toBytes LOG info regionNum Table ht TEST_UTIL createMultiRegionTable table family regionNum numRegions r TEST_UTIL table numRegions r getStartKeys length assertEquals regionNum numRegions waitForAllRegionsAssigned server globalMemStoreSize regionInfo server globalMemStoreSize server getRegion regionInfo getEncodedName getMemStoreDataSize assertEquals server getRegionServerAccounting getGlobalMemStoreDataSize globalMemStoreSize i server
i server LOG info server getServerName server getRegionServerAccounting getGlobalMemStoreDataSize regionInfo server HRegion r server getRegion regionInfo getEncodedName flush r server LOG info server getServerName now System currentTimeMillis timeout now server getRegionServerAccounting getGlobalMemStoreDataSize timeout System currentTimeMillis Threads sleep size server getRegionServerAccounting getGlobalMemStoreDataSize size regionInfo server HRegion r server getRegion regionInfo getEncodedName
regionCount HBaseTestingUtility getAllOnlineRegions cluster size regionCount totalRegionNum
HBaseTestingUtility hbt HBaseTestingUtility MiniDFSCluster cluster hbt startMiniDFSCluster FileSystem dfs cluster getFileSystem Path dir Path Path qualifiedDir dfs makeQualified dir
HBaseTestingUtility hbt HBaseTestingUtility Path testdir hbt getClusterTestDir
HBaseTestingUtility hbt HBaseTestingUtility Path testdir hbt getDataTestDir
admin flush table getName assertTrue System currentTimeMillis startWaitTime assertTrue compactingRegion countStoreFiles REGION_NAME compactingRegion getRegionInfo getRegionName LOG info admin majorCompact TABLE_NAME LOG info compactingRegion waitForCompactionToBlock LOG info RegionServerThread newServerThread TEST_UTIL getMiniHBaseCluster startRegionServer HRegionServer newServer newServerThread getRegionServer LOG info TEST_UTIL expireRegionServerSession CompactionBlockerRegion newRegion startWaitTime System currentTimeMillis
InetAddress addrs InetAddress getAllByName InetAddress addrs
InetAddress addrs InetAddress getLocalHost InetAddress addrs
TableName tableName TableName valueOf name getMethodName
String name name getMethodName
String name name getMethodName LOG info name Pair RegionInfo ServerName pair MetaTableAccessor getRegion connection Bytes toBytes assertNull pair
TableName tableName TableName valueOf name getMethodName
String nsName prefix name getMethodName
String nsName prefix name getMethodName
String nsName prefix name getMethodName
TableDescriptor tableDescriptor tableDescriptorBuilder build admin createTable tableDescriptor fail admin createNamespace NamespaceDescriptor create nsName build admin createTable tableDescriptor TEST_UTIL waitTableAvailable tableDescriptor getTableName getName FileSystem fs FileSystem get TEST_UTIL getConfiguration assertTrue fs exists Path master getMasterFileSystem getRootDir Path HConstants BASE_NAMESPACE_DIR Path nsName tableDescriptor getTableName getQualifierAsString assertEquals admin listTableDescriptors size admin deleteNamespace nsName fail
String script expectedStatus Configuration config getConfForNodeHealthScript config addResource healthScriptFile getName String location healthScriptFile getAbsolutePath timeout config getLong HConstants HEALTH_SCRIPT_TIMEOUT SCRIPT_TIMEOUT HealthChecker checker HealthChecker checker init location timeout createScript script HealthReport report checker checkHealth assertEquals expectedStatus report getStatus
msg LOG LOG info msg
expKvList msg LOG LOG info msg LOG info expKvList size
message LOG message LOG info message
r1 message LOG message LOG info message LOG info r1
ServerName serverName admin List RegionInfo regions admin getRegions serverName Collection RegionMetrics regionMetricsList admin getRegionMetrics serverName checkRegionsAndRegionMetrics regions regionMetricsList table List RegionInfo tableRegions admin getRegions table List RegionMetrics regionMetrics ArrayList ServerName serverName admin regionMetrics addAll admin getRegionMetrics serverName table checkRegionsAndRegionMetrics tableRegions regionMetrics TimeUnit MILLISECONDS sleep MSG_INTERVAL ServerName ServerMetrics entry admin ServerName serverName entry getKey ServerMetrics serverMetrics entry getValue List RegionMetrics regionMetrics admin getRegionMetrics serverName
List RegionInfo regions admin getRegions serverName Collection RegionMetrics regionMetricsList admin getRegionMetrics serverName checkRegionsAndRegionMetrics regions regionMetricsList table List RegionInfo tableRegions admin getRegions table List RegionMetrics regionMetrics ArrayList ServerName serverName admin keySet regionMetrics addAll admin getRegionMetrics serverName table checkRegionsAndRegionMetrics tableRegions regionMetrics TimeUnit MILLISECONDS sleep MSG_INTERVAL ServerName ServerMetrics entry admin ServerName serverName entry getKey ServerMetrics serverMetrics entry getValue List RegionMetrics regionMetrics admin getRegionMetrics serverName LOG debug serverName serverMetrics getRegionMetrics keySet stream map r Bytes toString r collect Collectors toList
slop slop i i i success waitForAllRegionsAssigned regionCount UTIL getMiniHBaseCluster countServedRegions List HRegionServer servers getOnlineRegionServers avg regionCount servers size avgLoadPlusSlop Math ceil avg slop avgLoadMinusSlop Math floor avg slop avgLoadPlusSlop avgLoadMinusSlop LOG debug servers size regionCount avg avgLoadMinusSlop avgLoadPlusSlop i HRegionServer server servers serverLoad ProtobufUtil getOnlineRegions server getRSRpcServices size
List HRegionServer servers getOnlineRegionServers avg regionCount servers size avgLoadPlusSlop Math ceil avg slop avgLoadMinusSlop Math floor avg slop avgLoadPlusSlop avgLoadMinusSlop LOG debug servers size regionCount avg avgLoadMinusSlop avgLoadPlusSlop i HRegionServer server servers serverLoad ProtobufUtil getOnlineRegions server getRSRpcServices size LOG debug server getServerName avg serverLoad avg serverLoad avgLoadPlusSlop serverLoad avgLoadMinusSlop hri ProtobufUtil getOnlineRegions server getRSRpcServices hri isMetaRegion serverLoad serverLoad avgLoadPlusSlop serverLoad avgLoadMinusSlop
conf setClass MockMapping DNSToSwitchMapping conf setFloat conf setFloat conf set CoprocessorHost REGIONSERVER_COPROCESSOR_CONF_KEY JMXListener getName Random rand Random i i i sign i connectorPort sign rand nextInt HBaseTestingUtility available connectorPort conf setInt connectorPort UTIL startMiniCluster
Random rand Random i i i sign i connectorPort sign rand nextInt HBaseTestingUtility available connectorPort conf setInt connectorPort UTIL startMiniCluster e LOG debug connectorPort e UTIL shutdownMiniCluster
String testName String tableName testName System currentTimeMillis TableDescriptor desc TableDescriptorBuilder newBuilder TableName valueOf tableName setColumnFamily ColumnFamilyDescriptorBuilder of build
fs List String storeFiles timeout end System currentTimeMillis timeout Path archiveDir HFileArchiveUtil getArchivePath UTIL getConfiguration List String archivedFiles ArrayList System currentTimeMillis end archivedFiles getAllFileNames fs archiveDir archivedFiles storeFiles Collections sort storeFiles Collections sort archivedFiles LOG debug i i storeFiles i LOG debug i storeFiles get i LOG debug i i archivedFiles i
Path sourceRegionDir Path rootDir regionDir fs mkdirs sourceRegionDir Stoppable stoppable StoppableImplementation HFileCleaner cleaner getHFileCleaner stoppable conf fs archiveDir assertNotNull cleaner choreService scheduleChore cleaner startTime System currentTimeMillis fid System currentTimeMillis startTime fid Path file Path familyDir String valueOf fid Path sourceFile Path rootDir file Path archiveFile Path archiveDir file fs createNewFile sourceFile HFileArchiver archiveRegion fs rootDir sourceRegionDir getParent sourceRegionDir
assertNotNull cleaner choreService scheduleChore cleaner startTime System currentTimeMillis fid System currentTimeMillis startTime fid Path file Path familyDir String valueOf fid Path sourceFile Path rootDir file Path archiveFile Path archiveDir file fs createNewFile sourceFile HFileArchiver archiveRegion fs rootDir sourceRegionDir getParent sourceRegionDir LOG debug fid assertTrue fs exists archiveFile assertFalse fs exists sourceFile
CountDownLatch cleaner BaseHFileCleanerDelegate BaseHFileCleanerDelegate delegateSpy Mockito spy cleaner counter CountDownLatch finished CountDownLatch Mockito counter
Configuration c Configuration TEST_UTIL getConfiguration table TEST_UTIL SleepCoprocessor SLEEP_TIME SleepCoprocessor SLEEP_TIME SleepCoprocessor SLEEP_TIME SleepCoprocessor SLEEP_TIME execute table fail e LOG info e c setInt HConstants HBASE_RPC_TIMEOUT_KEY SleepCoprocessor SLEEP_TIME c setInt HConstants HBASE_RPC_READ_TIMEOUT_KEY SleepCoprocessor SLEEP_TIME c setInt HConstants HBASE_RPC_WRITE_TIMEOUT_KEY SleepCoprocessor SLEEP_TIME c setInt HConstants HBASE_CLIENT_OPERATION_TIMEOUT SleepCoprocessor SLEEP_TIME c table execute table fail e
HRegionServer rs UTIL getHBaseCluster getRegionServer Region region rs getRegions tableName get
HRegionServer rs UTIL getHBaseCluster getRegionServer Region region rs getRegions tableName get LOG debug tableName Put p Put Bytes toBytes p addColumn family qualifier Bytes toBytes mutate p load region getMemStoreHeapSize flushSizeBytes
p addColumn family qualifier Bytes toBytes mutate p load region getMemStoreHeapSize flushSizeBytes LOG debug tableName ClientBackoffPolicy backoffPolicy getBackoffPolicy assertTrue backoffPolicy ExponentialClientBackoffPolicy ServerStatisticTracker stats getStatisticsTracker assertNotNull stats ServerName server rs getServerName regionName region getRegionInfo getRegionName ServerStatistics serverStats stats getStats server ServerStatistics RegionStatistics regionStats serverStats getStatsForRegion regionName assertEquals load regionStats getMemStoreLoadPercent backoffTime backoffPolicy getBackoffTime server regionName serverStats assertNotEquals backoffTime
key assertTrue key key length Bytes BYTES_COMPARATOR compare key
TEST_UTIL getConfiguration setInt TEST_UTIL getConfiguration setInt HConstants META_REPLICAS_NUM TEST_UTIL getConfiguration setInt StorefileRefresherChore REGIONSERVER_STOREFILE_REFRESH_PERIOD StartMiniClusterOption option StartMiniClusterOption builder numAlwaysStandByMasters numMasters numRegionServers REGIONSERVERS_COUNT build TEST_UTIL startMiniCluster option AssignmentManager am TEST_UTIL getMiniHBaseCluster getMaster getAssignmentManager Set ServerName sns HashSet ServerName ServerName hbaseMetaServerName MetaTableLocator getMetaRegionLocation TEST_UTIL getZooKeeperWatcher
TEST_UTIL getConfiguration setInt TEST_UTIL getConfiguration setInt HConstants META_REPLICAS_NUM TEST_UTIL getConfiguration setInt StorefileRefresherChore REGIONSERVER_STOREFILE_REFRESH_PERIOD StartMiniClusterOption option StartMiniClusterOption builder numAlwaysStandByMasters numMasters numRegionServers REGIONSERVERS_COUNT build TEST_UTIL startMiniCluster option AssignmentManager am TEST_UTIL getMiniHBaseCluster getMaster getAssignmentManager Set ServerName sns HashSet ServerName ServerName hbaseMetaServerName MetaTableLocator getMetaRegionLocation TEST_UTIL getZooKeeperWatcher LOG info hbaseMetaServerName sns add hbaseMetaServerName replicaId replicaId replicaId RegionInfo h RegionReplicaUtil getRegionInfoForReplica RegionInfoBuilder FIRST_META_REGIONINFO replicaId AssignmentTestingUtil waitForAssignment am h ServerName sn am getRegionStates getRegionServerOfRegion h assertNotNull sn
assertFalse ADMIN tableExists tableName table tableName familyNames locator tableName rowCount q index index familyNames index ArrayList Put puts ArrayList rowCounts index i i rowCounts index i k Bytes toBytes i Put put Put k put addColumn familyNames index q k puts add put table put puts rowCount rowCounts index rowCount rowCounts index List HRegionLocation m locator getAllRegionLocations
ADMIN split tableName splitPoint ADMIN split tableName AtomicInteger count AtomicInteger sleep List HRegionLocation regions regions locator getAllRegionLocations
AtomicInteger count AtomicInteger sleep e List HRegionLocation regions regions locator getAllRegionLocations e LOG warn e regions
regions count set regions size count get LOG info regions LOG debug LOG debug count get t setPriority Thread NORM_PRIORITY t start t join ADMIN splitRegionAsync m get getRegion getRegionName splitPoint get rows count scanner
assertEquals userPermissions size List Permission permissions Lists newArrayList permission hasPermission admin hasUserPermissions userName1 permissions get get booleanValue assertTrue hasPermission hasPermission admin hasUserPermissions userName2 permissions get get booleanValue assertFalse hasPermission hasPermissionAction conn get conn getAdmin hasUserPermissions userName1 permissions get get user2 runAs hasPermissionAction fail
count
RegionInfo hri createTableAndGetOneRegion tableName ServerName serverName TEST_UTIL getHBaseCluster getMaster getAssignmentManager getRegionStates getRegionServerOfRegion hri HRegionServer regionServer TEST_UTIL getHBaseCluster getLiveRegionServerThreads stream map rsThread rsThread getRegionServer filter rs rs getServerName equals serverName findFirst get ASYNC_CONN getTable tableName put Put hri getStartKey addColumn FAMILY FAMILY_0 Bytes toBytes join assertTrue regionServer getOnlineRegion hri getRegionName getMemStoreDataSize
RegionInfo hri createTableAndGetOneRegion tableName ServerName serverName TEST_UTIL getHBaseCluster getMaster getAssignmentManager getRegionStates getRegionServerOfRegion hri HRegionServer regionServer TEST_UTIL getHBaseCluster getLiveRegionServerThreads stream map rsThread rsThread getRegionServer filter rs rs getServerName equals serverName findFirst get ASYNC_CONN getTable tableName put Put hri getStartKey addColumn FAMILY FAMILY_0 Bytes toBytes join assertTrue regionServer getOnlineRegion hri getRegionName getMemStoreDataSize LOG info Bytes toStringBinary hri getRegionName admin flushRegion hri getRegionName get
assertFalse ts1 isPresent p Put Bytes toBytes p addColumn FAMILY Bytes toBytes Bytes toBytes table put p join admin flush tableName join ts1 admin getLastMajorCompactionTimestamp tableName get assertFalse ts1 isPresent table put p join admin flush tableName join admin majorCompact tableName join curt System currentTimeMillis waitTime endt curt waitTime CompactionState state admin getCompactionState tableName get
ts1 admin getLastMajorCompactionTimestamp tableName get assertFalse ts1 isPresent table put p join admin flush tableName join admin majorCompact tableName join curt System currentTimeMillis waitTime endt curt waitTime CompactionState state admin getCompactionState tableName get LOG info state state CompactionState curt endt Thread sleep state admin getCompactionState tableName get curt System currentTimeMillis
table put p join admin flush tableName join admin majorCompact tableName join curt System currentTimeMillis waitTime endt curt waitTime CompactionState state admin getCompactionState tableName get LOG info state state CompactionState curt endt Thread sleep state admin getCompactionState tableName get curt System currentTimeMillis LOG info state state CompactionState state admin getCompactionState tableName get
curt System currentTimeMillis waitTime endt curt waitTime CompactionState state admin getCompactionState tableName get LOG info state state CompactionState curt endt Thread sleep state admin getCompactionState tableName get curt System currentTimeMillis LOG info state state CompactionState state admin getCompactionState tableName get LOG info state state CompactionState curt endt Thread sleep
LOG info numThreads AtomicBoolean stop AtomicBoolean ExecutorService executor Executors newFixedThreadPool numThreads ThreadFactoryBuilder setNameFormat setUncaughtExceptionHandler Threads LOGGING_EXCEPTION_HANDLER build List Future futures ArrayList numThreads futures executor run stop LOG info numThreads Collections shuffle Arrays asList SPLIT_KEYS Random Admin admin TEST_UTIL getAdmin SPLIT_KEYS oldRegionCount admin getRegions TABLE_NAME size
LOG info numThreads Collections shuffle Arrays asList SPLIT_KEYS Random Admin admin TEST_UTIL getAdmin splitPoint SPLIT_KEYS oldRegionCount admin getRegions TABLE_NAME size LOG info Bytes toStringBinary splitPoint oldRegionCount admin split TABLE_NAME splitPoint TEST_UTIL TEST_UTIL getMiniHBaseCluster getRegions TABLE_NAME size oldRegionCount List HRegion regions TEST_UTIL getMiniHBaseCluster getRegions TABLE_NAME
splitPoint oldRegionCount admin getRegions TABLE_NAME size LOG info Bytes toStringBinary splitPoint oldRegionCount admin split TABLE_NAME splitPoint TEST_UTIL TEST_UTIL getMiniHBaseCluster getRegions TABLE_NAME size oldRegionCount List HRegion regions TEST_UTIL getMiniHBaseCluster getRegions TABLE_NAME LOG info Bytes toStringBinary splitPoint regions size HRegion region regions LOG info region getRegionInfo region compact
List HRegion regions TEST_UTIL getMiniHBaseCluster getRegions TABLE_NAME LOG info Bytes toStringBinary splitPoint regions size HRegion region regions LOG info region getRegionInfo region compact HRegion region regions LOG info region getRegionInfo RetryCounter retrier RetryCounter TimeUnit SECONDS region getRegionInfo LOG warn
List HRegion regions TEST_UTIL getMiniHBaseCluster getRegions TABLE_NAME LOG info Bytes toStringBinary splitPoint regions size HRegion region regions LOG info region getRegionInfo region compact HRegion region regions LOG info region getRegionInfo RetryCounter retrier RetryCounter TimeUnit SECONDS region getRegionInfo LOG warn retrier
region flush put Put ROW1 put addColumn FAMILY QUALIFIER data table put put region flush QUALIFIER2 Bytes add QUALIFIER QUALIFIER put Put ROW2 put addColumn FAMILY QUALIFIER2 data2 table put put put Put ROW3 put addColumn FAMILY QUALIFIER2 data2 table put put region flush ServerName rs Iterables getOnlyElement TEST_UTIL getAdmin getRegionServers regionCount TEST_UTIL getAdmin getRegions rs size
put Put ROW2 put addColumn FAMILY QUALIFIER2 data2 table put put put Put ROW3 put addColumn FAMILY QUALIFIER2 data2 table put put region flush ServerName rs Iterables getOnlyElement TEST_UTIL getAdmin getRegionServers regionCount TEST_UTIL getAdmin getRegions rs size LOG info Bytes toString ROW1 region getRegionInfo regionCount TEST_UTIL getAdmin split tableName ROW1 TEST_UTIL waitFor TEST_UTIL getAdmin getRegions rs size regionCount region compact List HRegion regions TEST_UTIL getMiniHBaseCluster getRegionServer rs getRegions HRegion regions
cache CachedBlock iterator refCount iterator CachedBlock next iterator next BlockCacheKey cacheKey BlockCacheKey next getFilename next getOffset cache BucketCache refCount BucketCache cache getRpcRefCount cacheKey
TableDescriptor htd TableDescriptorBuilder newBuilder tableName setColumnFamily ColumnFamilyDescriptorBuilder of FAM_NAM setCoprocessor CoprocessorDescriptorBuilder newBuilder SleepAndFailFirstTime getName setProperty SleepAndFailFirstTime SLEEP_TIME_CONF_KEY String valueOf build build TEST_UTIL getAdmin createTable htd Configuration c Configuration TEST_UTIL getConfiguration c setInt HConstants HBASE_CLIENT_PAUSE c setInt HConstants HBASE_RPC_TIMEOUT_KEY c SleepAndFailFirstTime ct set table tableName build table get Get FAM_NAM SleepAndFailFirstTime ct set table tableName build table get Get FAM_NAM fail
AtomicInteger noEx AtomicInteger AtomicInteger badEx AtomicInteger AtomicInteger noInt AtomicInteger AtomicInteger done AtomicInteger List Thread threads ArrayList nbThread nbThread Thread Thread Table ht util getConnection getTable tableName Result r ht get Get row1 noEx incrementAndGet
LOG info t1 System currentTimeMillis result scanner next assertTrue System currentTimeMillis t1 rpcTimeout assertTrue Bytes equals r2 result getRow RSRpcServicesWithScanTimeout seqNoToSleepOn result scanner next assertTrue Bytes equals r3 result getRow scanner close scanner ht getScanner scan RSRpcServicesWithScanTimeout sleepAlways RSRpcServicesWithScanTimeout tryNumber result scanner next
Put put Put ROW put addColumn FAM_NAM ROW ROW table put put AtomicInteger step AtomicInteger AtomicReference Throwable failed AtomicReference done step set step get Get get Get ROW table get get done done
AtomicReference Throwable failed AtomicReference Thread t Thread done step set step get Get get Get ROW table get get done done LOG info done Thread sleep Throwable t failed set t
Thread sleep t failed set t LOG error t toString t step set t start step get ServerName sn rl connection sn rl getRegionLocation ROW getServerName RpcClient rpcClient AsyncConnectionImpl connection toAsyncConnection rpcClient
e LOG error e fail tableName metaTable TEST_UTIL metaTable TEST_UTIL tableName result Delete d Delete result getRow d addColumn HConstants CATALOG_FAMILY HConstants REGIONINFO_QUALIFIER LOG info d metaTable delete d admin disableTable tableName TEST_UTIL waitTableDisabled tableName getName deleteTable TEST_UTIL tableName
metaTable TEST_UTIL tableName result Delete d Delete result getRow d addColumn HConstants CATALOG_FAMILY HConstants REGIONINFO_QUALIFIER LOG info d metaTable delete d admin disableTable tableName TEST_UTIL waitTableDisabled tableName getName deleteTable TEST_UTIL tableName e LOG error e fail tableName rowCount
index i row Bytes toBytes index value Bytes toBytes index Put put Put row put addColumn FAMILY QUALIFIER value ht put put Get get Get row Result result ht get get returnedValue result getValue FAMILY QUALIFIER Bytes value returnedValue successCnt getAndIncrement
SuspendProcedure proc SuspendProcedure procId procExec submitProcedure proc Thread sleep List Long pids Arrays Long asList procId List Boolean results getHbck bypassProcedure pids assertTrue results get TEST_UTIL waitFor proc isSuccess proc isBypass
Hbck hbck getHbck admin TEST_UTIL List RegionInfo regions admin getRegions TABLE_NAME RegionInfo ri regions RegionState rs TEST_UTIL getHBaseCluster getMaster getAssignmentManager getRegionStates getRegionState ri getEncodedName
RegionState rs TEST_UTIL getHBaseCluster getMaster getAssignmentManager getRegionStates getRegionState ri getEncodedName LOG info rs toString List Long pids hbck unassigns regions stream map r r getEncodedName collect Collectors toList waitOnPids pids pids hbck unassigns regions stream map r r getEncodedName collect Collectors toList waitOnPids pids pid pids assertEquals Procedure NO_PROC_ID pid pids hbck unassigns regions stream map r r getEncodedName collect Collectors toList waitOnPids pids pid pids assertNotEquals Procedure NO_PROC_ID pid hbck bypassProcedure pids ri regions RegionState rs TEST_UTIL getHBaseCluster getMaster getAssignmentManager getRegionStates getRegionState ri getEncodedName
pids hbck unassigns regions stream map r r getEncodedName collect Collectors toList waitOnPids pids pid pids assertNotEquals Procedure NO_PROC_ID pid hbck bypassProcedure pids ri regions RegionState rs TEST_UTIL getHBaseCluster getMaster getAssignmentManager getRegionStates getRegionState ri getEncodedName LOG info rs toString assertTrue rs toString rs isClosed pids hbck assigns regions stream map r r getEncodedName collect Collectors toList waitOnPids pids pids hbck assigns regions stream map r r getEncodedName collect Collectors toList pid pids assertEquals Procedure NO_PROC_ID pid ri regions
HRegionServer testRs TEST_UTIL getRSForFirstRegionInTable TABLE_NAME TEST_UTIL loadTable TEST_UTIL getConnection getTable TABLE_NAME Bytes toBytes ServerName serverName testRs getServerName Hbck hbck getHbck List Long pids hbck scheduleServerCrashProcedure Arrays asList ProtobufUtil toServerName serverName assertTrue pids get
HRegionServer testRs TEST_UTIL getRSForFirstRegionInTable TABLE_NAME TEST_UTIL loadTable TEST_UTIL getConnection getTable TABLE_NAME Bytes toBytes ServerName serverName testRs getServerName Hbck hbck getHbck List Long pids hbck scheduleServerCrashProcedure Arrays asList ProtobufUtil toServerName serverName assertTrue pids get LOG info pids get List Long newPids hbck scheduleServerCrashProcedure Arrays asList ProtobufUtil toServerName serverName assertTrue newPids get
Configuration conf TEST_UTIL getConfiguration ZKWatcher zkw TEST_UTIL getZooKeeperWatcher String baseZNode conf get HConstants ZOOKEEPER_ZNODE_PARENT HConstants DEFAULT_ZOOKEEPER_ZNODE_PARENT String primaryMetaZnode ZNodePaths joinZNode baseZNode conf get data ZKUtil getData zkw primaryMetaZnode ServerName currentServer ProtobufUtil toServerName data Collection ServerName liveServers TEST_UTIL getAdmin getClusterMetrics EnumSet of Option LIVE_SERVERS getLiveServerMetrics keySet ServerName moveToServer liveServers stream filter s currentServer equals s findAny get TableName tableName name getTableName TEST_UTIL createTable tableName assertTrue TEST_UTIL getAdmin tableExists tableName TEST_UTIL getAdmin move RegionInfoBuilder FIRST_META_REGIONINFO getEncodedNameAsBytes moveToServer assertNotEquals currentServer moveToServer
util ZKWatcher zkw util getZooKeeperWatcher Configuration conf util getConfiguration conf setBoolean HConstants USE_META_REPLICAS String baseZNode conf get HConstants ZOOKEEPER_ZNODE_PARENT HConstants DEFAULT_ZOOKEEPER_ZNODE_PARENT String primaryMetaZnode ZNodePaths joinZNode baseZNode conf get data ZKUtil getData zkw primaryMetaZnode ServerName primary ProtobufUtil toServerName data
ServerName master c util util TABLE util getAdmin flush TableName META_TABLE_NAME Thread sleep conf getInt StorefileRefresherChore REGIONSERVER_STOREFILE_REFRESH_PERIOD List RegionInfo regions MetaTableAccessor getTableRegions c TABLE HRegionLocation hrl MetaTableAccessor getRegionLocation c regions get hrl getServerName equals primary util getAdmin move hrl getRegion getEncodedNameAsBytes Thread sleep hrl MetaTableAccessor getRegionLocation c regions get primary equals hrl getServerName util getAdmin flush TableName META_TABLE_NAME Thread sleep conf getInt StorefileRefresherChore REGIONSERVER_STOREFILE_REFRESH_PERIOD
util getAdmin flush TableName META_TABLE_NAME Thread sleep conf getInt StorefileRefresherChore REGIONSERVER_STOREFILE_REFRESH_PERIOD List RegionInfo regions MetaTableAccessor getTableRegions c TABLE HRegionLocation hrl MetaTableAccessor getRegionLocation c regions get hrl getServerName equals primary util getAdmin move hrl getRegion getEncodedNameAsBytes Thread sleep hrl MetaTableAccessor getRegionLocation c regions get primary equals hrl getServerName util getAdmin flush TableName META_TABLE_NAME Thread sleep conf getInt StorefileRefresherChore REGIONSERVER_STOREFILE_REFRESH_PERIOD master util getHBaseClusterInterface getClusterMetrics getMasterName LOG info master toString util getHBaseClusterInterface stopMaster master
Integer putRows Integer Integer putColumns Integer Long putTimestamps Long Integer scanRows Integer Integer scanColumns Integer Long scanTimestamps Long scanMaxVersions put ht FAMILY putRows putColumns putTimestamps TEST_UTIL flush tableName Scan scan Scan scan readVersions ResultScanner scanner ht getScanner scan Result r scanner next r
HTU getConfiguration setBoolean HTU getConfiguration set TableDescriptorBuilder builder HTU createModifyableTableDescriptor TableName valueOf ColumnFamilyDescriptorBuilder DEFAULT_MIN_VERSIONS HConstants FOREVER ColumnFamilyDescriptorBuilder DEFAULT_KEEP_DELETED builder setRegionReplication NB_SERVERS builder setCoprocessor SlowMeCopro getName TableDescriptor hdt builder build Table table HTU createTable hdt f Put p Put row p addColumn f row row table put p HTU flush table getName Thread sleep REFRESH_PERIOD
put Put ROW i i QUALIFIERS i KeyValue kv KeyValue ROW FAMILY QUALIFIERS i i VALUE put add kv ht put put scan Scan withStartRow ROW scanner ht getScanner scan HRegionLocation loc locator TEST_UTIL loc locator getRegionLocation ROW RegionInfo hri loc getRegion MiniHBaseCluster cluster TEST_UTIL getMiniHBaseCluster regionName hri getRegionName i cluster getServerWith regionName HRegionServer rs cluster getRegionServer i
RegionInfo hri loc getRegion MiniHBaseCluster cluster TEST_UTIL getMiniHBaseCluster regionName hri getRegionName i cluster getServerWith regionName HRegionServer rs cluster getRegionServer i LOG info hri TEST_UTIL getAdmin unassign hri getRegionName startTime EnvironmentEdgeManager currentTime timeOut offline rs regionName offline assertTrue EnvironmentEdgeManager currentTime startTime timeOut
msg LOG info msg
expKvList msg LOG info msg LOG info expKvList size
TableName tn TableName valueOf name getMethodName Connection conn TEST_UTIL getConnection admin conn table conn tn ColumnFamilyDescriptorBuilder cfDescBuilder ColumnFamilyDescriptorBuilder newBuilder family TableDescriptorBuilder tableDescBuilder TableDescriptorBuilder newBuilder tn setColumnFamily cfDescBuilder build admin createTable tableDescBuilder build Put put Put row put addColumn family qualifier value table put put Get get Get row Result result table get get
Connection conn TEST_UTIL getConnection conn
Connection conn TEST_UTIL getConnection admin conn LOG debug admin listTableDescriptors MiniHBaseCluster cluster TEST_UTIL getHBaseCluster HMaster master cluster getMaster master stopMaster
admin move RegionInfoBuilder FIRST_META_REGIONINFO getEncodedNameAsBytes destServerName LOG debug RegionInfo region locator getRegionLocation row getRegion ServerName currentServer cluster getServerHoldingRegion tn region getRegionName rst cluster ServerName name rst getRegionServer getServerName name currentServer destServerName name admin move region getEncodedNameAsBytes destServerName LOG debug put Put row put addColumn family qualifier newVal table put put result table get get
put addColumn family qualifier value table put put conn clearRegionLocationCache clientZkCluster shutdown MiniHBaseCluster cluster TEST_UTIL getHBaseCluster metaServerId cluster getServerWithMeta HRegionServer metaServer cluster getRegionServer metaServerId metaServer stop metaServer Thread sleep AssignmentTestingUtil waitForAssignment cluster getMaster getAssignmentManager RegionInfoBuilder FIRST_META_REGIONINFO Thread sleep clientZkCluster startup clientZkDir Get get Get row Result result table get get
TableName tn TableName valueOf name getMethodName ColumnFamilyDescriptorBuilder cfDescBuilder ColumnFamilyDescriptorBuilder newBuilder family TableDescriptorBuilder tableDescBuilder TableDescriptorBuilder newBuilder tn setColumnFamily cfDescBuilder build ASYNC_CONN get ASYNC_CONN getAdmin createTable tableDescBuilder build get AsyncTable table ASYNC_CONN getTable tn Put put Put row put addColumn family qualifier value table put put get Get get Get row Result result table get get get
TEST_UTIL locator HRegionLocation hrl locator getRegionLocations HConstants EMPTY_START_ROW get ServerName oldServer hrl getServerName TEST_UTIL getHBaseClusterInterface killRegionServer oldServer
Admin admin UTIL getAdmin SnapshotTestingUtils assertNoSnapshots admin Table table UTIL getConnection getTable TABLE_NAME UTIL loadTable table TEST_FAM table close String snapshot1 admin snapshot snapshot1 TABLE_NAME LOG debug String snapshot2 admin snapshot snapshot2 TABLE_NAME LOG debug String snapshot3 admin snapshot snapshot3 TABLE_NAME
Admin admin UTIL getAdmin SnapshotTestingUtils assertNoSnapshots admin String tableName fail admin getDescriptor TableName valueOf tableName fail
String tableName fail admin getDescriptor TableName valueOf tableName fail LOG error tableName tableName tableName fail fail admin snapshot TableName valueOf tableName fail
Admin admin TableName tableName TableName valueOf name getMethodName admin UTIL getAdmin TableDescriptor htd TableDescriptorBuilder newBuilder tableName build UTIL createTable htd TEST_FAM UTIL getConfiguration String table1Snapshot1 admin snapshot table1Snapshot1 TABLE_NAME LOG debug String table1Snapshot2 admin snapshot table1Snapshot2 TABLE_NAME LOG debug String table2Snapshot1 admin snapshot table2Snapshot1 tableName
Admin admin admin UTIL getAdmin String table1Snapshot1 admin snapshot table1Snapshot1 TABLE_NAME LOG debug String table1Snapshot2 admin snapshot table1Snapshot2 TABLE_NAME LOG debug String table2Snapshot1 admin snapshot table2Snapshot1 TABLE_NAME
Admin admin TableName tableName TableName valueOf name getMethodName admin UTIL getAdmin TableDescriptor htd TableDescriptorBuilder newBuilder tableName build UTIL createTable htd TEST_FAM UTIL getConfiguration String table1Snapshot1 admin snapshot table1Snapshot1 TABLE_NAME LOG debug String table1Snapshot2 admin snapshot table1Snapshot2 TABLE_NAME LOG debug String table2Snapshot1 admin snapshot table2Snapshot1 tableName
Admin admin Pattern tableNamePattern Pattern compile admin UTIL getAdmin String table1Snapshot1 admin snapshot table1Snapshot1 TABLE_NAME LOG debug String table1Snapshot2 admin snapshot table1Snapshot2 TABLE_NAME LOG debug String table2Snapshot1 admin snapshot table2Snapshot1 TABLE_NAME
TableName tableName TableName valueOf name getMethodName TEST_UTIL createTable tableName Bytes toBytes splitKeys TEST_UTIL waitUntilAllRegionsAssigned tableName checkIfFavoredNodeInformationIsCorrect tableName RegionLocator locator TEST_UTIL getConnection getRegionLocator tableName RegionInfo regionA locator getRegionLocation HConstants EMPTY_START_ROW getRegion RegionInfo regionB locator getRegionLocation splitKeys getRegion List ServerName regionAFN fnm getFavoredNodes regionA
TableName tableName TableName valueOf name getMethodName TEST_UTIL createTable tableName Bytes toBytes splitKeys TEST_UTIL waitUntilAllRegionsAssigned tableName checkIfFavoredNodeInformationIsCorrect tableName RegionLocator locator TEST_UTIL getConnection getRegionLocator tableName RegionInfo regionA locator getRegionLocation HConstants EMPTY_START_ROW getRegion RegionInfo regionB locator getRegionLocation splitKeys getRegion List ServerName regionAFN fnm getFavoredNodes regionA LOG info regionA getEncodedName fnm getFavoredNodes regionA
regionFs hasReferences admin getDescriptor tableName e LOG warn e UTIL getMiniHBaseCluster getMaster getCatalogJanitor choreForTesting UTIL Path tableDir CommonFSUtils getTableDir rootDir tableName fileStatus tableDir String name fileStatus getPath getName name name e
MiniHBaseCluster cluster UTIL getHBaseCluster HMaster master cluster getMaster MasterCoprocessorHost host master getMasterCoprocessorHost CPMasterObserver cp host findCoprocessor CPMasterObserver cp resetStates Table table UTIL createMultiRegionTable tableName TEST_FAMILY r UTIL tableName UTIL waitUntilAllRegionsAssigned tableName List HRegionLocation regions r getAllRegionLocations HRegionLocation firstGoodPair HRegionLocation e regions e firstGoodPair e assertNotNull firstGoodPair
cp resetStates Table table UTIL createMultiRegionTable tableName TEST_FAMILY r UTIL tableName UTIL waitUntilAllRegionsAssigned tableName List HRegionLocation regions r getAllRegionLocations HRegionLocation firstGoodPair HRegionLocation e regions e getServerName firstGoodPair e assertNotNull firstGoodPair LOG info firstGoodPair toString Collection ServerName servers master getClusterMetrics getLiveServerMetrics keySet String destName String serverNameForFirstRegion firstGoodPair getServerName toString
List HRegionLocation regions r getAllRegionLocations HRegionLocation firstGoodPair HRegionLocation e regions e getServerName firstGoodPair e assertNotNull firstGoodPair LOG info firstGoodPair toString Collection ServerName servers master getClusterMetrics getLiveServerMetrics keySet String destName String serverNameForFirstRegion firstGoodPair getServerName toString LOG info serverNameForFirstRegion ServerName masterServerName master getServerName found ServerName info servers
assertNotNull firstGoodPair LOG info firstGoodPair toString Collection ServerName servers master getClusterMetrics getLiveServerMetrics keySet String destName String serverNameForFirstRegion firstGoodPair getServerName toString LOG info serverNameForFirstRegion ServerName masterServerName master getServerName found ServerName info servers LOG info info serverNameForFirstRegion info getServerName masterServerName info destName info toString found assertTrue found
Configuration conf UTIL getConfiguration UTIL getConfiguration set MetaTableMetrics getName conf set CoprocessorHost REGIONSERVER_COPROCESSOR_CONF_KEY JMXListener getName Random rand Random i i i sign i connectorPort sign rand nextInt HBaseTestingUtility available connectorPort conf setInt connectorPort UTIL startMiniCluster
Random rand Random i i i sign i connectorPort sign rand nextInt HBaseTestingUtility available connectorPort conf setInt connectorPort UTIL startMiniCluster e LOG debug connectorPort e UTIL shutdownMiniCluster
UTIL getAdmin createTable TableDescriptorBuilder newBuilder NAME1 setColumnFamily CFD build assertTrue UTIL getAdmin isTableEnabled NAME1 readWriteData NAME1 UTIL deleteTable NAME1 UTIL Map String Double jmxMetrics readMetaTableJmxMetrics allMetricsFound AllOf allOf containsPositiveJmxAttributesFor containsPositiveJmxAttributesFor containsPositiveJmxAttributesFor containsPositiveJmxAttributesFor containsPositiveJmxAttributesFor NAME1 containsPositiveJmxAttributesFor containsPositiveJmxAttributesFor containsPositiveJmxAttributesFor containsPositiveJmxAttributesFor matches jmxMetrics allMetricsFound
Map String Double existingAttrs HashMap attrInfo Object value mb getAttribute target attrInfo getName attrInfo getName value existingAttrs put attrInfo getName Double parseDouble value toString LOG info target existingAttrs e LOG warn target e mb Set ObjectInstance instances mb queryMBeans Iterator ObjectInstance iterator instances iterator LOG debug iterator ObjectInstance instance iterator next
i
assertNotNull cp EvenOnlyCompactor compactor EvenOnlyCompactor cp ts System currentTimeMillis admin flush compactTable compactor lastFlush ts Thread sleep assertTrue compactor lastFlush ts LOG debug ts compactor lastFlush admin majorCompact compactTable compactor ts
Configuration conf TEST_UTIL getConfiguration conf setStrings CoprocessorHost WAL_COPROCESSOR_CONF_KEY SampleRegionWALCoprocessor getName conf set CoprocessorHost REGION_COPROCESSOR_CONF_KEY SampleRegionWALCoprocessor getName conf setInt TEST_UTIL startMiniCluster Path hbaseRootDir TEST_UTIL getDFSCluster getFileSystem makeQualified Path Path hbaseWALRootDir TEST_UTIL getDFSCluster getFileSystem makeQualified Path
WAL wal wals getWAL WALEdit edit WALEdit now EnvironmentEdgeManager currentTime countPerFamily NavigableMap Integer scopes TreeMap Bytes BYTES_COMPARATOR fam scopes put fam fam addWALEdits tableName hri TEST_ROW fam countPerFamily EnvironmentEdgeManager getDelegate wal scopes mvcc wal appendData hri WALKeyImpl hri getEncodedNameAsBytes tableName now mvcc scopes edit wal sync User user HBaseTestingUtility getDifferentUser newConf user Path p runWALSplit newConf
Path c List Path splits WALSplitter split hbaseRootDir logDir oldLogDir FileSystem get c c wals assertEquals splits size assertTrue fs exists splits get
status StringWriter sw StringWriter status dumpTo sw String dump sw toString
s InternalScanner scanner region getScanner s List Cell results ArrayList i cells done done i done scanner next results Arrays sort results toArray Cell results size CellComparatorImpl COMPARATOR
p setDurability Durability SKIP_WAL p addColumn family qualifier Bytes toBytes String valueOf i testRegion put p testRegion flush PrefixFilter pf PrefixFilter SingleColumnValueFilter scvf SingleColumnValueFilter family qualifier CompareOperator EQUAL Bytes toBytes FilterList filterList FilterList Operator MUST_PASS_ONE pf scvf Scan s1 Scan s1 setFilter filterList InternalScanner scanner testRegion getScanner s1 List Cell results ArrayList resultCount scanner results resultCount row CellUtil cloneRow results get
s InternalScanner scanner region getScanner s List Cell results ArrayList i done done i done scanner next results Arrays sort results toArray Cell results size CellComparator getInstance
s InternalScanner scanner region getScanner s List Cell results ArrayList i done done i done scanner next results Arrays sort results toArray Cell results size CellComparator getInstance
s kvs InternalScanner scanner region getScanner s List Cell results ArrayList row idx done done row done scanner next results Arrays sort results toArray Cell results size CellComparator getInstance results isEmpty assertTrue kvs length results size idx results isEmpty results get toString kvs length idx results size Cell results
s kvs InternalScanner scanner region getScanner s List Cell results ArrayList row idx more more row more scanner next results Arrays sort results toArray Cell results size CellComparator getInstance results isEmpty assertTrue kvs length results size idx results isEmpty results get toString kvs length idx results size Cell results
row idx more more row more scanner next results Arrays sort results toArray Cell results size CellComparator getInstance results isEmpty assertTrue kvs length results size idx results isEmpty results get toString kvs length idx results size Cell kv results LOG info row kv toString kvs idx toString assertTrue CellUtil matchingRows kv kvs idx assertTrue CellUtil matchingFamily kv kvs idx assertTrue CellUtil matchingQualifier kv kvs idx assertFalse CellUtil matchingValue kv kvs idx assertEquals Bytes SIZEOF_INT kv getValueLength
CF2 Bytes toBytes Put put1 Put Bytes toBytes put1 addColumn CF1 Bytes toBytes Bytes toBytes table put put1 Put put2 Put Bytes toBytes put2 addColumn CF2 Bytes toBytes Bytes toBytes table put put2 FamilyFilter filterCF1 FamilyFilter CompareOperator EQUAL BinaryComparator CF1 FamilyFilter filterCF2 FamilyFilter CompareOperator EQUAL BinaryComparator CF2 FilterList filterList FilterList FilterList Operator MUST_PASS_ONE filterList addFilter filterCF1 filterList addFilter filterCF2 Scan scan Scan scan setFilter filterList ResultScanner scanner table getScanner scan
scan readAllVersions blocksStart getBlkAccessCount List RowRange ranges1 ArrayList ranges1 add RowRange Bytes toBytes Bytes toBytes ranges1 add RowRange Bytes toBytes Bytes toBytes MultiRowRangeFilter filter1 MultiRowRangeFilter ranges1 List RowRange ranges2 ArrayList ranges2 add RowRange Bytes toBytes Bytes toBytes ranges2 add RowRange Bytes toBytes Bytes toBytes MultiRowRangeFilter filter2 MultiRowRangeFilter ranges2 FilterList filterList FilterList FilterList Operator MUST_PASS_ONE filterList addFilter filter1 filterList addFilter filter2 scan setFilter filterList resultsSize getResultsSize ht scan
List RowRange ranges2 ArrayList ranges2 add RowRange Bytes toBytes Bytes toBytes ranges2 add RowRange Bytes toBytes Bytes toBytes MultiRowRangeFilter filter2 MultiRowRangeFilter ranges2 FilterList filterList FilterList FilterList Operator MUST_PASS_ONE filterList addFilter filter1 filterList addFilter filter2 scan setFilter filterList resultsSize getResultsSize ht scan LOG info resultsSize List Cell results1 getScanResult Bytes toBytes Bytes toBytes ht List Cell results2 getScanResult Bytes toBytes Bytes toBytes ht assertEquals results1 size results2 size resultsSize blocksEnd getBlkAccessCount diff blocksEnd blocksStart
kv_number Scan scan Scan scan setBatch SingleColumnValueFilter filter SingleColumnValueFilter Bytes toBytes columnFamily Bytes toBytes CompareOperator EQUAL SubstringComparator scan setFilter filter Table table openTable tableName ResultScanner scanner table getScanner scan scanner kv_number
row_number Scan scan Scan List Filter fs ArrayList DependentColumnFilter f1 DependentColumnFilter Bytes toBytes Bytes toBytes CompareOperator EQUAL SubstringComparator PageFilter f2 PageFilter fs add f1 fs add f2 FilterList filter FilterList fs scan setFilter filter Table table connection getTable name ResultScanner scanner table getScanner scan scanner row_number
family qf a a a b b b c c c d d d key Bytes putInt key a Bytes putInt key b Bytes putInt key c Bytes putInt key d Put row Put key c row addColumn family qf Bytes toBytes
c c c d d d key Bytes putInt key a Bytes putInt key b Bytes putInt key c Bytes putInt key d Put row Put key c row addColumn family qf Bytes toBytes LOG LOG info Arrays toString Hex encodeHex key row addColumn family qf Bytes toBytes LOG
i1 i1 i1 i2 i2 i2 rk ByteBuffer buf ByteBuffer wrap rk buf clear buf putShort buf putInt i1 buf putInt i2 c c c cq Bytes putBytes cq Bytes toBytes c Put p Put rk p setDurability Durability SKIP_WAL p addColumn Bytes toBytes cf cq Bytes toBytes c ht put p
hTable filters String cf Scan scan Scan scan addFamily Bytes toBytes cf FilterList filterList FilterList filters scan setFilter filterList ResultScanner scanner hTable getScanner scan List Cell results ArrayList Result result timeBeforeScan System currentTimeMillis result scanner Cell result
String cf Scan scan Scan scan addFamily Bytes toBytes cf FilterList filterList FilterList filters scan setFilter filterList ResultScanner scanner hTable getScanner scan List Cell results ArrayList Result result timeBeforeScan System currentTimeMillis result scanner Cell kv result LOG info Bytes toStringBinary CellUtil cloneRow kv Bytes toStringBinary CellUtil cloneQualifier kv results add kv scanTime System currentTimeMillis timeBeforeScan scanner close
Scan scan Scan scan addFamily Bytes toBytes cf FilterList filterList FilterList filters scan setFilter filterList ResultScanner scanner hTable getScanner scan List Cell results ArrayList Result result timeBeforeScan System currentTimeMillis result scanner Cell kv result LOG info Bytes toStringBinary CellUtil cloneRow kv Bytes toStringBinary CellUtil cloneQualifier kv results add kv scanTime System currentTimeMillis timeBeforeScan scanner close LOG info scanTime
scan addFamily Bytes toBytes cf scan setFilter filter List HRegion regions TEST_UTIL getHBaseCluster getRegions TableName valueOf table HRegion first regions get first getScanner scan RegionScanner scanner first getScanner scan List Cell results ArrayList timeBeforeScan System currentTimeMillis found scanner results found results size results clear found results size scanTime System currentTimeMillis timeBeforeScan scanner close
scan setFilter filter List HRegion regions TEST_UTIL getHBaseCluster getRegions TableName valueOf table HRegion first regions get first getScanner scan RegionScanner scanner first getScanner scan List Cell results ArrayList timeBeforeScan System currentTimeMillis found scanner results found results size results clear found results size scanTime System currentTimeMillis timeBeforeScan scanner close LOG info scanTime
i1 i1 i1 i2 i2 i2 rk ByteBuffer buf ByteBuffer wrap rk buf clear buf putShort buf putInt i1 buf putInt i2 c c c cq Bytes putBytes cq Bytes toBytes c Put p Put rk p setDurability Durability SKIP_WAL p addColumn Bytes toBytes cf cq Bytes toBytes c ht put p
hTable filter1 filter2 String cf Scan scan Scan scan addFamily Bytes toBytes cf FilterList filterList FilterList Operator MUST_PASS_ALL filter1 filter2 scan setFilter filterList ResultScanner scanner hTable getScanner scan List Cell results ArrayList Result result timeBeforeScan System currentTimeMillis result scanner Cell result
String cf Scan scan Scan scan addFamily Bytes toBytes cf FilterList filterList FilterList Operator MUST_PASS_ALL filter1 filter2 scan setFilter filterList ResultScanner scanner hTable getScanner scan List Cell results ArrayList Result result timeBeforeScan System currentTimeMillis result scanner Cell kv result LOG info Bytes toStringBinary CellUtil cloneRow kv Bytes toStringBinary CellUtil cloneQualifier kv results add kv scanTime System currentTimeMillis timeBeforeScan scanner close
Scan scan Scan scan addFamily Bytes toBytes cf FilterList filterList FilterList Operator MUST_PASS_ALL filter1 filter2 scan setFilter filterList ResultScanner scanner hTable getScanner scan List Cell results ArrayList Result result timeBeforeScan System currentTimeMillis result scanner Cell kv result LOG info Bytes toStringBinary CellUtil cloneRow kv Bytes toStringBinary CellUtil cloneQualifier kv results add kv scanTime System currentTimeMillis timeBeforeScan scanner close LOG info scanTime
tableName TableName valueOf name getMethodName Table ht TEST_UTIL createTable tableName family Integer MAX_VALUE generateRows numRows ht family qf value Scan scan Scan scan readAllVersions List RowRange ranges ArrayList ranges add RowRange Bytes toBytes Bytes toBytes ranges add RowRange Bytes toBytes Bytes toBytes ranges add RowRange Bytes toBytes Bytes toBytes ranges add RowRange Bytes toBytes ranges add RowRange Bytes toBytes Bytes toBytes MultiRowRangeFilter filter MultiRowRangeFilter ranges scan setFilter filter resultsSize getResultsSize ht scan
tableName TableName valueOf name getMethodName Table ht TEST_UTIL createTable tableName family Integer MAX_VALUE generateRows numRows ht family qf value Scan scan Scan scan readAllVersions List RowRange ranges ArrayList ranges add RowRange Bytes toBytes Bytes toBytes ranges add RowRange Bytes toBytes Bytes toBytes ranges add RowRange Bytes toBytes Bytes toBytes MultiRowRangeFilter filter MultiRowRangeFilter ranges scan setFilter filter resultsSize getResultsSize ht scan
tableName TableName valueOf name getMethodName Table ht TEST_UTIL createTable tableName family Integer MAX_VALUE generateRows numRows ht family qf value Scan scan Scan scan readAllVersions List RowRange ranges ArrayList ranges add RowRange Bytes toBytes Bytes toBytes ranges add RowRange Bytes toBytes Bytes toBytes ranges add RowRange Bytes toBytes Bytes toBytes ranges add RowRange Bytes toBytes ranges add RowRange Bytes toBytes Bytes toBytes MultiRowRangeFilter filter MultiRowRangeFilter ranges scan setFilter filter resultsSize getResultsSize ht scan
tableName TableName valueOf name getMethodName TEST_UTIL getConfiguration setInt HConstants HBASE_CLIENT_SCANNER_TIMEOUT_PERIOD TEST_UTIL createTable tableName family Integer MAX_VALUE ht TEST_UTIL tableName generateRows numRows ht family qf value Scan scan Scan scan readAllVersions List RowRange ranges ArrayList ranges add RowRange Bytes toBytes Bytes toBytes ranges add RowRange Bytes toBytes Bytes toBytes ranges add RowRange Bytes toBytes Bytes toBytes MultiRowRangeFilter filter MultiRowRangeFilter ranges scan setFilter filter resultsSize getResultsSize ht scan
scan readAllVersions List RowRange ranges1 ArrayList ranges1 add RowRange Bytes toBytes Bytes toBytes ranges1 add RowRange Bytes toBytes Bytes toBytes ranges1 add RowRange Bytes toBytes Bytes toBytes MultiRowRangeFilter filter1 MultiRowRangeFilter ranges1 List RowRange ranges2 ArrayList ranges2 add RowRange Bytes toBytes Bytes toBytes ranges2 add RowRange Bytes toBytes Bytes toBytes MultiRowRangeFilter filter2 MultiRowRangeFilter ranges2 FilterList filterList FilterList FilterList Operator MUST_PASS_ALL filterList addFilter filter1 filterList addFilter filter2 scan setFilter filterList resultsSize getResultsSize ht scan
scan readAllVersions List RowRange ranges1 ArrayList ranges1 add RowRange Bytes toBytes Bytes toBytes ranges1 add RowRange Bytes toBytes Bytes toBytes ranges1 add RowRange Bytes toBytes Bytes toBytes MultiRowRangeFilter filter1 MultiRowRangeFilter ranges1 List RowRange ranges2 ArrayList ranges2 add RowRange Bytes toBytes Bytes toBytes ranges2 add RowRange Bytes toBytes Bytes toBytes MultiRowRangeFilter filter2 MultiRowRangeFilter ranges2 FilterList filterList FilterList FilterList Operator MUST_PASS_ONE filterList addFilter filter1 filterList addFilter filter2 scan setFilter filterList resultsSize getResultsSize ht scan
s InternalScanner scanner region getScanner s List Cell results ArrayList i done done i done scanner next results Arrays sort results toArray Cell results size CellComparator getInstance
FSDataInputStream fin dfs open p Assert assertTrue toWrite fin readDouble end System currentTimeMillis LOG info end start fin close Assert assertTrue end start FileStatus f dfs getFileStatus p BlockLocation lbs lbs dfs getFileBlockLocations f lbs length lbs getLength repCount String name lbs getNames Assert assertTrue name indexOf String portS name substring name indexOf port Integer parseInt portS
lbs length lbs getLength repCount String name lbs getNames Assert assertTrue name indexOf String portS name substring name indexOf port Integer parseInt portS LOG info port ipcPort ok String lookup lbs getHosts StringBuilder sb StringBuilder dn String dnName getHostName dn sb append dnName append lookup dnName ok
Assert assertTrue name indexOf String portS name substring name indexOf port Integer parseInt portS LOG info port ipcPort ok String lookup lbs getHosts StringBuilder sb StringBuilder dn String dnName getHostName dn sb append dnName append lookup dnName ok LOG info name lookup ipcPort dn ipcServer getListenerAddress getPort
LOG info port ipcPort ok String lookup lbs getHosts StringBuilder sb StringBuilder dn String dnName getHostName dn sb append dnName append lookup dnName ok LOG info name lookup ipcPort dn ipcServer getListenerAddress getPort dn shutdown LOG info name lookup
sb Bytes toBytes htu startMiniZKCluster MiniHBaseCluster hbm htu startMiniHBaseCluster hbm waitForActiveAndReadyMaster HRegionServer targetRs LoadBalancer isTablesOnMaster hbm getConf hbm getMaster hbm getRegionServer String host4 targetRs getServerName getHostname
htu getAdmin rollWALWriter targetRs getServerName latch await LOG warn targetRs Thread currentThread interrupt region HRegion region getWAL unregisterWALActionsListener listener Thread sleep Put p Put sb p addColumn sb sb sb h put p DirectoryListing dl dfs getClient listPaths rootDir HdfsFileStatus EMPTY_NAME HdfsFileStatus hfs dl getPartialListing Assert assertTrue hfs length
Thread currentThread interrupt region HRegion region getWAL unregisterWALActionsListener listener Thread sleep Put p Put sb p addColumn sb sb sb h put p DirectoryListing dl dfs getClient listPaths rootDir HdfsFileStatus EMPTY_NAME HdfsFileStatus hfs dl getPartialListing Assert assertTrue hfs length HdfsFileStatus hf hfs LOG info hf getLocalName rootDir String logFile rootDir hf getLocalName FileStatus fsLog rfs getFileStatus Path logFile
region HRegion region getWAL unregisterWALActionsListener listener Thread sleep Put p Put sb p addColumn sb sb sb h put p DirectoryListing dl dfs getClient listPaths rootDir HdfsFileStatus EMPTY_NAME HdfsFileStatus hfs dl getPartialListing Assert assertTrue hfs length HdfsFileStatus hf hfs LOG info hf getLocalName rootDir String logFile rootDir hf getLocalName FileStatus fsLog rfs getFileStatus Path logFile LOG info logFile
Thread sleep Put p Put sb p addColumn sb sb sb h put p DirectoryListing dl dfs getClient listPaths rootDir HdfsFileStatus EMPTY_NAME HdfsFileStatus hfs dl getPartialListing Assert assertTrue hfs length HdfsFileStatus hf hfs LOG info hf getLocalName rootDir String logFile rootDir hf getLocalName FileStatus fsLog rfs getFileStatus Path logFile LOG info logFile BlockLocation bls rfs getFileBlockLocations fsLog bls length
h put p DirectoryListing dl dfs getClient listPaths rootDir HdfsFileStatus EMPTY_NAME HdfsFileStatus hfs dl getPartialListing Assert assertTrue hfs length HdfsFileStatus hf hfs LOG info hf getLocalName rootDir String logFile rootDir hf getLocalName FileStatus fsLog rfs getFileStatus Path logFile LOG info logFile BlockLocation bls rfs getFileBlockLocations fsLog bls length BlockLocation bl bls LOG info bl getHosts length logFile bl getHosts length
LOG info hf getLocalName rootDir String logFile rootDir hf getLocalName FileStatus fsLog rfs getFileStatus Path logFile LOG info logFile BlockLocation bls rfs getFileBlockLocations fsLog bls length BlockLocation bl bls LOG info bl getHosts length logFile i i bl getHosts length i LOG info bl getHosts i logFile Assert assertNotSame bl getHosts i host4 String last bl getHosts bl getHosts length LOG info last logFile host4 last
String expectedAuthorizedContent expectedAuthorizedContent
RuntimeMXBean b ManagementFactory getRuntimeMXBean
RuntimeMXBean b ManagementFactory getRuntimeMXBean LOG info b getName
RuntimeMXBean b ManagementFactory getRuntimeMXBean LOG info b getName LOG info b getSpecName
RuntimeMXBean b ManagementFactory getRuntimeMXBean LOG info b getName LOG info b getSpecName LOG info b getSpecVendor
RuntimeMXBean b ManagementFactory getRuntimeMXBean LOG info b getName LOG info b getSpecName LOG info b getSpecVendor LOG info b getVmName
RuntimeMXBean b ManagementFactory getRuntimeMXBean LOG info b getName LOG info b getSpecName LOG info b getSpecVendor LOG info b getVmName LOG info b getVmVersion
RuntimeMXBean b ManagementFactory getRuntimeMXBean LOG info b getName LOG info b getSpecName LOG info b getSpecVendor LOG info b getVmName LOG info b getVmVersion LOG info b getVmVendor Map String String p b getSystemProperties
LOG info ClassSize OBJECT
List KeyValue sampleKv generator generateTestKeyValues NUMBER_OF_KV includesTags List DataBlockEncoder EncodedSeeker encodedSeekers ArrayList
conf set HConstants BUCKET_CACHE_IOENGINE_KEY conf setInt HConstants BUCKET_CACHE_SIZE_KEY BlockCache blockCache BlockCacheFactory createBlockCache conf assertTrue blockCache CombinedBlockCache logPerBlock blockCache count addDataAndHits blockCache count
conf set HConstants BUCKET_CACHE_IOENGINE_KEY conf setInt HConstants BUCKET_CACHE_SIZE_KEY BlockCache blockCache BlockCacheFactory createBlockCache conf assertTrue blockCache CombinedBlockCache logPerBlock blockCache count addDataAndHits blockCache count LOG info Objects toString blockCache getStats BlockCacheUtil CachedBlocksByFile cbsbf logPerBlock blockCache
conf set HConstants BUCKET_CACHE_IOENGINE_KEY conf setInt HConstants BUCKET_CACHE_SIZE_KEY BlockCache blockCache BlockCacheFactory createBlockCache conf assertTrue blockCache CombinedBlockCache logPerBlock blockCache count addDataAndHits blockCache count LOG info Objects toString blockCache getStats BlockCacheUtil CachedBlocksByFile cbsbf logPerBlock blockCache LOG info Objects toString cbsbf logPerFile cbsbf bucketCacheReport blockCache
CacheConfig cc CacheConfig conf assertTrue CacheConfig DEFAULT_IN_MEMORY cc isInMemory BlockCache blockCache BlockCacheFactory createBlockCache conf logPerBlock blockCache addDataAndHits blockCache
CacheConfig cc CacheConfig conf assertTrue CacheConfig DEFAULT_IN_MEMORY cc isInMemory BlockCache blockCache BlockCacheFactory createBlockCache conf logPerBlock blockCache addDataAndHits blockCache LOG info blockCache getBlockCount blockCache getCurrentSize blockCache getFreeSize
CacheConfig cc CacheConfig conf assertTrue CacheConfig DEFAULT_IN_MEMORY cc isInMemory BlockCache blockCache BlockCacheFactory createBlockCache conf logPerBlock blockCache addDataAndHits blockCache LOG info blockCache getBlockCount blockCache getCurrentSize blockCache getFreeSize LOG info Objects toString blockCache getStats BlockCacheUtil CachedBlocksByFile cbsbf logPerBlock blockCache
CacheConfig cc CacheConfig conf assertTrue CacheConfig DEFAULT_IN_MEMORY cc isInMemory BlockCache blockCache BlockCacheFactory createBlockCache conf logPerBlock blockCache addDataAndHits blockCache LOG info blockCache getBlockCount blockCache getCurrentSize blockCache getFreeSize LOG info Objects toString blockCache getStats BlockCacheUtil CachedBlocksByFile cbsbf logPerBlock blockCache LOG info Objects toString cbsbf logPerFile cbsbf bucketCacheReport blockCache
BlockCacheUtil CachedBlocksByFile BlockCacheUtil CachedBlocksByFile cbsbf BlockCacheUtil CachedBlocksByFile
HFile Reader reader HFile createReader fs storeFilePath cacheConf conf
bytesPerChecksum Path path Path TEST_UTIL getDataTestDir algo bytesPerChecksum FSDataOutputStream os fs create path HFileContext meta HFileContextBuilder withCompression algo withIncludesMvcc withIncludesTags useTags withHBaseCheckSum withBytesPerCheckSum bytesPerChecksum build HFileBlock Writer hbw HFileBlock Writer meta dataSize DataOutputStream dos hbw startWriting BlockType DATA dataSize bytesPerChecksum i i i dos writeInt i dataSize hbw writeHeaderAndData os totalSize hbw getOnDiskSizeWithHeader os close expectedChunks ChecksumUtil numChunks dataSize HConstants HFILEBLOCK_HEADER_SIZE bytesPerChecksum
ByteArrayInputStream bais ByteArrayInputStream bytes DataInputStream dis DataInputStream bais FixedFileTrailer t2 FixedFileTrailer version HFileReaderImpl PBUF_TRAILER_MINOR_VERSION t2 deserialize dis assertEquals bais read checkLoadedTrailer version t t2 Path trailerPath Path util getDataTestDir version invalidVersion bytes bytes length invalidVersion writeTrailer trailerPath bytes readTrailer trailerPath fail ex String msg ex getMessage
meta HFileContextBuilder withHBaseCheckSum withCompression algo withIncludesMvcc includesMemstoreTS withIncludesTags includesTag build ReaderContext context ReaderContextBuilder withInputStreamWrapper FSDataInputStreamWrapper is withFileSize totalSize withFilePath path withFileSystem fs build HFileBlock FSReaderImpl hbr HFileBlock FSReaderImpl context meta alloc hbr setDataBlockEncoder dataBlockEncoder hbr setIncludesMemStoreTS includesMemstoreTS HFileBlock blockFromHFile blockUnpacked pos blockId blockId blockId blockFromHFile hbr readBlockData pos pread assertEquals HFile getAndResetChecksumFailuresCount blockFromHFile sanityCheck pos blockFromHFile getOnDiskSizeWithHeader assertEquals encodedSizes get blockId blockFromHFile getUncompressedSizeWithoutHeader assertEquals meta isCompressedOrEncrypted blockFromHFile isUnpacked packedHeapsize blockFromHFile heapSize
Random rand defaultRandom
List Long expectedOffsets ArrayList List Long expectedPrevOffsets ArrayList List BlockType expectedTypes ArrayList List ByteBuffer expectedContents cacheOnWrite ArrayList totalSize writeBlocks rand algo path expectedOffsets expectedPrevOffsets expectedTypes expectedContents FSDataInputStream is fs open path HFileContext meta HFileContextBuilder withHBaseCheckSum withIncludesMvcc includesMemstoreTS withIncludesTags includesTag withCompression algo build ReaderContext context ReaderContextBuilder withInputStreamWrapper FSDataInputStreamWrapper is withFileSize totalSize withFilePath path withFileSystem fs build HFileBlock FSReader hbr HFileBlock FSReaderImpl context meta alloc curOffset i i i assertEquals is getPos curOffset i HConstants HFILEBLOCK_HEADER_SIZE assertEquals expectedOffsets get i longValue curOffset
List ByteBuffer expectedContents cacheOnWrite ArrayList totalSize writeBlocks rand algo path expectedOffsets expectedPrevOffsets expectedTypes expectedContents FSDataInputStream is fs open path HFileContext meta HFileContextBuilder withHBaseCheckSum withIncludesMvcc includesMemstoreTS withIncludesTags includesTag withCompression algo build ReaderContext context ReaderContextBuilder withInputStreamWrapper FSDataInputStreamWrapper is withFileSize totalSize withFilePath path withFileSystem fs build HFileBlock FSReader hbr HFileBlock FSReaderImpl context meta alloc curOffset i i i pread assertEquals is getPos curOffset i HConstants HFILEBLOCK_HEADER_SIZE assertEquals expectedOffsets get i longValue curOffset LOG info i curOffset HFileBlock b hbr readBlockData curOffset pread
List BlockType types ArrayList writeBlocks rand compressAlgo path offsets types FSDataInputStream is fs open path fileSize fs getFileStatus path getLen HFileContext meta HFileContextBuilder withHBaseCheckSum withIncludesMvcc includesMemstoreTS withIncludesTags includesTag withCompression compressAlgo build ReaderContext context ReaderContextBuilder withInputStreamWrapper FSDataInputStreamWrapper is withFileSize fileSize withFilePath path withFileSystem fs build HFileBlock FSReader hbr HFileBlock FSReaderImpl context meta alloc Executor exec Executors newFixedThreadPool NUM_READER_THREADS ExecutorCompletionService Boolean ecs ExecutorCompletionService exec i i NUM_READER_THREADS i ecs submit BlockReaderThread i hbr offsets types fileSize i i NUM_READER_THREADS i Future Boolean result ecs take assertTrue result get
size rand nextInt j j size j dos writeShort i dos writeInt j expectedOffsets expectedOffsets add os getPos expectedPrevOffsets Long prevOffset prevOffsetByType get bt expectedPrevOffsets add prevOffset prevOffset prevOffsetByType put bt os getPos expectedTypes add bt hbw writeHeaderAndData os totalSize hbw getOnDiskSizeWithHeader ByteBuff buff hbw cloneUncompressedBufferWithHeader expectedContents add buff asSubByteBuffer buff capacity
fileSize fs getFileStatus path getLen
LOG info keys size key keys assertTrue key assertTrue indexReader KeyValue KeyOnlyKeyValue keyOnlyKey KeyValue KeyOnlyKeyValue key key length HFileBlock b indexReader seekToDataBlock keyOnlyKey brw keyOnlyKey length assertTrue b i String keyStr i Bytes toStringBinary key assertTrue keyStr b b assertEquals expectedHitCount brw hitCount
j j j k KeyValue RandomKeyValueUtil randomOrderedKey rand i j family qualifier EnvironmentEdgeManager currentTime KeyValue Type Put getKey keys add k j firstKey k assertTrue firstKey firstKeyInFile firstKeyInFile firstKey biw addEntry firstKey blockOffset hbw getOnDiskSizeWithHeader writeInlineBlocks hbw outputStream biw writeInlineBlocks hbw outputStream biw rootIndexOffset biw writeIndexBlocks outputStream outputStream close numLevels biw getNumLevels numRootEntries biw getNumRootEntries
hbw outputStream biw biw offset outputStream getPos biw writeInlineBlock hbw startWriting biw getInlineBlockType hbw writeHeaderAndData outputStream biw blockWritten offset hbw getOnDiskSizeWithHeader hbw getUncompressedSizeWithoutHeader
dos writeInt numSearchedKeys curAllEntriesSize numEntriesAdded secondaryIndexEntries numTotalKeys i i numTotalKeys i k RandomKeyValueUtil randomOrderedKey rand i KeyValue cell KeyValue k Bytes toBytes Bytes toBytes Bytes toBytes keys add cell getKey String msgPrefix i Bytes toStringBinary k StringBuilder padding StringBuilder msgPrefix length padding length padding append msgPrefix padding i dos writeInt curAllEntriesSize secondaryIndexEntries i curAllEntriesSize
k RandomKeyValueUtil randomOrderedKey rand i KeyValue cell KeyValue k Bytes toBytes Bytes toBytes Bytes toBytes keys add cell getKey String msgPrefix i Bytes toStringBinary k StringBuilder padding StringBuilder msgPrefix length padding length padding append msgPrefix padding i dos writeInt curAllEntriesSize secondaryIndexEntries i curAllEntriesSize LOG info msgPrefix i curAllEntriesSize curAllEntriesSize cell getKey length HFileBlockIndex SECONDARY_INDEX_ENTRY_OVERHEAD numEntriesAdded secondaryIndexEntries i
LOG info msgPrefix i curAllEntriesSize curAllEntriesSize cell getKey length HFileBlockIndex SECONDARY_INDEX_ENTRY_OVERHEAD numEntriesAdded secondaryIndexEntries i LOG info msgPrefix i i keys size i assertTrue CellComparatorImpl COMPARATOR compare KeyValue KeyOnlyKeyValue keys get i keys get i length KeyValue KeyOnlyKeyValue keys get i keys get i length dos writeInt curAllEntriesSize assertEquals numSearchedKeys numEntriesAdded secondaryIndexOffset dos size assertEquals Bytes SIZEOF_INT numSearchedKeys secondaryIndexOffset i i i assertEquals dos size secondaryIndexOffset secondaryIndexEntries i dummyFileOffset getDummyFileOffset i dummyOnDiskSize getDummyOnDiskSize i
secondaryIndexEntries i LOG info msgPrefix i i keys size i assertTrue CellComparatorImpl COMPARATOR compare KeyValue KeyOnlyKeyValue keys get i keys get i length KeyValue KeyOnlyKeyValue keys get i keys get i length dos writeInt curAllEntriesSize assertEquals numSearchedKeys numEntriesAdded secondaryIndexOffset dos size assertEquals Bytes SIZEOF_INT numSearchedKeys secondaryIndexOffset i i i assertEquals dos size secondaryIndexOffset secondaryIndexEntries i dummyFileOffset getDummyFileOffset i dummyOnDiskSize getDummyOnDiskSize i LOG debug dummyFileOffset dummyOnDiskSize dos size dos writeLong dummyFileOffset dos writeInt dummyOnDiskSize
Path hfilePath Path TEST_UTIL getDataTestDir CacheConfig cacheConf CacheConfig conf BlockCacheFactory createBlockCache conf BlockCache blockCache cacheConf getBlockCache get testI testI INDEX_CHUNK_SIZES testI indexBlockSize INDEX_CHUNK_SIZES testI expectedNumLevels EXPECTED_NUM_LEVELS testI
qualifier Bytes toBytes i i i row RandomKeyValueUtil randomOrderedKey rand i KeyValue kv KeyValue row family qualifier EnvironmentEdgeManager currentTime RandomKeyValueUtil randomValue rand k kv getKey writer append kv keys i k values i CellUtil cloneValue kv keyStrSet add Bytes toStringBinary k i assertTrue PrivateCellUtil compare CellComparatorImpl COMPARATOR kv keys i keys i length writer close HFile Reader reader HFile createReader fs hfilePath cacheConf conf assertEquals expectedNumLevels reader getTrailer getNumDataIndexLevels assertTrue Bytes equals keys KeyValue reader getFirstKey get getKey
pos ctx HFileBlock hbr HFileBlock b hbr readBlockData pos assertEquals HFile getAndResetChecksumFailuresCount b sanityCheck assertFalse b isUnpacked b b unpack ctx hbr
RedundantKVGenerator generator RedundantKVGenerator List KeyValue testKvs generator generateTestKeyValues Configuration conf TEST_UTIL getConfiguration CacheConfig cacheConf CacheConfig conf encoding compression HFileContext fileContext HFileContextBuilder withBlockSize withEncryptionContext cryptoContext withCompression compression withDataBlockEncoding encoding build
LOG info fileContext i HFileScanner scanner HFile Reader reader HFile createReader fs path cacheConf conf FixedFileTrailer trailer reader getTrailer assertNotNull trailer getEncryptionKey scanner reader getScanner assertTrue scanner seekTo Cell kv scanner getCell assertTrue testKvs contains KeyValueUtil ensureKeyValue kv i scanner next
tagLen buf get buf get tagValue tagLen buf get tagValue ByteArrayInputStream byte_input ByteArrayInputStream buf array buf arrayOffset buf position buf remaining DataInputStream data_input DataInputStream byte_input memstoreTS WritableUtils readVLong data_input buf position buf position WritableUtils getVIntSize memstoreTS KeyValue kv keyValues get entriesRead assertTrue Bytes compareTo key kv getKey assertTrue Bytes compareTo value value length kv getValueArray kv getValueOffset kv getValueLength assertNotNull tagValue KeyValue tkv kv assertEquals tagValue length tkv getTagsLength
Cell midkey dataBlockIndexReader midkey reader Assert assertNotNull midkey metaBlockIndexReader readRootIndex blockIter nextBlockWithBlockType BlockType ROOT_INDEX getByteStream trailer getMetaIndexCount HFileInfo fileInfo HFileInfo fileInfo read blockIter nextBlockWithBlockType BlockType FILE_INFO getByteStream keyValueFormatVersion fileInfo get HFileWriterImpl KEY_VALUE_VERSION includeMemstoreTS keyValueFormatVersion Bytes toInt keyValueFormatVersion entriesRead blocksRead memstoreTS DataBlockEncoder encoder dataBlockEncoding getEncoder curBlockPos scanBlocks entryCount context keyValues fsdis trailer meta blockReader entriesRead blocksRead encoder metaCounter fsdis trailer
entriesRead blocksRead memstoreTS DataBlockEncoder encoder dataBlockEncoding getEncoder curBlockPos scanBlocks entryCount context keyValues fsdis trailer meta blockReader entriesRead blocksRead encoder metaCounter fsdis getPos trailer getLoadOnOpenDataOffset LOG info fsdis getPos trailer getLoadOnOpenDataOffset HFileBlock block blockReader readBlockData curBlockPos unpack context blockReader Assert assertEquals BlockType META block getBlockType Text t Text ByteBuff buf block getBufferWithoutHeader buf buf buf t IOException t getClass getSimpleName Text expectedText metaCounter Text metaCounter Text Text
maxSize HConstants DEFAULT_BLOCKSIZE Path hfilePath Path TEST_UTIL getDataTestDir HFileContext context HFileContextBuilder withCompression Compression Algorithm GZ build
maxSize HConstants DEFAULT_BLOCKSIZE Path hfilePath Path TEST_UTIL getDataTestDir HFileContext context HFileContextBuilder withCompression Compression Algorithm GZ build LOG info context Configuration lazyCompressDisabled HBaseConfiguration create TEST_UTIL getConfiguration lazyCompressDisabled setBoolean CacheConfig CACHE_BLOCKS_ON_WRITE_KEY cacheOnWrite lazyCompressDisabled setBoolean CacheConfig CACHE_BLOOM_BLOCKS_ON_WRITE_KEY cacheOnWrite lazyCompressDisabled setBoolean CacheConfig CACHE_INDEX_BLOCKS_ON_WRITE_KEY cacheOnWrite lazyCompressDisabled setBoolean CacheConfig CACHE_DATA_BLOCKS_COMPRESSED_KEY CacheConfig cc CacheConfig lazyCompressDisabled LruBlockCache maxSize HConstants DEFAULT_BLOCKSIZE lazyCompressDisabled assertFalse cc shouldCacheDataCompressed assertFalse cc isCombinedBlockCache LruBlockCache disabledBlockCache LruBlockCache cc getBlockCache get
disabledBlockCount disabledBlockCache getBlockCount assertTrue disabledBlockCount disabledBlockCount disabledEvictedCount disabledBlockCache getStats getEvictedCount e disabledBlockCache HFileBlock block HFileBlock e getValue getBuffer assertTrue block block isUnpacked Configuration lazyCompressEnabled HBaseConfiguration create TEST_UTIL getConfiguration lazyCompressEnabled setBoolean CacheConfig CACHE_BLOCKS_ON_WRITE_KEY cacheOnWrite lazyCompressEnabled setBoolean CacheConfig CACHE_BLOOM_BLOCKS_ON_WRITE_KEY cacheOnWrite lazyCompressEnabled setBoolean CacheConfig CACHE_INDEX_BLOCKS_ON_WRITE_KEY cacheOnWrite lazyCompressEnabled setBoolean CacheConfig CACHE_DATA_BLOCKS_COMPRESSED_KEY cc CacheConfig lazyCompressEnabled LruBlockCache maxSize HConstants DEFAULT_BLOCKSIZE lazyCompressEnabled assertTrue cc shouldCacheDataCompressed assertTrue cc getBlockCache get LruBlockCache LruBlockCache enabledBlockCache LruBlockCache cc getBlockCache get
LruBlockCache enabledBlockCache LruBlockCache cc getBlockCache get LOG info enabledBlockCache assertEquals maxSize enabledBlockCache getMaxSize assertTrue enabledBlockCache getEvictionThread assertEquals enabledBlockCache getBlockCount cacheBlocks lazyCompressEnabled cc fs hfilePath context enabledBlockCount enabledBlockCache getBlockCount assertTrue enabledBlockCount enabledBlockCount enabledEvictedCount enabledBlockCache getStats getEvictedCount candidatesFound e enabledBlockCache candidatesFound HFileBlock block HFileBlock e getValue getBuffer cc block assertFalse block block getBufferWithoutHeader capacity block isUnpacked
assertEquals maxSize enabledBlockCache getMaxSize assertTrue enabledBlockCache getEvictionThread assertEquals enabledBlockCache getBlockCount cacheBlocks lazyCompressEnabled cc fs hfilePath context enabledBlockCount enabledBlockCache getBlockCount assertTrue enabledBlockCount enabledBlockCount enabledEvictedCount enabledBlockCache getStats getEvictedCount candidatesFound e enabledBlockCache candidatesFound HFileBlock block HFileBlock e getValue getBuffer cc block assertFalse block block getBufferWithoutHeader capacity block isUnpacked assertTrue candidatesFound LOG info disabledBlockCount enabledBlockCount
err1 cache getBlock key e err1 set LOG info e AtomicBoolean err2 AtomicBoolean err2 cache evictBlock key e err2 set
AtomicBoolean err2 AtomicBoolean err2 cache evictBlock key e err2 set LOG info e AtomicBoolean err3 AtomicBoolean err3 cache cacheBlock key blk
conf TEST_UTIL getConfiguration TEST_UTIL getConfiguration setInt BloomFilterUtil PREFIX_LENGTH_KEY hfileVersion HFile hfileVersion HFile hfileVersion conf setInt HFile FORMAT_VERSION_KEY hfileVersion fs HFileSystem get conf testI testI INDEX_CHUNK_SIZES testI indexBlockSize INDEX_CHUNK_SIZES testI expectedNumLevels EXPECTED_NUM_LEVELS testI
RpcServer rpcServer createRpcServer Lists newArrayList RpcServer BlockingServiceAndInterface SERVICE InetSocketAddress CONF FifoRpcScheduler CONF client CONF rpcServer start BlockingInterface stub newBlockingStub client rpcServer getListenerAddress HBaseRpcController pcrc HBaseRpcControllerImpl ms timeout pcrc reset pcrc setCallTimeout timeout startTime System nanoTime stub pause pcrc PauseRequestProto newBuilder setMs ms build waitTime System nanoTime startTime
AbstractRpcClient client createRpcClient CONF RpcServer rpcServer createRpcServer Lists newArrayList RpcServer BlockingServiceAndInterface SERVICE InetSocketAddress CONF FifoRpcScheduler CONF rpcServer start Interface stub newStub client rpcServer getListenerAddress BlockingRpcCallback EmptyResponseProto callback BlockingRpcCallback HBaseRpcController pcrc HBaseRpcControllerImpl stub error pcrc EmptyRequestProto getDefaultInstance callback assertNull callback get assertTrue pcrc failed
ms timeout startTime System nanoTime HBaseRpcController pcrc HBaseRpcControllerImpl pcrc setCallTimeout timeout BlockingRpcCallback EmptyResponseProto callback BlockingRpcCallback stub pause pcrc PauseRequestProto newBuilder setMs ms build callback pcrcList add pcrc callbackList add callback BlockingRpcCallback callback callbackList assertNull callback get waitTime System nanoTime startTime HBaseRpcController pcrc pcrcList assertTrue pcrc failed
ThreadPoolExecutor scheduler ThreadPoolExecutor rpcExecutor Field ExecutorField scheduler getClass getDeclaredField ExecutorField setAccessible scheduler start rpcExecutor ThreadPoolExecutor ExecutorField get scheduler rpcExecutor setMaximumPoolSize rpcExecutor allowCoreThreadTimeOut rpcExecutor setCorePoolSize rpcExecutor setKeepAliveTime TimeUnit MICROSECONDS Thread sleep e LOG error e e
Field ExecutorField scheduler getClass getDeclaredField ExecutorField setAccessible scheduler start rpcExecutor ThreadPoolExecutor ExecutorField get scheduler rpcExecutor setMaximumPoolSize rpcExecutor allowCoreThreadTimeOut rpcExecutor setCorePoolSize rpcExecutor setKeepAliveTime TimeUnit MICROSECONDS Thread sleep e LOG error e e LOG error e e
scheduler Field ExecutorField scheduler getClass getDeclaredField ExecutorField setAccessible RpcExecutor rpcExecutor RpcExecutor ExecutorField get scheduler Field handlerCountField rpcExecutor getClass getSuperclass getSuperclass getDeclaredField handlerCountField setAccessible handlerCountField set rpcExecutor Field numCallQueuesField rpcExecutor getClass getSuperclass getSuperclass getDeclaredField numCallQueuesField setAccessible numCallQueuesField set rpcExecutor Field currentQueueLimitField rpcExecutor getClass getSuperclass getSuperclass getDeclaredField currentQueueLimitField setAccessible currentQueueLimitField set rpcExecutor
Field ExecutorField scheduler getClass getDeclaredField ExecutorField setAccessible RpcExecutor rpcExecutor RpcExecutor ExecutorField get scheduler Field handlerCountField rpcExecutor getClass getSuperclass getSuperclass getDeclaredField handlerCountField setAccessible handlerCountField set rpcExecutor Field numCallQueuesField rpcExecutor getClass getSuperclass getSuperclass getDeclaredField numCallQueuesField setAccessible numCallQueuesField set rpcExecutor Field currentQueueLimitField rpcExecutor getClass getSuperclass getSuperclass getDeclaredField currentQueueLimitField setAccessible currentQueueLimitField set rpcExecutor e LOG error e e
doAnswerTaskExecution largeCallTask work doAnswerTaskExecution hugeCallTask work scheduler dispatch smallCallTask scheduler dispatch smallCallTask scheduler dispatch smallCallTask scheduler dispatch hugeCallTask scheduler dispatch smallCallTask scheduler dispatch largeCallTask scheduler dispatch smallCallTask scheduler dispatch smallCallTask work Thread sleep seqSum totalTime work
conf setInt ServerManager WAIT_ON_REGIONSERVERS_MINTOSTART NUM_RS startCluster NUM_RS numRegionsToCreate numLogLines master balanceSwitch numRegionsToCreate HRegionServer hrs findRSToKill List RegionInfo regions ProtobufUtil getOnlineRegions hrs getRSRpcServices makeWAL hrs regions numLogLines abortMaster cluster
family Bytes toBytes
numRegions r TEST_UTIL tableName numRegions r getStartKeys length assertEquals nrs numRegions LOG info blockUntilNoRIT assertTrue TEST_UTIL getAdmin isTableEnabled tableName LOG debug TEST_UTIL getAdmin disableTable tableName LOG debug blockUntilNoRIT NavigableSet String regions HBaseTestingUtility getAllOnlineRegions cluster LOG debug regions String regions
splitWALCoordinatedByZk splitWALCoordinatedByZk
assertTrue activeMasterManager clusterHasActiveMaster get assertTrue t manager clusterHasActiveMaster get assertFalse t isActiveMaster assertEquals firstMasterAddress t manager getActiveMasterServerName get ms1 stop NodeDeletionListener listener NodeDeletionListener zk zk getZNodePaths masterAddressZNode zk registerListener listener LOG info ZKUtil deleteNode zk zk getZNodePaths masterAddressZNode LOG info listener waitForDeletion LOG info sleeps t isActiveMaster sleeps Thread sleep
row Bytes toBytes qualifier Bytes toBytes value Bytes toBytes Put put Put row put addColumn FAMILY qualifier value table put put Thread sleep MSG_INTERVAL MetricsAssignmentManagerSource amSource MASTER getAssignmentManager getAssignmentManagerMetrics getMetricsProcSource METRICS_HELPER assertGauge MetricsAssignmentManagerSource RIT_COUNT_NAME amSource METRICS_HELPER assertGauge MetricsAssignmentManagerSource RIT_COUNT_OVER_THRESHOLD_NAME amSource TableDescriptor htd TableDescriptorBuilder newBuilder TABLENAME setColumnFamily ColumnFamilyDescriptorBuilder of FAMILY setCoprocessor CoprocessorDescriptorBuilder newBuilder setJarPath setPriority setProperty setProperty build build TEST_UTIL getAdmin modifyTable htd fail
TableDescriptor td createTableDescriptorForCurrentMethod RegionInfo parent createRegionInfo td getTableName Bytes toBytes Bytes toBytes RegionInfo splita createRegionInfo td getTableName Bytes toBytes Bytes toBytes RegionInfo splitb createRegionInfo td getTableName Bytes toBytes Bytes toBytes Result r createResult parent splita splitb Path rootdir masterServices getMasterFileSystem getRootDir Path tabledir CommonFSUtils getTableDir rootdir td getTableName Path parentdir Path tabledir parent getEncodedName Path storedir HStore getStoreHomedir tabledir splita td getColumnFamilies getName Reference ref Reference createTopReference Bytes toBytes now System currentTimeMillis Path p Path storedir Long toString now parent getEncodedName FileSystem fs masterServices getMasterFileSystem getFileSystem Path path ref write fs p assertTrue fs exists path
RegionInfo splitaa createRegionInfo td getTableName Bytes toBytes Bytes toBytes RegionInfo splitab createRegionInfo td getTableName Bytes toBytes Bytes toBytes RegionInfo splitb createRegionInfo td getTableName Bytes toBytes HConstants EMPTY_BYTE_ARRAY Thread sleep Map RegionInfo Result splitParents TreeMap SplitParentFirstComparator splitParents put parent createResult parent splita splitb splita RegionInfoBuilder newBuilder splita setOffline build splitParents put splita createResult splita splitaa splitab Map RegionInfo Result mergedRegions TreeMap CatalogJanitor spy spy janitor CatalogJanitor Report report CatalogJanitor Report report count report mergedRegions putAll mergedRegions report splitParents putAll splitParents doReturn report when spy scanForReport
RegionInfo splitb createRegionInfo td getTableName Bytes toBytes HConstants EMPTY_BYTE_ARRAY Thread sleep Map RegionInfo Result splitParents TreeMap SplitParentFirstComparator splitParents put parent createResult parent splita splitb splita RegionInfoBuilder newBuilder splita setOffline build splitParents put splita createResult splita splitaa splitab Map RegionInfo Result mergedRegions TreeMap CatalogJanitor spy spy janitor CatalogJanitor Report report CatalogJanitor Report report count report mergedRegions putAll mergedRegions report splitParents putAll splitParents doReturn report when spy scanForReport LOG info parent getShortNameToLog splita getShortNameToLog Path splitaRef createReferences masterServices td parent splita Bytes toBytes
TableDescriptor td createTableDescriptorForCurrentMethod RegionInfo parent createRegionInfo td getTableName Bytes toBytes Bytes toBytes RegionInfo splita createRegionInfo td getTableName Bytes toBytes Bytes toBytes RegionInfo splitb createRegionInfo td getTableName Bytes toBytes Bytes toBytes Result parentMetaRow createResult parent splita splitb FileSystem fs FileSystem get HTU getConfiguration Path rootdir masterServices getMasterFileSystem getRootDir CommonFSUtils setRootDir fs getConf rootdir Path tabledir CommonFSUtils getTableDir rootdir td getTableName Path storedir HStore getStoreHomedir tabledir parent td getColumnFamilies getName Path storeArchive HFileArchiveUtil getStoreArchivePath masterServices getConfiguration parent tabledir td getColumnFamilies getName
TableDescriptor td createTableDescriptorForCurrentMethod RegionInfo parent createRegionInfo td getTableName Bytes toBytes Bytes toBytes RegionInfo splita createRegionInfo td getTableName Bytes toBytes Bytes toBytes RegionInfo splitb createRegionInfo td getTableName Bytes toBytes Bytes toBytes Result parentMetaRow createResult parent splita splitb FileSystem fs FileSystem get HTU getConfiguration Path rootdir masterServices getMasterFileSystem getRootDir CommonFSUtils setRootDir fs getConf rootdir Path tabledir CommonFSUtils getTableDir rootdir td getTableName Path storedir HStore getStoreHomedir tabledir parent td getColumnFamilies getName Path storeArchive HFileArchiveUtil getStoreArchivePath masterServices getConfiguration parent tabledir td getColumnFamilies getName LOG debug tabledir
TableDescriptor td createTableDescriptorForCurrentMethod RegionInfo parent createRegionInfo td getTableName Bytes toBytes Bytes toBytes RegionInfo splita createRegionInfo td getTableName Bytes toBytes Bytes toBytes RegionInfo splitb createRegionInfo td getTableName Bytes toBytes Bytes toBytes Result parentMetaRow createResult parent splita splitb FileSystem fs FileSystem get HTU getConfiguration Path rootdir masterServices getMasterFileSystem getRootDir CommonFSUtils setRootDir fs getConf rootdir Path tabledir CommonFSUtils getTableDir rootdir td getTableName Path storedir HStore getStoreHomedir tabledir parent td getColumnFamilies getName Path storeArchive HFileArchiveUtil getStoreArchivePath masterServices getConfiguration parent tabledir td getColumnFamilies getName LOG debug tabledir LOG debug storedir
RegionInfo splitb createRegionInfo td getTableName Bytes toBytes Bytes toBytes Result parentMetaRow createResult parent splita splitb FileSystem fs FileSystem get HTU getConfiguration Path rootdir masterServices getMasterFileSystem getRootDir CommonFSUtils setRootDir fs getConf rootdir Path tabledir CommonFSUtils getTableDir rootdir td getTableName Path storedir HStore getStoreHomedir tabledir parent td getColumnFamilies getName Path storeArchive HFileArchiveUtil getStoreArchivePath masterServices getConfiguration parent tabledir td getColumnFamilies getName LOG debug tabledir LOG debug storedir LOG debug storeArchive FileStatus mockFiles addMockStoreFiles masterServices storedir FileStatus storeFiles fs listStatus storedir index FileStatus storeFiles
description LOG debug description
AssignmentManager am TEST_UTIL getHBaseCluster getMaster getAssignmentManager ServerManager sm TEST_UTIL getHBaseCluster getMaster getServerManager CatalogJanitor janitor TEST_UTIL getHBaseCluster getMaster getCatalogJanitor Admin admin TEST_UTIL getAdmin admin catalogJanitorSwitch TableName tableName TableName valueOf name getMethodName Table t TEST_UTIL createTable tableName FAMILY rowCount TEST_UTIL loadTable t FAMILY RegionLocator locator TEST_UTIL getConnection getRegionLocator tableName List HRegionLocation allRegionLocations locator getAllRegionLocations HRegionLocation parent allRegionLocations get List HRegionLocation daughters splitRegion parent getRegion
AssignmentManager am TEST_UTIL getHBaseCluster getMaster getAssignmentManager ServerManager sm TEST_UTIL getHBaseCluster getMaster getServerManager CatalogJanitor janitor TEST_UTIL getHBaseCluster getMaster getCatalogJanitor Admin admin TEST_UTIL getAdmin admin catalogJanitorSwitch TableName tableName TableName valueOf name getMethodName Table t TEST_UTIL createTable tableName FAMILY rowCount TEST_UTIL loadTable t FAMILY RegionLocator locator TEST_UTIL getConnection getRegionLocator tableName List HRegionLocation allRegionLocations locator getAllRegionLocations HRegionLocation parent allRegionLocations get List HRegionLocation daughters splitRegion parent getRegion LOG info parent
sm regionServerStartup request build ia1 Configuration c HBaseConfiguration create maxSkew c getLong warningSkew c getLong LOG debug LOG debug InetAddress ia2 InetAddress getLocalHost request RegionServerStartupRequest newBuilder request setPort request setServerStartCode request setServerCurrentTime System currentTimeMillis maxSkew sm regionServerStartup request build ia2 fail
sm regionServerStartup request build ia2 fail e LOG info e LOG debug LOG debug InetAddress ia3 InetAddress getLocalHost request RegionServerStartupRequest newBuilder request setPort request setServerStartCode request setServerCurrentTime System currentTimeMillis maxSkew sm regionServerStartup request build ia3 fail e
setupTable SERVER_FOR_TEST UTIL getHBaseCluster getRegionServer getServerName UTIL waitFor getServerStateNode SERVER_FOR_TEST ServerStateNode serverNode getServerStateNode SERVER_FOR_TEST assertNotNull serverNode assertTrue serverNode isInState ServerState ONLINE SCP_LATCH CountDownLatch List Integer ports UTIL getHBaseCluster getMaster getServerManager getOnlineServersList stream map serverName serverName getPort collect Collectors toList LOG info UTIL getHBaseCluster killAll UTIL getHBaseCluster waitUntilShutDown LOG info UTIL restartHBaseCluster StartMiniClusterOption builder masterClass HMasterForTest numMasters numRegionServers rsPorts ports build LOG info UTIL waitFor UTIL getHBaseCluster getMaster isInitialized
List Pair RegionInfo ServerName tableRegions MetaTableAccessor getTableRegionsAndLocations m getConnection TABLENAME LOG info Joiner on join tableRegions assertEquals tableRegions size assertArrayEquals HConstants EMPTY_START_ROW tableRegions get getFirst getStartKey assertArrayEquals HConstants EMPTY_END_ROW tableRegions get getFirst getEndKey LOG info TEST_UTIL getAdmin split TABLENAME LOG info tableRegions size tableRegions MetaTableAccessor getTableRegionsAndLocations m getConnection TABLENAME Thread sleep LOG info Joiner on join tableRegions assertEquals tableRegions size LOG info Pair RegionInfo ServerName pair getTableRegionForRow m TABLENAME Bytes toBytes
List MasterThread masterThreads cluster getMasterThreads MasterThread mt masterThreads assertTrue mt isAlive numActive activeIndex ServerName activeName HMaster active i i masterThreads size i masterThreads get i getMaster numActive activeIndex i active masterThreads get activeIndex getMaster activeName active getServerName assertEquals numActive assertEquals NUM_MASTERS masterThreads size
LOG info activeName assertNotNull active ClusterMetrics status active getClusterMetrics assertTrue status getMasterName equals activeName assertEquals status getBackupMasterNames size backupIndex activeIndex activeIndex HMaster master cluster getMaster backupIndex LOG debug master getServerName cluster stopMaster backupIndex cluster waitOnMaster backupIndex i i masterThreads size i masterThreads get i getMaster assertTrue activeName equals masterThreads get i getMaster getServerName activeIndex i active masterThreads get activeIndex getMaster
HMaster master cluster getMaster backupIndex LOG debug master getServerName cluster stopMaster backupIndex cluster waitOnMaster backupIndex i i masterThreads size i masterThreads get i getMaster assertTrue activeName equals masterThreads get i getMaster getServerName activeIndex i active masterThreads get activeIndex getMaster assertEquals numActive assertEquals masterThreads size rsCount masterThreads get activeIndex getMaster getClusterMetrics getLiveServerMetrics size LOG info active getServerName rsCount assertEquals rsCount assertNotNull active
HMaster master UTIL getMiniHBaseCluster getMaster MasterFileSystem fs master getMasterFileSystem Path masterRoot CommonFSUtils getRootDir fs getConfiguration Path rootDir CommonFSUtils getRootDir fs getFileSystem getConf LOG debug FileSystem getDefaultUri fs getFileSystem getConf
why e RuntimeException why e ZKUtil deleteNodeRecursively zkw zkw getZNodePaths baseZNode e LOG info e e
htu HBaseTestingUtility createMasterShutdownBeforeStartingAnyRegionServerConfiguration StartMiniClusterOption options StartMiniClusterOption builder numDataNodes numMasters numRegionServers masterClass HMaster rsClass MiniHBaseCluster MiniHBaseClusterRegionServer createRootDir build htu startMiniDFSCluster options getNumDataNodes htu startMiniZKCluster options getNumZkServers htu createRootDir hbaseCluster LocalHBaseCluster htu getConfiguration options getNumMasters options getNumRegionServers options getMasterClass options getRsClass MasterThread masterThread hbaseCluster getMasters get masterThread start timeout TimeUnit MINUTES toMillis assertNotEquals htu waitFor timeout masterThread getMaster getServerManager htu getConnection getAdmin shutdown
ServerName serverToKill killIndex Random random Random System currentTimeMillis ServerName metaServer TEST_UTIL getHBaseCluster getServerHoldingMeta
killIndex Random random Random System currentTimeMillis ServerName metaServer TEST_UTIL getHBaseCluster getServerHoldingMeta LOG debug metaServer isNamespaceServer killIndex random nextInt SLAVES serverToKill TEST_UTIL getHBaseCluster getRegionServer killIndex getServerName Collection HRegion regs TEST_UTIL getHBaseCluster getRegionServer killIndex getOnlineRegionsLocalContext isNamespaceServer HRegion regs isNamespaceServer ServerName isSameAddress metaServer serverToKill isNamespaceServer TEST_UTIL getHBaseCluster getRegionServer killIndex getNumberOfOnlineRegions
killIndex random nextInt SLAVES serverToKill TEST_UTIL getHBaseCluster getRegionServer killIndex getServerName Collection HRegion regs TEST_UTIL getHBaseCluster getRegionServer killIndex getOnlineRegionsLocalContext isNamespaceServer HRegion regs isNamespaceServer ServerName isSameAddress metaServer serverToKill isNamespaceServer TEST_UTIL getHBaseCluster getRegionServer killIndex getNumberOfOnlineRegions LOG debug serverToKill Map RegionInfo Pair ServerName ServerName regionsToVerify HashMap Map RegionInfo ServerName entry ServerName s entry getValue ServerName isSameAddress s serverToKill regionsToVerify put entry getKey Pair entry getValue entry getValue
isNamespaceServer ServerName isSameAddress metaServer serverToKill isNamespaceServer TEST_UTIL getHBaseCluster getRegionServer killIndex getNumberOfOnlineRegions LOG debug serverToKill Map RegionInfo Pair ServerName ServerName regionsToVerify HashMap Map RegionInfo ServerName entry ServerName s entry getValue ServerName isSameAddress s serverToKill regionsToVerify put entry getKey Pair entry getValue entry getValue LOG debug entry getKey entry getValue entry getValue orig TEST_UTIL getHBaseCluster getMaster getAssignmentManager getNumRegionsOpened TEST_UTIL getHBaseCluster stopRegionServer serverToKill TEST_UTIL getHBaseCluster waitForRegionServerToStop serverToKill curr TEST_UTIL getHBaseCluster getMaster getAssignmentManager getNumRegionsOpened curr orig regionsToVerify
LOG debug serverToKill Map RegionInfo Pair ServerName ServerName regionsToVerify HashMap Map RegionInfo ServerName entry ServerName s entry getValue ServerName s serverToKill regionsToVerify put entry getKey Pair entry getValue entry getValue LOG debug entry getKey entry getValue entry getValue orig TEST_UTIL getHBaseCluster getMaster getAssignmentManager getNumRegionsOpened TEST_UTIL getHBaseCluster stopRegionServer serverToKill TEST_UTIL getHBaseCluster waitForRegionServerToStop serverToKill curr TEST_UTIL getHBaseCluster getMaster getAssignmentManager getNumRegionsOpened curr orig regionsToVerify size LOG debug regionsToVerify size curr orig Thread sleep curr TEST_UTIL getHBaseCluster getMaster getAssignmentManager getNumRegionsOpened
MiniHBaseCluster cluster TEST_UTIL getHBaseCluster HMaster m cluster getMaster lastRegionOpenedCount m getAssignmentManager getNumRegionsOpened m balance retry sleep attempt currentRegionOpened regionMovement currentRegionOpened m getAssignmentManager getNumRegionsOpened regionMovement currentRegionOpened lastRegionOpenedCount
ServerName favoredServerList FavoredNodeAssignmentHelper getFavoredNodesList favoredNodes favoredNodesAssignmentPlan put info favoredServerList Position positions Position values info totalRegionNum incrementAndGet server ServerName serverName ServerName valueOf Bytes toString server favoredNodes String placement i i favoredServerList i favoredServerList i serverName placement positions i toString i Position regionOnPrimaryNum incrementAndGet
favoredNodesAssignmentPlan put info favoredServerList Position positions Position values info totalRegionNum incrementAndGet server ServerName serverName ServerName valueOf Bytes toString server String placement i i favoredServerList i favoredServerList i serverName placement positions i toString i Position regionOnPrimaryNum incrementAndGet LOG info info getRegionNameAsString serverName placement
info totalRegionNum incrementAndGet server ServerName serverName ServerName valueOf Bytes toString server String placement i i i i serverName placement positions i toString i regionOnPrimaryNum incrementAndGet LOG info info getRegionNameAsString serverName placement LOG info info getRegionNameAsString serverName
i serverName placement positions i toString i regionOnPrimaryNum incrementAndGet LOG info info getRegionNameAsString serverName placement LOG info info getRegionNameAsString serverName LOG info info getRegionNameAsString e LOG error result e
regionNo ClusterMetrics clusterMetrics TestRegionsRecoveryChore getClusterMetrics Map ServerName ServerMetrics serverMetricsMap clusterMetrics getLiveServerMetrics LOG debug ServerMetrics serverMetrics serverMetricsMap Map RegionMetrics regionMetricsMap serverMetrics getRegionMetrics RegionMetrics regionMetricsMap
regionNo ClusterMetrics clusterMetrics TestRegionsRecoveryChore getClusterMetrics Map ServerName ServerMetrics serverMetricsMap clusterMetrics getLiveServerMetrics LOG debug ServerMetrics serverMetrics serverMetricsMap Map RegionMetrics regionMetricsMap serverMetrics getRegionMetrics RegionMetrics regionMetricsMap
regionNo ClusterMetrics clusterMetrics TestRegionsRecoveryChore getClusterMetrics Map ServerName ServerMetrics serverMetricsMap clusterMetrics getLiveServerMetrics LOG debug ServerMetrics serverMetrics serverMetricsMap Map RegionMetrics regionMetricsMap serverMetrics getRegionMetrics RegionMetrics regionMetricsMap
UTIL startMiniCluster rsNum UTIL getMiniHBaseCluster getMaster getMasterRpcServices synchronousBalanceSwitch LOG info TABLE UTIL createMultiRegionTable TABLE FAMILY regionNum TABLE UTIL waitTableEnabled TABLE UTIL waitUntilNoRegionsInTransition MiniHBaseCluster cluster UTIL getHBaseCluster List JVMClusterUtil RegionServerThread threads cluster getLiveRegionServerThreads assertEquals threads size ServerName testServer threads get getRegionServer getServerName port testServer getPort List RegionInfo regionInfos cluster getMaster getAssignmentManager getRegionsOnServer testServer
assertTrue regionInfos size TABLES length regionNum rsNum cluster stopRegionServer testServer cluster waitForRegionServerToStop testServer cluster getConf setInt HConstants REGIONSERVER_PORT port cluster startRegionServer HMaster master UTIL getMiniHBaseCluster getMaster List ServerName localServers master getServerManager getOnlineServersList ServerName newTestServer ServerName serverName localServers serverName testServer newTestServer serverName assertNotNull newTestServer TABLE TABLES UTIL waitTableAvailable TABLE
LOG info slm SplitLogManager master conf TaskBatch batch TaskBatch String tasknode submitTaskAndWait batch data ZKUtil getData zkw tasknode SplitLogTask slt SplitLogTask parseFrom data
LOG info String tasknode ZKSplitLog getEncodedNodeName zkw SplitLogTask slt SplitLogTask Unassigned master getServerName zkw getRecoverableZooKeeper create tasknode slt toByteArray Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT version ZKUtil checkExists zkw tasknode slm SplitLogManager master conf waitForCounter tot_mgr_orphan_task_acquired to Task task findOrCreateOrphanTask tasknode assertTrue task isOrphan assertTrue task isUnassigned waitForCounter tot_mgr_rescan to Task task2 findOrCreateOrphanTask tasknode assertTrue task task2
serverid HRegion region TEST_UTIL getMiniHBaseCluster getRegions TABLENAME get RegionInfo info region getRegionInfo runwarmup HRegionServer rs TEST_UTIL getMiniHBaseCluster getRegionServer serverid destName Bytes toBytes rs getServerName toString assertTrue destName
TableName tableName TableName valueOf RegionInfo hri createRegionInfo tableName rsDispatcher setMockRsExecutor RandRsExecutor
UTIL waitFor procExec getProcedures stream anyMatch p p ServerCrashProcedure t UTIL getAdmin move region getEncodedNameAsBytes dstRs getServerName e LOG info region getRegionNameAsString e t start ProcedureTestUtil waitUntilProcedureWaitingTimeout UTIL TransitRegionStateProcedure ProcedureTestUtil waitUntilProcedureTimeoutIncrease UTIL TransitRegionStateProcedure HMaster master UTIL getMiniHBaseCluster getMaster master getConnection close RESUME countDown UTIL waitFor master isAlive HMaster master2 UTIL getMiniHBaseCluster startMaster getMaster
resetProcExecutorTestingKillFlag
ProcedureTestingUtility assertProcNotFailed procExec procId MetaTableAccessor fullScanMetaAndPrint UTIL getConnection assertEquals originalRegionCount mergeCount MetaTableAccessor getTableRegions UTIL getConnection tableName size assertEquals mergeSubmittedCount mergeProcMetrics getSubmittedCounter getCount assertEquals mergeFailedCount mergeProcMetrics getFailedCounter getCount assertEquals assignSubmittedCount assignProcMetrics getSubmittedCounter getCount assertEquals assignFailedCount assignProcMetrics getFailedCounter getCount assertEquals unassignSubmittedCount mergeCount unassignProcMetrics getSubmittedCounter getCount assertEquals unassignFailedCount unassignProcMetrics getFailedCounter getCount admin disableTable tableName admin enableTable tableName UTIL getHBaseCluster getMaster setCatalogJanitorEnabled UTIL getHBaseCluster getMaster getCatalogJanitor triggerNow mergedRegion proc getMergedRegion getRegionName
RegionInfo region UTIL getMiniHBaseCluster getRegions NAME get getRegionInfo AssignmentManager am UTIL getMiniHBaseCluster getMaster getAssignmentManager ServerName sn am getRegionStates getRegionState region getServerName
List RegionInfo regions admin getRegions tableName RegionInfo ri regions admin unassign ri getRegionName List Long pids ArrayList regions size RegionInfo ri regions Procedure MasterProcedureEnv p StallingAssignProcedure env ri TransitionType ASSIGN pids add TEST_UTIL getHBaseCluster getMaster getMasterProcedureExecutor submitProcedure p Long pids TEST_UTIL getHBaseCluster getMaster getMasterProcedureExecutor Thread sleep List Procedure MasterProcedureEnv ps TEST_UTIL getHBaseCluster getMaster getMasterProcedureExecutor getProcedures Procedure MasterProcedureEnv p ps p StallingAssignProcedure List Boolean bs TEST_UTIL getHbck bypassProcedure Arrays asList p getProcId Boolean bs
stateMap getOrCreateRegionStateNode hri waitExecutorService NRUNS et System currentTimeMillis LOG info String format StringUtils humanTimeDiff et st StringUtils humanSize NRUNS et st st System currentTimeMillis i i NRUNS i regionId i RegionInfo hri createRegionInfo TABLE_NAME regionId stateMap getRegionState hri waitExecutorService NRUNS et System currentTimeMillis
tableName List HRegion daughters UTIL getMiniHBaseCluster getRegions tableName assertTrue daughters size
List serverMap List ServerAndLoad list convertToList serverMap
Map ServerName List RegionInfo serverMap rackManager List ServerAndLoad list convertToList serverMap LOG info printMock list printStats list loadBalancer setRackManager rackManager Map TableName Map ServerName List RegionInfo LoadOfAllTable Map mockClusterServersWithTables serverMap List RegionPlan plans loadBalancer balanceCluster LoadOfAllTable assertNotNull plans List ServerAndLoad balancedCluster reconcile list plans serverMap
generateRegionsAndServers String methodName
generateRegionsAndServers String methodName LOG info methodName Stopwatch watch Stopwatch createStarted loadBalancer roundRobinAssignment regions servers System out print formatResults methodName watch elapsed TimeUnit MILLISECONDS methodName
generateRegionsAndServers String methodName LOG info methodName Stopwatch watch Stopwatch createStarted loadBalancer roundRobinAssignment regions servers System out print formatResults methodName watch elapsed TimeUnit MILLISECONDS methodName LOG info methodName watch reset start loadBalancer retainAssignment regionServerMap servers System out print formatResults methodName watch elapsed TimeUnit MILLISECONDS methodName
conf UTIL getConfiguration Random rand Random i i i sign i connectorPort sign rand nextInt HBaseTestingUtility available connectorPort conf setInt connectorPort cluster UTIL startMiniCluster LOG info cluster waitForActiveAndReadyMaster master cluster getMaster
sign i connectorPort sign rand nextInt HBaseTestingUtility available connectorPort conf setInt connectorPort cluster UTIL startMiniCluster LOG info cluster waitForActiveAndReadyMaster master cluster getMaster e LOG debug connectorPort e UTIL shutdownMiniCluster
UTIL getConfiguration set HConstants HBASE_MASTER_LOADBALANCER_CLASS FavoredStochasticBalancer getName UTIL restartHBaseCluster SLAVES HMaster master UTIL getMiniHBaseCluster getMaster master Threads sleep UTIL waitTableAvailable tableDescriptor getTableName UTIL waitUntilNoRegionsInTransition assertTrue master isBalancerOn FavoredNodesManager fnm master getFavoredNodesManager assertNotNull fnm admin UTIL getAdmin List RegionInfo regionsOfTable admin getRegions TableName valueOf tableName RegionInfo rInfo regionsOfTable assertNotNull rInfo assertNotNull fnm
FavoredNodesManager fnm master getFavoredNodesManager ServerName masterServerName master getServerName List ServerName excludedServers Lists newArrayList masterServerName ServerName mostLoadedServer getRSWithMaxRegions tableName excludedServers assertNotNull mostLoadedServer numRegions getTableRegionsFromServer tableName mostLoadedServer size excludedServers add mostLoadedServer ServerName source getRSWithMaxRegions tableName excludedServers assertNotNull source regionsToMove getTableRegionsFromServer tableName source size List RegionInfo hris getRegionsThatCanBeMoved tableName mostLoadedServer RegionStates rst master getAssignmentManager getRegionStates i i regionsToMove i RegionInfo regionInfo hris get i admin move regionInfo getEncodedNameAsBytes mostLoadedServer
numRegions getTableRegionsFromServer tableName mostLoadedServer size numRegions finalRegions TEST_UTIL getHBaseCluster startRegionServerAndWait Map ServerName List RegionInfo serverAssignments Maps newHashMap ClusterMetrics status admin getClusterMetrics EnumSet of Option LIVE_SERVERS ServerName sn status ServerName sn serverAssignments put sn getTableRegionsFromServer tableName sn RegionLocationFinder regionFinder RegionLocationFinder regionFinder setClusterMetrics admin getClusterMetrics EnumSet of Option LIVE_SERVERS regionFinder setConf conf regionFinder setServices TEST_UTIL getMiniHBaseCluster getMaster Cluster cluster Cluster serverAssignments regionFinder RackManager conf LoadOnlyFavoredStochasticBalancer balancer LoadOnlyFavoredStochasticBalancer TEST_UTIL getMiniHBaseCluster getMaster getLoadBalancer getInternalBalancer
TableName tableName TableName valueOf TableDescriptor tableDescriptor TableDescriptorBuilder newBuilder tableName setColumnFamily ColumnFamilyDescriptorBuilder of HConstants CATALOG_FAMILY build admin createTable tableDescriptor Bytes toBytes Bytes toBytes REGION_NUM TEST_UTIL waitTableAvailable tableName RegionInfo region admin getRegions tableName get
TableName tableName TableName valueOf TableDescriptor tableDescriptor TableDescriptorBuilder newBuilder tableName setColumnFamily ColumnFamilyDescriptorBuilder of HConstants CATALOG_FAMILY build admin createTable tableDescriptor Bytes toBytes Bytes toBytes REGION_NUM TEST_UTIL waitTableAvailable tableName RegionInfo region admin getRegions tableName get
TableName tableName TableName valueOf TableDescriptor tableDescriptor TableDescriptorBuilder newBuilder tableName setColumnFamily ColumnFamilyDescriptorBuilder of HConstants CATALOG_FAMILY build admin createTable tableDescriptor Bytes toBytes Bytes toBytes REGION_NUM TEST_UTIL waitTableAvailable tableName RegionInfo region admin getRegions tableName get
regionStates getRegionState region isFailedOpen assertTrue region regionStates getRegionState region isFailedOpen List ServerName serversForNewFN Lists newArrayList ServerName sn serversForNewFN add ServerName valueOf sn getHostname sn getPort NON_STARTCODE FavoredNodeAssignmentHelper helper FavoredNodeAssignmentHelper serversForNewFN conf helper initialize regionState regionStates RegionInfo regionInfo regionState getRegionInfo List ServerName newFavoredNodes helper generateFavoredNodes regionInfo assertNotNull newFavoredNodes assertEquals FavoredNodeAssignmentHelper FAVORED_NODES_NUM newFavoredNodes size
assertTrue region regionStates getRegionState region isFailedOpen List ServerName serversForNewFN Lists newArrayList ServerName sn serversForNewFN add ServerName valueOf sn getHostname sn getPort NON_STARTCODE FavoredNodeAssignmentHelper helper FavoredNodeAssignmentHelper serversForNewFN conf helper initialize regionState regionStates RegionInfo regionInfo regionState getRegionInfo List ServerName newFavoredNodes helper generateFavoredNodes regionInfo assertNotNull newFavoredNodes assertEquals FavoredNodeAssignmentHelper FAVORED_NODES_NUM newFavoredNodes size LOG info regionInfo getEncodedName newFavoredNodes Map RegionInfo List ServerName regionFNMap Maps newHashMap regionFNMap put regionInfo newFavoredNodes
TableName tableName TableName valueOf TableDescriptor tableDescriptor TableDescriptorBuilder newBuilder tableName setColumnFamily ColumnFamilyDescriptorBuilder of HConstants CATALOG_FAMILY build admin createTable tableDescriptor Bytes toBytes Bytes toBytes REGION_NUM TEST_UTIL waitTableAvailable tableName RegionInfo region admin getRegions tableName get
RegionInfo region admin getRegions tableName get LOG info region FavoredNodesManager fnm master getFavoredNodesManager List ServerName currentFN fnm getFavoredNodes region assertNotNull currentFN stopServersAndWaitUntilProcessed currentFN RegionStates regionStatesBeforeMaster master getAssignmentManager getRegionStates regionStatesBeforeMaster getRegionState region isFailedOpen assertTrue region regionStatesBeforeMaster getRegionState region isFailedOpen List RegionInfo rit Lists newArrayList regionState regionStatesBeforeMaster RegionInfo regionInfo regionState getRegionInfo
cluster waitForMasterToStop master getServerName cluster startMaster cluster waitForActiveAndReadyMaster master cluster getMaster fnm master getFavoredNodesManager RegionStates regionStates master getAssignmentManager getRegionStates assertTrue region regionStates getRegionState region isFailedOpen regionInfo assertTrue regionInfo regionStates getRegionState regionInfo isFailedOpen List ServerName serversForNewFN Lists newArrayList ServerName sn serversForNewFN add ServerName valueOf sn getHostname sn getPort NON_STARTCODE FavoredNodeAssignmentHelper helper FavoredNodeAssignmentHelper serversForNewFN conf helper initialize regionInfo
fnm master getFavoredNodesManager RegionStates regionStates master getAssignmentManager getRegionStates assertTrue region regionStates getRegionState region isFailedOpen regionInfo assertTrue regionInfo regionStates getRegionState regionInfo isFailedOpen List ServerName serversForNewFN Lists newArrayList ServerName sn serversForNewFN add ServerName valueOf sn getHostname sn getPort NON_STARTCODE FavoredNodeAssignmentHelper helper FavoredNodeAssignmentHelper serversForNewFN conf helper initialize regionInfo List ServerName newFavoredNodes helper generateFavoredNodes regionInfo assertNotNull newFavoredNodes assertEquals FavoredNodeAssignmentHelper FAVORED_NODES_NUM newFavoredNodes size LOG info regionInfo getEncodedName newFavoredNodes
perTableBalancerConfigs isByTable perTableBalancerConfigs Configuration conf loadBalancer getConf conf setBoolean HConstants HBASE_MASTER_LOADBALANCE_BYTABLE isByTable loadBalancer setConf conf Map ServerName List RegionInfo servers mockClusterServers ArrayListMultimap String ServerAndLoad list convertToGroupBasedMap servers
perTableBalancerConfigs isByTable perTableBalancerConfigs Configuration conf loadBalancer getConf conf setBoolean HConstants HBASE_MASTER_LOADBALANCE_BYTABLE isByTable loadBalancer setConf conf Map ServerName List RegionInfo servers mockClusterServers ArrayListMultimap String ServerAndLoad list convertToGroupBasedMap servers LOG info printStats list Map TableName Map ServerName List RegionInfo LoadOfAllTable Map mockClusterServersWithTables servers List RegionPlan plans loadBalancer balanceCluster LoadOfAllTable ArrayListMultimap String ServerAndLoad balancedCluster reconcile list plans
Map TableName Map ServerName List RegionInfo clusterLoad TreeMap mockCluster Map ServerName List RegionInfo clusterServers mockClusterServers mockCluster List ServerAndLoad clusterList convertToList clusterServers clusterLoad put TableName valueOf name getMethodName clusterServers HashMap TableName TreeMap ServerName List RegionInfo result mockClusterServersWithTables clusterServers loadBalancer setClusterLoad clusterLoad List RegionPlan clusterplans ArrayList List Pair TableName Integer regionAmountList ArrayList Map TableName TreeMap ServerName List RegionInfo mapEntry result TableName tableName mapEntry getKey TreeMap ServerName List RegionInfo servers mapEntry getValue List ServerAndLoad list convertToList servers
Map ServerName List RegionInfo clusterServers mockClusterServers mockCluster List ServerAndLoad clusterList convertToList clusterServers clusterLoad put TableName valueOf name getMethodName clusterServers HashMap TableName TreeMap ServerName List RegionInfo result mockClusterServersWithTables clusterServers loadBalancer setClusterLoad clusterLoad List RegionPlan clusterplans ArrayList List Pair TableName Integer regionAmountList ArrayList Map TableName TreeMap ServerName List RegionInfo mapEntry result TableName tableName mapEntry getKey TreeMap ServerName List RegionInfo servers mapEntry getValue List ServerAndLoad list convertToList servers LOG info printMock list printStats list List RegionPlan partialplans loadBalancer balanceTable tableName servers partialplans clusterplans addAll partialplans List ServerAndLoad balancedClusterPerTable reconcile list partialplans servers
Map TableName Map ServerName List RegionInfo clusterLoad TreeMap Map ServerName List RegionInfo clusterServers mockUniformClusterServers mockUniformCluster List ServerAndLoad clusterList convertToList clusterServers clusterLoad put TableName valueOf name getMethodName clusterServers HashMap TableName TreeMap ServerName List RegionInfo LoadOfAllTable mockClusterServersWithTables clusterServers loadBalancer setClusterLoad Map LoadOfAllTable loadBalancer setClusterLoad clusterLoad List RegionPlan clusterplans1 ArrayList RegionPlan List Pair TableName Integer regionAmountList ArrayList Pair TableName Integer Map TableName TreeMap ServerName List RegionInfo mapEntry LoadOfAllTable TableName tableName mapEntry getKey TreeMap ServerName List RegionInfo servers mapEntry getValue List ServerAndLoad list convertToList servers
HashMap TableName TreeMap ServerName List RegionInfo LoadOfAllTable mockClusterServersWithTables clusterServers loadBalancer setClusterLoad Map LoadOfAllTable loadBalancer setClusterLoad clusterLoad List RegionPlan clusterplans1 ArrayList RegionPlan List Pair TableName Integer regionAmountList ArrayList Pair TableName Integer Map TableName TreeMap ServerName List RegionInfo mapEntry LoadOfAllTable TableName tableName mapEntry getKey TreeMap ServerName List RegionInfo servers mapEntry getValue List ServerAndLoad list convertToList servers LOG info printMock list printStats list List RegionPlan partialplans loadBalancer balanceTable tableName servers partialplans clusterplans1 addAll partialplans List ServerAndLoad balancedClusterPerTable reconcile list partialplans servers
conf setLong StochasticLoadBalancer MAX_STEPS_KEY conf setLong conf setFloat loadBalancer setConf conf mockCluster Map ServerName List RegionInfo servers mockClusterServers mockCluster List ServerAndLoad list convertToList servers
conf setLong StochasticLoadBalancer MAX_STEPS_KEY conf setLong conf setFloat loadBalancer setConf conf mockCluster Map ServerName List RegionInfo servers mockClusterServers mockCluster List ServerAndLoad list convertToList servers LOG info printMock list printStats list Map TableName Map ServerName List RegionInfo LoadOfAllTable Map mockClusterServersWithTables servers List RegionPlan plans loadBalancer balanceCluster LoadOfAllTable List ServerAndLoad balancedCluster reconcile list plans servers
List serverMap List ServerAndLoad list convertToList serverMap
List serverMap rackManager List ServerAndLoad list convertToList serverMap LOG info printMock list printStats list BalancerTestBase loadBalancer setRackManager rackManager List RegionPlan plans BalancerTestBase loadBalancer balanceTable HConstants ENSEMBLE_TABLE_NAME serverMap assertNotNull plans List ServerAndLoad balancedCluster reconcile list plans serverMap
List ServerAndLoad balancedCluster reconcile list plans serverMap LOG info printMock balancedCluster List RegionPlan secondPlans BalancerTestBase loadBalancer balanceTable HConstants ENSEMBLE_TABLE_NAME serverMap assertNull secondPlans HeterogeneousRegionCountCostFunction cf HeterogeneousRegionCountCostFunction conf assertNotNull cf BaseLoadBalancer Cluster cluster BaseLoadBalancer Cluster serverMap cf init cluster ServerAndLoad serverAndLoad balancedCluster ServerName sn serverAndLoad getServerName numberRegions serverAndLoad getLoad limit cf findLimitForRS sn usage numberRegions limit
UTIL cleanupTestDir Stoppable stop StoppableImplementation HBaseTestingUtility localUtil HBaseTestingUtility Configuration conf localUtil getConfiguration Path testDir UTIL getDataTestDir FileSystem fs UTIL getTestFileSystem
EnvironmentEdge originalEdge EnvironmentEdgeManager getDelegate String prefix Configuration conf UTIL getConfiguration ttl conf set HFileCleaner MASTER_HFILE_CLEANER_PLUGINS conf setLong TimeToLiveHFileCleaner TTL_CONF_KEY ttl Server server DummyServer Path archivedHfileDir Path UTIL getDataTestDirOnTestFS HConstants HFILE_ARCHIVE_DIRECTORY FileSystem fs FileSystem get conf HFileCleaner cleaner HFileCleaner server conf fs archivedHfileDir POOL createTime System currentTimeMillis fs delete archivedHfileDir fs mkdirs archivedHfileDir fs createNewFile Path archivedHfileDir
conf set HFileCleaner MASTER_HFILE_CLEANER_PLUGINS conf setLong TimeToLiveHFileCleaner TTL_CONF_KEY ttl Server server DummyServer Path archivedHfileDir Path UTIL getDataTestDirOnTestFS HConstants HFILE_ARCHIVE_DIRECTORY FileSystem fs FileSystem get conf HFileCleaner cleaner HFileCleaner server conf fs archivedHfileDir POOL createTime System currentTimeMillis fs delete archivedHfileDir fs mkdirs archivedHfileDir fs createNewFile Path archivedHfileDir LOG debug createTime i i i Path fileName Path archivedHfileDir prefix createTime i fs createNewFile fileName fs setTimes fileName createTime ttl
FileSystem fs FileSystem get conf HFileCleaner cleaner HFileCleaner server conf fs archivedHfileDir POOL createTime System currentTimeMillis fs delete archivedHfileDir fs mkdirs archivedHfileDir fs createNewFile Path archivedHfileDir LOG debug createTime i i i Path fileName Path archivedHfileDir prefix createTime i fs createNewFile fileName fs setTimes fileName createTime ttl LOG debug getFileStats fileName fs Path saved Path archivedHfileDir prefix fs createNewFile saved fs setTimes saved createTime ttl
cleaner chore t setDaemon t start cleaner Thread yield Configuration newConf Configuration conf newConf setInt HFileCleaner HFILE_DELETE_THROTTLE_THRESHOLD UPDATE_THROTTLE_POINT newConf setInt HFileCleaner LARGE_HFILE_QUEUE_INIT_SIZE UPDATE_QUEUE_INIT_SIZE newConf setInt HFileCleaner SMALL_HFILE_QUEUE_INIT_SIZE UPDATE_QUEUE_INIT_SIZE newConf setInt HFileCleaner LARGE_HFILE_DELETE_THREAD_NUMBER LARGE_THREAD_NUM newConf setInt HFileCleaner SMALL_HFILE_DELETE_THREAD_NUMBER SMALL_THREAD_NUM newConf setLong HFileCleaner HFILE_DELETE_THREAD_TIMEOUT_MSEC THREAD_TIMEOUT_MSEC newConf setLong HFileCleaner HFILE_DELETE_THREAD_CHECK_INTERVAL_MSEC THREAD_CHECK_INTERVAL_MSEC
newConf setInt HFileCleaner SMALL_HFILE_QUEUE_INIT_SIZE UPDATE_QUEUE_INIT_SIZE newConf setInt HFileCleaner LARGE_HFILE_DELETE_THREAD_NUMBER LARGE_THREAD_NUM newConf setInt HFileCleaner SMALL_HFILE_DELETE_THREAD_NUMBER SMALL_THREAD_NUM newConf setLong HFileCleaner HFILE_DELETE_THREAD_TIMEOUT_MSEC THREAD_TIMEOUT_MSEC newConf setLong HFileCleaner HFILE_DELETE_THREAD_CHECK_INTERVAL_MSEC THREAD_CHECK_INTERVAL_MSEC LOG debug cleaner getNumOfDeletedLargeFiles cleaner getNumOfDeletedSmallFiles cleaner onConfigurationChange newConf Assert assertEquals UPDATE_THROTTLE_POINT cleaner getThrottlePoint Assert assertEquals UPDATE_QUEUE_INIT_SIZE cleaner getLargeQueueInitSize Assert assertEquals UPDATE_QUEUE_INIT_SIZE cleaner getSmallQueueInitSize Assert assertEquals LARGE_THREAD_NUM SMALL_THREAD_NUM cleaner getCleanerThreads size Assert assertEquals THREAD_TIMEOUT_MSEC cleaner getCleanerThreadTimeoutMsec Assert assertEquals THREAD_CHECK_INTERVAL_MSEC cleaner getCleanerThreadCheckIntervalMsec List Thread oldThreads cleaner getCleanerThreads cleaner onConfigurationChange newConf
String fakeMachineName URLEncoder encode server getServerName toString StandardCharsets UTF_8 name FileSystem fs FileSystem get conf fs mkdirs OLD_PROCEDURE_WALS_DIR now System currentTimeMillis fs createNewFile Path OLD_WALS_DIR fs createNewFile Path OLD_WALS_DIR fakeMachineName i i i Path fileName Path OLD_PROCEDURE_WALS_DIR String format i fs createNewFile fileName Thread sleep ttlProcedureWAL ttlWAL i i i Path fileName Path OLD_WALS_DIR fakeMachineName now i fs createNewFile fileName i queueStorage addWAL server getServerName fakeMachineName fileName getName
fs createNewFile fileName Thread sleep ttlProcedureWAL ttlWAL i i i Path fileName Path OLD_WALS_DIR fakeMachineName now i fs createNewFile fileName i queueStorage addWAL server getServerName fakeMachineName fileName getName LOG info fileName i i i Path fileName Path OLD_PROCEDURE_WALS_DIR String format i fs createNewFile fileName Thread sleep ttlWAL fs createNewFile Path OLD_WALS_DIR fakeMachineName now fs createNewFile Path OLD_WALS_DIR fakeMachineName now ttlWAL FileStatus status fs listStatus OLD_WALS_DIR
List HRegion regions UTIL getHBaseCluster getRegions TABLE_NAME HRegion region regions region waitForFlushesAndCompactions region compactStores List RegionServerThread regionServerThreads UTIL getMiniHBaseCluster getRegionServerThreads HRegionServer hrs RegionServerThread rs regionServerThreads rs getRegionServer getRegions TABLE_NAME hrs rs getRegionServer CompactedHFilesDischarger cleaner CompactedHFilesDischarger hrs cleaner chore LOG info CommonFSUtils logFileSystemState fs rootDir LOG LOG debug
procId timeoutInMs deadline System currentTimeMillis timeoutInMs System currentTimeMillis deadline LockHeartbeatResponse response masterRpcService lockHeartbeat LockHeartbeatRequest newBuilder setProcId procId build response LockHeartbeatResponse assertEquals HEARTBEAT_TIMEOUT response getTimeoutMs
masterServices regionInfo ServerName sn masterServices getAssignmentManager getRegionStates getRegionServerOfRegion regionInfo RegionMetrics regionLoad masterServices getServerManager getLoad sn getRegionMetrics get regionInfo getRegionName regionLoad
procExec procId ProcedureTestingUtility waitProcedure procExec procId assertEquals procExec isRunning procExec procId
procExec procId lastStep testRecoveryAndDoubleExecution procExec procId lastStep InjectAbortOnLoadListener abortListener InjectAbortOnLoadListener procExec abortListener addProcId procId procExec registerListener abortListener procExec procId
procExec procId ProcedureTestingUtility setKillAndToggleBeforeStoreUpdate procExec InjectAbortOnLoadListener abortListener InjectAbortOnLoadListener procExec abortListener addProcId procId procExec registerListener abortListener ProcedureTestingUtility assertProcNotYetCompleted procExec procId
SnapshotProtos SnapshotDescription snapshotDesc getSnapshot ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor TableName clonedTableName TableName valueOf snapshotDesc getTable TableDescriptor htd createTableDescriptor clonedTableName CF procId ProcedureTestingUtility submitAndWait procExec CloneSnapshotProcedure procExec getEnvironment htd snapshotDesc Procedure result procExec getResult procId assertTrue result isFailed
NamespaceDescriptor nsd NamespaceDescriptor create build ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor procId1 procExec submitProcedure CreateNamespaceProcedure procExec getEnvironment nsd ProcedureTestingUtility waitProcedure procExec procId1 ProcedureTestingUtility assertProcNotFailed procExec procId1 procId2 procExec submitProcedure CreateNamespaceProcedure procExec getEnvironment nsd ProcedureTestingUtility waitProcedure procExec procId2 Procedure result procExec getResult procId2 assertTrue result isFailed
NamespaceDescriptor nsd UTIL getAdmin getNamespaceDescriptor NamespaceDescriptor SYSTEM_NAMESPACE getName ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor procId procExec submitProcedure CreateNamespaceProcedure procExec getEnvironment nsd ProcedureTestingUtility waitProcedure procExec procId Procedure result procExec getResult procId assertTrue result isFailed
NamespaceDescriptor nsd NamespaceDescriptor create build String nsKey String nsValue ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor nsd setConfiguration nsKey nsValue procId procExec submitProcedure CreateNamespaceProcedure procExec getEnvironment nsd ProcedureTestingUtility waitProcedure procExec procId Procedure result procExec getResult procId assertTrue result isFailed
NamespaceDescriptor nsd NamespaceDescriptor create build String nsKey String nsValue ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor nsd setConfiguration nsKey nsValue procId procExec submitProcedure CreateNamespaceProcedure procExec getEnvironment nsd ProcedureTestingUtility waitProcedure procExec procId Procedure result procExec getResult procId assertTrue result isFailed
ProcedureTestingUtility setKillAndToggleBeforeStoreUpdate getMasterProcedureExecutor
String namespaceName ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor validateNamespaceNotExist namespaceName procId procExec submitProcedure DeleteNamespaceProcedure procExec getEnvironment namespaceName ProcedureTestingUtility waitProcedure procExec procId Procedure result procExec getResult procId assertTrue result isFailed
String namespaceName NamespaceDescriptor SYSTEM_NAMESPACE getName ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor procId procExec submitProcedure DeleteNamespaceProcedure procExec getEnvironment namespaceName ProcedureTestingUtility waitProcedure procExec procId Procedure result procExec getResult procId assertTrue result isFailed
String namespaceName TableName tableName TableName valueOf name getMethodName ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor createNamespaceForTesting namespaceName MasterProcedureTestingUtility createTable procExec tableName procId procExec submitProcedure DeleteNamespaceProcedure procExec getEnvironment namespaceName ProcedureTestingUtility waitProcedure procExec procId Procedure result procExec getResult procId assertTrue result isFailed
TableName tableName TableName valueOf name getMethodName ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor RegionInfo regions MasterProcedureTestingUtility createTable procExec tableName UTIL getAdmin disableTable tableName procId1 procExec submitProcedure DeleteTableProcedure procExec getEnvironment tableName procId2 procExec submitProcedure DeleteTableProcedure procExec getEnvironment tableName ProcedureTestingUtility waitProcedure procExec procId1 ProcedureTestingUtility waitProcedure procExec procId2 ProcedureTestingUtility assertProcNotFailed procExec procId1 MasterProcedureTestingUtility validateTableDeletion getMaster tableName Procedure result procExec getResult procId2 assertTrue result isFailed
Procedure result procExec getResult procId2 assertTrue result isFailed cause ProcedureTestingUtility getExceptionCause result e result getException TableNotEnabledException tnde e tnde cause tnde LOG debug e assertTrue cause TableNotEnabledException ProcedurePrepareLatch prepareLatch ProcedurePrepareLatch CompatibilityLatch procId3 procExec submitProcedure DisableTableProcedure procExec getEnvironment tableName prepareLatch prepareLatch await Assert fail TableNotEnabledException
e tnde cause tnde LOG debug e assertTrue cause TableNotEnabledException ProcedurePrepareLatch prepareLatch ProcedurePrepareLatch CompatibilityLatch procId3 procExec submitProcedure DisableTableProcedure procExec getEnvironment tableName prepareLatch prepareLatch await Assert fail TableNotEnabledException tnee LOG debug tnee procId4 procExec submitProcedure DisableTableProcedure procExec getEnvironment tableName ProcedureTestingUtility waitProcedure procExec procId4 ProcedureTestingUtility assertProcNotFailed procExec procId4
TableName tableName TableName valueOf name getMethodName ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor MasterProcedureTestingUtility createTable procExec tableName procId1 procExec submitProcedure EnableTableProcedure procExec getEnvironment tableName ProcedureTestingUtility waitProcedure procExec procId1 Procedure result procExec getResult procId1 assertTrue result isFailed
count util countRows table assertTrue count metaIndex util getMiniHBaseCluster getServerWithMeta rsIndex metaIndex RS_COUNT ServerName rsServerName cluster getRegionServer rsIndex getServerName HMaster master cluster getMaster RegionInfo rsRI master getAssignmentManager getRegionsOnServer rsServerName get Result r MetaTableAccessor getRegionResult master getConnection rsRI getRegionName assertEquals RegionState State OPEN toString Bytes toString r getValue HConstants CATALOG_FAMILY HConstants STATE_QUALIFIER ServerName serverName CatalogFamilyFormat getServerName r assertEquals rsServerName serverName master getServerManager moveFromOnlineToDeadServers rsServerName master getServerManager getDeadServers finish rsServerName master getServerManager getDeadServers removeDeadServer rsServerName master getAssignmentManager getRegionStates removeServer rsServerName
HMaster master cluster getMaster RegionInfo rsRI master getAssignmentManager getRegionsOnServer rsServerName get Result r MetaTableAccessor getRegionResult master getConnection rsRI getRegionName assertEquals RegionState State OPEN toString Bytes toString r getValue HConstants CATALOG_FAMILY HConstants STATE_QUALIFIER ServerName serverName CatalogFamilyFormat getServerName r assertEquals rsServerName serverName master getServerManager moveFromOnlineToDeadServers rsServerName master getServerManager getDeadServers finish rsServerName master getServerManager getDeadServers removeDeadServer rsServerName master getAssignmentManager getRegionStates removeServer rsServerName LOG info rsServerName HRegionServer hrs cluster getRegionServer rsServerName hrs abort hrs Threads sleep
testUtil procId ProcedureExecutor MasterProcedureEnv procExec testUtil getHBaseCluster getMaster getMasterProcedureExecutor ProcedureTestingUtility waitProcedure procExec procId Procedure proc procExec getProcedure procId
master MasterProcedureEnv ProcedureExecutor MasterProcedureEnv procExec master getMasterProcedureExecutor MasterProcedureScheduler procSched procExec getEnvironment getProcedureScheduler startPollCalls procSched getPollCalls startNullPollCalls procSched getNullPollCalls
master event MasterProcedureEnv ProcedureExecutor MasterProcedureEnv procExec master getMasterProcedureExecutor MasterProcedureScheduler procSched procExec getEnvironment getProcedureScheduler startPollCalls procSched getPollCalls startNullPollCalls procSched getNullPollCalls LOG debug event assertEquals event isReady assertEquals event getSuspendedProcedures size
master event MasterProcedureEnv proc ProcedureExecutor MasterProcedureEnv procExec master getMasterProcedureExecutor MasterProcedureScheduler procSched procExec getEnvironment getProcedureScheduler startPollCalls procSched getPollCalls startNullPollCalls procSched getNullPollCalls LOG debug event assertEquals event isReady assertEquals event getSuspendedProcedures size LOG debug proc procId procExec submitProcedure proc
master event MasterProcedureEnv proc ProcedureExecutor MasterProcedureEnv procExec master getMasterProcedureExecutor MasterProcedureScheduler procSched procExec getEnvironment getProcedureScheduler startPollCalls procSched getPollCalls startNullPollCalls procSched getNullPollCalls LOG debug event assertEquals event isReady assertEquals event getSuspendedProcedures size LOG debug proc procId procExec submitProcedure proc LOG debug event event getSuspendedProcedures size Thread sleep
master event MasterProcedureEnv proc ProcedureExecutor MasterProcedureEnv procExec master getMasterProcedureExecutor MasterProcedureScheduler procSched procExec getEnvironment getProcedureScheduler startPollCalls procSched getPollCalls startNullPollCalls procSched getNullPollCalls LOG debug event assertEquals event isReady assertEquals event getSuspendedProcedures size LOG debug proc procId procExec submitProcedure proc LOG debug event event getSuspendedProcedures size Thread sleep LOG debug event event getSuspendedProcedures size assertEquals event isReady assertEquals event getSuspendedProcedures size
startPollCalls procSched getPollCalls startNullPollCalls procSched getNullPollCalls LOG debug event assertEquals event isReady assertEquals event getSuspendedProcedures size LOG debug proc procId procExec submitProcedure proc LOG debug event event getSuspendedProcedures size Thread sleep LOG debug event event getSuspendedProcedures size assertEquals event isReady assertEquals event getSuspendedProcedures size LOG debug event event wake procSched assertEquals event isReady
assertEquals event getSuspendedProcedures size LOG debug proc procId procExec submitProcedure proc LOG debug event event getSuspendedProcedures size Thread sleep LOG debug event event getSuspendedProcedures size assertEquals event isReady assertEquals event getSuspendedProcedures size LOG debug event event wake procSched assertEquals event isReady LOG debug proc ProcedureTestingUtility waitProcedure procExec procId assertEquals event isReady assertEquals event getSuspendedProcedures size
opsCount TestPeerProcedure proc procSet acquire proc queue signalAll opsCount String peerId proc getPeerId concurrentPeers assertTrue peerId concurrentPeers add peerId assertTrue opsCount decrementAndGet procId proc getProcId
TestPeerProcedure proc procSet acquire proc queue signalAll opsCount String peerId proc getPeerId concurrentPeers assertTrue peerId concurrentPeers add peerId assertTrue opsCount decrementAndGet procId proc getProcId concurrent concurrentCount incrementAndGet assertTrue concurrent NUM_PEERS concurrent concurrent NUM_PEERS LOG debug peerId procId concurrent
opsCount Procedure proc procSet acquire proc queue signalAll opsCount TableName tableId procSet getTableName proc concurrentTables assertTrue tableId concurrentTables add tableId assertTrue opsCount decrementAndGet procId proc getProcId
Procedure proc procSet acquire proc queue signalAll opsCount TableName tableId procSet getTableName proc concurrentTables assertTrue tableId concurrentTables add tableId assertTrue opsCount decrementAndGet procId proc getProcId concurrent concurrentCount incrementAndGet assertTrue concurrent NUM_TABLES concurrent concurrent NUM_TABLES LOG debug tableId procId concurrent
ProcedureTestingUtility setKillAndToggleBeforeStoreUpdate getMasterProcedureExecutor
NamespaceDescriptor nsd NamespaceDescriptor create build String nsKey String nsValue ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor createNamespaceForTesting nsd nsd setConfiguration nsKey nsValue procId procExec submitProcedure ModifyNamespaceProcedure procExec getEnvironment nsd ProcedureTestingUtility waitProcedure procExec procId Procedure result procExec getResult procId assertTrue result isFailed
NamespaceDescriptor nsd NamespaceDescriptor create build String nsKey String nsValue ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor createNamespaceForTesting nsd nsd setConfiguration nsKey nsValue procId procExec submitProcedure ModifyNamespaceProcedure procExec getEnvironment nsd ProcedureTestingUtility waitProcedure procExec procId Procedure result procExec getResult procId assertTrue result isFailed
assertTrue getMasterProcedureExecutor isRunning ProcedureTestingUtility setKillAndToggleBeforeStoreUpdate getMasterProcedureExecutor
openSeqNum regionNode getOpenSeqNum regionNode setState State OPENING regionNode setOpenSeqNum regionNode setProcedure trsp regionNode unlock ReopenTableRegionsProcedure proc ReopenTableRegionsProcedure TABLE_NAME procExec submitProcedure proc UTIL waitFor proc getState ProcedureState WAITING_TIMEOUT oldTimeout timeoutIncrements timeout proc getTimeout timeout oldTimeout
ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor TableName restoredTableName TableName valueOf name getMethodName TableDescriptor tableDescriptor createHTableDescriptor restoredTableName CF1 CF2 procId ProcedureTestingUtility submitAndWait procExec RestoreSnapshotProcedure procExec getEnvironment tableDescriptor snapshot Procedure result procExec getResult procId assertTrue result isFailed
ProcedureExecutor MasterProcedureEnv procExec getMasterProcedureExecutor UTIL getAdmin enableTable snapshotTableName procId ProcedureTestingUtility submitAndWait procExec RestoreSnapshotProcedure procExec getEnvironment snapshotHTD snapshot Procedure result procExec getResult procId assertTrue result isFailed
resetProcExecutorTestingKillFlag
setupDFS assertEquals UTIL getDFSCluster getDataNodes size store Threads sleepWithoutInterrupt AtomicInteger reCount AtomicInteger Thread thread Thread store getNumThreads i i thread i procId i thread i Thread LOG debug procId store insert TestProcedure procId
Threads sleepWithoutInterrupt AtomicInteger reCount AtomicInteger Thread thread Thread store getNumThreads i i thread i procId i thread i Thread LOG debug procId store insert TestProcedure procId LOG debug procId reCount incrementAndGet
bytes Bytes toBytes compactMinMinusOne region update r r put Put bytes addColumn CF CQ bytes region flusherAndCompactor requestFlush HFILE_UTIL waitFor getStorefilesCount Path storeArchiveDir HFileArchiveUtil getStoreArchivePathForRootDir HFILE_UTIL getDataTestDir region region getRegionInfo CF FileSystem rootFs storeArchiveDir getFileSystem HFILE_UTIL getConfiguration HFILE_UTIL waitFor FileStatus fses rootFs listStatus storeArchiveDir fses fses length COMPACT_MIN LOG info Arrays stream rootFs listStatus storeArchiveDir map f f getPath toString collect Collectors joining Path walArchiveDir Path CommonFSUtils getWALRootDir HFILE_UTIL getConfiguration HConstants HREGION_OLDLOGDIR_NAME
currentTime EnvironmentEdgeManager currentTime LOG now currentTime currentTime progress cancel c counter MobUtils c counter LOG warn mobCounter get CorruptHFileException String fName MobUtils getMobFileName c
cellsCountCompactedFromMob cellsSizeCompactedFromMob mobCell getValueLength size c getValueLength size mobFileWriter append c writer append MobUtils createMobRefCell c fileName mobStore getRefCellTags mobCells cellsCountCompactedToMob cellsSizeCompactedToMob c getValueLength writer append c c writer append c MobUtils c
writer append MobUtils createMobRefCell c fileName mobStore getRefCellTags mobCells cellsCountCompactedToMob cellsSizeCompactedToMob c getValueLength writer append c c writer append c MobUtils c MobUtils c size MobUtils getMobValueLength c size Optional TableName refTable MobUtils getTableName c refTable mobRefSet get put refTable get MobUtils getMobFileName c
conf tableName family FileSystem fs FileSystem get conf Path dir MobUtils getMobFamilyPath conf tableName family FileStatus stat fs listStatus dir size FileStatus stat
Result result ResultScanner scanner table getScanner fam counter result scanner key result getRow assertTrue Arrays equals result getValue fam qualifier Bytes add key mobVal counter
Random r Random
TableName clone TableName valueOf test getMethodName LOG info description loadAndFlushThreeTimes rows table famStr
TableName clone TableName valueOf test getMethodName LOG info description loadAndFlushThreeTimes rows table famStr
table CompactionState state admin getCompactionState table state CompactionState
tableName family FileSystem fs FileSystem get conf Path dir MobUtils getMobFamilyPath conf tableName family FileStatus stat fs listStatus dir FileStatus stat
conf tableName family FileSystem fs FileSystem get conf Path dir MobUtils getMobFamilyPath conf tableName family FileStatus stat fs listStatus dir FileStatus stat
TableName tableName TableName valueOf TABLE_NAME MobSnapshotTestingUtils createMobTable UTIL tableName FAMILY
TableName tableName TableName valueOf TABLE_NAME MobSnapshotTestingUtils createMobTable UTIL tableName FAMILY LOG info tableName expectedRows SnapshotTestingUtils loadData UTIL tableName expectedRows FAMILY
Connection connection waitForSlowLogTableCreation namedQueueRecorder clearNamedQueue NamedQueuePayload NamedQueueEvent SLOW_LOG AdminProtos SlowLogResponseRequest request AdminProtos SlowLogResponseRequest newBuilder setLimit build Assert assertEquals getSlowLogPayloads request size i i i i Uninterruptibles sleepUninterruptibly TimeUnit MILLISECONDS RpcLogDetails rpcLogDetails TestNamedQueueRecorder getRpcLogDetails i i i namedQueueRecorder addRecord rpcLogDetails Assert count getSlowLogPayloads request size
i i i i Uninterruptibles sleepUninterruptibly TimeUnit MILLISECONDS RpcLogDetails rpcLogDetails TestNamedQueueRecorder getRpcLogDetails i i i namedQueueRecorder addRecord rpcLogDetails count getSlowLogPayloads request size LOG debug count count count getTableCount connection
MasterSyncObserver throwExceptionInPreCreateTableAction ADMIN createTable tableDescriptor fail tableOne toString exp LOG error exp toString exp assertFalse ADMIN tableExists tableOne NamespaceTableAndRegionInfo nstate getNamespaceState nsp1 assertEquals nstate getTables size MasterSyncObserver throwExceptionInPreCreateTableAction ADMIN createTable tableDescriptor fail tableOne toString
desc IOException done ForeignExceptionDispatcher monitor ForeignExceptionDispatcher desc getInstance List ServerName serverNames master getServerManager getOnlineServersList List String servers ArrayList ServerName sn serverNames servers add sn toString Procedure proc coordinator startProcedure monitor desc getInstance servers proc String msg getProcedureSignature LOG error msg IOException msg HashMap String returnData returnData proc waitForCompletedWithRet
SubprocedureFactory subprocFactory Mockito mock SubprocedureFactory List Pair ProcedureMember ZKProcedureMemberRpcs procMembers ArrayList members length member members ZKWatcher watcher newZooKeeperWatcher ZKProcedureMemberRpcs comms ZKProcedureMemberRpcs watcher opDescription ThreadPoolExecutor pool2 ProcedureMember defaultPool member KEEP_ALIVE ProcedureMember procMember ProcedureMember comms pool2 subprocFactory procMembers add Pair procMember comms comms start member procMember List Subprocedure subprocs ArrayList i i procMembers i ForeignExceptionDispatcher cohortMonitor ForeignExceptionDispatcher Subprocedure commit Mockito spy SubprocedureImpl procMembers get i getFirst opName cohortMonitor WAKE_FREQUENCY TIMEOUT subprocs add commit AtomicInteger i AtomicInteger
members add Pair mem controller controller start member mem List Subprocedure cohortTasks ArrayList elem i i members i ForeignExceptionDispatcher cohortMonitor ForeignExceptionDispatcher ProcedureMember comms members get i getFirst Subprocedure commit Mockito spy SubprocedureImpl comms opName cohortMonitor WAKE_FREQUENCY TIMEOUT Mockito invocation index elem index LOG debug ForeignException remoteCause ForeignException TimeoutException Subprocedure r Subprocedure invocation getMock
controller sendMemberAcquired sub prepared countDown member sub controller sendMemberCompleted sub memberData committed countDown member operationName controller start COHORT_NODE_NAME member String prepare ZKProcedureUtil getAcquireBarrierNode controller getZkController operationName ZKUtil createSetData watcher prepare ProtobufUtil prependPBMagic data prepared await String commit ZKProcedureUtil getReachedBarrierNode controller getZkController operationName
member sub controller sendMemberCompleted sub memberData committed countDown member operationName controller start COHORT_NODE_NAME member String prepare ZKProcedureUtil getAcquireBarrierNode controller getZkController operationName ZKUtil createSetData watcher prepare ProtobufUtil prependPBMagic data prepared await String commit ZKProcedureUtil getReachedBarrierNode controller getZkController operationName LOG debug commit ZKUtil createAndFailSilent watcher commit
m Put table put Put m m Delete table delete Delete m m Append table append Append m m Increment table increment Increment m fail m getClass getSimpleName LOG info m getClass getSimpleName Thread sleep e msg StringUtils stringifyException e e msg
m Append table append Append m m Increment table increment Increment m fail m getClass getSimpleName sawSuccess LOG info m getClass getSimpleName Thread sleep sawSuccess quotaTable ResultScanner scanner quotaTable getScanner Scan Result result LOG info
tn policy sizeInMBs sizeLimit sizeInMBs SpaceQuotaHelperForTests ONE_MEGABYTE QuotaSettings settings QuotaSettingsFactory limitTableSpace tn sizeLimit policy testUtil getAdmin setQuota settings
ns policy sizeInMBs sizeLimit sizeInMBs SpaceQuotaHelperForTests ONE_MEGABYTE QuotaSettings settings QuotaSettingsFactory limitNamespaceSpace ns sizeLimit policy testUtil getAdmin setQuota settings
tn QuotaSettings removeQuota QuotaSettingsFactory removeTableSpaceLimit tn testUtil getAdmin setQuota removeQuota
ns QuotaSettings removeQuota QuotaSettingsFactory removeNamespaceSpaceLimit ns Admin admin testUtil getAdmin admin setQuota removeQuota
waitForQuotaTable conn QuotaRetriever scanner QuotaRetriever open conn getConfiguration quotaSettings scanner String namespace quotaSettings getNamespace TableName tableName quotaSettings getTableName String userName quotaSettings getUserName namespace LOG debug namespace QuotaUtil deleteNamespaceQuota conn namespace tableName LOG debug tableName QuotaUtil deleteTableQuota conn tableName userName
Admin admin TEST_UTIL getAdmin String userName User getCurrent getShortName admin setQuota QuotaSettingsFactory throttleUser userName ThrottleType REQUEST_NUMBER TimeUnit MINUTES admin setQuota QuotaSettingsFactory bypassGlobals userName TEST_UTIL countThrottle countGlobalBypass
filter QuotaRetriever scanner QuotaRetriever open TEST_UTIL getConfiguration filter count scanner
admin List QuotaSettings list_quotas admin getQuota QuotaFilter quotaSettingCount QuotaSettings list_quotas quotaSettingCount
String FAM1 HMaster master TEST_UTIL getMiniHBaseCluster getMaster master getMasterQuotaManager LOG debug Thread sleep MasterQuotaManager quotaManager master getMasterQuotaManager TableName tn TableName valueOf TableDescriptor tableDesc TableDescriptorBuilder newBuilder tn setColumnFamily ColumnFamilyDescriptorBuilder of FAM1 build TEST_UTIL getAdmin createTable tableDesc assertEquals getRegionReportsForTable quotaManager snapshotRegionSizes tn sizeLimit SpaceQuotaHelperForTests ONE_MEGABYTE SpaceViolationPolicy violationPolicy SpaceViolationPolicy NO_INSERTS QuotaSettings settings QuotaSettingsFactory limitTableSpace tn sizeLimit violationPolicy TEST_UTIL getAdmin setQuota settings TEST_UTIL
MasterQuotaManager quotaManager master getMasterQuotaManager TableName tn TableName valueOf TableDescriptor tableDesc TableDescriptorBuilder newBuilder tn setColumnFamily ColumnFamilyDescriptorBuilder of FAM1 build TEST_UTIL getAdmin createTable tableDesc assertEquals getRegionReportsForTable quotaManager snapshotRegionSizes tn sizeLimit SpaceQuotaHelperForTests ONE_MEGABYTE SpaceViolationPolicy violationPolicy SpaceViolationPolicy NO_INSERTS QuotaSettings settings QuotaSettingsFactory limitTableSpace tn sizeLimit violationPolicy TEST_UTIL getAdmin setQuota settings TEST_UTIL numReports getRegionReportsForTable quotaManager snapshotRegionSizes tn LOG debug numReports tn numReports
QuotaSettings settings QuotaSettingsFactory limitTableSpace tn sizeLimit violationPolicy TEST_UTIL getAdmin setQuota settings helper writeData tn SpaceQuotaHelperForTests ONE_MEGABYTE Map TableName SpaceQuotaSnapshot quotaSnapshots snapshotNotifier copySnapshots foundSnapshot foundSnapshot quotaSnapshots LOG info master getMasterQuotaManager snapshotRegionSizes sleepWithInterrupt DEFAULT_WAIT_MILLIS quotaSnapshots snapshotNotifier copySnapshots Entry TableName SpaceQuotaSnapshot entry Iterables getOnlyElement quotaSnapshots entrySet assertEquals tn entry getKey SpaceQuotaSnapshot snapshot entry getValue snapshot
admin flush tn1 Map TableName SpaceQuotaSnapshot snapshots snapshotNotifier copySnapshots assertEquals numSnapshotsInViolation snapshots Thread sleep DEFAULT_WAIT_MILLIS e LOG debug e snapshots snapshotNotifier copySnapshots helper writeData tn2 SpaceQuotaHelperForTests ONE_MEGABYTE admin flush tn2 snapshots snapshotNotifier copySnapshots assertEquals numSnapshotsInViolation snapshots
e LOG debug e snapshots snapshotNotifier copySnapshots helper writeData tn2 SpaceQuotaHelperForTests ONE_MEGABYTE admin flush tn2 snapshots snapshotNotifier copySnapshots assertEquals numSnapshotsInViolation snapshots Thread sleep DEFAULT_WAIT_MILLIS e LOG debug e snapshots snapshotNotifier copySnapshots helper writeData tn3 SpaceQuotaHelperForTests ONE_MEGABYTE admin flush tn3
snapshots snapshotNotifier copySnapshots helper writeData tn2 SpaceQuotaHelperForTests ONE_MEGABYTE admin flush tn2 snapshots snapshotNotifier copySnapshots assertEquals numSnapshotsInViolation snapshots Thread sleep DEFAULT_WAIT_MILLIS e LOG debug e snapshots snapshotNotifier copySnapshots helper writeData tn3 SpaceQuotaHelperForTests ONE_MEGABYTE admin flush tn3 snapshots snapshotNotifier copySnapshots numSnapshotsInViolation snapshots
SpaceViolationPolicy namespaceViolationPolicy SpaceViolationPolicy DISABLE QuotaSettings namespaceSettings QuotaSettingsFactory limitNamespaceSpace namespace namespaceSizeLimit namespaceViolationPolicy admin setQuota namespaceSettings helper writeData tn1 SpaceQuotaHelperForTests ONE_MEGABYTE admin flush tn1 Map TableName SpaceQuotaSnapshot snapshots snapshotNotifier copySnapshots assertEquals snapshots numSnapshotsInViolation snapshots Thread sleep DEFAULT_WAIT_MILLIS e LOG debug e snapshots snapshotNotifier copySnapshots helper writeData tn2 SpaceQuotaHelperForTests ONE_MEGABYTE admin flush tn2
admin flush tn1 Map TableName SpaceQuotaSnapshot snapshots snapshotNotifier copySnapshots assertEquals snapshots numSnapshotsInViolation snapshots Thread sleep DEFAULT_WAIT_MILLIS e LOG debug e snapshots snapshotNotifier copySnapshots helper writeData tn2 SpaceQuotaHelperForTests ONE_MEGABYTE admin flush tn2 snapshots snapshotNotifier copySnapshots numSnapshotsInViolation snapshots LOG debug snapshots master getMasterQuotaManager snapshotRegionSizes
sizeLimit tableSize nsLimit Long MAX_VALUE numRegions TableName tn helper createTableWithRegions numRegions QuotaSettings settings QuotaSettingsFactory limitTableSpace tn sizeLimit SpaceViolationPolicy NO_INSERTS TEST_UTIL getAdmin setQuota settings QuotaSettings nsSettings QuotaSettingsFactory limitNamespaceSpace tn getNamespaceAsString nsLimit SpaceViolationPolicy NO_INSERTS TEST_UTIL getAdmin setQuota nsSettings helper writeData tn tableSize Connection conn TEST_UTIL getConnection TEST_UTIL SpaceQuotaSnapshot snapshot SpaceQuotaSnapshot conn getAdmin getCurrentSpaceQuotaSnapshot tn
TEST_UTIL getAdmin setQuota nsSettings helper writeData tn tableSize Connection conn TEST_UTIL getConnection TEST_UTIL SpaceQuotaSnapshot snapshot SpaceQuotaSnapshot conn getAdmin getCurrentSpaceQuotaSnapshot tn LOG info snapshot snapshot snapshot getLimit sizeLimit snapshot getUsage AtomicReference Long nsUsage AtomicReference TEST_UTIL SpaceQuotaSnapshot snapshot SpaceQuotaSnapshot conn getAdmin getCurrentSpaceQuotaSnapshot tn getNamespaceAsString
AtomicReference Long nsUsage AtomicReference SpaceQuotaSnapshot snapshot SpaceQuotaSnapshot conn getAdmin getCurrentSpaceQuotaSnapshot tn getNamespaceAsString LOG debug snapshot snapshot nsUsage set snapshot getUsage snapshot getLimit nsLimit snapshot getUsage SpaceQuotaSnapshot snapshot SpaceQuotaSnapshot conn getAdmin getCurrentSpaceQuotaSnapshot tn assertTrue tn snapshot snapshot getQuotaStatus isInViolation helper writeData tn tableSize
nsUsage set snapshot getUsage snapshot getLimit nsLimit snapshot getUsage SpaceQuotaSnapshot snapshot SpaceQuotaSnapshot conn getAdmin getCurrentSpaceQuotaSnapshot tn assertTrue tn snapshot snapshot getQuotaStatus isInViolation helper writeData tn tableSize SpaceQuotaSnapshot snapshot SpaceQuotaSnapshot conn getAdmin getCurrentSpaceQuotaSnapshot tn LOG info snapshot snapshot snapshot getQuotaStatus isInViolation
bytesWritten TableName tn writeData bytesWritten LOG debug Admin admin TEST_UTIL getAdmin admin flush tn LOG debug List RegionInfo regions TEST_UTIL getAdmin getRegions tn HMaster master cluster getMaster MasterQuotaManager quotaManager master getMasterQuotaManager Map RegionInfo Long regionSizes quotaManager snapshotRegionSizes observedRegions numRegionsForTable tn regionSizes observedRegions regions
Put p Put Bytes toBytes p addColumn Bytes toBytes SpaceQuotaHelperForTests F1 Bytes toBytes Bytes toBytes TableName tn helper writeUntilViolation SpaceViolationPolicy DISABLE Admin admin TEST_UTIL getAdmin admin tn
policy Put put Put Bytes toBytes put addColumn Bytes toBytes SpaceQuotaHelperForTests F1 Bytes toBytes Bytes toBytes TableName tn helper writeUntilViolationAndVerifyViolation policy put TEST_UTIL deleteTable tn
policy Put put Put Bytes toBytes put addColumn Bytes toBytes SpaceQuotaHelperForTests F1 Bytes toBytes Bytes toBytes TableName tn helper writeUntilViolationAndVerifyViolation policy put TEST_UTIL deleteTable tn LOG debug tn TEST_UTIL createTable tn Bytes toBytes SpaceQuotaHelperForTests F1
LOG debug snapshots regionSizes Thread sleep snapshots spaceQuotaManager copyQuotaSnapshots regionSizes getReportedSizesForTable tn SpaceQuotaSnapshot snapshot snapshots get tn assertEquals snapshot getUsage assertEquals sizeLimit snapshot getLimit ActivePolicyEnforcement activePolicies spaceQuotaManager getActiveEnforcements SpaceViolationPolicyEnforcement enforcement activePolicies getPolicyEnforcement tn assertTrue enforcement getClass getSimpleName enforcement DefaultViolationPolicyEnforcement Map List Path family2Files helper generateFileToLoad tn FileSystem fs TEST_UTIL getTestFileSystem FileStatus files fs listStatus Path fs getHomeDirectory testName getMethodName FileStatus file files assertTrue file getPath file getLen file getLen SpaceQuotaHelperForTests ONE_KILOBYTE
waitForStableQuotaSize conn tn actualInitialSize conn getAdmin getCurrentSpaceQuotaSnapshot tn getUsage LOG info actualInitialSize LOG info String snapshot1 tn toString admin snapshot snapshot1 tn LOG info helper writeData tn initialSize LOG info admin flush tn LOG info TEST_UTIL compact tn upperBound initialSize FUDGE_FOR_TABLE_SIZE lowerBound initialSize FUDGE_FOR_TABLE_SIZE
upperBound initialSize FUDGE_FOR_TABLE_SIZE lowerBound initialSize FUDGE_FOR_TABLE_SIZE LOG info lowerBound upperBound size getRegionSizeReportForTable conn tn size upperBound size lowerBound waitForStableRegionSizeReport conn tn finalSize getRegionSizeReportForTable conn tn assertNotNull finalSize LOG info finalSize conn tn snapshot snapshot getUsage finalSize
size getRegionSizeReportForTable conn tn size upperBound size lowerBound waitForStableRegionSizeReport conn tn finalSize getRegionSizeReportForTable conn tn assertNotNull finalSize LOG info finalSize conn tn snapshot snapshot getUsage finalSize expectedFinalSize actualInitialSize finalSize LOG info actualInitialSize finalSize expectedFinalSize
String ns helper createNamespace getName TableName tn helper createTableWithRegions ns LOG info QuotaSettings settings QuotaSettingsFactory limitNamespaceSpace ns SpaceQuotaHelperForTests ONE_GIGABYTE SpaceViolationPolicy NO_INSERTS admin setQuota settings initialSize SpaceQuotaHelperForTests ONE_MEGABYTE helper writeData tn initialSize admin flush tn LOG info conn ns snapshot snapshot getUsage initialSize waitForStableQuotaSize conn ns actualInitialSize conn getAdmin getCurrentSpaceQuotaSnapshot ns getUsage
waitForStableQuotaSize conn ns actualInitialSize conn getAdmin getCurrentSpaceQuotaSnapshot ns getUsage LOG info actualInitialSize LOG info String snapshot1 tn getQualifierAsString admin snapshot snapshot1 tn LOG info helper writeData tn initialSize LOG info admin flush tn LOG info TEST_UTIL compact tn upperBound initialSize FUDGE_FOR_TABLE_SIZE lowerBound initialSize FUDGE_FOR_TABLE_SIZE
Map TableName Long sizes conn getAdmin getSpaceQuotaTableSizes LOG debug sizes Long size sizes get tn size size upperBound size lowerBound waitForStableRegionSizeReport conn tn finalSize getRegionSizeReportForTable conn tn assertNotNull finalSize LOG info finalSize conn snapshot snapshot getUsage finalSize
Long size sizes get tn size size upperBound size lowerBound waitForStableRegionSizeReport conn tn finalSize getRegionSizeReportForTable conn tn assertNotNull finalSize LOG info finalSize conn snapshot snapshot getUsage finalSize expectedFinalSize actualInitialSize finalSize LOG info actualInitialSize finalSize expectedFinalSize
sizeLimit SpaceQuotaHelperForTests ONE_MEGABYTE QuotaSettings settings QuotaSettingsFactory limitTableSpace tn sizeLimit SpaceViolationPolicy NO_WRITES_COMPACTIONS conn conn getAdmin setQuota settings waitForTableToEnterQuotaViolation tn conn conn getAdmin majorCompact tn fail
TableName tn HRegionServer rs TEST_UTIL getHBaseCluster getRegionServer TEST_UTIL Map TableName SpaceQuotaSnapshot snapshots rs getRegionServerSpaceQuotaManager copyQuotaSnapshots SpaceQuotaSnapshot snapshot snapshots get tn snapshot
valueSize family qualifier tables count count Put put Put Bytes toBytes count value valueSize value Bytes toBytes count value generateValue valueSize put addColumn family qualifier value table tables table put put count tables length
isBypass quotaCache getTableLimiter table isBypass isBypass quotaCache getNamespaceLimiter table getNamespaceAsString isBypass isBypass envEdge incValue isUpdated rsIsBypass quotaCache getRegionServerQuotaLimiter QuotaTableUtil QUOTA_REGION_SERVER_ROW_KEY isBypass rsIsBypass envEdge incValue isUpdated quotaCache envEdge incValue
isBypass quotaCache getNamespaceLimiter table getNamespaceAsString isBypass isBypass envEdge incValue isUpdated rsIsBypass quotaCache getRegionServerQuotaLimiter QuotaTableUtil QUOTA_REGION_SERVER_ROW_KEY isBypass rsIsBypass envEdge incValue isUpdated quotaCache envEdge incValue isUpdated
isBypass quotaCache getNamespaceLimiter table getNamespaceAsString isBypass isBypass envEdge incValue isUpdated rsIsBypass quotaCache getRegionServerQuotaLimiter QuotaTableUtil QUOTA_REGION_SERVER_ROW_KEY isBypass rsIsBypass envEdge incValue isUpdated quotaCache envEdge incValue isUpdated
isBypass quotaCache getNamespaceLimiter table getNamespaceAsString isBypass isBypass envEdge incValue isUpdated rsIsBypass quotaCache getRegionServerQuotaLimiter QuotaTableUtil QUOTA_REGION_SERVER_ROW_KEY isBypass rsIsBypass envEdge incValue isUpdated quotaCache envEdge incValue isUpdated LOG debug
options addOption COMPRESSION_OPTION Arrays toString Compression Algorithm values options addOption BLOOM_FILTER_OPTION Arrays toString BloomType values options addOption BLOOM_FILTER_PARAM_OPTION options addOption BLOCK_SIZE_OPTION options addOption BLOOM_BLOCK_SIZE_OPTION options addOption INDEX_BLOCK_SIZE_OPTION args HelpFormatter formatter HelpFormatter formatter printHelp CreateRandomStoreFile getSimpleName options CommandLineParser parser PosixParser CommandLine cmdLine cmdLine parser parse options args
cmdLine hasOption BLOOM_FILTER_PARAM_OPTION LOG error conf set BloomFilterUtil PREFIX_LENGTH_KEY cmdLine getOptionValue BLOOM_FILTER_PARAM_OPTION blockSize HConstants DEFAULT_BLOCKSIZE cmdLine hasOption BLOCK_SIZE_OPTION blockSize Integer valueOf cmdLine getOptionValue BLOCK_SIZE_OPTION cmdLine hasOption BLOOM_BLOCK_SIZE_OPTION conf setInt BloomFilterFactory IO_STOREFILE_BLOOM_BLOCK_SIZE Integer valueOf cmdLine getOptionValue BLOOM_BLOCK_SIZE_OPTION cmdLine hasOption INDEX_BLOCK_SIZE_OPTION conf setInt HFileBlockIndex MAX_CHUNK_SIZE_KEY Integer valueOf cmdLine getOptionValue INDEX_BLOCK_SIZE_OPTION HFileContext meta HFileContextBuilder withCompression compr withBlockSize blockSize build StoreFileWriter sfw StoreFileWriter Builder conf CacheConfig conf fs withOutputDir outputDir withBloomType bloomType withMaxKeyCount numKV withFileContext meta build rand Random LOG info numKV
options addOption OPT_BENCHMARK_N_OMIT DEFAULT_BENCHMARK_N_OMIT DEFAULT_BENCHMARK_N_TIMES DEFAULT_BENCHMARK_N_OMIT CommandLineParser parser PosixParser CommandLine cmd cmd parser parse options args System err println System exit kvLimit Integer MAX_VALUE cmd OPT_KV_LIMIT kvLimit Integer parseInt cmd getOptionValue OPT_KV_LIMIT kvLimit LOG error cmd
LOG error cmd hasOption OPT_HFILE_NAME LOG error OPT_HFILE_NAME printUsage options System exit String pathName cmd getOptionValue OPT_HFILE_NAME String compressionName DEFAULT_COMPRESSION getName cmd hasOption OPT_COMPRESSION_ALGORITHM compressionName cmd getOptionValue OPT_COMPRESSION_ALGORITHM toLowerCase Locale ROOT doBenchmark cmd hasOption OPT_MEASURE_THROUGHPUT doVerify cmd hasOption OPT_OMIT_CORRECTNESS_TEST cmd hasOption OPT_BENCHMARK_N_TIMES benchmarkNTimes Integer valueOf cmd getOptionValue OPT_BENCHMARK_N_TIMES cmd hasOption
cmd hasOption OPT_HFILE_NAME LOG error OPT_HFILE_NAME printUsage options System exit String pathName cmd getOptionValue OPT_HFILE_NAME String compressionName DEFAULT_COMPRESSION getName cmd hasOption OPT_COMPRESSION_ALGORITHM compressionName cmd getOptionValue OPT_COMPRESSION_ALGORITHM toLowerCase Locale ROOT doBenchmark cmd hasOption OPT_MEASURE_THROUGHPUT doVerify cmd hasOption OPT_OMIT_CORRECTNESS_TEST cmd hasOption OPT_BENCHMARK_N_TIMES benchmarkNTimes Integer valueOf cmd getOptionValue OPT_BENCHMARK_N_TIMES cmd hasOption OPT_BENCHMARK_N_OMIT benchmarkNOmit Integer valueOf cmd getOptionValue OPT_BENCHMARK_N_OMIT benchmarkNTimes benchmarkNOmit
LOG info initHRegion tableName name getMethodName fam1 fam2 numThreads incrementsPerThread Incrementer all Incrementer numThreads expectedTotal i i numThreads i all i Incrementer region i i incrementsPerThread expectedTotal i incrementsPerThread i i numThreads i all i start i i numThreads i all i join
Incrementer all Incrementer numThreads expectedTotal i i numThreads i all i Incrementer region i i incrementsPerThread expectedTotal i incrementsPerThread i i numThreads i all i start i i numThreads i all i join e LOG info e assertICV row fam1 qual1 expectedTotal fast assertICV row fam1 qual2 expectedTotal fast assertICV row fam2 qual3 expectedTotal fast
mrm add d Delete d Delete row2 d addColumns fam1 qual1 ts d setDurability Durability ASYNC_WAL mrm add d Put p Put row ts p setDurability Durability ASYNC_WAL p addColumn fam1 qual1 value2 mrm add p region mutateRowsWithLocks mrm rowsToLock HConstants NO_NONCE HConstants NO_NONCE op Scan s Scan withStartRow row RegionScanner rs region getScanner s List Cell r ArrayList
IOException IOException ex region close IOException e LOG warn e ex e walFactory close IOException e LOG warn e ex e fs delete Path DIR IOException e
LOG info region flush LOG info region compact LOG info region compact i i i Collection KeyValue kvSet Scan scan Scan scan readAllVersions i columnLists i isEmpty
LOG info region flush LOG info region compact LOG info region compact i i i Collection KeyValue kvSet Scan scan Scan scan readAllVersions i columnLists i isEmpty
hmc keys fam Bytes toBytes qf Bytes toBytes size hmc getActive getDataSize heapOverhead hmc getActive getHeapSize cellsCount hmc getActive getCellsCount totalLen i i keys i timestamp System currentTimeMillis Threads sleep row Bytes toBytes keys i val Bytes toBytes keys i i KeyValue kv KeyValue row fam qf timestamp val totalLen Segment getCellLength kv hmc add kv
hmc keys val fam Bytes toBytes qf Bytes toBytes size hmc getActive getDataSize heapOverhead hmc getActive getHeapSize cellsCount hmc getActive getCellsCount totalLen i i keys i timestamp System currentTimeMillis Threads sleep row Bytes toBytes keys i KeyValue kv KeyValue row fam qf timestamp val totalLen Segment getCellLength kv hmc add kv
hmc keys fam Bytes toBytes qf Bytes toBytes MemStoreSizing memstoreSizing NonThreadSafeMemStoreSizing i i keys i timestamp System currentTimeMillis Threads sleep row Bytes toBytes keys i val Bytes toBytes keys i i KeyValue kv KeyValue row fam qf timestamp val hmc add kv memstoreSizing
Put putc Put ROW_C putc addColumn TEST_FAMILY qualifierCol1 bytes3 table put putc admin flush TEST_TABLE admin compact TEST_TABLE admin TEST_TABLE Thread sleep table put putb HRegion hr1 HRegion util getRSForFirstRegionInTable TEST_TABLE getRegionByEncodedName admin getRegions TEST_TABLE get getEncodedName hr1 refreshStoreFiles store hr1 store closeAndArchiveCompactedFiles hr1 compact
HRegionServer regionSvr UTIL getRSForFirstRegionInTable TABLE_NAME HRegion region regionSvr getRegions TABLE_NAME get String regName region getRegionInfo getEncodedName List HRegion metaRegs regionSvr getRegions TableName META_TABLE_NAME metaRegs metaRegs
HRegionServer regionSvr UTIL getRSForFirstRegionInTable TABLE_NAME HRegion region regionSvr getRegions TABLE_NAME get String regName region getRegionInfo getEncodedName List HRegion metaRegs regionSvr getRegions TableName META_TABLE_NAME metaRegs metaRegs LOG info regionSvr HRegionServer otherRs UTIL getOtherRegionServer regionSvr UTIL moveRegionAndWait region getRegionInfo otherRs getServerName
falsePosRate nTrials String p BloomFilterFactory getErrorRate conf zValue falsePosRate p Math sqrt p p nTrials String assortedStatsStr p falsePosRate nTrials
numChecked fakeLookupEnabled fakeLookupEnabled BloomFilterUtil setRandomGeneratorForTest Random String fakeLookupModeStr fakeLookupEnabled CompoundBloomFilter cbf CompoundBloomFilter r getGeneralBloomFilter cbf enableTestingStats numFalsePos Random rand Random EVALUATION_SEED nTrials NUM_KV t nTrials query RandomKeyValueUtil randomRowOrQualifier rand query rand numFalsePos
CompoundBloomFilter cbf CompoundBloomFilter r getGeneralBloomFilter cbf enableTestingStats numFalsePos Random rand Random EVALUATION_SEED nTrials NUM_KV t nTrials query RandomKeyValueUtil randomRowOrQualifier rand query rand numFalsePos falsePosRate numFalsePos nTrials LOG debug String format testIdMsg numFalsePos nTrials falsePosRate fakeLookupModeStr assertTrue falsePosRate TOO_HIGH_ERROR_RATE fakeLookupModeStr falsePosRate TOO_HIGH_ERROR_RATE maxZValue fakeLookupEnabled validateFalsePosRate falsePosRate nTrials maxZValue cbf fakeLookupModeStr nChunks cbf getNumChunks
t bt KeyValue conf setInt BloomFilterFactory IO_STOREFILE_BLOOM_BLOCK_SIZE BLOOM_BLOCK_SIZES t conf setBoolean CacheConfig CACHE_BLOCKS_ON_WRITE_KEY cacheConf CacheConfig conf blockCache HFileContext meta HFileContextBuilder withBlockSize BLOCK_SIZES t build StoreFileWriter w StoreFileWriter Builder conf cacheConf fs withOutputDir TEST_UTIL getDataTestDir withBloomType bt withFileContext meta build assertTrue w hasGeneralBloom assertTrue w getGeneralBloomWriter CompoundBloomFilterWriter CompoundBloomFilterWriter cbbf CompoundBloomFilterWriter w getGeneralBloomWriter keyCount KeyValue prev
rowCount addRows memstore List KeyValueScanner memstorescanners memstore getScanners Scan scan Scan List Cell result ArrayList Configuration conf HBaseConfiguration create ScanInfo scanInfo ScanInfo conf HConstants LATEST_TIMESTAMP KeepDeletedCells FALSE HConstants DEFAULT_BLOCKSIZE memstore getComparator count scan scanInfo memstorescanners result
ScanInfo scanInfo ScanInfo conf HConstants LATEST_TIMESTAMP KeepDeletedCells FALSE HConstants DEFAULT_BLOCKSIZE memstore getComparator count scanInfo memstorescanners result LOG info Objects toString result count assertEquals rowCount result size result clear assertEquals rowCount count scanner memstorescanners scanner close memstorescanners memstore getScanners mvcc getReadPoint count scanInfo memstorescanners result
result LOG info Objects toString result assertTrue CellUtil matchingRows result get Bytes toBytes count count assertEquals rowCount result size count memstore snapshot LOG info result clear assertEquals rowCount count scanner memstorescanners scanner close memstorescanners memstore getScanners mvcc getReadPoint ts System currentTimeMillis count
Table source TEST_UTIL getConnection getTable tableName Admin admin TEST_UTIL getAdmin TableDescriptor htd TableDescriptorBuilder newBuilder tableName setColumnFamily ColumnFamilyDescriptorBuilder of fam build Map String StoreFileReader scanner Maps newHashMap admin createTable htd TEST_UTIL loadTable source fam compactSplit setCompactionsEnabled admin split tableName TEST_UTIL waitFor TEST_UTIL getHBaseCluster getRegions tableName size List HRegion regions TEST_UTIL getHBaseCluster getRegions tableName regions r r scanner r getRegionInfo getEncodedName sf StoreFileReader reader HStoreFile sf getReader reader getStoreFileScanner scanner put r getRegionInfo getEncodedName reader
reader getStoreFileScanner scanner put r getRegionInfo getEncodedName reader LOG info sf getPath r getRegionInfo getEncodedName assertTrue regions size assertTrue scanner size compactSplit setCompactionsEnabled region regions region compact regions stream filter region scanner containsKey region getRegionInfo getEncodedName forEach r assertFalse r getStores get canSplit scanner forEach s s close
HStoreFile sf HStoreFile fs writer getPath util getConfiguration cacheConf BloomType NONE sf initReader StoreFileReader reader sf getReader HFileScanner scanner reader getScanner FaultyInputStream inStream faultyfs inStreams get get assertNotNull inStream scanner seekTo assertTrue scanner next faultyfs startFaults scanned scanner next scanned fail
TestHStoreFile writeStoreFile writer Bytes toBytes Bytes toBytes HStoreFile sf HStoreFile fs writer getPath util getConfiguration cacheConf BloomType NONE List StoreFileScanner scanners StoreFileScanner getScannersForStoreFiles Collections singletonList sf KeyValueScanner scanner scanners get FaultyInputStream inStream faultyfs inStreams get get assertNotNull inStream scanner seek KeyValue LOWESTKEY assertNotNull scanner next faultyfs startFaults scanned scanner next scanned fail
util startMiniCluster TableName tableName TableName valueOf name getMethodName fam Bytes toBytes Admin admin util getAdmin TableDescriptor tableDescriptor TableDescriptorBuilder newBuilder tableName setColumnFamily ColumnFamilyDescriptorBuilder newBuilder fam setMaxVersions setBlockCacheEnabled build build admin createTable tableDescriptor table util tableName util loadTable table fam util flush util countRows table util getDFSCluster shutdownDataNodes util countRows table fail
Path rootdir UTIL getDataTestDirOnTestFS TableDescriptors tds FSTableDescriptors UTIL getConfiguration FSTableDescriptors tryUpdateMetaTableDescriptor UTIL getConfiguration TableDescriptor td tds get TableName META_TABLE_NAME td TableDescriptorBuilder newBuilder td setMemStoreFlushSize build HRegion mr HBaseTestingUtility createRegionAndWAL RegionInfoBuilder FIRST_META_REGIONINFO rootdir conf td c c c TableDescriptor htd TableDescriptorBuilder newBuilder TableName valueOf c build last interval i i last i interval RegionInfo hri RegionInfoBuilder newBuilder htd getTableName setStartKey i HConstants EMPTY_BYTE_ARRAY Bytes toBytes i setEndKey i last HConstants EMPTY_BYTE_ARRAY Bytes toBytes i interval build Put put MetaTableAccessor makePutFromRegionInfo hri EnvironmentEdgeManager currentTime put setDurability Durability SKIP_WAL
c c c TableDescriptor htd TableDescriptorBuilder newBuilder TableName valueOf c build last interval i i last i interval RegionInfo hri RegionInfoBuilder newBuilder htd getTableName setStartKey i HConstants EMPTY_BYTE_ARRAY Bytes toBytes i setEndKey i last HConstants EMPTY_BYTE_ARRAY Bytes toBytes i interval build Put put MetaTableAccessor makePutFromRegionInfo hri EnvironmentEdgeManager currentTime put setDurability Durability SKIP_WAL LOG info put mr put put InternalScanner s mr getScanner Scan List Cell keys ArrayList s keys
region closing set i threads i threads i threads i GetTillDoneOrException i Bytes toBytes startRow done gets threads i setDaemon threads i start region HBaseTestingUtility closeRegionAndWAL region region done set GetTillDoneOrException t threads t join e e printStackTrace
OperationStatus codes region batchMutate batchOp assertEquals codes length i i i assertEquals OperationStatusCode SUCCESS codes i getOperationStatusCode metricsAssertHelper assertCounter syncs source RowLock lock region getRowLock Bytes toBytes MultithreadedTestUtil TestContext ctx MultithreadedTestUtil TestContext CONF AtomicReference IOException retFromThread AtomicReference CountDownLatch finishedPuts CountDownLatch MutationBatchOperation finalBatchOp MutationBatchOperation region puts HConstants NO_NONCE HConstants NO_NONCE ctx IOException region batchMutate finalBatchOp IOException
fam Bytes toBytes families fam region initHRegion tableName method CONF families row Bytes toBytes qual Bytes toBytes Put put Put row put addColumn fam qual HConstants LATEST_TIMESTAMP Bytes toBytes region put put Get get Get row addColumn fam qual Result result region get get assertEquals result size Cell kv result rawCells
region put put Get get Get row addColumn fam qual Result result region get get assertEquals result size Cell kv result rawCells LOG info kv assertTrue kv getTimestamp HConstants LATEST_TIMESTAMP row Bytes toBytes put Put row put addColumn fam qual HConstants LATEST_TIMESTAMP Bytes toBytes region put put get Get row addColumn fam qual result region get get assertEquals result size kv result rawCells
FileSystem fs FileSystem get CONF Path rootDir Path dir FSHLog hLog FSHLog fs rootDir CONF hLog init region initHRegion tableName Durability SYNC_WAL hLog COLUMN_FAMILY_BYTES Cell originalCell ExtendedCellBuilderFactory create CellBuilderType DEEP_COPY setRow row setFamily COLUMN_FAMILY_BYTES setQualifier qual1 setTimestamp System currentTimeMillis setType KeyValue Type Put getCode setValue value1 build originalSize originalCell getSerializedSize Cell addCell ExtendedCellBuilderFactory create CellBuilderType DEEP_COPY setRow row setFamily COLUMN_FAMILY_BYTES setQualifier qual1 setTimestamp System currentTimeMillis setType KeyValue Type Put getCode setValue Bytes toBytes build addSize addCell getSerializedSize
FlushThread flushThread FlushThread flushThread start Scan scan Scan scan addFamily family scan setFilter SingleColumnValueFilter family qual1 CompareOperator EQUAL BinaryComparator Bytes toBytes expectedCount List Cell res ArrayList toggle i i i Put put Put Bytes toBytes i put setDurability Durability SKIP_WAL put addColumn family qual1 Bytes toBytes i region put put i i
put addColumn fam2 col Bytes toBytes ht put put HRegion firstRegion htu getHBaseCluster getRegions tableName get firstRegion flush HDFSBlocksDistribution blocksDistribution1 firstRegion getHDFSBlocksDistribution uniqueBlocksWeight1 blocksDistribution1 getUniqueBlocksTotalWeight StringBuilder sb StringBuilder String host blocksDistribution1 getTopHosts sb length sb append sb append host sb append sb append blocksDistribution1 getWeight host String topHost blocksDistribution1 getTopHosts get topHostWeight blocksDistribution1 getWeight topHost String msg uniqueBlocksWeight1 topHostWeight topHost sb toString
assertNotNull region region put Put Bytes toBytes addColumn fam1 fam1 fam1 region flush HBaseTestingUtility closeRegionAndWAL region ArgumentCaptor WALEdit editCaptor ArgumentCaptor forClass WALEdit WAL wal mockWAL when rss getWAL any RegionInfo thenReturn wal region HRegion openHRegion hri htd rss getWAL hri TEST_UTIL getConfiguration rss verify wal times appendMarker any RegionInfo any WALKeyImpl editCaptor capture WALEdit edit editCaptor getValue assertNotNull edit assertNotNull edit getCells assertEquals edit getCells size RegionEventDescriptor desc WALEdit getRegionEventDescriptor edit getCells get assertNotNull desc
TableDescriptor htd TableDescriptorBuilder newBuilder TableName valueOf name getMethodName setColumnFamily ColumnFamilyDescriptorBuilder of fam1 setColumnFamily ColumnFamilyDescriptorBuilder of fam2 build RegionInfo hri RegionInfoBuilder newBuilder htd getTableName build ArgumentCaptor WALEdit editCaptor ArgumentCaptor forClass WALEdit WAL wal mockWAL when rss getWAL any RegionInfo thenReturn wal region HRegion createHRegion hri rootDir TEST_UTIL getConfiguration htd rss getWAL hri region HRegion openHRegion hri htd rss getWAL hri TEST_UTIL getConfiguration rss region close verify wal times appendMarker any RegionInfo WALKeyImpl any WALKeyImpl editCaptor capture WALEdit edit editCaptor getAllValues get assertNotNull edit assertNotNull edit getCells assertEquals edit getCells size RegionEventDescriptor desc WALEdit getRegionEventDescriptor edit getCells get assertNotNull desc
region put p Result result region get Get row Cell c result getColumnLatestCell fam1 qual1 assertNotNull c assertEquals c getTimestamp edge setValue p Put row p setDurability Durability SKIP_WAL p addColumn fam1 qual1 qual2 RowMutations rm RowMutations row rm add p assertTrue region checkAndRowMutate row fam1 qual1 CompareOperator EQUAL BinaryComparator qual1 rm result region get Get row c result getColumnLatestCell fam1 qual1 assertEquals c getTimestamp
TEST_UTIL HBaseTestingUtility Configuration conf TEST_UTIL getConfiguration TEST_UTIL startMiniCluster Table table TEST_UTIL createTable TABLE_NAME FAMILIES assertEquals TEST_UTIL countRows table HRegionFileSystem regionFs getHRegionFS TEST_UTIL getConnection table conf String spA regionFs getStoragePolicyName Bytes toString FAMILIES String spB regionFs getStoragePolicyName Bytes toString FAMILIES
TEST_UTIL HBaseTestingUtility Configuration conf TEST_UTIL getConfiguration TEST_UTIL startMiniCluster Table table TEST_UTIL createTable TABLE_NAME FAMILIES assertEquals TEST_UTIL countRows table HRegionFileSystem regionFs getHRegionFS TEST_UTIL getConnection table conf String spA regionFs getStoragePolicyName Bytes toString FAMILIES String spB regionFs getStoragePolicyName Bytes toString FAMILIES LOG debug spA
HRegionFileSystem regionFs getHRegionFS TEST_UTIL getConnection table conf String spA regionFs getStoragePolicyName Bytes toString FAMILIES String spB regionFs getStoragePolicyName Bytes toString FAMILIES LOG debug spA LOG debug spB assertEquals spA assertEquals spB TEST_UTIL shutdownMiniCluster TEST_UTIL getConfiguration set HStore BLOCK_STORAGE_POLICY_KEY TEST_UTIL startMiniCluster table TEST_UTIL createTable TABLE_NAME FAMILIES regionFs getHRegionFS TEST_UTIL getConnection table conf TEST_UTIL getConnection spA regionFs getStoragePolicyName Bytes toString FAMILIES spB regionFs getStoragePolicyName Bytes toString FAMILIES
String spA regionFs getStoragePolicyName Bytes toString FAMILIES String spB regionFs getStoragePolicyName Bytes toString FAMILIES LOG debug spA LOG debug spB assertEquals spA assertEquals spB TEST_UTIL shutdownMiniCluster TEST_UTIL getConfiguration set HStore BLOCK_STORAGE_POLICY_KEY TEST_UTIL startMiniCluster table TEST_UTIL createTable TABLE_NAME FAMILIES regionFs getHRegionFS TEST_UTIL getConnection table conf TEST_UTIL getConnection spA regionFs getStoragePolicyName Bytes toString FAMILIES spB regionFs getStoragePolicyName Bytes toString FAMILIES LOG debug spA
assertEquals spB ColumnFamilyDescriptorBuilder cfdA ColumnFamilyDescriptorBuilder newBuilder FAMILIES cfdA setValue HStore BLOCK_STORAGE_POLICY_KEY admin modifyColumnFamily TABLE_NAME cfdA build Thread sleep LOG debug ColumnFamilyDescriptorBuilder cfdB ColumnFamilyDescriptorBuilder newBuilder FAMILIES cfdB setStoragePolicy admin modifyColumnFamily TABLE_NAME cfdB build Thread sleep LOG debug spA regionFs getStoragePolicyName Bytes toString FAMILIES spB regionFs getStoragePolicyName Bytes toString FAMILIES
ColumnFamilyDescriptorBuilder cfdA ColumnFamilyDescriptorBuilder newBuilder FAMILIES cfdA setValue HStore BLOCK_STORAGE_POLICY_KEY admin modifyColumnFamily TABLE_NAME cfdA build Thread sleep LOG debug ColumnFamilyDescriptorBuilder cfdB ColumnFamilyDescriptorBuilder newBuilder FAMILIES cfdB setStoragePolicy admin modifyColumnFamily TABLE_NAME cfdB build Thread sleep LOG debug spA regionFs getStoragePolicyName Bytes toString FAMILIES spB regionFs getStoragePolicyName Bytes toString FAMILIES LOG debug spA
NUM_RS Admin hbaseAdmin TEST_UTIL startMiniCluster NUM_RS TableName tableName TableName valueOf name getMethodName FAMILY Bytes toBytes MiniHBaseCluster cluster TEST_UTIL getHBaseCluster HMaster master cluster getMaster TableDescriptor tableDescriptor TableDescriptorBuilder newBuilder tableName setColumnFamily ColumnFamilyDescriptorBuilder of FAMILY build hbaseAdmin master getConnection getAdmin hbaseAdmin createTable tableDescriptor assertTrue hbaseAdmin isTableAvailable tableName
hbaseAdmin createTable tableDescriptor assertTrue hbaseAdmin isTableAvailable tableName LOG info tableName Table table TEST_UTIL getConnection getTable tableName putDataAndVerify table FAMILY TEST_UTIL waitUntilAllRegionsAssigned table getName RegionInfo regionInfo locator TEST_UTIL getConnection tableName regionInfo locator getRegionLocation Bytes toBytes getRegion originServerNum cluster getServerWith regionInfo getRegionName HRegionServer originServer cluster getRegionServer originServerNum targetServerNum originServerNum NUM_RS HRegionServer targetServer cluster getRegionServer targetServerNum assertFalse originServer equals targetServer TEST_UTIL waitUntilAllRegionsAssigned table getName
TEST_UTIL waitUntilAllRegionsAssigned table getName RegionInfo regionInfo locator TEST_UTIL regionInfo locator getRegionLocation Bytes toBytes getRegion originServerNum cluster getServerWith regionInfo getRegionName HRegionServer originServer cluster getRegionServer originServerNum targetServerNum originServerNum NUM_RS HRegionServer targetServer cluster getRegionServer targetServerNum assertFalse originServer equals targetServer TEST_UTIL waitUntilAllRegionsAssigned table getName LOG info regionInfo getEncodedName targetServer getServerName hbaseAdmin move regionInfo getEncodedNameAsBytes targetServer getServerName Thread sleep cluster getServerWith regionInfo getRegionName originServerNum
regionInfo locator getRegionLocation Bytes toBytes getRegion originServerNum cluster getServerWith regionInfo getRegionName HRegionServer originServer cluster getRegionServer originServerNum targetServerNum originServerNum NUM_RS HRegionServer targetServer cluster getRegionServer targetServerNum assertFalse originServer equals targetServer TEST_UTIL waitUntilAllRegionsAssigned table getName LOG info regionInfo getEncodedName targetServer getServerName hbaseAdmin move regionInfo getEncodedNameAsBytes targetServer getServerName Thread sleep cluster getServerWith regionInfo getRegionName originServerNum LOG info tableName putDataAndVerify table FAMILY TEST_UTIL waitUntilAllRegionsAssigned table getName
HRegionServer targetServer cluster getRegionServer targetServerNum assertFalse originServer equals targetServer TEST_UTIL waitUntilAllRegionsAssigned table getName LOG info regionInfo getEncodedName targetServer getServerName hbaseAdmin move regionInfo getEncodedNameAsBytes targetServer getServerName Thread sleep cluster getServerWith regionInfo getRegionName originServerNum LOG info tableName putDataAndVerify table FAMILY TEST_UTIL waitUntilAllRegionsAssigned table getName LOG info regionInfo getEncodedName originServer getServerName hbaseAdmin move regionInfo getEncodedNameAsBytes originServer getServerName Thread sleep
TEST_UTIL waitUntilAllRegionsAssigned table getName LOG info regionInfo getEncodedName targetServer getServerName hbaseAdmin move regionInfo getEncodedNameAsBytes targetServer getServerName Thread sleep cluster getServerWith regionInfo getRegionName originServerNum LOG info tableName putDataAndVerify table FAMILY TEST_UTIL waitUntilAllRegionsAssigned table getName LOG info regionInfo getEncodedName originServer getServerName hbaseAdmin move regionInfo getEncodedNameAsBytes originServer getServerName Thread sleep cluster getServerWith regionInfo getRegionName targetServerNum LOG info tableName
cluster getServerWith regionInfo getRegionName originServerNum LOG info tableName putDataAndVerify table FAMILY TEST_UTIL waitUntilAllRegionsAssigned table getName LOG info regionInfo getEncodedName originServer getServerName hbaseAdmin move regionInfo getEncodedNameAsBytes originServer getServerName Thread sleep cluster getServerWith regionInfo getRegionName targetServerNum LOG info tableName putDataAndVerify table FAMILY LOG info targetServer getServerName targetServer kill cluster getRegionServerThreads get targetServerNum join
putDataAndVerify table FAMILY TEST_UTIL waitUntilAllRegionsAssigned table getName LOG info regionInfo getEncodedName originServer getServerName hbaseAdmin move regionInfo getEncodedNameAsBytes originServer getServerName Thread sleep cluster getServerWith regionInfo getRegionName targetServerNum LOG info tableName putDataAndVerify table FAMILY LOG info targetServer getServerName targetServer kill cluster getRegionServerThreads get targetServerNum join Thread sleep LOG info targetServer getServerName
FlushDescriptor flushDesc WALEdit getFlushDescriptor entry getEdit getCells get CompactionDescriptor compactionDesc WALEdit getCompaction entry getEdit getCells get flushDesc verifyData secondaryRegion lastReplayed cq families HStore store secondaryRegion getStore Bytes toBytes storeMemstoreSize store getMemStoreSize getHeapSize regionMemstoreSize secondaryRegion getMemStoreDataSize MemStoreSize mss store getFlushableSize storeSize store getSize storeSizeUncompressed store getStoreSizeUncompressed flushDesc LOG info PrepareFlushResult result secondaryRegion replayWALFlushStartMarker flushDesc assertNull result result assertEquals result flushOpSeqId flushDesc getFlushSequenceNumber
FlushDescriptor flushDesc WALEdit getFlushDescriptor entry getEdit getCells get flushDesc HStore store secondaryRegion getStore Bytes toBytes storeMemstoreSize store getMemStoreSize getHeapSize regionMemstoreSize secondaryRegion getMemStoreDataSize MemStoreSize mss store getFlushableSize flushDesc startFlushDesc flushDesc LOG info PrepareFlushResult result secondaryRegion replayWALFlushStartMarker startFlushDesc assertNull result result assertEquals result flushOpSeqId startFlushDesc getFlushSequenceNumber assertTrue regionMemstoreSize assertTrue mss getHeapSize newStoreMemstoreSize store getMemStoreSize getHeapSize
LOG info startFlushDesc flushDesc PrepareFlushResult result secondaryRegion replayWALFlushStartMarker startFlushDesc assertNull result result flushDesc commitFlushDesc commitFlushDesc flushDesc verifyData secondaryRegion lastReplayed cq families lastReplayed replayEdit secondaryRegion entry verifyData secondaryRegion numRows cq families expectedStoreFileCount s secondaryRegion assertEquals expectedStoreFileCount s getStorefilesCount
flushDesc startFlushDesc LOG info startFlushDesc flushDesc PrepareFlushResult result secondaryRegion replayWALFlushStartMarker startFlushDesc assertNull result result flushDesc commitFlushDesc FlushDescriptor newBuilder flushDesc setFlushSequenceNumber flushDesc getFlushSequenceNumber build verifyData secondaryRegion lastReplayed cq families lastReplayed replayEdit secondaryRegion entry verifyData secondaryRegion numRows cq families expectedStoreFileCount s secondaryRegion assertEquals expectedStoreFileCount s getStorefilesCount
FlushDescriptor flushDesc WALEdit getFlushDescriptor entry getEdit getCells get RegionEventDescriptor regionEventDesc WALEdit getRegionEventDescriptor entry getEdit getCells get flushDesc regionEventDesc regionEvents add regionEventDesc assertEquals regionEvents size secondaryRegion replayWALRegionEventMarker regionEvents get secondaryRegion replayWALRegionEventMarker regionEvents get expectedStoreFileCount s secondaryRegion assertEquals expectedStoreFileCount s getStorefilesCount regionMemstoreSize secondaryRegion getMemStoreDataSize assertTrue regionMemstoreSize
disableReads secondaryRegion putData primaryRegion Durability SYNC_WAL cq families primaryRegion flush putData primaryRegion Durability SYNC_WAL cq families reader createWALReaderForPrimary WAL Entry entry reader next
minVersions storeFileNum ttl IncrementingEnvironmentEdge edge IncrementingEnvironmentEdge EnvironmentEdgeManagerTestHelper injectEdge edge Configuration conf HBaseConfiguration create conf setBoolean conf setInt CompactionConfiguration HBASE_HSTORE_COMPACTION_MIN_KEY init name getMethodName minVersions conf ColumnFamilyDescriptorBuilder newBuilder family setMinVersions minVersions setTimeToLive ttl build storeTtl store getScanInfo getTtl sleepTime storeTtl storeFileNum timeStamp storeFileNum
Configuration conf HBaseConfiguration create FileSystem fs FileSystem get conf init name getMethodName conf storeFileNum storeFileNum
HStoreFile f store getStorefiles iterator next Path storedir f getPath getParent seqid store getMaxSequenceId orElse Configuration c TEST_UTIL getConfiguration FileSystem fs FileSystem get c HFileContext fileContext HFileContextBuilder withBlockSize BLOCKSIZE_SMALL build StoreFileWriter w StoreFileWriter Builder c CacheConfig c fs withOutputDir storedir withFileContext fileContext build w appendMetadata seqid w close
f initReader Cell midkey f getReader midKey get KeyValue midKV KeyValue midkey midRow CellUtil cloneRow midKV RegionInfo topHri RegionInfoBuilder newBuilder regionFs getRegionInfo getTable setEndKey SPLITKEY build Path topPath splitStoreFile regionFs topHri TEST_FAMILY f midRow RegionInfo bottomHri RegionInfoBuilder newBuilder regionFs getRegionInfo getTable setStartKey SPLITKEY build Path bottomPath splitStoreFile regionFs bottomHri TEST_FAMILY f midRow HStoreFile topF HStoreFile fs topPath conf cacheConf BloomType NONE topF initReader StoreFileReader top topF getReader HStoreFile bottomF HStoreFile fs bottomPath conf cacheConf BloomType NONE bottomF initReader StoreFileReader bottom bottomF getReader ByteBuffer previous
bottomF initReader StoreFileReader bottom bottomF getReader ByteBuffer previous LOG info midKV toString ByteBuffer bbMidkeyBytes ByteBuffer wrap midKV getKey first ByteBuffer key HFileScanner topScanner top getScanner topScanner topScanner topScanner topScanner key ByteBuffer wrap KeyValue topScanner getKey getKey topScanner getReader midKV key key key fail Bytes toStringBinary key midkey first first
topScanner topScanner topScanner topScanner key ByteBuffer wrap KeyValue topScanner getKey getKey topScanner key key key fail Bytes toStringBinary key midkey first first LOG info Bytes toString Bytes toBytes key LOG info Bytes toString Bytes toBytes key first HFileScanner bottomScanner bottom getScanner bottomScanner bottomScanner bottomScanner previous ByteBuffer wrap KeyValue bottomScanner getKey getKey key ByteBuffer wrap KeyValue bottomScanner getKey getKey first first
fail Bytes toStringBinary key midkey first first LOG info Bytes toString Bytes toBytes key LOG info Bytes toString Bytes toBytes key first HFileScanner bottomScanner bottom getScanner bottomScanner bottomScanner bottomScanner previous ByteBuffer wrap KeyValue bottomScanner getKey getKey key ByteBuffer wrap KeyValue bottomScanner getKey getKey first first LOG info Bytes toString Bytes toBytes previous assertTrue key compareTo bbMidkeyBytes previous
KeyValue keyKV KeyValueUtil createKeyValueFromKey key LOG info keyKV String tmp Bytes toString keyKV getRowArray keyKV getRowOffset keyKV getRowLength i i tmp i assertTrue tmp charAt i regionFs cleanupDaughterRegion topHri regionFs cleanupDaughterRegion bottomHri badmidkey Bytes toBytes topPath splitStoreFile regionFs topHri TEST_FAMILY f badmidkey bottomPath splitStoreFile regionFs bottomHri TEST_FAMILY f badmidkey assertNull topPath bottomF HStoreFile fs bottomPath conf cacheConf BloomType NONE bottomF initReader bottom bottomF getReader first
String tmp Bytes toString keyKV getRowArray keyKV getRowOffset keyKV getRowLength i i tmp i assertTrue tmp charAt i regionFs cleanupDaughterRegion topHri regionFs cleanupDaughterRegion bottomHri badmidkey Bytes toBytes topPath splitStoreFile regionFs topHri TEST_FAMILY f badmidkey bottomPath splitStoreFile regionFs bottomHri TEST_FAMILY f badmidkey assertNull topPath bottomF HStoreFile fs bottomPath conf cacheConf BloomType NONE bottomF initReader bottom bottomF getReader first bottomScanner bottom getScanner bottomScanner bottomScanner bottomScanner
List KeyValue List KeyValue kvList ArrayList i i i b Bytes toBytes i
List KeyValue List KeyValue kvList ArrayList i i i b Bytes toBytes i LOG info Bytes toString b
time System nanoTime Scan scan Scan scan addColumn cf_essential col_name scan addColumn cf_joined col_name SingleColumnValueFilter filter SingleColumnValueFilter cf_essential col_name CompareOperator EQUAL flag_yes filter setFilterIfMissing scan setFilter filter scan setLoadColumnFamiliesOnDemand slow ResultScanner result_scanner table getScanner scan Result res rows_count res result_scanner rows_count timeSec System nanoTime time result_scanner close
assertEquals compactionThreshold result size store r assertNull store getCompactionProgress r flush r compact storeCount store r CompactionProgress progress store getCompactionProgress progress storeCount assertTrue progress currentCompactedKVs assertTrue progress getTotalCompactingKVs assertTrue storeCount secondRowBytes START_KEY_BYTES clone secondRowBytes START_KEY_BYTES length
assertEquals columnMaskTmp InternalScanner scanner region getScanner scan List Cell results ArrayList kvPos numResults String queryInfo qualSet columnBitMask maxVersions scanner results results Cell kv results kvPos get kvPos qualSet maxVersions lastDelTimeMap kvPos String rowQual getRowQualStr kv String deleteInfo Long lastDelTS lastDelTimeMap get rowQual lastDelTS deleteInfo rowQual lastDelTS
AbstractFSWAL wal1 AbstractFSWAL walMeta wal1 newWAL FS CommonFSUtils getWALRootDir CONF DIR toString HConstants HREGION_OLDLOGDIR_NAME CONF
String testName currentTest getMethodName b Bytes toBytes TableDescriptor htd TableDescriptorBuilder newBuilder TableName valueOf setColumnFamily ColumnFamilyDescriptorBuilder of b build AtomicBoolean startHoldingForAppend AtomicBoolean CountDownLatch holdAppend CountDownLatch CountDownLatch closeFinished CountDownLatch ExecutorService exec Executors newFixedThreadPool AbstractFSWAL wal createHoldingWAL testName startHoldingForAppend holdAppend HRegion region createHoldingHRegion TEST_UTIL getConfiguration htd wal exec region b b b b Map closeResult region close
b Bytes toBytes TableDescriptor htd TableDescriptorBuilder newBuilder TableName valueOf setColumnFamily ColumnFamilyDescriptorBuilder of b build AtomicBoolean startHoldingForAppend AtomicBoolean CountDownLatch holdAppend CountDownLatch CountDownLatch closeFinished CountDownLatch ExecutorService exec Executors newFixedThreadPool AbstractFSWAL wal createHoldingWAL testName startHoldingForAppend holdAppend HRegion region createHoldingHRegion TEST_UTIL getConfiguration htd wal exec region b b b b Map closeResult region close LOG info closeResult closeFinished countDown
b Bytes toBytes TableDescriptor htd TableDescriptorBuilder newBuilder TableName valueOf setColumnFamily ColumnFamilyDescriptorBuilder of a setColumnFamily ColumnFamilyDescriptorBuilder of b build AtomicBoolean startHoldingForAppend AtomicBoolean CountDownLatch holdAppend CountDownLatch CountDownLatch flushFinished CountDownLatch ExecutorService exec Executors newFixedThreadPool Configuration conf Configuration TEST_UTIL getConfiguration conf setClass FlushPolicyFactory HBASE_FLUSH_POLICY_KEY FlushSpecificStoresPolicy FlushPolicy AbstractFSWAL wal createHoldingWAL testName startHoldingForAppend holdAppend HRegion region createHoldingHRegion conf htd wal Put put Put a addColumn a a a addColumn b b b exec region put HRegion FlushResult flushResult region flush
TableDescriptor htd TableDescriptorBuilder newBuilder TableName valueOf setColumnFamily ColumnFamilyDescriptorBuilder of a setColumnFamily ColumnFamilyDescriptorBuilder of b build AtomicBoolean startHoldingForAppend AtomicBoolean CountDownLatch holdAppend CountDownLatch CountDownLatch flushFinished CountDownLatch ExecutorService exec Executors newFixedThreadPool Configuration conf Configuration TEST_UTIL getConfiguration conf setClass FlushPolicyFactory HBASE_FLUSH_POLICY_KEY FlushSpecificStoresPolicy FlushPolicy AbstractFSWAL wal createHoldingWAL testName startHoldingForAppend holdAppend HRegion region createHoldingHRegion conf htd wal Put put Put a addColumn a a a addColumn b b b exec region put HRegion FlushResult flushResult region flush LOG info flushResult getResult
CountDownLatch flushFinished CountDownLatch ExecutorService exec Executors newFixedThreadPool Configuration conf Configuration TEST_UTIL getConfiguration conf setClass FlushPolicyFactory HBASE_FLUSH_POLICY_KEY FlushSpecificStoresPolicy FlushPolicy AbstractFSWAL wal createHoldingWAL testName startHoldingForAppend holdAppend HRegion region createHoldingHRegion conf htd wal Put put Put a addColumn a a a addColumn b b b exec region put HRegion FlushResult flushResult region flush LOG info flushResult getResult LOG info flushResult isFlushSucceeded flushFinished countDown
List Path paths ArrayList Path Path
tableName getName startAndWriteData RegionInfo region server getRegions TableName valueOf tableName get getRegionInfo WAL log server getWAL region
table rownum String row String format rownum Get get Get Bytes toBytes row get addFamily HConstants CATALOG_FAMILY Result result table get get assertTrue result size assertTrue Bytes equals value result getValue HConstants CATALOG_FAMILY
Configuration conf TEST_UTIL getConfiguration conf setInt TEST_UTIL startMiniCluster Path hbaseRootDir TEST_UTIL getDFSCluster getFileSystem makeQualified Path
familyDescriptor tableDescriptor addWALEdits tableName hri rowName familyDescriptor getName countPerFamily ee wal1 mvcc scopes wal1 shutdown runWALSplit conf WAL wal2 createWAL conf hbaseRootDir logName familyDescriptor tableDescriptor addWALEdits tableName hri rowName familyDescriptor getName countPerFamily ee wal2 mvcc scopes wal2 shutdown runWALSplit conf WAL wal3 createWAL conf hbaseRootDir logName HRegion region HRegion openHRegion conf fs hbaseRootDir hri tableDescriptor wal3 seqid region getOpenSeqNum assertTrue seqid mvcc getWritePoint assertEquals seqid mvcc getWritePoint
customConf set DefaultStoreEngine DEFAULT_STORE_FLUSHER_CLASS_KEY CustomStoreFlusher getName HRegion region HRegion openHRegion hbaseRootDir hri htd wal customConf rsServices writtenRowCount List ColumnFamilyDescriptor families Arrays asList htd getColumnFamilies i i writtenRowCount i Put put Put Bytes toBytes tableName Integer toString i put addColumn families get i families size getName Bytes toBytes Bytes toBytes region put put RegionScanner scanner region getScanner Scan assertEquals writtenRowCount getScannedCount scanner CustomStoreFlusher throwExceptionWhenFlushing set region flush fail
Path c List Path splits WALSplitter split hbaseRootDir logDir oldLogDir FileSystem get c c wals assertEquals splits splits size assertTrue fs exists splits get
String name name getMethodName b Bytes toBytes AtomicBoolean startHoldingForAppend AtomicBoolean CountDownLatch holdAppend CountDownLatch CountDownLatch flushFinished CountDownLatch CountDownLatch putFinished CountDownLatch log name log init log startHoldingForAppend holdAppend await
e LOG error e toString e TableDescriptor htd TableDescriptorBuilder newBuilder TableName valueOf name getMethodName setColumnFamily ColumnFamilyDescriptorBuilder of b build RegionInfo hri RegionInfoBuilder newBuilder htd getTableName build ChunkCreator initialize MemStoreLAB CHUNK_SIZE_DEFAULT MemStoreLAB INDEX_CHUNK_SIZE_PERCENTAGE_DEFAULT HRegion region TEST_UTIL createLocalHRegion hri htd log ExecutorService exec Executors newFixedThreadPool region put Put b addColumn b b b startHoldingForAppend set exec region put Put b addColumn b b b putFinished countDown
ExecutorService exec Executors newFixedThreadPool region put Put b addColumn b b b startHoldingForAppend set exec region put Put b addColumn b b b putFinished countDown e LOG error e toString e Threads sleep exec
HRegionServer server TEST_UTIL getRSForFirstRegionInTable tableName WAL log server getWAL Put p Put Bytes toBytes p addColumn HConstants CATALOG_FAMILY Bytes toBytes Bytes toBytes table put p log sync p Put Bytes toBytes p addColumn HConstants CATALOG_FAMILY Bytes toBytes Bytes toBytes table put p dfsCluster restartDataNodes LOG info log rollWriter
log appendData regionInfo WALKeyImpl regionInfo getEncodedNameAsBytes tableName System currentTimeMillis mvcc scopes kvs log sync AbstractFSWAL log replaceWriter FSHLog log getOldPath Path rsSplitDir thisTestsDir suffix AbstractFSWALProvider SPLITTING_EXT fs thisTestsDir rsSplitDir IOException thisTestsDir LOG debug rsSplitDir LOG debug WALSplitter split HBASELOGDIR rsSplitDir OLDLOGDIR fs conf wals LOG debug log rollWriter Assert fail IOException
TEST_UTIL ensureSomeRegionServersAvailable assertTrue fs getDefaultReplication TEST_UTIL getDataTestDirOnTestFS
LOG info assertTrue fs getDefaultReplication TEST_UTIL getDataTestDirOnTestFS
LOG info fs getDefaultReplication TEST_UTIL getDataTestDirOnTestFS Table t TEST_UTIL getConnection getTable TableName META_TABLE_NAME server cluster getRegionServer TableDescriptor desc TableDescriptorBuilder newBuilder TableName valueOf getName setColumnFamily ColumnFamilyDescriptorBuilder of HConstants CATALOG_FAMILY build admin createTable desc Table table TEST_UTIL getConnection getTable desc getTableName server TEST_UTIL getRSForFirstRegionInTable desc getTableName RegionInfo region server getRegions desc getTableName get getRegionInfo WAL log server getWAL region List Path paths ArrayList List Integer preLogRolledCalled ArrayList paths add AbstractFSWALProvider getCurrentFileName log log Path Path
server TEST_UTIL getRSForFirstRegionInTable desc getTableName RegionInfo region server getRegions desc getTableName get getRegionInfo WAL log server getWAL region List Path paths ArrayList List Integer preLogRolledCalled ArrayList paths add AbstractFSWALProvider getCurrentFileName log log Path oldFile Path newFile LOG debug oldFile newFile preLogRolledCalled add Integer Path oldFile Path newFile paths add newFile writeData table curTime System currentTimeMillis
validateData table writeData table log rollWriter assertTrue preLogRolledCalled size preLogRolledCalled size Set String loggedRows HashSet p LOG debug p RecoverLeaseFSUtils recoverFileLease HFileSystem fs getBackingFs p TEST_UTIL getConfiguration LOG debug CommonFSUtils getPath p WAL Reader reader reader WALFactory createReader fs p TEST_UTIL getConfiguration WAL Entry entry entry reader LOG debug entry getKey getSequenceId entry getEdit getCells
reader WALFactory createReader fs p TEST_UTIL getConfiguration WAL Entry entry entry reader LOG debug entry getKey getSequenceId entry getEdit getCells cell entry getEdit getCells loggedRows add Bytes toStringBinary cell getRowArray cell getRowOffset cell getRowLength LOG debug CommonFSUtils getPath p reader reader close assertTrue loggedRows contains assertTrue loggedRows contains assertTrue loggedRows contains assertTrue loggedRows contains
TableName tableName TableName valueOf WALFactory walFactory WALFactory TEST_UTIL getConfiguration walProvider Configuration conf TEST_UTIL getConfiguration WALProvider provider walFactory getWALProvider WAL wal provider getWAL wal AbstractFSWAL expectedDefaultBlockSize WALUtil getWALBlockSize conf FileSystem get conf TEST_UTIL getDataTestDir blocksize AbstractFSWAL wal blocksize assertEquals expectedDefaultBlockSize blocksize
conf setLong HConstants HREGION_MEMSTORE_FLUSH_SIZE conf set FlushPolicyFactory HBASE_FLUSH_POLICY_KEY FlushAllLargeStoresPolicy getName cfFlushSizeLowerBound conf setLong FlushLargeStoresPolicy HREGION_COLUMNFAMILY_FLUSH_SIZE_LOWER_BOUND_MIN cfFlushSizeLowerBound conf setLong conf setLong maxLogs conf setInt maxLogs numRegionServers TEST_UTIL startMiniCluster numRegionServers Table table TEST_UTIL createTable tableName FAMILIES Pair HRegion HRegionServer desiredRegionAndServer getRegionWithName tableName HRegion desiredRegion desiredRegionAndServer getFirst assertTrue desiredRegion
conf setLong FlushLargeStoresPolicy HREGION_COLUMNFAMILY_FLUSH_SIZE_LOWER_BOUND_MIN TEST_UTIL startMiniCluster TEST_UTIL getAdmin createNamespace NamespaceDescriptor create TABLENAME getNamespaceAsString build TEST_UTIL getAdmin createTable tableDescriptor Connection conn ConnectionFactory createConnection conf Table table conn getTable TABLENAME doPut table memstoreFlushSize table close conn close Region region getRegionWithName TABLENAME getFirst cf1StoreFileCount1 region getStore FAMILY1 getStorefilesCount cf2StoreFileCount1 region getStore FAMILY2 getStorefilesCount cf3StoreFileCount1 region getStore FAMILY3 getStorefilesCount
conf setLong FlushLargeStoresPolicy HREGION_COLUMNFAMILY_FLUSH_SIZE_LOWER_BOUND_MIN TEST_UTIL startMiniCluster TEST_UTIL getAdmin createNamespace NamespaceDescriptor create TABLENAME getNamespaceAsString build TEST_UTIL getAdmin createTable tableDescriptor Connection conn ConnectionFactory createConnection conf Table table conn getTable TABLENAME doPut table memstoreFlushSize table close conn close Region region getRegionWithName TABLENAME getFirst cf1StoreFileCount1 region getStore FAMILY1 getStorefilesCount cf2StoreFileCount1 region getStore FAMILY2 getStorefilesCount cf3StoreFileCount1 region getStore FAMILY3 getStorefilesCount
admin close Table table conn getTable TABLENAME qf Bytes toBytes Random rand Random value1 value2 value3 i i i Put put Put Hashing md5 hashLong i asBytes rand setSeed i rand nextBytes value1 rand nextBytes value2 rand nextBytes value3 put addColumn FAMILY1 qf value1 put addColumn FAMILY2 qf value2
killedRS get Threads sleep size Threads sleep master getMaster Threads sleep assertTrue master getMaster getServerManager isServerOnline killedRS get Map RegionInfo ServerName assignments assignments master getMaster getAssignmentManager getRegionStates getRegionAssignments assignments assignments size RegionInfo hri Map RegionInfo ServerName e assignments e getKey isMetaRegion hri e getKey
Path rootDir TEST_UTIL getDataTestDir Path tableDir CommonFSUtils getTableDir rootDir info getTable HRegionFileSystem createRegionOnFileSystem CONF TEST_UTIL getTestFileSystem tableDir info region HRegion newHRegion tableDir wal TEST_UTIL getTestFileSystem CONF info htd rs WALFactory wals WALFactory CONF method Path regiondir region getRegionFileSystem getRegionDir FileSystem fs region getRegionFileSystem getFileSystem regionName region getRegionInfo getEncodedNameAsBytes Path recoveredEditsDir WALSplitUtil getRegionDirRecoveredEditsDir regiondir maxSeqId minSeqId totalEdits maxSeqId minSeqId i minSeqId i maxSeqId i Path recoveredEdits Path recoveredEditsDir String format i
writer append WAL Entry WALKeyImpl regionName tableName j time HConstants DEFAULT_CLUSTER_ID edit writer close TaskMonitor get createStatus method region replayedEdits replayedEdits Assert assertEquals rsAccounting getGlobalMemStoreDataSize region getMemStoreDataSize Assert assertEquals rsAccounting getGlobalMemStoreHeapSize region getMemStoreHeapSize Assert assertEquals rsAccounting getGlobalMemStoreOffHeapSize region getMemStoreOffHeapSize replayedEdits totalEdits Assert fail
Thread sleep assertTrue newcount count List RegionServerThread regionServerThreads TEST_UTIL getHBaseCluster getRegionServerThreads RegionServerThread rs regionServerThreads CompactedHFilesDischarger cleaner CompactedHFilesDischarger rs getRegionServer cleaner chore Thread sleep newcount1 colFamily newcount1 hrfs getStoreFiles colFamily getName size newcount1 Thread sleep cleaned
master tablename List Pair RegionInfo ServerName tableRegionsInMeta List RegionInfo tableRegionsInMaster timeout System currentTimeMillis waitTime System currentTimeMillis timeout tableRegionsInMeta MetaTableAccessor getTableRegionsAndLocations TEST_UTIL getConnection tablename tableRegionsInMaster master getAssignmentManager getRegionStates getRegionsOfTable tablename
master tablename List Pair RegionInfo ServerName tableRegionsInMeta List RegionInfo tableRegionsInMaster timeout System currentTimeMillis waitTime System currentTimeMillis timeout tableRegionsInMeta MetaTableAccessor getTableRegionsAndLocations TEST_UTIL getConnection tablename tableRegionsInMaster master getAssignmentManager getRegionStates getRegionsOfTable tablename LOG info Objects toString tableRegionsInMaster
assertTrue numRegions ROWSIZE numRegions splitRows numRegions i i splitRows i splitRows i ROWS i ROWSIZE numRegions Table table TEST_UTIL createTable tablename FAMILYNAME splitRows LOG info table getName replication HBaseTestingUtility setReplicas ADMIN tablename replication LOG info replication table getName loadData table LOG info table getName verifyRowCount table ROWSIZE LOG info table getName List Pair RegionInfo ServerName tableRegions TEST_UTIL waitUntilAllRegionsAssigned tablename
splitRows i ROWS i ROWSIZE numRegions Table table TEST_UTIL createTable tablename FAMILYNAME splitRows LOG info table getName replication HBaseTestingUtility setReplicas ADMIN tablename replication LOG info replication table getName loadData table LOG info table getName verifyRowCount table ROWSIZE LOG info table getName List Pair RegionInfo ServerName tableRegions TEST_UTIL waitUntilAllRegionsAssigned tablename LOG info table getName tableRegions MetaTableAccessor getTableRegionsAndLocations TEST_UTIL getConnection tablename assertEquals tablename numRegions replication tableRegions size
TableName tableName TableName valueOf name getMethodName FAMILYNAME Bytes toBytes FileSystem fs HTU getTestFileSystem Admin admin HTU getAdmin Configuration conf HTU getConfiguration Path rootDir HTU getDataTestDirOnTestFS TableDescriptor htd TableDescriptorBuilder newBuilder tableName setColumnFamily ColumnFamilyDescriptorBuilder of FAMILYNAME build admin createTable htd HTU waitUntilNoRegionsInTransition RegionInfo hri RegionInfoBuilder newBuilder htd getTableName setStartKey Bytes toBytes setEndKey Bytes toBytes setRegionId System currentTimeMillis setReplicaId build HRegionFileSystem regionFs HRegionFileSystem createRegionOnFileSystem conf fs CommonFSUtils getTableDir rootDir hri getTable hri Path regionDir regionFs getRegionDir HRegionFileSystem loadRegionInfoFileContent fs regionDir
FileSystem fs HTU getTestFileSystem Admin admin HTU getAdmin Configuration conf HTU getConfiguration Path rootDir HTU getDataTestDirOnTestFS TableDescriptor htd TableDescriptorBuilder newBuilder tableName setColumnFamily ColumnFamilyDescriptorBuilder of FAMILYNAME build admin createTable htd HTU waitUntilNoRegionsInTransition RegionInfo hri RegionInfoBuilder newBuilder htd getTableName setStartKey Bytes toBytes setEndKey Bytes toBytes setRegionId System currentTimeMillis setReplicaId build HRegionFileSystem regionFs HRegionFileSystem createRegionOnFileSystem conf fs CommonFSUtils getTableDir rootDir hri getTable hri Path regionDir regionFs getRegionDir HRegionFileSystem loadRegionInfoFileContent fs regionDir e LOG info e getMessage List RegionInfo regions admin getRegions tableName
ex LOG warn ex toString ex exceptions compareAndSet ex Random random Random random closeRegion HTU getRS hriSecondary ex LOG warn hriSecondary StringUtils stringifyException ex exceptions compareAndSet ex
ex LOG warn hriSecondary StringUtils stringifyException ex exceptions compareAndSet ex openRegion HTU getRS hriSecondary ex LOG warn hriSecondary StringUtils stringifyException ex exceptions compareAndSet ex key random nextInt endKey startKey startKey assertGetRpc hriSecondary key ex LOG warn hriSecondary StringUtils stringifyException ex exceptions compareAndSet ex LOG info hriSecondary getEncodedName
HTU getConfiguration setInt StorefileRefresherChore REGIONSERVER_STOREFILE_REFRESH_PERIOD restartRegionServer LOG info hriSecondary getEncodedName openRegion HTU getRS hriSecondary LOG info i i i HTU loadNumericRows table f i i HRegion region getRS getRegionByEncodedName hriPrimary getEncodedName region flush HRegion primaryRegion getRS getRegion hriPrimary getEncodedName Assert assertEquals primaryRegion getStore f getStorefilesCount Region secondaryRegion getRS getRegion hriSecondary getEncodedName secondaryRegion getStore f refreshStoreFiles Assert assertEquals secondaryRegion getStore f getStorefilesCount
checkAndAssertRegionDistribution HTU getAdmin disableTable table getName
checkAndAssertRegionDistribution HTU getAdmin disableTable table getName LOG info table getName
checkAndAssertRegionDistribution HTU getAdmin disableTable table getName LOG info table getName LOG info table getName HTU getAdmin enableTable table getName
serverVsOnlineRegions HashMap ServerName Collection RegionInfo serverVsOnlineRegions put getRS getServerName onlineRegions Collection RegionInfo existingRegions ArrayList RegionInfo serverVsOnlineRegions get getRS getServerName LOG info existingRegions size onlineRegions size RegionInfo existingRegions onlineRegions Collection RegionInfo onlineRegions2 ArrayList RegionInfo getSecondaryRS getOnlineRegionsLocalContext size region getSecondaryRS getOnlineRegionsLocalContext onlineRegions2 add region getRegionInfo serverVsOnlineRegions2 serverVsOnlineRegions2 HashMap ServerName Collection RegionInfo serverVsOnlineRegions2 put getSecondaryRS getServerName onlineRegions2
Collection RegionInfo onlineRegions2 ArrayList RegionInfo getSecondaryRS getOnlineRegionsLocalContext size region getSecondaryRS getOnlineRegionsLocalContext onlineRegions2 add region getRegionInfo serverVsOnlineRegions2 serverVsOnlineRegions2 HashMap ServerName Collection RegionInfo serverVsOnlineRegions2 put getSecondaryRS getServerName onlineRegions2 Collection RegionInfo existingRegions ArrayList RegionInfo serverVsOnlineRegions2 get getSecondaryRS getServerName LOG info existingRegions size onlineRegions2 size RegionInfo existingRegions onlineRegions2 Collection RegionInfo onlineRegions3 ArrayList RegionInfo getTertiaryRS getOnlineRegionsLocalContext size region getTertiaryRS getOnlineRegionsLocalContext onlineRegions3 add region getRegionInfo
FileSystem fs TEST_UTIL getTestFileSystem Path hfilePath Path Path TEST_UTIL getDataTestDir CacheConfig cacheConf CacheConfig TEST_UTIL getConfiguration encoding HFileContextBuilder hcBuilder HFileContextBuilder hcBuilder withBlockSize hcBuilder withDataBlockEncoding encoding HFileContext hFileContext hcBuilder build StoreFileWriter writer StoreFileWriter Builder TEST_UTIL getConfiguration cacheConf fs withOutputDir hfilePath withFileContext hFileContext build writeStoreFile writer HStoreFile sf HStoreFile fs writer getPath TEST_UTIL getConfiguration cacheConf BloomType NONE List StoreFileScanner scanners StoreFileScanner getScannersForStoreFiles Collections singletonList sf Long MAX_VALUE StoreFileScanner scanner scanners get seekTestOfReversibleKeyValueScanner scanner
MemStore memstore DefaultMemStore writeMemstore memstore List KeyValueScanner scanners memstore getScanners Long MAX_VALUE seekTestOfReversibleKeyValueScanner scanners get
hcBuilder withBlockSize HFileContext hFileContext hcBuilder build StoreFileWriter writer1 StoreFileWriter Builder TEST_UTIL getConfiguration cacheConf fs withOutputDir hfilePath withFileContext hFileContext build StoreFileWriter writer2 StoreFileWriter Builder TEST_UTIL getConfiguration cacheConf fs withOutputDir hfilePath withFileContext hFileContext build MemStore memstore DefaultMemStore writeMemstoreAndStoreFiles memstore StoreFileWriter writer1 writer2 HStoreFile sf1 HStoreFile fs writer1 getPath TEST_UTIL getConfiguration cacheConf BloomType NONE HStoreFile sf2 HStoreFile fs writer2 getPath TEST_UTIL getConfiguration cacheConf BloomType NONE startRowNum ROWSIZE ReversedKeyValueHeap kvHeap getReversibleKeyValueHeap memstore sf1 sf2 ROWS startRowNum MAXMVCC internalTestSeekAndNextForReversibleKeyValueHeap kvHeap startRowNum startRowNum ROWSIZE kvHeap getReversibleKeyValueHeap memstore sf1 sf2 HConstants EMPTY_START_ROW MAXMVCC internalTestSeekAndNextForReversibleKeyValueHeap kvHeap startRowNum MAXMVCC
Scan scan Scan scan setReversed StoreScanner storeScanner getReversibleStoreScanner memstore sf1 sf2 scan scanInfo MAXMVCC verifyCountAndOrder storeScanner QUALSIZE ROWSIZE ROWSIZE startRowNum ROWSIZE startRow ROWS startRowNum scan withStartRow startRow storeScanner getReversibleStoreScanner memstore sf1 sf2 scan scanInfo MAXMVCC verifyCountAndOrder storeScanner QUALSIZE startRowNum startRowNum assertTrue QUALSIZE scan addColumn FAMILYNAME QUALS scan addColumn FAMILYNAME QUALS storeScanner getReversibleStoreScanner memstore sf1 sf2 scan scanInfo MAXMVCC verifyCountAndOrder storeScanner startRowNum startRowNum MAXMVCC
conf TEST_UTIL getConfiguration conf setFloat BloomFilterFactory IO_STOREFILE_BLOOM_ERROR_RATE err conf setBoolean BloomFilterFactory IO_STOREFILE_BLOOM_ENABLED conf setInt BloomFilterUtil PREFIX_LENGTH_KEY prefixLength localfs conf get compareTo fs fs FileSystem get conf localfs testDir TEST_UTIL getDataTestDir fs testDir fs delete testDir testDir CommonFSUtils getRootDir conf
StoreFileReader lastStoreFileReader StoreFileScanner sfScanner scanners lastStoreFileReader sfScanner getReader HFilePrettyPrinter conf run String lastStoreFileReader getHFileReader getPath toString LOG info lastStoreFileReader getHFileReader getName lastStoreFileReader disableBloomFilterForTesting List Cell allResults ArrayList List Cell results ArrayList results results allResults addAll results results clear List Integer actualIds ArrayList Cell kv allResults String qual Bytes toString CellUtil cloneQualifier kv assertTrue qual startsWith QUALIFIER_PREFIX
region TEST_UTIL createLocalHRegion TESTTABLEDESC Table hri RegionAsTable region
region TEST_UTIL createLocalHRegion TESTTABLEDESC Table hri RegionAsTable region
flushIndex LOG info flushIndex t run region flush LOG info LOG info t start t run LOG info
testUtil getMiniHBaseCluster getRegionServerThreads get getRegionServer getSecureBulkLoadManager setFsCreatedListener fsCreatedListener testUtil createTable TABLE FAMILY Bytes toByteArrays SPLIT_ROWKEY Path rootdir testUtil getMiniHBaseCluster getRegionServerThreads get getRegionServer getDataRootDir Path dir1 Path rootdir prepareHFile dir1 key1 value1 Path dir2 Path rootdir prepareHFile dir2 key3 value3 AtomicReference Throwable t1Exception AtomicReference AtomicReference Throwable t2Exception AtomicReference doBulkloadWithoutRetry dir1
prepareHFile dir1 key1 value1 Path dir2 Path rootdir prepareHFile dir2 key3 value3 AtomicReference Throwable t1Exception AtomicReference AtomicReference Throwable t2Exception AtomicReference doBulkloadWithoutRetry dir1 e LOG error e t1Exception set e
Thread yield Thread sleep String task ZKSplitLog getEncodedNodeName zkw SplitLogTask slt SplitLogTask Unassigned MANAGER zkw getRecoverableZooKeeper create task slt toByteArray Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT waitForCounter SplitLogCounters tot_wkr_task_acquired WAIT_TIME ZKUtil setData zkw task slt toByteArray waitForCounter SplitLogCounters tot_wkr_preempt_task WAIT_TIME String rescan ZKSplitLog getEncodedNodeName zkw rescan zkw getRecoverableZooKeeper create rescan slt toByteArray Ids OPEN_ACL_UNSAFE CreateMode PERSISTENT_SEQUENTIAL waitForCounter SplitLogCounters tot_wkr_task_acquired WAIT_TIME ZKUtil setData zkw task slt toByteArray waitForCounter SplitLogCounters tot_wkr_preempt_task WAIT_TIME waitForCounter SplitLogCounters tot_wkr_task_acquired_rescan WAIT_TIME List String nodes ZKUtil listChildrenNoWatch zkw zkw getZNodePaths splitLogZNode
admin close admin
TableName tableName TableName valueOf name getMethodName Table t createTableAndWait tableName HConstants CATALOG_FAMILY List HRegion regions cluster getRegions tableName RegionInfo hri getAndCheckSingleTableRegion regions tableRegionIndex ensureTableRegionNotOnSameServerAsMeta admin hri admin balancerSwitch cluster getMaster setCatalogJanitorEnabled TESTING_UTIL loadTable t HConstants CATALOG_FAMILY HRegionServer server cluster getRegionServer tableRegionIndex printOutRegions server admin splitRegionAsync hri getRegionName get TimeUnit MINUTES List HRegion daughters checkAndGetDaughters tableName HRegion daughterRegion daughters get RegionInfo daughter daughterRegion getRegionInfo
List HRegion regions cluster getRegions tableName RegionInfo hri getAndCheckSingleTableRegion regions tableRegionIndex ensureTableRegionNotOnSameServerAsMeta admin hri admin balancerSwitch cluster getMaster setCatalogJanitorEnabled TESTING_UTIL loadTable t HConstants CATALOG_FAMILY HRegionServer server cluster getRegionServer tableRegionIndex printOutRegions server admin splitRegionAsync hri getRegionName get TimeUnit MINUTES List HRegion daughters checkAndGetDaughters tableName HRegion daughterRegion daughters get RegionInfo daughter daughterRegion getRegionInfo LOG info daughter clearReferences daughterRegion
cluster getMaster setCatalogJanitorEnabled TESTING_UTIL loadTable t HConstants CATALOG_FAMILY HRegionServer server cluster getRegionServer tableRegionIndex printOutRegions server admin splitRegionAsync hri getRegionName get TimeUnit MINUTES List HRegion daughters checkAndGetDaughters tableName HRegion daughterRegion daughters get RegionInfo daughter daughterRegion getRegionInfo LOG info daughter clearReferences daughterRegion LOG info daughterRegion daughterRegion hasReferences admin splitRegionAsync daughter getRegionName get TimeUnit MINUTES daughters cluster getRegions tableName HRegion daughters
List HRegion daughters checkAndGetDaughters tableName HRegion daughterRegion daughters get RegionInfo daughter daughterRegion getRegionInfo LOG info daughter clearReferences daughterRegion LOG info daughterRegion daughterRegion hasReferences admin splitRegionAsync daughter getRegionName get TimeUnit MINUTES daughters cluster getRegions tableName HRegion d daughters LOG info d cluster abortRegionServer tableRegionIndex waitUntilRegionServerDead awaitDaughters tableName daughters size regions cluster getRegions tableName HRegion d daughters
RegionInfo daughter daughterRegion getRegionInfo LOG info daughter clearReferences daughterRegion LOG info daughterRegion daughterRegion hasReferences admin splitRegionAsync daughter getRegionName get TimeUnit MINUTES daughters cluster getRegions tableName d daughters LOG info d cluster abortRegionServer tableRegionIndex waitUntilRegionServerDead awaitDaughters tableName daughters size regions cluster getRegions tableName d daughters LOG info d daughters size regions size
LOG info daughterRegion daughterRegion hasReferences admin splitRegionAsync daughter getRegionName get TimeUnit MINUTES daughters cluster getRegions tableName d daughters LOG info d cluster abortRegionServer tableRegionIndex waitUntilRegionServerDead awaitDaughters tableName daughters size regions cluster getRegions tableName d daughters LOG info d daughters size regions size LOG info daughters size regions size assertEquals daughters size regions size regions
region assertEquals region getStores size HStore store region getStores get store CompactionProgress progress store getCompactionProgress progress progress progress
RegionInfo hRegionInfo regionsOfTable get Put p Put Bytes toBytes p addColumn Bytes toBytes Bytes toBytes Bytes toBytes table put p p Put Bytes toBytes p addColumn Bytes toBytes Bytes toBytes Bytes toBytes table put p p Put Bytes toBytes p addColumn Bytes toBytes Bytes toBytes Bytes toBytes table put p admin flush userTableName admin splitRegionAsync hRegionInfo getRegionName Bytes toBytes regionsOfTable cluster getMaster getAssignmentManager getRegionStates getRegionsOfTable userTableName regionsOfTable Thread sleep
assertTrue region requestSplitRegion regionServer region Bytes toBytes fail List HRegion daughters cluster getRegions tableName assertEquals daughters size HBaseFsck debugLsr conf Path Map String Path storefilesAfter FSUtils getTableStoreFilePathMap fs rootDir tableName assertEquals storefilesAfter toString storefilesAfter size hri region getRegionInfo AssignmentManager am cluster getMaster getAssignmentManager RegionStates regionStates am getRegionStates start EnvironmentEdgeManager currentTime regionStates hri
UnsupportedOperationException HRegionServer metaRegionServer tablesOnMaster cluster getMaster cluster getRegionServer metaServerIndex tableRegionIndex cluster getServerWith hri getRegionName assertTrue tableRegionIndex HRegionServer tableRegionServer cluster getRegionServer tableRegionIndex LOG info metaRegionServer getServerName tableRegionServer getServerName metaRegionServer getServerName tableRegionServer getServerName HRegionServer hrs getOtherRegionServer cluster metaRegionServer assertNotNull hrs assertNotNull hri LOG info hri getRegionNameAsString metaRegionServer getServerName hrs getServerName metaServerIndex admin move hri getEncodedNameAsBytes hrs getServerName tableRegionIndex cluster getServerWith hri getRegionName tableRegionIndex tableRegionIndex metaServerIndex
hrs List RegionInfo regions ProtobufUtil getOnlineRegions hrs getRSRpcServices RegionInfo regions
LOG info dodgyWAL throwException dodgyWAL appendData region getRegionInfo key edit exception dodgyWAL sync exception assertTrue exception region getMemStoreDataSize IOException region getMemStoreDataSize region flush
region getMemStoreDataSize IOException region getMemStoreDataSize region flush IOException e LOG info e LOG info t setDaemon t start dodgyWAL Threads sleep assertTrue originalWAL dodgyWAL getCurrentFileName dodgyWAL throwException
LOG info t setDaemon t start dodgyWAL Threads sleep assertTrue originalWAL dodgyWAL getCurrentFileName dodgyWAL throwException region put put e LOG info e Mockito when services isStopped thenReturn Closeables close logRoller
inserted addWideContent REGION List Cell results ArrayList Scan scan Scan scan addFamily A scan addFamily B scan addFamily C scan readVersions scan setBatch batch s REGION scan total i more more s next results i
more s next results i LOG info i results size assertTrue results size batch total results size results size row CellUtil cloneRow results get kv results assertTrue Bytes equals row CellUtil cloneRow kv results clear Iterator KeyValueScanner scanners HRegion RegionScannerImpl s storeHeap getHeap iterator scanners StoreScanner ss StoreScanner scanners next ss updateReaders Collections emptyList Collections emptyList more
UserScanQueryMatcher qm UserScanQueryMatcher create scan ScanInfo conf fam2 ttl KeepDeletedCells FALSE HConstants DEFAULT_BLOCKSIZE rowComparator get getFamilyMap get fam2 now ttl now List KeyValue memstore ArrayList memstore add KeyValue row1 fam2 col1 data memstore add KeyValue row1 fam2 col2 data memstore add KeyValue row1 fam2 col3 data memstore add KeyValue row1 fam2 col4 data memstore add KeyValue row1 fam2 col5 data memstore add KeyValue row2 fam1 col1 data List ScanQueryMatcher MatchCode actual ArrayList memstore size KeyValue k memstore get qm setToNewRow k KeyValue kv memstore actual add qm match kv assertEquals expected size actual size expected size
UserScanQueryMatcher qm UserScanQueryMatcher create scan ScanInfo conf fam2 ttl KeepDeletedCells FALSE HConstants DEFAULT_BLOCKSIZE rowComparator now ttl now List KeyValue memstore ArrayList memstore add KeyValue row1 fam2 col1 data memstore add KeyValue row1 fam2 col2 data memstore add KeyValue row1 fam2 col3 data memstore add KeyValue row1 fam2 col4 data memstore add KeyValue row1 fam2 col5 data memstore add KeyValue row2 fam1 col1 data List ScanQueryMatcher MatchCode actual ArrayList memstore size KeyValue k memstore get qm setToNewRow k KeyValue kv memstore actual add qm match kv assertEquals expected size actual size expected size
expected add ScanQueryMatcher MatchCode INCLUDE_AND_SEEK_NEXT_ROW expected add ScanQueryMatcher MatchCode DONE Scan scanWithFilter Scan scan setFilter AlwaysIncludeAndSeekNextRowFilter now EnvironmentEdgeManager currentTime UserScanQueryMatcher qm UserScanQueryMatcher create scanWithFilter ScanInfo conf fam2 ttl KeepDeletedCells FALSE HConstants DEFAULT_BLOCKSIZE rowComparator get getFamilyMap get fam2 now ttl now List KeyValue memstore ArrayList memstore add KeyValue row1 fam2 col2 data memstore add KeyValue row2 fam1 col1 data List ScanQueryMatcher MatchCode actual ArrayList memstore size KeyValue k memstore get qm setToNewRow k KeyValue kv memstore actual add qm match kv assertEquals expected size actual size expected size
limitTime testCompactionWithThroughputLimit noLimitTime testCompactionWithoutThroughputLimit
Configuration conf hbtu getConfiguration setMaxMinThroughputs conf set StoreEngine STORE_ENGINE_CLASS_KEY DefaultStoreEngine getName conf setInt PressureAwareFlushThroughputController HBASE_HSTORE_FLUSH_THROUGHPUT_TUNE_PERIOD hbtu startMiniCluster Connection conn ConnectionFactory createConnection conf hbtu getAdmin createTable TableDescriptorBuilder newBuilder tableName setColumnFamily ColumnFamilyDescriptorBuilder of family setCompactionEnabled build hbtu waitTableAvailable tableName HRegionServer regionServer hbtu getRSForFirstRegionInTable tableName pressure regionServer getFlushPressure
UTIL1 getAdmin rollWALWriter r getRegionServer getServerName rowCount UTIL1 countRows tableName UTIL1 deleteTableData tableName Scan scan Scan lastCount i i i i fail ResultScanner scanner htable2 getScanner scan Result res scanner next rowCount scanner close res length res length lastCount i lastCount res length
r UTIL1 UTIL1 getAdmin rollWALWriter r getRegionServer getServerName UTIL1 deleteTableData tableName Scan scan Scan lastCount i i i i fail ResultScanner scanner htable2 getScanner scan Result res scanner next NB_ROWS_IN_BIG_BATCH scanner close res length res length lastCount i lastCount res length
setUpBase rowCount UTIL1 countRows tableName UTIL1 deleteTableData tableName Scan scan Scan lastCount i i i i fail ResultScanner scanner htable2 getScanner scan Result res scanner next rowCount scanner close res length res length lastCount i lastCount res length
Assert assertEquals ReplicationEndpointForTest replicateCount get Assert assertTrue ReplicationEndpointReturningFalse replicated get peerCount hbaseAdmin listReplicationPeers size String id hbaseAdmin addReplicationPeer id ReplicationPeerConfig setClusterKey ZKConfig getZooKeeperClusterKey CONF1 setReplicationEndpointImpl ReplicationEndpointReturningFalse getName hbaseAdmin listReplicationPeers size peerCount
res length initialCount LOG warn initialCount res length lastCount start System currentTimeMillis i i fail System currentTimeMillis start Result res2 scanner res2 scanner next initialCount res2 length initialCount
start System currentTimeMillis retries NB_RETRIES retries scan Scan scanner htable2 getScanner scan res scanner next NB_ROWS_IN_BIG_BATCH scanner close res NB_ROWS_IN_BIG_BATCH retries lastRow result res currentRow Bytes toInt result getRow row lastRow row currentRow row LOG error row lastRow currentRow
scan Scan scanner htable2 getScanner scan res scanner next NB_ROWS_IN_BIG_BATCH scanner close res length NB_ROWS_IN_BIG_BATCH lastRow result res currentRow Bytes toInt result getRow row lastRow row currentRow row LOG error row lastRow currentRow LOG error lastRow fail res length NB_ROWS_IN_BIG_BATCH System currentTimeMillis start
rowCountHt2TargetAtPeer1 countRows ht2TargetAtPeer1 assertEquals rowCountHt1TargetAtPeer1 assertEquals rowCountHt2TargetAtPeer1 syncUp UTIL1 rowCountHt1TargetAtPeer1 countRows ht1TargetAtPeer1 rowCountHt2TargetAtPeer1 countRows ht2TargetAtPeer1 rowCountHt1TargetAtPeer1 rowCountHt2TargetAtPeer1 restartSourceHBaseCluster rowCount_ht1Source countRows ht1Source LOG debug rowCount_ht1Source rowCount_ht2Source countRows ht2Source LOG debug rowCount_ht2Source assertEquals rowCountHt1TargetAtPeer1
i i i syncUp UTIL1 rowCountHt1TargetAtPeer1 countRows ht1TargetAtPeer1 rowCountHt2TargetAtPeer1 countRows ht2TargetAtPeer1 i rowCountHt1TargetAtPeer1 rowCountHt2TargetAtPeer1 restartSourceHBaseCluster rowCount_ht1Source countRows ht1Source LOG debug rowCount_ht1Source rowCount_ht2Source countRows ht2Source LOG debug rowCount_ht2Source assertEquals rowCountHt1TargetAtPeer1 assertEquals rowCountHt2TargetAtPeer1 rowCountHt1TargetAtPeer1 rowCountHt2TargetAtPeer1 LOG info i
rowCountHt2TargetAtPeer1 countRows ht2TargetAtPeer1 assertEquals rowCountHt1TargetAtPeer1 assertEquals rowCountHt2TargetAtPeer1 syncUp UTIL1 rowCountHt1TargetAtPeer1 countRows ht1TargetAtPeer1 rowCountHt2TargetAtPeer1 countRows ht2TargetAtPeer1 rowCountHt1TargetAtPeer1 rowCountHt2TargetAtPeer1 restartSourceHBaseCluster rowCount_ht1Source countRows ht1Source LOG debug rowCount_ht1Source rowCount_ht2Source countRows ht2Source LOG debug rowCount_ht2Source assertEquals rowCountHt1TargetAtPeer1
i i i syncUp UTIL1 rowCountHt1TargetAtPeer1 countRows ht1TargetAtPeer1 rowCountHt2TargetAtPeer1 countRows ht2TargetAtPeer1 i rowCountHt1TargetAtPeer1 rowCountHt2TargetAtPeer1 restartSourceHBaseCluster rowCount_ht1Source countRows ht1Source LOG debug rowCount_ht1Source rowCount_ht2Source countRows ht2Source LOG debug rowCount_ht2Source assertEquals rowCountHt1TargetAtPeer1 assertEquals rowCountHt2TargetAtPeer1 rowCountHt1TargetAtPeer1 rowCountHt2TargetAtPeer1 LOG info i
restartTargetHBaseCluster Thread sleep SLEEP_TIME rowCountHt1TargetAtPeer1 countRows ht1TargetAtPeer1 rowCountHt2TargetAtPeer1 countRows ht2TargetAtPeer1 assertEquals rowCountHt1TargetAtPeer1 assertEquals rowCountHt2TargetAtPeer1 syncUp UTIL1 syncUp UTIL1 rowCountHt1TargetAtPeer1 countRows ht1TargetAtPeer1 rowCountHt2TargetAtPeer1 countRows ht2TargetAtPeer1 rowCountHt1TargetAtPeer1 rowCountHt2TargetAtPeer1 restartSourceHBaseCluster rowCount_ht1Source countRows ht1Source
rowCountHt1TargetAtPeer1 countRows ht1TargetAtPeer1 rowCountHt2TargetAtPeer1 countRows ht2TargetAtPeer1 assertEquals rowCountHt1TargetAtPeer1 assertEquals rowCountHt2TargetAtPeer1 syncUp UTIL1 syncUp UTIL1 rowCountHt1TargetAtPeer1 countRows ht1TargetAtPeer1 rowCountHt2TargetAtPeer1 countRows ht2TargetAtPeer1 rowCountHt1TargetAtPeer1 rowCountHt2TargetAtPeer1 restartSourceHBaseCluster rowCount_ht1Source countRows ht1Source LOG debug rowCount_ht1Source rowCount_ht2Source countRows ht2Source
syncUp UTIL1 syncUp UTIL1 rowCountHt1TargetAtPeer1 countRows ht1TargetAtPeer1 rowCountHt2TargetAtPeer1 countRows ht2TargetAtPeer1 rowCountHt1TargetAtPeer1 rowCountHt2TargetAtPeer1 restartSourceHBaseCluster rowCount_ht1Source countRows ht1Source LOG debug rowCount_ht1Source rowCount_ht2Source countRows ht2Source LOG debug rowCount_ht2Source assertEquals rowCountHt1TargetAtPeer1 assertEquals rowCountHt2TargetAtPeer1 rowCountHt1TargetAtPeer1 rowCountHt2TargetAtPeer1
rowCountHt1TargetAtPeer1 countRows ht1TargetAtPeer1 rowCountHt2TargetAtPeer1 countRows ht2TargetAtPeer1 i rowCountHt1TargetAtPeer1 rowCountHt2TargetAtPeer1 restartSourceHBaseCluster rowCount_ht1Source countRows ht1Source LOG debug rowCount_ht1Source rowCount_ht2Source countRows ht2Source LOG debug rowCount_ht2Source assertEquals rowCountHt1TargetAtPeer1 assertEquals rowCountHt2TargetAtPeer1 rowCountHt1TargetAtPeer1 rowCountHt2TargetAtPeer1 LOG info i
UTIL2 getAdmin disableReplicationPeer PEER_ID UTIL2 getAdmin transitReplicationPeerSyncReplicationState PEER_ID SyncReplicationState STANDBY UTIL1 getAdmin transitReplicationPeerSyncReplicationState PEER_ID SyncReplicationState ACTIVE table UTIL1 TABLE_NAME table put Put Bytes toBytes addColumn CF CQ Bytes toBytes HRegionServer rs UTIL1 getRSForFirstRegionInTable TABLE_NAME DualAsyncFSWALForTest wal DualAsyncFSWALForTest rs getWAL RegionInfoBuilder newBuilder TABLE_NAME build wal setRemoteBroken wal suspendLogRoll conn UTIL1 get AsyncTable table conn getTableBuilder TABLE_NAME setMaxAttempts setWriteRpcTimeout TimeUnit SECONDS build table put Put Bytes toBytes addColumn CF CQ Bytes toBytes get fail
MasterFileSystem mfs UTIL2 getHBaseCluster getMaster getMasterFileSystem Path remoteWALDir getRemoteWALDir mfs PEER_ID assertFalse mfs getWALFileSystem exists remoteWALDir UTIL2 getAdmin transitReplicationPeerSyncReplicationState PEER_ID SyncReplicationState STANDBY assertTrue mfs getWALFileSystem exists remoteWALDir UTIL1 getAdmin transitReplicationPeerSyncReplicationState PEER_ID SyncReplicationState ACTIVE UTIL1 getAdmin disableReplicationPeer PEER_ID write UTIL1 COUNT UTIL1 shutdownMiniCluster Thread Thread Thread sleep SLEEP_TIME UTIL2 getMiniHBaseCluster getMaster stop
UTIL1 getAdmin transitReplicationPeerSyncReplicationState PEER_ID SyncReplicationState ACTIVE UTIL1 getAdmin disableReplicationPeer PEER_ID write UTIL1 COUNT UTIL1 shutdownMiniCluster Thread t Thread Thread sleep SLEEP_TIME UTIL2 getMiniHBaseCluster getMaster stop e LOG error e t start UTIL2 getAdmin transitReplicationPeerSyncReplicationState PEER_ID SyncReplicationState DOWNGRADE_ACTIVE e
UTIL1 getAdmin transitReplicationPeerSyncReplicationState PEER_ID SyncReplicationState ACTIVE UTIL1 getAdmin disableReplicationPeer PEER_ID write UTIL1 COUNT UTIL1 shutdownMiniCluster JVMClusterUtil MasterThread activeMaster UTIL2 getMiniHBaseCluster getMasterThread List JVMClusterUtil RegionServerThread regionServers UTIL2 getMiniHBaseCluster getLiveRegionServerThreads JVMClusterUtil RegionServerThread rst regionServers ServerName serverName rst getRegionServer getServerName rst getRegionServer stop waitForRSShutdownToStartAndFinish activeMaster serverName JVMClusterUtil RegionServerThread restarted UTIL2 getMiniHBaseCluster startRegionServer restarted waitForServerOnline
List JVMClusterUtil RegionServerThread regionServers UTIL2 getMiniHBaseCluster getLiveRegionServerThreads JVMClusterUtil RegionServerThread rst regionServers ServerName serverName rst getRegionServer getServerName rst getRegionServer stop waitForRSShutdownToStartAndFinish activeMaster serverName JVMClusterUtil RegionServerThread restarted UTIL2 getMiniHBaseCluster startRegionServer restarted waitForServerOnline e LOG error e t start UTIL2 getAdmin transitReplicationPeerSyncReplicationState PEER_ID SyncReplicationState DOWNGRADE_ACTIVE e
activeMaster ServerManager sm activeMaster getMaster getServerManager sm
Threads sleep watcher start t1 i i i Put put Put ROWS i put addColumn famName VALUE VALUE t1 put put start EnvironmentEdgeManager currentTime EnvironmentEdgeManager currentTime start Scan scan Scan scan setCaching count scan
i i i r Bytes toBytes i table1 put Put r addColumn famName famName r Optional RegionServerThread server UTIL1 getMiniHBaseCluster getLiveRegionServerThreads stream filter rst CollectionUtils isNotEmpty rst getRegionServer getRegions tablename findAny Assert assertTrue server isPresent server get getRegionServer abort UTIL1 waitFor UTIL1 getMiniHBaseCluster getLiveRegionServerThreads size NUM_SLAVES1 UTIL1 waitTableAvailable tablename Replication replication Replication UTIL1 getMiniHBaseCluster getLiveRegionServerThreads get getRegionServer getReplicationSourceService UTIL1 waitFor replication getReplicationManager getOldSources isEmpty hbaseAdmin disableReplicationPeer PEER_ID2 LOG info checkReplicationData hbaseAdmin enableReplicationPeer PEER_ID2 waitFor count checkReplicationData
regionReplication TableDescriptor htd HTU createModifyableTableDescriptor name getMethodName setRegionReplication regionReplication setRegionMemStoreReplication build HTU getAdmin createTable htd TableName tableName htd getTableName Connection connection ConnectionFactory createConnection HTU getConfiguration Table table connection getTable tableName STEP i i i startRow i STEP endRow i STEP
regionReplication TableDescriptor htd HTU createModifyableTableDescriptor name getMethodName setRegionReplication regionReplication build HTU getAdmin createTable htd TableName tableName htd getTableName Connection connection ConnectionFactory createConnection HTU getConfiguration Table table connection getTable tableName
WAL wal wals getWAL hri manager init TableDescriptor htd TableDescriptorBuilder newBuilder TableName valueOf setColumnFamily ColumnFamilyDescriptorBuilder of f1 build NavigableMap Integer scopes TreeMap Bytes BYTES_COMPARATOR fam htd scopes put fam i i i i i wal rollWriter LOG info Long toString i txid wal appendData hri WALKeyImpl hri getEncodedNameAsBytes test System currentTimeMillis mvcc scopes edit wal sync txid LOG info baseline time baseline time baseline
Path hfilePath1 Path Bytes toString f1 p add hfilePath1 storeFilesSize put hfilePath1 getName fs getFileStatus hfilePath1 getLen LOG debug hfilePath1 storeFilesSize put hfilePath1 getName storeFiles put f1 p scope put f1 p ArrayList Path hfilePath2 Path Bytes toString f2 p add hfilePath2 storeFilesSize put hfilePath2 getName fs getFileStatus hfilePath2 getLen
truncateTable UTIL1 tableName truncateTable UTIL2 tableName hbaseAdmin addReplicationPeer ReplicationPeerConfig setClusterKey UTIL2 getClusterKey setReplicationEndpointImpl ReplicationEndpointForTest getName ReplicationEndpointForTest setBatchCount ReplicationEndpointForTest setEntriesCount ReplicationEndpointForTest pause valueBytes i i i htable1 put Put Bytes toBytes Integer toString i addColumn famName valueBytes ReplicationEndpointForTest resume
PrintWriter pw PrintWriter FileOutputStream script pw println pw println pw println pw println pw println pw println pw println pw println pw println pw println pw flush pw close
file BufferedReader reader BufferedReader FileReader file String line line reader
TEST_UTIL createTable tableNameB familyNameBytes TEST_UTIL List String regionsA getTableRegionMap get tableNameA regionsA List String regionsB getTableRegionMap get tableNameB regionsB getTableRegionMap get tableNameA size getTableRegionMap get tableNameB size RSGroupInfo tableGrpA ADMIN getRSGroup tableNameA assertTrue tableGrpA getName equals RSGroupInfo DEFAULT_GROUP RSGroupInfo tableGrpB ADMIN getRSGroup tableNameB assertTrue tableGrpB getName equals RSGroupInfo DEFAULT_GROUP
familyNameBytes Bytes toBytes String newGroupName getGroupName getNameWithoutIndex name getMethodName RSGroupInfo newGroup addGroup newGroupName TEST_UTIL createMultiRegionTable tableName familyNameBytes TEST_UTIL List String regions getTableRegionMap get tableName regions getTableRegionMap get tableName size RSGroupInfo tableGrp ADMIN getRSGroup tableName LOG info tableGrp assertTrue tableGrp getName equals RSGroupInfo DEFAULT_GROUP
familyNameBytes Bytes toBytes String newGroupName getGroupName getNameWithoutIndex name getMethodName RSGroupInfo newGroup addGroup newGroupName TEST_UTIL createMultiRegionTable tableName familyNameBytes TEST_UTIL List String regions getTableRegionMap get tableName regions getTableRegionMap get tableName size RSGroupInfo tableGrp ADMIN getRSGroup tableName assertTrue tableGrp getName equals RSGroupInfo DEFAULT_GROUP ADMIN disableTable tableName
TableName tableName TableName valueOf TABLE_PREFIX getNameWithoutIndex name getMethodName RSGroupInfo tableGrp ADMIN getRSGroup tableName assertNull tableGrp exist ADMIN tableExists tableName assertFalse exist
assertEquals barGroup getServers size assertEquals fooGroup getServers size ADMIN moveServersToRSGroup Sets newHashSet Address fromString fail ex String exp String msg exp assertTrue msg ex getMessage ex getMessage contains exp LOG info barGroup getServers ADMIN moveServersToRSGroup barGroup getServers fooGroup getName barGroup ADMIN getRSGroup fooGroup ADMIN getRSGroup assertEquals barGroup getServers size assertEquals fooGroup getServers size
String msg exp assertTrue msg ex getMessage ex getMessage contains exp LOG info barGroup getServers ADMIN moveServersToRSGroup barGroup getServers fooGroup getName barGroup ADMIN getRSGroup fooGroup ADMIN getRSGroup assertEquals barGroup getServers size assertEquals fooGroup getServers size LOG info fooGroup getServers ADMIN moveServersToRSGroup fooGroup getServers RSGroupInfo DEFAULT_GROUP getNumServers ADMIN getRSGroup RSGroupInfo DEFAULT_GROUP getServers size fooGroup ADMIN getRSGroup
LOG info barGroup getServers ADMIN moveServersToRSGroup barGroup getServers fooGroup getName barGroup ADMIN getRSGroup fooGroup ADMIN getRSGroup assertEquals barGroup getServers size assertEquals fooGroup getServers size LOG info fooGroup getServers ADMIN moveServersToRSGroup fooGroup getServers RSGroupInfo DEFAULT_GROUP getNumServers ADMIN getRSGroup RSGroupInfo DEFAULT_GROUP getServers size fooGroup ADMIN getRSGroup assertEquals fooGroup getServers size LOG info barGroup getName
LOG info RSGroupInfo newGroup addGroup getGroupName name getMethodName Iterator Address iterator newGroup getServers iterator ServerName targetServer getServerName iterator next ADMIN removeServersFromRSGroup Sets newHashSet targetServer getAddress fail ex String exp targetServer getAddress String msg exp assertTrue msg ex getMessage ex getMessage contains exp assertTrue newGroup getServers contains targetServer getAddress NUM_DEAD_SERVERS CLUSTER getClusterMetrics getDeadServerNames size
ADMIN addRSGroup RSGroupInfo fooGroup ADMIN getRSGroup assertEquals fooGroup getServers size RSGroupInfo defaultGroup ADMIN getRSGroup RSGroupInfo DEFAULT_GROUP ADMIN moveServersToRSGroup defaultGroup getServers fooGroup getName fail RSGroupInfoManagerImpl KEEP_ONE_SERVER_IN_DEFAULT_ERROR_MESSAGE ex assertTrue ex getMessage contains RSGroupInfoManagerImpl KEEP_ONE_SERVER_IN_DEFAULT_ERROR_MESSAGE defaultGroup getServers size Address serverInDefaultGroup defaultGroup getServers iterator next LOG info serverInDefaultGroup fooGroup getName ADMIN moveServersToRSGroup Sets newHashSet serverInDefaultGroup fooGroup getName fooGroup ADMIN getRSGroup
ex assertTrue ex getMessage contains RSGroupInfoManagerImpl KEEP_ONE_SERVER_IN_DEFAULT_ERROR_MESSAGE defaultGroup getServers size Address serverInDefaultGroup defaultGroup getServers iterator next LOG info serverInDefaultGroup fooGroup getName ADMIN moveServersToRSGroup Sets newHashSet serverInDefaultGroup fooGroup getName fooGroup ADMIN getRSGroup LOG info fooGroup getServers ADMIN moveServersToRSGroup fooGroup getServers RSGroupInfo DEFAULT_GROUP getNumServers ADMIN getRSGroup RSGroupInfo DEFAULT_GROUP getServers size fooGroup ADMIN getRSGroup assertEquals fooGroup getServers size
String groupName getGroupName name getMethodName ADMIN addRSGroup groupName RSGroupInfo newGroup ADMIN getRSGroup groupName Pair ServerName RegionStateNode gotPair createTableWithRegionSplitting newGroup ServerName movedServer gotPair getFirst RegionStateNode rsn gotPair getSecond AtomicBoolean changed AtomicBoolean Thread t1 recoverRegionStateThread movedServer server MASTER getAssignmentManager getRegionsOnServer movedServer rsn changed t1 start Thread Thread LOG info ADMIN moveServersToRSGroup Sets newHashSet movedServer getAddress newGroup getName
ADMIN recommissionRegionServer sn assertTrue ADMIN listDecommissionedRegionServers isEmpty missing NUM_SLAVES_BASE getNumServers LOG info missing missing MiniHBaseCluster CLUSTER startRegionServer ADMIN addRSGroup ServerName masterServerName MiniHBaseCluster CLUSTER getMaster getServerName ADMIN moveServersToRSGroup Sets newHashSet masterServerName getAddress ex LOG warn ex assertTrue OBSERVER preMoveServersCalled
String groupName groupRSCount addGroup groupName groupRSCount Table t TEST_UTIL createMultiRegionTable tableName Bytes toBytes TEST_UTIL loadTable t Bytes toBytes Set TableName toAddTables HashSet toAddTables add tableName ADMIN setRSGroup toAddTables groupName assertTrue ADMIN getConfiguredNamespacesAndTablesInRSGroup groupName getSecond contains tableName TEST_UTIL waitTableAvailable tableName Set Address servers ADMIN getRSGroup groupName getServers assertEquals servers size
toAddTables add tableName ADMIN setRSGroup toAddTables groupName assertTrue ADMIN getConfiguredNamespacesAndTablesInRSGroup groupName getSecond contains tableName TEST_UTIL waitTableAvailable tableName Set Address servers ADMIN getRSGroup groupName getServers assertEquals servers size LOG debug servers tr MASTER getAssignmentManager getRegionStates tableName assertTrue servers contains MASTER getAssignmentManager getRegionStates getRegionAssignments get tr getAddress List ServerName gsn ArrayList Address addr servers gsn add getServerName addr assertEquals gsn size ServerName MASTER getAssignmentManager getRegionStates getRegionAssignments tableName
createTable TEST_UTIL tableBuilder build Bytes toBytes grantGlobal TEST_UTIL USER_ADMIN getShortName Permission Action ADMIN Permission Action CREATE Permission Action READ Permission Action WRITE grantOnTable TEST_UTIL USER_RW getShortName TEST_TABLE TEST_FAMILY Permission Action READ Permission Action WRITE grantOnTable TEST_UTIL USER_CREATE getShortName TEST_TABLE Permission Action CREATE Permission Action READ Permission Action WRITE grantOnTable TEST_UTIL USER_RO getShortName TEST_TABLE TEST_FAMILY Permission Action READ grantGlobal TEST_UTIL toGroupEntry GROUP_ADMIN Permission Action ADMIN grantGlobal TEST_UTIL toGroupEntry GROUP_CREATE Permission Action CREATE grantGlobal TEST_UTIL toGroupEntry GROUP_READ Permission Action READ grantGlobal TEST_UTIL toGroupEntry GROUP_WRITE Permission Action WRITE assertEquals PermissionStorage getTablePermissions conf TEST_TABLE size assertEquals AccessControlClient getUserPermissions systemUserConnection TEST_TABLE toString size e fail e getMessage e
User user1 User getCurrent assertNotNull user1 ugi
RCP_ENV rcpHost createEnvironment ACCESS_CONTROLLER Coprocessor PRIORITY_HIGHEST conf grantGlobal TEST_UTIL USER_ADMIN getShortName Permission Action ADMIN Permission Action CREATE Permission Action READ Permission Action WRITE grantOnTable TEST_UTIL USER_RW getShortName TEST_TABLE TEST_FAMILY Permission Action READ Permission Action WRITE grantOnTable TEST_UTIL USER_CREATE getShortName TEST_TABLE Permission Action CREATE Permission Action READ Permission Action WRITE grantOnTable TEST_UTIL USER_RO getShortName TEST_TABLE TEST_FAMILY Permission Action READ grantOnTable TEST_UTIL USER_ADMIN_CF getShortName TEST_TABLE TEST_FAMILY Permission Action ADMIN Permission Action CREATE grantGlobal TEST_UTIL toGroupEntry GROUP_ADMIN Permission Action ADMIN grantGlobal TEST_UTIL toGroupEntry GROUP_CREATE Permission Action CREATE grantGlobal TEST_UTIL toGroupEntry GROUP_READ Permission Action READ grantGlobal TEST_UTIL toGroupEntry GROUP_WRITE Permission Action WRITE assertEquals PermissionStorage getTablePermissions conf TEST_TABLE size size size AccessControlClient getUserPermissions systemUserConnection TEST_TABLE toString size
locator regions locator getAllRegionLocations HRegionLocation location regions get RegionInfo hri location getRegion ServerName server location getServerName moveAction admin move hri getEncodedNameAsBytes newRs getServerName SUPERUSER runAs moveAction RETRIES_LIMIT retries newRs retries RETRIES_LIMIT
User testGrantRevoke User createUserForTesting conf String getAction conf t TEST_TABLE t get Get TEST_ROW verifyDenied getAction testGrantRevoke grantOnTableUsingAccessControlClient TEST_UTIL systemUserConnection testGrantRevoke getShortName TEST_TABLE Permission Action READ e LOG error e verifyAllowed getAction testGrantRevoke revokeFromTableUsingAccessControlClient TEST_UTIL systemUserConnection testGrantRevoke getShortName TEST_TABLE Permission Action READ e
verifyDenied getAction testGlobalGrantRevoke String userName testGlobalGrantRevoke getShortName grantGlobalUsingAccessControlClient TEST_UTIL systemUserConnection userName Permission Action READ e LOG error e verifyAllowed getAction testGlobalGrantRevoke e revokeGlobal TEST_UTIL userName Permission Action READ e revokeGlobalUsingAccessControlClient TEST_UTIL systemUserConnection userName Permission Action READ e
putAction Put p Put TEST_ROW p addColumn TEST_FAMILY TEST_QUALIFIER Bytes toBytes t t put p verifyDenied getAction testGrantRevoke verifyDenied putAction testGrantRevoke String userName testGrantRevoke getShortName grantGlobalUsingAccessControlClient TEST_UTIL systemUserConnection userName Permission Action READ
Put p Put TEST_ROW p addColumn TEST_FAMILY TEST_QUALIFIER Bytes toBytes t t put p verifyDenied getAction testGrantRevoke verifyDenied putAction testGrantRevoke String userName testGrantRevoke getShortName grantGlobalUsingAccessControlClient TEST_UTIL systemUserConnection userName Permission Action READ e LOG error e verifyAllowed getAction testGrantRevoke verifyDenied putAction testGrantRevoke
verifyDenied getAction testGrantRevoke verifyDenied putAction testGrantRevoke String userName testGrantRevoke getShortName grantGlobalUsingAccessControlClient TEST_UTIL systemUserConnection userName Permission Action READ e LOG error e verifyAllowed getAction testGrantRevoke verifyDenied putAction testGrantRevoke grantGlobalUsingAccessControlClient TEST_UTIL systemUserConnection userName Permission Action WRITE e LOG error e verifyAllowed getAction testGrantRevoke
grantGlobalUsingAccessControlClient TEST_UTIL systemUserConnection userName Permission Action READ e LOG error e verifyAllowed getAction testGrantRevoke verifyDenied putAction testGrantRevoke grantGlobalUsingAccessControlClient TEST_UTIL systemUserConnection userName Permission Action WRITE e LOG error e verifyAllowed getAction testGrantRevoke verifyAllowed putAction testGrantRevoke revokeGlobalUsingAccessControlClient TEST_UTIL systemUserConnection userName Permission Action READ Permission Action WRITE e
verifyAllowed getAction testGrantRevoke verifyDenied putAction testGrantRevoke grantGlobalUsingAccessControlClient TEST_UTIL systemUserConnection userName Permission Action WRITE e LOG error e verifyAllowed getAction testGrantRevoke verifyAllowed putAction testGrantRevoke revokeGlobalUsingAccessControlClient TEST_UTIL systemUserConnection userName Permission Action READ Permission Action WRITE e LOG error e verifyDenied getAction testGrantRevoke verifyDenied putAction testGrantRevoke
LOG error e verifyAllowed getAction testGrantRevoke verifyAllowed putAction testGrantRevoke revokeGlobalUsingAccessControlClient TEST_UTIL systemUserConnection userName Permission Action READ Permission Action WRITE e LOG error e verifyDenied getAction testGrantRevoke verifyDenied putAction testGrantRevoke grantOnTableUsingAccessControlClient TEST_UTIL systemUserConnection userName TEST_TABLE Permission Action READ e LOG error e verifyAllowed getAction testGrantRevoke verifyDenied putAction testGrantRevoke
e LOG error e verifyDenied getAction testGrantRevoke verifyDenied putAction testGrantRevoke grantOnTableUsingAccessControlClient TEST_UTIL systemUserConnection userName TEST_TABLE Permission Action READ e LOG error e verifyAllowed getAction testGrantRevoke verifyDenied putAction testGrantRevoke grantOnTableUsingAccessControlClient TEST_UTIL systemUserConnection userName TEST_TABLE Action WRITE e LOG error e verifyAllowed getAction testGrantRevoke
grantOnTableUsingAccessControlClient TEST_UTIL systemUserConnection userName TEST_TABLE Permission Action READ e LOG error e verifyAllowed getAction testGrantRevoke verifyDenied putAction testGrantRevoke grantOnTableUsingAccessControlClient TEST_UTIL systemUserConnection userName TEST_TABLE Action WRITE e LOG error e verifyAllowed getAction testGrantRevoke verifyAllowed putAction testGrantRevoke revokeFromTableUsingAccessControlClient TEST_UTIL systemUserConnection userName TEST_TABLE Permission Action READ Permission Action WRITE e LOG error e
verifyDenied putAction testGrantRevoke grantOnTableUsingAccessControlClient TEST_UTIL systemUserConnection userName TEST_TABLE Action WRITE e LOG error e verifyAllowed getAction testGrantRevoke verifyAllowed putAction testGrantRevoke revokeFromTableUsingAccessControlClient TEST_UTIL systemUserConnection userName TEST_TABLE Permission Action READ Permission Action WRITE e LOG error e verifyDenied getAction testGrantRevoke verifyDenied putAction testGrantRevoke String namespace TEST_TABLE getNamespaceAsString
verifyDenied getAction testNS String userName testNS getShortName String namespace TEST_TABLE getNamespaceAsString grantOnNamespaceUsingAccessControlClient TEST_UTIL systemUserConnection userName namespace Permission Action READ e LOG error e verifyAllowed getAction testNS e revokeFromNamespace TEST_UTIL userName namespace Permission Action READ e revokeFromNamespaceUsingAccessControlClient TEST_UTIL systemUserConnection userName namespace Permission Action READ
RegionCoprocessorHost rcpHost region getCoprocessorHost RCP_ENV rcpHost createEnvironment ACCESS_CONTROLLER Coprocessor PRIORITY_HIGHEST conf grantGlobal TEST_UTIL USER_ADMIN getShortName Permission Action ADMIN Permission Action CREATE Permission Action READ Permission Action WRITE grantOnTable TEST_UTIL USER_RW getShortName TEST_TABLE TEST_FAMILY Permission Action READ Permission Action WRITE grantOnTable TEST_UTIL USER_CREATE getShortName TEST_TABLE Permission Action CREATE Permission Action READ Permission Action WRITE grantOnTable TEST_UTIL USER_RO getShortName TEST_TABLE TEST_FAMILY Permission Action READ grantOnTable TEST_UTIL USER_ADMIN_CF getShortName TEST_TABLE TEST_FAMILY Permission Action ADMIN Permission Action CREATE grantGlobal TEST_UTIL toGroupEntry GROUP_ADMIN Permission Action ADMIN grantGlobal TEST_UTIL toGroupEntry GROUP_CREATE Permission Action CREATE grantGlobal TEST_UTIL toGroupEntry GROUP_READ Permission Action READ grantGlobal TEST_UTIL toGroupEntry GROUP_WRITE Permission Action WRITE assertEquals PermissionStorage getTablePermissions conf TEST_TABLE size assertEquals AccessControlClient getUserPermissions systemUserConnection TEST_TABLE toString size
conf snapshotName expectedRowCount Path restoreDir Path SnapshotScannerHDFSAclHelper SNAPSHOT_RESTORE_TMP_DIR_DEFAULT Scan scan Scan TableSnapshotScanner scanner TableSnapshotScanner conf restoreDir snapshotName scan rowCount Result result scanner next result rowCount scanner close assertEquals expectedRowCount rowCount
String userTestNamespace Table acl UTIL getConnection getTable PermissionStorage ACL_TABLE_NAME ListMultimap String UserPermission perms PermissionStorage getNamespacePermissions conf TEST_NAMESPACE String UserPermission perms
String grantUserName name getMethodName User grantUser User createUserForTesting conf grantUserName String String namespace name getMethodName TableName table TableName valueOf namespace name getMethodName String snapshot namespace String snapshot2 namespace String snapshot3 namespace
String grantUserName name getMethodName User grantUser User createUserForTesting conf grantUserName String String namespace name getMethodName TableName table TableName valueOf namespace name getMethodName String snapshot namespace String snapshot2 namespace String snapshot3 namespace LOG info table t TestHDFSAclHelper table TestHDFSAclHelper put t
String grantUserName name getMethodName User grantUser User createUserForTesting conf grantUserName String String namespace name getMethodName TableName table TableName valueOf namespace name getMethodName String snapshot namespace String snapshot2 namespace String snapshot3 namespace LOG info table t TestHDFSAclHelper TEST_UTIL table TestHDFSAclHelper put t LOG info table TestHDFSAclHelper grantOnTable TEST_UTIL grantUserName table READ admin snapshot snapshot table admin disableTable table admin deleteTable table
Configuration conf UTIL getConfiguration connection conf addUserPermission conf UserPermission Permission newBuilder TEST_TABLE withActions Permission Action READ build connection getTable PermissionStorage ACL_TABLE_NAME addUserPermission conf UserPermission Permission newBuilder TEST_TABLE withActions Permission Action READ Permission Action WRITE build connection getTable PermissionStorage ACL_TABLE_NAME addUserPermission conf UserPermission Permission newBuilder TEST_TABLE withFamily TEST_FAMILY withActions Permission Action READ build connection getTable PermissionStorage ACL_TABLE_NAME addUserPermission conf UserPermission Permission newBuilder TEST_TABLE withFamily TEST_FAMILY withQualifier TEST_QUALIFIER withActions Permission Action WRITE build connection getTable PermissionStorage ACL_TABLE_NAME ListMultimap String UserPermission preperms PermissionStorage getTablePermissions conf TEST_TABLE Table table UTIL getConnection getTable TEST_TABLE table put Put Bytes toBytes addColumn TEST_FAMILY TEST_QUALIFIER Bytes toBytes table put Put Bytes toBytes addColumn TEST_FAMILY TEST_QUALIFIER Bytes toBytes Admin admin UTIL getAdmin admin split TEST_TABLE
UserPermission first UserPermission second assertEquals first size second size key first List UserPermission firstPerms first get key List UserPermission secondPerms second get key assertNotNull secondPerms assertEquals firstPerms size secondPerms size
UserPermission first UserPermission second assertEquals first size second size key first List UserPermission firstPerms first get key List UserPermission secondPerms second get key assertNotNull secondPerms assertEquals firstPerms size secondPerms size LOG info firstPerms toString
assertTrue KEY_MASTER isMaster assertFalse KEY_SLAVE isMaster maxKeyId KEY_MASTER rollCurrentKey AuthenticationKey key1 KEY_MASTER getCurrentKey assertNotNull key1
assertTrue KEY_MASTER isMaster assertFalse KEY_SLAVE isMaster maxKeyId KEY_MASTER rollCurrentKey AuthenticationKey key1 KEY_MASTER getCurrentKey assertNotNull key1 LOG debug key1 Thread sleep AuthenticationKey slaveCurrent KEY_SLAVE getCurrentKey assertNotNull slaveCurrent assertEquals key1 slaveCurrent
assertTrue KEY_MASTER isMaster assertFalse KEY_SLAVE isMaster maxKeyId KEY_MASTER rollCurrentKey AuthenticationKey key1 KEY_MASTER getCurrentKey assertNotNull key1 LOG debug key1 Thread sleep AuthenticationKey slaveCurrent KEY_SLAVE getCurrentKey assertNotNull slaveCurrent assertEquals key1 slaveCurrent LOG debug slaveCurrent KEY_MASTER rollCurrentKey AuthenticationKey key2 KEY_MASTER getCurrentKey
maxKeyId KEY_MASTER rollCurrentKey AuthenticationKey key1 KEY_MASTER getCurrentKey assertNotNull key1 LOG debug key1 Thread sleep AuthenticationKey slaveCurrent KEY_SLAVE getCurrentKey assertNotNull slaveCurrent assertEquals key1 slaveCurrent LOG debug slaveCurrent KEY_MASTER rollCurrentKey AuthenticationKey key2 KEY_MASTER getCurrentKey LOG debug key2 KEY_MASTER rollCurrentKey AuthenticationKey key3 KEY_MASTER getCurrentKey
KEY_MASTER rollCurrentKey AuthenticationKey key3 KEY_MASTER getCurrentKey LOG debug key3 key1 setExpiration EnvironmentEdgeManager currentTime KEY_MASTER removeExpiredKeys assertNull KEY_MASTER getKey key1 getKeyId KEY_SLAVE getLatch await AuthenticationKey slave2 KEY_SLAVE getKey key2 getKeyId assertNotNull slave2 assertEquals key2 slave2 AuthenticationKey slave3 KEY_SLAVE getKey key3 getKeyId assertNotNull slave3 assertEquals key3 slave3 slaveCurrent KEY_SLAVE getCurrentKey assertEquals key3 slaveCurrent
key1 setExpiration EnvironmentEdgeManager currentTime KEY_MASTER removeExpiredKeys assertNull KEY_MASTER getKey key1 getKeyId KEY_SLAVE getLatch await AuthenticationKey slave2 KEY_SLAVE getKey key2 getKeyId assertNotNull slave2 assertEquals key2 slave2 AuthenticationKey slave3 KEY_SLAVE getKey key3 getKeyId assertNotNull slave3 assertEquals key3 slave3 slaveCurrent KEY_SLAVE getCurrentKey assertEquals key3 slaveCurrent LOG debug slaveCurrent AuthenticationKey k KEY_SLAVE getKey key1 getKeyId
KEY_MASTER stop Thread sleep assertFalse KEY_MASTER isMaster AuthenticationTokenSecretManager mgrs AuthenticationTokenSecretManager KEY_SLAVE KEY_SLAVE2 AuthenticationTokenSecretManager newMaster tries newMaster tries AuthenticationTokenSecretManager mgr mgrs mgr isMaster newMaster mgr newMaster Thread sleep assertNotNull newMaster AuthenticationKey current newMaster getCurrentKey
table2 CellScanner cellScanner Cell current Get get Get row get setAuthorizations Authorizations auths Result result table2 get get cellScanner result cellScanner advance cellScanner advance assertTrue advance current cellScanner current assertArrayEquals CellUtil cloneRow current row
RegionServerThread rsThread rsThread getRegionServer abort RegionServerThread rs TEST_UTIL getHBaseCluster startRegionServer waitForLabelsRegionAvailability rs getRegionServer AtomicBoolean vcInitialized AtomicBoolean VisibilityLabelsResponse VisibilityLabelsResponse VisibilityLabelsResponse String labels SECRET CONFIDENTIAL PRIVATE conn VisibilityLabelsResponse resp VisibilityClient addLabels conn labels List RegionActionResult results resp getResultList results get NameBytesPair pair results get getException Throwable t ProtobufUtil toException pair
setupConf conf TestFlushSnapshotFromClient setupConf conf UTIL getConfiguration setInt SnapshotManager SNAPSHOT_POOL_THREADS_KEY
SnapshotTestingUtils assertNoSnapshots admin TableName tableName TableName valueOf fail admin getDescriptor tableName fail
TableName tableName TableName valueOf fail admin getDescriptor tableName fail LOG error tableName tableName TableName valueOf tableName fail fail admin snapshot tableName SnapshotType FLUSH fail
Path rootDir sourceHtd htdClone List String files SnapshotTestingUtils listHFileNames fs CommonFSUtils getTableDir rootDir htdClone getTableName assertEquals files size i i files size i String linkFile files get i String refFile files get i assertTrue linkFile HFileLink isHFileLink linkFile assertTrue refFile StoreFileInfo isReference refFile assertEquals sourceHtd getTableName HFileLink getReferencedTableName linkFile Path refPath getReferredToFile refFile
snapshotDir sd htdClone LOG debug htdClone getTableName snapshotDir CommonFSUtils logFileSystemState fs rootDir LOG FSTableDescriptors conf createTableDescriptor htdClone RestoreSnapshotHelper helper getRestoreHelper rootDir snapshotDir sd htdClone helper restoreHdfsRegions
FileSystem fs CommonFSUtils getCurrentFileSystem CONF List Path fileNames listHFileNames fs CommonFSUtils getTableDir CommonFSUtils getRootDir CONF TABLE_NAME List FileStatus files ArrayList Path fileName fileNames files add fs getFileStatus fileName TEST_UTIL getAdmin snapshot TABLE_NAME Assert assertEquals Lists newArrayList cleaner getDeletableFiles files size TEST_UTIL getAdmin deleteSnapshot cleaner getFileCacheForTesting triggerCacheRefreshForTesting Assert assertEquals Lists newArrayList cleaner getDeletableFiles files size k k k TEST_UTIL getAdmin snapshot k TABLE_NAME
LOG error e AtomicBoolean success AtomicBoolean LOG info Thread sleep cleaner getFileCacheForTesting triggerCacheRefreshForTesting Iterable FileStatus toDeleteFiles cleaner getDeletableFiles files List FileStatus deletableFiles Lists newArrayList toDeleteFiles LOG info deletableFiles size i i deletableFiles size i LOG debug i deletableFiles get i
tableName List metaRows TEST_UTIL getMetaTableRows tableName metaRows
LOG info dumpMeta htd getTableName List HRegionLocation locations rl connection locations rl getAllRegionLocations HRegionLocation location locations RegionInfo hri location getRegion ServerName hsa location getServerName hri hri hri LOG info hri getRegionNameAsString deleteRow hri getRegionName LOG info hri hsa undeployRegion connection hsa hri
RegionInfo hri location getRegion ServerName hsa location getServerName hri hri hri LOG info hri getRegionNameAsString deleteRow hri getRegionName LOG info hri hsa undeployRegion connection hsa hri LOG info hri toString hsa toString Path rootDir CommonFSUtils getRootDir conf FileSystem fs rootDir getFileSystem conf Path p Path CommonFSUtils getTableDir rootDir htd getTableName hri getEncodedName Path hriPath Path p HRegionFileSystem REGION_INFO_FILE fs delete hriPath
LOG info hri hsa undeployRegion connection hsa hri LOG info hri toString hsa toString Path rootDir CommonFSUtils getRootDir conf FileSystem fs rootDir getFileSystem conf Path p Path CommonFSUtils getTableDir rootDir htd getTableName hri getEncodedName Path hriPath Path p HRegionFileSystem REGION_INFO_FILE fs delete hriPath LOG info hri toString hsa toString Path rootDir CommonFSUtils getRootDir conf FileSystem fs rootDir getFileSystem conf Path p Path CommonFSUtils getTableDir rootDir htd getTableName hri getEncodedName HBaseFsck debugLsr conf p
Path p Path CommonFSUtils getTableDir rootDir htd getTableName hri getEncodedName Path hriPath Path p HRegionFileSystem REGION_INFO_FILE fs delete hriPath LOG info hri toString hsa toString Path rootDir CommonFSUtils getRootDir conf FileSystem fs rootDir getFileSystem conf Path p Path CommonFSUtils getTableDir rootDir htd getTableName hri getEncodedName HBaseFsck debugLsr conf p success fs delete p LOG info p success HBaseFsck debugLsr conf p Delete delete Delete deleteRow
table Path rootDir CommonFSUtils getRootDir conf FileSystem fs rootDir getFileSystem conf Path p CommonFSUtils getTableDir rootDir table HBaseFsck debugLsr conf p success fs delete p
HRegionLocation metaLocation connection getRegionLocator TableName META_TABLE_NAME getRegionLocation HConstants EMPTY_START_ROW ServerName hsa metaLocation getServerName RegionInfo hri metaLocation getRegion
HRegionLocation metaLocation connection getRegionLocator TableName META_TABLE_NAME getRegionLocation HConstants EMPTY_START_ROW ServerName hsa metaLocation getServerName RegionInfo hri metaLocation getRegion LOG info hri hsa unmanagedConnection conf undeployRegion unmanagedConnection hsa hri LOG info hri toString hsa toString Path rootDir CommonFSUtils getRootDir conf FileSystem fs rootDir getFileSystem conf Path p Path rootDir TableName META_TABLE_NAME getNameAsString hri getEncodedName Path hriPath Path p HRegionFileSystem REGION_INFO_FILE fs delete hriPath
undeployRegion unmanagedConnection hsa hri LOG info hri toString hsa toString Path rootDir CommonFSUtils getRootDir conf FileSystem fs rootDir getFileSystem conf Path p Path rootDir TableName META_TABLE_NAME getNameAsString hri getEncodedName Path hriPath Path p HRegionFileSystem REGION_INFO_FILE fs delete hriPath LOG info hri toString hsa toString Path rootDir CommonFSUtils getRootDir conf FileSystem fs rootDir getFileSystem conf Path p Path rootDir TableName META_TABLE_NAME getNameAsString hri getEncodedName HBaseFsck debugLsr conf p success fs delete p
previous archived List List String lists getFileLists previous archived List String original lists get Collections sort original List String currentFiles lists get Collections sort currentFiles List String backedup lists get Collections sort backedup backedup LOG debug String msg msg assertArchiveEquality original backedup msg
List String currentFiles lists get Collections sort currentFiles List String backedup lists get Collections sort backedup backedup LOG debug String msg msg assertArchiveEquality original backedup msg LOG debug msg msg assertArchiveEquality original currentFiles msg
result String rowKeyStr Bytes toString result getRow result
result LOG error rowKeyStr printLocations result expectedCfs dataGenerator getColumnFamilies expectedCfs result getMap size LOG error rowKeyStr result getMap size printLocations result cf result getMap String cfStr Bytes toString cf Map columnValues result getFamilyMap cf columnValues
expectedCfs dataGenerator getColumnFamilies expectedCfs result getMap size LOG error rowKeyStr result getMap size printLocations result cf result getMap String cfStr Bytes toString cf Map columnValues result getFamilyMap cf columnValues LOG error rowKeyStr cfStr printLocations result Map String MutationType mutateInfo
printLocations result Map String MutationType mutateInfo columnValues MUTATE_INFO LOG error rowKeyStr cfStr Bytes toString MUTATE_INFO printLocations result cfHash Arrays hashCode cf mutateInfoValue columnValues remove MUTATE_INFO mutateInfo parseMutateInfo mutateInfoValue Map String MutationType mutate mutateInfo mutate MutationType column Bytes toBytes mutate getKey columnHash Arrays hashCode column
LOG error rowKeyStr cfStr Bytes toString MUTATE_INFO printLocations result cfHash Arrays hashCode cf mutateInfoValue columnValues remove MUTATE_INFO mutateInfo parseMutateInfo mutateInfoValue mutate mutateInfo mutate column Bytes toBytes mutate getKey columnHash Arrays hashCode column hashCode cfHash columnHash hashCode columnValues column LOG error rowKeyStr cfStr mutate getKey printLocations result
column Bytes toBytes mutate getKey columnHash Arrays hashCode column hashCode cfHash columnHash hashCode columnValues column LOG error rowKeyStr cfStr mutate getKey printLocations result hashCodeBytes Bytes toBytes hashCode columnValues put column hashCodeBytes columnValues INCREMENT LOG error rowKeyStr cfStr Bytes toString INCREMENT printLocations result currentValue Bytes toLong columnValues remove INCREMENT
columnValues INCREMENT LOG error rowKeyStr cfStr Bytes toString INCREMENT printLocations result currentValue Bytes toLong columnValues remove INCREMENT amount mutateInfo isEmpty cfHash originalValue Arrays hashCode result getRow extra currentValue originalValue extra amount extra amount LOG error rowKeyStr cfStr extra amount printLocations result amount extra amount LOG warn rowKeyStr cfStr extra amount
kv String column Bytes toString kv getKey MutationType mutation mutateInfo get column verificationNeeded bytes kv getValue mutation mutationVerified columnHash Arrays hashCode kv getKey hashCode cfHash columnHash hashCodeBytes Bytes toBytes hashCode mutation MutationType offset bytes length hashCodeBytes length mutationVerified offset Bytes equals hashCodeBytes hashCodeBytes length bytes offset hashCodeBytes length mutationVerified
verificationNeeded bytes kv getValue mutationVerified columnHash Arrays hashCode kv getKey hashCode cfHash columnHash hashCodeBytes Bytes toBytes hashCode offset bytes length hashCodeBytes length mutationVerified offset Bytes equals hashCodeBytes hashCodeBytes length bytes offset hashCodeBytes length mutationVerified n newOffset offset hashCodeBytes length newOffset Bytes equals hashCodeBytes hashCodeBytes length bytes newOffset hashCodeBytes length
start startKey endKey numThreads start startKey endKey numThreads
start startKey endKey numThreads start startKey endKey numThreads
m Delete table checkAndMutate row cf qualifier q ifEquals v thenDelete Delete m IllegalArgumentException m getClass getSimpleName totalOpTimeMs addAndGet System currentTimeMillis start e failedKeySet add keyBase String exceptionInfo e RetriesExhaustedWithDetailsException RetriesExhaustedWithDetailsException aggEx RetriesExhaustedWithDetailsException e exceptionInfo aggEx getExhaustiveDescription StringWriter stackWriter StringWriter PrintWriter pw PrintWriter stackWriter e printStackTrace pw
start startKey endKey numThreads start startKey endKey numThreads
cleanupOldState LOG info zkClientPort startZK HBaseTestingUtility waitForHostPort HConstants LOCALHOST zkClientPort masterPort startMaster masterPort ZKUtil waitForBaseZNode conf rsPort startRegionServer rsPort LOG info attemptsLeft attemptsLeft testUtil getConnection getTable TableName META_TABLE_NAME
ensureShutdownHookInstalled
Map String String map HashMap System getenv map putAll envOverrides envp String map size idx Map String String e map envp idx e getKey e getValue Process p Runtime getRuntime exec command envp BufferedReader stdInput BufferedReader InputStreamReader p getInputStream BufferedReader stdError BufferedReader InputStreamReader p getErrorStream String s s stdInput System out println s s stdError System out println s e
serverType port pid getServerPID serverType port pid
serverType rsPort String dir serverWorkingDir serverType rsPort String confStr generateConfig serverType rsPort dir
ProcessBasedLocalHBaseCluster hbaseCluster ProcessBasedLocalHBaseCluster conf NUM_DATANODES numRegionServers hbaseCluster startMiniDFS hbaseCluster startHBase HBaseTestingUtility createPreSplitLoadTestTable conf TABLE_NAME HFileTestUtil DEFAULT_COLUMN_FAMILY Compression Algorithm NONE DataBlockEncoding NONE LOG debug loadData LOG debug SLEEP_SEC_AFTER_DATA_LOAD Threads sleep SLEEP_SEC_AFTER_DATA_LOAD Connection connection ConnectionFactory createConnection conf metaRSPort HBaseTestingUtility getMetaRSPort connection
LOG debug SLEEP_SEC_AFTER_DATA_LOAD Threads sleep SLEEP_SEC_AFTER_DATA_LOAD Connection connection ConnectionFactory createConnection conf metaRSPort HBaseTestingUtility getMetaRSPort connection LOG debug metaRSPort hbaseCluster killRegionServer metaRSPort Threads sleep LOG debug hbaseCluster startRegionServer metaRSPort Threads sleep LOG debug Table metaTable connection getTable TableName META_TABLE_NAME ResultScanner scanner metaTable getScanner Scan Result result result scanner
libName System loadLibrary libName Configuration conf Configuration CompressionCodec codec CompressionCodec ReflectionUtils newInstance conf getClassByName codecClassName conf DataOutputBuffer compressedDataBuffer DataOutputBuffer CompressionOutputStream deflateFilter codec createOutputStream compressedDataBuffer data DataOutputStream deflateOut DataOutputStream BufferedOutputStream deflateFilter deflateOut write data data length deflateOut flush deflateFilter finish assertTrue CompressionTest testCompression codecName
System loadLibrary libName Configuration conf Configuration CompressionCodec codec CompressionCodec ReflectionUtils newInstance conf getClassByName codecClassName conf DataOutputBuffer compressedDataBuffer DataOutputBuffer CompressionOutputStream deflateFilter codec createOutputStream compressedDataBuffer data DataOutputStream deflateOut DataOutputStream BufferedOutputStream deflateFilter deflateOut write data data length deflateOut flush deflateFilter finish assertTrue CompressionTest testCompression codecName e LOG debug codecName e getMessage e
Configuration conf Configuration CompressionCodec codec CompressionCodec ReflectionUtils newInstance conf getClassByName codecClassName conf DataOutputBuffer compressedDataBuffer DataOutputBuffer CompressionOutputStream deflateFilter codec createOutputStream compressedDataBuffer data DataOutputStream deflateOut DataOutputStream BufferedOutputStream deflateFilter deflateOut write data data length deflateOut flush deflateFilter finish assertTrue CompressionTest testCompression codecName e LOG debug codecName e getMessage e LOG error codecName e
DataOutputBuffer compressedDataBuffer DataOutputBuffer CompressionOutputStream deflateFilter codec createOutputStream compressedDataBuffer data DataOutputStream deflateOut DataOutputStream BufferedOutputStream deflateFilter deflateOut write data data length deflateOut flush deflateFilter finish assertTrue CompressionTest testCompression codecName e LOG debug codecName e getMessage e LOG error codecName e e LOG debug codecName assertFalse CompressionTest testCompression codecName
String name name getMethodName FileSystem fs FileSystem get UTIL getConfiguration Path rootdir Path UTIL getDataTestDir name fs rootdir get
String policy conf set HConstants WAL_STORAGE_POLICY policy MiniDFSCluster cluster htu startMiniDFSCluster assertTrue CommonFSUtils isHDFS conf FileSystem fs FileSystem get conf Path testDir htu getDataTestDirOnTestFS fs mkdirs testDir String storagePolicy conf get HConstants WAL_STORAGE_POLICY HConstants DEFAULT_WAL_STORAGE_POLICY CommonFSUtils setStoragePolicy fs testDir storagePolicy String file htu getRandomUUID toString Path p Path testDir file WriteDataToHDFS fs p HFileSystem hfs HFileSystem fs String policySet hfs getStoragePolicyName p
assertTrue CommonFSUtils isHDFS conf FileSystem fs FileSystem get conf Path testDir htu getDataTestDirOnTestFS fs mkdirs testDir String storagePolicy conf get HConstants WAL_STORAGE_POLICY HConstants DEFAULT_WAL_STORAGE_POLICY CommonFSUtils setStoragePolicy fs testDir storagePolicy String file htu getRandomUUID toString Path p Path testDir file WriteDataToHDFS fs p HFileSystem hfs HFileSystem fs String policySet hfs getStoragePolicyName p LOG debug p policySet HConstants String hdfsDefaultPolicy hfs getStoragePolicyName hfs getHomeDirectory
String hadoopVersion org apache hadoop util VersionInfo getVersion
TableName table TableName valueOf name getMethodName setupMobTable table assertEquals ROWKEYS length countRows admin flush table FileSystem fs FileSystem get conf Path mobFile getFlushedMobFile fs table admin disableTable table String corruptMobFile createMobFileName mobFile getName Path corrupt Path mobFile getParent corruptMobFile TestHFile truncateFile fs mobFile corrupt
List GarbageCollectorMXBean gcBeans ManagementFactory getGarbageCollectorMXBeans GarbageCollectorMXBean bean gcBeans ObjectName on bean getObjectName Object value JSONMetricUtil getValueFromMBean on
LOG info dataBlockEncoding isMultiPut numKeys numKeys Admin admin TEST_UTIL getAdmin admin
MiniHBaseCluster cluster TEST_UTIL getHBaseCluster HRegionServer regionServer cluster getRegionServer String rsName regionServer getServerName getAddress toString numRegions regionServer getNumberOfOnlineRegions RegionMoverBuilder rmBuilder RegionMoverBuilder rsName TEST_UTIL getConfiguration ack maxthreads rmBuilder
MiniHBaseCluster cluster TEST_UTIL getHBaseCluster HRegionServer regionServer cluster getRegionServer String rsName regionServer getServerName getAddress toString numRegions regionServer getNumberOfOnlineRegions RegionMoverBuilder rmBuilder RegionMoverBuilder rsName TEST_UTIL getConfiguration ack rmBuilder
FileWriter fos FileWriter excludeFile HRegionServer excludeServer cluster getRegionServer String excludeHostname excludeServer getServerName getHostname excludeServerPort excludeServer getServerName getPort regionsExcludeServer excludeServer getNumberOfOnlineRegions String excludeServerName excludeHostname Integer toString excludeServerPort fos write excludeServerName fos close HRegionServer regionServer cluster getRegionServer String rsName regionServer getServerName getHostname port regionServer getServerName getPort String rs rsName Integer toString port RegionMoverBuilder rmBuilder RegionMoverBuilder rs TEST_UTIL getConfiguration ack excludeFile excludeFile getCanonicalPath rm rmBuilder rm unload
excludeServerPort excludeServer getServerName getPort regionsExcludeServer excludeServer getNumberOfOnlineRegions String excludeServerName excludeHostname Integer toString excludeServerPort fos write excludeServerName fos close HRegionServer regionServer cluster getRegionServer String rsName regionServer getServerName getHostname port regionServer getServerName getPort String rs rsName Integer toString port RegionMoverBuilder rmBuilder RegionMoverBuilder rs TEST_UTIL getConfiguration ack excludeFile excludeFile getCanonicalPath rm rmBuilder rm unload LOG info rs assertEquals regionServer getNumberOfOnlineRegions assertEquals regionsExcludeServer cluster getRegionServer getNumberOfOnlineRegions
File designatedFile File TEST_UTIL getDataTestDir toUri getPath HRegionServer designatedServer cluster getRegionServer fos designatedFile String designatedHostname designatedServer getServerName getHostname designatedServerPort designatedServer getServerName getPort String excludeServerName designatedHostname designatedServerPort fos write excludeServerName regionsInDesignatedServer designatedServer getNumberOfOnlineRegions HRegionServer regionServer cluster getRegionServer String rsName regionServer getServerName getHostname port regionServer getServerName getPort String rs rsName port regionsInRegionServer regionServer getNumberOfOnlineRegions RegionMoverBuilder rmBuilder RegionMoverBuilder rs TEST_UTIL getConfiguration designatedFile designatedFile getCanonicalPath rmBuilder
designatedServerPort designatedServer getServerName getPort String excludeServerName designatedHostname designatedServerPort fos write excludeServerName regionsInDesignatedServer designatedServer getNumberOfOnlineRegions HRegionServer regionServer cluster getRegionServer String rsName regionServer getServerName getHostname port regionServer getServerName getPort String rs rsName port regionsInRegionServer regionServer getNumberOfOnlineRegions RegionMoverBuilder rmBuilder RegionMoverBuilder rs TEST_UTIL getConfiguration designatedFile designatedFile getCanonicalPath rm rmBuilder LOG debug rs rm unload assertEquals regionServer getNumberOfOnlineRegions assertEquals regionsInDesignatedServer regionsInRegionServer designatedServer getNumberOfOnlineRegions
regionsInDesignatedServer designatedServer getNumberOfOnlineRegions File excludeFile File TEST_UTIL getDataTestDir toUri getPath HRegionServer excludeServer cluster getRegionServer fos excludeFile String excludeHostname excludeServer getServerName getHostname excludeServerPort excludeServer getServerName getPort String excludeServerName excludeHostname excludeServerPort fos write excludeServerName regionsInExcludeServer excludeServer getNumberOfOnlineRegions HRegionServer targetRegionServer cluster getRegionServer String rsName targetRegionServer getServerName getHostname port targetRegionServer getServerName getPort String rs rsName port regionsInTargetRegionServer targetRegionServer getNumberOfOnlineRegions RegionMoverBuilder rmBuilder RegionMoverBuilder rs TEST_UTIL getConfiguration designatedFile designatedFile getCanonicalPath excludeFile excludeFile getCanonicalPath
String excludeServerName excludeHostname excludeServerPort fos write excludeServerName regionsInExcludeServer excludeServer getNumberOfOnlineRegions HRegionServer targetRegionServer cluster getRegionServer String rsName targetRegionServer getServerName getHostname port targetRegionServer getServerName getPort String rs rsName port regionsInTargetRegionServer targetRegionServer getNumberOfOnlineRegions RegionMoverBuilder rmBuilder RegionMoverBuilder rs TEST_UTIL getConfiguration designatedFile designatedFile getCanonicalPath excludeFile excludeFile getCanonicalPath rm rmBuilder LOG debug rs rm unload assertEquals targetRegionServer getNumberOfOnlineRegions assertEquals regionsInDesignatedServer regionsInTargetRegionServer designatedServer getNumberOfOnlineRegions LOG debug regionsInDesignatedServer designatedServer getNumberOfOnlineRegions
HRegionServer rsWithMeta TEST_UTIL getMiniHBaseCluster getRegionServerThreads stream map t t getRegionServer filter rs rs getRegions TableName META_TABLE_NAME size findFirst get onlineRegions rsWithMeta getNumberOfOnlineRegions String rsName rsWithMeta getServerName getAddress toString rsName TEST_UTIL
HRegionServer rsWithMeta TEST_UTIL getMiniHBaseCluster getRegionServerThreads stream map t t getRegionServer filter rs rs getRegions TableName META_TABLE_NAME size findFirst get onlineRegions rsWithMeta getNumberOfOnlineRegions String rsName rsWithMeta getServerName getAddress toString rm rsName TEST_UTIL LOG info rsWithMeta getServerName rm unload assertEquals rsWithMeta getNumberOfOnlineRegions
HRegionServer rs TEST_UTIL getMiniHBaseCluster getRegionServer String rsName rs getServerName getAddress toString Configuration conf Configuration TEST_UTIL getConfiguration conf setInt RegionMover SERVERSTART_WAIT_MAX_KEY String filename Path TEST_UTIL getDataTestDir toString RegionMover rsName conf filename filename
MiniHBaseCluster cluster TEST_UTIL getHBaseCluster HRegionServer excludeServer cluster getRegionServer List HRegion regions excludeServer getRegions regionsExcludeServer excludeServer getNumberOfOnlineRegions TEST_UTIL getAdmin decommissionRegionServers Collections singletonList excludeServer getServerName waitForServerDecom excludeServer HRegionServer regionServer cluster getRegionServer String rsName regionServer getServerName getHostname port regionServer getServerName getPort String hostname rsName Integer toString port RegionMoverBuilder rmBuilder RegionMoverBuilder hostname TEST_UTIL getConfiguration ack targetServerRegions cluster getRegionServer getRegions size sourceServerRegions regionServer getRegions size regionMover rmBuilder Assert assertTrue regionMover unload
regionsExcludeServer excludeServer getNumberOfOnlineRegions TEST_UTIL getAdmin decommissionRegionServers Collections singletonList excludeServer getServerName waitForServerDecom excludeServer HRegionServer regionServer cluster getRegionServer String rsName regionServer getServerName getHostname port regionServer getServerName getPort String hostname rsName Integer toString port RegionMoverBuilder rmBuilder RegionMoverBuilder hostname TEST_UTIL getConfiguration ack targetServerRegions cluster getRegionServer getRegions size sourceServerRegions regionServer getRegions size regionMover rmBuilder Assert assertTrue regionMover unload LOG info hostname assertEquals regionServer getNumberOfOnlineRegions assertEquals regionsExcludeServer cluster getRegionServer getNumberOfOnlineRegions
MiniHBaseCluster cluster TEST_UTIL getHBaseCluster HRegionServer excludeServer cluster getRegionServer List HRegion regions excludeServer getRegions regionsExcludeServer excludeServer getNumberOfOnlineRegions TEST_UTIL getAdmin decommissionRegionServers Collections singletonList excludeServer getServerName waitForServerDecom excludeServer HRegionServer sourceRegionServer cluster getRegionServer String rsName sourceRegionServer getServerName getHostname port sourceRegionServer getServerName getPort String hostname rsName Integer toString port RegionMoverBuilder rmBuilder RegionMoverBuilder hostname TEST_UTIL getConfiguration ack targetServerRegions cluster getRegionServer getRegions size sourceServerRegions sourceRegionServer getRegions size regionMover rmBuilder Assert assertTrue regionMover unload
regionsExcludeServer excludeServer getNumberOfOnlineRegions TEST_UTIL getAdmin decommissionRegionServers Collections singletonList excludeServer getServerName waitForServerDecom excludeServer HRegionServer sourceRegionServer cluster getRegionServer String rsName sourceRegionServer getServerName getHostname port sourceRegionServer getServerName getPort String hostname rsName Integer toString port RegionMoverBuilder rmBuilder RegionMoverBuilder hostname TEST_UTIL getConfiguration ack targetServerRegions cluster getRegionServer getRegions size sourceServerRegions sourceRegionServer getRegions size regionMover rmBuilder Assert assertTrue regionMover unload LOG info hostname assertEquals sourceRegionServer getNumberOfOnlineRegions assertEquals regionsExcludeServer cluster getRegionServer getNumberOfOnlineRegions
TableName tableName TableName valueOf name getMethodName MiniHBaseCluster cluster TEST_UTIL getHBaseCluster Admin admin TEST_UTIL getAdmin Table table TEST_UTIL getConnection getTable tableName List Put puts ArrayList i i i puts add Put Bytes toBytes i addColumn Bytes toBytes Bytes toBytes Bytes toBytes i table put puts admin flush tableName HRegionServer regionServer cluster getRegionServer String rsName regionServer getServerName getAddress toString numRegions regionServer getNumberOfOnlineRegions List HRegion hRegions regionServer getRegions stream filter hRegion hRegion getRegionInfo getTable equals tableName collect Collectors toList RegionMover RegionMoverBuilder rmBuilder RegionMover RegionMoverBuilder rsName TEST_UTIL getConfiguration ack maxthreads RegionMover rmBuilder
MiniHBaseCluster cluster TEST_UTIL getHBaseCluster Admin admin TEST_UTIL getAdmin Table table TEST_UTIL getConnection getTable tableName List Put puts ArrayList i i i puts add Put Bytes toBytes i addColumn Bytes toBytes Bytes toBytes Bytes toBytes i table put puts admin flush tableName admin compact tableName HRegionServer regionServer cluster getRegionServer String rsName regionServer getServerName getAddress toString numRegions regionServer getNumberOfOnlineRegions List HRegion hRegions regionServer getRegions stream filter hRegion hRegion getRegionInfo getTable equals tableName collect Collectors toList RegionMover RegionMoverBuilder rmBuilder RegionMover RegionMoverBuilder rsName TEST_UTIL getConfiguration ack maxthreads RegionMover rmBuilder
TableName tableName TableName valueOf name getMethodName MiniHBaseCluster cluster TEST_UTIL getHBaseCluster Admin admin TEST_UTIL getAdmin Table table TEST_UTIL getConnection getTable tableName List Put puts ArrayList i i i puts add Put Bytes toBytes i addColumn Bytes toBytes Bytes toBytes Bytes toBytes i table put puts admin flush tableName HRegionServer regionServer cluster getRegionServer String rsName regionServer getServerName getAddress toString numRegions regionServer getNumberOfOnlineRegions List HRegion hRegions regionServer getRegions stream filter hRegion hRegion getRegionInfo getTable equals tableName collect Collectors toList RegionMover RegionMoverBuilder rmBuilder RegionMover RegionMoverBuilder rsName TEST_UTIL getConfiguration ack maxthreads RegionMover rmBuilder
Admin admin TEST_UTIL getAdmin admin addRSGroup TEST_RSGROUP Collection ServerName allServers admin getRegionServers ServerName rsContainMeta TEST_UTIL getMiniHBaseCluster getRegionServerThreads stream map t t getRegionServer filter rs rs getRegions TableName META_TABLE_NAME size findFirst get getServerName
Address decommission rsservers get Address online rsservers get String filename Path TEST_UTIL getDataTestDir toString RegionMoverBuilder builder RegionMoverBuilder decommission toString TEST_UTIL getConfiguration builder filename filename
SimpleRange a SimpleRange Bytes toBytes Bytes toBytes SimpleRange b SimpleRange Bytes toBytes Bytes toBytes
algo numRegions s algo split numRegions
CommonFSUtils validateRootPath Path e LOG error HBaseMarkers FATAL e fail CommonFSUtils validateRootPath Path e LOG error HBaseMarkers FATAL e fail CommonFSUtils validateRootPath Path fail e
TEST_UTIL HBaseTestingUtility TEST_UTIL getConfiguration setInt TEST_UTIL startMiniCluster conf TEST_UTIL getConfiguration connection ConnectionFactory createConnection conf assertEquals TEST_UTIL getAdmin listTableDescriptors size table TableName valueOf TABLE_BASE tableIdx tableIdx htbl setupTable table populateTable htbl assertEquals scanMeta
htd List metaRows TEST_UTIL getMetaTableRows htd getTableName metaRows
e RegionInfo hri e getRegion ServerName hsa e getServerName hri hri LOG info hri getRegionNameAsString deleteRow hri getRegionName TEST_UTIL getAdmin unassign deleteRow LOG info hri toString hsa toString Path rootDir CommonFSUtils getRootDir conf FileSystem fs rootDir getFileSystem conf Path p Path CommonFSUtils getTableDir rootDir htd getTableName hri getEncodedName fs delete p meta Delete delete Delete deleteRow meta delete delete
RegionInfo Table htbl startKey endKey Table meta TEST_UTIL getConnection getTable TableName META_TABLE_NAME RegionInfo hri RegionInfoBuilder newBuilder htbl getName setStartKey startKey setEndKey endKey build
temp CONF getInt NUM_REGION_GROUPS DEFAULT_NUM_REGION_GROUPS WALFactory wals CONF setInt NUM_REGION_GROUPS temp CommonFSUtils setRootDir CONF TEST_UTIL getDataTestDirOnTestFS wals WALFactory CONF Set WAL seen HashSet temp count temp WAL maybeNewWAL wals getWAL RegionInfoBuilder newBuilder TableName valueOf ThreadLocalRandom current nextInt build
tableName TableName valueOf name getMethodName replaceAll
LOG info tableName Put p Put Bytes toBytes p addColumn fam Bytes toBytes Bytes toBytes table put p
LOG info tableName Put p Put Bytes toBytes p addColumn fam Bytes toBytes Bytes toBytes table put p LOG info tableName TEST_UTIL flush tableName
infos i RegionInfoBuilder newBuilder tableName setStartKey Bytes toBytes i setEndKey Bytes toBytes i build fs mkdirs Path tabledir infos i getEncodedName fs mkdirs Path tableDataDir infos i getEncodedName LOG info Path tabledir infos i getEncodedName toString NavigableMap Integer scopes TreeMap Bytes BYTES_COMPARATOR scopes put Bytes toBytes i i i WAL log wals getWAL infos i j j j WALEdit edit WALEdit family Bytes toBytes qualifier Bytes toBytes Integer toString j column Bytes toBytes Integer toString j edit add KeyValue rowName family qualifier System currentTimeMillis column
splits howmany assertEquals howmany howmany splits size splits size
MultiVersionConcurrencyControl mvcc MultiVersionConcurrencyControl i i i WALEdit kvs WALEdit kvs add KeyValue Bytes toBytes i tableName getName tableName getName wal appendData regionInfo WALKeyImpl regionInfo getEncodedNameAsBytes tableName System currentTimeMillis mvcc scopes kvs wal sync namenodePort cluster getNameNodePort Path walPath AbstractFSWALProvider getCurrentFileName wal DistributedFileSystem dfs cluster getFileSystem dfs setSafeMode HdfsConstants SafeModeAction SAFEMODE_ENTER TEST_UTIL shutdownMiniDFSCluster wal shutdown
Thread sleep assertFalse cluster isClusterUp cluster cluster TEST_UTIL startMiniDFSClusterForTestWAL namenodePort LOG info Threads sleep cluster waitActive fs cluster getFileSystem LOG info Method setLeasePeriod cluster getClass getDeclaredMethod Class Long TYPE Long TYPE setLeasePeriod setAccessible
List FileStatus List FileStatus result ArrayList FileStatus
numWriters Thread zombie ZombieLastLogWriterRegionServer counter stop region numWriters startCount counter get zombie start startCount counter get Threads sleep Threads sleep Configuration conf2 HBaseConfiguration create conf User robber User createUserForTesting conf2 ROBBER GROUP robber StringBuilder ls StringBuilder append WALDIR append status WALDIR ls append append status toString append LOG debug Objects toString ls
StringBuilder ls StringBuilder append WALDIR append status fs WALDIR ls append append status toString append LOG debug Objects toString ls LOG info numWriters WALSplitter split HBASELOGDIR WALDIR OLDLOGDIR fs conf2 wals LOG info Path logfiles getLogForRegion TABLE_NAME region assertEquals numWriters logfiles length count Path logfile logfiles count countWAL logfile count
RegionInfo hri RegionInfoBuilder newBuilder TABLE_NAME build REGIONS clear REGIONS add hri getEncodedName Path regionDir Path CommonFSUtils getTableDir HBASEDIR TABLE_NAME hri getEncodedName
LOG info String REGION REGIONS clear REGIONS add REGION generateWALs useDifferentDFSClient Path regiondir Path TABLEDIR REGION
String regionName Path regiondir Path TABLEDIR regionName REGIONS clear REGIONS add regionName generateWALs wals getWAL FileStatus logfiles fs listStatus WALDIR assertTrue logfiles logfiles length wals fs fs Writer Path logfile Writer writer wals createRecoveredEditsWriter walFS logfile NavigableSet Path files WALSplitUtil getSplitEditFilesSorted fs regiondir files files Path files walFS
REGIONS clear REGIONS add regionName generateWALs wals getWAL FileStatus logfiles fs listStatus WALDIR assertTrue logfiles logfiles length wals fs fs Writer Path logfile Writer writer wals createRecoveredEditsWriter walFS logfile NavigableSet Path files WALSplitUtil getSplitEditFilesSorted fs regiondir files files Path file files walFS file LOG error file
logSplitter wals fs fs Writer Path logfile Writer writer wals createRecoveredEditsWriter walFS logfile NavigableSet Path files WALSplitUtil getSplitEditFilesSorted fs regiondir files files Path file files walFS file LOG error file LOG debug file writer logSplitter splitWAL logfiles
Writer ws Writer writers seq numRegionEventsAdded i i writers i ws i wals createWALWriter fs Path WALDIR WAL_FILE_PREFIX i j j j prefix String region String row_key region prefix i j appendEntry ws i TABLE_NAME Bytes toBytes region Bytes toBytes row_key FAMILY QUALIFIER VALUE seq numRegionEventsAdded numRegionEventsAdded appendRegionEvent ws i region i ws i close
Configuration conf UTIL getConfiguration conf setBoolean WAL_SPLIT_TO_HFILE UTIL startMiniCluster Path hbaseRootDir UTIL getDFSCluster getFileSystem makeQualified Path
seqid region getOpenSeqNum first cfd td getColumnFamilies addRegionEdits ROW cfd getName countPerFamily ee region first region flush first Get g Get ROW Result result region get g assertEquals countPerFamily td getColumnFamilies length result size region close wal shutdown WALSplitter split rootDir logDir oldLogDir FileSystem get conf conf wals
customConf set DefaultStoreEngine DEFAULT_STORE_FLUSHER_CLASS_KEY AbstractTestWALReplay CustomStoreFlusher getName HRegion region HRegion openHRegion rootDir ri td wal customConf rsServices writtenRowCount List ColumnFamilyDescriptor families Arrays asList td getColumnFamilies i i writtenRowCount i Put put Put Bytes toBytes td getTableName Integer toString i put addColumn families get i families size getName Bytes toBytes Bytes toBytes region put put RegionScanner scanner region getScanner Scan assertEquals writtenRowCount getScannedCount scanner AbstractTestWALReplay CustomStoreFlusher throwExceptionWhenFlushing set region flush fail
wals wal WAL Reader reader wals createReader wal getFileSystem getConf wal count Map String Long sequenceIds HashMap WAL Entry e reader next e
totalTime tsec totalTime
htd wals roller RegionInfo regionInfo RegionInfoBuilder newBuilder htd getTableName build WAL wal wals getWAL regionInfo wal roller addWAL wal wal appends appends appends
conf selectorThreads conf getInt SELECTOR_THREADS_CONF_KEY getSelectorThreads workerThreads conf getInt WORKER_THREADS_CONF_KEY getWorkerThreads stopTimeoutVal conf getInt STOP_TIMEOUT_CONF_KEY getStopTimeoutVal acceptQueueSizePerThread conf getInt ACCEPT_QUEUE_SIZE_PER_THREAD_CONF_KEY getAcceptQueueSizePerThread AcceptPolicy acceptPolicy AcceptPolicy valueOf conf get ACCEPT_POLICY_CONF_KEY getAcceptPolicy toString toUpperCase Locale ROOT selectorThreads selectorThreads workerThreads workerThreads stopTimeoutVal stopTimeoutVal acceptQueueSizePerThread acceptQueueSizePerThread acceptPolicy acceptPolicy
failures Set FullyQualifiedRow keys countersMap keySet FullyQualifiedRow row keys Long counter countersMap remove row counter Table table table handler getTable row getTable failures IOException table incrementColumnValue row getRowKey row getFamily row getQualifier counter IOException failures
executorService shutdown msLeftToWait serverOptions stopTimeoutUnit toMillis serverOptions stopTimeoutVal timeMillis System currentTimeMillis
in_tableName TableName tableName getTableName in_tableName
String conf String String principal conf get THRIFT_SPNEGO_PRINCIPAL_KEY principal
String conf String keytab conf get THRIFT_SPNEGO_KEYTAB_FILE_KEY keytab
String excludeProtocols conf getStrings THRIFT_SSL_EXCLUDE_PROTOCOLS_KEY excludeProtocols sslCtxFactory setExcludeProtocols excludeProtocols String includeProtocols conf getStrings THRIFT_SSL_INCLUDE_PROTOCOLS_KEY ArrayUtils EMPTY_STRING_ARRAY includeProtocols sslCtxFactory setIncludeProtocols includeProtocols serverConnector ServerConnector httpServer SslConnectionFactory sslCtxFactory HttpVersion HTTP_1_1 toString HttpConnectionFactory httpsConfig serverConnector ServerConnector httpServer HttpConnectionFactory httpConfig serverConnector setPort listenPort serverConnector setHost getBindAddress conf getHostAddress httpServer addConnector serverConnector httpServer setStopAtShutdown ProxyUsers refreshSuperUserGroupsConfiguration conf
ac setAuthorizedID userName transportFactory saslFactory inProt outProt TSaslServerTransport saslServerTransport TSaslServerTransport inProt getTransport SaslServer saslServer saslServerTransport getSaslServer String principal saslServer getAuthorizationID hbaseServiceHandler setEffectiveUser principal processor process inProt outProt conf BIND_CONF_KEY implType LOG error Joiner on join ImplType serversThatCannotSpecifyBindIP RuntimeException BIND_CONF_KEY implType InetSocketAddress inetSocketAddress InetSocketAddress getBindAddress conf listenPort implType ImplType implType ImplType implType ImplType
LOG info infoServer stop ex LOG error ex pauseMonitor pauseMonitor stop tserver tserver stop tserver httpServer httpServer stop httpServer
cmd String option String cmd option String value cmd getOptionValue option
List String args ArrayList port HBaseTestingUtility randomFreePort args add Constants PORT_OPTION args add String valueOf port args add INFOPORT_OPTION infoPort HBaseTestingUtility randomFreePort args add String valueOf infoPort
conf type List String args ArrayList port HBaseTestingUtility randomFreePort args add Constants PORT_OPTION args add String valueOf port args add INFOPORT_OPTION infoPort HBaseTestingUtility randomFreePort args add String valueOf infoPort LOG info type port thriftServer createThriftServer conf type startThriftServerThread args toArray String args size waitForThriftServer
LOG debug thriftServer stop thriftServerThread join
clientSideException ThriftServerRunner tsr createBoundServer getThriftServerSupplier String url HConstants LOCALHOST tsr getThriftServer listenPort checkHttpMethods url talkToThriftServer url customHeaderSize ex clientSideException ex LOG info ex tsr close tsr join tsr
String url HConstants LOCALHOST tsr getThriftServer listenPort checkHttpMethods url talkToThriftServer url customHeaderSize ex clientSideException ex LOG info ex tsr close tsr join tsr getRunException LOG error tsr getRunException tsr getRunException clientSideException
name maybe metrics currentCount metricsHelper assertCounter name maybe metrics getSource
ThriftMetrics metrics getMetrics conf Hbase Iface handler getHandlerForMetricsTest metrics conf currentCountCreateTable getCurrentCount metrics currentCountDeleteTable getCurrentCount metrics currentCountDisableTable getCurrentCount metrics createTestTables handler dropTestTables handler metricsHelper assertCounter currentCountCreateTable metrics getSource metricsHelper assertCounter currentCountDeleteTable metrics getSource metricsHelper assertCounter currentCountDisableTable metrics getSource handler getTableNames metricsHelper assertGaugeGt metrics getSource metricsHelper assertGaugeLt metrics getSource
handler assertEquals handler getTableNames size handler createTable tableAname getColumnDescriptors assertEquals handler getTableNames size List TRegionInfo regions handler getTableRegions tableAname regionCount regions size assertEquals regionCount regionCount
Exception clientSideException clientSideException ThriftServerRunner thriftServerRunner createBoundServer getThriftServerSupplier implType specifyFramed specifyCompact specifyBindIP talkToThriftServer thriftServerRunner getThriftServer listenPort Exception ex clientSideException ex LOG info ex LOG debug implType simpleClassName thriftServerRunner close thriftServerRunner join thriftServerRunner
ThriftServerRunner thriftServerRunner createBoundServer getThriftServerSupplier implType specifyFramed specifyCompact specifyBindIP talkToThriftServer thriftServerRunner getThriftServer listenPort ex clientSideException ex LOG info ex LOG debug implType simpleClassName thriftServerRunner close thriftServerRunner join thriftServerRunner getRunException LOG error thriftServerRunner getRunException thriftServerRunner getRunException clientSideException
TEST_UTIL getConfiguration setInt THRIFT_INFO_SERVER_PORT TEST_UTIL startMiniCluster thriftPort HBaseTestingUtility randomFreePort httpPort HBaseTestingUtility randomFreePort thriftServer startThriftServer thriftPort thriftHttpServer startThriftServer httpPort thriftConnection createConnection thriftPort thriftHttpConnection createConnection httpPort thriftAdmin thriftConnection getAdmin LOG info TS_1
String errorMsg
tickTimeToUse TICK_TIME i currentClientPort clientPortList get i tentativePort selectClientPort tentativePort currentClientPort tentativePort ZooKeeperServer server ZooKeeperServer dir dir tickTimeToUse server setMinSessionTimeout configuration getInt server setMaxSessionTimeout configuration getInt NIOServerCnxnFactory standaloneServerFactory standaloneServerFactory NIOServerCnxnFactory standaloneServerFactory configure InetSocketAddress LOOPBACK_HOST currentClientPort configuration getInt HConstants ZOOKEEPER_MAX_CLIENT_CNXNS HConstants DEFAULT_ZOOKEEPER_MAX_CLIENT_CNXNS
tentativePort selectClientPort tentativePort currentClientPort tentativePort ZooKeeperServer server ZooKeeperServer dir dir tickTimeToUse server setMinSessionTimeout configuration getInt server setMaxSessionTimeout configuration getInt NIOServerCnxnFactory standaloneServerFactory standaloneServerFactory NIOServerCnxnFactory standaloneServerFactory configure InetSocketAddress LOOPBACK_HOST currentClientPort configuration getInt HConstants ZOOKEEPER_MAX_CLIENT_CNXNS HConstants DEFAULT_ZOOKEEPER_MAX_CLIENT_CNXNS e LOG debug currentClientPort e tentativePort selectClientPort tentativePort
activeZKServerIndex NIOServerCnxnFactory standaloneServerFactory standaloneServerFactoryList get activeZKServerIndex clientPort clientPortList get activeZKServerIndex standaloneServerFactory shutdown clientPort IOException zooKeeperServers get activeZKServerIndex getZKDatabase close standaloneServerFactoryList remove activeZKServerIndex clientPortList remove activeZKServerIndex zooKeeperServers remove activeZKServerIndex LOG info clientPort standaloneServerFactoryList clientPort clientPortList get activeZKServerIndex
leaderExists set
startTime System currentTimeMillis remaining timeout refresh data ZKUtil getDataAndWatch watcher node e LOG warn e abortable abort e nodeExistsChecked refresh data remaining data nodeExistsChecked nodeExistsChecked ZKUtil checkExists watcher node e LOG warn node e
zkw znode Stat s zkw getRecoverableZooKeeper exists znode zkw exists s exists
conf LOG info String parentZNode conf get HConstants ZOOKEEPER_ZNODE_PARENT HConstants DEFAULT_ZOOKEEPER_ZNODE_PARENT ZooKeeper zk ZooKeeper ZKConfig getZKQuorumServersString conf conf getInt HConstants ZK_SESSION_TIMEOUT HConstants DEFAULT_ZK_SESSION_TIMEOUT EmptyWatcher instance maxTimeMs maxNumAttempts maxTimeMs HConstants SOCKET_RETRY_WAIT_MS KeeperException keeperEx maxNumAttempts zk parentZNode
LOG debug String superUsers conf getStrings Superusers SUPERUSER_CONF_KEY superUsers superUsers String hbaseUser UserGroupInformation getCurrentUser getShortUserName LOG LOG debug acl perms acl getPerms Id id acl getId id perms LOG
String hbaseUser UserGroupInformation getCurrentUser getShortUserName LOG LOG debug acl perms acl getPerms Id id acl getId id perms Perms READ LOG LOG debug String format id perms Perms READ id perms Perms
Id id acl getId id perms Perms READ LOG LOG debug String format id perms Perms READ id perms Perms ALL LOG LOG debug String format id perms Perms ALL id String name id getId Matcher match NAME_PATTERN matcher name match
LOG debug String format id perms Perms READ id perms Perms ALL LOG LOG debug String format id perms Perms ALL id String name id getId Matcher match NAME_PATTERN matcher name match name match group name perms Perms ALL LOG
id perms Perms ALL LOG LOG debug String format id perms Perms ALL id String name id getId Matcher match NAME_PATTERN matcher name match name match group name perms Perms ALL LOG LOG debug String format id perms Perms ALL
MockLeader currentLeader getCurrentLeader assertNotNull currentLeader
MockLeader currentLeader getCurrentLeader assertNotNull currentLeader LOG debug currentLeader getIndex znodeData ZKUtil getData currentLeader getWatcher LEADER_ZNODE assertNotNull znodeData assertTrue znodeData length storedIndex Bytes toInt znodeData
MockLeader currentLeader getCurrentLeader assertNotNull currentLeader LOG debug currentLeader getIndex znodeData ZKUtil getData currentLeader getWatcher LEADER_ZNODE assertNotNull znodeData assertTrue znodeData length storedIndex Bytes toInt znodeData LOG debug storedIndex assertEquals currentLeader getIndex storedIndex currentLeader abdicate currentLeader getCurrentLeader assertNotNull currentLeader
LOG debug currentLeader getIndex znodeData ZKUtil getData currentLeader getWatcher LEADER_ZNODE assertNotNull znodeData assertTrue znodeData length storedIndex Bytes toInt znodeData LOG debug storedIndex assertEquals currentLeader getIndex storedIndex currentLeader abdicate currentLeader getCurrentLeader assertNotNull currentLeader LOG debug currentLeader getIndex znodeData ZKUtil getData currentLeader getWatcher LEADER_ZNODE assertNotNull znodeData assertTrue znodeData length storedIndex Bytes toInt znodeData
LOG debug storedIndex assertEquals currentLeader getIndex storedIndex currentLeader abdicate currentLeader getCurrentLeader assertNotNull currentLeader LOG debug currentLeader getIndex znodeData ZKUtil getData currentLeader getWatcher LEADER_ZNODE assertNotNull znodeData assertTrue znodeData length storedIndex Bytes toInt znodeData LOG debug storedIndex assertEquals currentLeader getIndex storedIndex currentLeader stop currentLeader getCurrentLeader assertNotNull currentLeader
LOG debug currentLeader getIndex znodeData ZKUtil getData currentLeader getWatcher LEADER_ZNODE assertNotNull znodeData assertTrue znodeData length storedIndex Bytes toInt znodeData LOG debug storedIndex assertEquals currentLeader getIndex storedIndex currentLeader stop currentLeader getCurrentLeader assertNotNull currentLeader LOG debug currentLeader getIndex znodeData ZKUtil getData currentLeader getWatcher LEADER_ZNODE assertNotNull znodeData assertTrue znodeData length storedIndex Bytes toInt znodeData
