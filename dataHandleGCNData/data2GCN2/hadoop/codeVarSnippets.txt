File dirPath File dir File dirPath dir
InputStream inputStream store retrieveBlock key readBuffer getStart readBuffer getEnd IOUtils readFully inputStream readBuffer getBuffer readBuffer getBuffer length inputStream close readBuffer setStatus CosNInputStream ReadBuffer SUCCESS e readBuffer setStatus CosNInputStream ReadBuffer ERROR LOG warn String valueOf readBuffer getStart readBuffer getEnd retryAction retryPolicy shouldRetry e retries retryAction Thread sleep retryAction delayMillis String errMsg String format retryPolicy toString String valueOf readBuffer getStart String valueOf readBuffer getEnd
String userName System getProperty String command userName command userName Process child Runtime getRuntime exec command child waitFor InputStream in child getInputStream StringBuilder strBuffer StringBuilder c c in strBuffer append c in close ownerInfoId strBuffer toString
key PATH_DELIMITER key PATH_DELIMITER f String errMsg String format f IOException errMsg createParent f String priorLastKey PartialListing listing store list key Constants COS_MAX_LISTING_LENGTH priorLastKey file listing store delete file getKey commonPrefix listing store delete commonPrefix getKey priorLastKey listing getPriorLastKey priorLastKey
f String errMsg String format f IOException errMsg createParent f String priorLastKey PartialListing listing store list key Constants COS_MAX_LISTING_LENGTH priorLastKey file listing store delete file getKey commonPrefix listing store delete commonPrefix getKey priorLastKey listing getPriorLastKey priorLastKey store delete key
LOG debug f FileMetadata meta store retrieveMetadata key meta meta LOG debug f key newFile meta absolutePath LOG debug f key newDirectory meta absolutePath key PATH_DELIMITER key PATH_DELIMITER LOG debug key PartialListing listing store list key listing listing LOG
String key pathToKey absolutePath key FileStatus fileStatus getFileStatus f fileStatus FileStatus fileStatus key PATH_DELIMITER key PATH_DELIMITER URI pathUri absolutePath toUri Set FileStatus status TreeSet String priorLastKey PartialListing listing store list key Constants COS_MAX_LISTING_LENGTH priorLastKey fileMetadata listing Path subPath keyToPath fileMetadata getKey fileMetadata getKey key
List Path paths ArrayList paths add absolutePath absolutePath absolutePath getParent absolutePath Path path paths path Path FileStatus fileStatus getFileStatus path fileStatus FileAlreadyExistsException String format f fileStatus
LOG debug dstParentPath dstParentPath LOG debug src dst IOException String format src dst FileStatus dstFileStatus dstFileStatus getFileStatus dst dstFileStatus FileAlreadyExistsException String format dstFileStatus getPath dst Path dst src getName FileStatus statuses statuses listStatus dst
Path path Path parent path getParent parent String parentKey pathToKey parent
PartETag partETag blockWritten LOG info currentBlockId blockWritten partETag store uploadPart ByteBufferInputStream currentBlockBuffer getByteBuffer key uploadId currentBlockId currentBlockBuffer getByteBuffer remaining List PartETag futurePartETagList waitForFinishPartUploads futurePartETagList IOException List PartETag tmpPartEtagList LinkedList futurePartETagList partETag tmpPartEtagList add partETag store completeMultipartUpload key uploadId tmpPartEtagList BufferPool getInstance returnBuffer currentBlockBuffer
key inputStream md5Hash length ObjectMetadata objectMetadata ObjectMetadata objectMetadata setContentMD5 Base64 encodeAsString md5Hash objectMetadata setContentLength length PutObjectRequest putObjectRequest PutObjectRequest bucketName key inputStream objectMetadata PutObjectResult putObjectResult PutObjectResult callCOSClientWithRetry putObjectRequest
String prefix String delimiter maxListingLength String priorLastKey LOG debug prefix delimiter maxListingLength priorLastKey prefix CosNFileSystem PATH_DELIMITER prefix CosNFileSystem PATH_DELIMITER ListObjectsRequest listObjectsRequest ListObjectsRequest listObjectsRequest setBucketName bucketName listObjectsRequest setPrefix prefix listObjectsRequest setDelimiter delimiter listObjectsRequest setMarker priorLastKey listObjectsRequest setMaxKeys maxListingLength ObjectListing objectListing objectListing ObjectListing callCOSClientWithRetry listObjectsRequest e String errMsg String format prefix delimiter delimiter maxListingLength priorLastKey e toString
request ListObjectsRequest sdkMethod cosClient listObjects ListObjectsRequest request IOException cse String errMsg String format retryIndex maxRetryTimes sdkMethod cse toString statusCode cse getStatusCode statusCode retryIndex maxRetryTimes LOG info errMsg sleepLeast retryIndex sleepBound retryIndex request
cse String errMsg String format retryIndex maxRetryTimes sdkMethod cse toString statusCode cse getStatusCode statusCode retryIndex maxRetryTimes LOG info errMsg sleepLeast retryIndex sleepBound retryIndex request UploadPartRequest UploadPartRequest request getInputStream UploadPartRequest request getInputStream reset Thread sleep ThreadLocalRandom current nextLong sleepLeast sleepBound retryIndex
Path seekTestFilePath Path testRootDir fileSize Unit MB ContractTestUtils generateTestFile fs seekTestFilePath fileSize LOG info FSDataInputStream inputStream fs open seekTestFilePath seekTimes i i seekTimes i pos fileSize seekTimes i inputStream seek pos assertTrue pos inputStream getPos inputStream getPos pos
Path seekTestFilePath Path testRootDir fileSize Unit MB ContractTestUtils generateTestFile fs seekTestFilePath fileSize LOG info FSDataInputStream inputStream fs open seekTestFilePath seekTimes i i seekTimes i pos fileSize seekTimes i inputStream seek pos assertTrue pos inputStream getPos inputStream getPos pos LOG info inputStream getPos LOG info Random random Random i i seekTimes i pos Math abs random nextLong fileSize
LOG info FSDataInputStream inputStream fs open seekTestFilePath seekTimes i i seekTimes i pos fileSize seekTimes i inputStream seek pos assertTrue pos inputStream getPos inputStream getPos pos LOG info inputStream getPos LOG info Random random Random i i seekTimes i pos Math abs random nextLong fileSize LOG info pos inputStream seek pos assertTrue pos inputStream getPos inputStream getPos pos
bufLen Path readTestFilePath Path testRootDir fileSize Unit MB ContractTestUtils generateTestFile fs readTestFilePath fileSize
LOG info readTestFilePath FSDataInputStream inputStream fs open readTestFilePath buf bufLen bytesRead bytesRead fileSize bytes fileSize bytesRead bufLen remaining fileSize bytesRead bytes inputStream read buf remaining bytes inputStream read buf bufLen bytesRead bytes bytesRead available inputStream available assertTrue fileSize bytesRead available fileSize bytesRead available
request response unauthorizedResponse errCode HttpServletResponse SC_UNAUTHORIZED AuthenticationException authenticationEx HttpServletRequest httpRequest HttpServletRequest request HttpServletResponse httpResponse HttpServletResponse response isHttps equals httpRequest getScheme newToken AuthenticationToken token token getToken httpRequest
isHttps equals httpRequest getScheme newToken AuthenticationToken token token getToken httpRequest LOG LOG debug token getRequestURL httpRequest ex LOG warn ex getMessage authenticationEx ex token token httpRequest token LOG
LOG warn ex getMessage authenticationEx ex token authHandler token httpRequest httpResponse token LOG LOG debug getRequestURL httpRequest authHandler getClass token authHandler authenticate httpRequest httpResponse token token token token setMaxInactives System currentTimeMillis getMaxInactiveInterval token token setExpires System currentTimeMillis getValidity newToken token
token unauthorizedResponse LOG LOG debug getRequestURL httpRequest token getUserName AuthenticationToken authToken token httpRequest httpRequest authToken getType authToken getUserName authToken AuthenticationToken ANONYMOUS authToken getMaxInactiveInterval token setMaxInactives System currentTimeMillis getMaxInactiveInterval
AuthenticationToken HttpServletRequest request AuthenticationToken token String serializedJWT HttpServletRequest req HttpServletRequest request serializedJWT getJWTFromCookie req serializedJWT String loginURL constructLoginURL request
HttpServletRequest req HttpServletRequest request serializedJWT getJWTFromCookie req serializedJWT String loginURL constructLoginURL request LOG info loginURL HttpServletResponse response sendRedirect loginURL String userName SignedJWT jwtToken valid jwtToken SignedJWT parse serializedJWT valid validateToken jwtToken valid userName jwtToken getJWTClaimsSet getSubject
String req String serializedJWT Cookie cookies req getCookies cookies Cookie cookies
keytab keytab ServletException File keytabFile File keytab keytabFile ServletException keytab String spnegoPrincipals principal spnegoPrincipals KerberosUtil getPrincipalNames keytab Pattern compile spnegoPrincipals ServletException spnegoPrincipals String principal KeyTab keytabInstance KeyTab getInstance keytabFile serverSubject getPrivateCredentials add keytabInstance String spnegoPrincipals
env put Context INITIAL_CONTEXT_FACTORY env put Context PROVIDER_URL providerUrl ctx InitialLdapContext env StartTlsResponse tls StartTlsResponse ctx extendedOperation StartTlsRequest tls tls negotiate ctx addToEnvironment Context SECURITY_AUTHENTICATION SECURITY_AUTHENTICATION ctx addToEnvironment Context SECURITY_PRINCIPAL userDN ctx addToEnvironment Context SECURITY_CREDENTIALS password ctx lookup userDN
String userDN String password Hashtable String Object env Hashtable String Object env put Context INITIAL_CONTEXT_FACTORY env put Context PROVIDER_URL providerUrl env put Context SECURITY_AUTHENTICATION SECURITY_AUTHENTICATION env put Context SECURITY_PRINCIPAL userDN env put Context SECURITY_CREDENTIALS password Context ctx InitialDirContext env ctx close
authHandlerClassName Preconditions checkNotNull authHandlerClassName
AuthenticationHandler authHandlerClassName config Preconditions checkNotNull authHandlerClassName logger debug authHandlerClassName Class klass Thread currentThread getContextClassLoader loadClass authHandlerClassName AuthenticationHandler authHandler AuthenticationHandler klass newInstance authHandler init config
name DeprecatedKeyInfo keyInfo getDeprecatedKeyInfo name keyInfo keyInfo
name URL url getResource name url
name URL url getResource name url
XMLStreamReader2 reader getStreamReader wrapper quiet reader quiet RuntimeException resource Properties toAddTo properties toAddTo Properties List ParsedItem items Parser reader wrapper quiet parse ParsedItem item items loadProperty toAddTo item name item key item value item isFinal item sources reader close overlay properties toAddTo Resource toAddTo name wrapper isParserRestricted
RuntimeException resource Properties toAddTo properties toAddTo Properties List ParsedItem items Parser reader wrapper quiet parse ParsedItem item items loadProperty toAddTo item name item key item value item isFinal item sources reader close overlay properties toAddTo Resource toAddTo name wrapper isParserRestricted e LOG error name e
String get String name String value get name
String get String name String defaultValue String value get name defaultValue
getBoolean name defaultValue value getBoolean name defaultValue
getFloat name defaultValue value getFloat name defaultValue
getInt name defaultValue value getInt name defaultValue
getLong name defaultValue value getLong name defaultValue
req LOG info req getServletPath
String rawParam params nextElement String param StringEscapeUtils unescapeHtml4 rawParam String value StringEscapeUtils unescapeHtml4 req getParameter rawParam value value getRaw param value value value value value value oldConf getRaw param out println StringEscapeUtils escapeHtml4 param StringEscapeUtils escapeHtml4 oldConf getRaw param reconf reconfigureProperty param value value value oldConf getRaw param oldConf getRaw param value oldConf getRaw param out println StringEscapeUtils escapeHtml4 param StringEscapeUtils escapeHtml4 value out println StringEscapeUtils escapeHtml4 param StringEscapeUtils escapeHtml4 oldConf getRaw param StringEscapeUtils escapeHtml4 value reconf reconfigureProperty param value
conf conf conf Class Random klass conf getClass HADOOP_SECURITY_SECURE_RANDOM_IMPL_KEY OpensslSecureRandom Random random ReflectionUtils newInstance klass conf
FsPermission pathToLoad FsPermission perm perm loadFromPath pathToLoad password renameOrFail pathToLoad path
T T conn jsonOutput T T ret OutputStream os jsonOutput os conn getOutputStream writeJson jsonOutput os ex os conn disconnect IOUtils closeStream conn getInputStream ex conn conn conn conn
Token creds service Token token creds getToken service
Token String URL url createURL DelegationTokenAuthenticatedURL authUrl DelegationTokenAuthenticatedURL configurator Token token String doAsUser getDoAsUser token Token Token
Token dToken String doAsUser getDoAsUser DelegationTokenAuthenticatedURL Token token generateDelegationToken dToken URL url createURL
Token dToken String doAsUser getDoAsUser DelegationTokenAuthenticatedURL Token token generateDelegationToken dToken URL url createURL
ugi Credentials creds ugi getCredentials creds
Token getDelegationToken renewer Token Token provider Token token provider getDelegationToken renewer token setService dtService
b off len count pos read retry retriesLeft numOfRetries retriesLeft read readChunk chunkPos b off len checksum read verifySums b off read chunkPos read retry
LOGGER debug FileSystem ServiceLoader FileSystem serviceLoader ServiceLoader load FileSystem Iterator FileSystem it serviceLoader iterator it FileSystem fs fs it next SERVICE_FILE_SYSTEMS put fs getScheme fs getClass LOGGER
LOGGER debug FileSystem ServiceLoader FileSystem serviceLoader ServiceLoader load FileSystem Iterator FileSystem it serviceLoader iterator it FileSystem fs fs it next SERVICE_FILE_SYSTEMS put fs getScheme fs getClass LOGGER LOGGER debug fs getScheme fs getClass ClassUtil findContainingJar fs getClass LOGGER warn fs ClassUtil findContainingJar fs getClass
Class FileSystem String scheme conf loadFileSystems LOGGER debug scheme Class FileSystem clazz conf String property scheme LOGGER debug property clazz Class FileSystem conf getClass property LOGGER debug scheme clazz LOGGER debug clazz SERVICE_FILE_SYSTEMS get scheme
LOGGER debug scheme Class FileSystem clazz conf String property scheme LOGGER debug property clazz Class FileSystem conf getClass property LOGGER debug scheme clazz LOGGER debug clazz SERVICE_FILE_SYSTEMS get scheme LOGGER debug scheme clazz UnsupportedFileSystemException scheme
String command ExecutorService executor ProcessBuilder builder ProcessBuilder builder command Shell WINDOWS Shell WINDOWS command Process process builder start exitCode executor Executors newFixedThreadPool executor process String line line
builder command Shell WINDOWS Shell WINDOWS command Process process builder start exitCode executor Executors newFixedThreadPool executor LOG process getInputStream String line line LOG debug line org apache commons io IOUtils copy process getInputStream IOUtils NullOutputStream
process getInputStream String line line LOG debug line org apache commons io IOUtils copy process getInputStream IOUtils NullOutputStream e LOG debug e getMessage LOG process String line line
org apache commons io IOUtils copy process getInputStream IOUtils NullOutputStream e LOG debug e getMessage LOG process getErrorStream String line line LOG debug line org apache commons io IOUtils copy process getErrorStream IOUtils NullOutputStream e
ShellCommandExecutor shExec linkFile getParentFile shExec ShellCommandExecutor cmd linkFile getParentFile shExec ShellCommandExecutor cmd shExec execute ec returnVal ec getExitCode returnVal LOG warn returnVal LOG warn StringUtils join cmd returnVal ec getMessage returnVal
URI srcUri srcFs getUri URI dstUri destFs getUri srcUri srcUri dstUri String srcHost srcUri getHost String dstHost dstUri getHost srcHost dstHost srcHost dstHost srcUri getPort dstUri getPort srcHost InetAddress getByName srcHost getCanonicalHostName dstHost InetAddress getByName dstHost getCanonicalHostName
args length args args substring scope getSpan addKVAnnotation args exitCode instance run Arrays copyOfRange argv argv length scope close e e displayError cmd e printStackTrace System err displayError cmd e getLocalizedMessage printUsage System err instance
protocol LOG debug protocol protocol known Class FileSystem impl FileSystem getFileSystemClass protocol conf
String scheme schemeFromPath pathPattern String authority authorityFromPath pathPattern String pathPatternString pathPattern toUri getPath List String flattenedPatterns GlobExpander expand pathPatternString
FileStatus String scheme schemeFromPath pathPattern String authority authorityFromPath pathPattern String pathPatternString pathPattern toUri getPath List String flattenedPatterns GlobExpander expand pathPatternString LOG debug pathPatternString ArrayList FileStatus results ArrayList flattenedPatterns size sawWildcard String flatPattern flattenedPatterns Path absPattern fixRelativePart Path flatPattern isEmpty Path CUR_DIR flatPattern
ArrayList FileStatus newCandidates ArrayList candidates size GlobFilter globFilter GlobFilter components get componentIdx String component unescapePathComponent components get componentIdx globFilter sawWildcard LOG debug component sawWildcard candidates sawWildcard componentIdx components size globFilter FileStatus candidate candidates candidate setPath Path candidate getPath component FileStatus candidate candidates globFilter FileStatus children listStatus candidate getPath
FileStatus candidate candidate setPath Path candidate getPath component FileStatus candidate FileStatus children listStatus candidate getPath children LOG debug children Path path candidate getPath FileStatus status getFileStatus path status
dst dstFile FileStatus sdst getFileStatus dst String dstFileList dstFile list dstFileList sdst dstFileList
e Path existsFilePath baseTrashPath existsFilePath existsFilePath existsFilePath getParent baseTrashPath Path baseTrashPath toString replace existsFilePath toString existsFilePath toString Time now trashPath Path baseTrashPath trashPath getName i e LOG warn baseTrashPath e cause e String orig trashPath toString trashPath
Collection FileStatus trashRoots fs getTrashRoots FileStatus trashRoots
Collection FileStatus trashRoots fs getTrashRoots FileStatus trashRoots
now Time now i i dirs i Path path dirs i getPath String dir path toUri getPath String name path getName name getName time time getTimeFromCheckpoint name LOG warn dir now time
curVersion higherVersion curVersion Integer parseInt nameParts nameParts length logInvalidFileNameFormat cur curVersion higherVersion higherVersion curVersion lfs curLfs lfs LOGGER warn mountTableConfigPath Path latestVersionMountTable lfs getPath LOGGER
dstNode dstNode status srcNode dstNode FileStatus srcStatus srcNode cloneStatus srcStatus setPath f Path tmpPath getNflyTmpPath f FileUtil copy srcNode getFs srcStatus dstNode getFs tmpPath getConf dstNode getFs delete f dstNode getFs tmpPath f dstNode getFs setTimes f srcNode status getModificationTime srcNode status getAccessTime srcStatus setPath dstNode getFs makeQualified f dstNode status srcStatus
dstNode getFs setTimes f srcNode status getModificationTime srcNode status getAccessTime srcStatus setPath dstNode getFs makeQualified f dstNode status srcStatus ioe LOG info f srcNode dstNode ioe List MRNflyNode mrList ArrayList MRNflyNode MRNflyNode openNode openNode status openNode status openNode status getModificationTime mrList add openNode MRNflyNode readNodes mrList toArray MRNflyNode topology sortByDistance myNode readNodes readNodes length MRNflyNode readNodes
theUri myUri theUri
ctx isStaleClient ctx
LOG LOG debug rc path zkConnectionState Code code Code get rc code monitorActiveStatus reJoinElectionAfterFailureToBecomeActive code becomeStandby monitorActiveStatus String errorMessage code toString path
Code code Code get rc code monitorActiveStatus reJoinElectionAfterFailureToBecomeActive code becomeStandby monitorActiveStatus String errorMessage code toString path LOG debug errorMessage code
zk event Event EventType eventType event getType isStaleClient zk
reJoinElection event String path event getPath path enterNeutralMode joinElectionInternal
tryFence fromSvc tryFence forceFence tryFence fromSvc fromSvc toSvc FailoverFailedException fromSvc failed Throwable cause HAServiceProtocolHelper transitionToActive toSvc getProxy conf rpcTimeoutToNewActive createReqInfo sfe LOG error toSvc sfe getMessage failed cause sfe
Throwable cause HAServiceProtocolHelper transitionToActive toSvc getProxy conf rpcTimeoutToNewActive createReqInfo sfe LOG error toSvc sfe getMessage failed cause sfe ioe LOG error toSvc ioe failed cause ioe failed String msg toSvc
LOG info i method methods LOG info i methods size method toSvcFencingFailed toSvc toSvcFencingFailed method method tryFence toSvc method arg toSvcFencingFailed LOG error method method tryFence method arg LOG info method
LOG info i methods size method toSvcFencingFailed toSvc toSvcFencingFailed method method tryFence toSvc method arg toSvcFencingFailed LOG error method method tryFence method arg LOG info method e LOG error method e
String String processName String host LOG info processName host String ps1script BufferedWriter writer File file File createTempFile file deleteOnExit FileOutputStream fos FileOutputStream file OutputStreamWriter osw OutputStreamWriter fos StandardCharsets UTF_8 writer BufferedWriter osw String filter StringUtils join String processName String cmd cmd filter cmd host cmd
File file File createTempFile file deleteOnExit FileOutputStream fos FileOutputStream file OutputStreamWriter osw OutputStreamWriter fos StandardCharsets UTF_8 writer BufferedWriter osw String filter StringUtils join String processName String cmd cmd filter cmd host cmd LOG info cmd writer write cmd writer flush ps1script file getAbsolutePath
String cmd cmd filter cmd host cmd LOG info cmd writer write cmd writer flush ps1script file getAbsolutePath ioe LOG error ioe writer writer close ioe
String cmd parseArgs target getTransitionTargetHAStatus args builder ProcessBuilder cmd builder ProcessBuilder cmd setConfAsEnvVars builder environment addTargetInfoAsEnvVars target builder environment Process p p builder start p getOutputStream close e LOG warn cmd e String pid tryGetPid p
serviceAddr port serviceAddr getPort
session serviceAddr port serviceAddr getPort LOG info port rc execCommand session port rc
InputStreamReader inputStreamReader InputStreamReader stream StandardCharsets UTF_8 BufferedReader br BufferedReader inputStreamReader String line line br
force args i interactive badArg args i formatZK force interactive badArg args e LOG error e e LOG error ERR_CODE_NO_PARENT_ZNODE
formatZK force interactive badArg args e LOG error e e LOG error ERR_CODE_NO_PARENT_ZNODE localTarget checkFencingConfigured e LOG error localTarget e ERR_CODE_NO_FENCER
InetSocketAddress bindAddr getRpcAddressToBindTo
LOG info localTarget HAServiceProtocolHelper transitionToActive localTarget getProxy conf FailoverController getRpcTimeoutToNewActive conf createReqInfo String msg localTarget
LOG info localTarget timeout FailoverController getGracefulFenceTimeout conf localTarget getProxy conf timeout transitionToStandby createReqInfo
target LOG info target gracefulWorked FailoverController conf RequestSource REQUEST_BY_ZKFC tryGracefulFence target gracefulWorked
isLog4JLogger logger Log4JLogger err LOG debug err isLog4JLogger isLog4JLogger Log4JLogger httpLog4JLog Log4JLogger logger org apache log4j Logger httpLogger httpLog4JLog getLogger Appender appender appender httpLogger getAppender appenderName e LOG warn loggerName e
name clazz params ServletHolder sh ServletHolder clazz sh setName name sh setInitParameters params ServletMapping servletMappings webAppContext getServletHandler getServletMappings servletMappings servletMappings
String name String classname String String parameters FilterHolder filterHolder getFilterHolder name classname parameters String userFacingUrls FilterMapping fmap getFilterMapping name userFacingUrls defineFilter webAppContext filterHolder fmap
String name String classname String String parameters FilterHolder filterHolder getFilterHolder name classname parameters String userFacingUrls FilterMapping fmap getFilterMapping name userFacingUrls defineFilter webAppContext filterHolder fmap LOG info name classname webAppContext getDisplayName String ALL_URLS fmap getFilterMapping name ALL_URLS ServletContextHandler e e ServletContextHandler ctx e getKey defineFilter ctx filterHolder fmap
listener listener close listener open
c close e LOG error webAppContext getDisplayName e exception addMultiException exception e secretProvider destroy webAppContext clearAttributes webAppContext stop e LOG error webAppContext getDisplayName e exception addMultiException exception e webServer stop e
Compressor codec Compressor compressor borrow compressorPool codec getCompressorType compressor compressor codec createCompressor
Decompressor codec Decompressor decompressor borrow decompressorPool codec getDecompressorType decompressor decompressor codec createDecompressor
RawErasureCoderFactory RawErasureCoderFactory coderFactory String codecName coderFactory getCodecName List RawErasureCoderFactory coders coderMap get codecName coders coders ArrayList coders add coderFactory coderMap put codecName coders
checked reinitCodecInTests checked reinitCodecInTests conf getBoolean clazz getLzoCodecClass
Object invokeMethod method Object args Object result invokeMethod method args retryCount RetryCount get retryCount RetryCount set retryCount
RetryInfo method policy counters expectFailoverCount e RetryInfo retryInfo RetryInfo newRetryInfo policy e counters proxyDescriptor idempotentOrAtMostOnce method expectFailoverCount retryInfo retryInfo
method isFailover failovers delay ex info failedAtLeastOnce proxyDescriptor getProxyInfo toString failedAtLeastOnce add proxyDescriptor getProxyInfo toString info hasSuccessfulCall asyncCallHandler hasSuccessfulCall info LOG StringBuilder b StringBuilder append ex append proxyDescriptor getProxyInfo getString method getName failovers b append append failovers append b append isFailover b append delay delay info LOG info b toString
RetryPolicy conf retryPolicyEnabledKey defaultRetryPolicyEnabled retryPolicySpecKey defaultRetryPolicySpec RetryPolicy multipleLinearRandomRetry getMultipleLinearRandomRetry conf retryPolicyEnabledKey defaultRetryPolicyEnabled retryPolicySpecKey defaultRetryPolicySpec
LOG debug totalDecayedCost totalRawCost Iterator Map Entry Object List AtomicLong it callCosts entrySet iterator it Map Entry Object List AtomicLong entry it next AtomicLong decayedCost entry getValue get AtomicLong rawCost entry getValue get totalRawCost rawCost get currentValue decayedCost get nextValue currentValue decayFactor totalDecayedCost nextValue decayedCost set nextValue
totalDecayedCost totalRawCost Iterator Map Entry Object List AtomicLong it callCosts entrySet iterator it Map Entry Object List AtomicLong entry it next AtomicLong decayedCost entry getValue get AtomicLong rawCost entry getValue get totalRawCost rawCost get currentValue decayedCost get nextValue currentValue decayFactor totalDecayedCost nextValue decayedCost set nextValue LOG debug entry getKey nextValue rawCost get nextValue
it Map Entry Object List AtomicLong entry it next AtomicLong decayedCost entry getValue get AtomicLong rawCost entry getValue get totalRawCost rawCost get currentValue decayedCost get nextValue currentValue decayFactor totalDecayedCost nextValue decayedCost set nextValue LOG debug entry getKey nextValue rawCost get nextValue LOG debug entry getKey it remove totalDecayedCallCost set totalDecayedCost totalRawCallCost set totalRawCost
totalRawCost rawCost get currentValue decayedCost get nextValue currentValue decayFactor totalDecayedCost nextValue decayedCost set nextValue LOG debug entry getKey nextValue rawCost get nextValue LOG debug entry getKey it remove totalDecayedCallCost set totalDecayedCost totalRawCallCost set totalRawCost LOG debug totalDecayedCost totalRawCost recomputeScheduleCache updateAverageResponseTime
Object identity Map Object Integer scheduleCache scheduleCacheRef get scheduleCache Integer priority scheduleCache get identity priority
obj Boolean backOff priorityLevel obj getPriorityLevel LOG responseTimes getAverageResponseTime LOG debug obj getUserGroupInformation getUserName obj getPriorityLevel
String schedulable details String user identityProvider makeIdentity schedulable processingCost costProvider getCost details addCost user processingCost priorityLevel schedulable getPriorityLevel queueTime details get Timing QUEUE RpcMetrics TIMEUNIT processingTime details get Timing PROCESSING RpcMetrics TIMEUNIT decayRpcSchedulerDetailedMetrics addQueueTime priorityLevel queueTime decayRpcSchedulerDetailedMetrics addProcessingTime priorityLevel processingTime responseTimeCountInCurrWindow getAndIncrement priorityLevel responseTimeTotalInCurrWindow getAndAdd priorityLevel queueTime processingTime
totalResponseTime responseTimeTotalInCurrWindow get i responseTimeCount responseTimeCountInCurrWindow get i responseTimeCount averageResponseTime totalResponseTime responseTimeCount lastAvg responseTimeAvgInLastWindow get i lastAvg averageResponseTime decayed decayFactor lastAvg averageResponseTime responseTimeAvgInLastWindow set i decayed responseTimeAvgInLastWindow set i averageResponseTime responseTimeAvgInLastWindow set i responseTimeCountInLastWindow set i responseTimeCount
proxy proxy HadoopIllegalArgumentException proxy Closeable Closeable proxy close InvocationHandler handler Proxy getInvocationHandler proxy handler Closeable Closeable handler close e LOG error e e
RpcSaslProto saslResponse saslResponse processSaslMessage saslMessage IOException e rpcMetrics incrAuthenticationFailures LOG LOG debug StringUtils stringifyException e IOException tce IOException getTrueCause e AUDITLOG warn AUTH_FAILED_FOR toString attemptingUser e getLocalizedMessage tce getLocalizedMessage tce saslServer saslServer LOG LOG debug saslServer getNegotiatedProperty Sasl QOP user getAuthorizedUgi saslServer getAuthorizationID
saslResponse processSaslMessage saslMessage IOException e rpcMetrics incrAuthenticationFailures LOG LOG debug StringUtils stringifyException e IOException tce IOException getTrueCause e AUDITLOG warn AUTH_FAILED_FOR toString attemptingUser e getLocalizedMessage tce getLocalizedMessage tce saslServer saslServer LOG LOG debug saslServer getNegotiatedProperty Sasl QOP user getAuthorizedUgi saslServer getAuthorizationID LOG LOG debug user
bb callId retry RpcConstants INVALID_RETRY_COUNT RpcWritable Buffer buffer RpcWritable Buffer wrap bb RpcRequestHeaderProto header getMessage RpcRequestHeaderProto getDefaultInstance buffer callId header getCallId retry header getRetryCount
RpcWritable Buffer buffer RpcWritable Buffer wrap bb RpcRequestHeaderProto header getMessage RpcRequestHeaderProto getDefaultInstance buffer callId header getCallId retry header getRetryCount LOG LOG debug callId checkRpcHeaders header callId processRpcOutOfBandRequest header buffer FatalRpcServerException RpcErrorCodeProto FATAL_INVALID_RPC_HEADER processRpcRequest header buffer LOG
thisIdx currentQueueIndex get nextIdx thisIdx numQueues currentQueueIndex set nextIdx requestsLeft set queueWeights nextIdx
listBeans jg ObjectName splitStrings splitStrings response String qry request getParameter qry qry listBeans jg ObjectName qry response jg jg close writer writer close e LOG error e response setStatus HttpServletResponse SC_INTERNAL_SERVER_ERROR
MBeanInfo minfo String code Object attributeinfo minfo mBeanServer getMBeanInfo oname code minfo getClassName String prs code prs code String mBeanServer getAttribute oname prs attribute prs attribute attributeinfo mBeanServer getAttribute oname prs
Object attributeinfo minfo mBeanServer getMBeanInfo oname code minfo getClassName String prs code prs code String mBeanServer getAttribute oname prs attribute prs attribute attributeinfo mBeanServer getAttribute oname prs e LOG error prs oname e e
minfo mBeanServer getMBeanInfo oname code minfo getClassName String prs code prs code String mBeanServer getAttribute oname prs attribute prs attribute attributeinfo mBeanServer getAttribute oname prs e LOG error prs oname e e LOG error prs oname e e
String prs code prs code String mBeanServer getAttribute oname prs attribute prs attribute attributeinfo mBeanServer getAttribute oname prs e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e e
code String mBeanServer getAttribute oname prs attribute prs attribute attributeinfo mBeanServer getAttribute oname prs e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e e e
prs attribute attributeinfo mBeanServer getAttribute oname prs e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e e LOG error prs oname e e e LOG error qry oname e
oname attr attr String attName attr getName attName attName attName attName Object value value mBeanServer getAttribute oname attName e e LOG debug attName oname e
String attName attr getName attName attName attName attName Object value value mBeanServer getAttribute oname attName e e LOG debug attName oname e LOG error attName oname e e
attName attName attName Object value value mBeanServer getAttribute oname attName e e LOG debug attName oname e LOG error attName oname e e LOG error attName oname e e
Object value value mBeanServer getAttribute oname attName e e LOG debug attName oname e LOG error attName oname e e LOG error attName oname e e e
e e LOG debug attName oname e LOG error attName oname e e LOG error attName oname e e e LOG error attName oname e e
fname PropertiesConfiguration pcf PropertiesConfiguration pcf setListDelimiterHandler DefaultListDelimiterHandler FileHandler fh FileHandler pcf fh setFileName fname fh load Configuration cf pcf interpolatedConfiguration
fname PropertiesConfiguration pcf PropertiesConfiguration pcf setListDelimiterHandler DefaultListDelimiterHandler FileHandler fh FileHandler pcf fh setFileName fname fh load Configuration cf pcf interpolatedConfiguration LOG info fname LOG
PropertiesConfiguration pcf PropertiesConfiguration pcf setListDelimiterHandler DefaultListDelimiterHandler FileHandler fh FileHandler pcf fh setFileName fname fh load Configuration cf pcf interpolatedConfiguration LOG info fname LOG LOG debug toString cf MetricsConfig mc MetricsConfig cf prefix LOG debug mc mc
Object getPropertyInternal key Object value getPropertyInternal key value
String String prefix String classKey prefix isEmpty prefix concat String clsName getString classKey
ClassLoader defaultLoader getClass getClassLoader Object purls getProperty PLUGIN_URLS_KEY purls defaultLoader Iterable String jars SPLITTER split String purls len Iterables size jars len URL urls URL len i String jar jars LOG debug jar urls i URL jar e MetricsConfigException e
Random rng Random System nanoTime queue consumeAll refreshQueueSizeGauge retryDelay firstRetryDelay n retryCount inError LOG info name n retryWindow Math max retryDelay minDelay awhile rng nextInt retryWindow minDelay inError
retryDelay firstRetryDelay n retryCount inError e LOG info name e n retryWindow Math max retryDelay minDelay awhile rng nextInt retryWindow minDelay inError LOG error awhile e retryDelay retryBackoff Thread sleep awhile
e LOG info name e n retryWindow Math max retryDelay minDelay awhile rng nextInt retryWindow minDelay LOG error awhile e retryDelay retryBackoff Thread sleep awhile e2 LOG info name e2 n
ts
AttributeList updateJmxCache AttributeList ret AttributeList key Attribute attr attrCache get key
monitoring LOG warn prefix MetricsException monitoring LOG info prefix Callback cb callbacks cb preStop Callback cb namedCallbacks values cb preStop LOG info prefix stopTimer stopSources stopSinks clearConfigs monitoring
String name String desc source MetricsSourceBuilder sb MetricsAnnotations newSourceBuilder source MetricsSource s sb build MetricsInfo si sb info String name2 name si name name String finalDesc desc si description desc String finalName DefaultMetricsSystem sourceName name2 monitoring allSources put finalName s
name desc source checkNotNull config MetricsConfig conf sourceConfigs get name MetricsSourceAdapter sa MetricsSourceAdapter prefix name desc source injectedTags period conf conf config subset SOURCE_KEY sources put name sa sa start
name desc sink checkNotNull config MetricsConfig conf sinkConfigs get name MetricsSinkAdapter sa conf newSink name desc sink conf newSink name desc sink config subset SINK_KEY sinks put name sa sa start
sa bufferBuilder startTime Time monotonicNow bufferBuilder add sa name sa getMetrics collector collector clear snapshotStat add Time monotonicNow startTime
MetricsSourceAdapter entry MetricsSourceAdapter sa entry getValue
MetricsSinkAdapter entry MetricsSinkAdapter sa entry getValue
LOG debug System getProperty MS_INIT_MODE_KEY
protocol protocolCache contains protocol protocolCache add protocol method protocol String name method getName
hostName DNS getDefaultHost conf getString conf getString uhe LOG error uhe toString hostName metricsServers Servers parse conf getString SERVERS_PROPERTY DEFAULT_PORT multicastEnabled conf getBoolean MULTICAST_ENABLED_PROPERTY DEFAULT_MULTICAST_ENABLED multicastTtl conf getInt MULTICAST_TTL_PROPERTY DEFAULT_MULTICAST_TTL gangliaConfMap HashMap String GangliaConf loadGangliaConf GangliaConfType units loadGangliaConf GangliaConfType tmax loadGangliaConf GangliaConfType dmax loadGangliaConf GangliaConfType slope
gtype String propertyarr conf getStringArray gtype name propertyarr propertyarr String metricNValue propertyarr String metricNValueArr metricNValue split EQUAL metricNValueArr metricNValueArr
ObjectName serviceName nameName properties theMbean MBeanServer mbs ManagementFactory getPlatformMBeanServer Preconditions checkNotNull properties ObjectName name getMBeanName serviceName nameName properties name mbs registerMBean theMbean name
excludedScope scope excludedScope Node node getNode scope node InnerNode excludedNodes excludedNodes contains node node InnerNode innerNode InnerNode node numOfDatanodes innerNode getNumOfLeaves excludedScope node node getNode excludedScope node InnerNode numOfDatanodes numOfDatanodes InnerNode node getNumOfLeaves
node getNode excludedScope node InnerNode numOfDatanodes numOfDatanodes InnerNode node getNumOfLeaves numOfDatanodes LOG debug scope excludedScope numOfDatanodes availableNodes excludedScope availableNodes countNumOfAvailableNodes scope excludedNodes netlock readLock lock
nthValidToReturn r nextInt availableNodes LOG debug nthValidToReturn Node ret parentNode getLeaf r nextInt totalInScopeNodes excludedScopeNode ret LOG debug ret ret ret Node lastValidNode i i totalInScopeNodes i ret parentNode getLeaf i excludedScopeNode ret nthValidToReturn nthValidToReturn
ret LOG debug ret ret ret Node lastValidNode i i i ret parentNode getLeaf i excludedScopeNode ret nthValidToReturn nthValidToReturn lastValidNode ret LOG debug ret
node node IllegalArgumentException NodeBase getPath node netlock writeLock lock Node rack node getNetworkLocation node setNetworkLocation node getNetworkLocation NetworkTopologyWithNodeGroup DEFAULT_NODEGROUP Node nodeGroup getNode node getNetworkLocation nodeGroup nodeGroup InnerNodeWithNodeGroup node getNetworkLocation rack getNode nodeGroup getNetworkLocation rack rack rack IllegalArgumentException node toString node
String providerNames conf getStrings MAPPING_PROVIDERS_CONFIG_KEY String String providerKey String name providerNames providerKey MAPPING_PROVIDER_CONFIG_PREFIX name Class providerClass conf getClass providerKey providerClass
String keytabName popOptionWithArgument ARG_KEYTAB args keytabName keytab File keytabName principal popOptionWithArgument ARG_PRINCIPAL args String outf popOptionWithArgument ARG_OUTPUT args String mkl popOptionWithArgument ARG_KEYLEN args mkl minKeyLength Integer parseInt mkl securityRequired popOption ARG_SECURE args nofail popOption ARG_NOFAIL args jaas popOption ARG_JAAS args nologin popOption ARG_NOLOGIN args checkShortName popOption ARG_VERIFYSHORTNAME args String resource resource popOptionWithArgument args
String identity keytab File kt keytab getCanonicalFile println kt principal identity principal failif principal CAT_KERBEROS ugi loginUserFromKeytabAndReturnUGI principal kt getPath dumpUGI identity ugi validateUGI principal ugi title setShouldRenewImmediatelyForTests ugi reloginFromKeytab warn CAT_UGI
user DirContext c getDirContext NamingEnumeration SearchResult results c search userbaseDN userSearchFilter Object user SEARCH_CONTROLS results
LOG debug user Collections emptySet SearchResult result results nextElement Set String groups Collections emptySet Attribute groupDNAttr result getAttributes get memberOfAttr groupDNAttr NamingException memberOfAttr result toString groups LinkedHashSet NamingEnumeration groupEnumeration groupDNAttr getAll groupEnumeration String groupDN groupEnumeration next toString groups add getRelativeDistinguishedName groupDN NamingException
Set String groups Collections emptySet Attribute groupDNAttr result getAttributes get memberOfAttr groupDNAttr NamingException memberOfAttr result toString groups LinkedHashSet NamingEnumeration groupEnumeration groupDNAttr getAll groupEnumeration String groupDN groupEnumeration next toString groups add getRelativeDistinguishedName groupDN NamingException e LOG info e groups goUpHierarchy groups lookupGroup result c goUpHierarchy
String previousLdapUrl currentLdapUrl currentLdapUrl ldapUrls next
BindUserInfo oldBindUser currentBindUser currentBindUser bindUsers next oldBindUser currentBindUser
conf conf conf String urls conf getStrings LDAP_URL_KEY LDAP_URL_DEFAULT urls urls RuntimeException ldapUrls Iterators cycle urls currentLdapUrl ldapUrls next useSsl conf getBoolean LDAP_USE_SSL_KEY LDAP_USE_SSL_DEFAULT useSsl loadSslConf conf initializeBindUsers String baseDN conf getTrimmed BASE_DN_KEY BASE_DN_DEFAULT userbaseDN conf getTrimmed USER_BASE_DN_KEY baseDN LOG debug userbaseDN groupbaseDN conf getTrimmed GROUP_BASE_DN_KEY baseDN
StringBuffer newProviderPath StringBuffer String providers providerPath split Path path String provider providers path unnestUri URI provider Class FileSystem clazz String scheme path toUri getScheme clazz FileSystem getFileSystemClass scheme config newProviderPath newProviderPath append newProviderPath append provider clazz
AuthMethod authMethod AuthMethod valueOf authType getMethod authMethod AuthMethod switchToSimple saslClient createSaslClient authType saslClient selectedAuthType authType saslClient switchToSimple List String serverAuthMethods ArrayList String authType serverAuthMethods add authType getMethod AccessControlException serverAuthMethods selectedAuthType
Token token getServerToken authType token LOG debug saslCallback SaslClientCallbackHandler token LOG debug String serverPrincipal getServerPrincipal authType serverPrincipal LOG debug LOG
saslCallback SaslClientCallbackHandler token LOG debug String serverPrincipal getServerPrincipal authType serverPrincipal LOG debug LOG LOG debug protocol getCanonicalName serverPrincipal method String mechanism method getMechanismName
TokenInfo tokenInfo SecurityUtil getTokenInfo protocol conf
KerberosInfo krbInfo SecurityUtil getKerberosInfo protocol conf
LOG debug protocol krbInfo krbInfo String serverKey krbInfo serverPrincipal serverKey IllegalArgumentException protocol getCanonicalName String serverPrincipal KerberosPrincipal authType getProtocol authType getServerId KerberosPrincipal KRB_NT_SRV_HST getName String serverKeyPattern conf get serverKey serverKeyPattern serverKeyPattern Pattern pattern GlobPattern compile serverKeyPattern pattern serverPrincipal IllegalArgumentException String format serverPrincipal serverKeyPattern String confPrincipal SecurityUtil getServerPrincipal conf get serverKey serverAddr getAddress LOG
serverId AccessControlException ugi getUserName callback SaslGssCallbackHandler AccessControlException SaslServer saslServer ugi saslServer ugi SaslServer SaslServer saslFactory createSaslServer mechanism protocol serverId saslProperties callback saslServer saslFactory createSaslServer mechanism protocol serverId saslProperties callback saslServer AccessControlException mechanism
callback NameCallback nc NameCallback callback callback PasswordCallback pc PasswordCallback callback callback UnsupportedCallbackException callback pc TokenIdentifier tokenIdentifier getIdentifier nc getDefaultName secretManager password getPassword tokenIdentifier UserGroupInformation user user tokenIdentifier getUser connection attemptingUser user
token addr Text service buildTokenService addr token token setService service
LOG debug mapName nameId nameId Integer key staticMapping get parseId nameId String value nameId map key String prevValue map get key value prevValue reportDuplicateEntry key value key prevValue map value Integer prevKey map inverse get value reportDuplicateEntry key value prevKey value map put key value updated
Integer key staticMapping get parseId nameId String value nameId map key String prevValue map get key value prevValue reportDuplicateEntry key value key prevValue map value Integer prevKey map inverse get value reportDuplicateEntry key value prevKey value map put key value updated LOG debug mapName map size
init staticMapping staticMappingFile lmTime staticMappingFile lastModified lmTime
UserGroupInformation subject UserGroupInformation realUser doSubjectLogin subject UserGroupInformation loginUser String proxyUser System getenv HADOOP_PROXY_USER proxyUser proxyUser System getProperty HADOOP_PROXY_USER loginUser proxyUser realUser createProxyUser proxyUser realUser Collection String tokenFileLocations LinkedHashSet tokenFileLocations addAll getTrimmedStringCollection System getProperty HADOOP_TOKEN_FILES tokenFileLocations addAll getTrimmedStringCollection conf get HADOOP_TOKEN_FILES tokenFileLocations addAll getTrimmedStringCollection System getenv HADOOP_TOKEN_FILE_LOCATION String tokenFileLocation tokenFileLocations tokenFileLocation tokenFileLocation File tokenFile File tokenFileLocation
String proxyUser System getenv HADOOP_PROXY_USER proxyUser proxyUser System getProperty HADOOP_PROXY_USER loginUser proxyUser realUser createProxyUser proxyUser realUser Collection String tokenFileLocations LinkedHashSet tokenFileLocations addAll getTrimmedStringCollection System getProperty HADOOP_TOKEN_FILES tokenFileLocations addAll getTrimmedStringCollection conf get HADOOP_TOKEN_FILES tokenFileLocations addAll getTrimmedStringCollection System getenv HADOOP_TOKEN_FILE_LOCATION String tokenFileLocation tokenFileLocations tokenFileLocation tokenFileLocation File tokenFile File tokenFileLocation LOG debug tokenFile getCanonicalPath tokenFile tokenFile Credentials cred Credentials readTokenStorageFile tokenFile conf
proxyUser System getProperty HADOOP_PROXY_USER loginUser proxyUser realUser createProxyUser proxyUser realUser Collection String tokenFileLocations LinkedHashSet tokenFileLocations addAll getTrimmedStringCollection System getProperty HADOOP_TOKEN_FILES tokenFileLocations addAll getTrimmedStringCollection conf get HADOOP_TOKEN_FILES tokenFileLocations addAll getTrimmedStringCollection System getenv HADOOP_TOKEN_FILE_LOCATION String tokenFileLocation tokenFileLocations tokenFileLocation tokenFileLocation File tokenFile File tokenFileLocation LOG debug tokenFile getCanonicalPath tokenFile tokenFile Credentials cred Credentials readTokenStorageFile tokenFile conf LOG debug cred numberOfTokens tokenFile getCanonicalPath loginUser addCredentials cred
LOG info tokenFile getCanonicalPath Collection String tokensBase64 LinkedHashSet tokensBase64 addAll getTrimmedStringCollection System getProperty HADOOP_TOKENS tokensBase64 addAll getTrimmedStringCollection conf get HADOOP_TOKENS tokensBase64 addAll getTrimmedStringCollection System getenv HADOOP_TOKEN numTokenBase64 String tokenBase64 tokensBase64 tokenBase64 tokenBase64 Token TokenIdentifier token Token token decodeFromUrlString tokenBase64 Credentials cred Credentials cred addToken token getService token loginUser addCredentials cred
Collection String tokensBase64 LinkedHashSet tokensBase64 addAll getTrimmedStringCollection System getProperty HADOOP_TOKENS tokensBase64 addAll getTrimmedStringCollection conf get HADOOP_TOKENS tokensBase64 addAll getTrimmedStringCollection System getenv HADOOP_TOKEN numTokenBase64 String tokenBase64 tokensBase64 tokenBase64 tokenBase64 Token TokenIdentifier token Token token decodeFromUrlString tokenBase64 Credentials cred Credentials cred addToken token getService token loginUser addCredentials cred numTokenBase64
Collection String tokensBase64 LinkedHashSet tokensBase64 addAll getTrimmedStringCollection System getProperty HADOOP_TOKENS tokensBase64 addAll getTrimmedStringCollection conf get HADOOP_TOKENS tokensBase64 addAll getTrimmedStringCollection System getenv HADOOP_TOKEN numTokenBase64 String tokenBase64 tokensBase64 tokenBase64 tokenBase64 Token TokenIdentifier token Token token decodeFromUrlString tokenBase64 Credentials cred Credentials cred addToken token getService token loginUser addCredentials cred numTokenBase64
tokensBase64 addAll getTrimmedStringCollection conf get HADOOP_TOKENS tokensBase64 addAll getTrimmedStringCollection System getenv HADOOP_TOKEN numTokenBase64 tokenBase64 tokensBase64 tokenBase64 tokenBase64 Token TokenIdentifier token Token token decodeFromUrlString tokenBase64 Credentials cred Credentials cred addToken token getService token loginUser addCredentials cred numTokenBase64 ioe LOG error tokenBase64 ioe getMessage numTokenBase64
log caption ugi log log debug caption ugi ugi
keystoreUri path ProviderUtils unnestUri keystoreUri
initFileSystem URI uri initFileSystem uri file File URI getPath toString
initFileSystem URI uri initFileSystem uri file File URI getPath toString LOG LOG debug file file
HttpServletRequest request HttpServletRequest lowerCaseRequest toLowerCase request String doAsUser lowerCaseRequest getParameter DO_AS doAsUser doAsUser request
String clientKey krbInfo clientPrincipal clientKey clientKey clientPrincipal SecurityUtil getServerPrincipal conf get clientKey addr e AuthorizationException AuthorizationException addr user protocol initCause e clientPrincipal clientPrincipal user user user String cause clientPrincipal clientPrincipal AUDITLOG warn AUTHZ_FAILED_FOR user protocol cause AuthorizationException user protocol cause addr String hostAddress addr getHostAddress hostAddress hostAddress AUDITLOG warn AUTHZ_FAILED_FOR protocol hostAddress AuthorizationException hostAddress protocol
LOG LOG debug originsList LOG LOG debug originsList String accessControlRequestMethod req getHeader ACCESS_CONTROL_REQUEST_METHOD accessControlRequestMethod LOG LOG debug accessControlRequestMethod String accessControlRequestHeaders req getHeader ACCESS_CONTROL_REQUEST_HEADERS accessControlRequestHeaders LOG
String String ArrayList String preferredSuites ArrayList
String keystoreType conf get resolvePropertyName mode SSL_KEYSTORE_TYPE_TPL_KEY DEFAULT_KEYSTORE_TYPE KeyStore keystore KeyStore getInstance keystoreType String keystoreKeyPassword mode String locationProperty resolvePropertyName mode SSL_KEYSTORE_LOCATION_TPL_KEY String keystoreLocation conf get locationProperty keystoreLocation GeneralSecurityException locationProperty String passwordProperty resolvePropertyName mode SSL_KEYSTORE_PASSWORD_TPL_KEY String keystorePassword getPassword conf passwordProperty keystorePassword GeneralSecurityException passwordProperty String keyPasswordProperty resolvePropertyName mode SSL_KEYSTORE_KEYPASSWORD_TPL_KEY keystoreKeyPassword getPassword conf keyPasswordProperty keystorePassword
GeneralSecurityException locationProperty String passwordProperty resolvePropertyName mode SSL_KEYSTORE_PASSWORD_TPL_KEY String keystorePassword getPassword conf passwordProperty keystorePassword GeneralSecurityException passwordProperty String keyPasswordProperty resolvePropertyName mode SSL_KEYSTORE_KEYPASSWORD_TPL_KEY keystoreKeyPassword getPassword conf keyPasswordProperty keystorePassword LOG LOG debug mode toString keystoreLocation InputStream is Files newInputStream Paths get keystoreLocation keystore load is keystorePassword toCharArray is close LOG
is close LOG LOG debug mode toString keystoreLocation keystore load KeyManagerFactory keyMgrFactory KeyManagerFactory getInstance SSLFactory SSLCERTIFICATE keyMgrFactory init keystore keystoreKeyPassword keystoreKeyPassword toCharArray keyManagers keyMgrFactory getKeyManagers String truststoreType conf get resolvePropertyName mode SSL_TRUSTSTORE_TYPE_TPL_KEY DEFAULT_KEYSTORE_TYPE String locationProperty resolvePropertyName mode SSL_TRUSTSTORE_LOCATION_TPL_KEY String truststoreLocation conf get locationProperty truststoreLocation String passwordProperty resolvePropertyName mode SSL_TRUSTSTORE_PASSWORD_TPL_KEY String truststorePassword getPassword conf passwordProperty
LOG debug mode toString keystoreLocation keystore load KeyManagerFactory keyMgrFactory KeyManagerFactory getInstance SSLFactory SSLCERTIFICATE keyMgrFactory init keystore keystoreKeyPassword keystoreKeyPassword toCharArray keyManagers keyMgrFactory getKeyManagers String truststoreType conf get resolvePropertyName mode SSL_TRUSTSTORE_TYPE_TPL_KEY DEFAULT_KEYSTORE_TYPE String locationProperty resolvePropertyName mode SSL_TRUSTSTORE_LOCATION_TPL_KEY String truststoreLocation conf get locationProperty truststoreLocation String passwordProperty resolvePropertyName mode SSL_TRUSTSTORE_PASSWORD_TPL_KEY String truststorePassword getPassword conf passwordProperty truststorePassword truststorePassword truststoreReloadInterval conf getLong resolvePropertyName mode SSL_TRUSTSTORE_RELOAD_INTERVAL_TPL_KEY DEFAULT_SSL_TRUSTSTORE_RELOAD_INTERVAL
keystore load KeyManagerFactory keyMgrFactory KeyManagerFactory getInstance SSLFactory SSLCERTIFICATE keyMgrFactory init keystore keystoreKeyPassword keystoreKeyPassword toCharArray keyManagers keyMgrFactory getKeyManagers String truststoreType conf get resolvePropertyName mode SSL_TRUSTSTORE_TYPE_TPL_KEY DEFAULT_KEYSTORE_TYPE String locationProperty resolvePropertyName mode SSL_TRUSTSTORE_LOCATION_TPL_KEY String truststoreLocation conf get locationProperty truststoreLocation String passwordProperty resolvePropertyName mode SSL_TRUSTSTORE_PASSWORD_TPL_KEY String truststorePassword getPassword conf passwordProperty truststorePassword truststorePassword truststoreReloadInterval conf getLong resolvePropertyName mode SSL_TRUSTSTORE_RELOAD_INTERVAL_TPL_KEY DEFAULT_SSL_TRUSTSTORE_RELOAD_INTERVAL LOG LOG debug mode toString truststoreLocation
X509TrustManager X509TrustManager trustManager KeyStore ks KeyStore getInstance type InputStream in Files newInputStream file toPath ks load in password password toCharArray lastLoaded file lastModified
sslEngine String cipherSuites sslEngine getEnabledCipherSuites ArrayList String defaultEnabledCipherSuites ArrayList String Arrays asList cipherSuites Iterator iterator excludeCiphers iterator iterator String cipherName String iterator next defaultEnabledCipherSuites cipherName defaultEnabledCipherSuites remove cipherName
tokenFile String service String String conf Token token Credentials creds tokenFile exists Credentials readTokenStorageFile tokenFile conf Credentials ServiceLoader DtFetcher loader ServiceLoader load DtFetcher Iterator DtFetcher iterator loader iterator iterator DtFetcher fetcher fetcher iterator next e LOG debug e fetcher service fetcher String message service
DtFetcher fetcher fetcher iterator next e LOG debug e fetcher service url fetcher String message service LOG error message IllegalArgumentException message token fetcher addDelegationTokens conf creds renewer stripPrefix url alias token String message service alias
LOG debug e fetcher service url fetcher String message service LOG error message IllegalArgumentException message token fetcher addDelegationTokens conf creds renewer stripPrefix url alias token String message service alias LOG error message IOException message Token aliasedToken token copyToken aliasedToken setService alias
cancel tokenFile conf Credentials newCreds Credentials Credentials creds Credentials readTokenStorageFile tokenFile conf token creds token token cancel token cancel conf
tokenFile conf Credentials creds Credentials readTokenStorageFile tokenFile conf token creds token token result token renew conf
identifier sequenceNum now Time now sequenceNum incrementDelegationTokenSeqNum identifier setIssueDate now identifier setMaxDate now tokenMaxLifetime identifier setMasterKeyId currentKey getKeyId identifier setSequenceNumber sequenceNum
TokenIdent token ByteArrayInputStream buf ByteArrayInputStream token getIdentifier DataInputStream in DataInputStream buf TokenIdent id createIdentifier id readFields in
TokenIdent TokenIdent token ByteArrayInputStream buf ByteArrayInputStream token getIdentifier DataInputStream in DataInputStream buf TokenIdent id createIdentifier id readFields in
ident logExpireToken ident
e IOException e CuratorFramework nullNsFw zkClient usingNamespace EnsurePath ensureNs nullNsFw newNamespaceAwareEnsurePath zkClient getNamespace ensureNs ensure nullNsFw getZookeeperClient e IOException e listenerThreadPool Executors newSingleThreadExecutor delTokSeqCounter SharedCount zkClient ZK_DTSM_SEQNUM_ROOT delTokSeqCounter delTokSeqCounter start currentSeqNum incrSharedCount delTokSeqCounter seqNumBatchSize
isTokenCache String cacheName isTokenCache
String cacheName isTokenCache LOG info cacheName List ChildData children isTokenCache children tokenCache getCurrentData children keyCache getCurrentData count ChildData child children isTokenCache processTokenAddOrUpdate child getData processKeyAddOrUpdate child getData
LOG info cacheName List ChildData children children tokenCache getCurrentData children keyCache getCurrentData count ChildData child children processTokenAddOrUpdate child getData processKeyAddOrUpdate child getData LOG info child getPath
count child processTokenAddOrUpdate child getData processKeyAddOrUpdate child getData e LOG info child getPath LOG debug e count syncTokenOwnerStats count LOG warn count cacheName
stopThreads tokenCache tokenCache close e LOG error e delTokSeqCounter delTokSeqCounter close e LOG error e keyIdSeqCounter keyIdSeqCounter close e
e LOG error e delTokSeqCounter delTokSeqCounter close e LOG error e keyIdSeqCounter keyIdSeqCounter close e LOG error e keyCache keyCache close
delTokSeqCounter delTokSeqCounter close e LOG error e keyIdSeqCounter keyIdSeqCounter close e LOG error e keyCache keyCache close e LOG error e
currentSeqNum currentMaxSeqNum currentSeqNum incrSharedCount delTokSeqCounter seqNumBatchSize currentMaxSeqNum currentSeqNum seqNumBatchSize
data zkClient getData forPath nodePath data data ByteArrayInputStream bin ByteArrayInputStream data DataInputStream din DataInputStream bin createIdentifier readFields din renewDate din readLong pwdLen din readInt password pwdLen numRead din read password pwdLen numRead DelegationTokenInformation tokenInfo DelegationTokenInformation renewDate password tokenInfo
key String nodeCreatePath getNodePath ZK_DTSM_MASTER_KEY_ROOT DELEGATION_KEY_PREFIX key getKeyId ByteArrayOutputStream os ByteArrayOutputStream DataOutputStream fsOut DataOutputStream os
key String nodeCreatePath getNodePath ZK_DTSM_MASTER_KEY_ROOT DELEGATION_KEY_PREFIX key getKeyId ByteArrayOutputStream os ByteArrayOutputStream DataOutputStream fsOut DataOutputStream os LOG LOG debug key getKeyId key write fsOut zkClient forPath nodeCreatePath zkClient setData forPath nodeCreatePath os toByteArray setVersion LOG debug nodeCreatePath zkClient create withMode CreateMode PERSISTENT forPath nodeCreatePath os toByteArray
ByteArrayOutputStream os ByteArrayOutputStream DataOutputStream fsOut DataOutputStream os LOG LOG debug key getKeyId key write fsOut zkClient forPath nodeCreatePath zkClient setData forPath nodeCreatePath os toByteArray setVersion LOG debug nodeCreatePath zkClient create withMode CreateMode PERSISTENT forPath nodeCreatePath os toByteArray LOG debug nodeCreatePath
key String nodeRemovePath getNodePath ZK_DTSM_MASTER_KEY_ROOT DELEGATION_KEY_PREFIX key getKeyId
ident String nodeRemovePath getNodePath ZK_DTSM_TOKENS_ROOT DELEGATION_TOKEN_PREFIX ident getSequenceNumber DelegationTokenInformation dtInfo getTokenInfoFromZK ident dtInfo dtInfo
String nodeRemovePath getNodePath ZK_DTSM_TOKENS_ROOT DELEGATION_TOKEN_PREFIX ident getSequenceNumber DelegationTokenInformation dtInfo getTokenInfoFromZK ident dtInfo dtInfo LOG info nodeRemovePath LOG LOG debug ident getSequenceNumber zkClient forPath nodeRemovePath zkClient delete guaranteed forPath nodeRemovePath LOG debug nodeRemovePath
ident info String nodeCreatePath getNodePath ZK_DTSM_TOKENS_ROOT DELEGATION_TOKEN_PREFIX ident getSequenceNumber tokenOut ident write tokenOut tokenOut writeLong info getRenewDate tokenOut writeInt info getPassword length tokenOut write info getPassword
url Token token String Preconditions checkNotNull url Preconditions checkNotNull token Map String String extraParams HashMap String String org apache hadoop security token Token TokenIdentifier dToken
url Token token String doAs Preconditions checkNotNull url Preconditions checkNotNull token Map String String extraParams HashMap String String org apache hadoop security token Token TokenIdentifier dToken LOG debug url token doAs token Credentials creds UserGroupInformation getCurrentUser getCredentials LOG
org apache hadoop security token Token TokenIdentifier url creds InetSocketAddress serviceAddr InetSocketAddress url getHost url getPort Text service SecurityUtil buildTokenService serviceAddr org apache hadoop security token Token TokenIdentifier dToken creds getToken service
AuthenticationToken authToken AuthenticationToken request getUserPrincipal authToken authToken AuthenticationToken ugi UserGroupInformation request getAttribute DelegationTokenAuthenticationHandler DELEGATION_TOKEN_UGI_ATTRIBUTE ugi String realUser request getUserPrincipal getName ugi UserGroupInformation createRemoteUser realUser handlerAuthMethod String doAsUser getDoAs request doAsUser ugi UserGroupInformation createProxyUser doAsUser ugi ProxyUsers authorize ugi request getRemoteAddr ex HttpExceptionUtils createServletExceptionResponse response HttpServletResponse SC_FORBIDDEN ex requestCompleted
AuthenticationToken request AuthenticationToken token String delegationParam getDelegationToken request delegationParam
String delegationParam getDelegationToken request delegationParam LOG debug delegationParam Token AbstractDelegationTokenIdentifier dt Token dt decodeFromUrlString delegationParam UserGroupInformation ugi tokenManager verifyToken dt String shortName ugi getShortUserName token AuthenticationToken shortName ugi getUserName getType token setExpires request setAttribute DELEGATION_TOKEN_UGI_ATTRIBUTE ugi ex token HttpExceptionUtils createServletExceptionResponse response HttpServletResponse SC_FORBIDDEN AuthenticationException ex
UserGroupInformation getCurrentUser checkTGTAndReloginFromKeytab
List Service services getServices
List Service services getServices
numOfServicesToStop serviceList size
Exception firstException List Service services getServices i i i Service service services get i
args LOG LOG debug getName args size args
LOG error thread toString exception exception exception LOG error thread toString exception exception err exception OutOfMemoryError System err println err ExitUtil haltOnOutOfMemory OutOfMemoryError exception ExitUtil ExitException ee ServiceLauncher convertToExitException exception ExitUtil terminate ee status ee
s signalCount incrementAndGet InterruptData data InterruptData s getName s getNumber
exitException exitCode exitException getExitCode exitCode
List String toCreate getConfigurationsToCreate loaded String classname toCreate Class loadClass getClassLoader loadClass classname Object instance loadClass getConstructor newInstance instance ExitUtil ExitException EXIT_SERVICE_CREATION_FAILURE classname loaded e LOG debug classname ExitUtil ExitException e e e
ExitUtil ExitException conf instance processedArgs addShutdownHook execute ExitUtil ExitException exitException exitCode coreServiceLaunch conf instance processedArgs addShutdownHook execute service Throwable failure service getFailureCause failure Service STATE failureState service getFailureState failureState Service STATE
Throwable failure service getFailureCause failure Service STATE failureState service getFailureState failureState Service STATE LOG debug failure failure failure String name getServiceName exitCode exitException ServiceLaunchException exitCode name exitException ServiceLaunchException exitCode name ee exitException ee Throwable
service LaunchableService LOG debug name launchableService LaunchableService service launchableService LOG warn name Configuration newconf launchableService bindArgs configuration processedArgs newconf configuration newconf service service init configuration exitCode service start exitCode EXIT_SUCCESS service
String message String text message
argString append append arg append LOG debug argString String argArray args toArray String args size GenericOptionsParser parser createGenericOptionsParser conf argArray parser ServiceLaunchException EXIT_COMMAND_ARGUMENT_ERROR E_PARSE_FAILED argString CommandLine line parser getCommandLine List String remainingArgs Arrays asList parser getRemainingArgs LOG debug remainingArgs line ARG_CONF String filenames line getOptionValues ARG_CONF verifyConfigurationFilesExist filenames String filename filenames File file File filename
StringUtils args StringUtils args usage args usage String hostPort StringUtils popOptionWithArgument args hostPort System err println args System err println String servicePrincipal StringUtils popOptionWithArgument args servicePrincipal
SpanReceiver receivers TracerPool getGlobalTracerPool getReceivers SpanReceiver receiver receivers receiver TracerPool getGlobalTracerPool removeAndCloseReceiver receiver
URL name URL url name url findResource name url name
LOG debug name Class c findLoadedClass name ClassNotFoundException ex c name c findClass name LOG c LOG debug name ClassNotFoundException e LOG LOG debug e toString ex e c c parent loadClass name LOG c
activeTasks waitingTasks BlockingQueue Runnable workQueue LinkedBlockingQueue waitingTasks activeTasks activeTasks activeTasks workQueue Runnable
ee status ee getExitCode String msg ee getMessage status
ee status ee getExitCode String msg ee getMessage status LOG debug status msg ee
ee status ee getExitCode String msg ee getMessage status
ee status ee getExitCode String msg ee getMessage status LOG debug status msg ee
fileName File file File fileName file file List String lines ArrayList String String line line lines add line LOG LOG debug lines size fileName lines toArray String lines size LOG debug fileName
DocumentBuilder db builder newDocumentBuilder dom db parse fileInputStream Element doc dom getDocumentElement NodeList nodes doc getElementsByTagName i i nodes i Node node nodes item i node Node Element e Element node String v readFirstTagValue e String hosts StringUtils getTrimmedStrings v String str readFirstTagValue e Integer timeout str Integer parseInt str String host hosts map put host timeout
dom db parse fileInputStream Element doc dom getDocumentElement NodeList nodes doc getElementsByTagName i i nodes i Node node nodes item i node Node Element e Element node String v readFirstTagValue e String hosts StringUtils getTrimmedStrings v String str readFirstTagValue e Integer timeout str Integer parseInt str String host hosts map put host timeout LOG info host type filename e
includesFile LOG info includesFile
maxMemory percentage String mapName percentage percentage HadoopIllegalArgumentException percentage maxMemory HadoopIllegalArgumentException maxMemory percentage maxMemory String vmBit System getProperty percentDivisor percentage percentMemory maxMemory percentDivisor e1 Math log percentMemory Math log e2 e1 equals vmBit exponent e2 e2 e2 c exponent LOG info mapName
percentage percentage HadoopIllegalArgumentException percentage maxMemory HadoopIllegalArgumentException maxMemory percentage maxMemory String vmBit System getProperty percentDivisor percentage percentMemory maxMemory percentDivisor e1 Math log percentMemory Math log e2 e1 equals vmBit exponent e2 e2 e2 c exponent LOG info mapName LOG info vmBit
HadoopIllegalArgumentException percentage maxMemory HadoopIllegalArgumentException maxMemory percentage maxMemory String vmBit System getProperty percentDivisor percentage percentMemory maxMemory percentDivisor e1 Math log percentMemory Math log e2 e1 equals vmBit exponent e2 e2 e2 c exponent LOG info mapName LOG info vmBit LOG info percentage StringUtils TraditionalBinaryPrefix long2String maxMemory StringUtils TraditionalBinaryPrefix long2String percentMemory
ShellCommandExecutor shexec setsidSupported String args shexec ShellCommandExecutor args shexec execute LOG debug setsidSupported LOG debug setsidSupported
conf EXECUTOR shutdown shutdownTimeout getShutdownTimeout conf EXECUTOR shutdownTimeout
registered IllegalStateException registered StringBuilder bld StringBuilder bld append String SIGNALS String separator String signalName SIGNALS Handler signalName LOG bld append separator append signalName separator e LOG debug e bld append
clazz String String hostname NetUtils getHostname String classname clazz getSimpleName
executorService shutdown logger debug timeout unit executorService timeout unit logger debug timeout unit executorService shutdownNow executorService timeout unit logger debug logger error timeout unit e logger error e executorService shutdownNow e logger warn e getMessage
LOG info LOG info i i testsFromConfigFile i CLITestData td testsFromConfigFile get i testResult td getTestResult testResult LOG info LOG info i
LOG info LOG info i i testsFromConfigFile i CLITestData td testsFromConfigFile get i testResult td getTestResult testResult LOG info LOG info i LOG info td getTestDesc LOG info ArrayList CLICommand testCommands td getTestCommands CLICommand testCommands
LOG info i i testsFromConfigFile i CLITestData td testsFromConfigFile get i testResult td getTestResult testResult LOG info LOG info i LOG info td getTestDesc LOG info ArrayList CLICommand testCommands td getTestCommands CLICommand cmd testCommands LOG info expandCommand cmd getCmd LOG info ArrayList CLICommand cleanupCommands td getCleanupCommands CLICommand cmd cleanupCommands
LOG info LOG info i LOG info td getTestDesc LOG info ArrayList CLICommand testCommands td getTestCommands CLICommand cmd testCommands LOG info expandCommand cmd getCmd LOG info ArrayList CLICommand cleanupCommands td getCleanupCommands CLICommand cmd cleanupCommands LOG info expandCommand cmd getCmd LOG info ArrayList ComparatorData compdata td getComparatorData ComparatorData cd compdata resultBoolean cd getTestResult
LOG info i LOG info td getTestDesc LOG info ArrayList CLICommand testCommands td getTestCommands CLICommand cmd testCommands LOG info expandCommand cmd getCmd LOG info ArrayList CLICommand cleanupCommands td getCleanupCommands CLICommand cmd cleanupCommands LOG info expandCommand cmd getCmd LOG info ArrayList ComparatorData compdata td getComparatorData ComparatorData cd compdata resultBoolean cd getTestResult LOG info cd getComparatorType
LOG info td getTestDesc LOG info ArrayList CLICommand testCommands td getTestCommands CLICommand cmd testCommands LOG info expandCommand cmd getCmd LOG info ArrayList CLICommand cleanupCommands td getCleanupCommands CLICommand cmd cleanupCommands LOG info expandCommand cmd getCmd LOG info ArrayList ComparatorData compdata td getComparatorData ComparatorData cd compdata resultBoolean cd getTestResult LOG info cd getComparatorType LOG info resultBoolean
LOG info ArrayList CLICommand testCommands td getTestCommands CLICommand cmd testCommands LOG info expandCommand cmd getCmd LOG info ArrayList CLICommand cleanupCommands td getCleanupCommands CLICommand cmd cleanupCommands LOG info expandCommand cmd getCmd LOG info ArrayList ComparatorData compdata td getComparatorData ComparatorData cd compdata resultBoolean cd getTestResult LOG info cd getComparatorType LOG info resultBoolean LOG info expandCommand cd getExpectedOutput
overallResults totalPass totalFail totalComparators i i testsFromConfigFile size i CLITestData td testsFromConfigFile get i totalComparators testsFromConfigFile get i getComparatorData size resultBoolean td getTestResult resultBoolean totalPass totalFail overallResults resultBoolean LOG info testMode LOG info
totalPass totalFail totalComparators i i testsFromConfigFile size i CLITestData td testsFromConfigFile get i totalComparators testsFromConfigFile get i getComparatorData size resultBoolean td getTestResult resultBoolean totalPass totalFail overallResults resultBoolean LOG info testMode LOG info LOG info overallResults
totalComparators i i testsFromConfigFile size i CLITestData td testsFromConfigFile get i totalComparators testsFromConfigFile get i getComparatorData size resultBoolean td getTestResult resultBoolean totalPass totalFail overallResults resultBoolean LOG info testMode LOG info LOG info overallResults totalPass totalFail LOG info
LOG info totalPass totalPass totalPass totalFail LOG info totalFail totalFail totalPass totalFail LOG info totalComparators LOG info LOG info LOG info i foundTests i i testsFromConfigFile i resultBoolean testsFromConfigFile get i getTestResult resultBoolean LOG info i testsFromConfigFile get i getTestDesc foundTests foundTests
HashMap String String fields fields HashMap String String retVal HashMap String propRegex Pattern p Pattern compile propRegex String value fields
LOG_CONFIG debug value value endsWith value endsWith value endsWith value skipPrefix value skipPrefix skipPrefix Matcher m p matcher value m LOG_CONFIG debug
HashMap String String String filename filename Configuration conf Configuration conf setAllowNullValueProperties conf addResource filename HashMap String String retVal HashMap Iterator Map Entry String String kvItr conf iterator kvItr Map Entry String String entry kvItr next String key entry getKey key LOG_XML debug key key
Configuration conf Configuration conf setAllowNullValueProperties conf addResource filename HashMap String String retVal HashMap Iterator Map Entry String String kvItr conf iterator kvItr Map Entry String String entry kvItr next String key entry getKey key LOG_XML debug key key LOG_XML debug key conf key
Iterator Map Entry String String kvItr conf iterator kvItr Map Entry String String entry kvItr next String key entry getKey key LOG_XML debug key key LOG_XML debug key conf key retVal put key LOG_XML debug key conf key
f getName shValue f get retVal put f getName Integer toString shValue f getName iValue f get retVal put f getName Integer toString iValue f getName lValue f get retVal put f getName Long toString lValue f getName fValue f get retVal put f getName Float toString fValue f getName dValue f get retVal put f getName Double toString dValue
retVal put f getName Integer toString shValue f getName iValue f get retVal put f getName Integer toString iValue f getName lValue f get retVal put f getName Long toString lValue f getName fValue f get retVal put f getName Float toString fValue f getName dValue f get retVal put f getName Double toString dValue f getName bValue f get
assertNotNull xmlFilename assertNotNull configurationClasses missingXmlSize configurationFieldsMissingInXmlFile size configurationClasses
assertNotNull xmlFilename assertNotNull configurationClasses missingXmlSize configurationFieldsMissingInXmlFile size c configurationClasses LOG info c toString LOG info configurationMemberVariables size StringBuilder xmlErrorMsg StringBuilder c configurationClasses xmlErrorMsg append c xmlErrorMsg append xmlErrorMsg append xmlErrorMsg append missingXmlSize xmlErrorMsg append xmlErrorMsg append xmlFilename
sb sb append
assertNotNull xmlFilename assertNotNull configurationClasses missingConfigSize xmlFieldsMissingInConfiguration size
assertNotNull xmlFilename assertNotNull configurationClasses missingConfigSize xmlFieldsMissingInConfiguration size LOG info xmlFilename xmlKeyValueMap size StringBuilder configErrorMsg StringBuilder configErrorMsg append xmlFilename configErrorMsg append configErrorMsg append missingConfigSize configErrorMsg append Arrays stream configurationClasses forEach c configErrorMsg append append c
defaultValueCheck3 defaultConfigName defaultNameCheck3 defaultConfigValue defaultValueCheck3 defaultConfigValue xmlDefaultValue xmlPropertiesWithEmptyValue add xmlProperty xmlDefaultValue defaultConfigValue HashMap String String xmlEntry HashMap xmlEntry put xmlProperty xmlDefaultValue HashMap String String configEntry HashMap configEntry put defaultConfigName defaultConfigValue mismatchingXmlConfig put xmlEntry configEntry xmlPropertiesMatchingConfigDefault put xmlProperty defaultConfigName
HashMap String String xmlEntry HashMap xmlEntry put xmlProperty xmlDefaultValue HashMap String String configEntry HashMap configEntry put defaultConfigName defaultConfigValue mismatchingXmlConfig put xmlEntry configEntry xmlPropertiesMatchingConfigDefault put xmlProperty defaultConfigName configPropertiesWithNoDefaultConfig add configProperty LOG info xmlFilename mismatchingXmlConfig size mismatchingXmlConfig LOG info HashMap String String HashMap String String mismatchingXmlConfig
mismatchingXmlConfig put xmlEntry configEntry xmlPropertiesMatchingConfigDefault put xmlProperty defaultConfigName configPropertiesWithNoDefaultConfig add configProperty LOG info xmlFilename mismatchingXmlConfig size mismatchingXmlConfig LOG info mismatchingXmlConfig key value LOG info key LOG info value key value
configPropertiesWithNoDefaultConfig add configProperty LOG info xmlFilename mismatchingXmlConfig size mismatchingXmlConfig LOG info mismatchingXmlConfig key value LOG info key LOG info value key value LOG info key LOG info value
RandomDatum key generator getKey RandomDatum value generator getValue key write data value write data LOG info count DataOutputBuffer encryptedDataBuffer DataOutputBuffer CryptoOutputStream out CryptoOutputStream encryptedDataBuffer encCodec bufferSize key iv out write data getData data getLength out flush out close LOG info CryptoCodec decCodec decCodec CryptoCodec ReflectionUtils newInstance conf getClassByName decCodecClass conf
valueQueue queueName size valueQueue getSize queueName size
fc Path testRoot fileContextTestHelper getAbsoluteTestRootPath fc
Path pathString Path p Path pathString makeQualified fs getUri getTestBaseDir
Iterator LongStatistic iter storageStatistics getLongStatistics iter LongStatistic longStat iter next assertNotNull longStat expectedStat getStatisticsValue longStat getName
key expectedStat getStatisticsValue key storageStat storageStatistics getLong key
errors m m m m MustNotImplement getMethod m getName m getParameterTypes FilterFileSystem getDeclaredMethod m getName m getParameterTypes LOG error m errors FilterFileSystem getDeclaredMethod m getName m getParameterTypes
m Modifier isStatic m getModifiers Modifier isPrivate m getModifiers Modifier isFinal m getModifiers DontCheck getMethod m getName m getParameterTypes
args exitCode shell run args
shell setConf conf String args String args args res shell run args System out println res shell setConf conf ByteArrayOutputStream bytes ByteArrayOutputStream PrintStream out PrintStream bytes PrintStream oldErr System err System setErr out String results run shell run args results bytes toString
args exitCode shell run args
errors m m m m MustNotImplement getMethod m getName m getParameterTypes HarFileSystem getDeclaredMethod m getName m getParameterTypes LOG error m errors HarFileSystem getDeclaredMethod m getName m getParameterTypes
assumeNotWindows Configuration conf Configuration conf set CommonConfigurationKeys FS_PERMISSIONS_UMASK_KEY LocalFileSystem localfs FileSystem getLocal conf String filename Path f writeFile localfs filename List String groups groups getGroups
assumeNotWindows LocalFileSystem localfs FileSystem getLocal Configuration Configuration conf localfs getConf conf set CommonConfigurationKeys FS_PERMISSIONS_UMASK_KEY
String testFilename Path path Path testDir testFilename RawLocalFileSystem rfs RawLocalFileSystem Configuration conf Configuration rfs initialize rfs getUri conf rfs createNewFile path File file rfs pathToFile path defaultBlockSize rfs getDefaultBlockSize path RawLocalFileSystem DeprecatedRawLocalFileStatus fsNIO RawLocalFileSystem DeprecatedRawLocalFileStatus file defaultBlockSize rfs fsNIO loadPermissionInfoByNativeIO RawLocalFileSystem DeprecatedRawLocalFileStatus fsnonNIO RawLocalFileSystem DeprecatedRawLocalFileStatus file defaultBlockSize rfs fsnonNIO loadPermissionInfoByNonNativeIO assertEquals fsNIO getOwner fsnonNIO getOwner assertEquals fsNIO getGroup fsnonNIO getGroup assertEquals fsNIO getPermission fsnonNIO getPermission
file origDigest ContractTestUtils NanoTimer timer2 ContractTestUtils NanoTimer Assertions assertThat digest file describedAs file isEqualTo origDigest digest timer2 end file
MessageDigest digest1 DigestUtils getMd5Digest digest1 update payload1 UploadHandle upload1 startUpload file Map Integer PartHandle partHandles1 HashMap size2 size1 partId2 payload2 generatePayload partId1 size2 MessageDigest digest2 DigestUtils getMd5Digest digest2 update payload2 UploadHandle upload2 upload2 startUpload file Assume assumeTrue concurrent concurrent
skipIfUnsupported TEST_ROOT_TESTS_ENABLED Path root Path assertIsDirectory root deleted getFileSystem delete root
skipIfUnsupported TEST_ROOT_TESTS_ENABLED Path root Path assertIsDirectory root FileSystem fs getFileSystem AtomicInteger iterations AtomicInteger FileStatus originalChildren listChildren fs root FileStatus deleted deleteChildren fs root FileStatus children listChildren fs root children fail String format iterations incrementAndGet dumpStats children dumpStats deleted dumpStats originalChildren deleted fs delete root
skipIfUnsupported TEST_ROOT_TESTS_ENABLED Path root Path assertIsDirectory root Path file Path ContractTestUtils touch getFileSystem file deleted getFileSystem delete root assertIsDirectory root
Thread currentThread setName LOG debug contract createContract createConfiguration contract init assumeEnabled fileSystem contract getTestFileSystem assertNotNull fileSystem URI fsURI fileSystem getUri
FileStatus fileSystem path recursive LOG debug path recursive FileStatus children listChildren fileSystem path FileStatus children
TreeScanResults fs path TreeScanResults dirsAndFiles TreeScanResults FileStatus statuses fs listStatus path FileStatus statuses
barrier DFSClientThread threads DFSClientThread numOfThreads i i numOfThreads i threads i DFSClientThread i threads i start durations durations shouldRun Thread sleep totalTime totalTime durations shouldRun shouldRun Thread sleep durations currentIndex
ViewFileSystem viewfs ViewFileSystem fsView MountPoint mountPoints viewfs getMountPoints MountPoint mountPoints
Path actualMountLinkTarget fsView getLinkTarget mountTargetSymLinkPath assertEquals expectedMountLinkTarget actualMountLinkTarget String relativeFileName targetFileName String link2FileName Path relTargetFile Path targetTestRoot relativeFileName Path relativeSymLink Path targetTestRoot link2FileName fsTarget createSymlink relTargetFile relativeSymLink Path mountTargetRelativeSymLinkPath Path mountTargetRootPath link2FileName Path expectedMountRelLinkTarget fsTarget makeQualified Path targetTestRoot relativeFileName Path actualMountRelLinkTarget fsView getLinkTarget mountTargetRelativeSymLinkPath assertEquals expectedMountRelLinkTarget actualMountRelLinkTarget fsView getLinkTarget Path fail
fsTarget createSymlink relTargetFile relativeSymLink Path mountTargetRelativeSymLinkPath Path mountTargetRootPath link2FileName Path expectedMountRelLinkTarget fsTarget makeQualified Path targetTestRoot relativeFileName Path actualMountRelLinkTarget fsView getLinkTarget mountTargetRelativeSymLinkPath assertEquals expectedMountRelLinkTarget actualMountRelLinkTarget fsView getLinkTarget Path fail e LOG info e assertThat e getMessage containsString fsView getLinkTarget fsView makeQualified Path mountTargetRootPath targetFileName fail e
fsView getLinkTarget Path fail e LOG info e assertThat e getMessage containsString fsView getLinkTarget fsView makeQualified Path mountTargetRootPath targetFileName fail e LOG info e assertThat e getMessage containsString fsView getLinkTarget Path fail e
idx Stat stat Stat data zks getZKDatabase getData DummyZKFC LOCK_ZNODE stat assertArrayEquals Ints toByteArray svcs get idx index data session stat getEphemeralOwner
String args errOutBytes reset outBytes reset LOG info Joiner on join args ret tool run args errOutput String errOutBytes toByteArray Charsets UTF_8 output String outBytes toByteArray Charsets UTF_8
STRESS_RUNTIME_SECS cluster start st Time now runFor STRESS_RUNTIME_SECS i Time now st runFor from i to i
STRESS_RUNTIME_SECS cluster start st Time now runFor STRESS_RUNTIME_SECS Random r Random Time now st runFor cluster getTestContext checkException targetIdx r nextInt ActiveStandbyElector target cluster getElector targetIdx sessId target getZKSessionIdForTests sessId
Configuration conf Configuration conf setInt HttpServer2 HTTP_MAX_THREADS_KEY MAX_THREADS server createTestServer conf server addServlet EchoServlet server addServlet EchoMapServlet server addServlet HtmlContentServlet server addServlet LongHeaderServlet server addJerseyResourcePackage JerseyResource getPackage getName server start baseUrl getServerURL server
LOG info String js readOutput URL baseUrl Map String Object m parse js
conf server createTestServer conf server addJerseyResourcePackage JerseyResource getPackage getName server start baseUrl getServerURL server
turnOnSSLDebugLogging storeHttpsCipherSuites Configuration conf Configuration conf setInt HttpServer2 HTTP_MAX_THREADS_KEY File base File BASEDIR FileUtil fullyDelete base base mkdirs keystoreDir File BASEDIR getAbsolutePath sslConfDir KeyStoreTestUtil getClasspathDir TestSSLHttpServer KeyStoreTestUtil setupSSLConfig keystoreDir sslConfDir conf EXCLUDED_CIPHERS Configuration sslConf KeyStoreTestUtil getSslConfig clientSslFactory SSLFactory SSLFactory Mode CLIENT sslConf clientSslFactory init setupServer conf sslConf baseUrl URL NetUtils getHostPortString server getConnectorAddress
String cipherSuites System getProperty HTTPS_CIPHER_SUITES_KEY cipherSuites
HttpsURLConnection url HttpsURLConnection conn HttpsURLConnection url openConnection SSLSocketFactory sslSocketFactory clientSslFactory createSSLSocketFactory
HttpsURLConnection url HttpsURLConnection conn HttpsURLConnection url openConnection SSLSocketFactory sslSocketFactory clientSslFactory createSSLSocketFactory
fs file Configuration conf Configuration MapFile delete fs file
RandomDatum RandomDatum v RandomDatum
fs RandomDatum data file conf RandomDatum v RandomDatum LOG LOG debug data length ArrayFile Reader reader ArrayFile Reader fs file conf i i data length i reader get i v v data i RuntimeException i i data length i i reader get i v v data i RuntimeException i LOG
Path fpath FileSystem fs i args i args i args i count Integer parseInt args i args i create args i check file args i fpath Path file
FileSystem fs i args i args i args i count Integer parseInt args i args i create args i check file args i fpath Path file fs fpath getFileSystem conf
i args i args i args i count Integer parseInt args i args i create args i check file args i fpath Path file fs fpath getFileSystem conf LOG info count
i args i args i args i count Integer parseInt args i args i create args i check file args i fpath Path file fs fpath getFileSystem conf LOG info count LOG info create
conf set LOG info Integer testInt Integer valueOf DefaultStringifier Integer stringifier DefaultStringifier Integer conf Integer String str stringifier toString testInt Integer claimedInt stringifier fromString str
count megabytes factor Path file Path GenericTestUtils getTempPath Path recordCompressedFile Path GenericTestUtils getTempPath Path blockCompressedFile Path GenericTestUtils getTempPath seed Random nextInt
fs file fs delete file
RandomDatum key generator getKey RandomDatum value generator getValue i rawKey reset reader nextRaw rawKey rawValue i reader next k reader getCurrentValue v reader next k v k equals key RuntimeException i v equals value RuntimeException i
RandomDatum value generator getValue i rawKey reset reader nextRaw rawKey rawValue i reader next k reader getCurrentValue v reader next k v k equals key RuntimeException i v equals value RuntimeException i LOG info i
i rawKey reset reader nextRaw rawKey rawValue i reader next k reader getCurrentValue v reader next k v k equals key RuntimeException i v equals value RuntimeException i LOG info i LOG info key
i rawKey reset reader nextRaw rawKey rawValue i reader next k reader getCurrentValue v reader next k v k equals key RuntimeException i v equals value RuntimeException i LOG info i LOG info key LOG info key getLength
rawKey reset reader nextRaw rawKey rawValue i reader next k reader getCurrentValue v reader next k v k equals key RuntimeException i v equals value RuntimeException i LOG info i LOG info key LOG info key getLength LOG info k
reader nextRaw rawKey rawValue i reader next k reader getCurrentValue v reader next k v k equals key RuntimeException i v equals value RuntimeException i LOG info i LOG info key LOG info key getLength LOG info k LOG info k getLength
i reader next k reader getCurrentValue v reader next k v k equals key RuntimeException i v equals value RuntimeException i LOG info i LOG info key LOG info key getLength LOG info k LOG info k getLength LOG info value
i reader next k reader getCurrentValue v reader next k v k equals key RuntimeException i v equals value RuntimeException i LOG info i LOG info key LOG info key getLength LOG info k LOG info k getLength LOG info value
i reader next k reader getCurrentValue v reader next k v k equals key RuntimeException i v equals value RuntimeException i LOG info i LOG info key LOG info key getLength LOG info k LOG info k getLength LOG info value LOG info value getLength
reader next k reader getCurrentValue v reader next k v k equals key RuntimeException i v equals value RuntimeException i LOG info i LOG info key LOG info key getLength LOG info k LOG info k getLength LOG info value LOG info value getLength LOG info v
reader getCurrentValue v reader next k v k equals key RuntimeException i v equals value RuntimeException i LOG info i LOG info key LOG info key getLength LOG info k LOG info k getLength LOG info value LOG info value getLength LOG info v LOG info v getLength
fs megabytes factor fast Path file fs delete Path file SequenceFile Sorter sorter newSorter fs fast megabytes factor
fs count megabytes factor fast Path file fs delete Path file SequenceFile Sorter sorter newSorter fs fast megabytes factor LOG debug count sorter sort file file suffix
RandomDatum value generator getValue map put key value LOG debug count RandomDatum k RandomDatum RandomDatum v RandomDatum Iterator Map Entry RandomDatum RandomDatum iterator map entrySet iterator SequenceFile Reader reader SequenceFile Reader fs file suffix conf i i count i Map Entry RandomDatum RandomDatum entry iterator next RandomDatum key entry getKey RandomDatum value entry getValue reader next k v k equals key RuntimeException i v equals value RuntimeException i reader close
Path file Path GenericTestUtils getTempPath Path sortedFile Path GenericTestUtils getTempPath Path recordCompressedFile Path GenericTestUtils getTempPath Path blockCompressedFile Path GenericTestUtils getTempPath FileSystem fs FileSystem getLocal conf SequenceFile Metadata theMetadata SequenceFile Metadata theMetadata set Text Text theMetadata set Text Text theMetadata set Text Text theMetadata set Text Text seed Random nextInt writeMetadataTest fs count seed file CompressionType NONE theMetadata SequenceFile Metadata aMetadata readMetadata fs file theMetadata aMetadata
Path sortedFile Path GenericTestUtils getTempPath Path recordCompressedFile Path GenericTestUtils getTempPath Path blockCompressedFile Path GenericTestUtils getTempPath FileSystem fs FileSystem getLocal conf SequenceFile Metadata theMetadata SequenceFile Metadata theMetadata set Text Text theMetadata set Text Text theMetadata set Text Text theMetadata set Text Text seed Random nextInt writeMetadataTest fs count seed file CompressionType NONE theMetadata SequenceFile Metadata aMetadata readMetadata fs file theMetadata aMetadata LOG info theMetadata toString
theMetadata set Text Text theMetadata set Text Text theMetadata set Text Text theMetadata set Text Text seed Random nextInt writeMetadataTest fs count seed file CompressionType NONE theMetadata SequenceFile Metadata aMetadata readMetadata fs file theMetadata aMetadata LOG info theMetadata toString LOG info aMetadata toString RuntimeException writeMetadataTest fs count seed recordCompressedFile CompressionType RECORD codec theMetadata aMetadata readMetadata fs recordCompressedFile theMetadata aMetadata
theMetadata set Text Text theMetadata set Text Text theMetadata set Text Text seed Random nextInt writeMetadataTest fs count seed file CompressionType NONE theMetadata SequenceFile Metadata aMetadata readMetadata fs file theMetadata aMetadata LOG info theMetadata toString LOG info aMetadata toString RuntimeException writeMetadataTest fs count seed recordCompressedFile CompressionType RECORD codec theMetadata aMetadata readMetadata fs recordCompressedFile theMetadata aMetadata LOG info theMetadata toString
writeMetadataTest fs count seed file CompressionType NONE theMetadata SequenceFile Metadata aMetadata readMetadata fs file theMetadata aMetadata LOG info theMetadata toString LOG info aMetadata toString RuntimeException writeMetadataTest fs count seed recordCompressedFile CompressionType RECORD codec theMetadata aMetadata readMetadata fs recordCompressedFile theMetadata aMetadata LOG info theMetadata toString LOG info aMetadata toString RuntimeException writeMetadataTest fs count seed blockCompressedFile CompressionType BLOCK codec theMetadata aMetadata readMetadata fs blockCompressedFile theMetadata aMetadata
SequenceFile Metadata aMetadata readMetadata fs file theMetadata aMetadata LOG info theMetadata toString LOG info aMetadata toString RuntimeException writeMetadataTest fs count seed recordCompressedFile CompressionType RECORD codec theMetadata aMetadata readMetadata fs recordCompressedFile theMetadata aMetadata LOG info theMetadata toString LOG info aMetadata toString RuntimeException writeMetadataTest fs count seed blockCompressedFile CompressionType BLOCK codec theMetadata aMetadata readMetadata fs blockCompressedFile theMetadata aMetadata LOG info theMetadata toString
writeMetadataTest fs count seed recordCompressedFile CompressionType RECORD codec theMetadata aMetadata readMetadata fs recordCompressedFile theMetadata aMetadata LOG info theMetadata toString LOG info aMetadata toString RuntimeException writeMetadataTest fs count seed blockCompressedFile CompressionType BLOCK codec theMetadata aMetadata readMetadata fs blockCompressedFile theMetadata aMetadata LOG info theMetadata toString LOG info aMetadata toString RuntimeException sortMetadataTest fs file sortedFile theMetadata aMetadata readMetadata fs recordCompressedFile theMetadata aMetadata
writeMetadataTest fs count seed recordCompressedFile CompressionType RECORD codec theMetadata aMetadata readMetadata fs recordCompressedFile theMetadata aMetadata LOG info theMetadata toString LOG info aMetadata toString RuntimeException writeMetadataTest fs count seed blockCompressedFile CompressionType BLOCK codec theMetadata aMetadata readMetadata fs blockCompressedFile theMetadata aMetadata LOG info theMetadata toString LOG info aMetadata toString RuntimeException sortMetadataTest fs file sortedFile theMetadata aMetadata readMetadata fs recordCompressedFile theMetadata aMetadata
fs file fs delete file
fs sortedFile fs delete sortedFile
args i rwonly args i create args i check args i fast args i merge args i compressType args i args i compressionCodec args i
args i create args i check args i fast args i merge args i compressType args i args i compressionCodec args i file Path args i TestSequenceFile test TestSequenceFile
create args i check args i fast args i merge args i compressType args i args i compressionCodec args i file Path args i TestSequenceFile test TestSequenceFile fs file getFileSystem test conf
args i check args i fast args i merge args i compressType args i args i compressionCodec args i file Path args i TestSequenceFile test TestSequenceFile fs file getFileSystem test conf LOG info count
args i check args i fast args i merge args i compressType args i args i compressionCodec args i file Path args i TestSequenceFile test TestSequenceFile fs file getFileSystem test conf LOG info count
check args i fast args i merge args i compressType args i args i compressionCodec args i file Path args i TestSequenceFile test TestSequenceFile fs file getFileSystem test conf LOG info count LOG info megabytes
args i fast args i merge args i compressType args i args i compressionCodec args i file Path args i TestSequenceFile test TestSequenceFile fs file getFileSystem test conf LOG info count LOG info megabytes LOG info factor
fs file MapFile delete fs file
RandomDatum data RandomDatum v RandomDatum sample Math sqrt data length Random random Random
i args i args i args i count Integer parseInt args i args i create args i check args i compress args i file args i fpath Path file
i args i args i args i count Integer parseInt args i args i create args i check args i compress args i file args i fpath Path file fs fpath getFileSystem conf
args i args i count Integer parseInt args i args i create args i check args i compress args i file args i fpath Path file fs fpath getFileSystem conf LOG info count
args i count Integer parseInt args i args i create args i check args i compress args i file args i fpath Path file fs fpath getFileSystem conf LOG info count LOG info create
args i count Integer parseInt args i args i create args i check args i compress args i file args i fpath Path file fs fpath getFileSystem conf LOG info count LOG info create LOG info check
val DataOutputBuffer buf DataOutputBuffer DataInputBuffer inbuf DataInputBuffer WritableUtils writeVInt buf val
val DataOutputBuffer buf DataOutputBuffer DataInputBuffer inbuf DataInputBuffer WritableUtils writeVInt buf val LOG LOG debug val BytesWritable printer BytesWritable printer set buf getData buf getLength
DEFLBYTES Configuration conf Configuration Random rand Random seed rand nextLong
FileSystem fs FileSystem get conf
clazz type records FileSystem fs FileSystem get conf LOG info records clazz getSimpleName Path path Path GenericTestUtils getTempPath clazz getSimpleName type records
Random r Random seed r nextLong r setSeed seed
Random r Random seed r nextLong r setSeed seed
deflateFilter write data getData data getLength deflateFilter finish deflateFilter flush LOG info DataInputBuffer deCompressedDataBuffer DataInputBuffer deCompressedDataBuffer reset compressedDataBuffer getData compressedDataBuffer getLength CompressionInputStream inflateFilter codec createInputStream deCompressedDataBuffer DataInputStream inflateIn DataInputStream BufferedInputStream inflateFilter RandomDatum k1 RandomDatum RandomDatum v1 RandomDatum k1 readFields originalIn v1 readFields originalIn RandomDatum k2 RandomDatum RandomDatum v2 RandomDatum
Random r Random seed r nextLong
BYTE_SIZE bytes BytesGenerator get BYTE_SIZE SnappyCompressor compressor SnappyCompressor compressor setInput bytes bytes length assertTrue compressor getBytesRead assertEquals compressor getBytesWritten maxSize BYTE_SIZE BYTE_SIZE compressed maxSize cSize compressor compress compressed compressed length
BYTE_SIZE bytes BytesGenerator get BYTE_SIZE SnappyCompressor compressor SnappyCompressor compressor setInput bytes bytes length assertTrue compressor getBytesRead assertEquals compressor getBytesWritten maxSize BYTE_SIZE BYTE_SIZE compressed maxSize cSize compressor compress compressed compressed length LOG info BYTE_SIZE
FileOutputStream fos FileOutputStream File TEST_DIR NativeIO POSIX Stat stat NativeIO POSIX getFstat fos getFD fos close
String testFilePath NativeIO POSIX Stat stat NativeIO POSIX getStat testFilePath String owner stat getOwner String group stat getGroup mode stat getMode String expectedOwner System getProperty assertEquals expectedOwner owner assertNotNull group assertTrue group isEmpty StatUtils Permission expected StatUtils getPermissionFromProcess testFilePath StatUtils Permission permission StatUtils Permission owner group FsPermission mode assertEquals expected getOwner permission getOwner assertEquals expected getGroup permission getGroup assertEquals expected getFsPermission permission getFsPermission
String testFilePath NativeIO POSIX Stat stat NativeIO POSIX getStat testFilePath String owner stat getOwner String group stat getGroup mode stat getMode String expectedOwner System getProperty assertEquals expectedOwner owner assertNotNull group assertTrue group isEmpty StatUtils Permission expected StatUtils getPermissionFromProcess testFilePath StatUtils Permission permission StatUtils Permission owner group FsPermission mode assertEquals expected getOwner permission getOwner assertEquals expected getGroup permission getGroup assertEquals expected getFsPermission permission getFsPermission LOG info testFilePath stat
assumeNotWindows LOG info FileDescriptor fd NativeIO POSIX open File TEST_DIR getAbsolutePath O_WRONLY O_CREAT assertNotNull assertTrue fd valid FileOutputStream fos FileOutputStream fd fos write getBytes fos close assertFalse fd valid LOG info fd NativeIO POSIX open File TEST_DIR getAbsolutePath O_WRONLY O_CREAT O_EXCL fail
assumeTrue NativeIO POSIX isPmdkAvailable String filePath length volumnSize NativeIO POSIX Pmem mapBlock filePath length fail e LOG info e getMessage filePath length NativeIO POSIX Pmem mapBlock filePath length fail e
assumeNotWindows assumeTrue NativeIO POSIX isPmdkAvailable String filePath length volumnSize length fileNumber volumnSize length
assumeNotWindows assumeTrue NativeIO POSIX isPmdkAvailable String filePath length volumnSize length fileNumber volumnSize length LOG info fileNumber i i fileNumber i String path filePath i
assumeTrue NativeIO POSIX isPmdkAvailable String filePath length volumnSize length fileNumber volumnSize length LOG info fileNumber i i fileNumber i String path filePath i LOG info path NativeIO POSIX Pmem mapBlock path length NativeIO POSIX Pmem mapBlock filePath length fail
assumeNotWindows assumeTrue NativeIO POSIX isPmdkAvailable String filePath length volumeSize length volumeSize
t String substring String msg StringUtils stringifyException t assertTrue substring msg msg contains substring
SocketFactory spyFactory spy NetUtils getDefaultSocketFactory conf MockSocket spyFactory Server server TestServer Client client Client LongWritable conf spyFactory server start InetSocketAddress address NetUtils getConnectAddress server call client RANDOM nextLong address conf fail
CountDownLatch callFinishedLatch CountDownLatch clients TestServerQueue server TestServerQueue clients readers callQ handlers conf CallQueueManager Call spy spy CallQueueManager Call Whitebox getInternalState server Whitebox setInternalState server spy InetSocketAddress addr NetUtils getConnectAddress server server start Client setConnectTimeout conf Thread threads Thread clients clients threads Thread Client client Client LongWritable conf call client LongWritable Thread currentThread getId addr conf
callFinishedLatch countDown client stop i i initialClients i threads i start i server firstCallLatch await verify spy timeout times i put any server getNumOpenConnections initialClients
server getNumOpenConnections initialClients fail LOG info initialClients server getNumOpenConnections LOG info assertEquals callQ server getCallQueueLen assertEquals initialClients server getNumOpenConnections i initialClients i i threads i start Thread sleep
CountDownLatch allCallLatch CountDownLatch clients AtomicBoolean error AtomicBoolean TestServer server TestServer clients Thread threads Thread clients server AtomicBoolean first AtomicBoolean allCallLatch countDown first firstCallBarrier await callBarrier await
Configuration conf Configuration TestProtoBufRpcServerHandoffServer serverImpl TestProtoBufRpcServerHandoffServer BlockingService blockingService TestProtobufRpcHandoffProto newReflectiveBlockingService serverImpl RPC setProtocolEngine conf TestProtoBufRpcServerHandoffProtocol ProtobufRpcEngine2 RPC Server server RPC Builder conf setProtocol TestProtoBufRpcServerHandoffProtocol setInstance blockingService setVerbose setNumHandlers build server start InetSocketAddress address server getListenerAddress serverStartTime System currentTimeMillis
RPC Server server RPC Builder conf setProtocol TestProtoBufRpcServerHandoffProtocol setInstance blockingService setVerbose setNumHandlers build server start InetSocketAddress address server getListenerAddress serverStartTime System currentTimeMillis LOG info address serverStartTime TestProtoBufRpcServerHandoffProtocol client RPC getProxy TestProtoBufRpcServerHandoffProtocol address conf ExecutorService executorService Executors newFixedThreadPool CompletionService ClientInvocationCallable completionService ExecutorCompletionService ClientInvocationCallable executorService completionService submit ClientInvocationCallable client completionService submit ClientInvocationCallable client submitTime System currentTimeMillis Future ClientInvocationCallable future1 completionService take Future ClientInvocationCallable future2 completionService take ClientInvocationCallable callable1 future1 get ClientInvocationCallable callable2 future2 get
server start InetSocketAddress address server getListenerAddress serverStartTime System currentTimeMillis LOG info address serverStartTime TestProtoBufRpcServerHandoffProtocol client RPC getProxy TestProtoBufRpcServerHandoffProtocol address conf ExecutorService executorService Executors newFixedThreadPool CompletionService ClientInvocationCallable completionService ExecutorCompletionService ClientInvocationCallable executorService completionService submit ClientInvocationCallable client completionService submit ClientInvocationCallable client submitTime System currentTimeMillis Future ClientInvocationCallable future1 completionService take Future ClientInvocationCallable future2 completionService take ClientInvocationCallable callable1 future1 get ClientInvocationCallable callable2 future2 get LOG info callable1 toString
echoRequest2 TestProtos EchoRequestProto2 newBuilder addAllMessage Collections String emptyList build echoResponse2 proxy echo2 echoRequest2 assertTrue Arrays equals echoResponse2 getMessageList toArray String TestProtos AddRequestProto addRequest TestProtos AddRequestProto newBuilder setParam1 setParam2 build TestProtos AddResponseProto addResponse proxy add addRequest assertThat addResponse getResult isEqualTo Integer integers Integer TestProtos AddRequestProto2 addRequest2 TestProtos AddRequestProto2 newBuilder addAllParams Arrays asList integers build addResponse proxy add2 addRequest2 assertThat addResponse getResult isEqualTo caught proxy error newEmptyRequest
Server server TestRpcService proxy Configuration serverConf Configuration conf SecurityUtil setAuthenticationMethod AuthenticationMethod KERBEROS serverConf UserGroupInformation setConfiguration serverConf server setupTestServer serverConf succeeded UserGroupInformation setConfiguration conf proxy getClient addr conf proxy echo newEchoRequest e assertTrue e getCause RemoteException RemoteException re RemoteException e getCause
assertTrue re unwrapRemoteException AccessControlException succeeded stop server proxy assertTrue succeeded conf setInt CommonConfigurationKeys IPC_SERVER_RPC_READ_THREADS_KEY UserGroupInformation setConfiguration serverConf server setupTestServer serverConf succeeded proxy UserGroupInformation setConfiguration conf proxy getClient addr conf proxy echo newEchoRequest
verify spy timeout times i addInternal any eq proxy sleep newSleepRequest e RemoteException re RemoteException e getCause IOException unwrapExeption re unwrapRemoteException unwrapExeption succeeded lastException unwrapExeption executorService shutdown stop server proxy lastException
verify spy timeout times i addInternal any eq Thread sleep proxy sleep newSleepRequest e RemoteException re RemoteException e getCause IOException unwrapExeption re unwrapRemoteException unwrapExeption succeeded lastException unwrapExeption executorService shutdown stop server proxy
beginRawCallVolume MetricsAsserts getLongCounter rb1 beginUniqueCaller MetricsAsserts getIntCounter rb1 TestRpcService proxy getClient addr conf proxy sleep newSleepRequest MetricsRecordBuilder rb2 getMetrics ns decayedCallVolume1 MetricsAsserts getLongCounter rb2 rawCallVolume1 MetricsAsserts getLongCounter rb2 uniqueCaller1 MetricsAsserts getIntCounter rb2 callVolumePriority0 MetricsAsserts getLongGauge rb2 callVolumePriority1 MetricsAsserts getLongGauge rb2 avgRespTimePriority0 MetricsAsserts getDoubleGauge rb2 avgRespTimePriority1 MetricsAsserts getDoubleGauge rb2
beginUniqueCaller MetricsAsserts getIntCounter rb1 TestRpcService proxy getClient addr conf proxy sleep newSleepRequest MetricsRecordBuilder rb2 getMetrics ns decayedCallVolume1 MetricsAsserts getLongCounter rb2 rawCallVolume1 MetricsAsserts getLongCounter rb2 uniqueCaller1 MetricsAsserts getIntCounter rb2 callVolumePriority0 MetricsAsserts getLongGauge rb2 callVolumePriority1 MetricsAsserts getLongGauge rb2 avgRespTimePriority0 MetricsAsserts getDoubleGauge rb2 avgRespTimePriority1 MetricsAsserts getDoubleGauge rb2 LOG info decayedCallVolume1
TestRpcService proxy getClient addr conf proxy sleep newSleepRequest MetricsRecordBuilder rb2 getMetrics ns decayedCallVolume1 MetricsAsserts getLongCounter rb2 rawCallVolume1 MetricsAsserts getLongCounter rb2 uniqueCaller1 MetricsAsserts getIntCounter rb2 callVolumePriority0 MetricsAsserts getLongGauge rb2 callVolumePriority1 MetricsAsserts getLongGauge rb2 avgRespTimePriority0 MetricsAsserts getDoubleGauge rb2 avgRespTimePriority1 MetricsAsserts getDoubleGauge rb2 LOG info decayedCallVolume1 LOG info rawCallVolume1
proxy sleep newSleepRequest MetricsRecordBuilder rb2 getMetrics ns decayedCallVolume1 MetricsAsserts getLongCounter rb2 rawCallVolume1 MetricsAsserts getLongCounter rb2 uniqueCaller1 MetricsAsserts getIntCounter rb2 callVolumePriority0 MetricsAsserts getLongGauge rb2 callVolumePriority1 MetricsAsserts getLongGauge rb2 avgRespTimePriority0 MetricsAsserts getDoubleGauge rb2 avgRespTimePriority1 MetricsAsserts getDoubleGauge rb2 LOG info decayedCallVolume1 LOG info rawCallVolume1 LOG info uniqueCaller1
proxy sleep newSleepRequest MetricsRecordBuilder rb2 getMetrics ns decayedCallVolume1 MetricsAsserts getLongCounter rb2 rawCallVolume1 MetricsAsserts getLongCounter rb2 uniqueCaller1 MetricsAsserts getIntCounter rb2 callVolumePriority0 MetricsAsserts getLongGauge rb2 callVolumePriority1 MetricsAsserts getLongGauge rb2 avgRespTimePriority0 MetricsAsserts getDoubleGauge rb2 avgRespTimePriority1 MetricsAsserts getDoubleGauge rb2 LOG info decayedCallVolume1 LOG info rawCallVolume1 LOG info uniqueCaller1 LOG info callVolumePriority0
proxy sleep newSleepRequest MetricsRecordBuilder rb2 getMetrics ns decayedCallVolume1 MetricsAsserts getLongCounter rb2 rawCallVolume1 MetricsAsserts getLongCounter rb2 uniqueCaller1 MetricsAsserts getIntCounter rb2 callVolumePriority0 MetricsAsserts getLongGauge rb2 callVolumePriority1 MetricsAsserts getLongGauge rb2 avgRespTimePriority0 MetricsAsserts getDoubleGauge rb2 avgRespTimePriority1 MetricsAsserts getDoubleGauge rb2 LOG info decayedCallVolume1 LOG info rawCallVolume1 LOG info uniqueCaller1 LOG info callVolumePriority0 LOG info callVolumePriority1
MetricsRecordBuilder rb2 getMetrics ns decayedCallVolume1 MetricsAsserts getLongCounter rb2 rawCallVolume1 MetricsAsserts getLongCounter rb2 uniqueCaller1 MetricsAsserts getIntCounter rb2 callVolumePriority0 MetricsAsserts getLongGauge rb2 callVolumePriority1 MetricsAsserts getLongGauge rb2 avgRespTimePriority0 MetricsAsserts getDoubleGauge rb2 avgRespTimePriority1 MetricsAsserts getDoubleGauge rb2 LOG info decayedCallVolume1 LOG info rawCallVolume1 LOG info uniqueCaller1 LOG info callVolumePriority0 LOG info callVolumePriority1 LOG info avgRespTimePriority0
proxy getClient addr c proxy sleep newSleepRequest fail e assertTrue e getCause SocketTimeoutException LOG info e Configuration c Configuration conf c setBoolean CommonConfigurationKeys IPC_CLIENT_PING_KEY c setInt CommonConfigurationKeys IPC_CLIENT_RPC_TIMEOUT_KEY proxy getClient addr c proxy sleep newSleepRequest fail e assertTrue e getCause SocketTimeoutException
Configuration c Configuration conf c setBoolean CommonConfigurationKeys IPC_CLIENT_PING_KEY c setInt CommonConfigurationKeys IPC_CLIENT_RPC_TIMEOUT_KEY proxy getClient addr c proxy sleep newSleepRequest fail e assertTrue e getCause SocketTimeoutException LOG info e Configuration c Configuration conf c setInt CommonConfigurationKeys IPC_CLIENT_RPC_TIMEOUT_KEY proxy getClient addr c proxy sleep newSleepRequest
LOG info e Configuration c Configuration conf c setInt CommonConfigurationKeys IPC_CLIENT_RPC_TIMEOUT_KEY proxy getClient addr c proxy sleep newSleepRequest e LOG info e fail Configuration c Configuration conf c setBoolean CommonConfigurationKeys IPC_CLIENT_PING_KEY c setInt CommonConfigurationKeys IPC_PING_INTERVAL_KEY c setInt CommonConfigurationKeys IPC_CLIENT_RPC_TIMEOUT_KEY proxy getClient addr c
proxy sleep newSleepRequest e LOG info e fail Configuration c Configuration conf c setBoolean CommonConfigurationKeys IPC_CLIENT_PING_KEY c setInt CommonConfigurationKeys IPC_PING_INTERVAL_KEY c setInt CommonConfigurationKeys IPC_CLIENT_RPC_TIMEOUT_KEY proxy getClient addr c proxy sleep newSleepRequest e LOG info e fail
RpcStatusProto RpcStatusProto FATAL RPC Builder builder newServerBuilder conf setQueueSizePerHandler setNumHandlers setVerbose server setupTestServer builder Whitebox setInternalState server FakeRequestClass MutableCounterLong authMetric MutableCounterLong Whitebox getInternalState server getRpcMetrics proxy getClient addr conf isDisconnected Connection lastConn expectedAuths i i i String reqName i
server Thread sleep stop server proxy assertEquals numClients res size f res f get fail e ServiceException se ServiceException e getCause assertTrue se se getCause IOException
i i futures i futures i String expect count getAndIncrement String answer convert proxy echoPostponed newEchoRequest expect assertEquals expect answer futures i get TimeUnit MILLISECONDS Assert fail i proxy sendPostponed newEmptyRequest i i futures i
UserGroupInformation setConfiguration clientConf UserGroupInformation clientUgi UserGroupInformation createRemoteUser clientUgi setAuthenticationMethod clientAuth InetSocketAddress addr NetUtils getConnectAddress server TestTokenIdentifier tokenId TestTokenIdentifier Text clientUgi getUserName Token TestTokenIdentifier token token Token tokenId SecurityUtil setTokenService token addr token Token tokenId tokenId SecurityUtil setTokenService token addr token Token
StringWriter writer StringWriter Logger logger createLogger writer
String filename getTestFilename ConfigBuilder add add add add add add add save filename MetricsConfig mc MetricsConfig create filename
MutableRatesWithAggregation rates MutableRatesWithAggregation n opCount n opTotalTime n i i n i opCount i opTotalTime i rates add i Thread threads Thread n CountDownLatch firstAddsFinished CountDownLatch threads length CountDownLatch firstSnapshotsFinished CountDownLatch CountDownLatch secondAddsFinished CountDownLatch threads length CountDownLatch secondSnapshotsFinished CountDownLatch seed Random nextLong
MetricsCache cache MetricsCache assertNull cache get Arrays asList makeTag MetricsRecord mr makeRecord Arrays asList makeTag Arrays asList makeMetric cache update mr MetricsCache Record cr cache get mr tags
InetAddress localhost getLocalIPAddr String s DNS reverseDns localhost
InetAddress localhost InetAddress getByName assertNotNull localhost
IOException IOException e assertNotNull e IOException wrapped NetUtils wrapException DEST_PORT LOCAL_PORT e
out write byteWithHighBit doIO out TIMEOUT in read readBytes assertTrue Arrays equals writeBytes readBytes assertEquals byteWithHighBit in read doIO in TIMEOUT SocketInputStream in setTimeout TIMEOUT doIO in TIMEOUT SocketInputStream in setTimeout in read fail
StaticMapping mapping newInstance StaticMapping addNodeToRack List String queryList createQueryList List String resolved mapping resolve queryList assertEquals resolved size assertEquals resolved get assertEquals NetworkTopology DEFAULT_RACK resolved get Map String String switchMap mapping getSwitchMap String topology mapping dumpTopology
Configuration conf Configuration conf set StaticMapping KEY_HADOOP_CONFIGURED_NODE_MAPPING mapping setConf conf assertSingleSwitch mapping List String l1 ArrayList String l1 add l1 add l1 add List String resolved mapping resolve l1 assertEquals resolved size assertEquals resolved get assertEquals NetworkTopology DEFAULT_RACK resolved get assertEquals resolved get Map String String switchMap mapping getSwitchMap String topology mapping dumpTopology
StaticMapping staticMapping newInstance assertSingleSwitch staticMapping CachedDNSToSwitchMapping cachedMap CachedDNSToSwitchMapping staticMapping
StaticMapping staticMapping newInstance assertMultiSwitch staticMapping CachedDNSToSwitchMapping cachedMap CachedDNSToSwitchMapping staticMapping
DomainSocket pair DomainSocket socketpair add pair DomainSocket handled incrementAndGet lock lock pairs add pair lock unlock
e LOG error e toString RuntimeException e Random random Random lock lock pairs idx random nextInt pairs size DomainSocket pair pairs remove idx random
DomainSocket pair DomainSocket socketpair add pair DomainSocket handled incrementAndGet lock lock pairs add pair lock unlock TimeUnit MILLISECONDS sleep
LOG error e toString RuntimeException e Random random Random lock lock pairs idx random nextInt pairs size DomainSocket pair pairs remove idx random pair close
String ArrayList String ipList ArrayList Enumeration NetworkInterface netInterfaceList NetworkInterface getNetworkInterfaces netInterfaceList NetworkInterface inf netInterfaceList nextElement Enumeration InetAddress addrList inf getInetAddresses addrList InetAddress addr addrList nextElement ipList add addr getHostAddress StringBuilder builder StringBuilder String ip ipList builder append ip builder append builder append builder append InetAddress getLocalHost getCanonicalHostName
GenericTestUtils setRootLogLevel Level DEBUG Configuration conf Configuration conf set CommonConfigurationKeys HADOOP_SECURITY_GROUP_MAPPING Groups groups Groups conf String username System getProperty List String groupList groups getGroups username
GenericTestUtils setRootLogLevel Level DEBUG Configuration conf Configuration conf set CommonConfigurationKeys HADOOP_SECURITY_GROUP_MAPPING Groups groups Groups conf String username System getProperty List String groupList groups getGroups username
LOG info GenericTestUtils setRootLogLevel Level DEBUG Configuration conf Configuration conf set CommonConfigurationKeys HADOOP_SECURITY_GROUP_MAPPING Groups groups Groups conf String username System getProperty List String groupList groups getGroups username
LOG info GenericTestUtils setRootLogLevel Level DEBUG Configuration conf Configuration conf set CommonConfigurationKeys HADOOP_SECURITY_GROUP_MAPPING Groups groups Groups conf String username System getProperty List String groupList groups getGroups username
conf setLong CommonConfigurationKeys HADOOP_SECURITY_GROUPS_NEGATIVE_CACHE_SECS Groups groups Groups conf groups cacheGroupsAdd Arrays asList myGroups groups refresh FakeGroupMapping clearBlackList FakeGroupMapping addToBlackList assertTrue groups getGroups size FakeGroupMapping addToBlackList assertTrue groups getGroups size TESTLOG error groups getGroups toString fail
args ex exec conf args
File f File kdiag ARG_KEYLEN KEYLEN ARG_KEYTAB keytab getAbsolutePath ARG_PRINCIPAL ARG_OUTPUT f getAbsolutePath
args ex exec conf args
serverSock finLatch await e e printStackTrace ldapServer start LdapGroupsMapping mapping LdapGroupsMapping String ldapUrl serverSock getLocalPort Configuration conf getBaseConf ldapUrl conf setInt CONNECTION_TIMEOUT connectionTimeoutMs mapping setConf conf mapping doGetGroups fail
clientSock getOutputStream write AUTHENTICATE_SUCCESS_MSG finLatch await e e printStackTrace ldapServer start LdapGroupsMapping mapping LdapGroupsMapping String ldapUrl serverSock getLocalPort Configuration conf getBaseConf ldapUrl conf setInt READ_TIMEOUT readTimeoutMs mapping setConf conf mapping doGetGroups fail
RetryPolicy rp RetryPolicies exponentialBackoffRetry Long SIZE TimeUnit MILLISECONDS lastRetry UserGroupInformation getNextTgtRenewalTime endTime currentTime rp assertWithinBounds UserGroupInformation metrics getRenewalFailures value lastRetry reloginIntervalMs currentTime UserGroupInformation metrics getRenewalFailures incr lastRetry UserGroupInformation getNextTgtRenewalTime endTime currentTime rp assertWithinBounds UserGroupInformation metrics getRenewalFailures value lastRetry reloginIntervalMs currentTime UserGroupInformation metrics getRenewalFailures incr lastRetry UserGroupInformation getNextTgtRenewalTime endTime currentTime rp assertWithinBounds UserGroupInformation metrics getRenewalFailures value lastRetry reloginIntervalMs currentTime UserGroupInformation metrics getRenewalFailures incr lastRetry UserGroupInformation getNextTgtRenewalTime endTime currentTime rp assertWithinBounds UserGroupInformation metrics getRenewalFailures value lastRetry reloginIntervalMs currentTime UserGroupInformation metrics getRenewalFailures incr lastRetry UserGroupInformation getNextTgtRenewalTime endTime currentTime rp String str currentTime lastRetry
assertWithinBounds UserGroupInformation metrics getRenewalFailures value lastRetry reloginIntervalMs currentTime UserGroupInformation metrics getRenewalFailures incr lastRetry UserGroupInformation getNextTgtRenewalTime endTime currentTime rp assertWithinBounds UserGroupInformation metrics getRenewalFailures value lastRetry reloginIntervalMs currentTime UserGroupInformation metrics getRenewalFailures incr lastRetry UserGroupInformation getNextTgtRenewalTime endTime currentTime rp assertWithinBounds UserGroupInformation metrics getRenewalFailures value lastRetry reloginIntervalMs currentTime UserGroupInformation metrics getRenewalFailures incr lastRetry UserGroupInformation getNextTgtRenewalTime endTime currentTime rp String str currentTime lastRetry LOG info str assertEquals str endTime reloginIntervalMs lastRetry UserGroupInformation metrics getRenewalFailures incr lastRetry UserGroupInformation getNextTgtRenewalTime endTime currentTime rp str currentTime lastRetry
numFailures lastRetry reloginIntervalMs now shift numFailures lower now reloginIntervalMs shift upper now reloginIntervalMs shift String str String numFailures now lower upper lastRetry
SSLEngine serverSSLEngine serverSSLFactory createSSLEngine SSLEngine clientSSLEngine clientSSLFactory createSSLEngine clientSSLEngine setEnabledCipherSuites StringUtils getTrimmedStrings excludeCiphers SSLSession session clientSSLEngine getSession appBufferMax session getApplicationBufferSize netBufferMax session getPacketBufferSize ByteBuffer clientOut ByteBuffer wrap getBytes ByteBuffer clientIn ByteBuffer allocate appBufferMax ByteBuffer serverOut ByteBuffer wrap getBytes ByteBuffer serverIn ByteBuffer allocate appBufferMax ByteBuffer cTOs ByteBuffer allocateDirect netBufferMax ByteBuffer sTOc ByteBuffer allocateDirect netBufferMax dataDone clientSSLEngine serverSSLEngine
SSLEngine clientSSLEngine clientSSLFactory createSSLEngine clientSSLEngine setEnabledCipherSuites StringUtils getTrimmedStrings excludeCiphers SSLSession session clientSSLEngine getSession appBufferMax session getApplicationBufferSize netBufferMax session getPacketBufferSize ByteBuffer clientOut ByteBuffer wrap getBytes ByteBuffer clientIn ByteBuffer allocate appBufferMax ByteBuffer serverOut ByteBuffer wrap getBytes ByteBuffer serverIn ByteBuffer allocate appBufferMax ByteBuffer cTOs ByteBuffer allocateDirect netBufferMax ByteBuffer sTOc ByteBuffer allocateDirect netBufferMax dataDone clientSSLEngine LOG info wrap clientSSLEngine clientOut cTOs
appBufferMax session getApplicationBufferSize netBufferMax session getPacketBufferSize ByteBuffer clientOut ByteBuffer wrap getBytes ByteBuffer clientIn ByteBuffer allocate appBufferMax ByteBuffer serverOut ByteBuffer wrap getBytes ByteBuffer serverIn ByteBuffer allocate appBufferMax ByteBuffer cTOs ByteBuffer allocateDirect netBufferMax ByteBuffer sTOc ByteBuffer allocateDirect netBufferMax dataDone clientSSLEngine serverSSLEngine LOG info wrap clientSSLEngine clientOut cTOs LOG info wrap serverSSLEngine serverOut sTOc cTOs flip sTOc flip
netBufferMax session getPacketBufferSize ByteBuffer clientOut ByteBuffer wrap getBytes ByteBuffer clientIn ByteBuffer allocate appBufferMax ByteBuffer serverOut ByteBuffer wrap getBytes ByteBuffer serverIn ByteBuffer allocate appBufferMax ByteBuffer cTOs ByteBuffer allocateDirect netBufferMax ByteBuffer sTOc ByteBuffer allocateDirect netBufferMax dataDone clientSSLEngine serverSSLEngine LOG info wrap clientSSLEngine clientOut cTOs LOG info wrap serverSSLEngine serverOut sTOc cTOs flip sTOc flip LOG info unwrap clientSSLEngine sTOc clientIn
expected LOG LOG debug expected
Assert assertEquals STATE NOTINITED getServiceState
Preconditions checkArgument timeoutMillis Preconditions checkNotNull timeoutHandler endTime Time now timeoutMillis Throwable ex running iterations running iterations iterations ex e e Throwable e
e e Throwable e LOG debug iterations e ex e running Time now endTime running sleeptime retry call sleeptime Thread sleep sleeptime running Throwable evaluate evaluate timeoutHandler evaluate timeoutMillis ex
Logger log LoggerFactory getLogger TestGenericTestUtils LogCapturer logCapturer LogCapturer captureLogs log String infoMessage
Logger log LoggerFactory getLogger TestGenericTestUtils LogCapturer logCapturer LogCapturer captureLogs log String infoMessage log info infoMessage assertTrue logCapturer getOutput endsWith String format infoMessage logCapturer clearOutput assertTrue logCapturer getOutput isEmpty logCapturer stopCapturing
Logger logger LoggerFactory getLogger TestGenericTestUtils LogCapturer logCapturer LogCapturer captureLogs logger String infoMessage
Logger logger LoggerFactory getLogger TestGenericTestUtils LogCapturer logCapturer LogCapturer captureLogs logger String infoMessage logger info infoMessage assertTrue logCapturer getOutput endsWith String format infoMessage logCapturer clearOutput assertTrue logCapturer getOutput isEmpty logCapturer stopCapturing
ByteArrayOutputStream baos ByteArrayOutputStream PrintStream out PrintStream baos FindClass setOutputStreams out System err run FindClass SUCCESS FindClass A_PRINTRESOURCE LOG4J_PROPERTIES out flush String body baos toString
IdentityHashStore Key Integer store IdentityHashStore Key Integer NUM_KEYS
KMSRESTConstants jsonKey LOG trace KMSWebApp getAdminCallsMeter mark UserGroupInformation user HttpUserGroupInformation get String name String jsonKey get KMSRESTConstants NAME_FIELD checkNotEmpty name KMSRESTConstants NAME_FIELD assertAccess KMSACLs Type CREATE user KMSOp CREATE_KEY name String cipher String jsonKey get KMSRESTConstants CIPHER_FIELD String material material String jsonKey get KMSRESTConstants MATERIAL_FIELD length jsonKey containsKey KMSRESTConstants LENGTH_FIELD Integer jsonKey get KMSRESTConstants LENGTH_FIELD String description String jsonKey get KMSRESTConstants DESCRIPTION_FIELD
DELETE name LOG trace KMSWebApp getAdminCallsMeter mark UserGroupInformation user HttpUserGroupInformation get assertAccess KMSACLs Type DELETE user KMSOp DELETE_KEY name checkNotEmpty name
KMSWebApp getAdminCallsMeter mark UserGroupInformation user HttpUserGroupInformation get assertAccess KMSACLs Type DELETE user KMSOp DELETE_KEY name checkNotEmpty name LOG debug name user provider deleteKey name provider flush kmsAudit ok user KMSOp DELETE_KEY name LOG trace Response ok build
name LOG trace KMSWebApp getAdminCallsMeter mark UserGroupInformation user HttpUserGroupInformation get assertAccess KMSACLs Type ROLLOVER user KMSOp ROLL_NEW_VERSION name checkNotEmpty name
material assertAccess KMSACLs Type SET_KEY_MATERIAL user KMSOp ROLL_NEW_VERSION name KeyVersion keyVersion user KeyVersion KeyVersion KeyVersion keyVersion material provider rollNewVersion name Base64 decodeBase64 material provider rollNewVersion name provider flush keyVersion kmsAudit ok user KMSOp ROLL_NEW_VERSION name material keyVersion getVersionName KMSACLs Type user keyVersion removeKeyMaterial keyVersion Map json KMSUtil toJSON keyVersion LOG trace Response ok type MediaType APPLICATION_JSON entity json build
name LOG trace KMSWebApp getAdminCallsMeter mark checkNotEmpty name UserGroupInformation user HttpUserGroupInformation get assertAccess KMSACLs Type ROLLOVER user KMSOp INVALIDATE_CACHE name
KMSWebApp getAdminCallsMeter mark checkNotEmpty name UserGroupInformation user HttpUserGroupInformation get assertAccess KMSACLs Type ROLLOVER user KMSOp INVALIDATE_CACHE name LOG debug name user provider invalidateCache name provider flush kmsAudit ok user KMSOp INVALIDATE_CACHE name LOG trace name Response ok build
LOG trace KMSWebApp getAdminCallsMeter mark UserGroupInformation user HttpUserGroupInformation get String keyNames keyNamesList toArray String keyNamesList size assertAccess KMSACLs Type GET_METADATA user KMSOp GET_KEYS_METADATA keysMeta user provider getKeysMetadata keyNames Object json KMSServerJSONUtils toJSON keyNames keysMeta kmsAudit ok user KMSOp GET_KEYS_METADATA LOG trace Response ok type MediaType APPLICATION_JSON entity json build
LOG trace
name LOG trace UserGroupInformation user HttpUserGroupInformation get checkNotEmpty name KMSWebApp getAdminCallsMeter mark assertAccess KMSACLs Type GET_METADATA user KMSOp GET_METADATA name
LOG trace UserGroupInformation user HttpUserGroupInformation get checkNotEmpty name KMSWebApp getAdminCallsMeter mark assertAccess KMSACLs Type GET_METADATA user KMSOp GET_METADATA name LOG debug name metadata user provider getMetadata name Object json KMSServerJSONUtils toJSON name metadata kmsAudit ok user KMSOp GET_METADATA name LOG trace Response ok type MediaType APPLICATION_JSON entity json build
GET name LOG trace UserGroupInformation user HttpUserGroupInformation get checkNotEmpty name KMSWebApp getKeyCallsMeter mark assertAccess KMSACLs Type GET user KMSOp GET_CURRENT_KEY name
LOG trace UserGroupInformation user HttpUserGroupInformation get checkNotEmpty name KMSWebApp getKeyCallsMeter mark assertAccess KMSACLs Type GET user KMSOp GET_CURRENT_KEY name LOG debug name keyVersion user provider getCurrentKey name Object json KMSUtil toJSON keyVersion kmsAudit ok user KMSOp GET_CURRENT_KEY name LOG trace Response ok type MediaType APPLICATION_JSON entity json build
GET versionName LOG trace UserGroupInformation user HttpUserGroupInformation get checkNotEmpty versionName KMSWebApp getKeyCallsMeter mark assertAccess KMSACLs Type GET user KMSOp GET_KEY_VERSION
UserGroupInformation user HttpUserGroupInformation get checkNotEmpty versionName KMSWebApp getKeyCallsMeter mark assertAccess KMSACLs Type GET user KMSOp GET_KEY_VERSION LOG debug versionName keyVersion user provider getKeyVersion versionName keyVersion kmsAudit ok user KMSOp GET_KEY_VERSION keyVersion getName Object json KMSUtil toJSON keyVersion LOG trace Response ok type MediaType APPLICATION_JSON entity json build
name edekOp LOG trace UserGroupInformation user HttpUserGroupInformation get checkNotEmpty name checkNotNull edekOp
name edekOp LOG trace UserGroupInformation user HttpUserGroupInformation get checkNotEmpty name checkNotNull edekOp LOG debug name edekOp Object retJSON edekOp LOG debug assertAccess KMSACLs Type GENERATE_EEK user KMSOp GENERATE_EEK name List EncryptedKeyVersion retEdeks LinkedList EncryptedKeyVersion user
LOG debug name edekOp Object retJSON edekOp LOG debug assertAccess KMSACLs Type GENERATE_EEK user KMSOp GENERATE_EEK name List EncryptedKeyVersion retEdeks LinkedList EncryptedKeyVersion user LOG debug numKeys numKeys retEdeks add provider generateEncryptedKey name
e LOG error e IOException e kmsAudit ok user KMSOp GENERATE_EEK name retJSON ArrayList edek ArrayList retJSON add KMSUtil toJSON edek StringBuilder error error StringBuilder error append KMSRESTConstants EEK_OP error append error append KMSRESTConstants EEK_GENERATE error append
IOException e kmsAudit ok user KMSOp GENERATE_EEK name retJSON ArrayList edek ArrayList retJSON add KMSUtil toJSON edek StringBuilder error error StringBuilder error append KMSRESTConstants EEK_OP error append error append KMSRESTConstants EEK_GENERATE error append error append KMSRESTConstants EEK_DECRYPT LOG error error toString IllegalArgumentException error toString
assertAccess KMSACLs Type GENERATE_EEK user KMSOp REENCRYPT_EEK_BATCH name LOG debug jsonPayload size name List EncryptedKeyVersion ekvs KMSUtil parseJSONEncKeyVersions name jsonPayload Preconditions checkArgument ekvs size jsonPayload size EncryptedKeyVersion ekv ekvs Preconditions checkArgument name equals ekv getEncryptionKeyName name user provider reencryptEncryptedKeys ekvs List retJSON ArrayList ekvs size EncryptedKeyVersion ekv ekvs retJSON add KMSUtil toJSON ekv kmsAudit ok user KMSOp REENCRYPT_EEK_BATCH name ekvs size
GET name LOG trace UserGroupInformation user HttpUserGroupInformation get checkNotEmpty name KMSWebApp getKeyCallsMeter mark assertAccess KMSACLs Type GET user KMSOp GET_KEY_VERSIONS name
LOG trace UserGroupInformation user HttpUserGroupInformation get checkNotEmpty name KMSWebApp getKeyCallsMeter mark assertAccess KMSACLs Type GET user KMSOp GET_KEY_VERSIONS name LOG debug name ret user provider getKeyVersions name Object json KMSServerJSONUtils toJSON ret kmsAudit ok user KMSOp GET_KEY_VERSIONS name LOG trace Response ok type MediaType APPLICATION_JSON entity json build
conf Map Type AccessControlList tempAcls HashMap Type AccessControlList Map Type AccessControlList tempBlacklist HashMap Type AccessControlList Type aclType Type String aclStr conf get aclType getAclConfigKey ACL_DEFAULT tempAcls put aclType AccessControlList aclStr String blacklistStr conf get aclType getBlacklistConfigKey blacklistStr tempBlacklist put aclType AccessControlList blacklistStr
String aclStr keyAcl getValue String keyName k substring keyNameStarts keyNameEnds String keyOp k substring keyNameEnds KeyOpType aclType aclType KeyOpType valueOf keyOp LOG warn keyOp aclType HashMap KeyOpType AccessControlList aclMap tempKeyAcls get keyName aclMap aclMap HashMap KeyOpType AccessControlList tempKeyAcls put keyName aclMap aclMap put aclType AccessControlList aclStr
type ugi access acls get type isUserAllowed ugi
type ugi access acls get type isUserAllowed ugi LOG LOG debug ugi getShortUserName type toString acls get type getAclString access AccessControlList blacklist blacklistedAcls get type access blacklist blacklist isUserInList ugi LOG blacklist LOG debug type toString access LOG debug blacklist getAclString LOG debug blacklist getAclString LOG
keyName KeyOpType Map KeyOpType AccessControlList keyAcl keyAcls get keyName keyAcl
AccessControlList keyAcl opType AccessControlList acl keyAcl get opType acl
kmsConf KMSConfiguration getKMSConf UserGroupInformation setConfiguration kmsConf LOG info LOG info System getProperty
providerString IllegalStateException KeyProvider keyProvider KeyProviderFactory get URI providerString kmsConf Preconditions checkNotNull keyProvider String format KMSConfiguration KEY_PROVIDER_URI providerString kmsConf KMSConfiguration KMSConfiguration keyTimeOutMillis kmsConf getLong KMSConfiguration KEY_CACHE_TIMEOUT_KEY KMSConfiguration KEY_CACHE_TIMEOUT_DEFAULT currKeyTimeOutMillis kmsConf getLong KMSConfiguration CURR_KEY_CACHE_TIMEOUT_KEY KMSConfiguration CURR_KEY_CACHE_TIMEOUT_DEFAULT keyProvider CachingKeyProvider keyProvider keyTimeOutMillis currKeyTimeOutMillis LOG info keyProvider keyProviderCryptoExtension KeyProviderCryptoExtension createKeyProviderCryptoExtension keyProvider keyProviderCryptoExtension EagerKeyGeneratorKeyProviderCryptoExtension kmsConf keyProviderCryptoExtension kmsConf KMSConfiguration KMSConfiguration keyProviderCryptoExtension KeyAuthorizationKeyProvider keyProviderCryptoExtension kmsAcls LOG info keyProviderCryptoExtension defaultBitlength kmsConf getInt KeyProvider DEFAULT_BITLENGTH_NAME KeyProvider DEFAULT_BITLENGTH
printUsage String type args get runAll OperationStatsBase OP_ALL_NAME equals type List OperationStatsBase ops ArrayList OperationStatsBase OperationStatsBase opStat runAll EncryptKeyStats equals type opStat EncryptKeyStats args ops add opStat runAll DecryptKeyStats equals type opStat DecryptKeyStats args ops add opStat ops printUsage OperationStatsBase ops
File confDir getTestDir conf createBaseKMSConf confDir conf conf set KeyAuthorizationKeyProvider KEY_ACL specialKey writeConf confDir conf confDir Configuration conf Configuration URI uri createKMSUri getKMSUrl KeyProvider kp createProvider uri conf Assert assertTrue kp getKeys isEmpty Assert assertEquals kp getKeysMetadata length KeyProvider Options options KeyProvider Options conf options setCipher options setBitLength options setDescription
EncryptedKeyVersion ek1 kpCE generateEncryptedKey currKv getName ek1 ex Assert fail ex toString KeyProvider kp createProvider uri conf KeyProviderCryptoExtension kpCE KeyProviderCryptoExtension createKeyProviderCryptoExtension kp kpCE reencryptEncryptedKey encKv List EncryptedKeyVersion ekvs ArrayList ekvs add encKv ekvs add encKv kpCE reencryptEncryptedKeys ekvs
KeyProviderCryptoExtension kpCE KeyProviderCryptoExtension createKeyProviderCryptoExtension kp kpCE reencryptEncryptedKey encKv List EncryptedKeyVersion ekvs ArrayList ekvs add encKv ekvs add encKv kpCE reencryptEncryptedKeys ekvs KeyProvider kp createProvider uri conf KeyProviderCryptoExtension kpCE KeyProviderCryptoExtension createKeyProviderCryptoExtension kp kpCE decryptEncryptedKey encKv
KeyProviderCryptoExtension kpCE KeyProviderCryptoExtension createKeyProviderCryptoExtension kp kpCE decryptEncryptedKey encKv ex Assert fail ex getMessage KeyProvider kp createProvider uri conf kp getKeys ex Assert fail ex getMessage
Configuration clientConf Configuration URI uri createKMSUri getKMSUrl clientConf set KeyProviderFactory KEY_PROVIDER_PATH createKMSUri getKMSUrl toString KeyProvider kp createProvider uri clientConf clientConf unset HADOOP_SECURITY_KEY_PROVIDER_PATH KeyProviderDelegationTokenExtension kpdte KeyProviderDelegationTokenExtension createKeyProviderDelegationTokenExtension kp Credentials credentials Credentials Token tokens kpdte addDelegationTokens credentials Text tokenService getTokenService kp Assert assertEquals credentials getAllTokens size Assert assertEquals KMSDelegationToken TOKEN_KIND credentials getToken tokenService getKind Token tokens
LOG info uri token token renew clientConf Assert fail e DelegationTokenIdentifier identifier DelegationTokenIdentifier token decodeIdentifier GenericTestUtils assertExceptionContains identifier e UserGroupInformation otherUgi UserGroupInformation loginUserFromKeytab keytab getAbsolutePath otherUgi UserGroupInformation getLoginUser otherUgi UserGroupInformation createUserForTesting String UserGroupInformation setLoginUser otherUgi
Assert fail e DelegationTokenIdentifier identifier DelegationTokenIdentifier token decodeIdentifier GenericTestUtils assertExceptionContains identifier e UserGroupInformation otherUgi UserGroupInformation loginUserFromKeytab keytab getAbsolutePath otherUgi UserGroupInformation getLoginUser otherUgi UserGroupInformation createUserForTesting String UserGroupInformation setLoginUser otherUgi otherUgi renewed
e DelegationTokenIdentifier identifier DelegationTokenIdentifier token decodeIdentifier GenericTestUtils assertExceptionContains identifier e UserGroupInformation otherUgi UserGroupInformation loginUserFromKeytab keytab getAbsolutePath otherUgi UserGroupInformation getLoginUser otherUgi UserGroupInformation createUserForTesting String UserGroupInformation setLoginUser otherUgi otherUgi renewed token
GenericTestUtils assertExceptionContains identifier e UserGroupInformation otherUgi UserGroupInformation loginUserFromKeytab keytab getAbsolutePath otherUgi UserGroupInformation getLoginUser otherUgi UserGroupInformation createUserForTesting String UserGroupInformation setLoginUser otherUgi otherUgi renewed token token LOG info token
otherUgi UserGroupInformation getLoginUser otherUgi UserGroupInformation createUserForTesting String UserGroupInformation setLoginUser otherUgi otherUgi renewed token token getKind LOG info token LOG info uri token tokenLife token renew clientConf LOG info token getKind tokenLife
otherUgi UserGroupInformation createUserForTesting String UserGroupInformation setLoginUser otherUgi otherUgi renewed token token getKind LOG info token LOG info uri token tokenLife token renew clientConf LOG info token getKind tokenLife Thread sleep newTokenLife token renew clientConf
UserGroupInformation setLoginUser otherUgi otherUgi renewed token token getKind LOG info token LOG info uri token tokenLife token renew clientConf LOG info token getKind tokenLife Thread sleep newTokenLife token renew clientConf LOG info token getKind newTokenLife
Token token UserGroupInformation getCurrentUser getCredentials getToken tokenService Assert assertNotNull token job1Token add token ByteArrayInputStream buf ByteArrayInputStream token getIdentifier DataInputStream dis DataInputStream buf DelegationTokenIdentifier id DelegationTokenIdentifier token getKind id readFields dis dis close maxTime id getMaxDate Thread sleep Assert assertTrue maxTime maxTime maxTime Time now kp getKeys Assert fail
String lbUri generateLoadBalancingKeyProviderUriString LoadBalancingKMSClientProvider lbkp createHAProvider URI create lbUri uris conf conf unset HADOOP_SECURITY_KEY_PROVIDER_PATH KeyProviderDelegationTokenExtension kpdte KeyProviderDelegationTokenExtension createKeyProviderDelegationTokenExtension lbkp kpdte addDelegationTokens credentials nonKerberosUgi addCredentials credentials nonKerberosUgi i lbkp String key i
i provider String key i LOG info provider key provider createKey key KeyProvider Options conf Collection Token TokenIdentifier tokens credentials getAllTokens assertEquals tokens size Token token tokens iterator next assertEquals KMSDelegationToken TOKEN_KIND token getKind
provider String key i LOG info provider key provider createKey key KeyProvider Options conf Collection Token TokenIdentifier tokens credentials getAllTokens assertEquals tokens size Token token tokens iterator next assertEquals KMSDelegationToken TOKEN_KIND token getKind LOG info token tokenLife token renew conf LOG info token tokenLife
LOG info provider key provider createKey key KeyProvider Options conf Collection Token TokenIdentifier tokens credentials getAllTokens assertEquals tokens size Token token tokens iterator next assertEquals KMSDelegationToken TOKEN_KIND token getKind LOG info token tokenLife token renew conf LOG info token tokenLife Thread sleep newTokenLife token renew conf
Collection Token TokenIdentifier tokens credentials getAllTokens assertEquals tokens size Token token tokens iterator next assertEquals KMSDelegationToken TOKEN_KIND token getKind LOG info token tokenLife token renew conf LOG info token tokenLife Thread sleep newTokenLife token renew conf LOG info token newTokenLife assertTrue newTokenLife tokenLife
Credentials newCredentials Credentials KeyProviderDelegationTokenExtension kpdte KeyProviderDelegationTokenExtension createKeyProviderDelegationTokenExtension lbkp kpdte addDelegationTokens newCredentials KMSClientProvider kp1 lbkp getProviders URL urls getKMSHAUrl Collection Token TokenIdentifier tokens newCredentials getAllTokens assertEquals tokens size Token token tokens iterator next
Configuration conf Configuration File confDir getTestDir conf createBaseKMSConf confDir conf String processName conf set KMSConfiguration METRICS_PROCESS_NAME_KEY processName writeConf confDir conf confDir URL jmxUrl URL getKMSUrl processName
principals simpleKdc createPrincipals principals
String line String parts line split String host AccessPrivilege privilege AccessPrivilege READ_ONLY parts host parts trim host parts trim String option parts trim option privilege AccessPrivilege READ_WRITE line host
parts host parts trim host parts trim String option parts trim option privilege AccessPrivilege READ_WRITE host LOG LOG debug host privilege AnonymousMatch privilege host LOG
String option parts trim option privilege AccessPrivilege READ_WRITE host LOG LOG debug host privilege AnonymousMatch privilege host LOG LOG debug host privilege CIDRMatch privilege SubnetUtils host getInfo host LOG
host LOG LOG debug host privilege AnonymousMatch privilege host LOG LOG debug host privilege CIDRMatch privilege SubnetUtils host getInfo host LOG LOG debug host privilege String pair host split CIDRMatch privilege SubnetUtils pair pair getInfo host host host host host host
LOG debug host privilege AnonymousMatch privilege host LOG LOG debug host privilege CIDRMatch privilege SubnetUtils host getInfo host LOG LOG debug host privilege String pair host split CIDRMatch privilege SubnetUtils pair pair getInfo host host host host host host LOG LOG debug host privilege RegexMatch privilege host
factory NioServerSocketChannelFactory Executors newCachedThreadPool Executors newCachedThreadPool factory NioServerSocketChannelFactory Executors newCachedThreadPool Executors newCachedThreadPool workerCount server ServerBootstrap factory server Channels pipeline RpcUtil constructRpcFrameDecoder RpcUtil STAGE_RPC_MESSAGE_PARSER rpcProgram RpcUtil STAGE_RPC_TCP_RESPONSE server setOption server setOption server setOption server setOption ch server bind InetSocketAddress port InetSocketAddress socketAddr InetSocketAddress ch getLocalAddress boundPort socketAddr getPort
DatagramChannelFactory f NioDatagramChannelFactory Executors newCachedThreadPool workerCount server ConnectionlessBootstrap f server setPipeline Channels pipeline RpcUtil STAGE_RPC_MESSAGE_PARSER rpcProgram RpcUtil STAGE_RPC_UDP_RESPONSE server setOption server setOption SEND_BUFFER_SIZE server setOption RECEIVE_BUFFER_SIZE server setOption ch server bind InetSocketAddress port InetSocketAddress socketAddr InetSocketAddress ch getLocalAddress boundPort socketAddr getPort
tcpServer HashedWheelTimer timer HashedWheelTimer IdleStateHandler idleStateHandler IdleStateHandler timer idleTimeMilliSeconds TimeUnit MILLISECONDS Channels pipeline RpcUtil constructRpcFrameDecoder RpcUtil STAGE_RPC_MESSAGE_PARSER idleStateHandler handler RpcUtil STAGE_RPC_TCP_RESPONSE tcpServer setOption tcpServer setOption udpServer ConnectionlessBootstrap NioDatagramChannelFactory Executors newCachedThreadPool udpServer setPipeline Channels pipeline RpcUtil STAGE_RPC_MESSAGE_PARSER handler RpcUtil STAGE_RPC_UDP_RESPONSE udpServer setOption tcpChannel tcpServer bind tcpAddress udpChannel udpServer bind udpAddress allChannels add tcpChannel allChannels add udpChannel
in PortmapMapping mapping PortmapRequest mapping in String key PortmapMapping key mapping
in PortmapMapping mapping PortmapRequest mapping in String key PortmapMapping key mapping
XDR in XDR info data toByteBuffer asReadOnlyBuffer XDR State READING XDR out XDR out nullOp xid in out out set xid in out out unset xid in out out dump xid in out out getport xid in out out getport xid in out
String String String argsList String pathArg argsList isEmpty argsList get
Map String ServiceRecord results HashMap String ServiceRecord stats size stat stats stat size ServiceRecord String path join parentpath stat path ServiceRecord serviceRecord operations resolve path results put path serviceRecord LOG LOG debug path LOG LOG debug path LOG
conf registryRoot conf getTrimmed KEY_REGISTRY_ZK_ROOT DEFAULT_ZK_REGISTRY_ROOT addService registrySecurity
Configuration conf getConfig createEnsembleProvider sessionTimeout conf getInt KEY_REGISTRY_ZK_SESSION_TIMEOUT DEFAULT_ZK_SESSION_TIMEOUT connectionTimeout conf getInt KEY_REGISTRY_ZK_CONNECTION_TIMEOUT DEFAULT_ZK_CONNECTION_TIMEOUT retryTimes conf getInt KEY_REGISTRY_ZK_RETRY_TIMES DEFAULT_ZK_RETRY_TIMES retryInterval conf getInt KEY_REGISTRY_ZK_RETRY_INTERVAL DEFAULT_ZK_RETRY_INTERVAL retryCeiling conf getInt KEY_REGISTRY_ZK_RETRY_CEILING DEFAULT_ZK_RETRY_CEILING LOG info connectionDescription CuratorFramework framework CuratorFrameworkFactory Builder builder CuratorFrameworkFactory builder builder ensembleProvider ensembleProvider connectionTimeoutMs connectionTimeout sessionTimeoutMs sessionTimeout retryPolicy BoundedExponentialBackoffRetry retryInterval retryCeiling retryTimes registrySecurity applySecurityEnvironment builder securityConnectionDiagnostics buildSecurityDiagnostics LOG
Stat String path checkServiceLive String fullpath createFullPath path Stat stat
List ACL String path checkServiceLive String fullpath createFullPath path List ACL acls
checkServiceLive path createFullPath path acls acls NoPathPermissionsException path RegistrySecurity AclListInfo aclInfo RegistrySecurity AclListInfo acls LOG LOG debug path mode aclInfo CreateBuilder createBuilder curator create createBuilder withMode mode withACL acls createBuilder creatingParentsIfNeeded createBuilder forPath path LOG
String path data Preconditions checkArgument data checkServiceLive String fullpath createFullPath path
path data Preconditions checkArgument data checkServiceLive path createFullPath path
String path checkServiceLive String fullpath createFullPath path
String String path checkServiceLive String fullpath createFullPath path
String path checkServiceLive String fullpath createFullPath path
path record Preconditions checkArgument record validatePath path RegistryTypeUtils validateServiceRecord path record
RegistryPathStatus stat String path validatePath path Stat stat zkStat path String name RegistryPathUtils lastPathEntry path RegistryPathStatus status RegistryPathStatus name stat getCtime stat getDataLength stat getNumChildren
secureRegistry getConfig getBoolean KEY_REGISTRY_SECURE DEFAULT_REGISTRY_SECURE systemACLs clear secureRegistry addSystemACL ALL_READ_ACCESS kerberosRealm getConfig get KEY_REGISTRY_KERBEROS_REALM getDefaultRealmInJVM String system getOrFail KEY_REGISTRY_SYSTEM_ACCOUNTS DEFAULT_REGISTRY_SYSTEM_ACCOUNTS usesRealm system contains systemACLs addAll buildACLs system kerberosRealm ZooDefs Perms ALL
String user getConfig get KEY_REGISTRY_USER_ACCOUNTS DEFAULT_REGISTRY_USER_ACCOUNTS List ACL userACLs buildACLs user kerberosRealm ZooDefs Perms ALL ACL self UserGroupInformation self createSaslACLFromCurrentUser ZooDefs Perms ALL self userACLs add self LOG info System lineSeparator userACLs UserGroupInformation IOException UserGroupInformation currentUser UserGroupInformation getCurrentUser jaasClientEntry getOrFail KEY_REGISTRY_CLIENT_JAAS_CONTEXT DEFAULT_REGISTRY_CLIENT_JAAS_CONTEXT jaasClientIdentity currentUser getShortUserName LOG
UserGroupInformation currentUser UserGroupInformation getCurrentUser jaasClientEntry getOrFail KEY_REGISTRY_CLIENT_JAAS_CONTEXT DEFAULT_REGISTRY_CLIENT_JAAS_CONTEXT jaasClientIdentity currentUser getShortUserName LOG LOG debug jaasClientIdentity jaasClientEntry digest String id getOrFail String pass getOrFail KEY_REGISTRY_CLIENT_AUTHENTICATION_PASSWORD userACLs ServiceStateException E_NO_USER_DETERMINED_FOR_ACLS digest id pass ACL acl ACL ZooDefs Perms ALL toDigestId id pass userACLs add acl digestAuthUser id digestAuthPassword pass
jaasFile String path jaasFile getAbsolutePath
builder authorization SCHEME_DIGEST digestAuthData principal keytab IOException LOG info jaasClientEntry principal keytab JaasConfiguration jconf JaasConfiguration jaasClientEntry principal keytab javax security auth login Configuration setConfiguration jconf setSystemPropertyIfUnset ZKClientConfig ENABLE_CLIENT_SASL_KEY setSystemPropertyIfUnset ZKClientConfig LOGIN_CONTEXT_NAME_KEY jaasClientEntry
UserGroupInformation currentUser UserGroupInformation getCurrentUser
UserGroupInformation currentUser UserGroupInformation getCurrentUser LOG info currentUser UserGroupInformation realUser currentUser getRealUser
username username username username kerberosRealm
SocketException Enumeration NetworkInterface net NetworkInterface getNetworkInterfaces net NetworkInterface n NetworkInterface net nextElement Enumeration InetAddress ee n getInetAddresses ee InetAddress i InetAddress ee nextElement list add i SocketException ResolverConfig refresh ExtendedResolver resolver resolver ExtendedResolver
e ResolverConfig refresh ExtendedResolver resolver resolver ExtendedResolver e LOG error e check resolver check SimpleResolver InetAddress address SimpleResolver check getAddress getAddress address resolver deleteResolver check
zone record DNSSEC RRset rrset zone findExactMatch record getName record getType Calendar cal Calendar getInstance Date inception cal getTime cal add Calendar YEAR Date expiration cal getTime RRSIGRecord rrsigRecord DNSSEC sign rrset dnsKeyRecs get zone getOrigin privateKey inception expiration
ch ByteBuffer buf ByteBuffer allocate ch read buf buf flip messageLength getMessgeLength buf in messageLength buf get in messageLength Message query response query Message in
input clear remoteAddress channel receive input e LOG debug e Message query response position input position in position input flip input get in query Message in
Message query response position input position in position input flip input get in query Message in LOG info remoteAddress query getQuestion response generateReply query response response formErrorMessage in output clear
query Name name query getQuestion getName name name id query getHeader getID String queryName name getLabelString Name qualifiedName Name concatenate Name fromString queryName Name fromString domainName
sr sr CNAMERecord cname sr getCNAME RRset rrset zone findExactMatch cname getName Type CNAME addRRset name response rrset Section ANSWER flags iterations response getHeader setFlag Flags AA rcode addAnswer response cname getTarget type dclass iterations flags sr response getHeader setRcode Rcode NXDOMAIN addNXT response flags e LOG warn e
parsedRange Integer parseInt range e LOG error range e parsedRange String msg String format parsedRange LOG error msg IllegalArgumentException msg ipCount SubnetUtils subnetUtils SubnetUtils subnet mask subnetUtils setInclusiveHostCount ipCount subnetUtils getInfo getAddressCountLong IllegalArgumentException e
setupSecurity FileTxnSnapLog ftxn FileTxnSnapLog dataDir dataDir ZooKeeperServer zkServer ZooKeeperServer ftxn tickTime LOG info factory ServerCnxnFactory createFactory factory configure getAddress port factory startup zkServer String connectString getConnectionString
setupSecurity FileTxnSnapLog ftxn FileTxnSnapLog dataDir dataDir ZooKeeperServer zkServer ZooKeeperServer ftxn tickTime LOG info factory ServerCnxnFactory createFactory factory configure getAddress port factory startup zkServer String connectString getConnectionString LOG info connectString LOG StringWriter sw StringWriter PrintWriter pw PrintWriter sw zkServer dumpConf pw pw flush
serviceInit conf serviceInit conf RegistrySecurity registrySecurity getRegistrySecurity registrySecurity ACL sasl registrySecurity createSaslACLFromCurrentUser ZooDefs Perms ALL registrySecurity addSystemACL sasl
List ACL systemACLs getRegistrySecurity getSystemACLs
childEntries RegistryUtils statChildren path entries childEntries values RegistryPathStatus registryPathStatus stat path ServiceRecord serviceRecord resolve path toDelete selector shouldSelect path registryPathStatus serviceRecord toDelete entries
loginContext assertNotNull loginContext Subject subject loginContext getSubject
log log info
String persistence PersistencePolicies PERMANENT ServiceRecord record createRecord persistence record set record set RegistryTypeUtils validateServiceRecord record
mkPath CreateMode PERSISTENT mkPath CreateMode PERSISTENT CuratorEventCatcher events CuratorEventCatcher curatorService zkDelete events CuratorEvent taken events take
kdcConf MiniKdc createConf kdcConf setProperty MiniKdc DEBUG kdc MiniKdc kdcConf kdcWorkDir kdc start keytab_zk createKeytab ZOOKEEPER keytab_alice createKeytab ALICE keytab_bob createKeytab BOB zkServerPrincipal Shell WINDOWS ZOOKEEPER_1270001 ZOOKEEPER_LOCALHOST StringBuilder jaas StringBuilder jaas append registrySecurity createJAASEntry ZOOKEEPER_CLIENT_CONTEXT ZOOKEEPER keytab_zk jaas append registrySecurity createJAASEntry ZOOKEEPER_SERVER_CONTEXT zkServerPrincipal keytab_zk jaas append registrySecurity createJAASEntry ALICE_CLIENT_CONTEXT ALICE_LOCALHOST keytab_alice jaas append registrySecurity createJAASEntry BOB_CLIENT_CONTEXT BOB_LOCALHOST keytab_bob jaasFile File kdcWorkDir FileUtils write jaasFile jaas toString Charset defaultCharset
String realm RegistrySecurity getDefaultRealmInJVM
UserGroupInformation user UserGroupInformation getCurrentUser ACL acl registrySecurity createACLForUser user ZooDefs Perms ALL assertFalse RegistrySecurity ALL_READWRITE_ACCESS equals acl
LoginContext client login ALICE_LOCALHOST ALICE_CLIENT_CONTEXT keytab_alice logLoginDetails ALICE_LOCALHOST client String confFilename System getProperty Environment JAAS_CONF_KEY assertNotNull Environment JAAS_CONF_KEY confFilename String config FileUtils readFileToString File confFilename Charset defaultCharset
File krb5conf getKdc getKrb5conf String krbConfig FileUtils readFileToString krb5conf Charset defaultCharset
String defaultRealm KerberosUtil getDefaultRealm assertNotEmpty defaultRealm
assertTrue KerberosName hasRulesBeenSet String rules KerberosName getRules assertEquals kerberosRule rules
UserGroupInformation ugi loginUGI ZOOKEEPER keytab_zk RegistrySecurity UgiInfo ugiInfo RegistrySecurity UgiInfo ugi
System setProperty startSecureZK CuratorService curator LoginContext login login ZOOKEEPER_LOCALHOST ZOOKEEPER_CLIENT_CONTEXT keytab_zk logLoginDetails ZOOKEEPER login RegistrySecurity setZKSaslClientProperties ZOOKEEPER ZOOKEEPER_CLIENT_CONTEXT curator startCuratorServiceInstance
CuratorService name secure Configuration clientConf Configuration clientConf set KEY_REGISTRY_ZK_ROOT clientConf setBoolean KEY_REGISTRY_SECURE secure describe LOG CuratorService curatorService CuratorService name secureZK curatorService init clientConf curatorService start
System setProperty CuratorService curator LoginContext login login ZOOKEEPER_LOCALHOST ZOOKEEPER_CLIENT_CONTEXT keytab_zk logLoginDetails ZOOKEEPER login RegistrySecurity setZKSaslClientProperties ZOOKEEPER ZOOKEEPER_CLIENT_CONTEXT curator startCuratorServiceInstance
System setProperty CuratorService curator LoginContext login login ZOOKEEPER_LOCALHOST ZOOKEEPER_CLIENT_CONTEXT keytab_zk logLoginDetails ZOOKEEPER login RegistrySecurity setZKSaslClientProperties ZOOKEEPER ZOOKEEPER_CLIENT_CONTEXT curator startCuratorServiceInstance LOG info curator toString addToTeardown curator curator zkMkPath CreateMode PERSISTENT RegistrySecurity WorldReadWriteACL ZKPathDumper pathDumper curator dumpPath
inodeId DFSOutputStream out filesBeingWritten filesBeingWritten inodeId filesBeingWritten keySet iterator next out filesBeingWritten remove inodeId out abort out abort out close
dfsos FileEncryptionInfo feInfo dfsos getFileEncryptionInfo feInfo HdfsKMSUtil getCryptoProtocolVersion feInfo CryptoCodec codec HdfsKMSUtil getCryptoCodec conf feInfo KeyVersion decrypted
dfsos FileEncryptionInfo feInfo dfsos getFileEncryptionInfo feInfo HdfsKMSUtil getCryptoProtocolVersion feInfo CryptoCodec codec HdfsKMSUtil getCryptoCodec conf feInfo KeyVersion decrypted LOG debug dfsos getSrc Integer toHexString dfsos hashCode decrypted HdfsKMSUtil decryptEncryptedDataEncryptionKey feInfo getKeyProvider
FsPermission permission checkOpen FsPermission masked applyUMask permission
callAppend src CreateFlag flag CreateFlag validateForAppend flag LastBlockWithStatus blkWithStatus callAppend src EnumSetWritable flag CreateFlag HdfsFileStatus status blkWithStatus getFileStatus status
num num HEDGED_READ_THREAD_POOL HEDGED_READ_THREAD_POOL num AtomicInteger threadIndex AtomicInteger Thread newThread r Thread t newThread r t setName threadIndex getAndIncrement t rejectedExecution runnable e LOG info HEDGED_READ_METRIC incHedgedReadOpsInCurThread rejectedExecution runnable e HEDGED_READ_THREAD_POOL allowCoreThreadTimeOut
lastReadTxid LOG debug lastReadTxid namenode getCurrentEditLogTxid it EventBatchList el namenode getEditsFromTxid lastReadTxid el getLastTxid syncTxid el getSyncTxid it el getBatches iterator formerLastReadTxid lastReadTxid lastReadTxid el getLastTxid el getFirstTxid formerLastReadTxid MissingEventsException formerLastReadTxid el getFirstTxid
EventBatch EventBatch next nextWaitMin INITIAL_WAIT_MS next sleepTime nextWaitMin rng nextInt nextWaitMin
sleeptime conf getBlockWriteLocateFollowingInitialDelayMs maxSleepTime conf getBlockWriteLocateFollowingMaxDelayMs localstart Time monotonicNow dfsClient namenode addBlock src dfsClient clientName prevBlock excludedNodes fileId favoredNodes allocFlags e IOException ue e unwrapRemoteException FileNotFoundException AccessControlException NSQuotaExceededException DSQuotaExceededException QuotaByStorageTypeExceededException UnresolvedPathException ue e ue e retries e retries
expectedNum healthyStreamers size socketTimeout dfsClient getConf getSocketTimeout remaingTime socketTimeout socketTimeout Long MAX_VALUE waitInterval coordinator healthyStreamers expectedNum remaingTime start Time monotonicNow coordinator wait waitInterval remaingTime Time monotonicNow start e DFSUtilClient toInterruptedIOException e coordinator healthyStreamers coordinator
dn socketFactory connectToDnViaHostname success Socket sock sock socketFactory createSocket String dnAddr dn getXferAddr connectToDnViaHostname
first client DfsClientConf conf client getConf String dnAddr first getXferAddr conf isConnectToDnViaHostname
LOG debug seqno begin Time monotonicNow dataQueue checkClosed seqno dataQueue wait InterruptedIOException checkClosed
span span addTimelineAnnotation firstWait dataQueue wait Thread currentThread interrupt Span span Tracer getCurrentSpan span firstWait span addTimelineAnnotation checkClosed queuePacket packet
packet dataQueue packet packet addTraceParent Tracer getCurrentSpanId dataQueue addLast packet lastQueuedSeqno packet getSeqno
type LOG debug type DatanodeInfo datanodeInfo type datanodeInfo datanodeInfo
probe success LOG debug probe getDatanodeInfo success probe getType probeInProg remove probe getDatanodeInfo getDatanodeUuid success probe getType
Set DatanodeInfo datanodeInfos clearAndGetDetectedDeadNodes DatanodeInfo datanodeInfos
Set DatanodeInfo datanodeInfos clearAndGetDetectedDeadNodes DatanodeInfo datanodeInfo datanodeInfos LOG debug datanodeInfo datanodeInfo
ugi haUri Text haService HAUtilClient buildTokenServiceForLogicalUri haUri HdfsConstants HDFS_URI_SCHEME Token DelegationTokenIdentifier haToken tokenSelector selectToken haService ugi getTokens haToken singleNNAddr Token DelegationTokenIdentifier specificToken haToken privateClone buildTokenService singleNNAddr Text alias Text HAUtilClient buildTokenServicePrefixForLogicalUri HdfsConstants HDFS_URI_SCHEME specificToken getService ugi addToken alias specificToken
conf String providerUriStr conf getTrimmed CommonConfigurationKeysPublic HADOOP_SECURITY_KEY_PROVIDER_PATH providerUriStr providerUriStr
T AbstractNNFailoverProxyProvider T Configuration conf URI nameNodeUri Class T xface HAProxyFactory T proxyFactory Class FailoverProxyProvider T failoverProxyProviderClass AbstractNNFailoverProxyProvider T providerNN failoverProxyProviderClass getFailoverProxyProviderClass conf nameNodeUri failoverProxyProviderClass Constructor FailoverProxyProvider T ctor failoverProxyProviderClass getConstructor Configuration URI Class HAProxyFactory FailoverProxyProvider T provider ctor newInstance conf nameNodeUri xface proxyFactory provider AbstractNNFailoverProxyProvider providerNN WrappedFailoverProxyProvider provider providerNN AbstractNNFailoverProxyProvider T provider String message failoverProxyProviderClass
Configuration conf Configuration conf setBoolean String format scheme conf setBoolean HdfsClientConfigKeys Retry POLICY_ENABLED_KEY conf setInt CommonConfigurationKeysPublic IPC_CLIENT_CONNECT_MAX_RETRIES_KEY DistributedFileSystem fs fs DistributedFileSystem FileSystem get uri conf safemode fs setSafeMode SafeModeAction SAFEMODE_GET LOG LOG debug safemode uri fs close fs safemode LOG
ShortCircuitCache cache clientContext getShortCircuitCache block getBlockId MutableBoolean usedPeer MutableBoolean slot cache allocShmSlot datanode peer usedPeer ExtendedBlockId block getBlockId block getBlockPoolId clientName usedPeer LOG trace peer getDomainSocket curPeer nextDomainPeer curPeer peer DomainPeer curPeer peer ShortCircuitReplicaInfo info requestFileDescriptors peer slot clientContext getPeerCache put datanode peer info slot cache freeSlot slot
sock getOutputStream write replica ShortCircuitReplica key fis fis cache Time monotonicNow slot ShortCircuitReplicaInfo replica e LOG warn e replica IOUtilsClient cleanupWithLogger DFSClient LOG fis fis resp LOG warn datanode resp getMessage clientContext getDomainSocketFactory disableShortCircuitForPath pathInfo getPath LOG warn fileName datanode resp getMessage
LOG trace pathInfo getPath BlockReaderPeer curPeer nextDomainPeer curPeer curPeer fromCache remainingCacheTries DomainPeer peer DomainPeer curPeer peer BlockReader blockReader blockReader getRemoteBlockReader peer blockReader ioe IOUtilsClient cleanupWithLogger LOG peer ioe LOG trace pathInfo getPath ioe ioe
BlockReader blockReader BlockReaderPeer curPeer Peer peer curPeer nextTcpPeer curPeer fromCache remainingCacheTries peer curPeer peer blockReader getRemoteBlockReader peer blockReader ioe ioe LOG trace peer ioe ioe curPeer curPeer fromCache
BlockReaderLocalLegacy conf UserGroupInformation userGroupInformation configuration blk token node storageType ShortCircuitConf scConf conf getShortCircuitConf LocalDatanodeInfo localDatanodeInfo getLocalDatanodeInfo node getIpcPort BlockLocalPathInfo pathinfo localDatanodeInfo getBlockLocalPathInfo blk pathinfo userGroupInformation userGroupInformation UserGroupInformation getCurrentUser pathinfo getBlockPathInfo userGroupInformation blk node configuration conf getSocketTimeout token conf isConnectToDnViaHostname storageType FileInputStream dataIn FileInputStream checksumIn BlockReaderLocalLegacy localBlockReader skipChecksumCheck scConf isSkipShortCircuitChecksums storageType isTransient File blkfile File pathinfo getBlockPath dataIn FileInputStream blkfile
BlockLocalPathInfo ugi blk node conf timeout token connectToDnViaHostname LocalDatanodeInfo localDatanodeInfo getLocalDatanodeInfo node getIpcPort BlockLocalPathInfo pathinfo ClientDatanodeProtocol proxy localDatanodeInfo getDatanodeProxy ugi node conf timeout connectToDnViaHostname pathinfo proxy getBlockLocalPathInfo blk token pathinfo
id currentId
id currentId run LOG LOG debug clientsString id LeaseRenewer run id e LOG debug e LeaseRenewer Factory INSTANCE remove LeaseRenewer LOG
List DFSClient copies copies ArrayList dfsclients copies DFSClient DFSClient left DFSClient right left getClientName compareTo right getClientName String previousName DFSClient c copies c getClientName previousName c LOG debug c previousName c getClientName
lastRenewed Time monotonicNow elapsed Time monotonicNow lastRenewed elapsed renew
LOG warn clientsString elapsed ie List DFSClient dfsclientsCopy DFSClientFaultInjector get delayWhenRenewLeaseTimeout dfsclientsCopy ArrayList dfsclients dfsclients clear emptyTime Factory INSTANCE remove LeaseRenewer DFSClient dfsClient dfsclientsCopy dfsClient closeAllFilesBeingWritten ie LOG warn clientsString elapsed ie
DFSClientFaultInjector get delayWhenRenewLeaseTimeout dfsclientsCopy ArrayList dfsclients dfsclients clear emptyTime Factory INSTANCE remove LeaseRenewer dfsClient dfsclientsCopy dfsClient closeAllFilesBeingWritten ie LOG warn clientsString elapsed ie LOG
zoneId ZoneReencryptionStatus zs zoneStatuses get zoneId Preconditions checkNotNull zs zoneId
zoneId ZoneReencryptionStatus zs zoneStatuses get zoneId Preconditions checkNotNull zs zoneId
zoneId ZoneReencryptionStatus zs zoneStatuses get zoneId Preconditions checkNotNull zs zoneId
conf String qops conf get DFS_DATA_TRANSFER_PROTECTION_KEY qops qops
addr localTrusted trustedChannelResolver isTrusted remoteTrusted trustedChannelResolver isTrusted addr
LOG debug addr datanodeId getEncryptedStreams addr underlyingOut underlyingIn encryptionKey accessToken secretKey LOG debug addr datanodeId datanodeId LOG debug addr datanodeId LOG debug addr datanodeId LOG debug addr datanodeId getSaslStreams addr underlyingOut underlyingIn accessToken secretKey
datanodeid connectToDnViaHostname String dnAddr datanodeid getIpcAddr connectToDnViaHostname InetSocketAddress addr NetUtils createSocketAddr dnAddr
conf String nameServiceID String configKey IPFAILOVER_CONFIG_PREFIX nameServiceID String virtualIP conf get configKey
String feature feature feature feature feature PerformanceAdvisory LOG debug HadoopIllegalArgumentException feature HdfsClientConfigKeys DFS_DOMAIN_SOCKET_PATH_KEY DomainSocket getLoadingFailureReason LOG warn feature DomainSocket getLoadingFailureReason
ShortCircuitReplicaInfo key Waitable ShortCircuitReplicaInfo newWaitable lock lock ShortCircuitReplicaInfo info LOG trace key Waitable ShortCircuitReplicaInfo waitable replicaInfoMap get key waitable info fetch key waitable
info waitable await LOG info key Thread currentThread interrupt RetriableException info getInvalidTokenException LOG info key info getInvalidTokenException info ShortCircuitReplica replica info getReplica replica LOG warn key info replica RetriableException replica replica
LOG trace key info creator createShortCircuitReplicaInfo e LOG warn key e info info ShortCircuitReplicaInfo lock lock info getReplica LOG trace info getReplica startCacheCleanerThreadIfNeeded Waitable ShortCircuitReplicaInfo waitableInMap replicaInfoMap get key waitableInMap newWaitable replicaInfoMap remove key info
cacheCleaner cacheCleaner CacheCleaner rateMs cacheCleaner getRateInMs ScheduledFuture future cleanerExecutor scheduleAtFixedRate cacheCleaner rateMs rateMs TimeUnit MILLISECONDS cacheCleaner setFuture future
purge ShortCircuitReplica evictable get eldestKey evictableMmapped Object eldestKey evictableMmapped firstKey purge ShortCircuitReplica evictableMmapped get eldestKey lock unlock releaserExecutor shutdown cleanerExecutor shutdown releaserExecutor LOG error releaserExecutor shutdownNow releaserExecutor shutdownNow Thread currentThread interrupt
lock unlock releaserExecutor shutdown cleanerExecutor shutdown releaserExecutor LOG error releaserExecutor shutdownNow e releaserExecutor shutdownNow Thread currentThread interrupt LOG error e cleanerExecutor LOG error cleanerExecutor shutdownNow
StringBuilder b DEBUG_MESSAGE get
Future BlockReadStats future timeoutMillis future readService poll timeoutMillis TimeUnit MILLISECONDS future readService take future BlockReadStats stats future get StripingChunkReadResult futures remove future StripingChunkReadResult SUCCESSFUL stats StripingChunkReadResult StripingChunkReadResult TIMEOUT e LOG debug e StripingChunkReadResult futures remove future StripingChunkReadResult FAILED e
Token token fs getDelegationToken token fs setDelegationToken token addRenewAction fs
ugi Token token selectDelegationToken ugi token
Token Token token tokenSelector selectToken Text getCanonicalServiceName ugi getTokens token
replaced Token token getDelegationToken
numThreads ExecutorService threadPool newFixedThreadPool numThreads CountDownLatch allReady CountDownLatch numThreads CountDownLatch startBlocker CountDownLatch CountDownLatch allDone CountDownLatch numThreads AtomicReference Throwable childError AtomicReference numThreads threadPool allReady countDown startBlocker await incrementOpsCountByRandomNumbers Throwable
i i runners length i runners i Runner i countThreshold countLimit pool i bam threads i runners i start num List Exception exceptions ArrayList Exception LOG info i i j ThreadLocalRandom current nextInt runners length runners j recycle Exception e e printStackTrace exceptions add Exception e i
LOG info i sleepMs LOG info i i i i i isEmpty randomRecycler start randomRecycler join Assert assertTrue exceptions isEmpty Assert assertNull counters get
URI redirectURL createOpenRedirectionURL uriInfo String js JsonUtil toJsonString redirectURL response Response ok js type MediaType APPLICATION_JSON build FSOperations FSOpen command FSOperations FSOpen path FileSystem fs createFileSystem user InputStream is UserGroupInformation ugi UserGroupInformation createProxyUser user getShortUserName UserGroupInformation getLoginUser is ugi InputStream InputStream command execute fs
is command execute fs ie LOG info ie Thread currentThread interrupt Long offset params get OffsetParam NAME OffsetParam Long len params get LenParam NAME LenParam AUDIT_LOG info Object path offset len InputStreamEntity entity InputStreamEntity is offset len response Response ok entity type MediaType APPLICATION_OCTET_STREAM build FSOperations FSFileStatus command FSOperations FSFileStatus path
ie LOG info ie Thread currentThread interrupt Long offset params get OffsetParam NAME OffsetParam Long len params get LenParam NAME LenParam AUDIT_LOG info Object path offset len InputStreamEntity entity InputStreamEntity is offset len response Response ok entity type MediaType APPLICATION_OCTET_STREAM build FSOperations FSFileStatus command FSOperations FSFileStatus path Map json fsExecute user command AUDIT_LOG info path response Response ok json type MediaType APPLICATION_JSON build
AUDIT_LOG info path filter filter response Response ok json type MediaType APPLICATION_JSON build enforceRootPath op value path FSOperations FSHomeDir command FSOperations FSHomeDir JSONObject json fsExecute user command AUDIT_LOG info response Response ok json type MediaType APPLICATION_JSON build enforceRootPath op value path Groups groups HttpFSServerWebApp get get Groups Set String userGroups groups getGroupsSet user getShortUserName userGroups HttpFSServerWebApp get
FSOperations FSHomeDir command FSOperations FSHomeDir JSONObject json fsExecute user command AUDIT_LOG info response Response ok json type MediaType APPLICATION_JSON build enforceRootPath op value path Groups groups HttpFSServerWebApp get get Groups Set String userGroups groups getGroupsSet user getShortUserName userGroups HttpFSServerWebApp get AccessControlException Instrumentation instrumentation HttpFSServerWebApp get get Instrumentation Map snapshot instrumentation getSnapshot response Response ok snapshot build
enforceRootPath op value path Groups groups HttpFSServerWebApp get get Groups Set String userGroups groups getGroupsSet user getShortUserName userGroups HttpFSServerWebApp get AccessControlException Instrumentation instrumentation HttpFSServerWebApp get get Instrumentation Map snapshot instrumentation getSnapshot response Response ok snapshot build FSOperations FSContentSummary command FSOperations FSContentSummary path Map json fsExecute user command AUDIT_LOG info path response Response ok json type MediaType APPLICATION_JSON build
AUDIT_LOG info path response Response ok json type MediaType APPLICATION_JSON build FSOperations FSQuotaUsage command FSOperations FSQuotaUsage path Map json fsExecute user command AUDIT_LOG info path response Response ok json type MediaType APPLICATION_JSON build FSOperations FSFileChecksum command FSOperations FSFileChecksum path Boolean noRedirect params get NoRedirectParam NAME NoRedirectParam AUDIT_LOG info path noRedirect URI redirectURL createOpenRedirectionURL uriInfo
response Response ok json type MediaType APPLICATION_JSON build FSOperations FSFileChecksum command FSOperations FSFileChecksum path Boolean noRedirect params get NoRedirectParam NAME NoRedirectParam AUDIT_LOG info path noRedirect URI redirectURL createOpenRedirectionURL uriInfo String js JsonUtil toJsonString redirectURL response Response ok js type MediaType APPLICATION_JSON build Map json fsExecute user command response Response ok json type MediaType APPLICATION_JSON build
AUDIT_LOG info path URI redirectURL createOpenRedirectionURL uriInfo String js JsonUtil toJsonString redirectURL response Response ok js type MediaType APPLICATION_JSON build Map json fsExecute user command response Response ok json type MediaType APPLICATION_JSON build response Response status Response Status BAD_REQUEST build FSOperations FSAclStatus command FSOperations FSAclStatus path Map json fsExecute user command
response Response status Response Status BAD_REQUEST build FSOperations FSAclStatus command FSOperations FSAclStatus path Map json fsExecute user command AUDIT_LOG info path response Response ok json type MediaType APPLICATION_JSON build List String xattrNames params getValues XAttrNameParam NAME XAttrNameParam XAttrCodec encoding params get XAttrEncodingParam NAME XAttrEncodingParam FSOperations FSGetXAttrs command FSOperations FSGetXAttrs path xattrNames encoding SuppressWarnings Map json fsExecute user command
FSOperations FSAclStatus command FSOperations FSAclStatus path Map json fsExecute user command AUDIT_LOG info path response Response ok json type MediaType APPLICATION_JSON build List String xattrNames params getValues XAttrNameParam NAME XAttrNameParam XAttrCodec encoding params get XAttrEncodingParam NAME XAttrEncodingParam FSOperations FSGetXAttrs command FSOperations FSGetXAttrs path xattrNames encoding SuppressWarnings Map json fsExecute user command AUDIT_LOG info path response Response ok json type MediaType APPLICATION_JSON build
List String xattrNames params getValues XAttrNameParam NAME XAttrNameParam XAttrCodec encoding params get XAttrEncodingParam NAME XAttrEncodingParam FSOperations FSGetXAttrs command FSOperations FSGetXAttrs path xattrNames encoding SuppressWarnings Map json fsExecute user command AUDIT_LOG info path response Response ok json type MediaType APPLICATION_JSON build FSOperations FSListXAttrs command FSOperations FSListXAttrs path SuppressWarnings Map json fsExecute user command AUDIT_LOG info path response Response ok json type MediaType APPLICATION_JSON build
AUDIT_LOG info path response Response ok json type MediaType APPLICATION_JSON build FSOperations FSListXAttrs command FSOperations FSListXAttrs path SuppressWarnings Map json fsExecute user command AUDIT_LOG info path response Response ok json type MediaType APPLICATION_JSON build String startAfter params get HttpFSParametersProvider StartAfterParam NAME HttpFSParametersProvider StartAfterParam token HttpFSUtils EMPTY_BYTES startAfter token startAfter getBytes Charsets UTF_8 FSOperations FSListStatusBatch command FSOperations FSListStatusBatch path token
response Response ok json type MediaType APPLICATION_JSON build String startAfter params get HttpFSParametersProvider StartAfterParam NAME HttpFSParametersProvider StartAfterParam token HttpFSUtils EMPTY_BYTES startAfter token startAfter getBytes Charsets UTF_8 FSOperations FSListStatusBatch command FSOperations FSListStatusBatch path token SuppressWarnings Map json fsExecute user command AUDIT_LOG info path token response Response ok json type MediaType APPLICATION_JSON build FSOperations FSTrashRoot command FSOperations FSTrashRoot path JSONObject json fsExecute user command
response Response ok json type MediaType APPLICATION_JSON build FSOperations FSGetStoragePolicy command FSOperations FSGetStoragePolicy path JSONObject json fsExecute user command AUDIT_LOG info path response Response ok json type MediaType APPLICATION_JSON build String oldSnapshotName params get OldSnapshotNameParam NAME OldSnapshotNameParam String snapshotName params get SnapshotNameParam NAME SnapshotNameParam FSOperations FSGetSnapshotDiff command FSOperations FSGetSnapshotDiff path oldSnapshotName snapshotName String js fsExecute user command AUDIT_LOG info path response Response ok js type MediaType APPLICATION_JSON build
Response path NAME op params request UserGroupInformation user HttpUserGroupInformation get Response response path makeAbsolute path MDC put HttpFSFileSystem OP_PARAM op value name MDC put request getRemoteAddr op value Boolean recursive params get RecursiveParam NAME RecursiveParam
path makeAbsolute path MDC put HttpFSFileSystem OP_PARAM op value name MDC put request getRemoteAddr op value Boolean recursive params get RecursiveParam NAME RecursiveParam AUDIT_LOG info path recursive FSOperations FSDelete command FSOperations FSDelete path recursive JSONObject json fsExecute user command response Response ok json type MediaType APPLICATION_JSON build String snapshotName params get SnapshotNameParam NAME SnapshotNameParam FSOperations FSDeleteSnapshot command FSOperations FSDeleteSnapshot path snapshotName fsExecute user command
Response response path makeAbsolute path MDC put HttpFSFileSystem OP_PARAM op value name MDC put request getRemoteAddr op value APPEND Boolean hasData params get DataParam NAME DataParam URI redirectURL createUploadRedirectionURL uriInfo HttpFSFileSystem Operation APPEND Boolean noRedirect params get NoRedirectParam NAME NoRedirectParam noRedirect String js JsonUtil toJsonString redirectURL response Response ok js type MediaType APPLICATION_JSON build hasData FSOperations FSAppend command FSOperations FSAppend is path fsExecute user command
String js JsonUtil toJsonString redirectURL response Response ok js type MediaType APPLICATION_JSON build FSOperations FSAppend command FSOperations FSAppend is path fsExecute user command AUDIT_LOG info path response Response ok type MediaType APPLICATION_JSON build response Response temporaryRedirect redirectURL build System out println String sources params get SourcesParam NAME SourcesParam FSOperations FSConcat command FSOperations FSConcat path sources split fsExecute user command
response Response temporaryRedirect redirectURL build System out println String sources params get SourcesParam NAME SourcesParam FSOperations FSConcat command FSOperations FSConcat path sources split fsExecute user command AUDIT_LOG info path System out println response Response ok build Long newLength params get NewLengthParam NAME NewLengthParam FSOperations FSTruncate command FSOperations FSTruncate path newLength
System out println String sources params get SourcesParam NAME SourcesParam FSOperations FSConcat command FSOperations FSConcat path sources split fsExecute user command AUDIT_LOG info path System out println response Response ok build Long newLength params get NewLengthParam NAME NewLengthParam FSOperations FSTruncate command FSOperations FSTruncate path newLength JSONObject json fsExecute user command AUDIT_LOG info path newLength response Response ok json type MediaType APPLICATION_JSON build
System out println response Response ok build Long newLength params get NewLengthParam NAME NewLengthParam FSOperations FSTruncate command FSOperations FSTruncate path newLength JSONObject json fsExecute user command AUDIT_LOG info path newLength response Response ok json type MediaType APPLICATION_JSON build FSOperations FSUnsetStoragePolicy command FSOperations FSUnsetStoragePolicy path fsExecute user command AUDIT_LOG info path response Response ok build
Short permission params get PermissionParam NAME PermissionParam Short unmaskedPermission params get UnmaskedPermissionParam NAME UnmaskedPermissionParam Boolean override params get OverwriteParam NAME OverwriteParam Short replication params get ReplicationParam NAME ReplicationParam Long blockSize params get BlockSizeParam NAME BlockSizeParam FSOperations FSCreate command FSOperations FSCreate is path permission override replication blockSize unmaskedPermission fsExecute user command AUDIT_LOG info Object path permission override replication blockSize unmaskedPermission String js JsonUtil toJsonString uriInfo getAbsolutePath response Response created uriInfo getAbsolutePath type MediaType APPLICATION_JSON entity js build response Response temporaryRedirect redirectURL build FSOperations FSAllowSnapshot command FSOperations FSAllowSnapshot path
fsExecute user command AUDIT_LOG info Object path permission override replication blockSize unmaskedPermission String js JsonUtil toJsonString uriInfo getAbsolutePath response Response created uriInfo getAbsolutePath type MediaType APPLICATION_JSON entity js build response Response temporaryRedirect redirectURL build FSOperations FSAllowSnapshot command FSOperations FSAllowSnapshot path fsExecute user command AUDIT_LOG info path response Response ok build FSOperations FSDisallowSnapshot command FSOperations FSDisallowSnapshot path
FSOperations FSAllowSnapshot command FSOperations FSAllowSnapshot path fsExecute user command AUDIT_LOG info path response Response ok build FSOperations FSDisallowSnapshot command FSOperations FSDisallowSnapshot path fsExecute user command AUDIT_LOG info path response Response ok build String snapshotName params get SnapshotNameParam NAME SnapshotNameParam
FSOperations FSDisallowSnapshot command FSOperations FSDisallowSnapshot path fsExecute user command AUDIT_LOG info path response Response ok build String snapshotName params get SnapshotNameParam NAME SnapshotNameParam FSOperations FSCreateSnapshot command FSOperations FSCreateSnapshot path snapshotName String json fsExecute user command AUDIT_LOG info path snapshotName response Response ok json type MediaType APPLICATION_JSON build String xattrName params get XAttrNameParam NAME XAttrNameParam
String snapshotName params get SnapshotNameParam NAME SnapshotNameParam FSOperations FSCreateSnapshot command FSOperations FSCreateSnapshot path snapshotName String json fsExecute user command AUDIT_LOG info path snapshotName response Response ok json type MediaType APPLICATION_JSON build String xattrName params get XAttrNameParam NAME XAttrNameParam String xattrValue params get XAttrValueParam NAME XAttrValueParam EnumSet XAttrSetFlag flag params get XAttrSetFlagParam NAME XAttrSetFlagParam FSOperations FSSetXAttr command FSOperations FSSetXAttr path xattrName xattrValue flag fsExecute user command AUDIT_LOG info path xattrName response Response ok build
String xattrName params get XAttrNameParam NAME XAttrNameParam String xattrValue params get XAttrValueParam NAME XAttrValueParam EnumSet XAttrSetFlag flag params get XAttrSetFlagParam NAME XAttrSetFlagParam FSOperations FSSetXAttr command FSOperations FSSetXAttr path xattrName xattrValue flag fsExecute user command AUDIT_LOG info path xattrName response Response ok build String oldSnapshotName params get OldSnapshotNameParam NAME OldSnapshotNameParam String snapshotName params get SnapshotNameParam NAME SnapshotNameParam FSOperations FSRenameSnapshot command FSOperations FSRenameSnapshot path oldSnapshotName snapshotName fsExecute user command AUDIT_LOG info path oldSnapshotName snapshotName
response Response ok build String oldSnapshotName params get OldSnapshotNameParam NAME OldSnapshotNameParam String snapshotName params get SnapshotNameParam NAME SnapshotNameParam FSOperations FSRenameSnapshot command FSOperations FSRenameSnapshot path oldSnapshotName snapshotName fsExecute user command AUDIT_LOG info path oldSnapshotName snapshotName response Response ok build String xattrName params get XAttrNameParam NAME XAttrNameParam FSOperations FSRemoveXAttr command FSOperations FSRemoveXAttr path xattrName fsExecute user command AUDIT_LOG info path xattrName
fsExecute user command AUDIT_LOG info path oldSnapshotName snapshotName response Response ok build String xattrName params get XAttrNameParam NAME XAttrNameParam FSOperations FSRemoveXAttr command FSOperations FSRemoveXAttr path xattrName fsExecute user command AUDIT_LOG info path xattrName response Response ok build Short permission params get PermissionParam NAME PermissionParam Short unmaskedPermission params get UnmaskedPermissionParam NAME UnmaskedPermissionParam FSOperations FSMkdirs command FSOperations FSMkdirs path permission unmaskedPermission
fsExecute user command AUDIT_LOG info path xattrName response Response ok build Short permission params get PermissionParam NAME PermissionParam Short unmaskedPermission params get UnmaskedPermissionParam NAME UnmaskedPermissionParam FSOperations FSMkdirs command FSOperations FSMkdirs path permission unmaskedPermission JSONObject json fsExecute user command AUDIT_LOG info path permission unmaskedPermission response Response ok json type MediaType APPLICATION_JSON build String toPath params get DestinationParam NAME DestinationParam FSOperations FSRename command FSOperations FSRename path toPath
Short unmaskedPermission params get UnmaskedPermissionParam NAME UnmaskedPermissionParam FSOperations FSMkdirs command FSOperations FSMkdirs path permission unmaskedPermission JSONObject json fsExecute user command AUDIT_LOG info path permission unmaskedPermission response Response ok json type MediaType APPLICATION_JSON build String toPath params get DestinationParam NAME DestinationParam FSOperations FSRename command FSOperations FSRename path toPath JSONObject json fsExecute user command AUDIT_LOG info path toPath response Response ok json type MediaType APPLICATION_JSON build String owner params get OwnerParam NAME OwnerParam
String toPath params get DestinationParam NAME DestinationParam FSOperations FSRename command FSOperations FSRename path toPath JSONObject json fsExecute user command AUDIT_LOG info path toPath response Response ok json type MediaType APPLICATION_JSON build String owner params get OwnerParam NAME OwnerParam String group params get GroupParam NAME GroupParam FSOperations FSSetOwner command FSOperations FSSetOwner path owner group fsExecute user command AUDIT_LOG info path owner group response Response ok build
String owner params get OwnerParam NAME OwnerParam String group params get GroupParam NAME GroupParam FSOperations FSSetOwner command FSOperations FSSetOwner path owner group fsExecute user command AUDIT_LOG info path owner group response Response ok build Short permission params get PermissionParam NAME PermissionParam FSOperations FSSetPermission command FSOperations FSSetPermission path permission fsExecute user command AUDIT_LOG info path permission response Response ok build
Short permission params get PermissionParam NAME PermissionParam FSOperations FSSetPermission command FSOperations FSSetPermission path permission fsExecute user command AUDIT_LOG info path permission response Response ok build Short replication params get ReplicationParam NAME ReplicationParam FSOperations FSSetReplication command FSOperations FSSetReplication path replication JSONObject json fsExecute user command AUDIT_LOG info path replication response Response ok json build
AUDIT_LOG info path permission response Response ok build Short replication params get ReplicationParam NAME ReplicationParam FSOperations FSSetReplication command FSOperations FSSetReplication path replication JSONObject json fsExecute user command AUDIT_LOG info path replication response Response ok json build Long modifiedTime params get ModifiedTimeParam NAME ModifiedTimeParam Long accessTime params get AccessTimeParam NAME AccessTimeParam FSOperations FSSetTimes command FSOperations FSSetTimes path modifiedTime accessTime fsExecute user command
JSONObject json fsExecute user command AUDIT_LOG info path replication response Response ok json build Long modifiedTime params get ModifiedTimeParam NAME ModifiedTimeParam Long accessTime params get AccessTimeParam NAME AccessTimeParam FSOperations FSSetTimes command FSOperations FSSetTimes path modifiedTime accessTime fsExecute user command AUDIT_LOG info path modifiedTime accessTime response Response ok build String aclSpec params get AclPermissionParam NAME AclPermissionParam FSOperations FSSetAcl command FSOperations FSSetAcl path aclSpec
Long accessTime params get AccessTimeParam NAME AccessTimeParam FSOperations FSSetTimes command FSOperations FSSetTimes path modifiedTime accessTime fsExecute user command AUDIT_LOG info path modifiedTime accessTime response Response ok build String aclSpec params get AclPermissionParam NAME AclPermissionParam FSOperations FSSetAcl command FSOperations FSSetAcl path aclSpec fsExecute user command AUDIT_LOG info path aclSpec response Response ok build FSOperations FSRemoveAcl command FSOperations FSRemoveAcl path
String aclSpec params get AclPermissionParam NAME AclPermissionParam FSOperations FSSetAcl command FSOperations FSSetAcl path aclSpec fsExecute user command AUDIT_LOG info path aclSpec response Response ok build FSOperations FSRemoveAcl command FSOperations FSRemoveAcl path fsExecute user command AUDIT_LOG info path response Response ok build String aclSpec params get AclPermissionParam NAME AclPermissionParam
FSOperations FSRemoveAcl command FSOperations FSRemoveAcl path fsExecute user command AUDIT_LOG info path response Response ok build String aclSpec params get AclPermissionParam NAME AclPermissionParam FSOperations FSModifyAclEntries command FSOperations FSModifyAclEntries path aclSpec fsExecute user command AUDIT_LOG info path aclSpec response Response ok build
String aclSpec params get AclPermissionParam NAME AclPermissionParam FSOperations FSModifyAclEntries command FSOperations FSModifyAclEntries path aclSpec fsExecute user command AUDIT_LOG info path aclSpec response Response ok build String aclSpec params get AclPermissionParam NAME AclPermissionParam FSOperations FSRemoveAclEntries command FSOperations FSRemoveAclEntries path aclSpec fsExecute user command AUDIT_LOG info path aclSpec response Response ok build
AUDIT_LOG info path aclSpec response Response ok build String aclSpec params get AclPermissionParam NAME AclPermissionParam FSOperations FSRemoveAclEntries command FSOperations FSRemoveAclEntries path aclSpec fsExecute user command AUDIT_LOG info path aclSpec response Response ok build FSOperations FSRemoveDefaultAcl command FSOperations FSRemoveDefaultAcl path fsExecute user command AUDIT_LOG info path response Response ok build
status Status IllegalStateException status Status BOOTING verifyDir homeDir verifyDir tempDir Properties serverInfo Properties InputStream is getResource name serverInfo load is is close RuntimeException name initLog log info
IllegalStateException status Status BOOTING verifyDir homeDir verifyDir tempDir Properties serverInfo Properties InputStream is getResource name serverInfo load is is close RuntimeException name initLog log info log info name log info
status Status BOOTING verifyDir homeDir verifyDir tempDir Properties serverInfo Properties InputStream is getResource name serverInfo load is is close RuntimeException name initLog log info log info name log info log info serverInfo getProperty name
status Status BOOTING verifyDir homeDir verifyDir tempDir Properties serverInfo Properties InputStream is getResource name serverInfo load is is close RuntimeException name initLog log info log info name log info log info serverInfo getProperty name
verifyDir homeDir verifyDir tempDir Properties serverInfo Properties InputStream is getResource name serverInfo load is is close RuntimeException name initLog log info log info name log info log info serverInfo getProperty name log info serverInfo getProperty name
verifyDir tempDir Properties serverInfo Properties InputStream is getResource name serverInfo load is is close RuntimeException name initLog log info log info name log info log info serverInfo getProperty name log info serverInfo getProperty name log info serverInfo getProperty name
defaultConf Configuration ConfigurationUtils load defaultConf inputStream ex ServerException ServerException ERROR S03 defaultConfig ex getMessage ex Configuration siteConf File siteFile File file name siteFile log warn siteFile siteConf Configuration siteFile ServerException ServerException ERROR S05 siteFile getAbsolutePath
siteFile ServerException ServerException ERROR S05 siteFile getAbsolutePath log debug siteFile inputStream Files newInputStream siteFile toPath siteConf Configuration ConfigurationUtils load siteConf inputStream ex ServerException ServerException ERROR S06 siteFile ex getMessage ex config Configuration ConfigurationUtils copy siteConf config ConfigurationUtils injectDefaults defaultConf config ConfigRedactor redactor ConfigRedactor config
inputStream Files newInputStream siteFile toPath siteConf Configuration ConfigurationUtils load siteConf inputStream ex ServerException ServerException ERROR S06 siteFile ex getMessage ex config Configuration ConfigurationUtils copy siteConf config ConfigurationUtils injectDefaults defaultConf config ConfigRedactor redactor ConfigRedactor config String name System String value System getProperty name name config set name value String redacted redactor redact name value log info name redacted
Service klass Service service Service klass newInstance
List Service loadServices Map Class Service map LinkedHashMap Class Service Class classes getConfig getClasses getPrefixedName CONF_SERVICES Class classesExt getConfig getClasses getPrefixedName CONF_SERVICES_EXT List Service list ArrayList Service loadServices classes list loadServices classesExt list Service list map
List Service list ArrayList Service services values Collections reverse list Service list
ensureOperational Check notNull klass IllegalStateException Service newService klass newInstance Service oldService services get newService getInterface oldService oldService destroy ex log error Object oldService getInterface ex getMessage ex newService init services put newService getInterface newService ex
callable delay interval unit Check notNull callable LOG debug Object callable delay interval unit String instrName callable getClass getSimpleName Instrumentation instr getServer get Instrumentation getServer
Runtime r Runtime getRuntime String cp System getProperty String buildTestDir System getProperty String fuseCmd buildTestDir String libHdfs buildTestDir String arch System getProperty String jvm System getProperty arch String lp System getProperty libHdfs jvm
FileSystem fs FileSystem get config String exportsPath config getStrings NfsConfigKeys DFS_NFS_EXPORT_POINT_KEY NfsConfigKeys DFS_NFS_EXPORT_POINT_DEFAULT String exportPath exportsPath URI exportURI Nfs3Utils getResolvedURI fs exportPath
MountResponse writeMNTResponse Nfs3Status NFS3ERR_ACCES out xid String path xdr readString LOG LOG debug path client String host client getHostName LOG LOG debug host path URI exportURI exports get path exportURI LOG info path MountResponse writeMNTResponse Nfs3Status NFS3ERR_NOENT out xid out DFSClient dfsClient dfsClient DFSClient exportURI config
LOG debug host path URI exportURI exports get path exportURI LOG info path MountResponse writeMNTResponse Nfs3Status NFS3ERR_NOENT out xid out DFSClient dfsClient dfsClient DFSClient exportURI config e LOG error path e MountResponse writeMNTResponse Nfs3Status NFS3ERR_NOENT out xid out FileHandle handle
LOG info path MountResponse writeMNTResponse Nfs3Status NFS3ERR_NOENT out xid out DFSClient dfsClient dfsClient DFSClient exportURI config e LOG error path e MountResponse writeMNTResponse Nfs3Status NFS3ERR_NOENT out xid out FileHandle handle HdfsFileStatus exFileStatus dfsClient getFileInfo exportURI getPath handle FileHandle exFileStatus getFileId Nfs3Utils getNamenodeId config exportURI e
xdr String path xdr readString
FileSystem fs FileSystem get config String exportsPath config getStrings NfsConfigKeys DFS_NFS_EXPORT_POINT_KEY NfsConfigKeys DFS_NFS_EXPORT_POINT_DEFAULT String exportPath exportsPath URI exportURI Nfs3Utils getResolvedURI fs exportPath namenodeId Nfs3Utils getNamenodeId config exportURI URI value namenodeUriMap get namenodeId value
UserGroupInformation effectiveUser UserGroupInformation realUser Preconditions checkNotNull effectiveUser Preconditions checkNotNull realUser realUser checkTGTAndReloginFromKeytab UserGroupInformation ugi UserGroupInformation createProxyUser effectiveUser realUser
count newValue nonSequentialWriteInMemory addAndGet count
request cachedOffset offset request getOffset count request getCount smallerCount offset count cachedOffset
WriteCtx request offset request getOffset count request getCount cachedOffset nextOffset get originalCount WriteCtx INVALID_ORIGINAL_COUNT
LOG warn String format offset offset count cachedOffset offset cachedOffset offset count cachedOffset LOG warn String format offset offset count cachedOffset offset cachedOffset cachedOffset offset count LOG warn alterWriteRequest request cachedOffset originalCount count offset request getOffset count request getCount offset cachedOffset LOG warn offset count nextOffset DataState dataState offset cachedOffset WriteCtx DataState NO_DUMP WriteCtx DataState ALLOW_DUMP WriteCtx writeCtx WriteCtx request getHandle request getOffset request getCount originalCount request getStableHow request getData channel xid dataState
alterWriteRequest request cachedOffset originalCount count offset request getOffset count request getCount offset cachedOffset LOG warn offset count nextOffset DataState dataState offset cachedOffset WriteCtx DataState NO_DUMP WriteCtx DataState ALLOW_DUMP WriteCtx writeCtx WriteCtx request getHandle request getOffset request getCount originalCount request getStableHow request getData channel xid dataState LOG debug cachedOffset offset writeCtx WriteCtx DataState ALLOW_DUMP updateNonSequentialWriteInMemory count WriteCtx oldWriteCtx checkRepeatedWriteRequest request channel xid oldWriteCtx
WRITE3Response response readbuffer count readCount FSDataInputStream fis fos hsync EnumSet of SyncFlag UPDATE_LENGTH LOG info e LOG info path e toString WRITE3Response Nfs3Status NFS3ERR_IO wccData stableHow Nfs3Constant WRITE_COMMIT_VERF fis dfsClient createWrappedInputStream dfsClient open path readCount fis read offset readbuffer count readCount count
FSDataInputStream fis fos hsync EnumSet of SyncFlag UPDATE_LENGTH LOG info e LOG info path e toString WRITE3Response Nfs3Status NFS3ERR_IO wccData stableHow Nfs3Constant WRITE_COMMIT_VERF fis dfsClient createWrappedInputStream dfsClient open path readCount fis read offset readbuffer count readCount count LOG error count readCount WRITE3Response Nfs3Status NFS3ERR_IO wccData stableHow Nfs3Constant WRITE_COMMIT_VERF e
LOG error count readCount WRITE3Response Nfs3Status NFS3ERR_IO wccData stableHow Nfs3Constant WRITE_COMMIT_VERF e LOG info path e WRITE3Response Nfs3Status NFS3ERR_IO wccData stableHow Nfs3Constant WRITE_COMMIT_VERF IOUtils cleanupWithLogger LOG fis Comparator comparator Comparator comparator readCount count LOG info response WRITE3Response Nfs3Status NFS3ERR_INVAL wccData stableHow Nfs3Constant WRITE_COMMIT_VERF LOG info Nfs3FileAttributes postOpAttr
Preconditions checkState channel preOpAttr updateLastAccessTime Preconditions checkState commitOffset COMMIT_STATUS ret checkCommitInternal commitOffset channel xid preOpAttr fromRead LOG debug ret name ret COMMIT_STATUS ret COMMIT_STATUS COMMIT_FINISHED fos hsync EnumSet of SyncFlag UPDATE_LENGTH ret COMMIT_STATUS COMMIT_FINISHED ret COMMIT_STATUS COMMIT_FINISHED ret COMMIT_STATUS COMMIT_ERROR
pendingWrites LOG debug latestAttr getFileId processCommits nextOffset get asyncStatus Entry OffsetRange WriteCtx lastEntry pendingWrites lastEntry OffsetRange range lastEntry getKey WriteCtx toWrite lastEntry getValue LOG trace range getMin nextOffset offset nextOffset get range getMin offset LOG debug processCommits nextOffset get asyncStatus range offset
OffsetRange range lastEntry getKey WriteCtx toWrite lastEntry getValue LOG trace range getMin nextOffset offset nextOffset get range getMin offset LOG debug processCommits nextOffset get asyncStatus range offset LOG debug range pendingWrites remove range range getMin offset range offset LOG warn range offset pendingWrites remove range trimWriteRequest toWrite offset
offset nextOffset get range offset LOG debug processCommits nextOffset get asyncStatus range offset LOG debug range pendingWrites remove range range offset range offset LOG warn range offset pendingWrites remove range trimWriteRequest toWrite offset nextOffset addAndGet toWrite getCount LOG debug nextOffset get toWrite
processCommits nextOffset get asyncStatus range offset LOG debug range pendingWrites remove range range offset range offset LOG warn range offset pendingWrites remove range trimWriteRequest toWrite offset nextOffset addAndGet toWrite getCount LOG debug nextOffset get toWrite LOG debug range pendingWrites remove range
WriteCtx toWrite offerNextToWrite toWrite doSingleWrite toWrite updateLastAccessTime LOG debug latestAttr getFileId asyncStatus
offset Preconditions checkState offset flushedOffset getFlushedOffset Entry Long CommitCtx entry pendingCommits firstEntry entry entry offset flushedOffset status Nfs3Status NFS3ERR_IO fos hsync EnumSet of SyncFlag UPDATE_LENGTH status Nfs3Status NFS3_OK cce LOG error latestAttr getFileId cce status Nfs3Status NFS3ERR_IO
status Nfs3Status NFS3ERR_IO fos hsync EnumSet of SyncFlag UPDATE_LENGTH status Nfs3Status NFS3_OK cce LOG error latestAttr getFileId cce status Nfs3Status NFS3ERR_IO e LOG error e status Nfs3Status NFS3ERR_IO latestAttr Nfs3Utils getFileAttr client Nfs3Utils getFileIdPath latestAttr getFileId iug e
fos hsync EnumSet of SyncFlag UPDATE_LENGTH status Nfs3Status NFS3_OK cce LOG error latestAttr getFileId cce status Nfs3Status NFS3ERR_IO e LOG error e status Nfs3Status NFS3ERR_IO latestAttr Nfs3Utils getFileAttr client Nfs3Utils getFileIdPath latestAttr getFileId iug e LOG error latestAttr getFileId e status Nfs3Status NFS3ERR_IO
e LOG error e status Nfs3Status NFS3ERR_IO latestAttr Nfs3Utils getFileAttr client Nfs3Utils getFileIdPath latestAttr getFileId iug e LOG error latestAttr getFileId e status Nfs3Status NFS3ERR_IO latestAttr getSize offset LOG error offset latestAttr getSize status Nfs3Status NFS3ERR_IO WccData wccData WccData Nfs3Utils getWccAttr latestAttr latestAttr entry entry getValue offset pendingCommits remove entry getKey CommitCtx commit entry getValue
writeCtx Channel channel writeCtx getChannel xid writeCtx getXid offset writeCtx getOffset count writeCtx getCount WriteStableHow stableHow writeCtx getStableHow FileHandle handle writeCtx getHandle
FileHandle handle writeCtx getHandle LOG LOG debug handle dumpFileHandle offset count stableHow name writeCtx writeData fos RpcProgramNfs3 metrics incrBytesWritten writeCtx getCount flushedOffset getFlushedOffset flushedOffset offset count IOException flushedOffset offset count writeCtx WriteCtx DataState writeCtx writeCtx WriteCtx DataState writeCtx setDataState WriteCtx DataState NO_DUMP updateNonSequentialWriteInMemory count LOG
writeCtx writeData fos RpcProgramNfs3 metrics incrBytesWritten writeCtx getCount flushedOffset getFlushedOffset flushedOffset offset count IOException flushedOffset offset count writeCtx WriteCtx DataState writeCtx writeCtx WriteCtx DataState writeCtx setDataState WriteCtx DataState NO_DUMP updateNonSequentialWriteInMemory count LOG LOG debug handle dumpFileHandle offset nonSequentialWriteInMemory get writeCtx
writeCtx WriteCtx DataState writeCtx writeCtx WriteCtx DataState writeCtx setDataState WriteCtx DataState NO_DUMP updateNonSequentialWriteInMemory count LOG LOG debug handle dumpFileHandle offset nonSequentialWriteInMemory get writeCtx stableHow WriteStableHow LOG info writeCtx stableHow WriteStableHow fos hsync Preconditions checkState stableHow WriteStableHow FILE_SYNC stableHow
stableHow WriteStableHow LOG info writeCtx stableHow WriteStableHow fos hsync Preconditions checkState stableHow WriteStableHow FILE_SYNC stableHow fos hsync EnumSet of SyncFlag UPDATE_LENGTH e LOG error writeCtx e e WccAttr preOpAttr latestAttr getWccAttr WccData fileWcc WccData preOpAttr latestAttr writeCtx getOriginalCount LOG warn writeCtx getOriginalCount count
Preconditions checkState stableHow WriteStableHow FILE_SYNC stableHow fos hsync EnumSet of SyncFlag UPDATE_LENGTH e LOG error writeCtx e e WccAttr preOpAttr latestAttr getWccAttr WccData fileWcc WccData preOpAttr latestAttr writeCtx getOriginalCount LOG warn writeCtx getOriginalCount count count writeCtx getOriginalCount WRITE3Response response WRITE3Response Nfs3Status NFS3_OK fileWcc count stableHow Nfs3Constant WRITE_COMMIT_VERF RpcProgramNfs3 metrics addWrite Nfs3Utils getElapsedTime writeCtx startTime Nfs3Utils writeChannel channel response serialize XDR xid VerifierNone xid processCommits writeCtx getOffset writeCtx getCount
activeState dumpThread dumpThread dumpThread interrupt dumpThread join fos fos close e LOG info latestAttr getFileId e toString LOG info pendingWrites size WccAttr preOpAttr latestAttr getWccAttr pendingWrites OffsetRange key pendingWrites firstKey
fos fos close e LOG info latestAttr getFileId e toString LOG info pendingWrites size WccAttr preOpAttr latestAttr getWccAttr pendingWrites OffsetRange key pendingWrites firstKey LOG info key nextOffset get WriteCtx writeCtx pendingWrites remove key writeCtx WccData fileWcc WccData preOpAttr latestAttr WRITE3Response response WRITE3Response Nfs3Status NFS3ERR_IO fileWcc writeCtx getStableHow Nfs3Constant WRITE_COMMIT_VERF Nfs3Utils writeChannel writeCtx getChannel response serialize XDR writeCtx getXid VerifierNone writeCtx getXid
LOG info pendingWrites size WccAttr preOpAttr latestAttr getWccAttr pendingWrites OffsetRange key pendingWrites firstKey LOG info key nextOffset get WriteCtx writeCtx pendingWrites remove key writeCtx WccData fileWcc WccData preOpAttr latestAttr WRITE3Response response WRITE3Response Nfs3Status NFS3ERR_IO fileWcc writeCtx getStableHow Nfs3Constant WRITE_COMMIT_VERF Nfs3Utils writeChannel writeCtx getChannel response serialize XDR writeCtx getXid VerifierNone writeCtx getXid dumpOut dumpOut close e LOG error dumpFilePath e
LOG debug ctx pairs ctx idlest idlest pairs ctx getLastAccessTime idlest getValue getLastAccessTime idlest pairs idlest LOG warn idleTime Time monotonicNow idlest getValue getLastAccessTime idleTime
Iterator Entry FileHandle OpenFileCtx it openFileMap entrySet iterator LOG LOG trace size it Entry FileHandle OpenFileCtx pairs it next FileHandle handle pairs getKey OpenFileCtx ctx pairs getValue ctx handle OpenFileCtx ctx2 openFileMap get handle ctx2 ctx2 handle openFileMap remove handle LOG
writeDumpDir File dumpDir File writeDumpDir dumpDir
GETATTR3Response xdr GETATTR3Response response GETATTR3Response Nfs3Status NFS3_OK response setStatus Nfs3Status NFS3ERR_ACCES response GETATTR3Request request request GETATTR3Request deserialize xdr LOG error response setStatus Nfs3Status NFS3ERR_INVAL response FileHandle handle request getHandle namenodeId handle getNamenodeId LOG
namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response Nfs3FileAttributes attrs attrs writeManager getFileAttr dfsClient handle iug r LOG warn r IOException io r unwrapRemoteException io GETATTR3Response Nfs3Status NFS3ERR_ACCES
dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response Nfs3FileAttributes attrs attrs writeManager getFileAttr dfsClient handle iug r LOG warn r IOException io r unwrapRemoteException io GETATTR3Response Nfs3Status NFS3ERR_ACCES GETATTR3Response Nfs3Status NFS3ERR_IO IOException e LOG info handle getFileId e
newAttr EnumSet SetAttrField updateFields newAttr getUpdateFields updateFields SetAttrField
request SETATTR3Request deserialize xdr LOG error response setStatus Nfs3Status NFS3ERR_INVAL response FileHandle handle request getHandle namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response request
FileHandle handle request getHandle namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response request LOG error handle getFileId response setStatus Nfs3Status NFS3ERR_INVAL response String fileIdPath Nfs3Utils getFileIdPath handle Nfs3FileAttributes preOpAttr
LOG info handle getFileId response setStatus Nfs3Status NFS3ERR_STALE response WccAttr preOpWcc Nfs3Utils getWccAttr preOpAttr request preOpAttr request WccData wccData WccData preOpWcc preOpAttr SETATTR3Response Nfs3Status NFS3ERR_NOT_SYNC wccData SETATTR3Response Nfs3Status NFS3ERR_ACCES WccData preOpWcc preOpAttr setattrInternal dfsClient fileIdPath request getAttr Nfs3FileAttributes postOpAttr Nfs3Utils getFileAttr dfsClient fileIdPath iug WccData wccData WccData preOpWcc postOpAttr SETATTR3Response Nfs3Status NFS3_OK wccData
LOOKUP3Response xdr LOOKUP3Response response LOOKUP3Response Nfs3Status NFS3_OK response setStatus Nfs3Status NFS3ERR_ACCES response LOOKUP3Request request request LOOKUP3Request deserialize xdr LOG error LOOKUP3Response Nfs3Status NFS3ERR_INVAL FileHandle dirHandle request getHandle String fileName request getName namenodeId dirHandle getNamenodeId LOG
LOG error LOOKUP3Response Nfs3Status NFS3ERR_INVAL FileHandle dirHandle request getHandle String fileName request getName namenodeId dirHandle getNamenodeId LOG LOG debug dirHandle dumpFileHandle fileName remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response String dirFileIdPath Nfs3Utils getFileIdPath dirHandle Nfs3FileAttributes postOpObjAttr writeManager getFileAttr dfsClient dirHandle fileName namenodeId
FileHandle dirHandle request getHandle String fileName request getName namenodeId dirHandle getNamenodeId LOG LOG debug dirHandle dumpFileHandle fileName remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response String dirFileIdPath Nfs3Utils getFileIdPath dirHandle Nfs3FileAttributes postOpObjAttr writeManager getFileAttr dfsClient dirHandle fileName namenodeId postOpObjAttr LOG debug dirHandle getFileId fileName Nfs3FileAttributes postOpDirAttr Nfs3Utils getFileAttr dfsClient dirFileIdPath iug
response setStatus Nfs3Status NFS3ERR_ACCES response ACCESS3Request request request ACCESS3Request deserialize xdr LOG error ACCESS3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response LOG
request ACCESS3Request deserialize xdr LOG error ACCESS3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response LOG LOG debug handle dumpFileHandle remoteAddress Nfs3FileAttributes attrs attrs writeManager getFileAttr dfsClient handle iug
LOG error READLINK3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response String fileIdPath Nfs3Utils getFileIdPath handle String target dfsClient getLinkTarget fileIdPath Nfs3FileAttributes postOpAttr Nfs3Utils getFileAttr dfsClient fileIdPath iug
READLINK3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response String fileIdPath Nfs3Utils getFileIdPath handle String target dfsClient getLinkTarget fileIdPath Nfs3FileAttributes postOpAttr Nfs3Utils getFileAttr dfsClient fileIdPath iug postOpAttr LOG info handle getFileId
namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response String fileIdPath Nfs3Utils getFileIdPath handle String target dfsClient getLinkTarget fileIdPath Nfs3FileAttributes postOpAttr Nfs3Utils getFileAttr dfsClient fileIdPath iug postOpAttr LOG info handle getFileId READLINK3Response Nfs3Status NFS3ERR_STALE postOpAttr
String userName securityHandler getUser response setStatus Nfs3Status NFS3ERR_ACCES response READ3Request request request READ3Request deserialize xdr LOG error READ3Response Nfs3Status NFS3ERR_INVAL offset request getOffset count request getCount FileHandle handle request getHandle namenodeId handle getNamenodeId LOG
READ3Response Nfs3Status NFS3ERR_INVAL offset request getOffset count request getCount FileHandle handle request getHandle namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle offset count remoteAddress DFSClient dfsClient clientCache getDfsClient userName namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response Nfs3FileAttributes attrs eof count
count request getCount FileHandle handle request getHandle namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle offset count remoteAddress DFSClient dfsClient clientCache getDfsClient userName namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response Nfs3FileAttributes attrs eof count attrs Nfs3Utils getFileAttr dfsClient Nfs3Utils getFileIdPath handle iug
READ3Response Nfs3Status NFS3ERR_ACCES ret writeManager commitBeforeRead dfsClient handle offset count ret Nfs3Status LOG warn ret rtmax config getInt NfsConfigKeys DFS_NFS_MAX_READ_TRANSFER_SIZE_KEY NfsConfigKeys DFS_NFS_MAX_READ_TRANSFER_SIZE_DEFAULT buffSize Math min rtmax count readbuffer buffSize readCount FSDataInputStream fis clientCache getDfsInputStream userName Nfs3Utils getFileIdPath handle namenodeId fis READ3Response Nfs3Status NFS3ERR_ACCES readCount fis read offset readbuffer count
request WRITE3Request deserialize xdr LOG error WRITE3Response Nfs3Status NFS3ERR_INVAL offset request getOffset count request getCount WriteStableHow stableHow request getStableHow data request getData array data count LOG error WRITE3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId LOG
WriteStableHow stableHow request getStableHow data request getData array data count LOG error WRITE3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle offset count stableHow getValue xid remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response Nfs3FileAttributes preOpAttr
FileHandle handle request getHandle namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle offset count stableHow getValue xid remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response Nfs3FileAttributes preOpAttr preOpAttr writeManager getFileAttr dfsClient handle iug preOpAttr LOG error handle getFileId WRITE3Response Nfs3Status NFS3ERR_STALE remoteAddress
namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle offset count stableHow getValue xid remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response Nfs3FileAttributes preOpAttr preOpAttr writeManager getFileAttr dfsClient handle iug preOpAttr LOG error handle getFileId WRITE3Response Nfs3Status NFS3ERR_STALE remoteAddress WRITE3Response Nfs3Status NFS3ERR_ACCES WccData Nfs3Utils getWccAttr preOpAttr preOpAttr stableHow Nfs3Constant WRITE_COMMIT_VERF
request CREATE3Request deserialize xdr LOG error CREATE3Response Nfs3Status NFS3ERR_INVAL FileHandle dirHandle request getHandle String fileName request getName namenodeId dirHandle getNamenodeId LOG LOG debug dirHandle dumpFileHandle fileName remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response createMode request getMode createMode request request
DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response createMode request getMode createMode request request LOG error fileName dirHandle getFileId CREATE3Response Nfs3Status NFS3ERR_INVAL HdfsDataOutputStream fos String dirFileIdPath Nfs3Utils getFileIdPath dirHandle Nfs3FileAttributes preOpDirAttr Nfs3FileAttributes postOpObjAttr FileHandle fileHandle WccData dirWcc
CREATE3Response Nfs3Status NFS3ERR_ACCES preOpDirAttr WccData Nfs3Utils getWccAttr preOpDirAttr preOpDirAttr String fileIdPath Nfs3Utils getFileIdPath dirHandle fileName SetAttr3 setAttr3 request getObjAttr assert setAttr3 FsPermission permission setAttr3 getUpdateFields contains SetAttrField MODE FsPermission setAttr3 getMode FsPermission getDefault applyUMask umask EnumSet CreateFlag flag createMode Nfs3Constant CREATE_EXCLUSIVE EnumSet of CreateFlag CREATE CreateFlag OVERWRITE EnumSet of CreateFlag CREATE fos dfsClient createWrappedOutputStream dfsClient create fileIdPath permission flag replication blockSize bufferSize createMode Nfs3Constant createMode Nfs3Constant setAttr3 getUpdateFields contains SetAttrField GID setAttr3 getUpdateFields add SetAttrField GID setAttr3 setGid securityHandler getGid setattrInternal dfsClient fileIdPath setAttr3 postOpObjAttr Nfs3Utils getFileAttr dfsClient fileIdPath iug dirWcc Nfs3Utils createWccData Nfs3Utils getWccAttr preOpDirAttr dfsClient dirFileIdPath iug OpenFileCtx openFileCtx OpenFileCtx fos postOpObjAttr writeDumpDir postOpObjAttr getFileId dfsClient iug aixCompatMode config
MKDIR3Response response MKDIR3Response Nfs3Status NFS3_OK MKDIR3Request request request MKDIR3Request deserialize xdr LOG error MKDIR3Response Nfs3Status NFS3ERR_INVAL FileHandle dirHandle request getHandle String fileName request getName namenodeId dirHandle getNamenodeId DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response LOG
request MKDIR3Request deserialize xdr LOG error MKDIR3Response Nfs3Status NFS3ERR_INVAL FileHandle dirHandle request getHandle String fileName request getName namenodeId dirHandle getNamenodeId DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response LOG LOG debug dirHandle dumpFileHandle fileName remoteAddress request
DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response LOG LOG debug dirHandle dumpFileHandle fileName remoteAddress LOG error fileName dirHandle MKDIR3Response Nfs3Status NFS3ERR_INVAL String dirFileIdPath Nfs3Utils getFileIdPath dirHandle Nfs3FileAttributes preOpDirAttr Nfs3FileAttributes postOpDirAttr Nfs3FileAttributes postOpObjAttr FileHandle objFileHandle
MKDIR3Response Nfs3Status NFS3ERR_ACCES preOpDirAttr WccData Nfs3Utils getWccAttr preOpDirAttr preOpDirAttr String fileIdPath dirFileIdPath fileName SetAttr3 setAttr3 request getObjAttr FsPermission permission setAttr3 getUpdateFields contains SetAttrField MODE FsPermission setAttr3 getMode FsPermission getDefault applyUMask umask dfsClient fileIdPath permission WccData dirWcc Nfs3Utils createWccData Nfs3Utils getWccAttr preOpDirAttr dfsClient dirFileIdPath iug MKDIR3Response Nfs3Status NFS3ERR_IO dirWcc setAttr3 getUpdateFields contains SetAttrField GID setAttr3 getUpdateFields add SetAttrField GID setAttr3 setGid securityHandler getGid setattrInternal dfsClient fileIdPath setAttr3 postOpObjAttr Nfs3Utils getFileAttr dfsClient fileIdPath iug objFileHandle FileHandle postOpObjAttr getFileId namenodeId WccData dirWcc Nfs3Utils createWccData Nfs3Utils getWccAttr preOpDirAttr dfsClient dirFileIdPath iug MKDIR3Response Nfs3Status NFS3_OK FileHandle postOpObjAttr getFileId namenodeId postOpObjAttr dirWcc
REMOVE3Response Nfs3Status NFS3ERR_INVAL FileHandle dirHandle request getHandle namenodeId dirHandle getNamenodeId String fileName request getName LOG LOG debug dirHandle dumpFileHandle fileName remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response String dirFileIdPath Nfs3Utils getFileIdPath dirHandle Nfs3FileAttributes preOpDirAttr Nfs3FileAttributes postOpDirAttr preOpDirAttr Nfs3Utils getFileAttr dfsClient dirFileIdPath iug
WccData errWcc WccData Nfs3Utils getWccAttr preOpDirAttr preOpDirAttr REMOVE3Response Nfs3Status NFS3ERR_ACCES errWcc String fileIdPath dirFileIdPath fileName HdfsFileStatus fstat Nfs3Utils getFileStatus dfsClient fileIdPath fstat REMOVE3Response Nfs3Status NFS3ERR_NOENT errWcc fstat REMOVE3Response Nfs3Status NFS3ERR_ISDIR errWcc result dfsClient delete fileIdPath WccData dirWcc Nfs3Utils createWccData Nfs3Utils getWccAttr preOpDirAttr dfsClient dirFileIdPath iug result REMOVE3Response Nfs3Status NFS3ERR_ACCES dirWcc REMOVE3Response Nfs3Status NFS3_OK dirWcc
RMDIR3Response Nfs3Status NFS3ERR_INVAL FileHandle dirHandle request getHandle String fileName request getName namenodeId dirHandle getNamenodeId LOG LOG debug dirHandle dumpFileHandle fileName remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response String dirFileIdPath Nfs3Utils getFileIdPath dirHandle Nfs3FileAttributes preOpDirAttr Nfs3FileAttributes postOpDirAttr preOpDirAttr Nfs3Utils getFileAttr dfsClient dirFileIdPath iug
RMDIR3Response Nfs3Status NFS3ERR_ACCES errWcc String fileIdPath dirFileIdPath fileName HdfsFileStatus fstat Nfs3Utils getFileStatus dfsClient fileIdPath fstat RMDIR3Response Nfs3Status NFS3ERR_NOENT errWcc fstat RMDIR3Response Nfs3Status NFS3ERR_NOTDIR errWcc fstat RMDIR3Response Nfs3Status NFS3ERR_NOTEMPTY errWcc result dfsClient delete fileIdPath WccData dirWcc Nfs3Utils createWccData Nfs3Utils getWccAttr preOpDirAttr dfsClient dirFileIdPath iug result RMDIR3Response Nfs3Status NFS3ERR_ACCES dirWcc RMDIR3Response Nfs3Status NFS3_OK dirWcc
RENAME3Response xdr RENAME3Response response RENAME3Response Nfs3Status NFS3_OK RENAME3Request request request RENAME3Request deserialize xdr LOG error RENAME3Response Nfs3Status NFS3ERR_INVAL FileHandle fromHandle request getFromDirHandle fromNamenodeId fromHandle getNamenodeId String fromName request getFromName FileHandle toHandle request getToDirHandle toNamenodeId toHandle getNamenodeId String toName request getToName LOG
LOG debug fromHandle dumpFileHandle fromName toHandle dumpFileHandle toName remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser fromNamenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response fromNamenodeId response setStatus Nfs3Status NFS3ERR_INVAL response String fromDirFileIdPath Nfs3Utils getFileIdPath fromHandle String toDirFileIdPath Nfs3Utils getFileIdPath toHandle Nfs3FileAttributes fromPreOpAttr Nfs3FileAttributes toPreOpAttr WccData fromDirWcc WccData toDirWcc
response setStatus Nfs3Status NFS3ERR_SERVERFAULT response response setStatus Nfs3Status NFS3ERR_INVAL response String fromDirFileIdPath Nfs3Utils getFileIdPath fromHandle String toDirFileIdPath Nfs3Utils getFileIdPath toHandle Nfs3FileAttributes fromPreOpAttr Nfs3FileAttributes toPreOpAttr WccData fromDirWcc WccData toDirWcc fromPreOpAttr Nfs3Utils getFileAttr dfsClient fromDirFileIdPath iug fromPreOpAttr LOG info fromHandle getFileId
toPreOpAttr Nfs3Utils getFileAttr dfsClient toDirFileIdPath iug toPreOpAttr LOG info toHandle getFileId RENAME3Response Nfs3Status NFS3ERR_STALE WccData fromWcc WccData Nfs3Utils getWccAttr fromPreOpAttr fromPreOpAttr WccData toWcc WccData Nfs3Utils getWccAttr toPreOpAttr toPreOpAttr RENAME3Response Nfs3Status NFS3ERR_ACCES fromWcc toWcc String src fromDirFileIdPath fromName String dst toDirFileIdPath toName dfsClient rename src dst Options Rename NONE fromDirWcc Nfs3Utils createWccData Nfs3Utils getWccAttr fromPreOpAttr dfsClient fromDirFileIdPath iug toDirWcc Nfs3Utils createWccData Nfs3Utils getWccAttr toPreOpAttr dfsClient toDirFileIdPath iug RENAME3Response Nfs3Status NFS3_OK fromDirWcc toDirWcc
response setStatus Nfs3Status NFS3ERR_ACCES response SYMLINK3Request request request SYMLINK3Request deserialize xdr LOG error response setStatus Nfs3Status NFS3ERR_INVAL response FileHandle dirHandle request getHandle String name request getName String symData request getSymData String linkDirIdPath Nfs3Utils getFileIdPath dirHandle namenodeId dirHandle getNamenodeId String linkIdPath linkDirIdPath name
READDIR3Response xdr READDIR3Response response READDIR3Response Nfs3Status NFS3_OK response setStatus Nfs3Status NFS3ERR_ACCES response READDIR3Request request request READDIR3Request deserialize xdr LOG error READDIR3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId cookie request getCookie cookie
response READDIR3Request request request READDIR3Request deserialize xdr LOG error READDIR3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId cookie request getCookie cookie LOG error cookie READDIR3Response Nfs3Status NFS3ERR_INVAL count request getCount count
request READDIR3Request deserialize xdr LOG error READDIR3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId cookie request getCookie cookie LOG error cookie READDIR3Response Nfs3Status NFS3ERR_INVAL count request getCount count LOG info count READDIR3Response Nfs3Status NFS3_OK
count request getCount count LOG info count READDIR3Response Nfs3Status NFS3_OK LOG LOG debug handle dumpFileHandle cookie count remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response HdfsFileStatus dirStatus DirectoryListing dlisting Nfs3FileAttributes postOpAttr dotdotFileId
LOG info count READDIR3Response Nfs3Status NFS3_OK LOG LOG debug handle dumpFileHandle cookie count remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response HdfsFileStatus dirStatus DirectoryListing dlisting Nfs3FileAttributes postOpAttr dotdotFileId String dirFileIdPath Nfs3Utils getFileIdPath handle dirStatus dfsClient getFileInfo dirFileIdPath
dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response HdfsFileStatus dirStatus DirectoryListing dlisting Nfs3FileAttributes postOpAttr dotdotFileId String dirFileIdPath Nfs3Utils getFileIdPath handle dirStatus dfsClient getFileInfo dirFileIdPath dirStatus LOG info handle getFileId READDIR3Response Nfs3Status NFS3ERR_STALE dirStatus LOG error handle getFileId
READDIRPLUS3Response Nfs3Status NFS3ERR_ACCES READDIRPLUS3Request request request READDIRPLUS3Request deserialize xdr LOG error READDIRPLUS3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId cookie request getCookie cookie LOG error cookie READDIRPLUS3Response Nfs3Status NFS3ERR_INVAL dirCount request getDirCount dirCount
request READDIRPLUS3Request deserialize xdr LOG error READDIRPLUS3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId cookie request getCookie cookie LOG error cookie READDIRPLUS3Response Nfs3Status NFS3ERR_INVAL dirCount request getDirCount dirCount LOG info dirCount READDIRPLUS3Response Nfs3Status NFS3ERR_INVAL maxCount request getMaxCount
LOG error READDIRPLUS3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId cookie request getCookie cookie LOG error cookie READDIRPLUS3Response Nfs3Status NFS3ERR_INVAL dirCount request getDirCount dirCount LOG info dirCount READDIRPLUS3Response Nfs3Status NFS3ERR_INVAL maxCount request getMaxCount maxCount LOG info maxCount
READDIRPLUS3Response Nfs3Status NFS3ERR_INVAL maxCount request getMaxCount maxCount LOG info maxCount READDIRPLUS3Response Nfs3Status NFS3ERR_INVAL LOG LOG debug handle dumpFileHandle cookie dirCount maxCount remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient READDIRPLUS3Response Nfs3Status NFS3ERR_SERVERFAULT HdfsFileStatus dirStatus DirectoryListing dlisting Nfs3FileAttributes postOpDirAttr dotdotFileId HdfsFileStatus dotdotStatus
maxCount LOG info maxCount READDIRPLUS3Response Nfs3Status NFS3ERR_INVAL LOG LOG debug handle dumpFileHandle cookie dirCount maxCount remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient READDIRPLUS3Response Nfs3Status NFS3ERR_SERVERFAULT HdfsFileStatus dirStatus DirectoryListing dlisting Nfs3FileAttributes postOpDirAttr dotdotFileId HdfsFileStatus dotdotStatus String dirFileIdPath Nfs3Utils getFileIdPath handle
DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient READDIRPLUS3Response Nfs3Status NFS3ERR_SERVERFAULT HdfsFileStatus dirStatus DirectoryListing dlisting Nfs3FileAttributes postOpDirAttr dotdotFileId HdfsFileStatus dotdotStatus String dirFileIdPath Nfs3Utils getFileIdPath handle dirStatus dfsClient getFileInfo dirFileIdPath dirStatus LOG info handle getFileId READDIRPLUS3Response Nfs3Status NFS3ERR_STALE dirStatus
LOG error handle getFileId READDIRPLUS3Response Nfs3Status NFS3ERR_NOTDIR cookieVerf request getCookieVerf cookieVerf cookieVerf dirStatus getModificationTime LOG warn LOG error cookieVerf dirStatus getModificationTime READDIRPLUS3Response Nfs3Status NFS3ERR_BAD_COOKIE Nfs3Utils getFileAttr dfsClient dirFileIdPath iug String dotdotFileIdPath dirFileIdPath dotdotStatus dfsClient getFileInfo dotdotFileIdPath dotdotStatus IOException dotdotFileIdPath dotdotFileId dotdotStatus getFileId
startAfter cookie startAfter HdfsFileStatus EMPTY_NAME String inodeIdPath Nfs3Utils getFileIdPath cookie startAfter inodeIdPath getBytes Charset forName dlisting listPaths dfsClient dirFileIdPath startAfter postOpDirAttr Nfs3Utils getFileAttr dfsClient dirFileIdPath iug postOpDirAttr LOG info handle getFileId READDIRPLUS3Response Nfs3Status NFS3ERR_STALE e LOG warn e status mapErrorStatus e READDIRPLUS3Response status
READDIRPLUS3Response Nfs3Status NFS3ERR_STALE e LOG warn e status mapErrorStatus e READDIRPLUS3Response status HdfsFileStatus fstatus dlisting getPartialListing n Math min fstatus length dirCount eof n fstatus length dlisting hasMore READDIRPLUS3Response EntryPlus3 entries entries READDIRPLUS3Response EntryPlus3 n entries READDIRPLUS3Response EntryPlus3 postOpDirAttr getFileId postOpDirAttr FileHandle postOpDirAttr getFileId namenodeId entries READDIRPLUS3Response EntryPlus3 dotdotFileId dotdotFileId Nfs3Utils getNfs3FileAttrFromFileStatus dotdotStatus iug FileHandle dotdotFileId namenodeId i i n i fileId fstatus i getFileId
LOG error FSSTAT3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response FsStatus fsStatus dfsClient getDiskStatus totalBytes fsStatus getCapacity freeBytes fsStatus getRemaining
LOG error FSINFO3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle namenodeId handle getNamenodeId LOG LOG debug remoteAddress handle dumpFileHandle remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response rtmax config getInt NfsConfigKeys DFS_NFS_MAX_READ_TRANSFER_SIZE_KEY NfsConfigKeys DFS_NFS_MAX_READ_TRANSFER_SIZE_DEFAULT wtmax config getInt NfsConfigKeys DFS_NFS_MAX_WRITE_TRANSFER_SIZE_KEY NfsConfigKeys DFS_NFS_MAX_WRITE_TRANSFER_SIZE_DEFAULT dtperf config getInt NfsConfigKeys DFS_NFS_MAX_READDIR_TRANSFER_SIZE_KEY NfsConfigKeys DFS_NFS_MAX_READDIR_TRANSFER_SIZE_DEFAULT
PATHCONF3Response xdr PATHCONF3Response response PATHCONF3Response Nfs3Status NFS3_OK response setStatus Nfs3Status NFS3ERR_ACCES response PATHCONF3Request request request PATHCONF3Request deserialize xdr LOG error PATHCONF3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle Nfs3FileAttributes attrs namenodeId handle getNamenodeId LOG
request PATHCONF3Request deserialize xdr LOG error PATHCONF3Response Nfs3Status NFS3ERR_INVAL FileHandle handle request getHandle Nfs3FileAttributes attrs namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response attrs Nfs3Utils getFileAttr dfsClient Nfs3Utils getFileIdPath handle iug
LOG error response setStatus Nfs3Status NFS3ERR_INVAL response FileHandle handle request getHandle namenodeId handle getNamenodeId LOG LOG debug handle dumpFileHandle request getOffset request getCount remoteAddress DFSClient dfsClient clientCache getDfsClient securityHandler getUser namenodeId dfsClient response setStatus Nfs3Status NFS3ERR_SERVERFAULT response String fileIdPath Nfs3Utils getFileIdPath handle Nfs3FileAttributes preOpAttr preOpAttr Nfs3Utils getFileAttr dfsClient fileIdPath iug
String fileIdPath Nfs3Utils getFileIdPath handle Nfs3FileAttributes preOpAttr preOpAttr Nfs3Utils getFileAttr dfsClient fileIdPath iug preOpAttr LOG info handle getFileId COMMIT3Response Nfs3Status NFS3ERR_STALE COMMIT3Response Nfs3Status NFS3ERR_ACCES WccData Nfs3Utils getWccAttr preOpAttr preOpAttr Nfs3Constant WRITE_COMMIT_VERF commitOffset request getCount request getOffset request getCount writeManager handleCommit dfsClient handle commitOffset channel xid preOpAttr namenodeId e LOG warn e Nfs3FileAttributes postOpAttr
info RpcCall rpcCall RpcCall info header NFSPROC3 nfsproc3 NFSPROC3 fromValue rpcCall getProcedure xid rpcCall getXid data info data readableBytes info data readBytes data XDR xdr XDR data XDR out XDR InetAddress client InetSocketAddress info remoteAddress getAddress Credentials credentials rpcCall getCredential nfsproc3 NFSPROC3 credentials credentials
Credentials credentials rpcCall getCredential credentials getFlavor credentials getFlavor LOG info credentials getFlavor XDR reply XDR RpcDeniedReply rdr RpcDeniedReply xid RpcReply ReplyState MSG_ACCEPTED RpcDeniedReply RejectState AUTH_ERROR VerifierNone rdr write reply ChannelBuffer buf ChannelBuffers wrappedBuffer reply asReadOnlyWrap buffer RpcResponse rsp RpcResponse buf info remoteAddress RpcUtil sendRpcResponse ctx rsp rpcCall RpcCallCache CacheEntry entry rpcCallCache checkOrAddToCache client xid entry entry
XDR reply XDR RpcDeniedReply rdr RpcDeniedReply xid RpcReply ReplyState MSG_ACCEPTED RpcDeniedReply RejectState AUTH_ERROR VerifierNone rdr write reply ChannelBuffer buf ChannelBuffers wrappedBuffer reply asReadOnlyWrap buffer RpcResponse rsp RpcResponse buf info remoteAddress RpcUtil sendRpcResponse ctx rsp RpcCallCache CacheEntry entry rpcCallCache checkOrAddToCache client xid entry entry LOG info xid RpcUtil sendRpcResponse ctx entry getResponse
startTime System nanoTime NFS3Response response response nullProcedure response getattr xdr info metrics addGetattr Nfs3Utils getElapsedTime startTime response setattr xdr info metrics addSetattr Nfs3Utils getElapsedTime startTime response lookup xdr info metrics addLookup Nfs3Utils getElapsedTime startTime response access xdr info
NFS3Response response response nullProcedure response getattr xdr info metrics addGetattr Nfs3Utils getElapsedTime startTime response setattr xdr info metrics addSetattr Nfs3Utils getElapsedTime startTime response lookup xdr info metrics addLookup Nfs3Utils getElapsedTime startTime response access xdr info metrics addAccess Nfs3Utils getElapsedTime startTime
response getattr xdr info metrics addGetattr Nfs3Utils getElapsedTime startTime response setattr xdr info metrics addSetattr Nfs3Utils getElapsedTime startTime response lookup xdr info metrics addLookup Nfs3Utils getElapsedTime startTime response access xdr info metrics addAccess Nfs3Utils getElapsedTime startTime response readlink xdr info metrics addReadlink Nfs3Utils getElapsedTime startTime
delta Preconditions checkState delta count
OpenFileCtx openFileCtx fileContextCache get fileHandle openFileCtx LOG info fileHandle dumpFileHandle String fileIdPath Nfs3Utils getFileIdPath fileHandle getFileId HdfsDataOutputStream fos Nfs3FileAttributes latestAttr bufferSize config getInt CommonConfigurationKeysPublic IO_FILE_BUFFER_SIZE_KEY CommonConfigurationKeysPublic IO_FILE_BUFFER_SIZE_DEFAULT fos dfsClient append fileIdPath bufferSize EnumSet of CreateFlag APPEND latestAttr Nfs3Utils getFileAttr dfsClient fileIdPath iug e IOException io e unwrapRemoteException io LOG warn fileIdPath request
LOG warn fileIdPath request e e LOG error fileIdPath e fos fos close WccData fileWcc WccData Nfs3Utils getWccAttr preOpAttr preOpAttr WRITE3Response response WRITE3Response Nfs3Status NFS3ERR_IO fileWcc count request getStableHow Nfs3Constant WRITE_COMMIT_VERF Nfs3Utils writeChannel channel response serialize XDR xid VerifierNone xid String writeDumpDir config get NfsConfigKeys DFS_NFS_FILE_DUMP_DIR_KEY NfsConfigKeys DFS_NFS_FILE_DUMP_DIR_DEFAULT openFileCtx OpenFileCtx fos latestAttr writeDumpDir fileHandle getFileId dfsClient iug aixCompatMode config fileHandle openFileCtx LOG info
LOG error fileIdPath e fos fos close WccData fileWcc WccData Nfs3Utils getWccAttr preOpAttr preOpAttr WRITE3Response response WRITE3Response Nfs3Status NFS3ERR_IO fileWcc count request getStableHow Nfs3Constant WRITE_COMMIT_VERF Nfs3Utils writeChannel channel response serialize XDR xid VerifierNone xid String writeDumpDir config get NfsConfigKeys DFS_NFS_FILE_DUMP_DIR_KEY NfsConfigKeys DFS_NFS_FILE_DUMP_DIR_DEFAULT openFileCtx OpenFileCtx fos latestAttr writeDumpDir fileHandle getFileId dfsClient iug aixCompatMode config fileHandle openFileCtx LOG info fos close e LOG error handle dumpFileHandle e
fileHandle status OpenFileCtx openFileCtx fileContextCache get fileHandle openFileCtx
fileHandle startTime System nanoTime status OpenFileCtx openFileCtx fileContextCache get fileHandle openFileCtx
ret ret name RuntimeException ret name Nfs3FileAttributes postOpAttr postOpAttr getFileAttr dfsClient FileHandle preOpAttr getFileId namenodeId iug
configuration rpcServer stateStore conf configuration server rpcServer store stateStore metrics FederationRPCMetrics create conf server ThreadFactory threadFactory ThreadFactoryBuilder setNameFormat build executor Executors newFixedThreadPool threadFactory StandardMBean bean StandardMBean metrics FederationRPCMBean registeredBean MBeans register bean
innerinfo put node getAdminState toString innerinfo put node getNonDfsUsed innerinfo put node getCapacity innerinfo put innerinfo put node getSoftwareVersion node getSoftwareVersion innerinfo put node getDfsUsed innerinfo put node getRemaining innerinfo put innerinfo put node getBlockPoolUsed innerinfo put node getBlockPoolUsedPercent innerinfo put info put node getHostName node getXferPort Collections unmodifiableMap innerinfo LOG error type
innerinfo put node getCapacity innerinfo put innerinfo put node getSoftwareVersion node getSoftwareVersion innerinfo put node getDfsUsed innerinfo put node getRemaining innerinfo put innerinfo put node getBlockPoolUsed innerinfo put node getBlockPoolUsedPercent innerinfo put info put node getHostName node getXferPort Collections unmodifiableMap innerinfo LOG error type LOG error type
List MembershipState namenodes getActiveNamenodeRegistrations List MembershipState namenodesOrder ArrayList namenodes Collections sort namenodesOrder MembershipState NAME_COMPARATOR MembershipState namenode namenodesOrder Map String Object innerInfo HashMap Map String Object map getJson namenode innerInfo putAll map dateModified namenode getDateModified lastHeartbeat getSecondsSince dateModified innerInfo put lastHeartbeat MembershipStats stats namenode getStats used stats getTotalSpace stats getAvailableSpace innerInfo put used info put namenode getNamenodeKey Collections unmodifiableMap innerInfo
totalDfsUsed usages live length i dn live usages i dn getDfsUsedPercent totalDfsUsed dn getDfsUsedPercent totalDfsUsed live length Arrays sort usages median usages usages length max usages usages length min usages i i usages length i dev usages i totalDfsUsed usages i totalDfsUsed dev Math sqrt dev usages length
MembershipState partial MembershipState newInstance String rpcAddress address getHostName address getPort partial setRpcAddress rpcAddress partial setNameserviceId nsId GetNamenodeRegistrationsRequest request GetNamenodeRegistrationsRequest newInstance partial MembershipStore membership getMembershipStore GetNamenodeRegistrationsResponse response membership getNamenodeRegistrations request List MembershipState records response getNamenodeMemberships records records MembershipState record records get UpdateNamenodeRegistrationRequest updateRequest UpdateNamenodeRegistrationRequest newInstance record getNameserviceId record getNamenodeId ACTIVE membership updateNamenodeRegistration updateRequest cacheNS remove nsId cacheBP clear
List FederationNamenodeContext bpId List FederationNamenodeContext ret cacheBP get bpId ret MembershipState partial MembershipState newInstance partial setBlockPoolId bpId GetNamenodeRegistrationsRequest request GetNamenodeRegistrationsRequest newInstance partial List MembershipState result getRecentRegistrationForQuery request result result
List MembershipState request MembershipStore membershipStore getMembershipStore GetNamenodeRegistrationsResponse response membershipStore getNamenodeRegistrations request List MembershipState memberships response getNamenodeMemberships Iterator MembershipState iterator memberships iterator iterator MembershipState membership iterator next membership iterator remove membership iterator remove List MembershipState priorityList ArrayList priorityList addAll memberships Collections sort priorityList NamenodePriorityComparator
ConcurrentMap String PathLocation map locationCache asMap Set Entry String PathLocation entries map entrySet Iterator Entry String PathLocation it entries iterator it Entry String PathLocation entry it next String key entry getKey PathLocation loc entry getValue String src loc getSourcePath src key LOG debug src it remove String dest loc getDefaultLocation getDest dest
MountTable writeLock lock Map String MountTable newEntries ConcurrentHashMap MountTable entry String srcPath entry getSourcePath newEntries put srcPath entry Set String oldEntries TreeSet Collections reverseOrder MountTable entry String srcPath entry getSourcePath oldEntries add srcPath String srcPath oldEntries newEntries srcPath tree remove srcPath invalidateLocationCache srcPath
newEntries put srcPath entry Set String oldEntries TreeSet Collections reverseOrder entry String srcPath entry getSourcePath oldEntries add srcPath String srcPath oldEntries newEntries srcPath tree remove srcPath invalidateLocationCache srcPath LOG info srcPath entry String srcPath entry getSourcePath oldEntries srcPath tree put srcPath entry invalidateLocationCache srcPath
String srcPath entry getSourcePath oldEntries add srcPath String srcPath oldEntries srcPath tree remove srcPath invalidateLocationCache srcPath LOG info srcPath MountTable entry String srcPath entry getSourcePath oldEntries srcPath tree put srcPath entry invalidateLocationCache srcPath LOG info srcPath MountTable existingEntry tree get srcPath
String srcPath srcPath tree remove srcPath invalidateLocationCache srcPath LOG info srcPath MountTable entry String srcPath entry getSourcePath srcPath tree put srcPath entry invalidateLocationCache srcPath LOG info srcPath MountTable existingEntry tree get srcPath existingEntry existingEntry entry LOG info existingEntry entry
String entry String srcPath entry getSourcePath srcPath
PathLocation getDestinationForPath path PathLocation mountTableResult getDestinationForPath path mountTableResult
PathLocation getDestinationForPath String path PathLocation mountTableResult getDestinationForPath path mountTableResult LOG error getClass getSimpleName path mountTableResult DestinationOrder order mountTableResult getDestinationOrder OrderedResolver orderedResolver orderedResolvers get order orderedResolver LOG error order String firstNamespace orderedResolver getFirstNamespace path mountTableResult firstNamespace mountTableResult PathLocation mountTableResult firstNamespace LOG debug order mountTableResult
String String path loc String srcPath loc getSourcePath String trimmedPath trimPathToChild path srcPath
String String path loc String finalPath extractTempFileName path Set String namespaces loc getNamespaces ConsistentHashRing locator getHashResolver namespaces String hashedSubcluster locator getLocation finalPath hashedSubcluster String srcPath loc getSourcePath
String String String localSubcluster String clientAddr getClientAddr Map String String subclusterInfo getSubclusterMapping subclusterInfo localSubcluster subclusterInfo get clientAddr localSubcluster
String DatanodeStorageReport String DatanodeStorageReport String DatanodeStorageReport rpcServer getDatanodeStorageReportMap DatanodeReportType ALL e LOG error e String DatanodeStorageReport entry String nsId entry getKey DatanodeStorageReport dns entry getValue DatanodeStorageReport dn dns DatanodeInfo dnInfo dn getDatanodeInfo String ipAddr dnInfo getIpAddr ret put ipAddr nsId
Map String String ret HashMap GetNamenodeRegistrationsRequest request GetNamenodeRegistrationsRequest newInstance GetNamenodeRegistrationsResponse response membershipStore getNamenodeRegistrations request List MembershipState nns response getNamenodeMemberships MembershipState nn nns String nsId nn getNameserviceId String rpcAddress nn getRpcAddress String hostname HostAndPort fromString rpcAddress getHost ret put hostname nsId hostname ret put localIp nsId InetAddress addr InetAddress getByName hostname String ipAddr addr getHostAddress
String String loc Set String namespaces loc loc getNamespaces namespaces
readLock unlock pool writeLock lock pool pools get connectionId pool pool ConnectionPool conf nnAddress ugi minSize maxSize minActiveRatio protocol pools put connectionId pool writeLock unlock ConnectionContext conn pool getConnection conn conn pool LOG error creatorQueueMaxSize
timeSinceLastActive TimeUnit MILLISECONDS toSeconds Time now getLastActiveTime
String proto proto String msg proto proto getName
URL jmxURL URL scheme host port beanQuery LOG debug jmxURL URLConnection conn connectionFactory openConnection jmxURL UserGroupInformation isSecurityEnabled conn setConnectTimeout conn setReadTimeout InputStream in conn getInputStream InputStreamReader isr InputStreamReader in reader BufferedReader isr StringBuilder sb StringBuilder String line line reader sb append line String jmxOutput sb toString JSONObject json JSONObject jmxOutput ret json getJSONArray
URLConnection conn connectionFactory openConnection jmxURL UserGroupInformation isSecurityEnabled conn setConnectTimeout conn setReadTimeout InputStream in conn getInputStream InputStreamReader isr InputStreamReader in reader BufferedReader isr StringBuilder sb StringBuilder String line line reader sb append line String jmxOutput sb toString JSONObject json JSONObject jmxOutput ret json getJSONArray e LOG error beanQuery webAddress e
conn setReadTimeout InputStream in conn getInputStream InputStreamReader isr InputStreamReader in reader BufferedReader isr StringBuilder sb StringBuilder String line line reader sb append line String jmxOutput sb toString JSONObject json JSONObject jmxOutput ret json getJSONArray e LOG error beanQuery webAddress e e LOG error beanQuery webAddress e getMessage
line reader sb append line String jmxOutput sb toString JSONObject json JSONObject jmxOutput ret json getJSONArray e LOG error beanQuery webAddress e e LOG error beanQuery webAddress e getMessage e LOG error beanQuery webAddress e reader reader close
nnDesc namenodeId localTarget rpcAddress getRpcAddress conf nameserviceId namenodeId LOG info nnDesc rpcAddress serviceAddress DFSUtil getNamenodeServiceAddr conf nameserviceId namenodeId serviceAddress LOG error nnDesc rpcAddress serviceAddress rpcAddress LOG info nnDesc serviceAddress lifelineAddress DFSUtil getNamenodeLifelineAddr conf nameserviceId namenodeId lifelineAddress lifelineAddress serviceAddress LOG info nnDesc lifelineAddress webAddress DFSUtil getNamenodeWebAddr conf nameserviceId namenodeId
NamenodeStatusReport report getNamenodeStatusReport report LOG error getNamenodeDesc report LOG debug report getState getNamenodeDesc LOG debug getNamenodeDesc report LOG warn report LOG info
NamenodeStatusReport NamenodeStatusReport report NamenodeStatusReport nameserviceId namenodeId rpcAddress serviceAddress lifelineAddress scheme webAddress
LOG debug serviceAddress URI serviceURI URI serviceAddress NamenodeProtocol nn NameNodeProxies createProxy conf serviceURI NamenodeProtocol getProxy nn NamespaceInfo info nn versionRequest info report setNamespaceInfo info report report ClientProtocol client NameNodeProxies createProxy conf serviceURI ClientProtocol getProxy client isSafeMode client setSafeMode SafeModeAction SAFEMODE_GET report setSafeMode isSafeMode
ClientProtocol client NameNodeProxies createProxy conf serviceURI ClientProtocol getProxy client isSafeMode client setSafeMode SafeModeAction SAFEMODE_GET report setSafeMode isSafeMode e LOG error getNamenodeDesc e updateJMXParameters webAddress report localTarget localTargetHAProtocol localTargetHAProtocol localTarget getProxy conf HAServiceStatus status localTargetHAProtocol getServiceStatus report setHAServiceState status getState e e
report setSafeMode isSafeMode e LOG error getNamenodeDesc e updateJMXParameters webAddress report localTarget localTargetHAProtocol localTargetHAProtocol localTarget getProxy conf HAServiceStatus status localTargetHAProtocol getServiceStatus report setHAServiceState status getState e e LOG error getNamenodeDesc localTarget
e LOG error getNamenodeDesc e updateJMXParameters webAddress report localTarget localTargetHAProtocol localTargetHAProtocol localTarget getProxy conf HAServiceStatus status localTargetHAProtocol getServiceStatus report setHAServiceState status getState e e getMessage LOG error getNamenodeDesc localTarget LOG error getNamenodeDesc e getMessage e
RemoteLocation loc entry getKey QuotaUsage usage entry getValue nsCount usage getFileAndDirectoryCount ssCount usage getSpaceConsumed eachByStorageType t typeCount t ordinal usage getTypeConsumed t usage usage hasQuotaUnset nsQuota usage getQuota ssQuota usage getSpaceQuota eachByStorageType t typeQuota t ordinal usage getTypeQuota t nsCount usage getFileAndDirectoryCount ssCount usage getSpaceConsumed eachByStorageType t typeCount t ordinal usage getTypeConsumed t
NamenodeHeartbeatService localHeartbeatService createLocalNamenodeHeartbeatService localHeartbeatService String nnDesc localHeartbeatService getNamenodeDesc ret put nnDesc localHeartbeatService Collection String namenodes conf getTrimmedStringCollection RBFConfigKeys DFS_ROUTER_MONITOR_NAMENODE String namenode namenodes String namenodeSplit namenode split String nsId String nnId namenodeSplit nsId namenodeSplit nnId namenodeSplit namenodeSplit nsId namenode
String nsId DFSUtil getNamenodeNameServiceId conf String nnId HAUtil conf nsId nnId HAUtil getNameNodeId conf nsId nnId
disableNameservice request checkSuperuserPrivilege String nsId request getNameServiceId success nsId success getDisabledNameserviceStore disableNameservice nsId success
enableNameservice request checkSuperuserPrivilege String nsId request getNameServiceId DisabledNameserviceStore store getDisabledNameserviceStore Set String disabled store getDisabledNameservices success disabled nsId success store enableNameservice nsId success
String src String String String rpcServer checkOperation NameNode OperationCategory WRITE rpcServer src index src lastIndexOf Path SEPARATOR String parent src substring index
String src FsPermission masked String createParent String String rpcServer checkOperation NameNode OperationCategory WRITE createParent rpcServer src index src lastIndexOf Path SEPARATOR String parent src substring index LOG debug src parent FsPermission parentPermissions getParentPermission masked success mkdirs parent parentPermissions createParent success
DirectoryListing String src startAfter needLocation IOException rpcServer checkOperation NameNode OperationCategory READ List RemoteResult RemoteLocation DirectoryListing listings getListingInt src startAfter needLocation TreeMap String HdfsFileStatus nnListing TreeMap totalRemainingEntries remainingEntries namenodeListingExists String lastName listings RemoteResult RemoteLocation DirectoryListing result listings result IOException ioe result getException ioe RemoteLocation location result getLocation
ioe FileNotFoundException notFoundException FileNotFoundException ioe ioe result getResult summaries add result getResult List String children subclusterResolver getMountPoints path children String child children Path childPath Path path child ContentSummary mountSummary getContentSummary childPath toString mountSummary summaries add mountSummary
MountTableResolver mountTable MountTableResolver subclusterResolver MountTable entry mountTable getMountPoint mName entry permission entry getMode owner entry getOwnerName group entry getGroupName RemoteMethod method RemoteMethod Class String RemoteParam HdfsFileStatus fInfo getFileInfoAll entry getDestinations method mountStatusTimeOut fInfo permission fInfo getPermission owner fInfo getOwner group fInfo getGroup childrenNum fInfo getChildrenNum flags DFSUtil getFlags fInfo isEncrypted fInfo isErasureCoded fInfo isSnapshotEnabled fInfo hasAcl
permission fInfo getPermission owner fInfo getOwner group fInfo getGroup childrenNum fInfo getChildrenNum flags DFSUtil getFlags fInfo isEncrypted fInfo isErasureCoded fInfo isSnapshotEnabled fInfo hasAcl e LOG error e getMessage UserGroupInformation ugi RouterRpcServer getRemoteUser owner ugi getUserName group ugi getPrimaryGroupName e String msg e getMessage UserGroupInformation
group fInfo getGroup childrenNum fInfo getChildrenNum flags DFSUtil getFlags fInfo isEncrypted fInfo isErasureCoded fInfo isSnapshotEnabled fInfo hasAcl e LOG error e getMessage UserGroupInformation ugi RouterRpcServer getRemoteUser owner ugi getUserName group ugi getPrimaryGroupName e String msg e getMessage UserGroupInformation LOG error msg
path Path SEPARATOR srcPath Path SEPARATOR child srcPath path Path SEPARATOR child Long modTime MountTable entry mountTable getMountPoint srcPath entry List MountTable entries mountTable getMounts srcPath MountTable eachEntry entries child child eachEntry getDateModified modTime eachEntry getDateModified modTime entry getDateModified
startTime Time monotonicNow String warnMsg LOG warn warnMsg out println warnMsg String msg UserGroupInformation getCurrentUser remoteAddress Date
LOG error RouterStore routerStore router getRouterStateManager RouterState record RouterState newInstance routerId router getStartTime router getRouterState StateStoreVersion stateStoreVersion StateStoreVersion newInstance getStateStoreVersion MembershipStore getStateStoreVersion MountTableStore record setStateStoreVersion stateStoreVersion String hostPort StateStoreUtils getHostPortString router getAdminServerAddress record setAdminAddress hostPort RouterHeartbeatRequest request RouterHeartbeatRequest newInstance record RouterHeartbeatResponse response routerStore routerHeartbeat request response LOG warn routerId
RouterStore routerStore router getRouterStateManager RouterState record RouterState newInstance routerId router getStartTime router getRouterState StateStoreVersion stateStoreVersion StateStoreVersion newInstance getStateStoreVersion MembershipStore getStateStoreVersion MountTableStore record setStateStoreVersion stateStoreVersion String hostPort StateStoreUtils getHostPortString router getAdminServerAddress record setAdminAddress hostPort RouterHeartbeatRequest request RouterHeartbeatRequest newInstance record RouterHeartbeatResponse response routerStore routerHeartbeat request response LOG warn routerId LOG debug routerId
ssQuota oldQuota getSpaceQuota typeQuota StorageType values length Quota eachByStorageType t typeQuota t ordinal oldQuota getTypeQuota t QuotaUsage currentQuotaUsage HdfsFileStatus ret rpcServer getFileInfo src ret ret zeroConsume StorageType values length currentQuotaUsage RouterQuotaUsage Builder fileAndDirectoryCount quota nsQuota spaceConsumed spaceQuota ssQuota typeConsumed zeroConsume typeQuota typeQuota build Quota quotaModule rpcServer getQuotaModule Map RemoteLocation QuotaUsage usageMap quotaModule getEachQuotaUsage src currentQuotaUsage quotaModule aggregateQuota src usageMap remoteQuotaUsage putAll usageMap
location QuotaUsage QuotaUsage gQuota rpcServer getQuotaModule getGlobalQuota location getSrc getQuota gQuota getQuota getSpaceQuota gQuota getSpaceQuota rpcServer getQuotaModule setQuotaInternal location getSrc Arrays asList location gQuota getQuota gQuota getSpaceQuota
ioes put namenode ioe ioe rpcMonitor rpcMonitor proxyOpFailureStandby failover ioe rpcMonitor rpcMonitor proxyOpFailureCommunicate failover ioe RemoteException rpcMonitor rpcMonitor proxyOpComplete RemoteException re RemoteException ioe ioe re unwrapRemoteException ioe getCleanException ioe
ioe rpcMonitor rpcMonitor proxyOpFailureCommunicate failover ioe RemoteException rpcMonitor rpcMonitor proxyOpComplete RemoteException re RemoteException ioe ioe re unwrapRemoteException ioe getCleanException ioe ioe ioe rpcMonitor rpcMonitor proxyOpFailureCommunicate LOG error nsId rpcAddress ioe getMessage
StandbyException se StandbyException ioe getMessage se initCause ioe se ioe rpcMonitor rpcMonitor proxyOpNoNamenodes LOG error nsId rpcAddress ioe getMessage RetriableException ioe rpcMonitor rpcMonitor proxyOpFailureCommunicate rpcMonitor proxyOpComplete ioe
ioe rpcMonitor rpcMonitor proxyOpNoNamenodes LOG error nsId rpcAddress ioe getMessage RetriableException ioe rpcMonitor rpcMonitor proxyOpFailureCommunicate rpcMonitor proxyOpComplete ioe connection connection release rpcMonitor rpcMonitor proxyOpComplete
rpcMonitor rpcMonitor proxyOpNoNamenodes LOG error nsId rpcAddress ioe getMessage RetriableException ioe rpcMonitor rpcMonitor proxyOpFailureCommunicate rpcMonitor proxyOpComplete ioe connection connection release rpcMonitor rpcMonitor proxyOpComplete String msg method getName Arrays deepToString params namenodes router getRouterId
String methodName matcher group String fileName matcher group lineNumber Integer parseInt matcher group StackTraceElement element StackTraceElement declaringClass methodName fileName lineNumber elements add element stackTrace elements toArray StackTraceElement elements size ioe RemoteException RemoteException re RemoteException ioe ret RemoteException re getClassName msg Class IOException ioeClass ioe getClass Constructor IOException constructor ioeClass getDeclaredConstructor String ret constructor newInstance msg
List FederationNamenodeContext namenodes getNamenodesForNameservice ns Class proto remoteMethod getProtocol Object params remoteMethod getParams loc Object result invokeMethod ugi namenodes proto m params result result SuppressWarnings R location R loc SuppressWarnings T ret T result RemoteResult location ret firstResult firstResult result ioe ioe processException ioe loc thrownExceptions add ioe
rpcMonitor rpcMonitor proxyOp List Future Object futures timeOutMs futures executorService invokeAll callables timeOutMs TimeUnit MILLISECONDS futures executorService invokeAll callables List RemoteResult T R results ArrayList i i futures i T location orderedLocations get i Future Object future futures get i R result R future get results add RemoteResult location result
T location orderedLocations get i Future Object future futures get i R result R future get results add RemoteResult location result T loc orderedLocations get i String msg loc method getMethodName LOG error msg IOException ioe SubClusterTimeoutException msg results add RemoteResult location ioe ex Throwable cause ex getCause LOG debug m getName location cause getMessage IOException ioe
R result R future get results add RemoteResult location result T loc orderedLocations get i String msg loc method getMethodName LOG error msg IOException ioe SubClusterTimeoutException msg results add RemoteResult location ioe ex Throwable cause ex getCause LOG debug m getName location cause getMessage IOException ioe cause IOException ioe IOException cause
DatanodeInfo type UserGroupInformation loginUser UserGroupInformation getLoginUser RouterRpcServer setCurrentUser loginUser DatanodeInfo dns clientProto getDatanodeReport type
checkOperation OperationCategory UNCHECKED Map String DatanodeInfo datanodesMap LinkedHashMap RemoteMethod method RemoteMethod Class DatanodeReportType type Set FederationNamespaceInfo nss namenodeResolver getNamespaces Map FederationNamespaceInfo DatanodeInfo results rpcClient invokeConcurrent nss method requireResponse timeOutMs DatanodeInfo FederationNamespaceInfo DatanodeInfo entry results FederationNamespaceInfo ns entry getKey DatanodeInfo result entry getValue DatanodeInfo node result String nodeId node getXferAddr DatanodeInfo dn datanodesMap get nodeId dn node dn node setNetworkLocation NodeBase PATH_SEPARATOR_STR ns getNameserviceId node getNetworkLocation datanodesMap put nodeId node
timeInSafemode now enterSafeModeTime
now Time now delta now startupTime delta
LOG debug String operationName success String tokenId String canceller getRemoteUser getUserName
LOG info checkAgainstZkBeforeDeletion set zkClient forPath ZK_DTSM_TOKENS_ROOT zkClient create creatingParentsIfNeeded withMode CreateMode PERSISTENT forPath ZK_DTSM_TOKENS_ROOT zookeeper zkClient getZookeeperClient getZooKeeper e LOG info e zookeeper IOException LOG info start Time now rebuildTokenCache
e LOG info e IOException LOG info start Time now rebuildTokenCache LOG info Time now start syncInterval conf getInt ZK_DTSM_ROUTER_TOKEN_SYNC_INTERVAL ZK_DTSM_ROUTER_TOKEN_SYNC_INTERVAL_DEFAULT rebuildTokenCache e
List R newRecords query getRecords currentDriverTime query getTimestamp newRecords currentDriverTime LOG error R record newRecords record currentDriverTime String recordName StateStoreUtils getRecordName record getClass record deleteRecords add record LOG info recordName record LOG warn recordName record record currentDriverTime String recordName StateStoreUtils getRecordName record getClass
addService monitorService MembershipState setExpirationMs conf getTimeDuration RBFConfigKeys FEDERATION_STORE_MEMBERSHIP_EXPIRATION_MS RBFConfigKeys FEDERATION_STORE_MEMBERSHIP_EXPIRATION_MS_DEFAULT TimeUnit MILLISECONDS MembershipState setDeletionMs conf getTimeDuration RBFConfigKeys FEDERATION_STORE_MEMBERSHIP_EXPIRATION_DELETION_MS RBFConfigKeys FEDERATION_STORE_MEMBERSHIP_EXPIRATION_DELETION_MS_DEFAULT TimeUnit MILLISECONDS RouterState setExpirationMs conf getTimeDuration RBFConfigKeys FEDERATION_STORE_ROUTER_EXPIRATION_MS RBFConfigKeys FEDERATION_STORE_ROUTER_EXPIRATION_MS_DEFAULT TimeUnit MILLISECONDS RouterState setDeletionMs conf getTimeDuration RBFConfigKeys FEDERATION_STORE_ROUTER_EXPIRATION_DELETION_MS RBFConfigKeys FEDERATION_STORE_ROUTER_EXPIRATION_DELETION_MS_DEFAULT TimeUnit MILLISECONDS cacheUpdater StateStoreCacheUpdateService addService cacheUpdater conf RBFConfigKeys RBFConfigKeys metrics StateStoreMetrics create conf StandardMBean bean StandardMBean metrics StateStoreMBean ObjectName registeredObject MBeans register bean LOG info registeredObject e RuntimeException e
driver String driverName driver getClass getSimpleName driver
success List StateStoreCache cachesToUpdate LinkedList cachesToUpdate addAll cachesToUpdateInternal cachesToUpdate addAll cachesToUpdateExternal StateStoreCache cachedStore cachesToUpdate String cacheName cachedStore getClass getSimpleName result result cachedStore loadCache force e LOG error cacheName e result result success
String className String dataDirPath getRootDir className dataDirPath
String className String dataDirPath getRootDir className dataDirPath LOG info dataDirPath dataDirPath
T T T clazz verifyDriverReady start monotonicNow StateStoreMetrics metrics getMetrics List T ret ArrayList String path getPathForClass clazz List String children getChildren path String child children String pathRecord path child child
List String children getChildren path String child children String pathRecord path child child LOG debug child path child LOG warn child remove pathRecord T record getRecord pathRecord clazz ret add record metrics metrics addFailure monotonicNow start String msg clazz getSimpleName
start monotonicNow StateStoreMetrics metrics getMetrics Map String T toWrite HashMap T record Class BaseRecord recordClass record getClass String path getPathForClass recordClass String primaryKey getPrimaryKey record String recordPath path primaryKey recordPath record setDateModified getTime toWrite put recordPath record
Map String T toWrite HashMap T record Class BaseRecord recordClass record getClass String path getPathForClass recordClass String primaryKey getPrimaryKey record String recordPath path primaryKey recordPath record setDateModified getTime toWrite put recordPath record LOG error recordPath metrics metrics addFailure monotonicNow start
metrics metrics addFailure monotonicNow start LOG debug record toWrite put recordPath record success String T entry toWrite String recordPath entry getKey String recordPathTemp recordPath now TMP_MARK BufferedWriter writer getWriter recordPathTemp T record entry getValue String line serializeString record
toWrite put recordPath record success String T entry toWrite String recordPath entry getKey String recordPathTemp recordPath now TMP_MARK BufferedWriter writer getWriter recordPathTemp T record entry getValue String line serializeString record writer write line e LOG error recordPathTemp e success
toWrite put recordPath record success String T entry toWrite String recordPath entry getKey String recordPathTemp recordPath now TMP_MARK BufferedWriter writer getWriter recordPathTemp T record entry getValue String line serializeString record writer write line e LOG error recordPathTemp e success
start Time monotonicNow StateStoreMetrics metrics getMetrics removed QueryResult T result get clazz List T existingRecords result getRecords List T recordsToRemove filterMultiple query existingRecords success T recordToRemove recordsToRemove String path getPathForClass clazz String primaryKey getPrimaryKey recordToRemove String recordToRemovePath path primaryKey recordToRemovePath removed
removed QueryResult T result get clazz List T existingRecords result getRecords List T recordsToRemove filterMultiple query existingRecords success T recordToRemove recordsToRemove String path getPathForClass clazz String primaryKey getPrimaryKey recordToRemove String recordToRemovePath path primaryKey recordToRemovePath removed LOG error recordToRemovePath success
List T recordsToRemove filterMultiple query existingRecords success T recordToRemove recordsToRemove String path getPathForClass clazz String primaryKey getPrimaryKey recordToRemove String recordToRemovePath path primaryKey recordToRemovePath removed LOG error recordToRemovePath success success LOG error clazz query metrics metrics addFailure monotonicNow start
BufferedReader BufferedReader reader
BufferedWriter BufferedWriter writer
List String children zkManager getChildren znode String child children String path getNodePath znode child Stat stat Stat String data zkManager getStringData path stat corrupted data data corrupted T record createRecord data stat clazz ret add record
String path getNodePath znode child Stat stat Stat String data zkManager getStringData path stat corrupted data data corrupted T record createRecord data stat clazz ret add record e LOG error clazz getSimpleName data e getMessage corrupted corrupted
String data zkManager getStringData path stat corrupted data data corrupted T record createRecord data stat clazz ret add record e LOG error clazz getSimpleName data e getMessage corrupted corrupted LOG error child path zkManager delete path e
T record createRecord data stat clazz ret add record e LOG error clazz getSimpleName data e getMessage corrupted corrupted LOG error child path zkManager delete path e LOG error child e getMessage e getMetrics addFailure monotonicNow start String msg znode e getMessage
query start monotonicNow List T records QueryResult T result get clazz records result getRecords ex LOG error ex getMetrics addFailure monotonicNow start String znode getZNodeForClass clazz List T recordsToRemove filterMultiple query records removed T recordsToRemove
records result getRecords ex LOG error ex getMetrics addFailure monotonicNow start String znode getZNodeForClass clazz List T recordsToRemove filterMultiple query records removed T existingRecord recordsToRemove LOG info existingRecord String primaryKey getPrimaryKey existingRecord String path getNodePath znode primaryKey path removed
ex LOG error ex getMetrics addFailure monotonicNow start String znode getZNodeForClass clazz List T recordsToRemove filterMultiple query records removed T existingRecord recordsToRemove LOG info existingRecord String primaryKey getPrimaryKey existingRecord String path getNodePath znode primaryKey path removed
clazz start monotonicNow status String znode getZNodeForClass clazz
clazz start monotonicNow status String znode getZNodeForClass clazz LOG info znode List String children zkManager getChildren znode String child children String path getNodePath znode child
znode created zkManager create znode created
request MembershipState record request getNamenodeMembership String nnId record getNamenodeKey MembershipState existingEntry cacheReadLock lock existingEntry activeRegistrations get nnId cacheReadLock unlock existingEntry existingEntry record LOG info existingEntry record LOG debug existingEntry record
MembershipState record records FederationNamenodeServiceState state record getState TreeSet MembershipState matchingSet occurenceMap get state matchingSet matchingSet TreeSet occurenceMap put state matchingSet matchingSet add record TreeSet MembershipState largestSet TreeSet TreeSet MembershipState matchingSet occurenceMap largestSet matchingSet largestSet matchingSet largestSet records largestSet first records TreeSet MembershipState sortedList TreeSet records
nn FSNamesystem namesystem nn getNamesystem HAContext haContext namesystem getHAContext HAContext spyHAContext spy haContext
server RouterRpcClient rpcClient server getRPCClient ConnectionManager connectionManager ConnectionManager server getConfig ConnectionManager spyConnectionManager spy connectionManager
router router router shutDown loopCount router router loopCount Thread sleep loopCount
SortedMap String String fs ConcurrentSkipListMap String String DirectoryListing l mockNn getListing anyString any anyBoolean l invocation String src getSrc invocation
fs get src FileNotFoundException src src src Map String String files fs subMap src src Character MAX_VALUE List HdfsFileStatus list ArrayList String file files file src HdfsFileStatus fileStatus getMockHdfsFileStatus file fs get file list add fileStatus HdfsFileStatus array list toArray HdfsFileStatus list size DirectoryListing array invocation String src getSrc invocation
Map String String files fs subMap src src Character MAX_VALUE List HdfsFileStatus list ArrayList String file files file src HdfsFileStatus fileStatus getMockHdfsFileStatus file fs get file list add fileStatus HdfsFileStatus array list toArray HdfsFileStatus list size DirectoryListing array mockNn anyString invocation String src getSrc invocation LOG info nsId src getMockHdfsFileStatus src fs get src HdfsFileStatus c mockNn create anyString any anyString any anyBoolean anyShort anyLong any any any
list add fileStatus HdfsFileStatus array list toArray HdfsFileStatus list size DirectoryListing array mockNn anyString invocation String src getSrc invocation LOG info nsId src getMockHdfsFileStatus src fs get src HdfsFileStatus c mockNn create anyString any anyString any anyBoolean anyShort anyLong any any any c invocation String src getSrc invocation LOG info nsId src createParent invocation getArgument createParent
LOG info nsId src getMockHdfsFileStatus src fs get src HdfsFileStatus c mockNn create anyString any anyString any anyBoolean anyShort anyLong any any any c invocation String src getSrc invocation LOG info nsId src createParent invocation getArgument createParent Path path Path src getParent path LOG info nsId path fs put path toString path path getParent fs put src
HdfsFileStatus c mockNn create anyString any anyString any anyBoolean anyShort anyLong any any any c invocation String src getSrc invocation LOG info nsId src createParent invocation getArgument createParent Path path Path src getParent path LOG info nsId path fs put path toString path path getParent fs put src getMockHdfsFileStatus src
Path path Path src getParent path LOG info nsId path fs put path toString path path getParent fs put src getMockHdfsFileStatus src LocatedBlocks b mockNn getBlockLocations anyString anyLong anyLong b invocation String src getSrc invocation LOG info nsId src fs src LOG error nsId src FileNotFoundException src
getMockHdfsFileStatus src LocatedBlocks b mockNn getBlockLocations anyString anyLong anyLong b invocation String src getSrc invocation LOG info nsId src src LOG error nsId src FileNotFoundException src mock LocatedBlocks f mockNn complete anyString anyString any anyLong f invocation String src getSrc invocation src
src LOG error nsId src FileNotFoundException src mock LocatedBlocks f mockNn complete anyString anyString any anyLong f invocation String src getSrc invocation src LOG error nsId src FileNotFoundException src LocatedBlock a mockNn addBlock anyString anyString any any anyLong any any a invocation
f mockNn complete anyString anyString any anyLong f invocation String src getSrc invocation src LOG error nsId src FileNotFoundException src LocatedBlock a mockNn addBlock anyString anyString any any anyLong any any a invocation String src getSrc invocation src LOG error nsId src FileNotFoundException src
FileNotFoundException src LocatedBlock a mockNn addBlock anyString anyString any any anyLong any any a invocation String src getSrc invocation src LOG error nsId src FileNotFoundException src getMockLocatedBlock nsId m mockNn mkdirs anyString any anyBoolean m invocation String src getSrc invocation LOG info nsId src
fs src LOG error nsId src FileNotFoundException src getMockLocatedBlock nsId m mockNn mkdirs anyString any anyBoolean m invocation String src getSrc invocation LOG info nsId src createParent invocation getArgument createParent Path path Path src getParent path LOG info nsId path fs put path toString
String router MembershipNamenodeResolver resolver MembershipNamenodeResolver router getNamenodeResolver nn String nsId nn getNameserviceId String rpcAddress nn getRPCPort String httpAddress nn getHTTPPort String scheme NamenodeStatusReport report NamenodeStatusReport nsId rpcAddress rpcAddress rpcAddress scheme httpAddress nsId
List MountTable emptyList ArrayList mountTable refreshEntries emptyList i i i Map String String map getMountTableEntry i MountTable record MountTable newInstance i map mountTable addEntry record i
routerClient routerClient close LOG error Map String Integer newResult objectMapper readValue metrics getAsyncCallerPool Map newResult get newResult get total newResult get
order FileSystem router0Fs getFileSystem routers get FileSystem router1Fs getFileSystem routers get FileSystem ns0Fs getFileSystem namenodes get getRPCPort String mountPoint order Path mountPath Path mountPoint
order FileSystem router0Fs getFileSystem routers get FileSystem router1Fs getFileSystem routers get FileSystem ns0Fs getFileSystem namenodes get getRPCPort String mountPoint order Path mountPath Path mountPoint LOG info mountPoint order createMountTableEntry getRandomRouter mountPoint order namenodes keySet refreshRoutersCaches routers
order FileSystem router0Fs getFileSystem routers get FileSystem router1Fs getFileSystem routers get FileSystem ns0Fs getFileSystem namenodes get getRPCPort String mountPoint order Path mountPath Path mountPoint LOG info mountPoint order createMountTableEntry getRandomRouter mountPoint order namenodes keySet refreshRoutersCaches routers LOG info mountPath checkDirectoriesFaultTolerant mountPath order router0Fs router1Fs ns0Fs checkFilesFaultTolerant mountPath order router0Fs router1Fs ns0Fs
mountPoint router1Fs FileStatus dirs0 listStatus router1Fs mountPoint
Path mountPoint router1Fs FileStatus dirs0 listStatus router1Fs mountPoint Path dir0 Path getPathWithoutSchemeAndAuthority dirs0 getPath
TaskResults TaskResults results TaskResults task succeeded task get succeeded
DestinationOrder order DestinationOrder HASH_ALL String mountPoint order Path mountPath Path mountPoint
FSDataInputStream fsdis fs open fileexisting assertNotNull fsdis LambdaTestUtils intercept FileNotFoundException fs open filenotexisting String nsIdWithFile String MockNamenode entry String nsId entry getKey MockNamenode nn entry getValue rpc nn getRPCPort FileSystem nnfs getFileSystem rpc FileStatus fileStatus nnfs getFileStatus fileexisting assertNotNull fileStatus assertNull nsIdWithFile nsIdWithFile nsId FileNotFoundException
LambdaTestUtils intercept FileNotFoundException fs open filenotexisting String nsIdWithFile String MockNamenode entry String nsId entry getKey MockNamenode nn entry getValue rpc nn getRPCPort FileSystem nnfs getFileSystem rpc FileStatus fileStatus nnfs getFileStatus fileexisting assertNotNull fileStatus assertNull nsIdWithFile nsIdWithFile nsId FileNotFoundException LOG debug nsId assertNotNull nsIdWithFile
MountTable addEntry MountTable newInstance Collections singletonMap assertTrue addMountTable addEntry addEntry MountTable newInstance Collections singletonMap assertTrue addMountTable addEntry routerFs createNewFile Path routerFs createNewFile Path routerFs createNewFile Path routerFs createNewFile Path HttpGet httpGet HttpGet webAddress getHostName webAddress getPort httpResponse httpGet assertEquals HttpStatus SC_OK httpResponse getStatusLine getStatusCode String out EntityUtils toString httpResponse getEntity StandardCharsets UTF_8
LOG info out assertTrue out contains assertTrue out contains assertTrue out contains assertTrue out contains nnCount nn nn assertTrue out contains nn nn getWebAddress nnCount assertEquals nnCount httpGet HttpGet webAddress getHostName webAddress getPort httpResponse httpGet assertEquals HttpStatus SC_OK httpResponse getStatusLine getStatusCode String out EntityUtils toString httpResponse getEntity StandardCharsets UTF_8
combinedData routerProtocol getStats individualData getAggregateStats len Math min combinedData length individualData length len combinedData individualData
String mountPoint String snapshotFolder mountPoint
LOG info ErasureCodingPolicyInfo policies checkErasureCodingPolicies ErasureCodingPolicyInfo policies
Map String String codecsNamenode nnProtocol getErasureCodingCodecs assertTrue Maps difference codecsRouter codecsNamenode areEqual String String entry codecsRouter LOG info entry getKey entry getValue LOG info String dirPath String filePath1 dirPath FsPermission permission FsPermission routerProtocol mkdirs dirPath permission createFile routerFS filePath1 assertTrue verifyFileExists routerFS filePath1 DFSClient file1Protocol getFileDFSClient filePath1 LOG info assertNull routerProtocol getErasureCodingPolicy filePath1 assertNull file1Protocol getErasureCodingPolicy filePath1
String filePath1 dirPath FsPermission permission FsPermission routerProtocol mkdirs dirPath permission createFile routerFS filePath1 assertTrue verifyFileExists routerFS filePath1 DFSClient file1Protocol getFileDFSClient filePath1 LOG info assertNull routerProtocol getErasureCodingPolicy filePath1 assertNull file1Protocol getErasureCodingPolicy filePath1 String policyName LOG info policyName dirPath routerProtocol setErasureCodingPolicy dirPath policyName String filePath2 dirPath LOG info filePath2 createFile routerFS filePath2
when ugi1 getRealUser thenReturn suUgi when ugi2 getRealUser thenReturn suUgi when suUgi getShortUserName thenReturn superUser when suUgi getUserName thenReturn superUser when ugi1 getShortUserName thenReturn when ugi2 getShortUserName thenReturn when ugi1 getUserName thenReturn when ugi2 getUserName thenReturn when ugi1 getGroups thenReturn groupNames1 when ugi2 getGroups thenReturn groupNames2 when ugi1 getGroupsSet thenReturn groupNamesSet1 when ugi2 getGroupsSet thenReturn groupNamesSet2 LambdaTestUtils intercept AuthorizationException ProxyUsers authorize ugi1 LOOPBACK_ADDRESS ProxyUsers authorize ugi2 LOOPBACK_ADDRESS
LambdaTestUtils intercept AuthorizationException ProxyUsers authorize ugi1 LOOPBACK_ADDRESS ProxyUsers authorize ugi2 LOOPBACK_ADDRESS LOG info ugi2 getUserName AuthorizationException e fail ugi2 getShortUserName e getLocalizedMessage String rsrc tempResource addNewConfigResource rsrc userKeyGroups userKeyHosts LOOPBACK_ADDRESS conf set DFSConfigKeys FS_DEFAULT_NAME_KEY defaultFs DFSAdmin admin DFSAdmin conf String args String admin run args LambdaTestUtils intercept AuthorizationException ProxyUsers authorize ugi2 LOOPBACK_ADDRESS ProxyUsers authorize ugi1 LOOPBACK_ADDRESS
String Groups groups Groups getUserToGroupsMappingService conf String user LOG info List String g1 groups getGroups user
String Groups groups Groups getUserToGroupsMappingService conf String user LOG info List String g1 groups getGroups user LOG info g1 LOG info List String g2 groups getGroups user
String user LOG info List String g1 groups getGroups user LOG info g1 LOG info List String g2 groups getGroups user LOG info g2 i i g2 i assertEquals g1 get i g2 get i conf set DFSConfigKeys FS_DEFAULT_NAME_KEY defaultFs DFSAdmin admin DFSAdmin conf String args String admin run args LOG info List String g3 groups getGroups user
conf set DFSConfigKeys FS_DEFAULT_NAME_KEY defaultFs DFSAdmin admin DFSAdmin conf String args String admin run args LOG info List String g3 groups getGroups user LOG info g3 i i g3 i assertNotEquals g1 get i g3 get i g1 get i g3 get i LOG info List String g4 g4 groups getGroups user
String args String admin run args LOG info List String g3 groups getGroups user LOG info g3 i i g3 i assertNotEquals g1 get i g3 get i g1 get i g3 get i LOG info List String g4 g4 groups getGroups user LOG debug user
ZKDelegationTokenSecretManagerImpl dtsm1 ZKDelegationTokenSecretManagerImpl conf ZKDelegationTokenSecretManagerImpl dtsm2 ZKDelegationTokenSecretManagerImpl conf ZKDelegationTokenSecretManagerImpl dtsm3 ZKDelegationTokenSecretManagerImpl conf DelegationTokenManager tm1 tm2 tm3 tm1 DelegationTokenManager conf Text tm1 setExternalDelegationTokenSecretManager dtsm1 tm2 DelegationTokenManager conf Text tm2 setExternalDelegationTokenSecretManager dtsm2 tm3 DelegationTokenManager conf Text tm3 setExternalDelegationTokenSecretManager dtsm3 Token DelegationTokenIdentifier token Token DelegationTokenIdentifier tm1 createToken UserGroupInformation getCurrentUser Assert assertNotNull token tm2 verifyToken token Thread sleep renewalTime tm2 renewToken token
String filterInitializerConfKey String initializers conf get filterInitializerConfKey String parts initializers split Set String target LinkedHashSet String String filterInitializer parts filterInitializer filterInitializer trim filterInitializer getName filterInitializer getName filterInitializer target add filterInitializer target add AuthFilterInitializer getName initializers StringUtils join target conf set filterInitializerConfKey initializers LOG info initializers HttpServer2 Builder builder HttpServer2 Builder setName name setConf conf setACL AccessControlList conf get DFS_ADMIN setSecurityEnabled UserGroupInformation isSecurityEnabled setUsernameConfKey spnegoUserNameKey setKeytabConfKey getSpnegoKeytabKey conf spnegoKeytabFileKey UserGroupInformation isSecurityEnabled
filterInitializer getName filterInitializer getName filterInitializer target add filterInitializer target add AuthFilterInitializer getName initializers StringUtils join target conf set filterInitializerConfKey initializers LOG info initializers HttpServer2 Builder builder HttpServer2 Builder setName name setConf conf setACL AccessControlList conf get DFS_ADMIN setSecurityEnabled UserGroupInformation isSecurityEnabled setUsernameConfKey spnegoUserNameKey setKeytabConfKey getSpnegoKeytabKey conf spnegoKeytabFileKey UserGroupInformation isSecurityEnabled LOG info SecurityUtil getServerPrincipal conf get spnegoUserNameKey httpAddr getHostName httpAddr builder setFindPort URI uri URI create NetUtils getHostPortString httpAddr builder addEndpoint uri
LOG info initializers HttpServer2 Builder builder HttpServer2 Builder setName name setConf conf setACL AccessControlList conf get DFS_ADMIN setSecurityEnabled UserGroupInformation isSecurityEnabled setUsernameConfKey spnegoUserNameKey setKeytabConfKey getSpnegoKeytabKey conf spnegoKeytabFileKey UserGroupInformation isSecurityEnabled LOG info SecurityUtil getServerPrincipal conf get spnegoUserNameKey httpAddr getHostName httpAddr builder setFindPort URI uri URI create NetUtils getHostPortString httpAddr builder addEndpoint uri LOG info name uri Configuration sslConf loadSslConfiguration conf loadSslConfToHttpServerBuilder builder sslConf builder setFindPort
InetSocketAddress inAddr fs DistributedFileSystem IllegalArgumentException fs fs exists Path DistributedFileSystem dfs DistributedFileSystem fs Configuration dfsConf dfs getConf URI dfsUri dfs getUri String nsId dfsUri getHost dfsConf nsId List ClientProtocol namenodes getProxiesForAllNameNodesInNameservice dfsConf nsId ClientProtocol proxy namenodes proxy inAddr RPC getServerAddress proxy
searchScope NodeBase ROOT excludedScope scope substring searchScope scope excludedScope Node n chooseRandom searchScope excludedScope excludedNodes n LOG LOG debug Preconditions checkArgument n DatanodeDescriptor DatanodeDescriptor dnDescriptor DatanodeDescriptor n dnDescriptor dnDescriptor
availableCount root getSubtreeStorageCount type excludeRoot root excludeRoot excludeRoot DFSTopologyNodeImpl availableCount DFSTopologyNodeImpl excludeRoot getSubtreeStorageCount type availableCount DatanodeDescriptor excludeRoot hasStorageType type excludedNode excludeRoot excludedNode excludedNode DatanodeDescriptor availableCount DatanodeDescriptor excludedNode hasStorageType type excludedNode DFSTopologyNodeImpl availableCount DFSTopologyNodeImpl excludedNode getSubtreeStorageCount type excludedNode
Collection InMemoryAliasMapProtocol aliasMaps ArrayList String nsId conf URI namenodeURI Configuration newConf Configuration conf conf nsId newConf setClass addKeySuffixes PROXY_PROVIDER_KEY_PREFIX nsId InMemoryAliasMapFailoverProxyProvider AbstractNNFailoverProxyProvider namenodeURI URI HdfsConstants HDFS_URI_SCHEME nsId String key addKeySuffixes DFS_PROVIDED_ALIASMAP_INMEMORY_RPC_ADDRESS nsId String addr conf get key addr namenodeURI createUri HdfsConstants HDFS_URI_SCHEME NetUtils createSocketAddr addr namenodeURI aliasMaps add NameNodeProxies createProxy newConf namenodeURI InMemoryAliasMapProtocol getProxy
namenodeURI URI HdfsConstants HDFS_URI_SCHEME nsId String key addKeySuffixes DFS_PROVIDED_ALIASMAP_INMEMORY_RPC_ADDRESS nsId String addr conf get key addr namenodeURI createUri HdfsConstants HDFS_URI_SCHEME NetUtils createSocketAddr addr namenodeURI aliasMaps add NameNodeProxies createProxy newConf namenodeURI InMemoryAliasMapProtocol getProxy LOG info namenodeURI e LOG warn nsId e conf get DFS_PROVIDED_ALIASMAP_INMEMORY_RPC_ADDRESS URI uri createUri NetUtils createSocketAddr conf get DFS_PROVIDED_ALIASMAP_INMEMORY_RPC_ADDRESS aliasMaps add NameNodeProxies createProxy conf uri InMemoryAliasMapProtocol getProxy
Preconditions checkState isActiveWriter LOG info Map AsyncLogger NewEpochResponseProto resps createNewUniqueEpoch LOG info loggers getEpoch LOG
File File paxosDir File sd getCurrentDir paxosDir
File File paxosDir File sd getCurrentDir paxosDir LOG info paxosDir toPath paxosDir
f f isFile p Matcher matcher p matcher f getName matcher txid Long parseLong matcher group txid
nsInfo Preconditions checkState nsInfo getNamespaceID nsInfo
checkRequest reqInfo needsValidation startTxId curSegmentTxId curSegment curSegment close curSegment curSegmentTxId HdfsServerConstants INVALID_TXID curSegmentLayoutVersion checkSync nextTxId endTxId startTxId endTxId nextTxId journalId needsValidation FileJournalManager EditLogFile elf fjm getLogFile startTxId elf JournalOutOfSyncException startTxId journalId elf needsValidation
checkRequest reqInfo abortCurSegment segmentTxId segment getStartTxId Preconditions checkArgument segment getEndTxId segment getEndTxId segmentTxId segmentTxId TextFormat shortDebugString segment journalId PersistedRecoveryPaxosData oldData getPersistedPaxosData segmentTxId PersistedRecoveryPaxosData newData PersistedRecoveryPaxosData newBuilder setAcceptedInEpoch reqInfo getEpoch setSegmentState segment build oldData alwaysAssert oldData getAcceptedInEpoch reqInfo getEpoch oldData newData journalId File syncedFile SegmentStateProto currentSegment getSegmentInfo segmentTxId currentSegment currentSegment getEndTxId segment getEndTxId currentSegment LOG info TextFormat shortDebugString segment journalId updateHighestWrittenTxId Math max segment getEndTxId highestWrittenTxId
File syncedFile SegmentStateProto currentSegment getSegmentInfo segmentTxId currentSegment currentSegment getEndTxId segment getEndTxId currentSegment LOG info TextFormat shortDebugString segment journalId updateHighestWrittenTxId Math max segment getEndTxId highestWrittenTxId LOG info TextFormat shortDebugString segment TextFormat shortDebugString currentSegment journalId currentSegment committedTxnId get segment committedTxnId get AssertionError TextFormat shortDebugString currentSegment TextFormat shortDebugString segment committedTxnId get journalId alwaysAssert currentSegment getIsInProgress journalId currentSegment highestWrittenTxId updateHighestWrittenTxId segment getEndTxId syncedFile syncLog reqInfo segment fromUrl
LOG info TextFormat shortDebugString segment TextFormat shortDebugString currentSegment journalId currentSegment committedTxnId get segment committedTxnId get AssertionError TextFormat shortDebugString currentSegment TextFormat shortDebugString segment committedTxnId get journalId alwaysAssert currentSegment getIsInProgress journalId currentSegment updateHighestWrittenTxId segment getEndTxId syncedFile syncLog reqInfo segment fromUrl LOG info TextFormat shortDebugString segment journalId JournalFaultInjector get beforePersistPaxosData persistPaxosData segmentTxId newData JournalFaultInjector get afterPersistPaxosData syncedFile FileUtil replaceFile syncedFile storage getInProgressEditLog segmentTxId
sInfo oldCTime storage getCTime storage cTime sInfo cTime oldLV storage getLayoutVersion storage layoutVersion sInfo layoutVersion
success
Journal jid nameServiceId QuorumJournalManager checkJournalId jid Journal journal journalsById get jid journal File logDir getLogDir jid nameServiceId
Preconditions checkState isStarted journalDir validateAndCreateJournalDir journalDir DefaultMetricsSystem initialize JvmMetrics create conf get DFSConfigKeys DFS_METRICS_SESSION_ID_KEY DefaultMetricsSystem instance InetSocketAddress socAddr JournalNodeRpcServer getAddress conf SecurityUtil login conf DFSConfigKeys DFS_JOURNALNODE_KEYTAB_FILE_KEY DFSConfigKeys DFS_JOURNALNODE_KERBEROS_PRINCIPAL_KEY socAddr getHostName registerJNMXBean httpServer JournalNodeHttpServer conf getHttpServerBindAddress conf httpServer start httpServerURI httpServer getServerURI toString rpcServer JournalNodeRpcServer conf rpcServer start
File editsSyncDir journal getStorage getEditsSyncDir editsSyncDir
LOG warn syncJournals t t LOG info Thread currentThread interrupt LOG warn t t
LOG info jn getBoundIpcAddress getAddress jn getBoundIpcAddress getPort otherJNProxies get index jid InterQJournalProtocol jnProxy otherJNProxies get index jnProxy jnProxy LOG error List RemoteEditLog thisJournalEditLogs thisJournalEditLogs journal getEditLogManifest getLogs e LOG error e GetEditLogManifestResponseProto editLogManifest editLogManifest jnProxy getEditLogManifestFromJournal jid nameServiceId e
uriStr conf getTrimmed DFSConfigKeys DFS_NAMENODE_SHARED_EDITS_DIR_KEY uriStr uriStr nameServiceId uriStr conf getTrimmed DFSConfigKeys DFS_NAMENODE_SHARED_EDITS_DIR_KEY nameServiceId uriStr uriStr HashSet String sharedEditsUri Sets newHashSet nameServiceId Collection String nnIds DFSUtilClient getNameNodeIds conf nameServiceId String nnId nnIds String suffix nameServiceId nnId uriStr conf getTrimmed DFSConfigKeys DFS_NAMENODE_SHARED_EDITS_DIR_KEY suffix sharedEditsUri add uriStr sharedEditsUri uriStr
uriStr uriStr HashSet String sharedEditsUri Sets newHashSet nameServiceId Collection String nnIds DFSUtilClient getNameNodeIds conf nameServiceId String nnId nnIds String suffix nameServiceId nnId uriStr conf getTrimmed DFSConfigKeys DFS_NAMENODE_SHARED_EDITS_DIR_KEY suffix sharedEditsUri add uriStr sharedEditsUri uriStr LOG error DFSConfigKeys DFS_NAMENODE_SHARED_EDITS_DIR_KEY sharedEditsUri toString nameServiceId uriStr uriStr LOG error
nameServiceId Collection String nnIds DFSUtilClient getNameNodeIds conf nameServiceId String nnId nnIds String suffix nameServiceId nnId uriStr conf getTrimmed DFSConfigKeys DFS_NAMENODE_SHARED_EDITS_DIR_KEY suffix sharedEditsUri add uriStr sharedEditsUri uriStr LOG error DFSConfigKeys DFS_NAMENODE_SHARED_EDITS_DIR_KEY sharedEditsUri toString nameServiceId uriStr uriStr LOG error getJournalAddrList uriStr
missingLog URL url success remoteJNproxy httpServerUrl response remoteJNproxy httpServerUrl getHttpServerURI response getFromURL remoteJNproxy jnAddr getHostName LOG error String urlPath GetJournalEditServlet buildPath jid missingLog getStartTxId nsInfo url URL remoteJNproxy httpServerUrl urlPath success downloadMissingLogSegment url missingLog e LOG error e
success remoteJNproxy httpServerUrl response remoteJNproxy httpServerUrl getHttpServerURI response getFromURL remoteJNproxy jnAddr getHostName LOG error String urlPath GetJournalEditServlet buildPath jid missingLog getStartTxId nsInfo url URL remoteJNproxy httpServerUrl urlPath success downloadMissingLogSegment url missingLog e LOG error e e LOG error e
tOut file String prefix String entryName prefix file getName TarArchiveEntry tarEntry TarArchiveEntry file entryName tOut putArchiveEntry tarEntry
RPC setProtocolEngine getConf AliasMapProtocolPB ProtobufRpcEngine2 AliasMapProtocolServerSideTranslatorPB aliasMapProtocolXlator AliasMapProtocolServerSideTranslatorPB BlockingService aliasMapProtocolService AliasMapProtocolService newReflectiveBlockingService aliasMapProtocolXlator InetSocketAddress rpcAddress getBindAddress conf DFS_PROVIDED_ALIASMAP_INMEMORY_RPC_ADDRESS DFS_PROVIDED_ALIASMAP_INMEMORY_RPC_ADDRESS_DEFAULT DFS_PROVIDED_ALIASMAP_INMEMORY_RPC_BIND_HOST setVerbose conf getBoolean DFS_PROVIDED_ALIASMAP_INMEMORY_SERVER_LOG DFS_PROVIDED_ALIASMAP_INMEMORY_SERVER_LOG_DEFAULT aliasMapServer RPC Builder conf setProtocol AliasMapProtocolPB setInstance aliasMapProtocolService setBindAddress rpcAddress getHostName setPort rpcAddress getPort setNumHandlers setVerbose setVerbose build
getLong conf key defaultValue v conf getLong key defaultValue
getLongBytes conf key defaultValue v conf getLongBytes key defaultValue
getInt conf key defaultValue v conf getInt key defaultValue
chooseStorageGroups matcher LOG info matcher chooseStorageGroups overUtilized underUtilized matcher
chooseStorageGroups matcher LOG info matcher chooseStorageGroups overUtilized underUtilized matcher LOG info matcher chooseStorageGroups overUtilized belowAvgUtilized matcher
source target size Math min source availableSizeToMove target availableSizeToMove Task task Task target size source addTask task target incScheduledSize task getSize dispatcher add source target
List DatanodeStorageReport reports dispatcher init bytesLeftToMove init reports bytesLeftToMove newResult ExitStatus SUCCESS bytesLeftToMove LOG info StringUtils byteDesc bytesLeftToMove System err println LOG error newResult ExitStatus UNFINALIZED_UPGRADE bytesLeftToMove bytesBeingMoved chooseStorageGroups bytesBeingMoved System out println newResult ExitStatus NO_MOVE_BLOCK bytesLeftToMove bytesBeingMoved
conf sleeptime conf getTimeDuration DFSConfigKeys DFS_HEARTBEAT_INTERVAL_KEY DFSConfigKeys DFS_HEARTBEAT_INTERVAL_DEFAULT TimeUnit SECONDS TimeUnit MILLISECONDS conf getTimeDuration DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_KEY DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_DEFAULT TimeUnit SECONDS TimeUnit MILLISECONDS
namenodes conf sleeptime conf getTimeDuration DFSConfigKeys DFS_HEARTBEAT_INTERVAL_KEY DFSConfigKeys DFS_HEARTBEAT_INTERVAL_DEFAULT TimeUnit SECONDS TimeUnit MILLISECONDS conf getTimeDuration DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_KEY DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_DEFAULT TimeUnit SECONDS TimeUnit MILLISECONDS LOG info namenodes
namenodes p conf sleeptime conf getTimeDuration DFSConfigKeys DFS_HEARTBEAT_INTERVAL_KEY DFSConfigKeys DFS_HEARTBEAT_INTERVAL_DEFAULT TimeUnit SECONDS TimeUnit MILLISECONDS conf getTimeDuration DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_KEY DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_DEFAULT TimeUnit SECONDS TimeUnit MILLISECONDS LOG info namenodes LOG info p
namenodes p conf sleeptime conf getTimeDuration DFSConfigKeys DFS_HEARTBEAT_INTERVAL_KEY DFSConfigKeys DFS_HEARTBEAT_INTERVAL_DEFAULT TimeUnit SECONDS TimeUnit MILLISECONDS conf getTimeDuration DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_KEY DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_DEFAULT TimeUnit SECONDS TimeUnit MILLISECONDS LOG info namenodes LOG info p LOG info p getIncludedNodes
namenodes p conf sleeptime conf getTimeDuration DFSConfigKeys DFS_HEARTBEAT_INTERVAL_KEY DFSConfigKeys DFS_HEARTBEAT_INTERVAL_DEFAULT TimeUnit SECONDS TimeUnit MILLISECONDS conf getTimeDuration DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_KEY DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_DEFAULT TimeUnit SECONDS TimeUnit MILLISECONDS LOG info namenodes LOG info p LOG info p getIncludedNodes LOG info p getExcludedNodes
done iteration done iteration done Collections shuffle connectors nnc connectors p p nnc Balancer b Balancer nnc p conf Result r b runOneIteration r print iteration System out b resetData conf r exitStatus done r exitStatus r exitStatus getExitCode
scheduleInterval conf getTimeDuration DFSConfigKeys DFS_BALANCER_SERVICE_INTERVAL_KEY DFSConfigKeys DFS_BALANCER_SERVICE_INTERVAL_DEFAULT TimeUnit MILLISECONDS retryOnException conf getInt DFSConfigKeys DFS_BALANCER_SERVICE_RETRIES_ON_EXCEPTION DFSConfigKeys DFS_BALANCER_SERVICE_RETRIES_ON_EXCEPTION_DEFAULT retCode doBalance namenodes nsIds p conf retCode LOG info retCode failedTimesSinceLastSuccessfulBalance LOG info failedTimesSinceLastSuccessfulBalance exceptionsSinceLastBalance e exceptionsSinceLastBalance retryOnException e
getBlocksRateLimiter getBlocksRateLimiter acquire isRequestStandby NamenodeProtocol nnproxy nsId HAUtil config nsId List ClientProtocol namenodes HAUtil getProxiesForAllNameNodesInNameservice config nsId ClientProtocol proxy namenodes proxy NamenodeProtocol sbn NameNodeProxies createNonHAProxy config RPC getServerAddress proxy NamenodeProtocol UserGroupInformation getCurrentUser getProxy nnproxy sbn isRequestStandby
initialize conf stats clusterMap host2datanodeMap initialize conf stats clusterMap host2datanodeMap balancedPreferencePercent conf getFloat DFS_NAMENODE_AVAILABLE_SPACE_BLOCK_PLACEMENT_POLICY_BALANCED_SPACE_PREFERENCE_FRACTION_KEY DFS_NAMENODE_AVAILABLE_SPACE_BLOCK_PLACEMENT_POLICY_BALANCED_SPACE_PREFERENCE_FRACTION_DEFAULT
initialize conf stats clusterMap host2datanodeMap initialize conf stats clusterMap host2datanodeMap balancedPreferencePercent conf getFloat DFS_NAMENODE_AVAILABLE_SPACE_RACK_FAULT_TOLERANT_BLOCK_PLACEMENT_POLICY_BALANCED_SPACE_PREFERENCE_FRACTION_KEY DFS_NAMENODE_AVAILABLE_SPACE_BLOCK_RACK_FAULT_TOLERANT_PLACEMENT_POLICY_BALANCED_SPACE_PREFERENCE_FRACTION_DEFAULT
conf isEnabled conf getBoolean DFSConfigKeys DFS_BLOCK_ACCESS_TOKEN_ENABLE_KEY DFSConfigKeys DFS_BLOCK_ACCESS_TOKEN_ENABLE_DEFAULT
BlockPlacementPolicy placementPolicy placementPolicies getPolicy rw getBlock getBlockType rw chooseTargets placementPolicy storagePolicySuite excludedNodes namesystem writeLock rw DatanodeStorageInfo targets rw getTargets targets targets rw resetTargets rw scheduledWork namesystem writeUnlock
BlockPlacementPolicy placementPolicy placementPolicies getPolicy rw getBlock getBlockType rw chooseTargets placementPolicy storagePolicySuite excludedNodes namesystem writeLock rw DatanodeStorageInfo targets rw getTargets targets targets rw resetTargets rw scheduledWork namesystem writeUnlock
pendingNum pendingReconstruction getNumReplicas block block numReplicas pendingNum neededReconstruction remove block priority rw resetTargets blockLog debug block DatanodeStorageInfo targets rw getTargets BlockPlacementStatus placementStatus getBlockPlacementStatus block numReplicas placementStatus BlockPlacementStatus newPlacementStatus getBlockPlacementStatus block targets newPlacementStatus newPlacementStatus placementStatus rw setNotEnoughRack rw addTaskToDatanode numReplicas DatanodeStorageInfo incrementBlocksScheduled targets
nodeID storage context IOException namesystem writeLock startTime Time monotonicNow endTime DatanodeDescriptor node Collection Block invalidatedBlocks Collections emptyList String strBlockReportId context Long toHexString context getReportId node datanodeManager getDatanode nodeID node node IOException nodeID DatanodeStorageInfo storageInfo providedStorageMap getStorage node storage storageInfo storageInfo node updateStorage storage namesystem storageInfo storageInfo
DatanodeDescriptor node Collection Block invalidatedBlocks Collections emptyList String strBlockReportId context Long toHexString context getReportId node datanodeManager getDatanode nodeID node node IOException nodeID DatanodeStorageInfo storageInfo providedStorageMap getStorage node storage storageInfo storageInfo node updateStorage storage storageInfo storageInfo blockLog info strBlockReportId nodeID blockReportLeaseManager removeLease node node hasStaleStorages storageInfo
storageInfo node updateStorage storage namesystem storageInfo storageInfo blockLog info strBlockReportId nodeID blockReportLeaseManager removeLease node node hasStaleStorages storageInfo blockLog info strBlockReportId storageInfo getStorageID nodeID getDatanodeUuid processFirstBlockReport storageInfo newReport storageInfo invalidatedBlocks processReport storageInfo newReport context storageInfo receivedBlockReport endTime Time monotonicNow namesystem writeUnlock
node hasStaleStorages storageInfo blockLog info strBlockReportId storageInfo getStorageID nodeID getDatanodeUuid processFirstBlockReport storageInfo newReport storageInfo invalidatedBlocks processReport storageInfo newReport context storageInfo receivedBlockReport endTime Time monotonicNow namesystem writeUnlock b invalidatedBlocks blockLog debug strBlockReportId b node b getNumBytes NameNodeMetrics metrics NameNode getNameNodeMetrics metrics
namesystem writeLock startTime Time monotonicNow startSize postponedMisreplicatedBlocks size Iterator Block it postponedMisreplicatedBlocks iterator it Block b it next it remove BlockInfo bi getStoredBlock b bi LOG debug b MisReplicationResult res processMisReplicatedBlock bi
it Block b it next it remove BlockInfo bi getStoredBlock b bi LOG debug b MisReplicationResult res processMisReplicatedBlock bi LOG debug b res res MisReplicationResult rescannedMisreplicatedBlocks add b postponedMisreplicatedBlocks addAll rescannedMisreplicatedBlocks rescannedMisreplicatedBlocks clear endSize postponedMisreplicatedBlocks size
BlockReportReplica iblk report set add BlockReportReplica iblk sortedReport set sortedReport report reportDiffSorted storageInfo sortedReport toAdd toRemove toInvalidate toCorrupt toUC DatanodeDescriptor node storageInfo getDatanodeDescriptor b toUC addStoredBlockUnderConstruction b storageInfo b toRemove removeStoredBlock b node numBlocksLogged b toAdd addStoredBlock b stored b reported storageInfo numBlocksLogged maxNumBlocksToLog numBlocksLogged
storageInfo report report assert namesystem hasWriteLock assert storageInfo getBlockReportCount iblk report ReplicaState reportedState iblk getState
assert shouldPostponeBlocksFromFuture
isPreviousMessageProcessed
nrPostponed postponeBlock block LOG block nrUnderConstruction processed totalProcessed processed reconstructionQueuesInitProgress Math min totalProcessed totalBlocks LOG info blocksMap size LOG info nrInvalid LOG info nrUnderReplicated
postponeBlock block LOG block nrUnderConstruction processed totalProcessed processed reconstructionQueuesInitProgress Math min totalProcessed totalBlocks LOG info blocksMap size LOG info nrInvalid LOG info nrUnderReplicated LOG info nrOverReplicated nrPostponed nrPostponed
BlockInfo blocks processed Iterator BlockInfo iter blocks iterator namesystem iter limit processed numBlocksPerIteration namesystem writeLockInterruptibly iter processed limit BlockInfo blk iter next MisReplicationResult r processMisReplicatedBlock blk processed
nonExcess chosen storedBlock nonExcess remove chosen excessRedundancyMap add chosen getDatanodeDescriptor storedBlock Block blockToInvalidate getBlockOnStorage storedBlock chosen addToInvalidates blockToInvalidate chosen getDatanodeDescriptor
storageInfo DatanodeDescriptor DatanodeDescriptor node storageInfo getDatanodeDescriptor
it BlockInfo block it next block expectedReplication getExpectedRedundancyNum block NumberReplicas num countNodes block num expectedReplication processExtraRedundancyBlock block expectedReplication numExtraRedundancy namesystem namesystem writeUnlock Thread sleep Thread currentThread interrupt
EnumMap StorageType Integer storageTypes getRequiredStorageTypes requiredStorageTypes List DatanodeStorageInfo results ArrayList avoidStaleNodes stats stats isAvoidingStaleDataNodesForWrite maxNodesAndReplicas getMaxNodesPerRack numOfReplicas numOfReplicas maxNodesAndReplicas maxNodesPerRack maxNodesAndReplicas chooseFavouredNodes src numOfReplicas favoredNodes favoriteAndExcludedNodes blocksize maxNodesPerRack results avoidStaleNodes storageTypes results size numOfReplicas numOfReplicas results size DatanodeStorageInfo storage results addToExcludedNodes storage getDatanodeDescriptor favoriteAndExcludedNodes DatanodeStorageInfo remainingTargets chooseTarget src numOfReplicas writer ArrayList DatanodeStorageInfo numOfReplicas favoriteAndExcludedNodes blocksize storagePolicy flags storageTypes i i remainingTargets i results add remainingTargets i getPipeline writer results toArray DatanodeStorageInfo results size
Map String List DatanodeStorageInfo rackMap HashMap List DatanodeStorageInfo moreThanOne ArrayList List DatanodeStorageInfo exactlyOne ArrayList splitNodesWithRack availableReplicas delCandidates rackMap moreThanOne exactlyOne firstOne DatanodeStorageInfo delNodeHintStorage DatanodeStorageInfo getDatanodeStorageInfo delCandidates delNodeHint DatanodeStorageInfo addedNodeStorage DatanodeStorageInfo getDatanodeStorageInfo delCandidates addedNode delCandidates DatanodeStorageInfo cur firstOne delNodeHintStorage addedNodeStorage moreThanOne exactlyOne excessTypes cur delNodeHintStorage cur chooseReplicaToDelete moreThanOne exactlyOne excessTypes rackMap firstOne cur
Set Node newExcludeNodes HashSet resultStorage results addToExcludedNodes resultStorage getDatanodeDescriptor newExcludeNodes LOG trace results LOG trace excludedNodes LOG trace newExcludeNodes numOfReplicas totalReplicaExpected results size numResultsOflastChoose results size chooseOnce numOfReplicas writer newExcludeNodes blocksize bestEffortMaxNodesPerRack results avoidStaleNodes storageTypes nere lastException nere excludedNodes addAll newExcludeNodes numResultsOflastChoose totalReplicaExpected
dn NodeData node nodes remove dn getDatanodeUuid node
remove node monotonicNowMs Time monotonicNow pruneExpiredPending monotonicNowMs numPending LOG StringBuilder allLeases StringBuilder String prefix cur cur cur cur allLeases append prefix append cur datanodeUuid prefix LOG debug dn getDatanodeUuid numPending allLeases toString numPending node leaseId getNextId node leaseTimeMs monotonicNowMs
dn NodeData node nodes get dn getDatanodeUuid node
LOG info intervalMs curTimeMs Time monotonicNow lock lock LOG info LOG debug delta startTimeMs intervalMs curTimeMs delta
doRescan await delta TimeUnit MILLISECONDS curTimeMs Time monotonicNow lock unlock startTimeMs curTimeMs mark mark rescan curTimeMs Time monotonicNow lock lock completedScanCount curScanCount curScanCount scanFinished signalAll
FSDirectory fsDir namesystem getFSDirectory now Date getTime scannedDirectives now
FSDirectory fsDir namesystem getFSDirectory now Date getTime directive scannedDirectives directive getExpiryTime directive getExpiryTime now LOG debug directive getId directive getExpiryTime now String path directive getPath INode node node fsDir getINode path DirOp READ e LOG debug directive getId path e getMessage node
node fsDir getINode path DirOp READ e LOG debug directive getId path e getMessage node LOG debug directive getId path node INodeDirectory dir node asDirectory ReadOnlyList INode children dir getChildrenList Snapshot CURRENT_STATE_ID INode child children child rescanFile directive child asFile node rescanFile directive node asFile
directive file BlockInfo blockInfos file getBlocks directive addFilesNeeded neededTotal file computeFileSizeNotIncludingLastUcBlock directive getReplication directive addBytesNeeded neededTotal CachePool pool directive getPool pool pool
Block block Block blockInfo getBlockId CachedBlock ncblock CachedBlock block getBlockId directive getReplication mark CachedBlock ocblock cachedBlocks get ncblock ocblock cachedBlocks put ncblock ocblock ncblock List DatanodeDescriptor cachedOn ocblock getDatanodes Type CACHED cachedByBlock Math min cachedOn size directive getReplication blockInfo getNumBytes cachedTotal cachedByBlock mark ocblock ocblock getReplication directive getReplication ocblock setReplicationAndMark directive getReplication mark LOG trace directive getId blockInfo ocblock getReplication directive addBytesCached cachedTotal cachedTotal
Set DatanodeDescriptor datanodes blockManager getDatanodeManager getDatanodes DatanodeDescriptor dn datanodes remaining dn getCacheRemaining CachedBlock it dn it CachedBlock cblock it next BlockInfo blockInfo blockManager getStoredBlock Block cblock getBlockId blockInfo
cachedBlock BlockInfo blockInfo blockManager getStoredBlock Block cachedBlock getBlockId blockInfo
info pendingBytes info getNumBytes it datanode getPendingUncached iterator it CachedBlock cBlock it next BlockInfo info blockManager getStoredBlock Block cBlock getBlockId info pendingBytes info getNumBytes pendingCapacity pendingBytes datanode getCacheRemaining pendingCapacity blockInfo getNumBytes LOG trace blockInfo getBlockId datanode getDatanodeUuid blockInfo getNumBytes pendingCapacity pendingBytes datanode getCacheRemaining outOfCapacity possibilities add datanode List DatanodeDescriptor chosen chooseDatanodesForCaching possibilities neededCached blockManager getDatanodeManager getStaleInterval
pendingRepLimit conf getInt DFSConfigKeys DFS_NAMENODE_DECOMMISSION_BACKOFF_MONITOR_PENDING_LIMIT DFSConfigKeys DFS_NAMENODE_DECOMMISSION_BACKOFF_MONITOR_PENDING_LIMIT_DEFAULT pendingRepLimit
namesystem LOG info numBlocksChecked namesystem writeLock processCancelledNodes processPendingNodes namesystem writeUnlock check e LOG warn e numBlocksChecked
namesystem writeLock dn isHealthy blockManager isNodeHealthyForDecommissionOrMaintenance dn isHealthy dn dnAdmin setDecommissioned dn outOfServiceNodeBlocks remove dn pendingRep remove dn dn dnAdmin setInMaintenance dn pendingRep remove dn dn
dn isHealthy blockManager isNodeHealthyForDecommissionOrMaintenance dn isHealthy dn dnAdmin setDecommissioned dn outOfServiceNodeBlocks remove dn pendingRep remove dn dn dnAdmin setInMaintenance dn pendingRep remove dn dn LOG info dn pendingRep remove dn outOfServiceNodeBlocks remove dn
outOfServiceNodeBlocks remove dn pendingRep remove dn dn dnAdmin setInMaintenance dn pendingRep remove dn dn LOG info dn pendingRep remove dn outOfServiceNodeBlocks remove dn LOG error dn dn getAdminState pendingRep remove dn outOfServiceNodeBlocks remove dn
pendingRep remove dn dn dnAdmin setInMaintenance dn pendingRep remove dn dn LOG info dn pendingRep remove dn outOfServiceNodeBlocks remove dn LOG error dn dn getAdminState pendingRep remove dn outOfServiceNodeBlocks remove dn LOG info dn dn getAdminState
DatanodeDescriptor dn nodeIter next Iterator BlockInfo blockIt iterators get dn blockIt blocksProcessed blocksProcessed namesystem writeUnlock namesystem writeLock blocksProcessed blockIt dn pendingCount blockIt nodeIter remove pendingCount
numBlocksPerCheck conf getInt DFSConfigKeys DFS_NAMENODE_DECOMMISSION_BLOCKS_PER_INTERVAL_KEY DFSConfigKeys DFS_NAMENODE_DECOMMISSION_BLOCKS_PER_INTERVAL_DEFAULT numBlocksPerCheck
namesystem LOG info numBlocksChecked numBlocksCheckedPerLock numNodesChecked namesystem writeLock processPendingNodes check e LOG warn e namesystem writeUnlock numBlocksChecked numNodesChecked
List DatanodeDescriptor toRemove ArrayList it numNodesChecked Map Entry DatanodeDescriptor AbstractList BlockInfo entry it next DatanodeDescriptor dn entry getKey AbstractList BlockInfo blocks entry getValue fullScan dn dn dnAdmin stopMaintenance dn toRemove add dn dn blocks
AbstractList BlockInfo blocks entry getValue fullScan dn dn dnAdmin stopMaintenance dn toRemove add dn dn blocks LOG debug dn blocks handleInsufficientlyStored dn outOfServiceNodeBlocks put dn blocks fullScan
dnAdmin stopMaintenance dn toRemove add dn dn blocks LOG debug dn blocks handleInsufficientlyStored dn outOfServiceNodeBlocks put dn blocks fullScan LOG debug dn getAdminState dn pruneReliableBlocks dn blocks blocks fullScan
LOG debug dn getAdminState dn pruneReliableBlocks dn blocks blocks LOG debug dn blocks handleInsufficientlyStored dn outOfServiceNodeBlocks put dn blocks isHealthy blockManager isNodeHealthyForDecommissionOrMaintenance dn blocks isHealthy dn dnAdmin setDecommissioned dn toRemove add dn dn dnAdmin setInMaintenance dn
LOG debug dn getAdminState dn pruneReliableBlocks dn blocks blocks LOG debug dn blocks handleInsufficientlyStored dn outOfServiceNodeBlocks put dn blocks isHealthy blockManager isNodeHealthyForDecommissionOrMaintenance dn blocks isHealthy dn dnAdmin setDecommissioned dn toRemove add dn dn dnAdmin setInMaintenance dn
blocks size LOG debug dn blocks handleInsufficientlyStored dn outOfServiceNodeBlocks put dn blocks isHealthy blockManager isNodeHealthyForDecommissionOrMaintenance dn blocks size isHealthy dn dnAdmin setDecommissioned dn toRemove add dn dn dnAdmin setInMaintenance dn Preconditions checkState dn dn getAdminState blocks size LOG debug dn dn getAdminState
LOG warn deprecatedKey LOG warn DFSConfigKeys DFS_NAMENODE_DECOMMISSION_BLOCKS_PER_INTERVAL_KEY checkArgument blocksPerInterval DFSConfigKeys DFS_NAMENODE_DECOMMISSION_BLOCKS_PER_INTERVAL_KEY maxConcurrentTrackedNodes conf getInt DFSConfigKeys DFS_NAMENODE_DECOMMISSION_MAX_CONCURRENT_TRACKED_NODES DFSConfigKeys DFS_NAMENODE_DECOMMISSION_MAX_CONCURRENT_TRACKED_NODES_DEFAULT checkArgument maxConcurrentTrackedNodes DFSConfigKeys DFS_NAMENODE_DECOMMISSION_MAX_CONCURRENT_TRACKED_NODES Class cls cls conf getClass DFSConfigKeys DFS_NAMENODE_DECOMMISSION_MONITOR_CLASS Class forName DFSConfigKeys DFS_NAMENODE_DECOMMISSION_MONITOR_CLASS_DEFAULT monitor DatanodeAdminMonitorInterface ReflectionUtils newInstance cls conf monitor setBlockManager blockManager monitor setNameSystem namesystem monitor setDatanodeAdminManager e RuntimeException cls e executor scheduleAtFixedRate monitor intervalSecs intervalSecs TimeUnit SECONDS
startDecommission node node node hbManager startDecommission node node node
startMaintenance node maintenanceExpireTimeInMS node setMaintenanceExpireTimeInMS maintenanceExpireTimeInMS node hbManager startMaintenance node node node
setDecommissioned dn dn setDecommissioned
setInMaintenance dn dn setInMaintenance
conf conf conf maxConcurrentTrackedNodes conf getInt DFSConfigKeys DFS_NAMENODE_DECOMMISSION_MAX_CONCURRENT_TRACKED_NODES DFSConfigKeys DFS_NAMENODE_DECOMMISSION_MAX_CONCURRENT_TRACKED_NODES_DEFAULT maxConcurrentTrackedNodes
reports storageMap LOG debug reports length storageMap size HashMap String DatanodeStorageInfo excessStorages excessStorages HashMap storageMap report reports excessStorages remove report getStorage getStorageID DatanodeStorageInfo storageInfo excessStorages storageInfo DatanodeStorageInfo info storageMap remove storageInfo getStorageID info getStorageType getParent DFSTopologyNodeImpl DFSTopologyNodeImpl getParent childRemoveStorage getName info getStorageType LOG info storageInfo
List String node List String dependencies Collections emptyList dnsToSwitchMapping DNSToSwitchMappingWithDependency dependencies DNSToSwitchMappingWithDependency dnsToSwitchMapping getDependency node getHostName dependencies
node String message node message
isInMaintenance dn isInMaintenance isInMaintenance dn nodes add dn foundNodes add dn getResolvedAddress Collections sort nodes addr foundNodes addr DatanodeDescriptor dn DatanodeDescriptor DatanodeID addr getAddress getHostAddress addr getHostName addr getPort defaultXferPort addr getPort defaultInfoPort defaultInfoSecurePort defaultIpcPort setDatanodeDead dn dn dn setDecommissioned nodes add dn
DisallowedDatanodeException nodeinfo nodeinfo nodeinfo DatanodeCommand RegisterCommand REGISTER heartbeatManager updateHeartbeat nodeinfo reports cacheCapacity cacheUsed xceiverCount failedVolumes volumeFailureSummary DatanodeCommand BlockRecoveryCommand brCommand getBlockRecoveryCommand blockPoolId nodeinfo brCommand DatanodeCommand brCommand List DatanodeCommand cmds ArrayList totalReplicateBlocks nodeinfo getNumberOfReplicateBlocks totalECBlocks nodeinfo getNumberOfBlocksToBeErasureCoded totalBlocks totalReplicateBlocks totalECBlocks totalBlocks numReplicationTasks Math ceil totalReplicateBlocks maxTransfers totalBlocks
sourceIndex DatanodeStorageInfo target BlockInfoStriped stripedBlk BlockInfoStriped getBlock blockIndex liveBlockIndicies sourceIndex DatanodeDescriptor source getSrcNodes sourceIndex internBlkLen StripedBlockUtil getInternalBlockLength stripedBlk getNumBytes stripedBlk getCellSize stripedBlk getDataBlockNum blockIndex Block targetBlk Block stripedBlk getBlockId blockIndex internBlkLen stripedBlk getGenerationStamp source addBlockToBeReplicated targetBlk DatanodeStorageInfo target
d result result staleDataNodes remove d result
block removed pendingReconstructions PendingBlockInfo found pendingReconstructions get block found
providedStorageInfo State State NORMAL providedStorageInfo setState State NORMAL
minDN numOfDataNodes String readablePolicies String resultMessage numOfDataNodes minDN resultMessage String format minDN readablePolicies numOfDataNodes
user user user path path path LOG trace user remoteIp path remoteIp LOG trace List Rule userRules userRules rulemap get user userRules ArrayList Rule List Rule anyRules anyRules rulemap get anyRules ArrayList Rule List Rule rules Stream of userRules anyRules flatMap l l stream collect Collectors toList Rule rule rules SubnetUtils SubnetInfo subnet rule getSubnet String rulePath rule getPath LOG trace subnet subnet getCidrSignature rulePath subnet subnet remoteIp rulePath path
Pattern comma_split Pattern compile Pattern rule_split Pattern compile Map Integer List String splits rule_split splitAsStream ruleString map x comma_split split x collect Collectors groupingBy x x length splits String bad_lines rule_split splitAsStream ruleString filter x comma_split split x length collect Collectors joining IllegalArgumentException bad_lines user cidr path v1 v2 v1 addAll v2 v1 String split splits
metricsLog metricsLog metricsLog info nodeName MBeanServer server ManagementFactory getPlatformMBeanServer mbeanName server MBeanInfo mBeanInfo server getMBeanInfo mbeanName String mBeanNameName MBeans getMbeanNameName mbeanName Set String attributeNames getFilteredAttributes mBeanInfo AttributeList attributes server getAttributes mbeanName attributeNames toArray String attributeNames size Object o attributes Attribute attribute Attribute o Object value attribute getValue String valueStr value value toString
metricsLog info nodeName MBeanServer server ManagementFactory getPlatformMBeanServer mbeanName server MBeanInfo mBeanInfo server getMBeanInfo mbeanName String mBeanNameName MBeans getMbeanNameName mbeanName Set String attributeNames getFilteredAttributes mBeanInfo AttributeList attributes server getAttributes mbeanName attributeNames toArray String attributeNames size Object o attributes Attribute attribute Attribute o Object value attribute getValue String valueStr value value toString metricsLog info mBeanNameName attribute getName trimLine valueStr
metricsLog info nodeName MBeanServer server ManagementFactory getPlatformMBeanServer mbeanName server MBeanInfo mBeanInfo server getMBeanInfo mbeanName String mBeanNameName MBeans getMbeanNameName mbeanName Set String attributeNames getFilteredAttributes mBeanInfo AttributeList attributes server getAttributes mbeanName attributeNames toArray String attributeNames size Object o attributes Attribute attribute Attribute o Object value attribute getValue String valueStr value value toString metricsLog info mBeanNameName attribute getName trimLine valueStr e metricsLog error nodeName mbeanName toString e
oldVersion oldVersion LAST_UPGRADABLE_LAYOUT_VERSION String msg oldVersion LAST_UPGRADABLE_HADOOP_VERSION oldVersion oldVersion LAST_UPGRADABLE_LAYOUT_VERSION
IOException srcFile destFile File parentFile destFile getParentFile parentFile parentFile parentFile IOException parentFile destFile destFile IOException destFile destFile IOException destFile NativeIO copyFileUnbuffered srcFile destFile e IOException srcFile getCanonicalPath destFile getCanonicalPath e toString
num num stream read buf num received num fos fos write buf num throttler throttler throttle num finishedReceiving xferSec Math max Time monotonicNow startTime xferKb received xferCombined xferSec xferStats append String format xferSec xferKb xferSec stream close
isEnabled
blockPoolID InMemoryAliasMapProtocol aliasMap getAliasMap blockPoolID
blockPoolID InMemoryAliasMapProtocol aliasMap getAliasMap blockPoolID
blkMovingInfo sock LOG info blkMovingInfo getBlock blkMovingInfo getSource blkMovingInfo getTarget blkMovingInfo getSourceStorageType blkMovingInfo getTargetStorageType DataOutputStream out DataInputStream in NetUtils connect sock NetUtils createSocketAddr blkMovingInfo getTarget getXferAddr connectToDnViaHostname socketTimeout sock setSoTimeout socketTimeout sock setKeepAlive OutputStream unbufOut sock getOutputStream InputStream unbufIn sock getInputStream
DataInputStream in NetUtils connect sock NetUtils createSocketAddr blkMovingInfo getTarget getXferAddr connectToDnViaHostname socketTimeout sock setSoTimeout socketTimeout sock setKeepAlive OutputStream unbufOut sock getOutputStream InputStream unbufIn sock getInputStream LOG debug blkMovingInfo getTarget IOStreamPair saslStreams saslClient socketSend sock unbufOut unbufIn km accessToken blkMovingInfo getTarget unbufOut saslStreams out unbufIn saslStreams in out DataOutputStream BufferedOutputStream unbufOut ioFileBufferSize in DataInputStream BufferedInputStream unbufIn ioFileBufferSize sendRequest out eb accessToken blkMovingInfo getSource blkMovingInfo getTargetStorageType receiveResponse in
sock setSoTimeout socketTimeout sock setKeepAlive OutputStream unbufOut sock getOutputStream InputStream unbufIn sock getInputStream LOG debug blkMovingInfo getTarget IOStreamPair saslStreams saslClient socketSend sock unbufOut unbufIn km accessToken blkMovingInfo getTarget unbufOut saslStreams out unbufIn saslStreams in out DataOutputStream BufferedOutputStream unbufOut ioFileBufferSize in DataInputStream BufferedInputStream unbufIn ioFileBufferSize sendRequest out eb accessToken blkMovingInfo getSource blkMovingInfo getTargetStorageType receiveResponse in LOG info blkMovingInfo getBlock blkMovingInfo getSource blkMovingInfo getTarget blkMovingInfo getTargetStorageType BlockMovementStatus DN_BLK_STORAGE_MOVEMENT_SUCCESS
Future BlockMovementAttemptFinished future moverCompletionService take future BlockMovementAttemptFinished result future get
writeLock
NamespaceInfo NamespaceInfo nsInfo nsInfo bpNamenode versionRequest
cmds add cmd r r reports length r StorageBlockReport singleReport reports r DatanodeCommand cmd bpNamenode blockReport bpRegistration bpos getBlockPoolId singleReport BlockReportContext reports length r reportId fullBrLeaseId blockReportSizes add calculateBlockReportPBSize useBlocksBuffer singleReport numReportsSent numRPCs cmd cmds add cmd success brSendCost monotonicNow brSendStartTime brCreateCost brSendStartTime brCreateStartTime dn getMetrics addBlockReport brSendCost getRpcMetricSuffix
DatanodeCommand cmd startTime monotonicNow startTime lastCacheReport LOG LOG debug lastCacheReport startTime String bpid bpos getBlockPoolId List Long blockIds dn getFSDataset getCacheReport bpid createTime monotonicNow cmd bpNamenode cacheReport bpRegistration bpid blockIds sendTime monotonicNow createCost createTime startTime sendCost sendTime createTime dn getMetrics addCacheReport sendCost LOG
scheduler scheduleNextHeartbeat StorageReport reports dn getFSDataset getStorageReports bpos getBlockPoolId
resp RollingUpgradeStatus rollingUpgradeStatus resp getRollingUpdateStatus rollingUpgradeStatus rollingUpgradeStatus
ioe runningState RunningState INIT_FAILED LOG error ioe getLocalizedMessage sleepAndLogInterrupts runningState RunningState FAILED LOG error ioe runningState RunningState RUNNING initialRegistrationComplete initialRegistrationComplete countDown offerService
absPathToRemove Preconditions checkArgument absPathToRemove isAbsolute
filesRestored File children trashRoot exists trashRoot listFiles children File restoreDirectory File child children child filesRestored restoreBlockFilesFromTrash child restoreDirectory restoreDirectory File getRestoreDirectory child restoreDirectory exists restoreDirectory IOException restoreDirectory File newChild File restoreDirectory child getName newChild exists newChild child
fromDir toDir diskLayoutVersion conf HardLink hardLink HardLink DataStorage linkBlocks fromDir toDir DataStorage STORAGE_DIR_FINALIZED diskLayoutVersion hardLink conf DataStorage linkBlocks fromDir toDir DataStorage STORAGE_DIR_RBW diskLayoutVersion hardLink conf
String blockFile Matcher matcher BLOCK_POOL_TRASH_PATH_PATTERN matcher blockFile getParent String restoreDirectory matcher replaceFirst STORAGE_DIR_CURRENT
diff Time monotonicNow lastSentTime get allowedIdleTime diff maxSendIdleTime
String bpid block getBlockPoolId
packetReceiver receiveNextPacket in PacketHeader header packetReceiver getHeader
alignedOnDisk partialChunkSizeOnDisk alignedInPacket firstByteInBlock bytesPerChecksum overwriteLastCrc alignedOnDisk shouldNotWriteChecksum doCrcRecalc overwriteLastCrc lastChunkBoundary firstByteInBlock alignedInPacket len bytesPerChecksum IOException block inAddr len bytesPerChecksum Checksum partialCrc doCrcRecalc LOG LOG debug block onDiskLen offsetInChecksum BlockMetadataHeader getHeaderSize onDiskLen bytesPerChecksum checksumSize partialCrc computePartialChunkCrc onDiskLen offsetInChecksum startByteToDisk onDiskLen firstByteInBlock dataBuf arrayOffset dataBuf position numBytesToDisk offsetInBlock onDiskLen begin Time monotonicNow
responder PacketResponder responder getRunnable close responderClosed close block setNumBytes replicaInfo getNumBytes datanode data convertTemporaryToRbw block datanode data finalizeBlock block dirSyncOnFinalize datanode metrics incrBlocksWritten replicaInfo releaseAllBytesReserved
responder PacketResponder responder getRunnable close responderClosed close block setNumBytes replicaInfo getNumBytes datanode data convertTemporaryToRbw block datanode data finalizeBlock block dirSyncOnFinalize datanode metrics incrBlocksWritten replicaInfo releaseAllBytesReserved datanode
downstreams downstreams downstreams length downstreamDNs downstreams isPenultimateNode downstreams length isPenultimateNode mirrorNameForMetrics downstreams getInfoSecurePort downstreams getInfoSecureAddr downstreams getInfoAddr
blkoff sizePartialChunk blkoff bytesPerChecksum blkoff blkoff sizePartialChunk
rb ExtendedBlock block rb getBlock DatanodeInfo targets rb getLocations
ref success FsVolumeSpi volume ref getVolume
SocketOutputStream sockOut SocketOutputStream out sockOut write buf headerOff dataOff headerOff FileChannel fileCh FileInputStream ris getDataIn getChannel LongWritable waitTime LongWritable LongWritable transferTime LongWritable fileIoProvider transferToSocketFully ris getVolumeRef getVolume sockOut fileCh blockInPosition dataLen waitTime transferTime datanode metrics addSendDataPacketBlockedOnNetworkNanos waitTime get datanode metrics addSendDataPacketTransferNanos transferTime get blockInPosition dataLen out write buf headerOff dataOff dataLen headerOff
pktBufSize chunkSize checksumSize maxChunksPerPacket ByteBuffer pktBuf ByteBuffer allocate pktBufSize offset manageOsCache len sendPacket pktBuf maxChunksPerPacket streamForSendChunks transferTo throttler offset len totalRead len numberOfChunks len checksumSize seqno sendPacket pktBuf maxChunksPerPacket streamForSendChunks transferTo throttler out flush e ioeToSocketException e sentEntireByteRange
IOException rootException
e rootException e triggerBlockReport BlockReportOptions Factory setIncremental build e LOG warn property newVal e rootException rootException e rootException ReconfigurationException property newVal getConf get property rootException ReconfigurationException rootException
ChangedVolumes results ChangedVolumes results newLocations addAll newStorageLocations Storage StorageDirectory it it Storage StorageDirectory dir it next found StorageLocation newLocationItr results newLocations newLocationItr StorageLocation newLocation newLocationItr next newLocation dir StorageLocation oldLocation existingStorageLocations get newLocation getNormalizedUri toString oldLocation oldLocation newLocation IOException newLocationItr remove results unchangedLocations add newLocation found
IOException newLocationItr remove results unchangedLocations add newLocation found found LOG info dir getRoot results deactivateLocations add StorageLocation parse dir getRoot toString found StorageLocation newLocationItr results newLocationItr StorageLocation newLocation newLocationItr next newLocation toString found
service Executors newFixedThreadPool changedVolumes newLocations size List Future IOException exceptions Lists newArrayList StorageLocation location changedVolumes newLocations exceptions service IOException IOException data addVolume location nsInfos IOException e e i i changedVolumes newLocations size i StorageLocation volume changedVolumes newLocations get i Future IOException ioExceptionFuture exceptions get i
exceptions IOException IOException data addVolume location nsInfos IOException e e i i changedVolumes newLocations i StorageLocation volume changedVolumes newLocations get i Future IOException ioExceptionFuture exceptions get i IOException ioe ioExceptionFuture get ioe errorMessageBuilder append String format volume ioe getMessage
data addVolume location nsInfos IOException e e i i changedVolumes newLocations i StorageLocation volume changedVolumes newLocations get i Future IOException ioExceptionFuture exceptions get i IOException ioe ioExceptionFuture get ioe errorMessageBuilder append String format volume ioe getMessage LOG error volume ioe effectiveVolumes add volume toString
i i changedVolumes newLocations i StorageLocation volume changedVolumes newLocations get i Future IOException ioExceptionFuture exceptions get i IOException ioe ioExceptionFuture get ioe errorMessageBuilder append String format volume ioe getMessage LOG error volume ioe effectiveVolumes add volume toString LOG info volume e errorMessageBuilder append String format volume e toString
InetSocketAddress ipcAddr NetUtils createSocketAddr getConf getTrimmed DFS_DATANODE_IPC_ADDRESS_KEY RPC setProtocolEngine getConf ClientDatanodeProtocolPB ProtobufRpcEngine2 ClientDatanodeProtocolServerSideTranslatorPB clientDatanodeProtocolXlator ClientDatanodeProtocolServerSideTranslatorPB BlockingService service ClientDatanodeProtocolService newReflectiveBlockingService clientDatanodeProtocolXlator ipcServer RPC Builder getConf setProtocol ClientDatanodeProtocolPB setInstance service setBindAddress ipcAddr getHostName setPort ipcAddr getPort setNumHandlers getConf getInt DFS_DATANODE_HANDLER_COUNT_KEY DFS_DATANODE_HANDLER_COUNT_DEFAULT setVerbose setSecretManager blockPoolTokenSecretManager build ReconfigurationProtocolServerSideTranslatorPB reconfigurationProtocolXlator ReconfigurationProtocolServerSideTranslatorPB service ReconfigurationProtocolService newReflectiveBlockingService reconfigurationProtocolXlator DFSUtil addPBProtocol getConf ReconfigurationProtocolPB service ipcServer InterDatanodeProtocolServerSideTranslatorPB interDatanodeProtocolXlator InterDatanodeProtocolServerSideTranslatorPB service InterDatanodeProtocolService newReflectiveBlockingService interDatanodeProtocolXlator DFSUtil addPBProtocol getConf InterDatanodeProtocolPB service ipcServer TraceAdminProtocolServerSideTranslatorPB traceAdminXlator TraceAdminProtocolServerSideTranslatorPB BlockingService traceAdminService TraceAdminService newReflectiveBlockingService traceAdminXlator DFSUtil addPBProtocol getConf TraceAdminProtocolPB traceAdminService ipcServer
backlogLength getConf getInt CommonConfigurationKeysPublic IPC_SERVER_LISTEN_QUEUE_SIZE_KEY CommonConfigurationKeysPublic IPC_SERVER_LISTEN_QUEUE_SIZE_DEFAULT tcpPeerServer TcpPeerServer dnConf socketWriteTimeout DataNode getStreamingAddr getConf backlogLength dnConf getTransferSocketRecvBufferSize tcpPeerServer setReceiveBufferSize dnConf getTransferSocketRecvBufferSize streamingAddr tcpPeerServer getStreamingAddr LOG info streamingAddr threadGroup ThreadGroup xserver DataXceiverServer tcpPeerServer getConf dataXceiverServer Daemon threadGroup xserver threadGroup setDaemon getConf getConf DomainPeerServer domainPeerServer getDomainPeerServer getConf streamingAddr getPort domainPeerServer localDataXceiverServer Daemon threadGroup DataXceiverServer domainPeerServer getConf
storage storage setDatanodeUuid generateUuid storage writeAll
datanodeid connectToDnViaHostname String dnAddr datanodeid getIpcAddr connectToDnViaHostname InetSocketAddress addr NetUtils createSocketAddr dnAddr
BlockTokenIdentifier token BlockTokenIdentifier id BlockTokenIdentifier ByteArrayInputStream buf ByteArrayInputStream token getIdentifier DataInputStream in DataInputStream buf id readFields in
stopMetricsLogger p p stop
lengthTooShort data checkBlock block block getNumBytes ReplicaState FINALIZED replicaNotExist replicaStateNotFinalized blockFileNotExist lengthTooShort blockFileNotExist replicaNotExist replicaStateNotFinalized String errStr block
lengthTooShort blockFileNotExist String errStr block LOG info errStr bpos trySendErrorReport DatanodeProtocol INVALID_BLOCK errStr blockFileNotExist reportBadBlock bpos block block lengthTooShort reportBadBlock bpos block block data getLength block block getNumBytes
checkSuperuserPrivilege
checkSuperuserPrivilege
bpid bpid getBPStorage bpid stopTrashCleaner
clearTrash bpid trashEnabledBpids bpid getBPStorage bpid clearTrash trashEnabledBpids remove bpid
List UpgradeTask tasks Lists newArrayList dataDir dataDir List Callable StorageDirectory callables Lists newArrayList StorageDirectory sd loadStorageDirectory datanode nsInfo dataDir startOpt callables callables addStorageDir sd success add dataDir Callable StorageDirectory c callables tasks add UpgradeTask dataDir executor submit c e LOG warn dataDir e
List Callable StorageDirectory callables Lists newArrayList StorageDirectory sd loadStorageDirectory datanode nsInfo dataDir startOpt callables callables addStorageDir sd success add dataDir Callable StorageDirectory c callables tasks add UpgradeTask dataDir executor submit c e LOG warn dataDir e LOG info dataDir success add dataDir tasks
dataDir makeBlockPoolDir bpid List Callable StorageDirectory sdCallables Lists newArrayList List StorageDirectory dirs bpStorage recoverTransitionRead nsInfo dataDir startOpt sdCallables datanode getConf sdCallables StorageDirectory sd dirs success add sd upgradeCallableMap put dataDir sdCallables e LOG warn dataDir bpid e List Callable StorageDirectory entry upgradeCallableMap Callable StorageDirectory c entry tasks add UpgradeTask entry getKey executor submit c tasks
sd nsInfo prevDir tmpDir bbwDir toDir oldLV conf linkAllBlocks tmpDir bbwDir toDir oldLV conf clusterID nsInfo getClusterID upgradeProperties sd conf rename tmpDir prevDir
sd conf createStorageID sd layoutVersion conf
datanode shortCircuitRegistry registerSlot ExtendedBlockId fromExtendedBlock blk slotId isCached registeredSlotId slotId fis datanode requestShortCircuitFdsForRead blk token maxVersion Preconditions checkState fis bld setStatus SUCCESS bld setShortCircuitAccessVersion DataNode CURRENT_BLOCK_FORMAT_VERSION e bld setStatus ERROR_UNSUPPORTED bld setShortCircuitAccessVersion DataNode CURRENT_BLOCK_FORMAT_VERSION bld setMessage e getMessage e bld setStatus ERROR_UNSUPPORTED bld setMessage e getMessage e bld setStatus ERROR
block BlockTokenIdentifier blockToken String clientName blockOffset length sendChecksum cachingStrategy previousOpClientName clientName read updateCurrentThreadName block OutputStream baseStream getOutputStream DataOutputStream out getBufferedOutputStream checkAccess out block blockToken Op READ_BLOCK BlockTokenIdentifier AccessMode READ BlockSender blockSender DatanodeRegistration dnR datanode getDNRegistrationForBP block getBlockPoolId String clientTraceFmt clientName length ClientTraceLog isInfoEnabled String format DN_CLIENTTRACE_FORMAT localAddress remoteAddress clientName dnR getDatanodeUuid block dnR block remoteAddress blockSender BlockSender block blockOffset length sendChecksum datanode clientTraceFmt cachingStrategy e String msg block e
targetStorageTypes length System arraycopy targetStorageTypes storageTypes nst nsi targetStorageIds length String storageIds nsi storageIds String nsi storageIds storageId targetStorageTypes length System arraycopy targetStorageIds storageIds nsi storageIds String checkAccess replyOut isClient block blockToken Op WRITE_BLOCK BlockTokenIdentifier AccessMode WRITE storageTypes storageIds targets length IOException stage Arrays asList targets
System arraycopy targetStorageTypes storageTypes nst nsi targetStorageIds length String storageIds nsi storageIds String nsi storageIds storageId targetStorageTypes length System arraycopy targetStorageIds storageIds nsi storageIds String checkAccess replyOut isClient block blockToken Op WRITE_BLOCK BlockTokenIdentifier AccessMode WRITE storageTypes storageIds targets length IOException stage Arrays asList targets LOG LOG debug stage clientname block latestGenerationStamp minBytesRcvd maxBytesRcvd Arrays asList targets pipelineSize srcDataNode pinning
storageIds storageId System arraycopy targetStorageIds storageIds nsi storageIds String checkAccess replyOut isClient block blockToken Op WRITE_BLOCK BlockTokenIdentifier AccessMode WRITE storageTypes storageIds isTransfer targets IOException stage Arrays asList targets LOG LOG debug stage clientname block latestGenerationStamp minBytesRcvd maxBytesRcvd Arrays asList targets pipelineSize srcDataNode pinning LOG debug isDatanode isClient isTransfer LOG debug peer getReceiveBufferSize peer getTcpNoDelay ExtendedBlock originalBlock ExtendedBlock block block block setNumBytes dataXceiverServer estimateBlockSize
LOG info block remoteAddress localAddress DataOutputStream mirrorOut DataInputStream mirrorIn Socket mirrorSock String mirrorNode String firstBadLink Status mirrorInStatus SUCCESS String storageUuid isOnTransientStorage Replica replica stage setCurrentBlockReceiver getBlockReceiver block storageType in peer getRemoteAddressString peer getLocalAddressString stage latestGenerationStamp minBytesRcvd maxBytesRcvd clientname srcDataNode datanode requestedChecksum cachingStrategy allowLazyPersist pinning storageId replica blockReceiver getReplica
DataEncryptionKeyFactory keyFactory datanode getDataEncryptionKeyFactoryForBlock block SecretKey secretKey String bpid block getBlockPoolId BlockKey blockKey datanode blockPoolTokenSecretManager get bpid getCurrentKey secretKey blockKey getKey IOStreamPair saslStreams datanode saslClient socketSend mirrorSock unbufMirrorOut unbufMirrorIn keyFactory blockToken targets secretKey unbufMirrorOut saslStreams out unbufMirrorIn saslStreams in mirrorOut DataOutputStream BufferedOutputStream unbufMirrorOut smallBufferSize mirrorIn DataInputStream unbufMirrorIn String targetStorageId targetStorageIds targetStorageId targetStorageIds
targetPinnings targetPinnings length Sender mirrorOut writeBlock originalBlock targetStorageTypes blockToken clientname targets targetStorageTypes srcDataNode stage pipelineSize minBytesRcvd maxBytesRcvd latestGenerationStamp requestedChecksum cachingStrategy allowLazyPersist targetPinnings targetPinnings targetStorageId targetStorageIds Sender mirrorOut writeBlock originalBlock targetStorageTypes blockToken clientname targets targetStorageTypes srcDataNode stage pipelineSize minBytesRcvd maxBytesRcvd latestGenerationStamp requestedChecksum cachingStrategy allowLazyPersist targetPinnings targetStorageId targetStorageIds mirrorOut flush DataNodeFaultInjector get writeBlockAfterFlush BlockOpResponseProto connectAck BlockOpResponseProto parseFrom PBHelperClient vintPrefixed mirrorIn mirrorInStatus connectAck getStatus firstBadLink connectAck getFirstBadLink mirrorInStatus LOG debug targets length firstBadLink BlockOpResponseProto newBuilder setStatus ERROR setFirstBadLink targets getXferAddr build writeDelimitedTo replyOut
Sender mirrorOut writeBlock originalBlock targetStorageTypes blockToken clientname targets targetStorageTypes srcDataNode stage pipelineSize minBytesRcvd maxBytesRcvd latestGenerationStamp requestedChecksum cachingStrategy allowLazyPersist targetPinnings targetStorageId targetStorageIds mirrorOut flush DataNodeFaultInjector get writeBlockAfterFlush BlockOpResponseProto connectAck BlockOpResponseProto parseFrom PBHelperClient vintPrefixed mirrorIn mirrorInStatus connectAck getStatus firstBadLink connectAck getFirstBadLink mirrorInStatus LOG debug targets length firstBadLink BlockOpResponseProto newBuilder setStatus ERROR setFirstBadLink targets getXferAddr build writeDelimitedTo replyOut replyOut flush IOUtils closeStream mirrorOut
e BlockOpResponseProto newBuilder setStatus ERROR setFirstBadLink targets getXferAddr build writeDelimitedTo replyOut replyOut flush IOUtils closeStream mirrorOut mirrorOut IOUtils closeStream mirrorIn mirrorIn IOUtils closeSocket mirrorSock mirrorSock LOG error datanode block mirrorNode e e LOG info datanode block mirrorNode e
IOUtils closeStream mirrorOut mirrorOut IOUtils closeStream mirrorIn mirrorIn IOUtils closeSocket mirrorSock mirrorSock LOG error datanode block mirrorNode e e LOG info datanode block mirrorNode e incrDatanodeNetworkErrors LOG debug targets length firstBadLink
block BlockTokenIdentifier blockToken updateCurrentThreadName block DataOutputStream reply getBufferedOutputStream checkAccess reply block blockToken Op COPY_BLOCK BlockTokenIdentifier AccessMode COPY block String msg block getBlockId peer getRemoteAddressString
String msg block getBlockId peer getRemoteAddressString LOG info msg sendResponse ERROR msg BlockSender blockSender isOpSuccess blockSender BlockSender block datanode CachingStrategy newDropBehind OutputStream baseStream getOutputStream writeSuccessWithChecksumInfo blockSender reply beginRead Time monotonicNow read blockSender sendBlock reply baseStream dataXceiverServer balanceThrottler duration Time monotonicNow beginRead datanode metrics incrBytesRead read datanode metrics incrBlocksRead
BlockSender blockSender isOpSuccess blockSender BlockSender block datanode CachingStrategy newDropBehind OutputStream baseStream getOutputStream writeSuccessWithChecksumInfo blockSender reply beginRead Time monotonicNow read blockSender sendBlock reply baseStream dataXceiverServer balanceThrottler duration Time monotonicNow beginRead datanode metrics incrBytesRead read datanode metrics incrBlocksRead datanode metrics incrTotalReadTime duration LOG info block peer getRemoteAddressString
String msg block getBlockId peer getRemoteAddressString LOG warn msg sendResponse ERROR msg Socket proxySock DataOutputStream proxyOut Status opStatus SUCCESS String errMsg DataInputStream proxyReply IoeDuringCopyBlockOperation datanode ReplicaInfo oldReplica datanode data moveBlockAcrossStorage block storageType storageId oldReplica
Socket proxySock DataOutputStream proxyOut Status opStatus SUCCESS String errMsg DataInputStream proxyReply IoeDuringCopyBlockOperation proxySource datanode ReplicaInfo oldReplica datanode data moveBlockAcrossStorage block storageType storageId oldReplica LOG info block oldReplica getVolume getStorageType storageType block setNumBytes dataXceiverServer estimateBlockSize String dnAddr proxySource getXferAddr connectToDnViaHostname
DataEncryptionKeyFactory keyFactory datanode getDataEncryptionKeyFactoryForBlock block IOStreamPair saslStreams datanode saslClient socketSend proxySock unbufProxyOut unbufProxyIn keyFactory blockToken proxySource unbufProxyOut saslStreams out unbufProxyIn saslStreams in proxyOut DataOutputStream BufferedOutputStream unbufProxyOut smallBufferSize proxyReply DataInputStream BufferedInputStream unbufProxyIn ioFileBufferSize IoeDuringCopyBlockOperation Sender proxyOut copyBlock block blockToken IoeDuringCopyBlockOperation BlockOpResponseProto copyResponse BlockOpResponseProto parseFrom PBHelperClient vintPrefixed proxyReply String logInfo block proxySock getRemoteSocketAddress DataTransferProtoUtil checkBlockOpStatus copyResponse logInfo ReadOpChecksumInfoProto checksumInfo copyResponse getReadOpChecksumInfo DataChecksum remoteChecksum DataTransferProtoUtil fromProto checksumInfo getChecksum setCurrentBlockReceiver getBlockReceiver block storageType proxyReply proxySock getRemoteSocketAddress toString proxySock getLocalSocketAddress toString datanode remoteChecksum CachingStrategy newDropBehind storageId
blk checkAndWaitForBP blk
peer peerServer accept curXceiverCount datanode getXceiverCount curXceiverCount maxXceiverCount IOException curXceiverCount maxXceiverCount Daemon datanode threadGroup DataXceiver create peer datanode start ace datanode datanode LOG warn datanode getDisplayName ace IOException ie IOUtils closeQuietly peer LOG warn datanode getDisplayName ie ie IOUtils closeQuietly peer
Daemon datanode threadGroup DataXceiver create peer datanode start ace datanode datanode LOG warn datanode getDisplayName ace ie IOUtils closeQuietly peer LOG warn datanode getDisplayName ie ie IOUtils closeQuietly peer LOG error ie Thread sleep TimeUnit SECONDS toMillis
shouldRun set firstScanTime ThreadLocalRandom current nextLong scanPeriodMsecs
LOG warn masterThread masterThread shutdown reportCompileThreadPool reportCompileThreadPool shutdownNow masterThread masterThread awaitTermination TimeUnit MINUTES e LOG error e reportCompileThreadPool reportCompileThreadPool awaitTermination TimeUnit MINUTES e
info statsRecord duplicateBlocks addDifference diffRecord statsRecord info d d blockpoolReport ScanInfo nextInfo blockpoolReport get d nextInfo getBlockId info getBlockId m m m bl ReplicaInfo current bl get m addDifference diffRecord statsRecord current getBlockId current getVolume d blockpoolReport blockpoolReport get d getBlockId
volume volume ReportCompiler reportCompiler ReportCompiler volume Future ScanInfoVolumeReport result reportCompileThreadPool submit reportCompiler compilersInProgress add result Future ScanInfoVolumeReport future compilersInProgress ScanInfoVolumeReport result future get volReports result volReports clear ex LOG warn ex
lock lock needShutdown checkDiskBalancerEnabled
Preconditions checkState lock isHeldByCurrentThread workMap clear Map String String storageIDToVolBasePathMap getStorageIDToVolumeBasePathMap step String sourceVolUuid step getSourceVolume getUuid String destVolUuid step getDestinationVolume getUuid String sourceVolBasePath storageIDToVolBasePathMap get sourceVolUuid sourceVolBasePath String errMsg step getSourceVolume getPath
DiskBalancerException Preconditions checkState lock isHeldByCurrentThread workMap clear Map String String storageIDToVolBasePathMap getStorageIDToVolumeBasePathMap step String sourceVolUuid step getSourceVolume getUuid String destVolUuid step getDestinationVolume getUuid String sourceVolBasePath storageIDToVolBasePathMap get sourceVolUuid sourceVolBasePath String errMsg step getSourceVolume getPath LOG error errMsg DiskBalancerException errMsg DiskBalancerException Result INVALID_VOLUME String destVolBasePath storageIDToVolBasePathMap get destVolUuid destVolBasePath String errMsg step getDestinationVolume getPath
newGS oldGS getGenerationStamp File oldmeta getMetaFile setGenerationStamp newGS File newmeta getMetaFile
numBlockIters LOG debug Long MAX_VALUE curIdx curBlockIter curIdx curIdx blockIters indexOf curBlockIter Preconditions checkState curIdx nowMs Time now minTimeoutMs Long MAX_VALUE i i numBlockIters i idx curIdx i numBlockIters BlockIterator iter blockIters get idx iter
curIdx blockIters indexOf curBlockIter Preconditions checkState curIdx nowMs Time now minTimeoutMs Long MAX_VALUE i i numBlockIters i idx curIdx i numBlockIters BlockIterator iter blockIters get idx iter LOG info iter getBlockPoolId volume curBlockIter iter iterStartMs iter getIterStartMs waitMs iterStartMs conf scanPeriodMs nowMs waitMs
nowMs Time now minTimeoutMs Long MAX_VALUE i i numBlockIters i idx curIdx i numBlockIters BlockIterator iter blockIters get idx iter LOG info iter getBlockPoolId volume curBlockIter iter iterStartMs iter getIterStartMs waitMs iterStartMs conf scanPeriodMs nowMs waitMs iter rewind LOG info iter getBlockPoolId volume TimeUnit HOURS convert conf scanPeriodMs TimeUnit MILLISECONDS curBlockIter iter
ExtendedBlock cblock ExtendedBlock block Block b volume getDataset getStoredBlock cblock getBlockPoolId cblock getBlockId b
block curBlockIter nextBlock LOG warn curBlockIter block LOG info curBlockIter getBlockPoolId saveBlockIterator curBlockIter BlockLocalPathInfo blockLocalPathInfo volume getDataset getBlockLocalPathInfo block BasicFileAttributes attr Files readAttributes File blockLocalPathInfo getBlockPath toPath BasicFileAttributes attr
timeout findNextUsableBlockIter timeout LOG trace timeout stats stats nextBlockPoolScanStartMs Time monotonicNow timeout timeout stats stats scansSinceRestart stats blocksScannedInCurrentPeriod stats nextBlockPoolScanStartMs block getNextBlockToScan block
ExtendedBlock suspectBlock timeout LOG debug timeout wait timeout suspectBlock popNextSuspectBlock timeout runLoop suspectBlock LOG trace
LOG trace gap minDiskCheckGapMs Collections emptySet FsDatasetSpi FsVolumeReferences references dataset getFsVolumeReferences references size LOG warn Collections emptySet lastAllVolumesCheck timer monotonicNow Set FsVolumeSpi healthyVolumes HashSet Set FsVolumeSpi failedVolumes HashSet Set FsVolumeSpi allVolumes HashSet AtomicLong numVolumes AtomicLong references size CountDownLatch latch CountDownLatch i i references size i FsVolumeReference reference references getReference i Optional ListenableFuture VolumeCheckResult olf delegateChecker schedule reference getVolume IGNORED_CONTEXT
conf balancedSpaceThreshold conf getLongBytes DFS_DATANODE_AVAILABLE_SPACE_VOLUME_CHOOSING_POLICY_BALANCED_SPACE_THRESHOLD_KEY DFS_DATANODE_AVAILABLE_SPACE_VOLUME_CHOOSING_POLICY_BALANCED_SPACE_THRESHOLD_DEFAULT balancedPreferencePercent conf getFloat DFS_DATANODE_AVAILABLE_SPACE_VOLUME_CHOOSING_POLICY_BALANCED_SPACE_PREFERENCE_FRACTION_KEY DFS_DATANODE_AVAILABLE_SPACE_VOLUME_CHOOSING_POLICY_BALANCED_SPACE_PREFERENCE_FRACTION_DEFAULT
V V volumes replicaSize storageId AvailableSpaceVolumeList volumesWithSpaces AvailableSpaceVolumeList volumes volumesWithSpaces V volume roundRobinPolicyBalanced chooseVolume volumes replicaSize storageId
volumesWithSpaces V volume roundRobinPolicyBalanced chooseVolume volumes replicaSize storageId LOG LOG debug volume replicaSize volume V volume mostAvailableAmongLowVolumes volumesWithSpaces getMostAvailableSpaceAmongVolumesWithLowAvailableSpace List V highAvailableVolumes extractVolumesFromPairs volumesWithSpaces getVolumesWithHighAvailableSpace List V lowAvailableVolumes extractVolumesFromPairs volumesWithSpaces getVolumesWithLowAvailableSpace preferencePercentScaler highAvailableVolumes size balancedPreferencePercent lowAvailableVolumes size balancedPreferencePercent scaledPreferencePercent highAvailableVolumes size balancedPreferencePercent preferencePercentScaler mostAvailableAmongLowVolumes replicaSize scaledPreferencePercent volume roundRobinPolicyHighAvailable chooseVolume highAvailableVolumes replicaSize storageId LOG
volume V volume mostAvailableAmongLowVolumes volumesWithSpaces getMostAvailableSpaceAmongVolumesWithLowAvailableSpace List V highAvailableVolumes extractVolumesFromPairs volumesWithSpaces getVolumesWithHighAvailableSpace List V lowAvailableVolumes extractVolumesFromPairs volumesWithSpaces getVolumesWithLowAvailableSpace preferencePercentScaler highAvailableVolumes size balancedPreferencePercent lowAvailableVolumes size balancedPreferencePercent scaledPreferencePercent highAvailableVolumes size balancedPreferencePercent preferencePercentScaler mostAvailableAmongLowVolumes replicaSize scaledPreferencePercent volume roundRobinPolicyHighAvailable chooseVolume highAvailableVolumes replicaSize storageId LOG LOG debug volume replicaSize volume roundRobinPolicyLowAvailable chooseVolume lowAvailableVolumes replicaSize storageId LOG
ReplicaInfo ReplicaInfo replica1 ReplicaInfo replica2 ReplicaInfo replicaToKeep ReplicaInfo replicaToDelete replica1 replica2 replica1 getGenerationStamp replica2 getGenerationStamp replicaToKeep replica1 getGenerationStamp replica2 getGenerationStamp replica1 replica2 replica1 getNumBytes replica2 getNumBytes replicaToKeep replica1 getNumBytes replica2 getNumBytes replica1 replica2 replica1 replica2 replicaToKeep replica2 replicaToKeep replica1 replicaToDelete replicaToKeep replica1 replica2 replica1
ReplicaMap ReplicaMap tmpReplicaMap ReplicaMap ReentrantReadWriteLock File replicaFile File replicaCacheDir REPLICA_CACHE_FILE replicaFile
FileInputStream inputStream inputStream fileIoProvider getFileInputStream volume replicaFile BlockListAsLongs blocksList BlockListAsLongs readFrom inputStream maxDataLength blocksList blocksList ReplicaInfo iter iter ReplicaInfo info iter next
inputStream fileIoProvider getFileInputStream volume replicaFile BlockListAsLongs blocksList BlockListAsLongs readFrom inputStream maxDataLength blocksList blocksList ReplicaInfo iter bpid iter ReplicaInfo info iter next iter remove volumeMap add bpid info
ReplicaInfo iter bpid iter ReplicaInfo info iter next iter remove volumeMap add bpid info LOG info replicaFile getPath e LOG info replicaFile getPath e
blockId bpid ExtendedBlockId key ExtendedBlockId blockId bpid Value prevValue mappableBlockMap get key prevValue
Value prevValue mappableBlockMap get key deferred key deferred prevValue LOG debug blockId bpid numBlocksFailedToUncache incrementAndGet prevValue LOG debug blockId bpid mappableBlockMap put key Value prevValue mappableBlock State CACHING_CANCELLED mappableBlockMap put key Value prevValue mappableBlock State deferred LOG
deferred prevValue LOG debug blockId bpid numBlocksFailedToUncache incrementAndGet prevValue LOG debug blockId bpid mappableBlockMap put key Value prevValue mappableBlock State CACHING_CANCELLED mappableBlockMap put key Value prevValue mappableBlock State deferred LOG LOG debug key DurationFormatUtils formatDurationHMS revocationPollingMs deferredUncachingExecutor schedule UncachingTask key revocationMs revocationPollingMs TimeUnit MILLISECONDS
sd DatanodeStorage dnStorage storageMap get sd getStorageUuid dnStorage String errorMsg String format sd getStorageUuid sd getVersionFile
sd StorageLocation storageLocation sd getStorageLocation FsVolumeImpl fsVolume FsVolumeImplBuilder setDataset setStorageID sd getStorageUuid setStorageDirectory sd setFileIoProvider datanode getFileIoProvider setConf conf build FsVolumeReference ref fsVolume obtainReference ReplicaMap tempVolumeMap ReplicaMap datasetReadLock datasetWriteLock fsVolume getVolumeMap tempVolumeMap ramDiskReplicaTracker activateVolume tempVolumeMap sd storageLocation getStorageType ref
Collection StorageLocation storageLocsToRemove Collection StorageLocation storageLocationsToRemove ArrayList storageLocsToRemove Map String List ReplicaInfo blkToInvalidate HashMap List String storageToRemove ArrayList idx idx dataStorage idx Storage StorageDirectory sd dataStorage getStorageDir idx StorageLocation sdLocation sd getStorageLocation
Collection StorageLocation storageLocsToRemove Collection StorageLocation storageLocationsToRemove ArrayList storageLocsToRemove Map String List ReplicaInfo blkToInvalidate HashMap List String storageToRemove ArrayList idx idx dataStorage idx Storage StorageDirectory sd dataStorage getStorageDir idx StorageLocation sdLocation sd getStorageLocation LOG info sdLocation sd getStorageUuid storageLocationsToRemove sdLocation
computeChecksum srcReplica dstMeta smallBufferSize conf srcReplica copyMetadata dstMeta toURI IOException e IOException srcReplica dstMeta e srcReplica copyBlockdata dstFile toURI IOException e IOException srcReplica dstFile e LOG LOG debug srcReplica getMetadataURI dstMeta
b startTimeMs Time monotonicNow blockId b getBlockId expectedGs b getGenerationStamp visible b getNumBytes
streams checksumSize FileOutputStream file FileOutputStream streams getChecksumOut FileChannel channel file getChannel oldPos channel position newPos oldPos checksumSize
errors add invalidBlks i Block toString infoByBlockId v FsVolumeImpl info getVolume v errors add invalidBlks i info File blockFile File info getBlockURI blockFile blockFile errors add invalidBlks i blockFile LOG warn info removing volumeMap remove bpid invalidBlks i addDeletingBlock bpid removing getBlockId
bpid map block ReplicaInfo replica map get bpid block getBlockId
rip MustStopExistingWriter rip replica replica IOException replica checkReplicaFiles replica replica block IOException block replica replica recoveryId IOException recoveryId block replica ReplicaInfo rur replica rur replica rur getRecoveryID recoveryId RecoveryInProgressException recoveryId block rur oldRecoveryID rur getRecoveryID
IOException replica checkReplicaFiles replica replica block IOException block replica replica recoveryId IOException recoveryId block replica ReplicaInfo rur replica rur replica rur getRecoveryID recoveryId RecoveryInProgressException recoveryId block rur oldRecoveryID rur getRecoveryID rur setRecoveryID recoveryId LOG info block oldRecoveryID recoveryId
bpId blockId creationTime savedFiles targetVolume ramDiskReplicaTracker recordEndLazyPersist bpId blockId savedFiles targetVolume incDfsUsedAndNumBlocks bpId savedFiles length savedFiles length datanode getMetrics incrRamDiskBlocksLazyPersisted datanode getMetrics incrRamDiskBytesLazyPersisted savedFiles length datanode getMetrics addRamDiskBlocksLazyPersistWindowMs Time monotonicNow creationTime
length blockIn metaIn String blockFileName key IOException PmemMappedBlock mappableBlock String cachePath FileChannel blockChannel RandomAccessFile cacheFile blockChannel blockIn getChannel blockChannel IOException cachePath pmemVolumeManager getCachePath key cacheFile RandomAccessFile cachePath blockChannel transferTo length cacheFile getChannel cacheFile getChannel position verifyChecksum length metaIn cacheFile getChannel blockFileName mappableBlock PmemMappedBlock length key
blockChannel blockIn getChannel blockChannel IOException cachePath pmemVolumeManager getCachePath key cacheFile RandomAccessFile cachePath blockChannel transferTo length cacheFile getChannel cacheFile getChannel position verifyChecksum length metaIn cacheFile getChannel blockFileName mappableBlock PmemMappedBlock length key LOG info key cachePath length IOUtils closeQuietly blockChannel IOUtils closeQuietly cacheFile mappableBlock
MappableBlock cacheFile String bpid volumeIndex ExtendedBlockId key ExtendedBlockId getBlockId cacheFile bpid MappableBlock mappableBlock PmemMappedBlock cacheFile length key PmemVolumeManager getInstance recoverBlockKeyToVolume key volumeIndex String path PmemVolumeManager getInstance getCachePath key length mappableBlock getLength
String cacheFilePath cacheFilePath PmemVolumeManager getInstance getCachePath key FsDatasetUtil deleteMappedFile cacheFilePath
volumes n n volumes n File pmemDir File volumes n File realPmemDir verifyIfValidPmemVolume pmemDir cleanup realPmemDir pmemVolumes add realPmemDir getPath maxBytes maxBytesPerPmem maxBytes realPmemDir getUsableSpace maxBytes maxBytesPerPmem UsedBytesCount usedBytesCount UsedBytesCount maxBytes usedBytesCounts add usedBytesCount
File pmemDir File volumes n File realPmemDir verifyIfValidPmemVolume pmemDir cleanup realPmemDir pmemVolumes add realPmemDir getPath maxBytes maxBytesPerPmem maxBytes realPmemDir getUsableSpace maxBytes maxBytesPerPmem UsedBytesCount usedBytesCount UsedBytesCount maxBytes usedBytesCounts add usedBytesCount LOG info volumes n maxBytes
cleanup realPmemDir pmemVolumes add realPmemDir getPath maxBytes maxBytesPerPmem maxBytes realPmemDir getUsableSpace maxBytes maxBytesPerPmem UsedBytesCount usedBytesCount UsedBytesCount maxBytes usedBytesCounts add usedBytesCount LOG info volumes n maxBytes e LOG error volumes n e e
String prefix fullPath String prefixStr prefix toString String pathStr fullPath toString pathStr prefixStr
start Time monotonicNow dfsUsed count FsDatasetSpi fsDataset volume getDataset Collection ReplicaInfo replicaInfos Collection ReplicaInfo fsDataset deepCopyReplica bpid cost Time monotonicNow start cost
FsDatasetSpi fsDataset volume getDataset Collection ReplicaInfo replicaInfos Collection ReplicaInfo fsDataset deepCopyReplica bpid cost Time monotonicNow start cost LOG debug bpid replicaInfos size Time monotonicNow start replicaInfos ReplicaInfo replicaInfo replicaInfos replicaInfo volume dfsUsed replicaInfo getBytesOnDisk dfsUsed replicaInfo getMetadataLength count used set dfsUsed cost Time monotonicNow start cost
Collection ReplicaInfo replicaInfos Collection ReplicaInfo fsDataset deepCopyReplica bpid cost Time monotonicNow start cost LOG debug bpid replicaInfos size Time monotonicNow start replicaInfos ReplicaInfo replicaInfo replicaInfos replicaInfo getStorageID volume getStorageID dfsUsed replicaInfo getBytesOnDisk dfsUsed replicaInfo getMetadataLength count used set dfsUsed cost Time monotonicNow start cost LOG debug bpid count used volume getStorageID Time monotonicNow start
fsVolumeReferences dn getFSDataset getFsVolumeReferences Iterator FsVolumeSpi volumeIterator fsVolumeReferences iterator volumeIterator FsVolumeSpi volume volumeIterator next DataNodeVolumeMetrics metrics volume getMetrics String volumeName volume getBaseURI getPath metadataOpStats put volumeName metrics getMetadataOperationMean readIoStats put volumeName metrics getReadIoMean writeIoStats put volumeName metrics getWriteIoMean fsVolumeReferences fsVolumeReferences close
readIoStats put volumeName metrics getReadIoMean writeIoStats put volumeName metrics getWriteIoMean fsVolumeReferences fsVolumeReferences close e LOG error e metadataOpStats readIoStats writeIoStats LOG debug detectAndUpdateDiskOutliers metadataOpStats readIoStats writeIoStats Thread sleep detectionInterval e
p addLast HttpRequestEncoder Forwarder uri client ChannelFuture f proxiedServer connect host proxiedChannel f channel f ChannelFuture future future ctx channel pipeline remove HttpResponseEncoder HttpRequest newReq DefaultFullHttpRequest HTTP_1_1 req getMethod req getUri newReq headers add req headers newReq headers set CONNECTION Values CLOSE future channel writeAndFlush newReq DefaultHttpResponse resp DefaultHttpResponse HTTP_1_1 INTERNAL_SERVER_ERROR resp headers set CONNECTION Values CLOSE
exceptionCaught ctx cause releaseDfsResources DefaultHttpResponse resp ExceptionHandler exceptionCaught cause resp headers set CONNECTION CLOSE ctx writeAndFlush resp addListener ChannelFutureListener CLOSE
cmd String outputLine nodes String topVal cmd getOptionValue DiskBalancerCLI TOP topVal outputLine String format getDefaultTop
cmd LOG info Preconditions checkState cmd hasOption DiskBalancerCLI QUERY verifyCommandOptions DiskBalancerCLI QUERY cmd String nodeName cmd getOptionValue DiskBalancerCLI QUERY Preconditions checkNotNull nodeName nodeName nodeName trim String nodeAddress nodeName nodeName defaultIPC NetUtils createSocketAddr getConf getTrimmed DFSConfigKeys DFS_DATANODE_IPC_ADDRESS_KEY DFSConfigKeys DFS_DATANODE_IPC_ADDRESS_DEFAULT getPort nodeAddress nodeName defaultIPC
String nodeName cmd getOptionValue DiskBalancerCLI QUERY Preconditions checkNotNull nodeName nodeName nodeName trim String nodeAddress nodeName nodeName defaultIPC NetUtils createSocketAddr getConf getTrimmed DFSConfigKeys DFS_DATANODE_IPC_ADDRESS_KEY DFSConfigKeys DFS_DATANODE_IPC_ADDRESS_DEFAULT getPort nodeAddress nodeName defaultIPC LOG debug nodeAddress ClientDatanodeProtocol dataNode getDataNodeProxy nodeAddress DiskBalancerWorkStatus workStatus dataNode queryDiskBalancerPlan System out printf workStatus getPlanFile workStatus getPlanID workStatus getResult toString cmd DiskBalancerCLI System out printf workStatus currentStateString
clusterURI LOG debug clusterURI
Preconditions checkNotNull clusterURI String dataFilePath clusterURI getPath
getNodes Preconditions checkNotNull clusterURI String dataFilePath clusterURI getPath LOG info dataFilePath DiskBalancerCluster cluster READER readValue File dataFilePath String message String format cluster getNodes size
Preconditions checkNotNull clusterConnector
volume String errMessage String format volume getCapacity volume getReserved volume computeEffectiveCapacity volume getStorageType volume getUuid
NodePlan plan node startTime Time monotonicNow NodePlan plan NodePlan node getDataNodeName node getDataNodePort
Preconditions checkNotNull vSet Preconditions checkNotNull plan Preconditions checkNotNull node DiskBalancerVolumeSet currentSet DiskBalancerVolumeSet vSet currentSet removeSkipVolumes currentSet DiskBalancerVolume lowVolume currentSet getSortedQueue first DiskBalancerVolume highVolume currentSet getSortedQueue last Step nextStep lowVolume highVolume nextStep computeMove currentSet lowVolume highVolume LOG debug lowVolume getPath highVolume getPath applyStep nextStep currentSet lowVolume highVolume nextStep
currentSet lowVolume maxLowVolumeCanReceive currentSet getIdealUsed lowVolume computeEffectiveCapacity lowVolume getUsed maxLowVolumeCanReceive
currentSet volume String message String format volume getPath volume getStorageType currentSet getIdealUsed volume getCapacity volume getUsed
queue String format String format queue first getPath queue first getVolumeDataDensity queue last getPath queue last getVolumeDataDensity
String node GREEDY_PLANNER String message String format GREEDY_PLANNER node getDataNodeName node getDataNodeIP node getDataNodeUUID
Map conf sleeptime conf getTimeDuration DFSConfigKeys DFS_HEARTBEAT_INTERVAL_KEY DFSConfigKeys DFS_HEARTBEAT_INTERVAL_DEFAULT TimeUnit SECONDS TimeUnit MILLISECONDS conf getTimeDuration DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_KEY DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_DEFAULT TimeUnit SECONDS TimeUnit MILLISECONDS AtomicInteger retryCount AtomicInteger Map Long Set DatanodeInfo excludedPinnedBlocks HashMap
NamenodeRegistration nnReg nnReg namenode registerSubordinateNamenode getRegistration e LOG info nnRpcAddress Thread sleep LOG warn e String msg nnReg msg nnRpcAddress nnReg msg nnRpcAddress
conf shouldRun checkpointConf CheckpointConf conf String fullInfoAddr conf get DFS_NAMENODE_BACKUP_HTTP_ADDRESS_KEY DFS_NAMENODE_BACKUP_HTTP_ADDRESS_DEFAULT infoBindAddress fullInfoAddr substring fullInfoAddr indexOf LOG info checkpointConf getPeriod checkpointConf getPeriod
now monotonicNow shouldCheckpoint now lastCheckpointTime shouldCheckpoint now lastEditLogCheckTime txns countUncheckpointedTxns lastEditLogCheckTime now txns checkpointConf getTxnCount shouldCheckpoint shouldCheckpoint doCheckpoint lastCheckpointTime now lastEditLogCheckTime now
now monotonicNow shouldCheckpoint now lastCheckpointTime shouldCheckpoint now lastEditLogCheckTime txns countUncheckpointedTxns lastEditLogCheckTime now txns checkpointConf getTxnCount shouldCheckpoint shouldCheckpoint doCheckpoint lastCheckpointTime now lastEditLogCheckTime now e LOG error e
NNStorage bnStorage bnImage getStorage startTime monotonicNow bnImage freezeNamespaceAtNextRoll NamenodeCommand cmd getRemoteNamenodeProxy startCheckpoint backupNode getRegistration CheckpointCommand cpCmd cmd IOException backupNode nnRpcAddress cpCmd CheckpointCommand cmd IOException cmd bnImage waitUntilNamespaceFrozen CheckpointSignature sig cpCmd getSignature sig validateStorageInfo bnImage lastApplied bnImage getLastAppliedTxId
IOException backupNode nnRpcAddress cpCmd IOException bnImage waitUntilNamespaceFrozen CheckpointSignature sig cpCmd getSignature sig validateStorageInfo bnImage lastApplied bnImage getLastAppliedTxId LOG debug lastApplied RemoteEditLogManifest manifest getRemoteNamenodeProxy getEditLogManifest bnImage getLastAppliedTxId needReloadImage manifest getLogs RemoteEditLog firstRemoteLog manifest getLogs get firstRemoteLog lastApplied
LOG debug lastApplied RemoteEditLogManifest manifest getRemoteNamenodeProxy getEditLogManifest bnImage getLastAppliedTxId needReloadImage manifest getLogs RemoteEditLog firstRemoteLog manifest getLogs get firstRemoteLog lastApplied LOG info sig mostRecentCheckpointTxId MD5Hash downloadedHash TransferFsImage downloadImageToStorage backupNode nnHttpAddress sig mostRecentCheckpointTxId bnStorage bnImage saveDigestAndRenameCheckpointImage NameNodeFile IMAGE sig mostRecentCheckpointTxId downloadedHash lastApplied sig mostRecentCheckpointTxId needReloadImage firstRemoteLog lastApplied IOException lastApplied RemoteEditLog log manifest getLogs TransferFsImage downloadEditsToStorage backupNode nnHttpAddress log bnStorage
init e LOG error e skipBrokenEdits Throwables propagateIfPossible e IOException Preconditions checkState state State UNINIT nextOpImpl skipBrokenEdits op skipBrokenEdits op op txId op getTransactionId txId skipAmt log length tracker getPos skipAmt LOG
size fc size bufSize doubleBuf getReadyBuf getLength need bufSize size position need oldSize size total fillCapacity fill capacity need fill position IOUtils writeFully fc fill size need fillCapacity size fillCapacity total fillCapacity
initThreads writeLock threads initThreads initThreads
initThreads writeLock threads initThreads initThreads LOG info threads start Time monotonicNow QuotaCounts counts QuotaCounts Builder build ForkJoinPool p ForkJoinPool threads RecursiveAction task InitQuotaTask getBlockStoragePolicySuite rootDir getStoragePolicyID rootDir counts p execute task task join p shutdown
conf asyncEditLogging conf getBoolean DFSConfigKeys DFS_NAMENODE_EDITS_ASYNC_LOGGING DFSConfigKeys DFS_NAMENODE_EDITS_ASYNC_LOGGING_DEFAULT
lastWrittenTxId getLastWrittenTxId
lastWrittenTxId getLastWrittenTxId LOG info lastWrittenTxId synctxid txid logSync lastWrittenTxId lastWrittenTxId getLastWrittenTxId
wait synctxid editsBatchedInSync txid synctxid syncStart txid isSyncRunning sync IOException editLogStream setReadyToFlush IOException e String msg e getMessage txid synctxid
journalSet IOException editLogStream setReadyToFlush IOException e String msg e getMessage txid synctxid LOG error msg Exception IOUtils cleanupWithLogger LOG journalSet terminate msg doneWithAutoSyncScheduling logStream editLogStream start monotonicNow logStream
bnReg bnReg isRole NamenodeRole CHECKPOINT JournalManager jas findBackupJournal bnReg jas
registration BackupJournalManager bjm findBackupJournal registration bjm
Edit edit THREAD_EDIT get edit THREAD_EDIT set
t String message t getMessage
fsn fileCount fsn getFilesTotal Preconditions checkState fileCount fileCount NamespaceInfo ns NNStorage newNamespaceInfo
StorageDirectory it it StorageDirectory sd it next sd prevState getStorage HdfsServerConstants NAMENODE_LAYOUT_VERSION LOG info sd canRollback editLog initJournalsForWrite canRollBackSharedEditLog editLog canRollBackSharedLog prevState getStorage HdfsServerConstants NAMENODE_LAYOUT_VERSION canRollBackSharedEditLog LOG info canRollback canRollback IOException StorageDirectory it it StorageDirectory sd it next
target target clear
editStreams FSImagePreTransactionalStorageInspector getEditLogStreams storage maxOpSize conf getInt DFSConfigKeys DFS_NAMENODE_MAX_OP_SIZE_KEY DFSConfigKeys DFS_NAMENODE_MAX_OP_SIZE_DEFAULT elis editStreams elis setMaxOpSize maxOpSize l editStreams LOG debug l editStreams LOG info FSImageFile imageFile i i imageFiles i imageFile imageFiles get i loadFSImageFile target recovery imageFile startOpt
context sd NameNodeFile dstType txid context getTxId File newFile NNStorage getStorageFile sd NameNodeFile IMAGE_NEW txid File dstFile NNStorage getStorageFile sd dstType txid FSImageFormatProtobuf Saver saver FSImageFormatProtobuf Saver context conf FSImageCompression compression FSImageCompression createCompression conf numErrors saver save newFile compression numErrors
sd fromNnf toNnf txid File fromFile NNStorage getStorageFile sd fromNnf txid File toFile NNStorage getStorageFile sd toNnf txid
bnReg LOG info getEditLog getLastWrittenTxId String msg bnReg getNamespaceID storage getNamespaceID msg bnReg getAddress bnReg getNamespaceID storage getNamespaceID bnReg msg bnReg getAddress bnReg bnReg storage bnReg storage bnReg storage msg bnReg getAddress bnReg bnReg storage storage msg
String renameReserved Collection String pairs StringUtils getTrimmedStringCollection renameReserved String p pairs String pair StringUtils split p Preconditions checkArgument pair length p String key pair String value pair Preconditions checkArgument DFSUtil isReservedPathComponent key key Preconditions checkArgument DFSUtil isValidNameForComponent value key value
String String path layoutVersion String oldPath path layoutVersion String components INode getPathNames path components components DFSUtil bytes2String renameReservedRootComponentOnUpgrade DFSUtil string2Bytes components layoutVersion path DFSUtil strings2PathString components layoutVersion String components INode getPathNames path components path i i components i components i DFSUtil bytes2String renameReservedComponentOnUpgrade DFSUtil string2Bytes components i layoutVersion path DFSUtil strings2PathString components path oldPath
IOException latestNameSD IOException imageDirs latestEditsSD IOException editsDirs latestNameSD latestEditsSD latestNameSD latestEditsSD LOG error
needToSave maxSeenTxId Math max maxSeenTxId NNStorage readTransactionIdFile sd ioe LOG warn sd ioe File currentDir sd getCurrentDir File filesInStorage filesInStorage FileUtil listFiles currentDir ioe LOG warn currentDir ioe File filesInStorage
File currentDir sd getCurrentDir File filesInStorage filesInStorage FileUtil listFiles currentDir ioe LOG warn currentDir ioe File f filesInStorage LOG debug f String name f getName Matcher imageMatch matchPattern name imageMatch sd txid Long parseLong imageMatch group
FSNamesystem conf checkConfiguration conf FSImage fsImage FSImage conf FSNamesystem getNamespaceDirs conf FSNamesystem getNamespaceEditsDirs conf FSNamesystem namesystem FSNamesystem conf fsImage StartupOption startOpt NameNode getStartupOption conf startOpt StartupOption namesystem setSafeMode SafeModeAction SAFEMODE_ENTER loadStart monotonicNow namesystem loadFSImage startOpt ioe LOG warn ioe fsImage close ioe timeTakenToLoadFSImage monotonicNow loadStart
conf enable conf getBoolean DFS_NAMENODE_ENABLE_RETRY_CACHE_KEY DFS_NAMENODE_ENABLE_RETRY_CACHE_DEFAULT
conf enable conf getBoolean DFS_NAMENODE_ENABLE_RETRY_CACHE_KEY DFS_NAMENODE_ENABLE_RETRY_CACHE_DEFAULT LOG info enable enable heapPercent conf getFloat DFS_NAMENODE_RETRY_CACHE_HEAP_PERCENT_KEY DFS_NAMENODE_RETRY_CACHE_HEAP_PERCENT_DEFAULT entryExpiryMillis conf getLong DFS_NAMENODE_RETRY_CACHE_EXPIRYTIME_MILLIS_KEY DFS_NAMENODE_RETRY_CACHE_EXPIRYTIME_MILLIS_DEFAULT
List AuditLogger auditLoggers Lists newArrayList topAuditLoggerAdded className AuditLogger logger className logger FSNamesystemAuditLogger logger AuditLogger Class forName className newInstance logger topAuditLoggerAdded logger initialize conf auditLoggers add logger
editLog initJournalsForWrite editLog recoverUnclosedStreams LOG info editLogTailer catchupDuringFailover blockManager setPostponeBlocksFromFuture blockManager getDatanodeManager markAllDatanodesStale blockManager clearQueues blockManager processAllPendingDNMessages blockManager getBlockIdManager applyImpendingGenerationStamp LOG info blockManager initializeReplQueues LOG LOG debug metaSaveAsString nextTxId getFSImage getLastAppliedTxId
HAServiceState curState getState OBSERVER OBSERVER STANDBY
CryptoProtocolVersion zone CryptoProtocolVersion supportedVersions Preconditions checkNotNull zone Preconditions checkNotNull supportedVersions CryptoProtocolVersion required zone getVersion CryptoProtocolVersion supportedVersions CryptoProtocolVersion
String allowCommittedBlock blocks n allowCommittedBlock numCommittedAllowed i i blocks i min blockManager getMinStorageNum blocks i String err INodeFile checkBlockComplete blocks i n min err numNodes blocks i numNodes
ExtendedBlock oldBlock newgenerationstamp newlength closeFile deleteblock newtargets String LOG info oldBlock newgenerationstamp newlength Arrays asList newtargets closeFile deleteblock checkOperation OperationCategory WRITE String src writeLock copyTruncate BlockInfo truncatedBlock checkOperation OperationCategory WRITE checkNameNodeSafeMode BlockInfo storedBlock getStoredBlock ExtendedBlock getLocalBlock oldBlock storedBlock deleteblock
LOG debug oldBlock IOException oldBlock oldGenerationStamp storedBlock getGenerationStamp oldNumBytes storedBlock getNumBytes storedBlock IOException storedBlock INodeFile iFile getBlockCollection storedBlock src iFile getFullPathName iFile FileNotFoundException src iFile storedBlock iFile LOG
dsInfos i addBlock truncatedBlock truncatedBlock Block bi Block storedBlock storedBlock bi setBlockId bi getBlockId i dsInfos i addBlock storedBlock bi iFile convertLastBlockToUC truncatedBlock dsInfos iFile convertLastBlockToUC storedBlock dsInfos blockManager markBlockReplicasAsCorrupt oldBlock getLocalBlock storedBlock oldGenerationStamp oldNumBytes dsInfos closeFileCommitBlocks src iFile truncatedBlock
Block bi Block storedBlock storedBlock bi setBlockId bi getBlockId i dsInfos i addBlock storedBlock bi iFile convertLastBlockToUC truncatedBlock dsInfos iFile convertLastBlockToUC storedBlock dsInfos blockManager markBlockReplicasAsCorrupt oldBlock getLocalBlock storedBlock oldGenerationStamp oldNumBytes dsInfos closeFileCommitBlocks src iFile truncatedBlock iFile storedBlock
LinkedHashMap Integer HdfsPartialListing listings Maps newLinkedHashMap DirectoryListing lastListing numEntries srcsIndex srcs srcsIndex String src srcs srcsIndex HdfsPartialListing listing DirectoryListing dirListing getListingInt dir pc src indexStartAfter needLocation dirListing FileNotFoundException src listing HdfsPartialListing srcsIndex Lists newArrayList dirListing getPartialListing numEntries listing getPartialListing size lastListing dirListing
CheckpointSignature String operationName CheckpointSignature result checkSuperuserPrivilege operationName checkOperation OperationCategory JOURNAL writeLock checkOperation OperationCategory JOURNAL checkNameNodeSafeMode
checkOperation OperationCategory CHECKPOINT writeLock checkOperation OperationCategory CHECKPOINT checkNameNodeSafeMode
checkOperation OperationCategory CHECKPOINT readLock checkOperation OperationCategory CHECKPOINT checkNameNodeSafeMode
String String operationName checkOperation OperationCategory WRITE checkErasureCodingSupported operationName success
inode components i inode inode last components length String path getPath components last String preceding getPath components i String remainder getPath components i last String target inode asSymlink getSymlinkString String link inode getLocalName
firstTxId lastTxId File inprogressFile NNStorage getInProgressEditsFile sd firstTxId File dstFile NNStorage getFinalizedEditsFile sd firstTxId lastTxId
File currentDir sd getCurrentDir List EditLogFile allLogFiles matchEditLogs currentDir List EditLogFile toTrash Lists newArrayList
editsMatch startTxId Long parseLong editsMatch group endTxId Long parseLong editsMatch group ret add EditLogFile f startTxId endTxId LOG error f Matcher inProgressEditsMatch EDITS_INPROGRESS_REGEX matcher name inProgressEditsMatch startTxId Long parseLong inProgressEditsMatch group ret add EditLogFile f startTxId HdfsServerConstants INVALID_TXID
Matcher inProgressEditsMatch EDITS_INPROGRESS_REGEX matcher name inProgressEditsMatch startTxId Long parseLong inProgressEditsMatch group ret add EditLogFile f startTxId HdfsServerConstants INVALID_TXID LOG error f Matcher staleInprogressEditsMatch EDITS_INPROGRESS_STALE_REGEX matcher name staleInprogressEditsMatch startTxId Long parseLong staleInprogressEditsMatch group ret add EditLogFile f startTxId HdfsServerConstants INVALID_TXID
List EditLogFile elfs matchEditLogs sd getCurrentDir
File currentDir sd getCurrentDir
List EditLogFile allLogFiles matchEditLogs currentDir EditLogFile elf allLogFiles elf getFile elf elf getFile LOG info elf elf getFile IOException elf getFile elf scanLog getLastReadableTxId elf elf moveAsideCorruptFile CorruptionException elf elf
run conf errorCount initCount errorCount get LOG info Util memoryInfo initConf conf FSNamesystem namesystem checkINodeReference conf errorCount INodeMapValidation run namesystem getFSDirectory errorCount
FSNamesystem conf errorCount INodeReferenceValidation start FSNamesystem namesystem loadImage conf LOG info Util memoryInfo INodeReferenceValidation end errorCount
Set String validRequestors HashSet String validRequestors add SecurityUtil getServerPrincipal conf get DFSConfigKeys DFS_NAMENODE_KERBEROS_PRINCIPAL_KEY DFSUtilClient getNNAddress conf getHostName validRequestors add SecurityUtil getServerPrincipal conf get DFSConfigKeys DFS_SECONDARY_NAMENODE_KERBEROS_PRINCIPAL_KEY SecondaryNameNode getHttpAddress conf getHostName e LOG debug e String msg String format DFSConfigKeys DFS_SECONDARY_NAMENODE_KERBEROS_PRINCIPAL_KEY conf get DFSConfigKeys DFS_SECONDARY_NAMENODE_KERBEROS_PRINCIPAL_KEY DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_KEY conf getTrimmed DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_KEY DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_DEFAULT LOG warn msg HAUtil conf conf List Configuration otherNnConfs HAUtil getConfForOtherNodes conf Configuration otherNnConf otherNnConfs validRequestors add SecurityUtil getServerPrincipal otherNnConf get DFSConfigKeys DFS_NAMENODE_KERBEROS_PRINCIPAL_KEY DFSUtilClient getNNAddress otherNnConf getHostName String validRequestors
validRequestors add SecurityUtil getServerPrincipal conf get DFSConfigKeys DFS_NAMENODE_KERBEROS_PRINCIPAL_KEY DFSUtilClient getNNAddress conf getHostName validRequestors add SecurityUtil getServerPrincipal conf get DFSConfigKeys DFS_SECONDARY_NAMENODE_KERBEROS_PRINCIPAL_KEY SecondaryNameNode getHttpAddress conf getHostName e LOG debug e String msg String format DFSConfigKeys DFS_SECONDARY_NAMENODE_KERBEROS_PRINCIPAL_KEY conf get DFSConfigKeys DFS_SECONDARY_NAMENODE_KERBEROS_PRINCIPAL_KEY DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_KEY conf getTrimmed DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_KEY DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_DEFAULT LOG warn msg HAUtil conf conf List Configuration otherNnConfs HAUtil getConfForOtherNodes conf Configuration otherNnConf otherNnConfs validRequestors add SecurityUtil getServerPrincipal otherNnConf get DFSConfigKeys DFS_NAMENODE_KERBEROS_PRINCIPAL_KEY DFSUtilClient getNNAddress otherNnConf getHostName String validRequestors remoteUser LOG info remoteUser
e LOG debug e String msg String format DFSConfigKeys DFS_SECONDARY_NAMENODE_KERBEROS_PRINCIPAL_KEY conf get DFSConfigKeys DFS_SECONDARY_NAMENODE_KERBEROS_PRINCIPAL_KEY DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_KEY conf getTrimmed DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_KEY DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_DEFAULT LOG warn msg HAUtil conf conf List Configuration otherNnConfs HAUtil getConfForOtherNodes conf Configuration otherNnConf otherNnConfs validRequestors add SecurityUtil getServerPrincipal otherNnConf get DFSConfigKeys DFS_NAMENODE_KERBEROS_PRINCIPAL_KEY DFSUtilClient getNNAddress otherNnConf getHostName String validRequestors remoteUser LOG info remoteUser remoteUser LOG info remoteUser
response sendError HttpServletResponse SC_CONFLICT larger last response sendError HttpServletResponse SC_CONFLICT txid now System currentTimeMillis lastCheckpointTime nnImage getStorage getMostRecentCheckpointTime lastCheckpointTxid nnImage getStorage getMostRecentCheckpointTxId checkpointPeriod conf getTimeDuration DFS_NAMENODE_CHECKPOINT_PERIOD_KEY DFS_NAMENODE_CHECKPOINT_PERIOD_DEFAULT TimeUnit SECONDS checkpointPeriod Math round checkpointPeriod recentImageCheckTimePrecision checkpointTxnCount conf getLong DFS_NAMENODE_CHECKPOINT_TXNS_KEY DFS_NAMENODE_CHECKPOINT_TXNS_DEFAULT timeDelta TimeUnit MILLISECONDS toSeconds now lastCheckpointTime timeDelta checkpointPeriod txid lastCheckpointTxid checkpointTxnCount String message timeDelta checkpointPeriod txid lastCheckpointTxid checkpointTxnCount LOG info message
EditLogInputStream PriorityQueue EditLogInputStream allStreams PriorityQueue EditLogInputStream EDIT_LOG_INPUT_STREAM_COMPARATOR
jas closure apply jas t jas String msg status jas LOG error msg t abortAllJournals terminate msg LOG error status jas t badJAS add jas disableAndReportErrorOnJournals badJAS String message status
Map Long List RemoteEditLog logsByStartTxId HashMap input key RemoteEditLog GET_START_TXID apply input logsByStartTxId computeIfAbsent key k ArrayList add input curStartTxId fromTxId List RemoteEditLog logs ArrayList List RemoteEditLog logGroup logsByStartTxId getOrDefault curStartTxId Collections emptyList logGroup SortedSet Long startTxIds Sets newTreeSet logsByStartTxId keySet startTxIds startTxIds tailSet curStartTxId startTxIds
curStartTxId fromTxId List RemoteEditLog logs ArrayList List RemoteEditLog logGroup logsByStartTxId getOrDefault curStartTxId Collections emptyList logGroup SortedSet Long startTxIds Sets newTreeSet logsByStartTxId keySet startTxIds startTxIds tailSet curStartTxId startTxIds LOG LOG debug curStartTxId logs clear curStartTxId startTxIds first
inodeId leasesById remove inodeId inodeId
sd sd clearDirectory writeProperties sd writeTransactionIdFile sd
sd LOG error sd LOG String lsd listStorageDirectories
sd File prevDir sd getPreviousDir prevDir
sd File prevDir sd getPreviousDir prevDir
sd File prevDir sd getPreviousDir prevDir LOG info prevDir
httpServer setAliasMap levelDBAliasMapServer getAliasMap rpcServer start plugins conf getInstances DFS_NAMENODE_PLUGINS_KEY ServicePlugin e String pluginsValue conf get DFS_NAMENODE_PLUGINS_KEY LOG error pluginsValue e e ServicePlugin p plugins p start t LOG warn p t LOG info getRole getNameNodeAddress rpcServer
conf String nsId DFSUtil getNamenodeNameServiceId conf String namenodeId HAUtil getNameNodeId conf nsId initializeGenericKeys conf nsId namenodeId conf
fsns Collection URI sharedEditsDirs newSharedStorage conf Preconditions checkArgument sharedEditsDirs isEmpty List URI sharedEditsUris ArrayList URI sharedEditsDirs FSEditLog newSharedEditLog FSEditLog conf newSharedStorage sharedEditsUris newSharedEditLog initJournalsForWrite newSharedEditLog recoverUnclosedStreams FSEditLog sourceEditLog fsns getFSImage editLog fromTxId fsns getFSImage getMostRecentCheckpointTxId Collection EditLogInputStream streams streams sourceEditLog selectInputStreams fromTxId newSharedEditLog setNextTxId fromTxId EditLogInputStream streams
streams sourceEditLog selectInputStreams fromTxId newSharedEditLog setNextTxId fromTxId stream streams LOG debug stream FSEditLogOp op segmentOpen op stream LOG trace op segmentOpen newSharedEditLog startLogSegment op txid fsns getEffectiveLayoutVersion segmentOpen newSharedEditLog logEdit op op newSharedEditLog endCurrentLogSegment
stream LOG debug stream FSEditLogOp op segmentOpen op stream LOG trace op segmentOpen newSharedEditLog startLogSegment op txid fsns getEffectiveLayoutVersion segmentOpen newSharedEditLog logEdit op op newSharedEditLog endCurrentLogSegment LOG debug stream segmentOpen segmentOpen
startOpt StartupOption BACKUP StartupOption CHECKPOINT getName equalsIgnoreCase cmd startOpt StartupOption CHECKPOINT StartupOption OBSERVER getName equalsIgnoreCase cmd startOpt StartupOption OBSERVER StartupOption UPGRADE getName equalsIgnoreCase cmd StartupOption UPGRADEONLY getName equalsIgnoreCase cmd startOpt StartupOption UPGRADE getName equalsIgnoreCase cmd StartupOption UPGRADE StartupOption UPGRADEONLY i String flag args i flag equalsIgnoreCase StartupOption CLUSTERID getName i i startOpt setClusterId args i LOG error StartupOption CLUSTERID getName
LOG info Arrays asList argv conf conf HdfsConfiguration GenericOptionsParser hParser GenericOptionsParser conf argv argv hParser getRemainingArgs StartupOption startOpt parseArguments argv startOpt printUsage System err setStartupOption conf startOpt aborted startOpt aborted conf startOpt startOpt terminate aborted
registration checkNNStartup namesystem checkOperation OperationCategory UNCHECKED namesystem checkSuperuserPrivilege verifyRequest registration
String String String String checkNNStartup String clientMachine getClientMachine
String String checkNNStartup String clientMachine getClientMachine
checkNNStartup
checkNNStartup
checkNNStartup
checkNNStartup
checkNNStartup
checkNNStartup
checkNNStartup
nodeReg checkNNStartup verifyRequest nodeReg
nodeReg checkNNStartup verifyRequest nodeReg
nodeReg checkNNStartup verifyRequest nodeReg metrics incrBlockReceivedAndDeletedOps
nodeReg String checkNNStartup String dnName nodeReg nodeReg toString
String dnVersion dnReg getSoftwareVersion dnVersion minimumDataNodeVersion IncorrectVersionException ive IncorrectVersionException minimumDataNodeVersion dnVersion LOG warn ive getMessage dnReg ive String nnVersion VersionInfo getVersion dnVersion nnVersion String messagePrefix dnVersion dnReg nnVersion nnCTime nn getFSImage getStorage getCTime dnCTime dnReg getStorageInfo getCTime nnCTime dnCTime IncorrectVersionException ive IncorrectVersionException messagePrefix dnCTime nnCTime LOG warn ive toString ive ive
sb append UserGroupInformation getCurrentUser remoteAddress Date out println sb sb append String blk blk blk out println blk out print blockIdCK blk sb append blk LOG info sb toString namenode getNamesystem logFsckEvent remoteAddress out flush String msg UserGroupInformation getCurrentUser remoteAddress path Date
path namenode getRpcServer delete path
IOException target chain copyError LocatedBlock lBlk LocatedBlock lblock lBlk DatanodeInfo locs lblock getLocations locs locs fos fos flush fos close fos fos fos dfs create target chain chain
fos fos fos dfs create target chain chain copyBlock dfs lblock fos e LOG error lblock getBlock target e fos flush fos close fos internalError copyError copyError
deadNodes clear failures String file BlockReaderFactory getFileName targetAddr block getBlockPoolId block getBlockId BlockReaderFactory dfs file block block targetAddr dfs Peer addr blockToken datanodeId Peer peer Socket s NetUtils getDefaultSocketFactory conf createSocket s connect addr HdfsConstants READ_TIMEOUT s setSoTimeout HdfsConstants READ_TIMEOUT peer DFSUtilClient peerFromSocketAndKey dfs getSaslDataTransferClient s NamenodeFsck blockToken datanodeId HdfsConstants READ_TIMEOUT peer
op state State EOF streams curIdx getLastTxId prevTxId PrematureEOFException prevTxId streams curIdx getLastTxId prevTxId op getTransactionId op e prevException e state State STREAM_FAILED STREAM_FAILED curIdx streams prevException oldLast streams curIdx getLastTxId
LOG info zoneId getReencryptionStatus getReencryptionStatus markZoneStarted zoneId resetSubmissionTracker zoneId dir getFSNamesystem readUnlock reencryptEncryptionZone zoneId re LOG info re getReencryptionStatus markZoneForRetry zoneId ioe LOG warn zoneId ioe LOG info
Future ReencryptionTask completed batchService take throttle checkPauseForTesting completed LOG debug ReencryptionTask task completed get shouldRetry dir getFSNamesystem writeLock throttleTimerLocked start processTask task shouldRetry
shouldRun nameNodeAddr NameNode getServiceAddress conf conf conf namenode NameNodeProxies createNonHAProxy conf nameNodeAddr NamenodeProtocol UserGroupInformation getCurrentUser getProxy fsName getInfoServer checkpointDirs FSImage getCheckpointDirs conf checkpointEditsDirs FSImage getCheckpointEditsDirs conf checkpointImage CheckpointStorage conf checkpointDirs checkpointEditsDirs checkpointImage recoverCreate commandLineOpts shouldFormat checkpointImage deleteTempEdits namesystem FSNamesystem conf checkpointImage namesystem dir disableQuotaChecks checkpointConf CheckpointConf conf nameNodeStatusBeanName MBeans register legacyOivImageDir conf get DFSConfigKeys DFS_NAMENODE_LEGACY_OIV_IMAGE_DIR_KEY
Thread sleep period UserGroupInformation isSecurityEnabled UserGroupInformation getCurrentUser checkTGTAndReloginFromKeytab monotonicNow Time monotonicNow now Time now monotonicNow lastCheckpointTime doCheckpoint lastCheckpointTime monotonicNow lastCheckpointWallclockTime now
UserGroupInformation isSecurityEnabled UserGroupInformation getCurrentUser checkTGTAndReloginFromKeytab monotonicNow Time monotonicNow now Time now monotonicNow lastCheckpointTime doCheckpoint lastCheckpointTime monotonicNow lastCheckpointWallclockTime now e LOG error e e printStackTrace
UserGroupInformation isSecurityEnabled UserGroupInformation getCurrentUser checkTGTAndReloginFromKeytab monotonicNow Time monotonicNow now Time now monotonicNow lastCheckpointTime doCheckpoint lastCheckpointTime monotonicNow lastCheckpointWallclockTime now e LOG error e e printStackTrace checkpointImage getMergeErrorCount LOG error checkpointImage getMergeErrorCount
doCheckpoint System err println count checkpointConf getTxnCount System err println uncheckpointed System out println uncheckpointed e exitCode String content content e getLocalizedMessage split LOG error cmd content
System err println count checkpointConf getTxnCount System err println uncheckpointed System out println uncheckpointed e exitCode String content content e getLocalizedMessage split LOG error cmd content ex LOG error cmd ex getLocalizedMessage
fsName aliasMap isBootstrapStandby String paramString ImageServlet getParamStringForAliasMap isBootstrapStandby getFileClient fsName paramString Arrays asList aliasMap
LOG warn buf out write buf num total num throttler throttler throttle num canceler e reportStr ioe e out ie ioe ie ie
LOG warn buf out write buf num total num throttler throttler throttle num canceler e reportStr ioe e out ie ioe ie ie reportStr total num
URL infoServer queryString URL url URL infoServer ImageServlet PATH_SPEC queryString
timeout Configuration conf HdfsConfiguration timeout conf getInt DFSConfigKeys DFS_IMAGE_TRANSFER_TIMEOUT_KEY DFSConfigKeys DFS_IMAGE_TRANSFER_TIMEOUT_DEFAULT
NamenodeProtocol proxy NamespaceInfo nsInfo isUpgradeFinalized RemoteNameNodeInfo proxyInfo i i remoteNNs i proxyInfo remoteNNs get i InetSocketAddress otherIpcAddress proxyInfo getIpcAddress proxy createNNProtocolProxy otherIpcAddress nsInfo proxy versionRequest isUpgradeFinalized proxy isUpgradeFinalized ioe LOG warn otherIpcAddress ioe getMessage LOG
isUpgradeFinalized RemoteNameNodeInfo proxyInfo i i remoteNNs i proxyInfo remoteNNs get i InetSocketAddress otherIpcAddress proxyInfo getIpcAddress proxy createNNProtocolProxy otherIpcAddress nsInfo proxy versionRequest isUpgradeFinalized proxy isUpgradeFinalized ioe LOG warn otherIpcAddress ioe getMessage LOG LOG debug ioe nsInfo
proxyInfo remoteNNs get i InetSocketAddress otherIpcAddress proxyInfo getIpcAddress proxy createNNProtocolProxy otherIpcAddress nsInfo proxy versionRequest isUpgradeFinalized proxy isUpgradeFinalized ioe LOG warn otherIpcAddress ioe getMessage LOG LOG debug ioe nsInfo LOG error remoteNNs ERR_CODE_FAILED_CONNECT nsInfo
isFormatted System err println e LOG warn e storage unlockAll isFormatted storage FSImage checkUpgrade storage StorageDirectory it storage it StorageDirectory sd it next NNUpgradeUtil renameCurToTmp sd e
Configuration conf getConf nsId DFSUtil getNamenodeNameServiceId conf HAUtil conf nsId HadoopIllegalArgumentException nnId HAUtil getNameNodeId conf nsId NameNode initializeGenericKeys conf nsId nnId HAUtil conf HadoopIllegalArgumentException remoteNNs RemoteNameNodeInfo getRemoteNameNodes conf nsId List RemoteNameNodeInfo remove ArrayList RemoteNameNodeInfo remoteNNs size RemoteNameNodeInfo info remoteNNs InetSocketAddress address info getIpcAddress LOG info info getNameNodeID info getIpcAddress address address
namesystem writeLockInterruptibly FSImage image namesystem getFSImage lastTxnId image getLastAppliedTxId
FSImage image namesystem getFSImage lastTxnId image getLastAppliedTxId LOG LOG debug lastTxnId Collection EditLogInputStream streams startTime Time monotonicNow streams editLog selectInputStreams lastTxnId inProgressOk ioe LOG warn ioe NameNode getNameNodeMetrics addEditLogFetchTime Time monotonicNow startTime LOG
streams editLog selectInputStreams lastTxnId inProgressOk ioe LOG warn ioe NameNode getNameNodeMetrics addEditLogFetchTime Time monotonicNow startTime LOG LOG debug streams size editsLoaded editsLoaded image loadEdits streams namesystem maxTxnsPerLock elie editsLoaded elie getNumEditsLoaded elie
interval maxSkipLevels DirectoryDiffListFactory skipInterval interval DirectoryDiffListFactory maxLevels maxSkipLevels maxLevels constructor c DiffListBySkipList c
String name Snapshot Root deleted namesystem readLock deleted namesystem getSnapshotManager chooseDeletedSnapshot e LOG error e e namesystem readUnlock deleted LOG trace name String snapshotRoot deleted getRootFullPathName String snapshotName deleted getLocalName
deleted namesystem getSnapshotManager chooseDeletedSnapshot e LOG error e e namesystem readUnlock deleted LOG trace name String snapshotRoot deleted getRootFullPathName String snapshotName deleted getLocalName LOG info name snapshotName snapshotRoot namesystem gcDeletedSnapshot snapshotRoot snapshotName e
blkLocs dn blkLocs foundDn dn getDatanodeInfo compareTo reportedDn foundType dn getStorageType equals type foundDn foundType blkLocs remove dn Block mFinishedBlocks Block mFinishedBlocks reportedBlock context notifyMovementTriedBlocks mFinishedBlocks blkLocs movementFinishedBlocks add reportedBlock scheduledBlkLocs remove reportedBlock
storageMovementAttemptedItems Iterator AttemptedItemInfo iter storageMovementAttemptedItems iterator now monotonicNow iter AttemptedItemInfo itemInfo iter next now itemInfo file itemInfo getFile ItemInfo candidate ItemInfo itemInfo getStartPath file itemInfo getRetryCount blockStorageMovementNeeded add candidate iter remove
now Time monotonicNow elapsedTimeMs now lastAccessedTime refreshNeeded elapsedTimeMs refreshIntervalMs lastAccessedTime now refreshNeeded
LOG LOG debug elapsedTimeMs refreshIntervalMs datanodeMap reset DatanodeStorageReport liveDns spsContext getLiveDatanodeStorageReport DatanodeStorageReport storage liveDns StorageReport storageReports storage getStorageReports List StorageType storageTypes ArrayList List Long remainingSizeList ArrayList StorageReport t storageReports t getRemaining storageTypes add t getStorage getStorageType remainingSizeList add t getRemaining datanodeMap addTarget storage getDatanodeInfo storageTypes remainingSizeList LOG
itemInfo blockMovementMaxRetry LOG info blockMovementMaxRetry itemInfo getFile storageMovementNeeded removeItemTrackInfo itemInfo trackId itemInfo getFile BlocksMovingAnalysis status BlockStoragePolicy existingStoragePolicy HdfsFileStatus fileStatus ctxt getFileInfo trackId fileStatus fileStatus storageMovementNeeded removeItemTrackInfo itemInfo existingStoragePolicyID fileStatus getStoragePolicy existingStoragePolicy ctxt getStoragePolicy existingStoragePolicyID HdfsLocatedFileStatus file HdfsLocatedFileStatus fileStatus status analyseBlocksStorageMovementsAndAssignToDN file existingStoragePolicy
trackId itemInfo getFile BlocksMovingAnalysis status BlockStoragePolicy existingStoragePolicy HdfsFileStatus fileStatus ctxt getFileInfo trackId fileStatus fileStatus storageMovementNeeded removeItemTrackInfo itemInfo existingStoragePolicyID fileStatus getStoragePolicy existingStoragePolicy ctxt getStoragePolicy existingStoragePolicyID HdfsLocatedFileStatus file HdfsLocatedFileStatus fileStatus status analyseBlocksStorageMovementsAndAssignToDN file existingStoragePolicy status status LOG LOG debug status status fileStatus getFileId storageMovementsMonitor add itemInfo getStartPath itemInfo getFile monotonicNow status assignedBlocks itemInfo getRetryCount
HdfsFileStatus fileStatus ctxt getFileInfo trackId fileStatus fileStatus storageMovementNeeded removeItemTrackInfo itemInfo existingStoragePolicyID fileStatus getStoragePolicy existingStoragePolicy ctxt getStoragePolicy existingStoragePolicyID HdfsLocatedFileStatus file HdfsLocatedFileStatus fileStatus status analyseBlocksStorageMovementsAndAssignToDN file existingStoragePolicy status status LOG LOG debug status status fileStatus getFileId storageMovementsMonitor add itemInfo getStartPath itemInfo getFile monotonicNow status assignedBlocks itemInfo getRetryCount LOG LOG debug trackId fileStatus getFileId
existingStoragePolicyID fileStatus getStoragePolicy existingStoragePolicy ctxt getStoragePolicy existingStoragePolicyID HdfsLocatedFileStatus file HdfsLocatedFileStatus fileStatus status analyseBlocksStorageMovementsAndAssignToDN file existingStoragePolicy status status LOG LOG debug status status fileStatus getFileId storageMovementsMonitor add itemInfo getStartPath itemInfo getFile monotonicNow status assignedBlocks itemInfo getRetryCount LOG LOG debug trackId fileStatus getFileId retryItem LOG
BlocksMovingAnalysis fileInfo BlocksMovingAnalysis Status status BlocksMovingAnalysis Status BLOCKS_ALREADY_SATISFIED ErasureCodingPolicy ecPolicy fileInfo getErasureCodingPolicy LocatedBlocks locatedBlocks fileInfo getLocatedBlocks lastBlkComplete locatedBlocks isLastBlockComplete lastBlkComplete
trackInfo scanCompleted storageMovementNeeded add trackInfo scanCompleted
LOG LOG debug mode newMode newMode mode newMode LOG info newMode spsService stopGracefully mode newMode LOG info newMode LOG info newMode spsService stop clearPathIds
size pathsToBeTraveresed size size
conf LOG info DFSConfigKeys NNTOP_BUCKETS_PER_WINDOW_KEY conf get DFSConfigKeys NNTOP_BUCKETS_PER_WINDOW_KEY
conf LOG info DFSConfigKeys NNTOP_BUCKETS_PER_WINDOW_KEY conf get DFSConfigKeys NNTOP_BUCKETS_PER_WINDOW_KEY LOG info DFSConfigKeys NNTOP_NUM_USERS_KEY conf get DFSConfigKeys NNTOP_NUM_USERS_KEY
TopWindow TopWindow window TopWindow windowLenMs Set String metricNames metricMap keySet
TopN time String rollingWindows TopN topN TopN topUsersCnt Iterator Map Entry String RollingWindow iterator rollingWindows entrySet iterator iterator Map Entry String RollingWindow entry iterator next String userName entry getKey RollingWindow aWindow entry getValue windowSum aWindow getSum time windowSum
fsn IOException BlockManager bm fsn getBlockManager HashSet Node excludes HashSet Node host idx host indexOf Node excludeNode idx excludeNode bm getDatanodeManager getDatanodeByXferAddr host substring idx Integer parseInt host substring idx excludeNode bm getDatanodeManager getDatanodeByHost host excludeNode excludes add excludeNode
conf conf HdfsConfiguration conf String nameNodePrincipal conf get DFSConfigKeys DFS_NAMENODE_KERBEROS_PRINCIPAL_KEY
UserGroupInformation ugi UserGroupInformation getCurrentUser UserGroupInformation zkfcUgi UserGroupInformation getLoginUser ugi ugi zkfcUgi
isThreadDumpCaptured httpTimeOut conf getInt DFSConfigKeys DFS_HA_ZKFC_NN_HTTP_TIMEOUT_KEY DFSConfigKeys DFS_HA_ZKFC_NN_HTTP_TIMEOUT_KEY_DEFAULT httpTimeOut String stacksUrl DFSUtil getInfoServer localNNTarget getAddress conf DFSUtil getHttpClientScheme conf URL url URL stacksUrl HttpURLConnection conn HttpURLConnection url openConnection conn setReadTimeout httpTimeOut conn setConnectTimeout httpTimeOut conn connect ByteArrayOutputStream out ByteArrayOutputStream IOUtils copyBytes conn getInputStream out StringBuilder localNNThreadDumpContent StringBuilder localNNThreadDumpContent append out append
conf token conf token token cancel conf
conf token conf token result token renew conf
conf fs renewer tokenFile Token token fs getDelegationToken renewer token Credentials cred Credentials cred addToken token getService token cred writeTokenStorageFile tokenFile conf Credentials SerializedFormat WRITABLE
conf conf HdfsConfiguration conf String nameNodePrincipal conf get DFSConfigKeys DFS_NAMENODE_KERBEROS_PRINCIPAL_KEY
visitor start inputStream getVersion FSEditLogOp op inputStream readOp op nextTxId nextTxId op getTransactionId nextTxId nextTxId op setTransactionId nextTxId nextTxId visitor visitOp op
nextTxId op getTransactionId nextTxId nextTxId op setTransactionId nextTxId nextTxId visitor visitOp op e LOG error inputStream getPosition visitor close e e LOG error e inputStream resync e
op setTransactionId nextTxId nextTxId visitor visitOp op e LOG error inputStream getPosition visitor close e e LOG error e inputStream resync e LOG error inputStream getPosition visitor close e e
content image path content image path content image path String names decoder String encoder getEncoder decoder content image getXAttrs path names encoder content image path content image path
ArrayList FsImageProto FileSummary Section sections Lists newArrayList summary getSectionsList sections FsImageProto FileSummary Section FsImageProto FileSummary Section s1 FsImageProto FileSummary Section s2 FSImageFormatProtobuf SectionName n1 FSImageFormatProtobuf SectionName fromString s1 getName FSImageFormatProtobuf SectionName n2 FSImageFormatProtobuf SectionName fromString s2 getName n1 n2 n2 n1 ordinal n2 ordinal FsImageProto FileSummary Section s sections fin getChannel position s getOffset InputStream is FSImageUtil wrapInputStreamForCompression conf summary getCodec BufferedInputStream LimitInputStream fin s getLength
in FsImageProto INodeSection s FsImageProto INodeSection parseDelimitedFrom in
in FsImageProto StringTableSection s FsImageProto StringTableSection parseDelimitedFrom in
IOException e IOException e Node version Node loadNodeChildren version Integer onDiskVersion version removeChildInt onDiskVersion IOException Integer layoutVersion version removeChildInt layoutVersion IOException layoutVersion NameNodeLayoutVersion CURRENT_LAYOUT_VERSION IOException NameNodeLayoutVersion CURRENT_LAYOUT_VERSION layoutVersion fileSummaryBld setOndiskVersion onDiskVersion fileSummaryBld setLayoutVersion layoutVersion
IOException ev asEndElement getName getLocalPart ev getEventType IOException ev getEventType String sectionName ev asStartElement getName getLocalPart unprocessedSections sectionName IOException sectionName SectionProcessor sectionProcessor sections get sectionName sectionProcessor IOException sectionName StringUtils join sections keySet unprocessedSections remove sectionName sectionProcessor process writeStringTableSection prevOffset out getCount FileSummary fileSummary fileSummaryBld build
DataInputStream in PositionTrackingInputStream tracker ImageLoader fsip done tracker PositionTrackingInputStream BufferedInputStream Files newInputStream Paths get inputFile in DataInputStream tracker imageVersionFile findImageVersion in fsip ImageLoader LoaderFactory getLoader imageVersionFile fsip IOException imageVersionFile fsip loadImage in processor skipBlocks done done tracker
refIdList corrChecker saveNodeRefIds refIdList
count LOG count LOG debug count parentId e getParent parentId LOG debug addCorruptedNode parentId numOfCorruption i i e i childId e getChildren i putDirChildToMetadataMap parentId childId childId addCorruptedNode childId numOfCorruption numOfCorruption
in INodeSection s INodeSection parseDelimitedFrom in LOG info AtomicInteger numDirs AtomicInteger s INode p INode parseDelimitedFrom in LOG
in INodeSection s INodeSection parseDelimitedFrom in
LOG info s getNumInodes ignored ignoredSnapshots s getNumInodes INode p INode parseDelimitedFrom in String parentPath metadataMap getParentPath p getId printIfNotEmpty getEntry parentPath p ioe ignored ioe LOG warn p getId ioe ignoredSnapshots LOG
ignoredSnapshots INode p INode parseDelimitedFrom in String parentPath metadataMap getParentPath p getId printIfNotEmpty getEntry parentPath p ioe ignored ioe LOG warn p getId ioe ignoredSnapshots LOG LOG debug p getId ioe LOG
File dataFile String digestString File md5File getDigestFileForFile dataFile String md5Line digestString dataFile getName AtomicFileOutputStream afos AtomicFileOutputStream md5File afos write md5Line getBytes Charsets UTF_8 afos close
sockDir TemporarySocketDirectory DomainSocket disableBindPathValidation prevCacheManipulator NativeIO POSIX getCacheManipulator NativeIO POSIX
block expectedOutstandingMmaps get MutableBoolean result MutableBoolean numOutstandingMmaps ExtendedBlockId ShortCircuitReplica replicas ExtendedBlockId Assert assertEquals expectedOutstandingMmaps numOutstandingMmaps ShortCircuitReplica replica replicas get ExtendedBlockId fromExtendedBlock block Assert assertNotNull replica Slot slot replica getSlot slot slot
NUM_OPENS Configuration conf Configuration conf setBoolean HdfsClientConfigKeys Read ShortCircuit KEY MiniDFSCluster cluster FSDataInputStream streams FSDataInputStream NUM_OPENS cluster MiniDFSCluster Builder conf build DistributedFileSystem dfs cluster getFileSystem Path TEST_PATH Path DFSTestUtil createFile dfs TEST_PATH i i NUM_OPENS i streams i dfs open TEST_PATH
Path sbExplicitTestDir Path Path sbOmittedTestDir Path hdfs mkdirs sbExplicitTestDir hdfs mkdirs sbOmittedTestDir assertTrue hdfs exists sbExplicitTestDir assertTrue hdfs exists sbOmittedTestDir hdfs setPermission sbExplicitTestDir FsPermission
Path sbExplicitTestDir Path Path sbOmittedTestDir Path hdfs mkdirs sbExplicitTestDir hdfs mkdirs sbOmittedTestDir assertTrue hdfs exists sbExplicitTestDir assertTrue hdfs exists sbOmittedTestDir hdfs setPermission sbExplicitTestDir FsPermission LOG info sbExplicitTestDir getName hdfs getFileStatus sbExplicitTestDir getPermission assertTrue hdfs getFileStatus sbExplicitTestDir getPermission getStickyBit hdfs setPermission sbOmittedTestDir FsPermission
Path sbExplicitTestDir Path Path sbOmittedTestDir Path hdfs mkdirs sbExplicitTestDir hdfs mkdirs sbOmittedTestDir assertTrue hdfs exists sbExplicitTestDir assertTrue hdfs exists sbOmittedTestDir hdfs setPermission sbExplicitTestDir FsPermission LOG info sbExplicitTestDir getName hdfs getFileStatus sbExplicitTestDir getPermission assertTrue hdfs getFileStatus sbExplicitTestDir getPermission getStickyBit hdfs setPermission sbOmittedTestDir FsPermission LOG info sbOmittedTestDir getName hdfs getFileStatus sbOmittedTestDir getPermission assertFalse hdfs getFileStatus sbOmittedTestDir getPermission getStickyBit hdfs setPermission sbExplicitTestDir FsPermission
hdfs mkdirs sbExplicitTestDir hdfs mkdirs sbOmittedTestDir assertTrue hdfs exists sbExplicitTestDir assertTrue hdfs exists sbOmittedTestDir hdfs setPermission sbExplicitTestDir FsPermission LOG info sbExplicitTestDir getName hdfs getFileStatus sbExplicitTestDir getPermission assertTrue hdfs getFileStatus sbExplicitTestDir getPermission getStickyBit hdfs setPermission sbOmittedTestDir FsPermission LOG info sbOmittedTestDir getName hdfs getFileStatus sbOmittedTestDir getPermission assertFalse hdfs getFileStatus sbOmittedTestDir getPermission getStickyBit hdfs setPermission sbExplicitTestDir FsPermission LOG info sbExplicitTestDir getName hdfs getFileStatus sbExplicitTestDir getPermission assertFalse hdfs getFileStatus sbExplicitTestDir getPermission getStickyBit hdfs setPermission sbOmittedTestDir FsPermission hdfs setPermission sbOmittedTestDir FsPermission
fsTarget createNewFile testBaseFile FSDataOutputStream dataOutputStream fsTarget append testBaseFile dataOutputStream write dataOutputStream close fsTarget createNewFile testLevel2File dataOutputStream fsTarget append testLevel2File dataOutputStream write toString getBytes dataOutputStream close String clusterName URI viewFsUri URI FsConstants VIEWFS_SCHEME clusterName Configuration conf Configuration ConfigUtil addLinkFallback conf clusterName fsTarget getUri FileSystem vfs FileSystem get viewFsUri conf assertEquals ViewFileSystem vfs getClass FileStatus baseFileStat vfs getFileStatus Path viewFsUri toString testBaseFile toUri toString
dataOutputStream write dataOutputStream close fsTarget createNewFile testLevel2File dataOutputStream fsTarget append testLevel2File dataOutputStream write toString getBytes dataOutputStream close String clusterName URI viewFsUri URI FsConstants VIEWFS_SCHEME clusterName Configuration conf Configuration ConfigUtil addLinkFallback conf clusterName fsTarget getUri FileSystem vfs FileSystem get viewFsUri conf assertEquals ViewFileSystem vfs getClass FileStatus baseFileStat vfs getFileStatus Path viewFsUri toString testBaseFile toUri toString LOG info baseFileStat FileStatus baseFileRelStat vfs getFileStatus Path viewFsUri toString testBaseFileRelative toUri toString
dataOutputStream write toString getBytes dataOutputStream close String clusterName URI viewFsUri URI FsConstants VIEWFS_SCHEME clusterName Configuration conf Configuration ConfigUtil addLinkFallback conf clusterName fsTarget getUri FileSystem vfs FileSystem get viewFsUri conf assertEquals ViewFileSystem vfs getClass FileStatus baseFileStat vfs getFileStatus Path viewFsUri toString testBaseFile toUri toString LOG info baseFileStat FileStatus baseFileRelStat vfs getFileStatus Path viewFsUri toString testBaseFileRelative toUri toString LOG info baseFileRelStat Assert assertEquals testBaseFile baseFileStat getLen Assert assertEquals testBaseFileRelative baseFileStat getLen baseFileRelStat getLen FileStatus level2FileStat vfs getFileStatus Path viewFsUri toString testLevel2File toUri toString
FSDataOutputStream dataOutputStream fsTarget append testLevel2File dataOutputStream write toString getBytes dataOutputStream close String clusterName URI viewFsUri URI FsConstants VIEWFS_SCHEME clusterName Configuration conf Configuration ConfigUtil addLink conf clusterName Path targetTestRoot toUri ConfigUtil addLink conf clusterName Path targetTestRoot toUri ConfigUtil addLink conf clusterName Path targetTestRoot toUri ConfigUtil addLink conf clusterName Path targetTestRoot toUri System out println fsTarget getUri ConfigUtil addLinkFallback conf clusterName targetTestRoot toUri FileSystem vfs FileSystem get viewFsUri conf assertEquals ViewFileSystem vfs getClass FileStatus baseFileStat vfs getFileStatus Path viewFsUri toString testBaseFile toUri toString
String clusterName URI viewFsUri URI FsConstants VIEWFS_SCHEME clusterName Configuration conf Configuration ConfigUtil addLink conf clusterName Path targetTestRoot toUri ConfigUtil addLink conf clusterName Path targetTestRoot toUri ConfigUtil addLink conf clusterName Path targetTestRoot toUri ConfigUtil addLink conf clusterName Path targetTestRoot toUri System out println fsTarget getUri ConfigUtil addLinkFallback conf clusterName targetTestRoot toUri FileSystem vfs FileSystem get viewFsUri conf assertEquals ViewFileSystem vfs getClass FileStatus baseFileStat vfs getFileStatus Path viewFsUri toString testBaseFile toUri toString LOG info baseFileStat Assert assertEquals testBaseFile baseFileStat getLen FileStatus level2FileStat vfs getFileStatus Path viewFsUri toString testLevel2File toUri toString
File infile File TEST_DIR testFileName content getBytes FileOutputStream fos fos FileOutputStream infile fos write content fos fos close assertEquals content length infile length Configuration conf Configuration ConfigUtil addLinkMergeSlash conf clusterName TEST_DIR toURI FileSystem vfs FileSystem get viewFsUri conf assertEquals ViewFileSystem vfs getClass FileStatus stat vfs getFileStatus Path viewFsUri toString testFileName
FSDataOutputStream fileSys name repl numOfBlocks FSDataOutputStream stm fileSys create name fileSys getConf getInt CommonConfigurationKeys IO_FILE_BUFFER_SIZE_KEY repl blockSize buffer blockSize numOfBlocks Random rand Random seed rand nextBytes buffer stm write buffer
state node done state node getAdminState done
fsd tries curCacheUsed fsd getCacheUsed curBlocks fsd getNumBlocksCached curCacheUsed curBlocks tries
HashSet Path Path FSDataOutputStream HashSet Path closedFiles HashSet Entry Path FSDataOutputStream it it Entry Path FSDataOutputStream entry it next
fs dir from to SnapshotDiffReport report fs getSnapshotDiffReport dir from to SnapshotDiffReport inverseReport fs getSnapshotDiffReport dir to from
fs dir from to SnapshotDiffReport report fs getSnapshotDiffReport dir from to SnapshotDiffReport inverseReport fs getSnapshotDiffReport dir to from LOG info report toString
maxOldFileLen BLOCK_SIZE maxFlushedBytes BLOCK_SIZE contents AppendTestUtil initBuffer maxOldFileLen maxFlushedBytes oldFileLen oldFileLen maxOldFileLen oldFileLen flushedBytes1 flushedBytes1 maxFlushedBytes flushedBytes1 flushedBytes2 flushedBytes2 maxFlushedBytes flushedBytes2 fileLen oldFileLen flushedBytes1 flushedBytes2 Path p Path oldFileLen flushedBytes1 flushedBytes2
LOG info
keepPort i i i restartDataNode i keepPort
testPath length LOG info testPath buffer length
dfs testPath length LOG info testPath buffer length LOG info testPath StripedFileTestUtil verifyLength dfs testPath length
dfs testPath length expected LOG info testPath buffer length LOG info testPath StripedFileTestUtil verifyLength dfs testPath length LOG info testPath StripedFileTestUtil verifyPread dfs testPath length expected buffer
dfs testPath length expected LOG info testPath buffer length LOG info testPath StripedFileTestUtil verifyLength dfs testPath length LOG info testPath StripedFileTestUtil verifyPread dfs testPath length expected buffer LOG info testPath StripedFileTestUtil verifyStatefulRead dfs testPath length expected buffer
dfs testPath length expected LOG info testPath buffer length LOG info testPath StripedFileTestUtil verifyLength dfs testPath length LOG info testPath StripedFileTestUtil verifyPread dfs testPath length expected buffer LOG info testPath StripedFileTestUtil verifyStatefulRead dfs testPath length expected buffer LOG info testPath StripedFileTestUtil verifyStatefulRead dfs testPath length expected ByteBuffer allocate length
fileLength dnFailureNum String fileType fileLength BLOCK_SIZE NUM_DATA_UNITS String src dnFailureNum fileType
LOG info srcPath recoverBlkNum dataBlkDelNum parityBlkDelNum LocatedBlocks locatedBlocks getLocatedBlocks dfs srcPath LocatedStripedBlock lastBlock LocatedStripedBlock locatedBlocks getLastLocatedBlock delDataBlkIndices StripedFileTestUtil randomArray NUM_DATA_UNITS dataBlkDelNum Assert assertNotNull delDataBlkIndices delParityBlkIndices StripedFileTestUtil randomArray NUM_DATA_UNITS NUM_DATA_UNITS NUM_PARITY_UNITS parityBlkDelNum Assert assertNotNull delParityBlkIndices delBlkIndices recoverBlkNum System arraycopy delDataBlkIndices delBlkIndices delDataBlkIndices length System arraycopy delParityBlkIndices delBlkIndices delDataBlkIndices length delParityBlkIndices length ExtendedBlock delBlocks ExtendedBlock recoverBlkNum i i recoverBlkNum i delBlocks i StripedBlockUtil constructInternalBlock lastBlock getBlock CELL_SIZE NUM_DATA_UNITS delBlkIndices i
LocatedStripedBlock lastBlock LocatedStripedBlock locatedBlocks getLastLocatedBlock delDataBlkIndices StripedFileTestUtil randomArray NUM_DATA_UNITS dataBlkDelNum Assert assertNotNull delDataBlkIndices delParityBlkIndices StripedFileTestUtil randomArray NUM_DATA_UNITS NUM_DATA_UNITS NUM_PARITY_UNITS parityBlkDelNum Assert assertNotNull delParityBlkIndices delBlkIndices recoverBlkNum System arraycopy delDataBlkIndices delBlkIndices delDataBlkIndices length System arraycopy delParityBlkIndices delBlkIndices delDataBlkIndices length delParityBlkIndices length ExtendedBlock delBlocks ExtendedBlock recoverBlkNum i i recoverBlkNum i delBlocks i StripedBlockUtil constructInternalBlock lastBlock getBlock CELL_SIZE NUM_DATA_UNITS delBlkIndices i LOG info delBlocks i cluster corruptBlockOnDataNodesByDeletingBlockFile delBlocks i
fs src numDeadDNs success ATTEMPTS count ErasureCodingPolicy ecPolicy fs getErasureCodingPolicy Path src success count LocatedBlocks lbs fs getClient getLocatedBlocks src lb lbs getLocatedBlocks expected getRealTotalBlockNum lb getBlockSize ecPolicy numDeadDNs reported lb getLocations length reported expected success
count ErasureCodingPolicy ecPolicy fs getErasureCodingPolicy Path src success count LocatedBlocks lbs fs getClient getLocatedBlocks src lb lbs getLocatedBlocks expected getRealTotalBlockNum lb getBlockSize ecPolicy numDeadDNs reported lb getLocations length reported expected success LOG info lb getBlock src reported expected Joiner on join lb getLocations Thread sleep success
List List LocatedBlock blockGroupList ArrayList LocatedBlocks lbs dfs getClient getLocatedBlocks srcPath toString Long MAX_VALUE length expectedNumGroup length blkGroupSize assertEquals expectedNumGroup lbs getLocatedBlocks size ErasureCodingPolicy ecPolicy dfs getErasureCodingPolicy srcPath cellSize ecPolicy getCellSize dataBlkNum ecPolicy getNumDataUnits parityBlkNum ecPolicy getNumParityUnits index LocatedBlock firstBlock lbs getLocatedBlocks Assert assertTrue firstBlock LocatedStripedBlock gs firstBlock getBlock getGenerationStamp oldGS oldGSList oldGSList get index String s gs oldGS
numCellInGroup groupSize cellSize lastCellIndex numCellInGroup dataBlkNum lastCellSize groupSize numCellInGroup cellSize List LocatedBlock blockList blockGroupList get group dataBlockBytes dataBlkNum parityBlockBytes parityBlkNum Set Integer checkSet HashSet i i blockList i j i dataBlkNum i numCellInBlock numCellInGroup dataBlkNum j lastCellIndex blockSize numCellInBlock cellSize isLastGroup j lastCellIndex lastCellSize cellSize blockBytes blockSize i dataBlkNum dataBlockBytes i blockBytes
checkErrorState
DFSOutputStream out DFSOutputStream fileSys append file getWrappedStream AtomicBoolean running AtomicBoolean AtomicBoolean failed AtomicBoolean Thread Thread running out write getBytes out hflush Thread sleep
Random r Random b oneWriteSize count r nextBytes b o write b count oneWriteSize o hflush assertTrue failed get DatanodeInfo newNodes dfsO getStreamer getNodes o close d DataNodeTestUtils triggerBlockReport d List DatanodeInfo pipelineList Arrays asList pipeline DatanodeInfo newNode
filePath repl DFSTestUtil createFile dfs filePath BLOCK_SIZE repl DFSTestUtil waitReplication dfs filePath repl LocatedBlocks locatedblocks dfs dfs getNamenode getBlockLocations filePath toString BLOCK_SIZE Assert assertEquals repl locatedblocks get getLocations length LocatedBlock lblock locatedblocks get DatanodeInfo datanodeinfos lblock getLocations ExtendedBlock block lblock getBlock i i i DatanodeInfo dninfo datanodeinfos i DataNode dn cluster getDataNode dninfo getIpcPort cluster corruptReplica dn block
String String outStr runFsck conf
String outStr runFsck conf
filePath errorCode String outStr runFsck conf errorCode filePath toString
in pos buffer offset length Assert assertTrue buffer length offset length pos in seek pos
HdfsConfiguration configuration HdfsConfiguration String contextName configuration set HdfsClientConfigKeys DFS_CLIENT_CONTEXT contextName configuration setLong HdfsClientConfigKeys DFS_CLIENT_SOCKET_TIMEOUT_KEY BlockReaderTestUtil util BlockReaderTestUtil configuration Path testFile Path authenticData util writeFile testFile FILE_SIZE DFSClient client DFSClient InetSocketAddress util getCluster getNameNodePort util getConf DFSInputStream in client open testFile toString
cluster MiniDFSCluster Builder conf numDataNodes numDataNodes build cluster waitActive FileSystem fs cluster getFileSystem util createFiles fs replFactor util waitReplication fs dnIdx DataNode dn cluster getDataNodes get dnIdx String bpid cluster getNamesystem getBlockPoolId List ReplicaInfo replicas dn getFSDataset getFinalizedBlocks bpid assertTrue replicas isEmpty idx idx replicas idx ReplicaInfo replica replicas get idx ExtendedBlock eb ExtendedBlock bpid replica idx
util createFiles fs replFactor util waitReplication fs dnIdx DataNode dn cluster getDataNodes get dnIdx String bpid cluster getNamesystem getBlockPoolId List ReplicaInfo replicas dn getFSDataset getFinalizedBlocks bpid assertTrue replicas isEmpty idx idx replicas idx ReplicaInfo replica replicas get idx ExtendedBlock eb ExtendedBlock bpid replica idx LOG info eb cluster deleteMeta dnIdx eb idx newSize
Path file Path src conf setInt DFSConfigKeys DFS_BLOCK_SIZE_KEY MiniDFSCluster cluster MiniDFSCluster Builder conf build cluster waitActive FileSystem fs cluster getFileSystem NamenodeProtocols preSpyNN cluster getNameNodeRpc NamenodeProtocols spyNN spy preSpyNN DFSClient client DFSClient spyNN conf ret LocatedBlocks lb cluster getNameNodeRpc getBlockLocations src Long MAX_VALUE assertEquals lb getLastLocatedBlock getBlock ret getBlock lb getLocatedBlocks size
blockCount getBlockCount ret LocatedBlock ret2 ret2 LocatedBlock invocation callRealMethod e AssertionError e blockCount2 getBlockCount ret2 assertEquals blockCount blockCount2 ret2 invocation LOG info invocation callRealMethod LOG info
s MultipleLinearRandomRetry r MultipleLinearRandomRetry parseCommaSeparatedString s
sendBufferSize getSendBufferSize Configuration
Configuration conf1 Configuration conf1 setInt DFS_CLIENT_SOCKET_SEND_BUFFER_SIZE_KEY sendBufferSize1 getSendBufferSize conf1 Configuration conf2 Configuration conf2 setInt DFS_CLIENT_SOCKET_SEND_BUFFER_SIZE_KEY sendBufferSize2 getSendBufferSize conf2
Configuration conf Configuration conf setInt DFS_CLIENT_SOCKET_SEND_BUFFER_SIZE_KEY sendBufferSize getSendBufferSize conf
client removeXAttr client setAcl AclEntry parseAclSpec client removeAcl client rename client truncate BLOCK_SIZE client create EventBatch batch batch waitForNextEvents eis Assert assertEquals batch getEvents length txid batch getTxid Assert assertTrue batch getEvents getEventType Event EventType RENAME Event RenameEvent re Event RenameEvent batch getEvents Assert assertEquals re getDstPath Assert assertEquals re getSrcPath Assert assertTrue re getTimestamp
Event RenameEvent re Event RenameEvent batch getEvents Assert assertEquals re getDstPath Assert assertEquals re getSrcPath Assert assertTrue re getTimestamp LOG info re toString Assert assertTrue re toString startsWith eventsBehind eis getTxidsBehindEstimate batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType RENAME Event RenameEvent re2 Event RenameEvent batch getEvents Assert assertTrue re2 getDstPath equals Assert assertTrue re2 getSrcPath equals Assert assertTrue re2 getTimestamp
LOG info re2 toString batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType CREATE Event CreateEvent ce Event CreateEvent batch getEvents Assert assertTrue ce getiNodeType Event CreateEvent INodeType FILE Assert assertTrue ce getPath equals Assert assertTrue ce getCtime Assert assertTrue ce getReplication Assert assertTrue ce getSymlinkTarget Assert assertTrue ce getOverwrite Assert assertEquals BLOCK_SIZE ce getDefaultBlockSize Assert assertTrue ce isErasureCoded isPresent Assert assertFalse ce isErasureCoded get
Assert assertTrue ce getSymlinkTarget Assert assertTrue ce getOverwrite Assert assertEquals BLOCK_SIZE ce getDefaultBlockSize Assert assertTrue ce isErasureCoded isPresent Assert assertFalse ce isErasureCoded get LOG info ce toString Assert assertTrue ce toString startsWith batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType CLOSE Event CloseEvent ce2 Event CloseEvent batch getEvents Assert assertTrue ce2 getPath equals Assert assertTrue ce2 getFileSize Assert assertTrue ce2 getTimestamp
txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType CLOSE Event CloseEvent ce2 Event CloseEvent batch getEvents Assert assertTrue ce2 getPath equals Assert assertTrue ce2 getFileSize Assert assertTrue ce2 getTimestamp LOG info ce2 toString Assert assertTrue ce2 toString startsWith batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType APPEND Event AppendEvent append2 Event AppendEvent batch getEvents Assert assertEquals append2 getPath Assert assertFalse append2 toNewBlock
Assert assertFalse append2 toNewBlock LOG info append2 toString Assert assertTrue append2 toString startsWith batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType CLOSE Assert assertTrue Event CloseEvent batch getEvents getPath equals batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue Event MetadataUpdateEvent batch getEvents Assert assertTrue mue getPath equals Assert assertTrue mue getMetadataType Event MetadataUpdateEvent MetadataType TIMES
txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue Event MetadataUpdateEvent batch getEvents Assert assertTrue mue getPath equals Assert assertTrue mue getMetadataType Event MetadataUpdateEvent MetadataType TIMES LOG info mue toString Assert assertTrue mue toString startsWith batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue2 Event MetadataUpdateEvent batch getEvents Assert assertTrue mue2 getPath equals Assert assertTrue mue2 getMetadataType Event MetadataUpdateEvent MetadataType REPLICATION Assert assertTrue mue2 getReplication
Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue2 Event MetadataUpdateEvent batch getEvents Assert assertTrue mue2 getPath equals Assert assertTrue mue2 getMetadataType Event MetadataUpdateEvent MetadataType REPLICATION Assert assertTrue mue2 getReplication LOG info mue2 toString batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType APPEND Assert assertTrue Event AppendEvent batch getEvents getPath equals Assert assertTrue batch getEvents getEventType Event EventType UNLINK Event UnlinkEvent ue2 Event UnlinkEvent batch getEvents Assert assertTrue ue2 getPath equals Assert assertTrue ue2 getTimestamp
Assert assertTrue ue2 getPath equals Assert assertTrue ue2 getTimestamp LOG info ue2 toString Assert assertTrue ue2 toString startsWith Assert assertTrue batch getEvents getEventType Event EventType CLOSE Event CloseEvent ce3 Event CloseEvent batch getEvents Assert assertTrue ce3 getPath equals Assert assertTrue ce3 getTimestamp batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType UNLINK Event UnlinkEvent ue Event UnlinkEvent batch getEvents Assert assertTrue ue getPath equals Assert assertTrue ue getTimestamp
Assert assertTrue batch getEvents getEventType Event EventType UNLINK Event UnlinkEvent ue Event UnlinkEvent batch getEvents Assert assertTrue ue getPath equals Assert assertTrue ue getTimestamp LOG info ue toString batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType CREATE Event CreateEvent ce4 Event CreateEvent batch getEvents Assert assertTrue ce4 getiNodeType Event CreateEvent INodeType DIRECTORY Assert assertTrue ce4 getPath equals Assert assertTrue ce4 getCtime Assert assertTrue ce4 getReplication Assert assertTrue ce4 getSymlinkTarget
Event CreateEvent ce4 Event CreateEvent batch getEvents Assert assertTrue ce4 getiNodeType Event CreateEvent INodeType DIRECTORY Assert assertTrue ce4 getPath equals Assert assertTrue ce4 getCtime Assert assertTrue ce4 getReplication Assert assertTrue ce4 getSymlinkTarget LOG info ce4 toString batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue3 Event MetadataUpdateEvent batch getEvents Assert assertTrue mue3 getPath equals Assert assertTrue mue3 getMetadataType Event MetadataUpdateEvent MetadataType PERMS Assert assertTrue mue3 getPerms toString contains
Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue3 Event MetadataUpdateEvent batch getEvents Assert assertTrue mue3 getPath equals Assert assertTrue mue3 getMetadataType Event MetadataUpdateEvent MetadataType PERMS Assert assertTrue mue3 getPerms toString contains LOG info mue3 toString batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue4 Event MetadataUpdateEvent batch getEvents Assert assertTrue mue4 getPath equals Assert assertTrue mue4 getMetadataType Event MetadataUpdateEvent MetadataType OWNER Assert assertTrue mue4 getOwnerName equals Assert assertTrue mue4 getGroupName equals
Assert assertTrue mue4 getPath equals Assert assertTrue mue4 getMetadataType Event MetadataUpdateEvent MetadataType OWNER Assert assertTrue mue4 getOwnerName equals Assert assertTrue mue4 getGroupName equals LOG info mue4 toString batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType CREATE Event CreateEvent ce5 Event CreateEvent batch getEvents Assert assertTrue ce5 getiNodeType Event CreateEvent INodeType SYMLINK Assert assertTrue ce5 getPath equals Assert assertTrue ce5 getCtime Assert assertTrue ce5 getReplication Assert assertTrue ce5 getSymlinkTarget equals
Assert assertTrue ce5 getPath equals Assert assertTrue ce5 getCtime Assert assertTrue ce5 getReplication Assert assertTrue ce5 getSymlinkTarget equals LOG info ce5 toString batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue5 Event MetadataUpdateEvent batch getEvents Assert assertTrue mue5 getPath equals Assert assertTrue mue5 getMetadataType Event MetadataUpdateEvent MetadataType XATTRS Assert assertTrue mue5 getxAttrs size Assert assertTrue mue5 getxAttrs get getName contains Assert assertTrue mue5 isxAttrsRemoved
Assert assertTrue mue5 getMetadataType Event MetadataUpdateEvent MetadataType XATTRS Assert assertTrue mue5 getxAttrs size Assert assertTrue mue5 getxAttrs get getName contains Assert assertTrue mue5 isxAttrsRemoved LOG info mue5 toString batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue6 Event MetadataUpdateEvent batch getEvents Assert assertTrue mue6 getPath equals Assert assertTrue mue6 getMetadataType Event MetadataUpdateEvent MetadataType XATTRS Assert assertTrue mue6 getxAttrs size Assert assertTrue mue6 getxAttrs get getName contains Assert assertTrue mue6 isxAttrsRemoved
Event MetadataUpdateEvent mue6 Event MetadataUpdateEvent batch getEvents Assert assertTrue mue6 getPath equals Assert assertTrue mue6 getMetadataType Event MetadataUpdateEvent MetadataType XATTRS Assert assertTrue mue6 getxAttrs size Assert assertTrue mue6 getxAttrs get getName contains Assert assertTrue mue6 isxAttrsRemoved LOG info mue6 toString batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue7 Event MetadataUpdateEvent batch getEvents Assert assertTrue mue7 getPath equals Assert assertTrue mue7 getMetadataType Event MetadataUpdateEvent MetadataType ACLS Assert assertTrue mue7 getAcls contains AclEntry parseAclEntry
txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue7 Event MetadataUpdateEvent batch getEvents Assert assertTrue mue7 getPath equals Assert assertTrue mue7 getMetadataType Event MetadataUpdateEvent MetadataType ACLS Assert assertTrue mue7 getAcls contains AclEntry parseAclEntry LOG info mue7 toString batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue8 Event MetadataUpdateEvent batch getEvents Assert assertTrue mue8 getPath equals Assert assertTrue mue8 getMetadataType Event MetadataUpdateEvent MetadataType ACLS Assert assertTrue mue8 getAcls
txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType METADATA Event MetadataUpdateEvent mue8 Event MetadataUpdateEvent batch getEvents Assert assertTrue mue8 getPath equals Assert assertTrue mue8 getMetadataType Event MetadataUpdateEvent MetadataType ACLS Assert assertTrue mue8 getAcls LOG info mue8 toString batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType RENAME Event RenameEvent re3 Event RenameEvent batch getEvents Assert assertTrue re3 getDstPath equals Assert assertTrue re3 getSrcPath equals Assert assertTrue re3 getTimestamp
txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType RENAME Event RenameEvent re3 Event RenameEvent batch getEvents Assert assertTrue re3 getDstPath equals Assert assertTrue re3 getSrcPath equals Assert assertTrue re3 getTimestamp LOG info re3 toString batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType TRUNCATE Event TruncateEvent et Event TruncateEvent batch getEvents Assert assertTrue et getPath equals Assert assertTrue et getFileSize BLOCK_SIZE Assert assertTrue et getTimestamp
Assert assertTrue et toString startsWith batch waitForNextEvents eis Assert assertEquals batch getEvents length txid checkTxid batch txid Assert assertTrue batch getEvents getEventType Event EventType CREATE ce Event CreateEvent batch getEvents Assert assertTrue ce getiNodeType Event CreateEvent INodeType FILE Assert assertTrue ce getPath equals Assert assertTrue ce getCtime Assert assertTrue ce getReplication Assert assertTrue ce getSymlinkTarget Assert assertFalse ce getOverwrite Assert assertEquals BLOCK_SIZE ce getDefaultBlockSize Assert assertTrue ce isErasureCoded isPresent Assert assertFalse ce isErasureCoded get
batch waitForNextEvents eis Assert assertEquals batch getEvents length txid batch getTxid eventsBehind eis getTxidsBehindEstimate Assert assertTrue batch getEvents getEventType Event EventType CREATE Event CreateEvent ce Event CreateEvent batch getEvents Assert assertTrue ce getiNodeType Event CreateEvent INodeType FILE Assert assertTrue ce getPath equals Assert assertTrue ce getCtime Assert assertEquals ce getReplication Assert assertTrue ce getSymlinkTarget Assert assertTrue ce getOverwrite Assert assertEquals ecPolicy getCellSize ce getDefaultBlockSize Assert assertTrue ce isErasureCoded isPresent Assert assertTrue ce isErasureCoded get
conf HdfsConfiguration baseConf conf setInt HADOOP_KERBEROS_MIN_SECONDS_BEFORE_RELOGIN conf setInt IPC_CLIENT_CONNECTION_IDLESCANINTERVAL_KEY conf setInt IPC_CLIENT_CONNECTION_MAXIDLETIME_KEY Client setConnectTimeout conf cluster MiniQJMHACluster Builder conf setForceRemoteEditsOnly build cluster getDfsCluster waitActive cluster getDfsCluster transitionToActive UserGroupInformation ugi UserGroupInformation loginUserFromKeytabAndReturnUGI generalHDFSKeytabFile getAbsolutePath UserGroupInformation setShouldRenewImmediatelyForTests ugi
cluster MiniQJMHACluster Builder conf setForceRemoteEditsOnly build cluster getDfsCluster waitActive cluster getDfsCluster transitionToActive UserGroupInformation ugi UserGroupInformation loginUserFromKeytabAndReturnUGI generalHDFSKeytabFile getAbsolutePath UserGroupInformation setShouldRenewImmediatelyForTests ugi LOG info UserGroupInformation getCurrentUser UserGroupInformation getLoginUser Configuration clientConf Configuration cluster getDfsCluster getConfiguration clientFs clientConf clientFs mkdirs Path LOG info DFSInotifyEventInputStream eis clientFs getInotifyEventStream EventBatch batch batch eis
Path file Path dir writeFile dfs file Path file2 Path dir writeFile dfs file2 Long fileLength dfs getFileStatus file getLen Long fileDiskUsed fileLength replication Long file2Length dfs getFileStatus file2 getLen Long file2DiskUsed file2Length replication ret ret shell run String dir toString e System err println e getLocalizedMessage assertEquals ret String returnString out toString
e System err println e getLocalizedMessage assertEquals ret returnString out toString LOG info returnString Long combinedLength fileLength file2Length newFileLength Long combinedDiskUsed fileDiskUsed file2DiskUsed newFileDiskUsed assertTrue returnString contains combinedLength toString assertTrue returnString contains combinedDiskUsed toString out reset ret ret shell run String parent toString e System err println e getLocalizedMessage
out reset ret ret shell run String parent toString e System err println e getLocalizedMessage assertEquals ret returnString out toString LOG info returnString assertTrue returnString contains combinedLength toString assertTrue returnString contains combinedDiskUsed toString out reset ret ret shell run String parent toString
out reset ret ret shell run String parent toString e System err println e getLocalizedMessage assertEquals ret returnString out toString LOG info returnString Long exludeSnapshotLength file2Length newFileLength Long excludeSnapshotDiskUsed file2DiskUsed newFileDiskUsed assertTrue returnString contains exludeSnapshotLength toString assertTrue returnString contains excludeSnapshotDiskUsed toString out reset ret
Path snapshotPath Path parent snapshotName dfs allowSnapshot parent assertThat dfs createSnapshot parent snapshotName is snapshotPath rmr dfs file rmr dfs dir2 Path newFile Path dir writeFile dfs newFile Long newFileLength dfs getFileStatus newFile getLen val val shell run String parent toString e System err println e getLocalizedMessage assertEquals val String returnString out toString
assertEquals val String returnString out toString LOG info returnString Scanner in Scanner returnString in nextLine assertEquals in nextLong assertEquals in nextLong assertEquals fileLength file2Length newFileLength in nextLong out reset val val shell run String parent toString e System err println e getLocalizedMessage assertEquals val
String args StringBuilder cmdline StringBuilder String arg args cmdline append arg
shell String args StringBuilder cmdline StringBuilder String arg args cmdline append arg LOG info cmdline toString exitCode exitCode shell run args
shell setConf conf Path dir Path chmodDir fs delete dir fs mkdirs dir confirmPermissionChange fs shell dir Path file Path chmodDir TestDFSShell writeFile fs file confirmPermissionChange fs shell file runCmd shell chmodDir assertEquals fs getFileStatus dir getPermission toString assertEquals fs getFileStatus file getPermission toString Path Path dir2 Path dir fs mkdirs dir2
String toApply String expected fs shell dir2 LOG info toApply expected runCmd shell toApply dir2 toString String result fs getFileStatus dir2 getPermission toString
numBlocks DFSTestUtil createStripedFile cluster filePath numBlocks stripesPerBlock ecPolicy in filePath assertTrue in DFSStripedInputStream DFSStripedInputStream stream DFSStripedInputStream in ElasticByteBufferPool ebbp ElasticByteBufferPool stream getBufferPool
lenIndex RANDOM nextInt lengths size
HdfsConfiguration conf newHdfsConfiguration fileLengths cellSize dataBlocks cellSize dataBlocks dnIndex dnIndex dataBlocks dataBlocks dnIndex dataBlocks length fileLengths killPos getKillPositions length dnIndex length LOG info length Arrays toString killPos Arrays toString dnIndex setup conf runTest length killPos dnIndex String err Arrays toString killPos Arrays toString dnIndex length
HdfsConfiguration conf newHdfsConfiguration
length HdfsConfiguration conf newHdfsConfiguration dnIndex killPos getKillPositions length dnIndex length
getGenerationStamp out gs out getBlock getGenerationStamp
DatanodeInfo out dnIndex StripedDataStreamer s out getStripedDataStreamer dnIndex DatanodeInfo datanode getDatanodes s
conf HdfsConfiguration conf UpgradeUtilities initializeStorageStateConf numDirs conf String nameNodeDirs conf getStrings DFSConfigKeys DFS_NAMENODE_NAME_DIR_KEY String dataNodeDirs conf getStrings DFSConfigKeys DFS_DATANODE_DATA_DIR_KEY conf setBoolean DFSConfigKeys DFS_DATANODE_DUPLICATE_REPLICA_DELETION log numDirs UpgradeUtilities createNameNodeStorageDirs nameNodeDirs cluster createCluster DistributedFileSystem dfs cluster getFileSystem dfs setSafeMode SafeModeAction SAFEMODE_ENTER dfs rollingUpgrade RollingUpgradeAction PREPARE fail re assertEquals InconsistentFSStateException getName re getClassName
Socket sock
sock connect dnAddr HdfsConstants READ_TIMEOUT sock setSoTimeout HdfsConstants READ_TIMEOUT OutputStream out sock getOutputStream retBuf recvBuf size DataInputStream in DataInputStream sock getInputStream out write sendBuf toByteArray out flush in readFully retBuf eof LOG info eof String received StringUtils byteToHexString retBuf
sock setSoTimeout HdfsConstants READ_TIMEOUT OutputStream out sock getOutputStream retBuf recvBuf size DataInputStream in DataInputStream sock getInputStream out write sendBuf toByteArray out flush in readFully retBuf eof LOG info eof String received StringUtils byteToHexString retBuf String expected StringUtils byteToHexString recvBuf toByteArray
doReturn HdfsServerConstants DATANODE_LAYOUT_VERSION when mockDnReg getVersion doReturn when mockDnReg getIpAddr doReturn when mockDnReg getXferPort doReturn when mockDnReg getDatanodeUuid doReturn mockStorageInfo when mockDnReg getStorageInfo doReturn when mockDnReg getSoftwareVersion rpcServer registerDatanode mockDnReg doReturn when mockDnReg getSoftwareVersion rpcServer registerDatanode mockDnReg doReturn when mockDnReg getSoftwareVersion rpcServer registerDatanode mockDnReg fail ive GenericTestUtils assertExceptionContains ive
doReturn HdfsServerConstants DATANODE_LAYOUT_VERSION when mockDnReg getVersion doReturn when mockDnReg getDatanodeUuid doReturn mockStorageInfo when mockDnReg getStorageInfo doReturn VersionInfo getVersion when mockDnReg getSoftwareVersion doReturn when mockDnReg getIpAddr doReturn when mockDnReg getXferPort rpcServer registerDatanode mockDnReg doReturn nnCTime when mockStorageInfo getCTime rpcServer registerDatanode mockDnReg doReturn VersionInfo getVersion when mockDnReg getSoftwareVersion rpcServer registerDatanode mockDnReg fail ive GenericTestUtils assertExceptionContains ive
conf setInt DFSConfigKeys DFS_NAMENODE_HEARTBEAT_RECHECK_INTERVAL_KEY conf setLong DFSConfigKeys DFS_HEARTBEAT_INTERVAL_KEY MiniDFSCluster cluster MiniDFSCluster Builder conf numDataNodes NUM_OF_DATANODES build cluster waitActive String bpid cluster getNamesystem getBlockPoolId List DataNode datanodes cluster getDataNodes DFSClient client cluster getFileSystem dfs assertReports NUM_OF_DATANODES DatanodeReportType ALL client datanodes bpid assertReports NUM_OF_DATANODES DatanodeReportType LIVE client datanodes bpid assertReports DatanodeReportType DEAD client datanodes bpid DataNode last datanodes get datanodes size
DatanodeManager datanodeManager blockManager getDatanodeManager BlockManagerTestUtil recheckDecommissionState datanodeManager DFSClient client getDfsClient assertEquals numDatanodes client datanodeReport DatanodeReportType LIVE length ExtendedBlock b DFSTestUtil getFirstBlock fileSys file1 String uuid toDecomUuid BlockInfo info blockManager getStoredBlock b getLocalBlock count StringBuilder sb StringBuilder i i info i DatanodeDescriptor dn info getDatanode i sb append dn dn uuid
DatanodeManager datanodeManager blockManager getDatanodeManager BlockManagerTestUtil recheckDecommissionState datanodeManager DFSClient client getDfsClient assertEquals numDatanodes client datanodeReport DatanodeReportType LIVE length ExtendedBlock b DFSTestUtil getFirstBlock fileSys file1 String uuid toDecomUuid BlockInfo info blockManager getStoredBlock b getLocalBlock count StringBuilder sb StringBuilder i i info i DatanodeDescriptor dn info getDatanode i sb append dn dn uuid
String out String outStr scanIntoString out
CountDownLatch decomStarted CountDownLatch Thread decomTh Thread decomStarted countDown decommissionNode decommisionNodes AdminStates DECOMMISSIONED e LOG error e Assert fail deadDecommissioned fsn getNumDecomDeadDataNodes liveDecommissioned fsn getNumDecomLiveDataNodes decomTh start decomStarted await TimeUnit SECONDS Thread sleep
decomStarted countDown decommissionNode decommisionNodes AdminStates DECOMMISSIONED e LOG error e Assert fail deadDecommissioned fsn getNumDecomDeadDataNodes liveDecommissioned fsn getNumDecomLiveDataNodes decomTh start decomStarted await TimeUnit SECONDS Thread sleep dnp cluster restartDataNode dnp
writeBytes cellSize dataBlocks writeStripedFile dfs ecFile writeBytes Assert assertEquals bm numOfUnderReplicatedBlocks FileChecksum fileChecksum1 dfs getFileChecksum ecFile writeBytes List DatanodeInfo decommisionNodes ArrayList DatanodeInfo LocatedBlock lb dfs getClient getLocatedBlocks ecFile toString get DatanodeInfo dnLocs lb getLocations assertEquals dataBlocks parityBlocks dnLocs length decommNodeIndex decommisionNodes add dnLocs decommNodeIndex decommissionNode decommisionNodes AdminStates DECOMMISSIONED assertEquals decommisionNodes size fsn getNumDecomLiveDataNodes assertNull checkFile dfs ecFile decommisionNodes numDNs StripedFileTestUtil checkData dfs ecFile writeBytes decommisionNodes blockGroupSize FileChecksum fileChecksum2 dfs getFileChecksum ecFile writeBytes
writeStripedFile dfs ecFile writeBytes Assert assertEquals bm numOfUnderReplicatedBlocks FileChecksum fileChecksum1 dfs getFileChecksum ecFile writeBytes List DatanodeInfo decommisionNodes ArrayList DatanodeInfo LocatedBlock lb dfs getClient getLocatedBlocks ecFile toString get DatanodeInfo dnLocs lb getLocations assertEquals dataBlocks parityBlocks dnLocs length decommNodeIndex decommisionNodes add dnLocs decommNodeIndex decommissionNode decommisionNodes AdminStates DECOMMISSIONED assertEquals decommisionNodes size fsn getNumDecomLiveDataNodes assertNull checkFile dfs ecFile decommisionNodes numDNs StripedFileTestUtil checkData dfs ecFile writeBytes decommisionNodes blockGroupSize FileChecksum fileChecksum2 dfs getFileChecksum ecFile writeBytes LOG info fileChecksum1
node state done state node getAdminState done
fileSys name DatanodeInfo decommissionedNodes isNodeDown decommissionedNodes size assertTrue fileSys getUri fileSys DistributedFileSystem HdfsDataInputStream dis HdfsDataInputStream fileSys open name Collection LocatedBlock dinfo dis getAllBlocks LocatedBlock blk dinfo hasdown DatanodeInfo nodes blk getLocations nodes
ExecutorService threadPool HadoopExecutors newFixedThreadPool numThreads CountDownLatch allExecutorThreadsReady CountDownLatch numThreads CountDownLatch startBlocker CountDownLatch CountDownLatch allDone CountDownLatch numThreads AtomicReference Throwable childError AtomicReference numThreads threadPool allExecutorThreadsReady countDown startBlocker await FileSystem fs cluster getFileSystem fs mkdirs Path Throwable
childError compareAndSet t allDone countDown oldMkdirOpCount getOpStatistics OpType MKDIRS allExecutorThreadsReady await startBlocker countDown allDone await assertNull childError get childError get checkStatistics fs numThreads checkOpStatistics OpType MKDIRS numThreads oldMkdirOpCount LongStatistic opCountIter get opCountIter LongStatistic opCount opCountIter next OpType MKDIRS opCount assertEquals numThreads oldMkdirOpCount opCount getValue
dataUnits ecPolicy getNumDataUnits parityUnits ecPolicy getNumParityUnits setupCluster dataUnits parityUnits filesize ecPolicy getNumDataUnits ecPolicy getCellSize contents filesize Path path Path
dataUnits ecPolicy getNumDataUnits parityUnits ecPolicy getNumParityUnits setupCluster dataUnits parityUnits dataUnits dataUnits filesize ecPolicy getNumDataUnits ecPolicy getCellSize contents filesize Path path Path
dataUnits ecPolicy getNumDataUnits parityUnits ecPolicy getNumParityUnits numRacks dataUnits parityUnits setupCluster dataUnits parityUnits numRacks dataUnits parityUnits filesize ecPolicy getNumDataUnits ecPolicy getCellSize contents filesize i i i Path path Path i
create close DFSTestUtil waitReplication fileSystem f LocatedBlocks lbs fileSystem dfs getNamenode getBlockLocations Long MAX_VALUE List DataNode dnsOfCluster cluster getDataNodes DatanodeInfo dnsWithLocations lbs getLastLocatedBlock getLocations DataNode dn dnsOfCluster DatanodeInfo dnsWithLocations dn dn shutdown DFSTestUtil waitForDatanodeDeath dn DFSTestUtil waitReplication fileSystem f fileSystem append f fail
range1 range2 FileChecksum stripedFileChecksum1 getFileChecksum stripedFile1 range1 FileChecksum stripedFileChecksum2 getFileChecksum stripedFile2 range1 FileChecksum stripedFileChecksum3 getFileChecksum stripedFile2 range2
range1 range2 FileChecksum stripedFileChecksum1 getFileChecksum stripedFile1 range1 FileChecksum stripedFileChecksum2 getFileChecksum stripedFile2 range1 FileChecksum stripedFileChecksum3 getFileChecksum stripedFile2 range2 LOG info stripedFileChecksum1
range1 range2 FileChecksum stripedFileChecksum1 getFileChecksum stripedFile1 range1 FileChecksum stripedFileChecksum2 getFileChecksum stripedFile2 range1 FileChecksum stripedFileChecksum3 getFileChecksum stripedFile2 range2 LOG info stripedFileChecksum1 LOG info stripedFileChecksum2
prepareTestFiles fileSize String stripedFile1 FileChecksum stripedFileChecksum1 getFileChecksum stripedFile1 fileSize FileChecksum stripedFileChecksumRecon getFileChecksum stripedFile1 fileSize
prepareTestFiles fileSize String stripedFile1 FileChecksum stripedFileChecksum1 getFileChecksum stripedFile1 fileSize FileChecksum stripedFileChecksumRecon getFileChecksum stripedFile1 fileSize LOG info stripedFileChecksum1
prepareTestFiles fileSize String stripedFile1 stripedFile2 FileChecksum stripedFileChecksum1 getFileChecksum stripedFile1 FileChecksum stripedFileChecksum2 getFileChecksum stripedFile2 FileChecksum stripedFileChecksum2Recon getFileChecksum stripedFile2
prepareTestFiles fileSize String stripedFile1 stripedFile2 FileChecksum stripedFileChecksum1 getFileChecksum stripedFile1 FileChecksum stripedFileChecksum2 getFileChecksum stripedFile2 FileChecksum stripedFileChecksum2Recon getFileChecksum stripedFile2 LOG info stripedFileChecksum1
prepareTestFiles fileSize String stripedFile1 stripedFile2 FileChecksum stripedFileChecksum1 getFileChecksum stripedFile1 FileChecksum stripedFileChecksum2 getFileChecksum stripedFile2 FileChecksum stripedFileChecksum2Recon getFileChecksum stripedFile2 LOG info stripedFileChecksum1 LOG info stripedFileChecksum1
String stripedFile requestedLen LOG info stripedFile requestedLen prepareTestFiles fileSize String stripedFile FileChecksum stripedFileChecksum1 getFileChecksum stripedFile requestedLen FileChecksum stripedFileChecksumRecon getFileChecksum stripedFile requestedLen
String stripedFile requestedLen LOG info stripedFile requestedLen prepareTestFiles fileSize String stripedFile FileChecksum stripedFileChecksum1 getFileChecksum stripedFile requestedLen FileChecksum stripedFileChecksumRecon getFileChecksum stripedFile requestedLen LOG info stripedFileChecksum1
FSDataOutputStream outputStream fileSystem create file outputStream close outputStream fileSystem append file i error i i writeBuf DFSTestUtil generateSequentialBytes i writeSize writeSize outputStream write writeBuf outputStream hflush writerStarted set error set
outputStream fileSystem append file i error i i writeBuf DFSTestUtil generateSequentialBytes i writeSize writeSize outputStream write writeBuf outputStream hflush writerStarted set e error set LOG error e outputStream close writerDone set e
e error set LOG error e outputStream close writerDone set e LOG error e RuntimeException e startPos writerDone error
writerDone set e LOG error e RuntimeException e startPos writerDone error startPos tailFile file startPos e LOG error String format file e
startPos i i i expected i startPos i expected
file startPos numRead FSDataInputStream inputStream fileSystem open file inputStream seek startPos len buf len read read inputStream read buf
file startPos numRead FSDataInputStream inputStream fileSystem open file inputStream seek startPos len buf len read read inputStream read buf LOG info String format read buf startPos numRead read
MiniDFSCluster cluster DFSTestUtil util DFSTestUtil Builder setName setNumFiles build Configuration conf HdfsConfiguration cluster MiniDFSCluster Builder conf numDataNodes build FileSystem fs cluster getFileSystem util createFiles fs String bpid cluster getNamesystem getBlockPoolId DataNode dn cluster getDataNodes get Map DatanodeStorage BlockListAsLongs blockReports dn getFSDataset getBlockReports bpid assertTrue blockReports isEmpty BlockListAsLongs blockReports
NameNode nn nn startNameNode Configuration conf2 HdfsConfiguration config conf2 set DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_KEY config get DFSConfigKeys DFS_NAMENODE_HTTP_ADDRESS_KEY
NameNode nn nn startNameNode Configuration conf2 HdfsConfiguration config conf2 set DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_KEY config get DFSConfigKeys DFS_NAMENODE_HTTP_ADDRESS_KEY LOG info conf2 get DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_KEY started canStartSecondaryNode conf2 assertFalse started conf2 set DFSConfigKeys DFS_NAMENODE_SECONDARY_HTTP_ADDRESS_KEY THIS_HOST
NameNode nn nn startNameNode Configuration backup_config HdfsConfiguration config backup_config set DFSConfigKeys DFS_NAMENODE_BACKUP_ADDRESS_KEY THIS_HOST backup_config set DFSConfigKeys DFS_NAMENODE_BACKUP_HTTP_ADDRESS_KEY backup_config get DFSConfigKeys DFS_NAMENODE_HTTP_ADDRESS_KEY
NameNode nn nn startNameNode Configuration backup_config HdfsConfiguration config backup_config set DFSConfigKeys DFS_NAMENODE_BACKUP_ADDRESS_KEY THIS_HOST backup_config set DFSConfigKeys DFS_NAMENODE_BACKUP_HTTP_ADDRESS_KEY backup_config get DFSConfigKeys DFS_NAMENODE_HTTP_ADDRESS_KEY LOG info backup_config get DFSConfigKeys DFS_NAMENODE_BACKUP_HTTP_ADDRESS_KEY assertFalse canStartBackupNode backup_config backup_config set DFSConfigKeys DFS_NAMENODE_BACKUP_ADDRESS_KEY THIS_HOST backup_config set DFSConfigKeys DFS_NAMENODE_BACKUP_HTTP_ADDRESS_KEY THIS_HOST
start Time monotonicNow
filename namenode start Time monotonicNow LOG info filename LocatedBlocks blocks namenode getBlockLocations filename Long MAX_VALUE assertEquals numBlocks blocks locatedBlockCount i i numBlocks i LOG info i blocks namenode getBlockLocations filename Long MAX_VALUE assertEquals numBlocks blocks locatedBlockCount LocatedBlock block blocks get i actual block getLocations length actual
waitForBlockReplication testFile dfsClient getNamenode numDataNodes List Map DatanodeStorage BlockListAsLongs blocksList cluster getAllBlockReports bpid cluster shutdown cluster LOG info conf HdfsConfiguration SimulatedFSDataset setFactory conf conf set DFSConfigKeys DFS_NAMENODE_SAFEMODE_THRESHOLD_PCT_KEY cluster MiniDFSCluster Builder conf numDataNodes numDataNodes format build cluster waitActive Set Block uniqueBlocks HashSet Block Map DatanodeStorage BlockListAsLongs blocksList BlockListAsLongs Block b uniqueBlocks add Block b
FSDataOutputStream fileSys name repl blockSize FSDataOutputStream stm fileSys create name fileSys getConf getInt CommonConfigurationKeys IO_FILE_BUFFER_SIZE_KEY repl blockSize
bytesToRead fileSize compb readSize j j readSize j compb j pattern j pattern length FSDataInputStream stm fs open name bytesToRead thisread Math min readSize bytesToRead stm readFully b thisread thisread readSize assertTrue fileSize bytesToRead Arrays equals b compb k k thisread k assertTrue fileSize bytesToRead b k compb k
compb readSize j j readSize j compb j pattern j pattern length FSDataInputStream stm fs open name bytesToRead thisread Math min readSize bytesToRead stm readFully b thisread thisread readSize assertTrue fileSize bytesToRead Arrays equals b compb k k thisread k assertTrue fileSize bytesToRead b k compb k LOG debug bytesToRead thisread
blockSize fileSize blockSize Configuration conf Configuration MiniDFSCluster cluster MiniDFSCluster Builder conf numDataNodes numDatanodes build FileSystem fs cluster getFileSystem Path file1 Path blockSize FSDataOutputStream stm createFile fs file1 blockSize
blockSize fileSize blockSize Configuration conf Configuration MiniDFSCluster cluster MiniDFSCluster Builder conf numDataNodes numDatanodes build FileSystem fs cluster getFileSystem Path file1 Path blockSize FSDataOutputStream stm createFile fs file1 blockSize LOG info file1 fileSize blockSize assertTrue file1 fs getFileStatus file1 isFile writeFile stm fileSize
blockSize fileSize blockSize Configuration conf Configuration MiniDFSCluster cluster MiniDFSCluster Builder conf numDataNodes numDatanodes build FileSystem fs cluster getFileSystem Path file1 Path blockSize FSDataOutputStream stm createFile fs file1 blockSize LOG info file1 fileSize blockSize assertTrue file1 fs getFileStatus file1 isFile writeFile stm fileSize LOG info file1 stm close
dfs renewLease d_out write buf LOG info Assert fail hardlimit conf getLong DFSConfigKeys DFS_LEASE_HARDLIMIT_KEY DFSConfigKeys DFS_LEASE_HARDLIMIT_DEFAULT dfs lastLeaseRenewal Time monotonicNow hardlimit dfs renewLease d_out write buf d_out close Assert fail
hardlimit conf getLong DFSConfigKeys DFS_LEASE_HARDLIMIT_KEY DFSConfigKeys DFS_LEASE_HARDLIMIT_DEFAULT dfs lastLeaseRenewal Time monotonicNow hardlimit dfs renewLease d_out write buf d_out close Assert fail e LOG info e Thread sleep Assert assertTrue originalRenewer isEmpty doNothing when spyNN renewLease anyString num c_in read buf num
Assert fail e LOG info e Thread sleep Assert assertTrue originalRenewer isEmpty doNothing when spyNN renewLease anyString num c_in read buf num Assert fail c_in close e LOG error e Assert fail
dn cluster DataNodeTestUtils setHeartbeatsDisabledForTests dn cluster waitActive cluster setLeasePeriod LONG_LEASE_PERIOD SHORT_LEASE_PERIOD LocatedBlocks locatedBlocks Thread sleep SHORT_LEASE_PERIOD locatedBlocks dfs dfs getLocatedBlocks fileStr size locatedBlocks isUnderConstruction assertEquals size locatedBlocks getFileLength stm write stm hflush fail
blockLengths FSDataOutputStream out dfs create p DFSStripedOutputStream stripedOut DFSStripedOutputStream out getWrappedStream posToKill getPosToKill blockLengths checkingPos nextCheckingPos posToKill Set Integer stoppedStreamerIndexes HashSet pos pos pos out write StripedFileTestUtil getByte pos pos checkingPos posToKill pos out flush stripedOut enqueueAllCurrentPackets
stripedOut enqueueAllCurrentPackets LOG info index pos blockLengths index StripedDataStreamer s stripedOut getStripedDataStreamer index waitStreamerAllAcked s waitByteSent s blockLengths index stopBlockStream s stoppedStreamerIndexes add index checkingPos nextCheckingPos posToKill pos out flush stripedOut enqueueAllCurrentPackets i i blockLengths i stoppedStreamerIndexes i StripedDataStreamer s stripedOut getStripedDataStreamer i
setup
maintenanceMinRepl numDataNodes numNewDataNodes fileBlockRepl setup LOG info maintenanceMinRepl numDataNodes numNewDataNodes fileBlockRepl
setup
String ns fileSys name DatanodeInfo DatanodeInfo assertTrue fileSys getUri fileSys DistributedFileSystem HdfsDataInputStream dis HdfsDataInputStream fileSys open name BlockManager bm ns getBlockManager Collection LocatedBlock dinfo dis getAllBlocks String output LocatedBlock blk dinfo DatanodeInfo nodes blk getLocations j j nodes j nodes j output blk getBlock nodes j
assertTrue fileSys getUri fileSys DistributedFileSystem HdfsDataInputStream dis HdfsDataInputStream fileSys open name BlockManager bm ns getBlockManager Collection LocatedBlock dinfo dis getAllBlocks String output LocatedBlock blk dinfo DatanodeInfo nodes blk getLocations j j nodes j nodes j output blk getBlock nodes j LOG info output output nodes j output blk getBlock nodes j
repl nodes length output blk getBlock repl nodes length j j nodes length j output nodes j output ns getPendingReplicationBlocks output ns getUnderReplicatedBlocks expectedExcludedNode output expectedExcludedNode LOG info output output Iterator DatanodeStorageInfo storageInfoIter bm getStorages blk getBlock getLocalBlock iterator List DatanodeInfo maintenanceNodes ArrayList storageInfoIter DatanodeInfo node storageInfoIter next getDatanodeDescriptor node
output ns getPendingReplicationBlocks output ns getUnderReplicatedBlocks expectedExcludedNode output expectedExcludedNode LOG info output output Iterator DatanodeStorageInfo storageInfoIter bm getStorages blk getBlock getLocalBlock iterator List DatanodeInfo maintenanceNodes ArrayList storageInfoIter DatanodeInfo node storageInfoIter next getDatanodeDescriptor node maintenanceNodes add node expectedMaintenanceNode maintenanceNodes expectedMaintenanceNode output expectedMaintenanceNode
replicationFactor conf util BlockReaderTestUtil replicationFactor conf dfsClient util getDFSClient seed Time now
String METHOD_NAME GenericTestUtils getMethodName
out length bytesToWrite length ret bytesToWrite toWrite written Random rb Random rand nextLong bytesToWrite rb nextBytes toWrite bytesToWriteNext bytesToWrite bytesToWrite out write toWrite bytesToWriteNext System arraycopy toWrite ret ret length bytesToWrite bytesToWriteNext written bytesToWriteNext
Path testFile Path dir FSDataOutputStream stream dfs create testFile LeaseRenewer leaseRenewer dfs getClient getLeaseRenewer stream write getBytes stream hflush fail stream close fail GenericTestUtils setLogLevel LeaseRenewer LOG Level TRACE GenericTestUtils
Path file Path length bytes StripedFileTestUtil generateBytes length DFSTestUtil writeFile dfs file bytes dnIndex ReadStripedFileWithDecodingHelper findFirstDataNode cluster dfs file CELL_SIZE NUM_DATA_UNITS Assert assertNotEquals dnIndex LocatedStripedBlock slb LocatedStripedBlock dfs getClient getLocatedBlocks file toString CELL_SIZE NUM_DATA_UNITS get LocatedBlock blks StripedBlockUtil parseStripedBlockGroup slb CELL_SIZE NUM_DATA_UNITS NUM_PARITY_UNITS File storageDir cluster getInstanceStorageDir dnIndex File blkFile MiniDFSCluster getBlockFile storageDir blks getBlock Assert assertTrue blkFile exists
locs locs locs failedDNIdx String name locs getNames failedDNIdx dn cluster port dn getXferPort name port dn shutdown cluster setDataNodeDead dn getDatanodeId
fileName fileLen type toRecoverBlockNum toRecoverBlockNum toRecoverBlockNum parityBlkNum Assert fail parityBlkNum assertTrue fileLen Path file Path fileName writeFile fs fileName fileLen LocatedBlocks locatedBlocks StripedFileTestUtil getLocatedBlocks file fs assertEquals locatedBlocks getFileLength fileLen LocatedStripedBlock lastBlock LocatedStripedBlock locatedBlocks getLastLocatedBlock DatanodeInfo storageInfos lastBlock getLocations indices lastBlock getBlockIndices BitSet bitset BitSet dnNum DatanodeInfo storageInfo storageInfos bitset set dnMap get storageInfo dead generateDeadDnIndices type toRecoverBlockNum indices
deadDnIndices toRecoverBlockNum ExtendedBlock blocks ExtendedBlock toRecoverBlockNum File replicas File toRecoverBlockNum replicaLengths toRecoverBlockNum File metadatas File toRecoverBlockNum replicaContents toRecoverBlockNum Map ExtendedBlock DataNode errorMap HashMap dead length i i toRecoverBlockNum i dataDNs i storageInfos dead i deadDnIndices i dnMap get dataDNs i blocks i StripedBlockUtil constructInternalBlock lastBlock getBlock cellSize dataBlkNum indices dead i errorMap put blocks i cluster getDataNodes get deadDnIndices i replicas i cluster getBlockFile deadDnIndices i blocks i replicaLengths i replicas i length metadatas i cluster getBlockMetadataFile deadDnIndices i blocks i
length found assertTrue found isOnSameRack isNotOnSameRack blk DatanodeInfo datanodes blk getLocations datanodes length datanodes length isNotOnSameRack datanodes getNetworkLocation equals datanodes getNetworkLocation isOnSameRack isNotOnSameRack datanodes length
start Time monotonicNow
cluster MiniDFSCluster Builder conf numDataNodes numDataNodes build cluster waitActive DFSClient dfsClient DFSClient InetSocketAddress cluster getNameNodePort conf OutputStream out cluster getFileSystem create testPath out write buffer out close waitForBlockReplication testFile dfsClient getNamenode numDataNodes ExtendedBlock block dfsClient getNamenode getBlockLocations testFile Long MAX_VALUE get getBlock List MaterializedReplica replicas ArrayList dnIndex dnIndex dnIndex replicas add cluster getMaterializedReplica dnIndex block assertEquals replicas size cluster shutdown fileCount MaterializedReplica replicas
OutputStream out cluster getFileSystem create testPath out write buffer out close waitForBlockReplication testFile dfsClient getNamenode numDataNodes ExtendedBlock block dfsClient getNamenode getBlockLocations testFile Long MAX_VALUE get getBlock List MaterializedReplica replicas ArrayList dnIndex dnIndex dnIndex replicas add cluster getMaterializedReplica dnIndex block assertEquals replicas size cluster shutdown fileCount MaterializedReplica replica replicas fileCount LOG info replica replica deleteData
String nnDirPrefix MiniDFSCluster getBaseDirectory File nn1Dir File nnDirPrefix File nn2Dir File nnDirPrefix
String nnDirPrefix MiniDFSCluster getBaseDirectory File nn1Dir File nnDirPrefix File nn2Dir File nnDirPrefix LOG info nn1Dir
MiniDFSCluster cluster MiniDFSCluster Builder conf numDataNodes manageNameDfsDirs checkExitOnShutdown build cluster shutdown MiniDFSCluster cluster2 FileUtil fullyDelete nn2Dir FileUtil copy nn1Dir FileSystem getLocal conf getRaw Path nn2Dir getAbsolutePath conf MiniDFSCluster cluster MiniDFSCluster Builder conf numDataNodes format manageNameDfsDirs checkExitOnShutdown build Path foo Path Path bar Path Path baz Path RollingUpgradeInfo info1 DistributedFileSystem dfs cluster getFileSystem dfs mkdirs foo dfs setSafeMode SafeModeAction SAFEMODE_ENTER info1 dfs rollingUpgrade RollingUpgradeAction PREPARE
assertEquals NEWLINE status assertFalse NameNodeAdapter safeModeInitializedReplQueues nn LOG info cluster restartDataNode dnprops remove getLongCounter getMetrics NN_METRICS cluster getStoragesPerDatanode safe NameNodeAdapter getSafeModeSafeBlocks nn assertTrue safe assertTrue safe assertTrue NameNodeAdapter safeModeInitializedReplQueues nn BlockManagerTestUtil updateState nn getNamesystem getBlockManager underReplicatedBlocks nn getNamesystem getUnderReplicatedBlocks underReplicatedBlocks safe
UserGroupInformation ugi UserGroupInformation loginUserFromKeytabAndReturnUGI hdfsPrincipal keytab
UserGroupInformation ugi UserGroupInformation loginUserFromKeytabAndReturnUGI hdfsPrincipal keytab LOG info ugi ugi Path zone Path fsWrapper mkdir zone FsPermission getDirDefault dfsAdmin createEncryptionZone zone testKey NO_TRASH Path zone1 Path fsWrapper mkdir zone1 FsPermission getDirDefault sleepInterval AUTH_TOKEN_VALIDITY
useFCOption positionReadOption String fname filenameOption rdBeginPos stat testWriteAndRead fname WR_NTIMES WR_CHUNK_SIZE rdBeginPos
currentPosition in getPos verboseOption LOG info pos currentPosition buffer length fname byteLeftToRead currentPosition byteToReadThisRound byteLeftToRead buffer length buffer length byteLeftToRead byteRead in read currentPosition buffer byteToReadThisRound byteRead in read buffer byteToReadThisRound byteRead chunkNumber totalByteRead byteRead currentPosition byteRead byteLeftToRead byteRead verboseOption
FSDataOutputStream out outBuffer BUFFER_SIZE inBuffer BUFFER_SIZE i i BUFFER_SIZE i outBuffer i i Path path getFullyQualifiedPath fname fileLengthBeforeOpen path truncateOption out useFCOption mfc create path EnumSet of CreateFlag OVERWRITE mfs create path truncateOption LOG info path out useFCOption mfc create path EnumSet of CreateFlag APPEND mfs append path fileLengthBeforeOpen getFileLengthFromNN path
out useFCOption mfc create path EnumSet of CreateFlag CREATE mfs create path totalByteWritten fileLengthBeforeOpen totalByteVisible fileLengthBeforeOpen totalByteWrittenButNotVisible toFlush i i i toFlush i writeData out outBuffer chunkSize totalByteWritten chunkSize toFlush out hflush totalByteVisible chunkSize totalByteWrittenButNotVisible totalByteWrittenButNotVisible
writeData out outBuffer chunkSize totalByteWritten chunkSize out hflush totalByteVisible chunkSize totalByteWrittenButNotVisible totalByteWrittenButNotVisible totalByteWrittenButNotVisible chunkSize LOG info chunkSize totalByteWritten totalByteVisible fname byteVisibleToRead readData fname inBuffer totalByteVisible readBeginPosition String readmsg totalByteWritten totalByteVisible byteVisibleToRead fname byteVisibleToRead totalByteVisible byteVisibleToRead totalByteWritten readmsg readmsg
byteVisibleToRead readData fname inBuffer totalByteVisible readBeginPosition String readmsg totalByteWritten totalByteVisible byteVisibleToRead fname byteVisibleToRead totalByteVisible byteVisibleToRead totalByteWritten readmsg readmsg countOfFailures readmsg readmsg IOException readmsg LOG info readmsg writeData out outBuffer chunkSize totalByteWritten chunkSize totalByteVisible chunkSize totalByteWrittenButNotVisible totalByteWrittenButNotVisible out close
String src fileLength expected StripedFileTestUtil generateBytes fileLength Path srcPath Path src DFSTestUtil writeFile fs srcPath String expected StripedFileTestUtil waitBlockGroupsReported fs src StripedFileTestUtil verifyLength fs srcPath fileLength dnIndex
fileLength dataDNFailureNum parityDNFailureNum String fileType fileLength blockSize dataBlocks String src dataDNFailureNum parityDNFailureNum fileType
List LocatedBlock locatedBlocks cluster getNameNode getRpcServer getBlockLocations TEST_FILE TEST_FILE_LEN getLocatedBlocks LocatedBlock lblock locatedBlocks get BlockReader blockReader blockReader BlockReaderTestUtil getBlockReader cluster getFileSystem lblock TEST_FILE_LEN Assert fail t Assert assertTrue t t getMessage contains blockReader blockReader close gotFailureLatch countDown shouldRetryLatch await
BlockReader blockReader blockReader BlockReaderTestUtil getBlockReader cluster getFileSystem lblock TEST_FILE_LEN Assert fail t Assert assertTrue t t getMessage contains blockReader blockReader close gotFailureLatch countDown shouldRetryLatch await blockReader BlockReaderTestUtil getBlockReader cluster getFileSystem lblock TEST_FILE_LEN t LOG error t t
BlockReader blockReader blockReader BlockReaderTestUtil getBlockReader cluster getFileSystem lblock TEST_FILE_LEN sem release blockReader readAll buf TEST_FILE_LEN sem acquireUninterruptibly e LOG info e sem release
printMemUsage totalStart System nanoTime totalTrials i i i StorageType type StorageType values i StorageType values length localStart System nanoTime totalTrials node cluster chooseRandom excluded assertNotNull node node type excluded add node excluded clear
excluded clear localEnd System nanoTime records i localEnd localStart totalEnd System nanoTime totalMs totalEnd totalStart NS_TO_MS LOG info totalMs totalMs OP_NUM totalTrials OP_NUM Thread sleep printMemUsage totalStart System nanoTime i i OP_NUM i StorageType type StorageType values i StorageType values length localStart System nanoTime node dfscluster chooseRandomWithStorageType excluded type assertNotNull node
totalStart System nanoTime totalTrials i i i localStart System nanoTime totalTrials node cluster chooseRandom excluded assertNotNull node node excluded add node excluded clear localEnd System nanoTime records i localEnd localStart
excluded clear localEnd System nanoTime records i localEnd localStart totalEnd System nanoTime totalMs totalEnd totalStart NS_TO_MS LOG info totalMs totalMs OP_NUM totalTrials OP_NUM Thread sleep printMemUsage totalStart System nanoTime i i OP_NUM i localStart System nanoTime node dfscluster chooseRandomWithStorageType excluded StorageType ARCHIVE assertNotNull node assertTrue isType node StorageType ARCHIVE
Thread sleep printMemUsage totalStart System nanoTime totalTrials totalTrials node cluster chooseRandom excluded assertNotNull node node excluded add node excluded clear totalEnd System nanoTime
excluded add node excluded clear totalEnd System nanoTime totalMs totalEnd totalStart NS_TO_MS LOG info totalMs totalMs OP_NUM totalTrials OP_NUM Thread sleep printMemUsage totalStart System nanoTime OP_NUM node dfscluster chooseRandomWithStorageType excluded StorageType DISK assertNotNull node assertTrue isType node StorageType DISK totalEnd System nanoTime
printMemUsage totalStart System nanoTime totalTrials localStart System nanoTime totalTrials node cluster chooseRandom excluded assertNotNull node node excluded add node excluded clear localEnd System nanoTime
excluded clear localEnd System nanoTime records i localEnd localStart totalEnd System nanoTime totalMs totalEnd totalStart NS_TO_MS LOG info totalMs totalMs OP_NUM totalTrials OP_NUM Thread sleep printMemUsage totalStart System nanoTime i i OP_NUM i localStart System nanoTime node dfscluster chooseRandomWithStorageType excluded StorageType ARCHIVE assertNotNull node assertTrue isType node StorageType ARCHIVE
printMemUsage totalStart System nanoTime totalTrials localStart System nanoTime totalTrials node cluster chooseRandom excluded assertNotNull node isType node StorageType ARCHIVE totalTrials excluded add node node dfscluster chooseRandomWithStorageType excluded StorageType ARCHIVE assertTrue isType node StorageType ARCHIVE excluded clear localEnd System nanoTime
message Runtime runtime Runtime getRuntime NumberFormat format NumberFormat getInstance StringBuilder sb StringBuilder sb append message maxMemory runtime maxMemory allocatedMemory runtime totalMemory freeMemory runtime freeMemory sb append format format freeMemory sb append format format allocatedMemory sb append format format maxMemory sb append format format freeMemory maxMemory allocatedMemory
qjm createNewUniqueEpoch assertEquals i qjm getLoggerSetForTests getEpoch qjm close prevEpoch i i i newEpoch qjm QuorumJournalManager conf uri FAKE_NSINFO FaultyLoggerFactory qjm createNewUniqueEpoch newEpoch qjm getLoggerSetForTests getEpoch
MiniJournalCluster cluster MiniJournalCluster Builder conf build cluster waitActive QuorumJournalManager qjm ret qjm createInjectableQJM cluster qjm format FAKE_NSINFO doWorkload cluster qjm SortedSet Integer ipcCounts Sets newTreeSet l qjm InvocationCountingChannel ch InvocationCountingChannel l ch waitForAllPendingCalls ipcCounts add ch getRpcCount assertEquals ipcCounts size ret ipcCounts first
MAX_IPC_NUMBER determineMaxIpcNumber failA failA MAX_IPC_NUMBER failA failB failB MAX_IPC_NUMBER failB String injectionStr failA failB
failA failA failA failB failB failB String injectionStr failA failB LOG info injectionStr MiniJournalCluster cluster MiniJournalCluster Builder conf build cluster waitActive QuorumJournalManager qjm qjm createInjectableQJM cluster qjm format FAKE_NSINFO List AsyncLogger loggers qjm getLoggerSetForTests getLoggersForTests failIpcNumber loggers get failA failIpcNumber loggers get failB lastAckedTxn doWorkload cluster qjm lastAckedTxn
seed userSpecifiedSeed GenericTestUtils setLogLevel ProtobufRpcEngine2 LOG Level ALL seed Random nextLong LOG info seed Random r Random seed MiniJournalCluster cluster MiniJournalCluster Builder conf build cluster waitActive QuorumJournalManager qjmForInitialFormat createInjectableQJM cluster qjmForInitialFormat format FAKE_NSINFO qjmForInitialFormat close txid lastAcked
QuorumJournalManager qjm createRandomFaultyQJM cluster r recovered recovered QJMTestUtil recoverAndReturnLastTxn qjm Throwable t LOG info t checkException t assertTrue recovered lastAcked recovered lastAcked txid recovered txid qjm purgeLogsOlderThan txid Holder Throwable thrown Holder Throwable
LOG info DFS_JOURNALNODE_RPC_BIND_HOST_KEY jCluster MiniJournalCluster Builder conf format numJournalNodes NUM_JN build jn jCluster getJournalNode String address getRpcServerAddress jn assertThat address not WILDCARD_ADDRESS
LOG info DFS_JOURNALNODE_HTTP_BIND_HOST_KEY conf set DFS_JOURNALNODE_HTTP_ADDRESS_KEY LOCALHOST_SERVER_ADDRESS jCluster MiniJournalCluster Builder conf format numJournalNodes NUM_JN build jn jCluster getJournalNode String address jn getHttpAddress toString assertFalse address startsWith WILDCARD_ADDRESS
LOG info DFS_JOURNALNODE_HTTPS_BIND_HOST_KEY setupSsl conf set DFS_HTTP_POLICY_KEY HttpConfig Policy HTTPS_ONLY name conf set DFS_JOURNALNODE_HTTPS_ADDRESS_KEY LOCALHOST_SERVER_ADDRESS jCluster MiniJournalCluster Builder conf format numJournalNodes NUM_JN build jn jCluster getJournalNode String address jn getHttpsAddress toString assertFalse address startsWith WILDCARD_ADDRESS
String ArrayList String ipList ArrayList String Enumeration NetworkInterface netInterfaceList NetworkInterface getNetworkInterfaces netInterfaceList NetworkInterface inf netInterfaceList nextElement Enumeration InetAddress addrList inf getInetAddresses addrList InetAddress addr addrList nextElement ipList add addr getHostAddress StringBuilder builder StringBuilder String ip ipList builder append ip builder append builder append builder append InetAddress getLocalHost getCanonicalHostName
capacities LOG info long2String capacities
capacities racks LOG info long2String capacities LOG info Arrays asList racks
capacities racks newCapacity LOG info long2String capacities LOG info Arrays asList racks LOG info newCapacity
capacities racks newCapacity newRack LOG info long2String capacities LOG info Arrays asList racks LOG info newCapacity LOG info newRack
conf sleeptime conf getLong DFSConfigKeys DFS_HEARTBEAT_INTERVAL_KEY DFSConfigKeys DFS_HEARTBEAT_INTERVAL_DEFAULT conf getLong DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_KEY DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_DEFAULT
namenodes conf sleeptime conf getLong DFSConfigKeys DFS_HEARTBEAT_INTERVAL_KEY DFSConfigKeys DFS_HEARTBEAT_INTERVAL_DEFAULT conf getLong DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_KEY DFSConfigKeys DFS_NAMENODE_REDUNDANCY_INTERVAL_SECONDS_DEFAULT LOG info namenodes
cluster getConfiguration setInt DFSConfigKeys DFS_REPLICATION_KEY conf setInt DFSConfigKeys DFS_REPLICATION_KEY cluster startDataNodes conf dnCapacities cluster waitClusterUp cluster waitActive Path path Path DistributedFileSystem fs cluster getFileSystem DFSTestUtil createFile fs path blockSize rep seed cluster startDataNodes conf dnCapacities cluster triggerHeartbeats List NameNodeConnector connectors Collections emptyList BalancerParameters bParams BalancerParameters DEFAULT connectors NameNodeConnector newNameNodeConnectors DFSUtil getInternalNsRpcUris conf Balancer getSimpleName Balancer BALANCER_ID_PATH conf bParams getMaxIdleIteration NameNodeConnector connectors
Configuration conf HdfsConfiguration initConf conf capacities CAPACITY String racks String RACK0 newCapacity CAPACITY String newRack RACK0
Configuration conf HdfsConfiguration initConf conf capacities CAPACITY String racks String RACK0 newCapacity CAPACITY String newRack RACK0 LOG info long2String capacities
Configuration conf HdfsConfiguration initConf conf capacities CAPACITY String racks String RACK0 newCapacity CAPACITY String newRack RACK0 LOG info long2String capacities LOG info Arrays asList racks
Configuration conf HdfsConfiguration initConf conf capacities CAPACITY String racks String RACK0 newCapacity CAPACITY String newRack RACK0 LOG info long2String capacities LOG info Arrays asList racks LOG info newCapacity
lengths capacities replication totalUsed capacities length sum lengths Arrays fill capacities cluster MiniDFSCluster Builder conf numDataNodes capacities length simulatedCapacities capacities build DistributedFileSystem dfs cluster getFileSystem cluster waitActive client NameNodeProxies createProxy conf dfs getUri ClientProtocol getProxy i i lengths length i size lengths i Path p Path i size out dfs p j j size j out write j cluster startDataNodes conf capacities length capacities
capacities replication totalUsed capacities length sum lengths Arrays fill capacities cluster MiniDFSCluster Builder conf numDataNodes capacities length simulatedCapacities capacities build DistributedFileSystem dfs cluster getFileSystem cluster waitActive client NameNodeProxies createProxy conf dfs getUri ClientProtocol getProxy i i lengths length i size lengths i Path p Path i size out dfs p j j size j out write j cluster startDataNodes conf capacities length capacities LOG info Arrays toString capacities
totalUsed capacities length sum lengths Arrays fill capacities cluster MiniDFSCluster Builder conf numDataNodes capacities length simulatedCapacities capacities build DistributedFileSystem dfs cluster getFileSystem cluster waitActive client NameNodeProxies createProxy conf dfs getUri ClientProtocol getProxy i i lengths length i size lengths i Path p Path i size out dfs p j j size j out write j cluster startDataNodes conf capacities length capacities LOG info Arrays toString capacities LOG info totalUsed
getBlocksMaxQps Configuration conf HdfsConfiguration initConf conf conf setInt DFSConfigKeys DFS_BALANCER_DISPATCHERTHREADS_KEY conf setInt DFSConfigKeys DFS_NAMENODE_GETBLOCKS_MAX_QPS_KEY getBlocksMaxQps numDNs capacities numDNs String racks String numDNs i i numDNs i capacities i CAPACITY racks i i numDNs RACK0 RACK1 doTest conf capacities racks CAPACITY RACK2 PortNumberBasedNodes assertTrue getBlocksMaxQps numGetBlocksCalls get getBlocksMaxQps durationMs endGetBlocksTime get startGetBlocksTime get durationSec Math ceil durationMs
totalUsed totalCapacity avg totalUsed totalCapacity
preReports postReports Assert assertNotNull preReports Assert assertNotNull postReports Assert assertEquals preReports length postReports length preReport preReports String dnUuid preReport getDatanodeInfo getDatanodeUuid postReport postReports postReport getDatanodeInfo getDatanodeUuid dnUuid Assert assertEquals getTotalPoolUsage preReport getTotalPoolUsage postReport
racks nDataNodes racks length capacities nDataNodes Arrays fill capacities CAPACITY
nNameNodes racks nDataNodes racks length capacities nDataNodes Arrays fill capacities CAPACITY LOG info nNameNodes nDataNodes Assert assertEquals nDataNodes racks length
cluster file DistributedFileSystem dfs cluster getFileSystem BlockManager blockManager cluster getNamesystem getBlockManager LocatedBlock lb DFSTestUtil getAllBlocks dfs file get BlockInfo blockInfo blockManager getStoredBlock lb getBlock getLocalBlock Iterator DatanodeStorageInfo itr blockInfo getStorageInfos
failure what failure compareAndSet what
Configuration conf Configuration conf setInt DFS_NAMENODE_MAX_FULL_BLOCK_REPORT_LEASES conf setLong DFS_NAMENODE_FULL_BLOCK_REPORT_LEASE_LENGTH_MS Semaphore fbrSem Semaphore HashSet DatanodeID expectedFbrDns HashSet HashSet DatanodeID fbrDns HashSet AtomicReference String failure AtomicReference String numLeases DatanodeID
LOG info nodeID Long toHexString context getLeaseId context getLeaseId setFailure failure nodeID fbrSem acquireUninterruptibly fbrDns add nodeID expectedFbrDns nodeID setFailure failure nodeID Joiner on join expectedFbrDns LOG info nodeID Long toHexString context getLeaseId node numLeases expectedFbrDns add node
fbrSem acquireUninterruptibly fbrDns add nodeID expectedFbrDns nodeID setFailure failure nodeID Joiner on join expectedFbrDns LOG info nodeID Long toHexString context getLeaseId node leaseId leaseId numLeases expectedFbrDns add node LOG info node Long toHexString leaseId Joiner on join expectedFbrDns numLeases setFailure failure
String poolId cluster getNamesystem getBlockPoolId DatanodeRegistration reg InternalDataNodeTestUtils getDNRegistrationForBP cluster getDataNodes get poolId cluster stopDataNode DFSTestUtil waitForDatanodeState cluster reg getDatanodeUuid FileSystem fs cluster getFileSystem DFSTestUtil createFile fs filePath replicationFactor ExtendedBlock b DFSTestUtil getFirstBlock fs filePath DFSTestUtil waitReplication cluster getFileSystem filePath replicationFactor cluster startDataNodes conf String cluster waitActive DFSTestUtil waitForReplication cluster b replicationFactor fail String fsckOp DFSTestUtil runFsck conf filePath toString
FSNamesystem fsn Mockito mock FSNamesystem Mockito when fsn hasWriteLock thenReturn DatanodeManager dm mockDatanodeManager fsn Configuration Random rng Random seed rng nextInt rng Random seed
FSNamesystem fsn Mockito mock FSNamesystem Mockito when fsn hasWriteLock thenReturn DatanodeManager dm mockDatanodeManager fsn Configuration Random rng Random seed rng nextInt rng Random seed LOG info seed HashMap String DatanodeRegistration sIdToDnReg HashMap String DatanodeRegistration rng sIdToDnReg size randomIndex rng nextInt sIdToDnReg size Iterator Map Entry String DatanodeRegistration it sIdToDnReg entrySet iterator randomIndex it next DatanodeRegistration toRemove it next getValue
dm removeDatanode toRemove it remove String storageID rng nextInt DatanodeRegistration dr Mockito mock DatanodeRegistration Mockito when dr getDatanodeUuid thenReturn storageID sIdToDnReg storageID dr sIdToDnReg get storageID rng dr setIpAddr dr getIpAddr String ip storageID Mockito when dr getIpAddr thenReturn ip Mockito when dr getXferAddr thenReturn ip Mockito when dr getXferPort thenReturn
dn datanodeToRemoveStorageFrom dn datanodeToRemoveStorageFromIdx StorageLocation volumeLocationToRemove volumes datanodeToRemoveStorageFrom assertEquals NUM_STORAGES_PER_DN volumes size volume volumes volume volumeLocationToRemove volume getStorageLocation assertNotNull volumeLocationToRemove datanodeToRemoveStorageFrom shutdown FileUtil fullyDelete File volumeLocationToRemove getUri FileOutputStream fos FileOutputStream File volumeLocationToRemove getUri
assertEquals NUM_STORAGES_PER_DN volumes size volume volumes volume storageIdToRemove volumeLocationToRemove volume getStorageLocation assertNotNull volumeLocationToRemove datanodeToRemoveStorageFrom shutdown FileUtil fullyDelete File volumeLocationToRemove getUri FileOutputStream fos FileOutputStream File volumeLocationToRemove getUri fos write fos close cluster restartDataNode datanodeToRemoveStorageFromIdx LOG info storageIdToRemove
String newStorageId DatanodeStorage generateUuid File currentDir File File volumeRefs get getStorageLocation getUri File versionFile File currentDir rewriteVersionFile versionFile newStorageId volumeRefs close ExtendedBlock block DFSTestUtil getFirstBlock fs TEST_PATH cluster restartDataNodes get cluster getNamesystem writeLock Iterator DatanodeStorageInfo storageInfoIter cluster getNamesystem getBlockManager getStorages block getLocalBlock iterator storageInfoIter
rewriteVersionFile versionFile newStorageId volumeRefs close ExtendedBlock block DFSTestUtil getFirstBlock fs TEST_PATH cluster restartDataNodes cluster getNamesystem writeLock Iterator DatanodeStorageInfo storageInfoIter cluster getNamesystem getBlockManager getStorages block getLocalBlock iterator storageInfoIter LOG info block getBlockName DatanodeStorageInfo info storageInfoIter next newStorageId info
volumeRefs close ExtendedBlock block DFSTestUtil getFirstBlock fs TEST_PATH cluster restartDataNodes cluster getNamesystem writeLock Iterator DatanodeStorageInfo storageInfoIter cluster getNamesystem getBlockManager getStorages block getLocalBlock iterator storageInfoIter LOG info block getBlockName DatanodeStorageInfo info storageInfoIter next newStorageId info getStorageID LOG info block getBlockName newStorageId info getStorageID
FSNamesystem namesystem cluster getNamesystem FileSystem fs cluster getFileSystem Path testPath Path out fs create testPath out writeBytes testPath out hsync cluster startDataNodes conf ExtendedBlock blk DFSTestUtil getFirstBlock fs testPath MaterializedReplica replica cluster getMaterializedReplica blk replica deleteData replica deleteMeta out close liveReplicas liveReplicas namesystem blk liveReplicas
cluster startDataNodes conf ExtendedBlock blk DFSTestUtil getFirstBlock fs testPath MaterializedReplica replica cluster getMaterializedReplica blk replica deleteData replica deleteMeta out close liveReplicas liveReplicas blk liveReplicas LOG info liveReplicas Thread sleep assertEquals liveReplicas liveReplicas blk liveReplicas
LOG info Arrays asList hosts Arrays asList racks cluster MiniDFSCluster Builder conf racks racks hosts hosts numDataNodes hosts length build cluster waitActive fs cluster getFileSystem fs enableErasureCodingPolicy StripedFileTestUtil getDefaultECPolicy getName fs setErasureCodingPolicy Path StripedFileTestUtil getDefaultECPolicy getName FSNamesystem fsn cluster getNamesystem BlockManager bm fsn getBlockManager MiniDFSCluster DataNodeProperties lastHost stopDataNode hosts hosts length Path file Path DFSTestUtil createFile fs file cellSize dataBlocks GenericTestUtils waitFor bm numOfUnderReplicatedBlocks
BlockManager bm fsn getBlockManager MiniDFSCluster DataNodeProperties lastHost stopDataNode hosts hosts length Path file Path DFSTestUtil createFile fs file cellSize dataBlocks GenericTestUtils waitFor bm numOfUnderReplicatedBlocks LOG info file INodeFile fileNode fsn getFSDirectory getINode4Write file toString asFile BlockInfoStriped blockInfo BlockInfoStriped fileNode getLastBlock Set String rackSet HashSet storage blockInfo rackSet add storage getDatanodeDescriptor getNetworkLocation Assert assertEquals rackSet dataBlocks rackSet size cluster restartDataNode lastHost cluster waitActive NetworkTopology topology bm getDatanodeManager getNetworkTopology
blockGroupIdInitialValue blockGrpIdGenerator getCurrentValue Path path Path ecDir DFSTestUtil createFile fs path cellSize fileLen blockSize REPLICATION SEED List LocatedBlock blocks DFSTestUtil getAllBlocks fs path assertThat blocks size is blockGrpCount blockGrpIdGenerator setCurrentValue blockGroupIdInitialValue i i blocks size i blockGrpIdGenerator skipTo blockGrpIdGenerator getCurrentValue BLOCK_GROUP_INDEX_MASK MAX_BLOCKS_IN_GROUP nextBlockExpectedId blockGrpIdGenerator getCurrentValue nextBlockGrpId blocks get i getBlock getBlockId
Configuration conf HdfsConfiguration conf setInt DFSConfigKeys DFS_REPLICATION_KEY MiniDFSCluster cluster MiniDFSCluster Builder conf numDataNodes build cluster waitActive FileSystem fs cluster getFileSystem Path path Path DFSTestUtil createFile fs path IO_SIZE BLOCK_SIZE BLOCK_SIZE REPLICATION SEED List LocatedBlock blocks DFSTestUtil getAllBlocks fs path LOG info blocks get getBlock getBlockId nextBlockExpectedId blocks get getBlock getBlockId i i blocks i nextBlockId blocks get i getBlock getBlockId
String json tracker getJson
List String decommissionedNodes List LocatedBlock lbs i i lbs i LocatedBlock blk lbs get i DatanodeInfo nodes blk getLocations List String decommissionedNodeList decommissionedNodes get i j j nodes j DatanodeInfo dnInfo nodes j
URI u Util stringAsURI RELATIVE_FILE_PATH
LOG info URI_UNIX URI u Util stringAsURI URI_UNIX
LOG info URI_UNIX URI u Util stringAsURI URI_UNIX LOG info u assertNotNull u assertEquals URI_FILE_SCHEMA u getScheme assertEquals URI_PATH_UNIX u getPath LOG info URI_WINDOWS u Util stringAsURI URI_WINDOWS
Mockito when request getMethod thenReturn Mockito when request getRequestURI thenReturn StringBuffer WebHdfsFileSystem PATH_PREFIX toString Mockito when request getQueryString thenReturn Mockito when request getRemoteAddr thenReturn HttpServletResponse response Mockito mock HttpServletResponse chain doFilter Filter filter HostRestrictingAuthorizationFilter configs configs put AuthenticationFilter AUTH_TYPE FilterConfig fc DummyFilterConfig configs filter init fc filter doFilter request response chain
corruptedGs corruptedLen reportIndex DatanodeStorage BlockListAsLongs kvPair DatanodeStorage dnStorage kvPair getKey BlockListAsLongs blockList kvPair getValue BlockListAsLongs Builder builder BlockListAsLongs builder block blockList corruptedGs gsOld block getGenerationStamp gsNew gsNew rand nextInt gsNew gsOld block setGenerationStamp gsNew
gsOld block getGenerationStamp gsNew gsNew rand nextInt gsNew gsOld block setGenerationStamp gsNew LOG info block corruptedGs lenOld block getNumBytes lenNew lenNew rand nextInt lenOld lenNew lenOld block setNumBytes lenNew
String METHOD_NAME GenericTestUtils getMethodName Path filePath Path METHOD_NAME ArrayList Block blocks prepareForRide filePath METHOD_NAME FILE_SIZE
ArrayList Block blocks prepareForRide filePath METHOD_NAME FILE_SIZE LOG LOG debug blocks size oldLengths blocks size tempLen i i blocks size i Block b blocks get i LOG LOG debug b getBlockName b getNumBytes oldLengths i b getNumBytes LOG LOG debug tempLen rand nextInt BLOCK_SIZE b set b getBlockId tempLen b getGenerationStamp LOG
LOG LOG debug b getBlockName b getNumBytes oldLengths i b getNumBytes LOG LOG debug tempLen rand nextInt BLOCK_SIZE b set b getBlockId tempLen b getGenerationStamp LOG LOG debug b getBlockName b getNumBytes DataNode dn cluster getDataNodes get DN_N0 String poolId cluster getNamesystem getBlockPoolId DatanodeRegistration dnR dn getDNRegistrationForBP poolId StorageBlockReport reports getBlockReports dn poolId sendBlockReports dnR poolId reports List LocatedBlock blocksAfterReport DFSTestUtil getAllBlocks fs open filePath
String METHOD_NAME GenericTestUtils getMethodName
String METHOD_NAME GenericTestUtils getMethodName LOG info METHOD_NAME Path filePath Path METHOD_NAME DFSTestUtil createFile fs filePath FILE_SIZE REPL_FACTOR rand nextLong File dataDir File cluster getDataDirectory assertTrue dataDir isDirectory List ExtendedBlock blocks2Remove ArrayList ExtendedBlock List Integer removedIndex ArrayList Integer List LocatedBlock lBlocks cluster getNameNodeRpc getBlockLocations filePath toString FILE_START FILE_SIZE getLocatedBlocks removedIndex size newRemoveIndex rand nextInt lBlocks size removedIndex contains newRemoveIndex removedIndex add newRemoveIndex Integer aRemovedIndex removedIndex blocks2Remove add lBlocks get aRemovedIndex getBlock LOG
File dataDir File cluster getDataDirectory assertTrue dataDir isDirectory List ExtendedBlock blocks2Remove ArrayList ExtendedBlock List Integer removedIndex ArrayList Integer List LocatedBlock lBlocks cluster getNameNodeRpc getBlockLocations filePath toString FILE_START FILE_SIZE getLocatedBlocks removedIndex size newRemoveIndex rand nextInt lBlocks size removedIndex contains newRemoveIndex removedIndex add newRemoveIndex Integer aRemovedIndex removedIndex blocks2Remove add lBlocks get aRemovedIndex getBlock LOG LOG debug lBlocks size DataNode dn0 cluster getDataNodes get DN_N0 ExtendedBlock blocks2Remove LOG
newRemoveIndex rand nextInt lBlocks size removedIndex contains newRemoveIndex removedIndex add newRemoveIndex aRemovedIndex removedIndex blocks2Remove add lBlocks get aRemovedIndex getBlock LOG LOG debug lBlocks size DataNode dn0 cluster getDataNodes get DN_N0 b blocks2Remove LOG LOG debug b getBlockName b getBlockName DataNodeTestUtils getFSDataset dn0 unfinalizeBlock b LOG warn b getBlockName
numConcurrentBlockReports DataNode dn cluster getDataNodes get DN_N0 String poolId cluster getNamesystem getBlockPoolId
tooLongWait TIMEOUT
cluster getDataNodes size DN_N1 waitTil LOG LOG debug cluster getDataNodes size cluster waitActive DataNode dn1 cluster getDataNodes get DN_N1 String bpid cluster getNamesystem getBlockPoolId Replica r DataNodeTestUtils fetchReplicaInfo dn1 bpid bl getBlockId start Time monotonicNow count r waitTil r DataNodeTestUtils fetchReplicaInfo dn1 bpid bl getBlockId waiting_period Time monotonicNow start count LOG
Replica r DataNodeTestUtils fetchReplicaInfo dn1 bpid bl getBlockId start Time monotonicNow count r waitTil r DataNodeTestUtils fetchReplicaInfo dn1 bpid bl getBlockId waiting_period Time monotonicNow start count LOG LOG debug waiting_period waiting_period TIMEOUT assertTrue tooLongWait HdfsServerConstants ReplicaState state r getState LOG LOG debug state getValue start Time monotonicNow state HdfsServerConstants ReplicaState
r waitTil r DataNodeTestUtils fetchReplicaInfo dn1 bpid bl getBlockId waiting_period Time monotonicNow start LOG LOG debug waiting_period waiting_period TIMEOUT assertTrue tooLongWait HdfsServerConstants ReplicaState state r getState LOG LOG debug state getValue start Time monotonicNow state HdfsServerConstants ReplicaState waitTil state r getState LOG
ArrayList Block ArrayList Block newList ArrayList Block
Mockito when mockNN1 sendHeartbeat Mockito any DatanodeRegistration Mockito any StorageReport Mockito anyLong Mockito anyLong Mockito anyInt Mockito anyInt Mockito anyInt Mockito any VolumeFailureSummary Mockito anyBoolean Mockito any SlowPeerReports Mockito any SlowDiskReports thenAnswer HeartbeatAnswer thenAnswer HeartbeatRegisterAnswer thenAnswer HeartbeatAnswer Mockito when mockNN1 Mockito any DatanodeRegistration Mockito Mockito any Mockito any BlockReportContext thenAnswer invocation BlockReportContext context BlockReportContext invocation getArguments leaseId context getLeaseId
ExecutorCompletionService Boolean verifyService ExecutorCompletionService executor AtomicLong verifyFileTime AtomicLong Path file createService take get verifyService Boolean Boolean start Time monotonicNow verifyFile file dfs verifyFileTime addAndGet Time monotonicNow start Assert assertTrue verifyService take get
ExecutorCompletionService Boolean verifyService ExecutorCompletionService executor AtomicLong verifyFileTime AtomicLong Path file createService take get verifyService Boolean Boolean start Time monotonicNow verifyFile file dfs verifyFileTime addAndGet Time monotonicNow start Assert assertTrue verifyService take get
String name dn MetricsRecordBuilder m MetricsAsserts getMetrics dn getMetrics name ibr MetricsAsserts getLongCounter name m
seed numBlocks String name f getName i name indexOf seed Long parseLong name substring i numBlocks Integer parseInt name substring i computed IO_BUF get expected VERIFY_BUF get in f i i numBlocks i in read computed nextBytes i seed expected Assert assertArrayEquals expected computed
String fileName nestingLevel String blockFileSubdir makeRandomBlockFileSubdir nestingLevel String blockFileName fileName String testFilePath storage getSingularStorageDir getRoot File separator Storage STORAGE_DIR_CURRENT blockFileSubdir blockFileName String expectedTrashPath storage getSingularStorageDir getRoot File separator BlockPoolSliceStorage TRASH_ROOT_DIR blockFileSubdir substring blockFileSubdir length
String fileName nestingLevel String blockFileSubdir makeRandomBlockFileSubdir nestingLevel String blockFileName fileName String testFilePath storage getSingularStorageDir getRoot File separator Storage STORAGE_DIR_CURRENT blockFileSubdir blockFileName String expectedTrashPath storage getSingularStorageDir getRoot File separator BlockPoolSliceStorage TRASH_ROOT_DIR blockFileSubdir substring blockFileSubdir length LOG info blockFileSubdir
String fileName nestingLevel BlockPoolSliceStorage storage makeBlockPoolStorage String blockFileSubdir makeRandomBlockFileSubdir nestingLevel String blockFileName fileName String deletedFilePath storage getSingularStorageDir getRoot File separator BlockPoolSliceStorage TRASH_ROOT_DIR blockFileSubdir blockFileName String expectedRestorePath storage getSingularStorageDir getRoot File separator Storage STORAGE_DIR_CURRENT blockFileSubdir substring blockFileSubdir length
AtomicReference String failure AtomicReference String Collection RecoveringBlock recoveringBlocks initRecoveringBlocks RecoveringBlock recoveringBlock Iterators get recoveringBlocks iterator ExtendedBlock block recoveringBlock getBlock LOG debug ReplicaHandler replicaHandler spyDN data createRbw StorageType DISK block replicaHandler close LOG debug progressParent sem release terminateSlowWriter uninterruptiblyAcquire LOG debug
LOG debug progressParent sem release terminateSlowWriter uninterruptiblyAcquire LOG debug t LOG error t failure compareAndSet t getMessage slowWriterThread start progressParent uninterruptiblyAcquire run LOG debug tswr opName tswr run recoveringBlock
terminateSlowWriter uninterruptiblyAcquire LOG debug t LOG error t failure compareAndSet t getMessage slowWriterThread start progressParent uninterruptiblyAcquire run LOG debug tswr opName tswr run recoveringBlock LOG debug tswr opName t
isNewNode isNewNode newNode node assertTrue newNode DatanodeInfo source ArrayList DatanodeInfo proxies ArrayList DatanodeInfo DatanodeInfo node node newNode node newNode source node proxies add node assertTrue source proxies size
newNode node assertTrue newNode DatanodeInfo source ArrayList DatanodeInfo proxies ArrayList DatanodeInfo DatanodeInfo node node newNode node newNode source node proxies add node assertTrue source proxies size LOG info newNode b assertFalse replaceBlock b source newNode proxies get
newNode node assertTrue newNode DatanodeInfo source ArrayList DatanodeInfo proxies ArrayList DatanodeInfo DatanodeInfo node node newNode node newNode source node proxies add node assertTrue source proxies size LOG info newNode b assertFalse replaceBlock b source newNode proxies get
assertTrue newNode DatanodeInfo source ArrayList DatanodeInfo proxies ArrayList DatanodeInfo DatanodeInfo node node newNode node newNode source node proxies add node assertTrue source proxies size LOG info newNode b assertFalse replaceBlock b source newNode proxies get LOG info proxies get b assertFalse replaceBlock b source proxies get proxies get LOG info source proxies get newNode
LocatedBlock lb dfs getClient getLocatedBlocks fileName get DatanodeInfo oldNodes lb getLocations assertEquals oldNodes length DatanodeInfo source oldNodes ExtendedBlock b lb getBlock DatanodeInfo datanodes dfs getDataNodeStats DatanodeInfo destin DatanodeInfo datanodeInfo datanodes oldNodes equals datanodeInfo destin datanodeInfo assertNotNull destin assertFalse source equals destin i i cluster getDataNodes i DataNode dn cluster getDataNodes get i
Thread sleep List LocatedBlock blocks client getNamenode getBlockLocations fileName fileLen getLocatedBlocks assertEquals blocks size DatanodeInfo nodes blocks get getLocations notDone nodes length replFactor notDone LOG info replFactor nodes length List DatanodeInfo nodeLocations Arrays asList nodes DatanodeInfo nodeLocations notDone
assertEquals blocks size DatanodeInfo nodes blocks get getLocations notDone nodes length replFactor notDone LOG info replFactor nodes length List DatanodeInfo nodeLocations Arrays asList nodes DatanodeInfo node nodeLocations node notDone LOG info node String expectedNodesList String currentNodesList
DatanodeInfo nodes blocks get getLocations notDone nodes length replFactor notDone LOG info replFactor nodes length List DatanodeInfo nodeLocations Arrays asList nodes DatanodeInfo node includeNodes nodeLocations node notDone LOG info node String expectedNodesList String currentNodesList DatanodeInfo dn includeNodes expectedNodesList dn
Path fileName Path DFSTestUtil createFile fs fileName DFSTestUtil waitReplication fs fileName client DFSClient cluster getFileSystem getUri conf List LocatedBlock locatedBlocks client getNamenode getBlockLocations getLocatedBlocks assertTrue locatedBlocks size assertTrue locatedBlocks get getLocations length cluster startDataNodes conf assertEquals cluster getDataNodes size DataNode dn0 cluster getDataNodes get DataNode dn1 cluster getDataNodes get String activeNNBPId cluster getNamesystem getBlockPoolId DatanodeDescriptor sourceDnDesc NameNodeAdapter getDatanode cluster getNamesystem dn0 getDNRegistrationForBP activeNNBPId DatanodeDescriptor destDnDesc NameNodeAdapter getDatanode cluster getNamesystem dn1 getDNRegistrationForBP activeNNBPId ExtendedBlock block DFSTestUtil getFirstBlock fs fileName
List BPOfferService bpos ctx datanode getAllBpOs assertEquals bpos size BlockIterator iter volume newBlockIterator ctx bpids assertEquals ctx bpids iter getBlockPoolId iter setMaxStalenessMs maxStaleness HashSet ExtendedBlock blocks HashSet ExtendedBlock blockIdx blockIdx blockIdx blocks add ctx getFileBlock blockIdx ExtendedBlock block iter nextBlock block blocksProcessed
ExtendedBlock block iter nextBlock block blocksProcessed LOG info volume block blocksProcessed savedBlock savedBlock block loadedBlock loadedBlock block assertEquals savedBlock loadedBlock blockRemoved blocks remove block assertTrue block blockRemoved blocksProcessed
blocksProcessed LOG info volume block blocksProcessed testedSave savedBlock savedBlock block loadedBlock loadedBlock block assertEquals savedBlock loadedBlock blockRemoved blocks remove block assertTrue block blockRemoved blocksProcessed numFiles testedSave LOG info blocksProcessed numFiles iter save testedSave savedBlocksProcessed blocksProcessed
loadedBlock loadedBlock block assertEquals savedBlock loadedBlock blockRemoved blocks remove block assertTrue block blockRemoved blocksProcessed numFiles testedSave LOG info blocksProcessed numFiles iter save testedSave savedBlocksProcessed blocksProcessed blocksProcessed numFiles LOG info blocksProcessed numFiles iter rewind
TestScanResultHandler Info info TestScanResultHandler getInfo ctx volumes get info info shouldRun info notify get TestScanResultHandler Info info TestScanResultHandler getInfo ctx volumes get numFoundBlocks StringBuilder foundBlocksBld StringBuilder String prefix info block info assertTrue expectedBlocks contains block numFoundBlocks foundBlocksBld append prefix append block
assertEquals info blocksScanned info shouldRun ctx datanode shutdown URI vURI ctx volumes get getStorageLocation getUri File cursorPath File File File File vURI ctx bpids assertTrue cursorPath getAbsolutePath cursorPath exists Set ExtendedBlock prevGoodBlocks HashSet ExtendedBlock info info sem Semaphore prevGoodBlocks addAll info goodBlocks info goodBlocks clear ctx cluster restartDataNode info info shouldRun info notify
conf setLong DFS_DATANODE_SCAN_PERIOD_HOURS_KEY conf set INTERNAL_VOLUME_SCANNER_SCAN_RESULT_HANDLER TestScanResultHandler getName TestContext ctx TestContext conf BYTES_SCANNED_PER_FILE TOTAL_FILES ctx createFiles TOTAL_FILES TestScanResultHandler Info info TestScanResultHandler getInfo ctx volumes get info info shouldRun info notify get info Statistics stats ctx blockScanner getVolumeStats ctx volumes get getStorageID stats
conf setLong INTERNAL_DFS_BLOCK_SCANNER_CURSOR_SAVE_INTERVAL_MS TestContext ctx TestContext conf NUM_EXPECTED_BLOCKS ctx createFiles NUM_EXPECTED_BLOCKS TestScanResultHandler Info info TestScanResultHandler getInfo ctx volumes get String storageID ctx volumes get getStorageID info info sem Semaphore info shouldRun info notify LOG info get info info
ctx createFiles NUM_EXPECTED_BLOCKS TestScanResultHandler Info info TestScanResultHandler getInfo ctx volumes get String storageID ctx volumes get getStorageID info info sem Semaphore info shouldRun info notify LOG info get info info LOG info info
LOG info info info assertEquals info goodBlocks size info goodBlocks clear assertEquals info blocksScanned assertEquals info badBlocks size info blocksScanned ExtendedBlock first ctx getFileBlock ctx datanode getBlockScanner markSuspectBlock storageID first info sem release LOG info
info assertEquals info goodBlocks size info goodBlocks clear assertEquals info blocksScanned assertEquals info badBlocks size info blocksScanned ExtendedBlock first ctx getFileBlock ctx datanode getBlockScanner markSuspectBlock storageID first info sem release LOG info info info blocksScanned
info info blocksScanned LOG info info LOG info info info assertTrue first info goodBlocks contains first assertEquals info goodBlocks size info goodBlocks clear assertEquals info badBlocks size assertEquals info blocksScanned info blocksScanned
LOG info info info assertTrue first info goodBlocks contains first assertEquals info goodBlocks size info goodBlocks clear assertEquals info badBlocks size assertEquals info blocksScanned info blocksScanned ctx datanode getBlockScanner markSuspectBlock storageID first info sem release LOG info
ctx createFiles NUM_FILES MaterializedReplica unreachableReplica ctx getMaterializedReplica ExtendedBlock unreachableBlock ctx getFileBlock unreachableReplica makeUnreachable TestScanResultHandler Info info TestScanResultHandler getInfo ctx volumes get String storageID ctx volumes get getStorageID info info sem Semaphore NUM_FILES info shouldRun info notify LOG info get info info NUM_FILES
unreachableReplica makeUnreachable TestScanResultHandler Info info TestScanResultHandler getInfo ctx volumes get String storageID ctx volumes get getStorageID info info sem Semaphore NUM_FILES info shouldRun info notify LOG info get info info blocksScanned NUM_FILES LOG info info blocksScanned info
info LOG info info info
FSDataInputStream fis totalRead fis fs open p dropBehind fis setDropBehind dropBehind buf length amt length buf length buf length length ret fis read buf amt ret totalRead totalRead ret length ret
fileName fileLen deadNodeIndex assertTrue fileLen assertTrue deadNodeIndex deadNodeIndex numDNs Path file Path fileName data StripedFileTestUtil generateBytes fileLen DFSTestUtil writeFile fs file data StripedFileTestUtil waitBlockGroupsReported fs fileName LocatedBlocks locatedBlocks StripedFileTestUtil getLocatedBlocks file fs LocatedStripedBlock lastBlock LocatedStripedBlock locatedBlocks getLastLocatedBlock assertTrue lastBlock getLocations length deadNodeIndex DataNode toCorruptDn cluster getDataNode lastBlock getLocations deadNodeIndex getIpcPort
dn data Mockito spy data newVolumeCount List Thread addVolumeDelayedThreads Collections synchronizedList ArrayList AtomicBoolean addVolumeError AtomicBoolean AtomicBoolean listStorageError AtomicBoolean CountDownLatch addVolumeCompletionLatch CountDownLatch newVolumeCount Thread Thread addVolumeCompletionLatch newVolumeCount i i dn getStorage listStorageDirectories listStorageError set
LOG error e listStorageThread start invocationOnMock Random r Random Thread Thread r setSeed Time now r nextInt s r nextInt Thread sleep s invocationOnMock callRealMethod
DataNode dn cluster getDataNodes get i i i DFSTestUtil writeFile cluster getFileSystem Path String valueOf i DataNodeTestUtils triggerBlockReport dn MBeanServer mbs ManagementFactory getPlatformMBeanServer ObjectName mxbeanName ObjectName String bpActorInfo String mbs getAttribute mxbeanName Assert assertEquals dn getBPServiceActorInfo bpActorInfo LOG info bpActorInfo ArrayList Map String String typeRef ArrayList Map String String ArrayList Map String String bpActorInfoList ObjectMapper readValue bpActorInfo typeRef maxDataLength Integer valueOf bpActorInfoList get get confMaxDataLength dn getConf getInt CommonConfigurationKeys IPC_MAXIMUM_DATA_LENGTH CommonConfigurationKeys IPC_MAXIMUM_DATA_LENGTH_DEFAULT maxBlockReportSize Integer valueOf bpActorInfoList get get
i i i DFSTestUtil writeFile cluster getFileSystem Path String valueOf i DataNodeTestUtils triggerBlockReport dn MBeanServer mbs ManagementFactory getPlatformMBeanServer ObjectName mxbeanName ObjectName String bpActorInfo String mbs getAttribute mxbeanName Assert assertEquals dn getBPServiceActorInfo bpActorInfo LOG info bpActorInfo ArrayList Map String String typeRef ArrayList Map String String ArrayList Map String String bpActorInfoList ObjectMapper readValue bpActorInfo typeRef maxDataLength Integer valueOf bpActorInfoList get get confMaxDataLength dn getConf getInt CommonConfigurationKeys IPC_MAXIMUM_DATA_LENGTH CommonConfigurationKeys IPC_MAXIMUM_DATA_LENGTH_DEFAULT maxBlockReportSize Integer valueOf bpActorInfoList get get LOG info maxDataLength
assertEquals datanodes size DataNode datanode datanodes get MetricsRecordBuilder rb getMetrics datanode getMetrics name LONG_FILE_LEN startWriteValue getLongCounter rb startReadValue getLongCounter rb AtomicInteger x AtomicInteger get x getAndIncrement DFSTestUtil createFile fs Path x get LONG_FILE_LEN Time monotonicNow DFSTestUtil readFile fs Path x get fs delete Path x get
cluster waitActive NameNode nn1 cluster getNameNode NameNode nn2 cluster getNameNode assertNotNull nn1 assertNotNull nn2 String bpid1 FSImageTestUtil getFSImage nn1 getBlockPoolID String bpid2 FSImageTestUtil getFSImage nn2 getBlockPoolID String cid1 FSImageTestUtil getFSImage nn1 getClusterID String cid2 FSImageTestUtil getFSImage nn2 getClusterID lv1 FSImageTestUtil getFSImage nn1 getLayoutVersion lv2 FSImageTestUtil getFSImage nn2 getLayoutVersion ns1 FSImageTestUtil getFSImage nn1 getNamespaceID ns2 FSImageTestUtil getFSImage nn2 getNamespaceID assertNotSame ns1 ns2
cluster waitActive NameNode nn1 cluster getNameNode NameNode nn2 cluster getNameNode assertNotNull nn1 assertNotNull nn2 String bpid1 FSImageTestUtil getFSImage nn1 getBlockPoolID String bpid2 FSImageTestUtil getFSImage nn2 getBlockPoolID String cid1 FSImageTestUtil getFSImage nn1 getClusterID String cid2 FSImageTestUtil getFSImage nn2 getClusterID lv1 FSImageTestUtil getFSImage nn1 getLayoutVersion lv2 FSImageTestUtil getFSImage nn2 getLayoutVersion ns1 FSImageTestUtil getFSImage nn1 getNamespaceID ns2 FSImageTestUtil getFSImage nn2 getNamespaceID assertNotSame ns1 ns2 LOG info lv1 cid1 bpid1 nn1 getNameNodeAddress
lv1 FSImageTestUtil getFSImage nn1 getLayoutVersion lv2 FSImageTestUtil getFSImage nn2 getLayoutVersion ns1 FSImageTestUtil getFSImage nn1 getNamespaceID ns2 FSImageTestUtil getFSImage nn2 getNamespaceID assertNotSame ns1 ns2 LOG info lv1 cid1 bpid1 nn1 getNameNodeAddress LOG info lv2 cid2 bpid2 nn2 getNameNodeAddress DataNode dn cluster getDataNodes get Map String Object volInfos dn data getVolumeInfoMap Assert assertTrue volInfos size i Map String Object e volInfos LOG info i e getKey e getValue assertEquals cluster getFsDatasetTestUtils getDefaultNumOfDataDirs volInfos size dn
MiniDFSCluster cluster MiniDFSCluster Builder conf nameNodePort build NameNode nn1 cluster getNameNode assertNotNull nn1 String bpid1 FSImageTestUtil getFSImage nn1 getBlockPoolID String cid1 FSImageTestUtil getFSImage nn1 getClusterID lv1 FSImageTestUtil getFSImage nn1 getLayoutVersion
NameNode nn1 cluster getNameNode assertNotNull nn1 String bpid1 FSImageTestUtil getFSImage nn1 getBlockPoolID String cid1 FSImageTestUtil getFSImage nn1 getClusterID lv1 FSImageTestUtil getFSImage nn1 getLayoutVersion LOG info lv1 cid1 bpid1 nn1 getNameNodeAddress DataNode dn cluster getDataNodes get Map String Object volInfos dn data getVolumeInfoMap Assert assertTrue volInfos size i Map String Object e volInfos LOG info i e getKey e getValue assertEquals cluster getFsDatasetTestUtils getDefaultNumOfDataDirs volInfos size dn
MiniDFSCluster cluster MiniDFSCluster Builder conf nnTopology MiniDFSNNTopology simpleFederatedTopology build cluster waitActive DataNode dn cluster getDataNodes get List BPOfferService bposs dn getAllBpOs
MiniDFSCluster cluster MiniDFSCluster Builder conf nnTopology MiniDFSNNTopology simpleFederatedTopology build cluster waitActive DataNode dn cluster getDataNodes get List BPOfferService bposs dn getAllBpOs LOG info bposs size Assert assertEquals bposs size cluster addNameNode conf Thread sleep bposs dn getAllBpOs
DataNode dn cluster getDataNodes get List BPOfferService bposs dn getAllBpOs LOG info bposs size Assert assertEquals bposs size cluster addNameNode conf Thread sleep bposs dn getAllBpOs LOG info bposs size Assert assertEquals bposs size StartupOption FORMAT setClusterId cluster addNameNode conf NameNode nn4 cluster getNameNode assertNotNull nn4 Thread sleep bposs dn getAllBpOs
blockFile trashFile assertTrue blockFile exists assertFalse trashFile exists
File badDataDir File data5 File dataDir String newDirs badDataDir toString data5 toString Configuration newConf Configuration conf newConf set DFSConfigKeys DFS_DATANODE_DATA_DIR_KEY newDirs
fs cluster fileName List DataNode datanodes cluster getDataNodes DataNode datanode datanodes get ExtendedBlock block DFSTestUtil getFirstBlock fs fileName FsVolumeSpi volume datanode getFSDataset getVolume block DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb
fs cluster fileName List DataNode datanodes cluster getDataNodes DataNode datanode datanodes get ExtendedBlock block DFSTestUtil getFirstBlock fs fileName FsVolumeSpi volume datanode getFSDataset getVolume block DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations
fs cluster fileName List DataNode datanodes cluster getDataNodes DataNode datanode datanodes get ExtendedBlock block DFSTestUtil getFirstBlock fs fileName FsVolumeSpi volume datanode getFSDataset getVolume block DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos
fs cluster fileName List DataNode datanodes cluster getDataNodes DataNode datanode datanodes get ExtendedBlock block DFSTestUtil getFirstBlock fs fileName FsVolumeSpi volume datanode getFSDataset getVolume block DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors
fs cluster fileName List DataNode datanodes cluster getDataNodes DataNode datanode datanodes get ExtendedBlock block DFSTestUtil getFirstBlock fs fileName FsVolumeSpi volume datanode getFSDataset getVolume block DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount
fs cluster fileName List DataNode datanodes cluster getDataNodes DataNode datanode datanodes get ExtendedBlock block DFSTestUtil getFirstBlock fs fileName FsVolumeSpi volume datanode getFSDataset getVolume block DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean
fs cluster fileName List DataNode datanodes cluster getDataNodes DataNode datanode datanodes get ExtendedBlock block DFSTestUtil getFirstBlock fs fileName FsVolumeSpi volume datanode getFSDataset getVolume block DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev
fs cluster fileName List DataNode datanodes cluster getDataNodes DataNode datanode datanodes get ExtendedBlock block DFSTestUtil getFirstBlock fs fileName FsVolumeSpi volume datanode getFSDataset getVolume block DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount
List DataNode datanodes cluster getDataNodes DataNode datanode datanodes get ExtendedBlock block DFSTestUtil getFirstBlock fs fileName FsVolumeSpi volume datanode getFSDataset getVolume block DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean
DataNode datanode datanodes get ExtendedBlock block DFSTestUtil getFirstBlock fs fileName FsVolumeSpi volume datanode getFSDataset getVolume block DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev
ExtendedBlock block DFSTestUtil getFirstBlock fs fileName FsVolumeSpi volume datanode getFSDataset getVolume block DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount
FsVolumeSpi volume datanode getFSDataset getVolume block DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean
DataNodeVolumeMetrics metrics volume getMetrics MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean LOG info metrics getFlushIoStdDev
MetricsRecordBuilder rb getMetrics volume getMetrics name assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean LOG info metrics getFlushIoStdDev LOG info metrics getSyncIoSampleCount
assertCounter metrics getTotalDataFileIos rb LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean LOG info metrics getFlushIoStdDev LOG info metrics getSyncIoSampleCount LOG info metrics getSyncIoMean
LOG info metrics getTotalMetadataOperations LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean LOG info metrics getFlushIoStdDev LOG info metrics getSyncIoSampleCount LOG info metrics getSyncIoMean LOG info metrics getSyncIoStdDev
LOG info metrics getTotalDataFileIos LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean LOG info metrics getFlushIoStdDev LOG info metrics getSyncIoSampleCount LOG info metrics getSyncIoMean LOG info metrics getSyncIoStdDev LOG info metrics getReadIoMean
LOG info metrics getTotalFileIoErrors LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean LOG info metrics getFlushIoStdDev LOG info metrics getSyncIoSampleCount LOG info metrics getSyncIoMean LOG info metrics getSyncIoStdDev LOG info metrics getReadIoMean LOG info metrics getReadIoMean
LOG info metrics getMetadataOperationSampleCount LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean LOG info metrics getFlushIoStdDev LOG info metrics getSyncIoSampleCount LOG info metrics getSyncIoMean LOG info metrics getSyncIoStdDev LOG info metrics getReadIoMean LOG info metrics getReadIoMean LOG info metrics getReadIoStdDev
LOG info metrics getMetadataOperationMean LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean LOG info metrics getFlushIoStdDev LOG info metrics getSyncIoSampleCount LOG info metrics getSyncIoMean LOG info metrics getSyncIoStdDev LOG info metrics getReadIoMean LOG info metrics getReadIoMean LOG info metrics getReadIoStdDev LOG info metrics getWriteIoSampleCount
LOG info metrics getMetadataOperationStdDev LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean LOG info metrics getFlushIoStdDev LOG info metrics getSyncIoSampleCount LOG info metrics getSyncIoMean LOG info metrics getSyncIoStdDev LOG info metrics getReadIoMean LOG info metrics getReadIoMean LOG info metrics getReadIoStdDev LOG info metrics getWriteIoSampleCount LOG info metrics getWriteIoMean
LOG info metrics getDataFileIoSampleCount LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean LOG info metrics getFlushIoStdDev LOG info metrics getSyncIoSampleCount LOG info metrics getSyncIoMean LOG info metrics getSyncIoStdDev LOG info metrics getReadIoMean LOG info metrics getReadIoMean LOG info metrics getReadIoStdDev LOG info metrics getWriteIoSampleCount LOG info metrics getWriteIoMean LOG info metrics getWriteIoStdDev
LOG info metrics getDataFileIoMean LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean LOG info metrics getFlushIoStdDev LOG info metrics getSyncIoSampleCount LOG info metrics getSyncIoMean LOG info metrics getSyncIoStdDev LOG info metrics getReadIoMean LOG info metrics getReadIoMean LOG info metrics getReadIoStdDev LOG info metrics getWriteIoSampleCount LOG info metrics getWriteIoMean LOG info metrics getWriteIoStdDev LOG info metrics getFileIoErrorSampleCount
LOG info metrics getDataFileIoStdDev LOG info metrics getFlushIoSampleCount LOG info metrics getFlushIoMean LOG info metrics getFlushIoStdDev LOG info metrics getSyncIoSampleCount LOG info metrics getSyncIoMean LOG info metrics getSyncIoStdDev LOG info metrics getReadIoMean LOG info metrics getReadIoMean LOG info metrics getReadIoStdDev LOG info metrics getWriteIoSampleCount LOG info metrics getWriteIoMean LOG info metrics getWriteIoStdDev LOG info metrics getFileIoErrorSampleCount LOG info metrics getFileIoErrorMean
DatanodeProtocolClientSideTranslatorPB namenode mock DatanodeProtocolClientSideTranslatorPB i i i i
LOG info i EOFException DatanodeRegistration dr DatanodeRegistration invocation getArguments datanodeRegistration DatanodeRegistration dr getDatanodeUuid dr LOG info datanodeRegistration datanodeRegistration when namenode DatanodeRegistration when namenode versionRequest thenReturn NamespaceInfo CLUSTER_ID POOL_ID HeartbeatResponse i HeartbeatResponse invocation i HeartbeatResponse heartbeatResponse i
DatanodeRegistration dr DatanodeRegistration invocation getArguments datanodeRegistration DatanodeRegistration dr getDatanodeUuid dr LOG info datanodeRegistration datanodeRegistration when namenode DatanodeRegistration when namenode versionRequest thenReturn NamespaceInfo CLUSTER_ID POOL_ID HeartbeatResponse i HeartbeatResponse invocation i HeartbeatResponse heartbeatResponse i LOG info i heartbeatResponse HeartbeatResponse DatanodeCommand RegisterCommand REGISTER NNHAStatusHeartbeat HAServiceState ACTIVE ThreadLocalRandom current nextLong
b File f File b getBlockURI File mf File b getMetadataURI f f mf FileOutputStream s FileChannel channel s FileOutputStream f channel s getChannel channel truncate
b File f File b getBlockURI File mf File b getMetadataURI f mf f
v v b getVolume File sourceBlock File b getBlockURI File sourceMeta File b getMetadataURI URI sourceRoot b getVolume getStorageLocation getUri URI destRoot v getStorageLocation getUri String relativeBlockPath sourceRoot relativize sourceBlock toURI getPath String relativeMetaPath sourceRoot relativize sourceMeta toURI getPath File destBlock File File destRoot toString relativeBlockPath File destMeta File File destRoot toString relativeMetaPath destBlock getParentFile mkdirs FileUtils copyFile sourceBlock destBlock FileUtils copyFile sourceMeta destMeta destBlock destMeta
v b getVolume File sourceBlock File b getBlockURI File sourceMeta File b getMetadataURI URI sourceRoot b getVolume getStorageLocation getUri URI destRoot v getStorageLocation getUri String relativeBlockPath sourceRoot relativize sourceBlock toURI getPath String relativeMetaPath sourceRoot relativize sourceMeta toURI getPath File destBlock File File destRoot toString relativeBlockPath File destMeta File File destRoot toString relativeMetaPath destBlock getParentFile mkdirs FileUtils copyFile sourceBlock destBlock FileUtils copyFile sourceMeta destMeta destBlock destMeta LOG info sourceBlock destBlock
id getFreeBlockId volumes numVolumes volumes size index rand nextInt numVolumes File finalizedDir FsVolumeImpl volumes get index getFinalizedDir bpid File file File finalizedDir getBlockFile id file
id getFreeBlockId refs numVolumes refs size index rand nextInt numVolumes File finalizedDir FsVolumeImpl refs get index getFinalizedDir bpid File file File finalizedDir getMetaFile id file
id getFreeBlockId refs numVolumes refs size index rand nextInt numVolumes File finalizedDir FsVolumeImpl refs get index getFinalizedDir bpid File file File finalizedDir getBlockFile id file
id getFreeBlockId refs numVolumes refs size index rand nextInt numVolumes File finalizedDir FsVolumeImpl refs get index getFinalizedDir bpid File file File finalizedDir getBlockFile id file LOG info file getName String name1 file getAbsolutePath String name2 file getAbsolutePath file File name1 file
id getFreeBlockId refs numVolumes refs size index rand nextInt numVolumes File finalizedDir FsVolumeImpl refs get index getFinalizedDir bpid File file File finalizedDir getBlockFile id file LOG info file getName String name1 file getAbsolutePath String name2 file getAbsolutePath file File name1 file LOG info name1 file File name2 file
index rand nextInt numVolumes File finalizedDir FsVolumeImpl refs get index getFinalizedDir bpid File file File finalizedDir getBlockFile id file LOG info file getName String name1 file getAbsolutePath String name2 file getAbsolutePath file File name1 file LOG info name1 file File name2 file LOG info name2 file File finalizedDir getMetaFile id file
retries maxRetries retries ratio ratio scanner DirectoryScanner fds conf ratio runThrottleTest blocks retries LOG info ratio assertTrue ratio assertTrue ratio conf setInt DFSConfigKeys DFS_DATANODE_DIRECTORYSCAN_THROTTLE_LIMIT_MS_PER_SEC_KEY ratio retries maxRetries retries ratio ratio scanner DirectoryScanner fds conf ratio runThrottleTest blocks retries
retries maxRetries retries ratio ratio scanner DirectoryScanner fds conf ratio runThrottleTest blocks retries LOG info ratio assertTrue ratio assertTrue ratio conf setInt DFSConfigKeys DFS_DATANODE_DIRECTORYSCAN_THREADS_KEY conf setInt DFSConfigKeys DFS_DATANODE_DIRECTORYSCAN_THROTTLE_LIMIT_MS_PER_SEC_KEY ratio retries maxRetries retries ratio ratio scanner DirectoryScanner fds conf ratio runThrottleTest blocks
scanner DirectoryScanner fds conf scanner setRetainDiffs AtomicLong nowMs AtomicLong nowMs set Time monotonicNow scanner shutdown scanner reconcile assertFalse scanner getRunStatus finalMs nowMs get finalMs LOG info Time monotonicNow finalMs assertTrue Time monotonicNow finalMs ratio scanner timeWaitingMs get scanner timeRunningMs get
Configuration conf getDefaultConf conf setLong DFSConfigKeys DFS_DATANODE_CACHE_REVOCATION_TIMEOUT_MS conf setLong DFSConfigKeys DFS_DATANODE_CACHE_REVOCATION_POLLING_MS MiniDFSCluster cluster cluster MiniDFSCluster Builder conf numDataNodes build cluster waitActive DistributedFileSystem dfs cluster getFileSystem String testFile DFSTestUtil createFile dfs Path testFile BLOCK_SIZE dfs addCachePool CachePoolInfo cacheDirectiveId dfs addCacheDirective CacheDirectiveInfo Builder setPool setPath Path testFile setReplication build FsDatasetSpi fsd cluster getDataNodes get getFSDataset DFSTestUtil verifyExpectedCacheUsage BLOCK_SIZE fsd FSDataInputStream in dfs open Path testFile ByteBuffer buf in read BLOCK_SIZE EnumSet noneOf ReadOption
conf setLong DFSConfigKeys DFS_DATANODE_CACHE_REVOCATION_POLLING_MS MiniDFSCluster cluster cluster MiniDFSCluster Builder conf numDataNodes build cluster waitActive DistributedFileSystem dfs cluster getFileSystem String testFile DFSTestUtil createFile dfs Path testFile BLOCK_SIZE dfs addCachePool CachePoolInfo cacheDirectiveId dfs addCacheDirective CacheDirectiveInfo Builder setPool setPath Path testFile setReplication build FsDatasetSpi fsd cluster getDataNodes get getFSDataset DFSTestUtil verifyExpectedCacheUsage BLOCK_SIZE fsd FSDataInputStream in dfs open Path testFile ByteBuffer buf in read BLOCK_SIZE EnumSet noneOf ReadOption LOG info cacheDirectiveId dfs removeCacheDirective cacheDirectiveId
numReplicas Math ceil FILE_LEN BLK_LEN File providedFile File BASE_DIR FILE_NAME replicas ArrayList ProvidedReplica
datanode bpid Collection ReplicaInfo replicas FsDatasetTestUtil getReplicas datanode getFSDataset bpid replicas
HdfsConfiguration conf HdfsConfiguration MiniDFSCluster cluster MiniDFSCluster Builder conf numDataNodes REPLICATION build cluster waitActive DistributedFileSystem fs cluster getFileSystem Path p Path size RAN nextInt
FSDataOutputStream out fs create p REPLICATION bytes remaining remaining RAN nextBytes bytes len bytes length remaining bytes length remaining out write bytes len out hflush remaining len ReplicaBeingWritten oldrbw DataNode newnode DatanodeInfo newnodeinfo String bpid cluster getNamesystem getBlockPoolId DataNode oldnode cluster getDataNodes get Assert assertNull oldnode xserver getWriteThrottler oldrbw getRbw oldnode bpid
LOG info testName getMethodName List FsVolumeSpi volumes makeVolumes NUM_VOLUMES expectedVolumeHealth FsDatasetSpi FsVolumeSpi dataset makeDataset volumes DatasetVolumeChecker checker DatasetVolumeChecker HdfsConfiguration FakeTimer checker setDelegateChecker DummyChecker Set FsVolumeSpi failedVolumes checker checkAllVolumes dataset
BlockReaderTestUtil enableHdfsCachingTracing Assert assertEquals CACHE_CAPACITY BLOCK_SIZE assertEquals CACHE_CAPACITY cacheManager getCacheCapacity assertEquals cacheManager getMemCacheCapacity Path testFile Path testFileLen maxCacheBlocksNum BLOCK_SIZE DFSTestUtil createFile fs testFile testFileLen List ExtendedBlockId blockKeys getExtendedBlockId testFile testFileLen fs addCachePool CachePoolInfo cacheDirectiveId fs addCacheDirective CacheDirectiveInfo Builder setPool setPath testFile setReplication build MetricsRecordBuilder dnMetrics getMetrics dn getMetrics name blocksCached MetricsAsserts getLongCounter dnMetrics blocksCached maxCacheBlocksNum
fail cachePath Path smallTestFile Path smallTestFileLen BLOCK_SIZE DFSTestUtil createFile fs smallTestFile smallTestFileLen smallFileCacheDirectiveId fs addCacheDirective CacheDirectiveInfo Builder setPool setPath smallTestFile setReplication build Thread sleep MetricsRecordBuilder dnMetrics getMetrics dn getMetrics name blocksCached MetricsAsserts getLongCounter dnMetrics assertTrue blocksCached maxCacheBlocksNum assertEquals blockKeyToVolume size maxCacheBlocksNum assertTrue blockKeyToVolume keySet containsAll blockKeys fs removeCacheDirective smallFileCacheDirectiveId fs removeCacheDirective cacheDirectiveId
Path smallTestFile Path smallTestFileLen BLOCK_SIZE DFSTestUtil createFile fs smallTestFile smallTestFileLen smallFileCacheDirectiveId fs addCacheDirective CacheDirectiveInfo Builder setPool setPath smallTestFile setReplication build Thread sleep MetricsRecordBuilder dnMetrics getMetrics dn getMetrics name blocksCached MetricsAsserts getLongCounter dnMetrics assertTrue blocksCached maxCacheBlocksNum assertEquals blockKeyToVolume size maxCacheBlocksNum assertTrue blockKeyToVolume keySet containsAll blockKeys fs removeCacheDirective smallFileCacheDirectiveId fs removeCacheDirective cacheDirectiveId MetricsRecordBuilder dnMetrics getMetrics dn getMetrics name
Set String seenIdentifiers HashSet String String seenIdentifiers
NUM_BLOCKS DFSTestUtil verifyExpectedCacheUsage fsd Path testFile Path testFileLen BLOCK_SIZE NUM_BLOCKS DFSTestUtil createFile fs testFile testFileLen HdfsBlockLocation locs HdfsBlockLocation fs getFileBlockLocations testFile testFileLen assertEquals NUM_BLOCKS locs length blockSizes getBlockSizes locs cacheCapacity fsd getCacheCapacity cacheUsed fsd getCacheUsed current assertEquals CACHE_CAPACITY cacheCapacity assertEquals current cacheUsed length
TOTAL_BLOCKS_PER_CACHE Ints checkedCast CACHE_CAPACITY BLOCK_SIZE BlockReaderTestUtil enableHdfsCachingTracing Assert assertEquals CACHE_CAPACITY BLOCK_SIZE Path SMALL_FILE Path DFSTestUtil createFile fs SMALL_FILE BLOCK_SIZE Path BIG_FILE Path DFSTestUtil createFile fs BIG_FILE TOTAL_BLOCKS_PER_CACHE BLOCK_SIZE DistributedFileSystem dfs cluster getFileSystem dfs addCachePool CachePoolInfo bigCacheDirectiveId dfs addCacheDirective CacheDirectiveInfo Builder setPool setPath BIG_FILE setReplication build MetricsRecordBuilder dnMetrics getMetrics dn getMetrics name blocksCached MetricsAsserts getLongCounter dnMetrics blocksCached TOTAL_BLOCKS_PER_CACHE
shortCacheDirectiveId dfs addCacheDirective CacheDirectiveInfo Builder setPool setPath SMALL_FILE setReplication build Thread sleep MetricsRecordBuilder dnMetrics getMetrics dn getMetrics name Assert assertEquals TOTAL_BLOCKS_PER_CACHE MetricsAsserts getLongCounter dnMetrics dfs removeCacheDirective bigCacheDirectiveId RemoteIterator CacheDirectiveEntry iter iter dfs listCacheDirectives CacheDirectiveInfo Builder build CacheDirectiveEntry entry entry iter next entry getInfo getId shortCacheDirectiveId
shortCacheDirectiveId dfs addCacheDirective CacheDirectiveInfo Builder setPool setPath SMALL_FILE setReplication build Thread sleep MetricsRecordBuilder dnMetrics getMetrics dn getMetrics name Assert assertEquals TOTAL_BLOCKS_PER_CACHE MetricsAsserts getLongCounter dnMetrics dfs removeCacheDirective bigCacheDirectiveId RemoteIterator CacheDirectiveEntry iter iter dfs listCacheDirectives CacheDirectiveInfo Builder build CacheDirectiveEntry entry entry iter next entry getInfo getId shortCacheDirectiveId entry
numExistingVolumes getNumVolumes totalVolumes numNewVolumes numExistingVolumes Set String expectedVolumes HashSet String List NamespaceInfo nsInfos Lists newArrayList String bpid nsInfos add NamespaceInfo CLUSTER_ID bpid i i numNewVolumes i String path BASE_DIR i String pathUri Path path toUri toString expectedVolumes add File pathUri getAbsolutePath StorageLocation loc StorageLocation parse pathUri Storage StorageDirectory sd createStorageDirectory File path conf DataStorage VolumeBuilder builder DataStorage VolumeBuilder storage sd when storage prepareVolume eq datanode eq loc anyList thenReturn builder dataset addVolume loc nsInfos
String path BASE_DIR i String pathUri Path path toUri toString expectedVolumes add File pathUri getAbsolutePath StorageLocation loc StorageLocation parse pathUri Storage StorageDirectory sd createStorageDirectory File path conf DataStorage VolumeBuilder builder DataStorage VolumeBuilder storage sd when storage prepareVolume eq datanode eq loc anyList thenReturn builder dataset addVolume loc nsInfos LOG info i File pathUri getAbsolutePath assertEquals totalVolumes getNumVolumes assertEquals totalVolumes dataset storageMap size Set String actualVolumes HashSet String volumes dataset i i i String volumeName volumes get numExistingVolumes i toString
volRemoveStartedLatch await e LOG info e LOG info dataset getBlockReports eb getBlockPoolId LOG info blockReportReceivedLatch countDown Thread dataset eb LOG info startFinalizeLatch countDown Thread sleep
dataset eb LOG info startFinalizeLatch countDown Thread sleep ie LOG info ie blockReportReceivedLatch await dataset finalizeBlock eb LOG info e LOG warn e Thread
startFinalizeLatch countDown Thread sleep ie LOG info ie blockReportReceivedLatch await dataset finalizeBlock eb LOG info e LOG warn e Thread Set StorageLocation volumesToRemove HashSet volumesToRemove add dataset getVolume eb getStorageLocation
Thread sleep ie LOG info ie blockReportReceivedLatch await dataset finalizeBlock eb LOG info e LOG warn e Thread Set StorageLocation volumesToRemove HashSet volumesToRemove add dataset getVolume eb getStorageLocation e LOG info e
MiniDFSCluster cluster cluster MiniDFSCluster Builder conf numDataNodes storageTypes StorageType StorageType DISK StorageType DISK storagesPerDatanode build FileSystem fs cluster getFileSystem DataNode dataNode cluster getDataNodes get Path filePath Path DFSTestUtil createFile fs filePath ExtendedBlock block DFSTestUtil getFirstBlock fs filePath FsDatasetImpl fsDataSetImpl FsDatasetImpl dataNode getFSDataset ReplicaInfo newReplicaInfo createNewReplicaObj block fsDataSetImpl FSDataOutputStream out fs append filePath out write out hflush
cluster MiniDFSCluster Builder conf numDataNodes storageTypes StorageType StorageType DISK StorageType DISK storagesPerDatanode build FileSystem fs cluster getFileSystem DataNode dataNode cluster getDataNodes get Path filePath Path DFSTestUtil createFile fs filePath ExtendedBlock block DFSTestUtil getFirstBlock fs filePath FsDatasetImpl fsDataSetImpl FsDatasetImpl dataNode getFSDataset ReplicaInfo newReplicaInfo createNewReplicaObj block fsDataSetImpl FSDataOutputStream out fs append filePath out write out hflush LOG info block getGenerationStamp LOG info fsDataSetImpl getReplicaInfo block getBlockPoolId newReplicaInfo getBlockId getGenerationStamp LambdaTestUtils intercept IOException fsDataSetImpl finalizeNewReplica newReplicaInfo block
getClusterBuilder setRamDiskReplicaCapacity build String METHOD_NAME GenericTestUtils getMethodName Path path1 Path METHOD_NAME SEED NUM_TASKS makeRandomTestFile path1 BLOCK_SIZE SEED ensureFileReplicasOnStorageType path1 RAM_DISK CountDownLatch latch CountDownLatch NUM_TASKS AtomicBoolean testFailed AtomicBoolean Assert assertTrue verifyReadRandomFile path1 BLOCK_SIZE SEED
fsd cacheUsed fsd getCacheUsed
cacheBlocksNum Ints checkedCast CACHE_AMOUNT BLOCK_SIZE BlockReaderTestUtil enableHdfsCachingTracing Assert assertEquals CACHE_AMOUNT BLOCK_SIZE Path testFile Path testFileLen cacheBlocksNum BLOCK_SIZE DFSTestUtil createFile fs testFile testFileLen List ExtendedBlockId blockKeys getExtendedBlockId testFile testFileLen fs addCachePool CachePoolInfo cacheDirectiveId fs addCacheDirective CacheDirectiveInfo Builder setPool setPath testFile setReplication build MetricsRecordBuilder dnMetrics getMetrics dn getMetrics name blocksCached MetricsAsserts getLongCounter dnMetrics blocksCached cacheBlocksNum
assertEquals NUM_LOCAL_INIT_VOLUMES NUM_PROVIDED_INIT_VOLUMES getNumVolumes assertEquals NUM_PROVIDED_INIT_VOLUMES providedVolumes size assertEquals dataset getNumFailedVolumes i i providedVolumes size i assertEquals DFSConfigKeys DFS_PROVIDER_STORAGEUUID_DEFAULT providedVolumes get i getStorageID assertEquals StorageType PROVIDED providedVolumes get i getStorageType space providedVolumes get i getBlockPoolUsed BLOCK_POOL_IDS CHOSEN_BP_ID assertEquals spaceUsed space assertEquals NUM_PROVIDED_BLKS providedVolumes get i getNumBlocks providedVolumes get i shutdownBlockPool BLOCK_POOL_IDS CHOSEN_BP_ID assertEquals providedVolumes get i getBlockPoolUsed BLOCK_POOL_IDS CHOSEN_BP_ID assertTrue
fout fs file fout write data PathHandle pathHandle fs getPathHandle fs getFileStatus file Options HandleOpt changed Options HandleOpt moved FinalizedProvidedReplica replica FinalizedProvidedReplica file toUri chunkSize pathHandle conf fs content chunkSize IOUtils readFully replica getDataInputStream content chunkSize assertArrayEquals data content fs rename file Path IOUtils readFully replica getDataInputStream content chunkSize assertArrayEquals data content replica setPathHandle replica getDataInputStream fail
tries IOException tries IOException FSDataOutputStream os fs create file replication os write os close cluster triggerBlockReports cluster volumes FsVolumeImpl volume FsVolumeImpl volumes get get
volumes FsVolumeImpl volume FsVolumeImpl volumes get get
String methodName GenericTestUtils getMethodName Path file Path methodName FSDataOutputStream os fs create file replication os write os hflush os close HdfsBlockLocation blockLocation HdfsBlockLocation fs getClient getBlockLocations file toString BLOCK_SIZE LocatedBlock lastBlock blockLocation getLocatedBlock cluster stopDataNode lastBlock getLocations getName os fs append file DFSTestUtil setPipeline DFSOutputStream os getWrappedStream lastBlock os writeBytes os hsync
nodeIndex nodeIndex nodeIndex String nodeName nodeIndex
dataNodeIndex cap blockSize blockCount conf setInt DFSConfigKeys DFS_BLOCK_SIZE_KEY blockSize conf setInt DFSConfigKeys DFS_BYTES_PER_CHECKSUM_KEY blockSize MiniDFSCluster cluster ClusterBuilder setBlockCount blockCount setBlockSize blockSize setDiskCount diskCount setNumDatanodes dataNodeCount setConf conf setCapacities cap cap build DataNode node cluster getDataNodes get dataNodeIndex FsDatasetSpi fsDatasetSpy Mockito spy node getFSDataset DiskBalancerWorkItem item Mockito spy DiskBalancerWorkItem Mockito doReturn when item getBandwidth invocation node getFSDataset moveBlockAcrossVolumes ExtendedBlock invocation getArguments FsVolumeSpi invocation getArguments
Path dir Path dfs mkdirs dir dfs setStoragePolicy dir FSDataOutputStream out dfs create Path file fileData StripedFileTestUtil generateBytes DEFAULT_BLOCK_SIZE out write fileData out close LocatedBlock lb dfs getClient getLocatedBlocks file get StorageType storageTypes lb getStorageTypes StorageType storageType storageTypes Assert assertTrue StorageType DISK storageType StorageType newtypes StorageType StorageType SSD startAdditionalDNs conf newtypes cluster i i cluster getDataNodes i DataNode dn cluster getDataNodes get i
InetSocketAddress favoredNodes InetSocketAddress j i dataNodes i i favoredNodes j dataNodes get i getXferAddress String file FSDataOutputStream out dfs create Path file FsPermission getDefault DEFAULT_BLOCK_SIZE DEFAULT_BLOCK_SIZE favoredNodes fileData StripedFileTestUtil generateBytes DEFAULT_BLOCK_SIZE out write fileData out close LocatedBlocks locatedBlocks dfs getClient getLocatedBlocks file Assert assertEquals locatedBlocks locatedBlockCount LocatedBlock lb locatedBlocks get DatanodeInfo datanodeInfo lb getLocations datanodeInfo
NamespaceScheme nsScheme NamespaceScheme Arrays asList fooDir BLOCK_SIZE policyMap ClusterScheme clusterScheme ClusterScheme DEFAULT_CONF NUM_DATANODES REPL genStorageTypes NUM_DATANODES MigrationTest test MigrationTest clusterScheme nsScheme test setupCluster banner Path barFile Path fooDir DFSTestUtil createFile test dfs barFile BLOCK_SIZE FSDataOutputStream out test dfs append barFile out writeBytes DFSOutputStream out getWrappedStream hsync banner test setStoragePolicy test migrate ExitStatus SUCCESS LocatedBlocks lbs test dfs getClient getLocatedBlocks barFile toString BLOCK_SIZE
DFSOutputStream out getWrappedStream hsync banner test setStoragePolicy test migrate ExitStatus SUCCESS LocatedBlocks lbs test dfs getClient getLocatedBlocks barFile toString BLOCK_SIZE LOG info lbs List LocatedBlock blks lbs getLocatedBlocks Assert assertEquals blks size Assert assertEquals blks get getLocations length banner out writeBytes DFSOutputStream out getWrappedStream hsync IOUtils cleanupWithLogger LOG out lbs test dfs getClient getLocatedBlocks barFile toString BLOCK_SIZE
fvs FsVolumeImpl volume FsVolumeImpl fvs volume
nameDir LOG info Joiner on join nameDir listFiles
log log info sd File curDir sd getCurrentDir
log log info sd File curDir sd getCurrentDir log info curDir File files curDir listFiles Arrays sort files File files
String src FSNamesystem ns cluster getNamesystem NamenodeProtocols nn cluster getNameNodeRpc nn create src FsPermission getFileDefault EnumSetWritable CreateFlag EnumSet of CreateFlag CREATE
FSNamesystem ns cluster getNamesystem NamenodeProtocols nn cluster getNameNodeRpc nn create src FsPermission getFileDefault EnumSetWritable CreateFlag EnumSet of CreateFlag CREATE LOG info src LocatedBlock onRetryBlock LocatedBlock ns readLock FSDirWriteFileOp ValidateAddBlockResult r FSPermissionChecker pc Mockito mock FSPermissionChecker r FSDirWriteFileOp validateAddBlock ns pc src HdfsConstants GRANDFATHER_INODE_ID onRetryBlock ns readUnlock DatanodeStorageInfo targets FSDirWriteFileOp chooseTargetForNewBlock ns getBlockManager src r assertNotNull targets
String src NamenodeProtocols nameNodeRpc cluster getNameNodeRpc nameNodeRpc create src FsPermission getFileDefault EnumSetWritable CreateFlag EnumSet of CreateFlag CREATE
config setBoolean DFS_NAMENODE_SUPPORT_ALLOW_FORMAT_KEY cluster MiniDFSCluster Builder config manageDataDfsDirs manageNameDfsDirs build cluster waitActive assertNotNull cluster nn cluster getNameNode assertNotNull nn LOG info LOG info config setBoolean DFS_NAMENODE_SUPPORT_ALLOW_FORMAT_KEY cluster shutdown NameNode format config fail e assertTrue e getMessage startsWith DFS_NAMENODE_SUPPORT_ALLOW_FORMAT_KEY
Configuration conf HdfsConfiguration conf setBoolean HADOOP_CALLER_CONTEXT_ENABLED_KEY conf setInt HADOOP_CALLER_CONTEXT_MAX_SIZE_KEY conf setInt HADOOP_CALLER_CONTEXT_SIGNATURE_MAX_SIZE_KEY MiniDFSCluster cluster MiniDFSCluster Builder conf build LogCapturer auditlog LogCapturer captureLogs FSNamesystem auditLog cluster waitClusterUp FileSystem fs cluster getFileSystem time System currentTimeMillis Path p Path assertNull CallerContext getCurrent CallerContext context CallerContext Builder build CallerContext setCurrent context
LogCapturer auditlog LogCapturer captureLogs FSNamesystem auditLog cluster waitClusterUp FileSystem fs cluster getFileSystem time System currentTimeMillis Path p Path assertNull CallerContext getCurrent CallerContext context CallerContext Builder build CallerContext setCurrent context LOG info CallerContext getCurrent fs setTimes p time time assertTrue auditlog getOutput endsWith String format auditlog clearOutput context CallerContext Builder setSignature getBytes CallerContext SIGNATURE_ENCODING build CallerContext setCurrent context
CallerContext context CallerContext Builder build CallerContext setCurrent context LOG info CallerContext getCurrent fs setTimes p time time assertTrue auditlog getOutput endsWith String format auditlog clearOutput context CallerContext Builder setSignature getBytes CallerContext SIGNATURE_ENCODING build CallerContext setCurrent context LOG info CallerContext getCurrent fs setTimes p time time assertTrue auditlog getOutput endsWith String format auditlog clearOutput String longContext StringUtils repeat context CallerContext Builder longContext setSignature getBytes CallerContext SIGNATURE_ENCODING build CallerContext setCurrent context
String longContext StringUtils repeat context CallerContext Builder longContext setSignature getBytes CallerContext SIGNATURE_ENCODING build CallerContext setCurrent context LOG info CallerContext getCurrent fs setTimes p time time assertTrue auditlog getOutput endsWith String format longContext substring auditlog clearOutput context CallerContext Builder setSignature getBytes CallerContext SIGNATURE_ENCODING build CallerContext setCurrent context LOG info fs setTimes p time time assertFalse auditlog getOutput contains auditlog clearOutput context CallerContext Builder setSignature getBytes CallerContext SIGNATURE_ENCODING build CallerContext setCurrent context
LOG info CallerContext getCurrent child fs setTimes p time time e fail e child start child join assertTrue auditlog getOutput endsWith String format auditlog clearOutput CallerContext childContext CallerContext Builder setSignature getBytes CallerContext SIGNATURE_ENCODING build
assertTrue auditlog getOutput endsWith String format auditlog clearOutput CallerContext childContext CallerContext Builder setSignature getBytes CallerContext SIGNATURE_ENCODING build LOG info CallerContext getCurrent child CallerContext setCurrent childContext fs setPermission p FsPermission e fail e child start child join
CallerContext setCurrent childContext fs setPermission p FsPermission e fail e child start child join assertTrue auditlog getOutput endsWith String format auditlog clearOutput context CallerContext Builder setSignature CallerContext getCurrent getSignature build CallerContext setCurrent context
fail e child start child join assertTrue auditlog getOutput endsWith String format auditlog clearOutput context CallerContext Builder setSignature CallerContext getCurrent getSignature build CallerContext setCurrent context LOG info CallerContext getCurrent fs mkdirs Path assertTrue auditlog getOutput endsWith String format auditlog clearOutput context CallerContext Builder setSignature build
child join assertTrue auditlog getOutput endsWith String format auditlog clearOutput context CallerContext Builder setSignature CallerContext getCurrent getSignature build CallerContext setCurrent context LOG info CallerContext getCurrent fs mkdirs Path assertTrue auditlog getOutput endsWith String format auditlog clearOutput context CallerContext Builder setSignature build CallerContext setCurrent context LOG info CallerContext getCurrent fs setTimes p time time
auditlog clearOutput context CallerContext Builder setSignature CallerContext getCurrent getSignature build CallerContext setCurrent context LOG info CallerContext getCurrent fs mkdirs Path assertTrue auditlog getOutput endsWith String format auditlog clearOutput context CallerContext Builder setSignature build CallerContext setCurrent context LOG info CallerContext getCurrent fs setTimes p time time assertTrue auditlog getOutput endsWith String format auditlog clearOutput context CallerContext Builder setSignature build CallerContext setCurrent context
thisCheckpointTxId
Configuration nnconf HdfsConfiguration c DFSTestUtil formatNameNode nnconf nn NameNode createNameNode String nnconf e LOG info e c set CommonConfigurationKeysPublic HADOOP_SECURITY_AUTHENTICATION c set DFSConfigKeys DFS_NAMENODE_KEYTAB_FILE_KEY BackupNode bn bn BackupNode NameNode createNameNode String startupOpt getName c assertTrue bn getNamesystem fail e
cluster testIdx NameNode nn cluster getNameNode FileSystem fs cluster getFileSystem i i i String src testIdx i
cluster testIdx NameNode nn cluster getNameNode FileSystem fs cluster getFileSystem i i i String src testIdx i LOG info src Path p Path src assertTrue fs mkdirs p
conf setInt DFSConfigKeys DFS_DATANODE_SCAN_PERIOD_HOURS_KEY conf setInt DFSConfigKeys DFS_NAMENODE_CHECKPOINT_TXNS_KEY MiniDFSCluster cluster FileSystem fileSys BackupNode backup cluster MiniDFSCluster Builder conf numDataNodes build fileSys cluster getFileSystem assertTrue fileSys exists file1 assertTrue fileSys exists file2 assertTrue fileSys mkdirs file1 txid cluster getNameNodeRpc getTransactionID backup startBackupNode conf op waitCheckpointDone cluster txid
fileSys mkdirs file2 txid cluster getNameNodeRpc getTransactionID backup startBackupNode conf op waitCheckpointDone cluster txid i i i fileSys mkdirs Path i txid cluster getNameNodeRpc getTransactionID backup doCheckpoint waitCheckpointDone cluster txid txid cluster getNameNodeRpc getTransactionID backup doCheckpoint waitCheckpointDone cluster txid InetSocketAddress add backup getNameNodeAddress FileSystem bnFS FileSystem get Path NetUtils getHostPortString add toUri conf canWrite
txid cluster getNameNodeRpc getTransactionID backup doCheckpoint waitCheckpointDone cluster txid txid cluster getNameNodeRpc getTransactionID backup doCheckpoint waitCheckpointDone cluster txid InetSocketAddress add backup getNameNodeAddress FileSystem bnFS FileSystem get Path NetUtils getHostPortString add toUri conf canWrite DFSTestUtil createFile bnFS file3 fileSize fileSize blockSize replication seed eio LOG info backup getRole eio canWrite assertFalse canWrite
eio LOG info backup getRole eio canRead assertEquals canRead backup isRole NamenodeRole BACKUP DFSTestUtil createFile fileSys file3 fileSize fileSize blockSize replication seed TestCheckpoint checkFile fileSys file3 replication assertTrue op StartupOption BACKUP backup getNamesystem getFileInfo file3 toUri getPath e LOG error e AssertionError e backup backup stop fileSys fileSys close cluster cluster shutdown FSImageTestUtil assertParallelFilesAreIdentical ImmutableList of bnCurDir nnCurDir ImmutableSet String of
String nnAddr cluster getNameNode getNameNodeAddressHostPortString conf get DFSConfigKeys DFS_NAMENODE_RPC_ADDRESS_KEY String bnAddr backup getNameNodeAddressHostPortString conf set DFSConfigKeys DFS_NAMESERVICES conf set DFSConfigKeys DFS_NAMESERVICE_ID conf set DFSConfigKeys DFS_HA_NAMENODES_KEY_PREFIX conf set rpcAddrKeyPreffix nnAddr conf set rpcAddrKeyPreffix bnAddr cluster startDataNodes conf StartupOption REGULAR DFSTestUtil createFile fileSys file1 fileSize fileSize blockSize seed FileSystem bnFS FileSystem get Path bnAddr toUri conf String nnData DFSTestUtil readFile fileSys file1 String bnData DFSTestUtil readFile bnFS file1 assertEquals nnData bnData
nn FSNamesystem namesystem nn getNamesystem CacheManager cacheManager namesystem getCacheManager
LOG info filter filter toString targetBytesNeeded targetBytesCached targetFilesNeeded targetFilesCached RemoteIterator CacheDirectiveEntry iter CacheDirectiveEntry entry iter dfs listCacheDirectives filter entry iter next e fail e getMessage Assert assertNotNull entry CacheDirectiveStats stats entry getStats targetBytesNeeded stats targetBytesCached stats targetFilesNeeded stats targetFilesCached stats
CachePoolEntry entry iter entry iter next e fail e getMessage entry entry CachePoolStats stats entry getStats stats stats stats stats
dfs expectedBlocks numCachedBlocks numCachedReplicas p FileStatus f dfs getFileStatus p len f getLen blockSize f getBlockSize numBlocks len blockSize blockSize BlockLocation locs dfs getFileBlockLocations p len assertEquals p numBlocks locs length BlockLocation l locs l getCachedHosts length numCachedBlocks numCachedReplicas l getCachedHosts length LOG info numCachedBlocks expectedBlocks
Configuration conf HdfsConfiguration MiniDFSCluster cluster SecondaryNameNode secondary cluster MiniDFSCluster Builder conf numDataNodes build StorageDirectory savedSd secondary startSecondaryNameNode conf NNStorage storage secondary getFSImage getStorage StorageDirectory sd storage assertLockFails sd savedSd sd LOG info secondary shutdown secondary LOG info
Configuration conf HdfsConfiguration cluster MiniDFSCluster Builder conf numDataNodes numDatanodes format build secondary startSecondaryNameNode conf Mockito doThrow IOException when faultInjector afterSecondaryCallsRollEditLog secondary doCheckpoint fail IOException ioe LOG info ioe assertTrue ioe toString contains secondary doCheckpoint fail IOException ioe
Configuration snnConf Configuration conf File checkpointDir File MiniDFSCluster getBaseDirectory snnConf set DFSConfigKeys DFS_NAMENODE_CHECKPOINT_DIR_KEY checkpointDir getAbsolutePath secondary startSecondaryNameNode snnConf secondary doCheckpoint cluster shutdown cluster Thread sleep cluster MiniDFSCluster Builder conf numDataNodes nameNodePort origPort nameNodeHttpPort origHttpPort format build secondary doCheckpoint fail
testList add AbstractMap SimpleImmutableEntry String Boolean Path rootPath Path Configuration conf Configuration conf setBoolean DFSConfigKeys DFS_PERMISSIONS_ENABLED_KEY conf setInt DFSConfigKeys DFS_BLOCK_SIZE_KEY BLOCK_SIZE FSDataOutputStream stm Map DataNode DatanodeProtocolClientSideTranslatorPB dnMap HashMap DataNode DatanodeProtocolClientSideTranslatorPB cluster MiniDFSCluster Builder conf numDataNodes build cluster waitActive DistributedFileSystem fs cluster getFileSystem stId AbstractMap SimpleImmutableEntry String Boolean stest testList String testPath stest getKey Boolean mkSameDir stest getValue
Map DataNode DatanodeProtocolClientSideTranslatorPB dnMap HashMap DataNode DatanodeProtocolClientSideTranslatorPB cluster MiniDFSCluster Builder conf numDataNodes build cluster waitActive DistributedFileSystem fs cluster getFileSystem stId String Boolean stest String testPath stest getKey Boolean mkSameDir stest getValue LOG info testPath mkSameDir hasSnapshot Path fPath Path testPath Path grandestNonRootParent fPath grandestNonRootParent getParent grandestNonRootParent grandestNonRootParent getParent stm fs create fPath
LOG info testPath mkSameDir hasSnapshot Path fPath Path testPath Path grandestNonRootParent fPath grandestNonRootParent getParent rootPath grandestNonRootParent grandestNonRootParent getParent stm fs create fPath LOG info testPath fPath AppendTestUtil write stm BLOCK_SIZE stm hflush hasSnapshot SnapshotTestHelper createSnapshot fs rootPath String valueOf stId stId NameNode nn cluster getNameNode ExtendedBlock blk DFSTestUtil getFirstBlock fs fPath DatanodeDescriptor expectedPrimary DFSTestUtil getExpectedPrimaryNode nn blk
NameNode nn cluster getNameNode ExtendedBlock blk DFSTestUtil getFirstBlock fs fPath DatanodeDescriptor expectedPrimary DFSTestUtil getExpectedPrimaryNode nn blk LOG info expectedPrimary DataNode primaryDN cluster getDataNode expectedPrimary getIpcPort DatanodeProtocolClientSideTranslatorPB nnSpy dnMap get primaryDN nnSpy nnSpy InternalDataNodeTestUtils spyOnBposToNN primaryDN nn dnMap put primaryDN nnSpy DelayAnswer delayer DelayAnswer LOG Mockito doAnswer delayer when nnSpy commitBlockSynchronization Mockito eq blk Mockito anyLong Mockito anyLong Mockito eq Mockito eq Mockito any Mockito any fs recoverLease fPath LOG info delayer waitForCall LOG info grandestNonRootParent
Path rootPath Path Configuration config Configuration config setBoolean DFSConfigKeys DFS_PERMISSIONS_ENABLED_KEY config setInt DFSConfigKeys DFS_BLOCK_SIZE_KEY BLOCK_SIZE FSDataOutputStream stm cluster MiniDFSCluster Builder config numDataNodes build cluster waitActive DistributedFileSystem fs cluster getFileSystem Path testPath Path stm fs create testPath
fileSys cluster getFileSystem FSNamesystem namesystem cluster getNamesystem FSImage fsimage namesystem getFSImage FSEditLog editLog fsimage getEditLog fileSys mkdirs Path Iterator StorageDirectory iter fsimage getStorage dirIterator NameNodeDirType EDITS LinkedList StorageDirectory sds LinkedList StorageDirectory iter sds add iter next editLog close cluster shutdown StorageDirectory sd sds File editFile NNStorage getFinalizedEditsFile sd assertTrue editFile exists fileLen editFile length
stream create NameNodeLayoutVersion CURRENT_LAYOUT_VERSION NNStorage storage NNStorage conf Collections URI emptyList Lists newArrayList uri storage writeTransactionIdFileToStorage storage close stream close cluster MiniDFSCluster Builder conf numDataNodes NUM_DATA_NODES format build fail
File f1 File TEST_DIR File f2 File TEST_DIR List URI editUris ImmutableList of f1 toURI f2 toURI NNStorage storage setupEdits editUris AbortSpec AbortSpec AbortSpec AbortSpec AbortSpec AbortSpec AbortSpec AbortSpec AbortSpec AbortSpec totaltxnread FSEditLog editlog getFSEditLog storage editlog initJournalsForWrite startTxId Iterable EditLogInputStream editStreams editlog selectInputStreams startTxId TXNS_PER_ROLL EditLogInputStream edits editStreams FSEditLogLoader EditLogValidation val FSEditLogLoader scanEditLog edits Long MAX_VALUE read val getEndTxId edits getFirstTxId
assertEquals files length assertTrue files delete FSEditLog editlog getFSEditLog storage editlog initJournalsForWrite startTxId Collection EditLogInputStream streams streams editlog selectInputStreams startTxId TXNS_PER_ROLL readAllEdits streams startTxId
File f1 File TEST_DIR File f2 File TEST_DIR List URI editUris ImmutableList of f1 toURI f2 toURI NNStorage storage setupEdits editUris startErrorTxId TXNS_PER_ROLL endErrorTxId TXNS_PER_ROLL File files File f1 File NNStorage startErrorTxId endErrorTxId assertEquals files length fileLen files length
editLog rollEditLog NameNodeLayoutVersion CURRENT_LAYOUT_VERSION assertExistsInStorageDirs cluster NameNodeDirType EDITS NNStorage getFinalizedEditsFileName i i editLog close fileSys fileSys close cluster cluster shutdown startTime Time now cluster MiniDFSCluster Builder conf numDataNodes NUM_DATA_NODES build cluster waitActive cluster cluster shutdown endTime Time now delta endTime startTime
retryCount basePort random nextInt MiniDFSNNTopology topology MiniDFSNNTopology addNameservice MiniDFSNNTopology NSConf addNN MiniDFSNNTopology NNConf setHttpPort basePort addNN MiniDFSNNTopology NNConf setHttpPort basePort cluster MiniDFSCluster Builder conf nnTopology topology numDataNodes build cluster waitActive nn0 cluster getNameNode fs HATestUtil configureFailoverFs cluster conf cluster transitionToActive fs cluster getFileSystem editLog nn0 getNamesystem getEditLog retryCount
Configuration conf Configuration File editLog File GenericTestUtils getTempPath
PermissionStatus perms PermissionStatus createImmutable FsPermission createImmutable mkdirOp setPermissionStatus perms elos write mkdirOp mkdirOp reset mkdirOp setRpcCallId mkdirOp setTransactionId mkdirOp setInodeId mkdirOp setPath perms PermissionStatus createImmutable FsPermission createImmutable mkdirOp setPermissionStatus perms elos write mkdirOp elos setReadyToFlush elos flushAndSync elos close fileLen editLog length
elos write mkdirOp elos setReadyToFlush elos flushAndSync elos close fileLen editLog length LOG debug editLog fileLen RandomAccessFile rwf RandomAccessFile editLog rwf seek fileLen b rwf readInt rwf seek fileLen rwf writeInt b rwf close EditLogFileInputStream elis EditLogFileInputStream editLog Assert assertEquals NameNodeLayoutVersion CURRENT_LAYOUT_VERSION elis getVersion Assert assertEquals elis scanNextOp
LOG debug editLog fileLen RandomAccessFile rwf RandomAccessFile editLog rwf seek fileLen b rwf readInt rwf seek fileLen rwf writeInt b rwf close EditLogFileInputStream elis EditLogFileInputStream editLog Assert assertEquals NameNodeLayoutVersion CURRENT_LAYOUT_VERSION elis getVersion Assert assertEquals elis scanNextOp LOG debug editLog elis scanNextOp Assert fail
cluster MiniDFSCluster Builder conf numDataNodes NUM_DATA_NODES build cluster waitActive fileSys cluster getFileSystem FSNamesystem namesystem cluster getNamesystem FSImage fsimage namesystem getFSImage FSEditLog editLog fsimage getEditLog startTransactionWorkers cluster caughtErr i i caughtErr i Thread sleep LOG info i namesystem enterSafeMode logStartTxId fsimage getStorage getMostRecentCheckpointTxId verifyEditLogs namesystem fsimage NNStorage getInProgressEditsFileName logStartTxId logStartTxId
fileSys cluster getFileSystem FSNamesystem namesystem cluster getNamesystem FSImage fsimage namesystem getFSImage FSEditLog editLog fsimage getEditLog startTransactionWorkers cluster caughtErr i i caughtErr i Thread sleep LOG info i namesystem enterSafeMode logStartTxId fsimage getStorage getMostRecentCheckpointTxId verifyEditLogs namesystem fsimage NNStorage getInProgressEditsFileName logStartTxId logStartTxId LOG info i namesystem saveNamespace
i i i Thread sleep LOG info i namesystem enterSafeMode logStartTxId fsimage getStorage getMostRecentCheckpointTxId verifyEditLogs namesystem fsimage NNStorage getInProgressEditsFileName logStartTxId logStartTxId LOG info i namesystem saveNamespace LOG info i savedImageTxId fsimage getStorage getMostRecentCheckpointTxId verifyEditLogs namesystem fsimage NNStorage getFinalizedEditsFileName logStartTxId savedImageTxId logStartTxId assertEquals fsimage getStorage getMostRecentCheckpointTxId editLog getLastWrittenTxId namesystem leaveSafeMode
FSImage fsimage namesystem getFSImage FSEditLog editLog fsimage getEditLog JournalAndStream jas editLog getJournals get EditLogFileOutputStream spyElos spy EditLogFileOutputStream jas getCurrentStream jas setCurrentStreamForTests spyElos AtomicReference Throwable deferredException AtomicReference Throwable CountDownLatch waitToEnterFlush CountDownLatch LOG info namesystem mkdirs PermissionStatus FsPermission LOG info Throwable
invocation LOG info Thread doAnEditThread LOG info waitToEnterFlush countDown LOG info BLOCK_TIME Thread sleep BLOCK_TIME LOG info invocation callRealMethod LOG info doAnswer blockingFlush when spyElos flush doAnEditThread start LOG info
Thread Thread LOG info namesystem writeLock editLog logSetOwner namesystem writeUnlock sleepingBeforeSync countDown LOG info BLOCK_TIME Thread sleep BLOCK_TIME editLog logSync LOG info
FSEditLog editLog namesystem getEditLog FSEditLogOp OpInstanceCache cache editLog cache get FSEditLogOp op FSEditLogOp SetOwnerOp getInstance cache setSource setUser setGroup FSEditLogOp reuseOp Mockito spy op Mockito doNothing when reuseOp reset Future logSpammers Future i i logSpammers i ii i logSpammers i Thread currentThread setName ii startSpamLatch await i get i i editLog logEdit reuseOp i
List XAttr existingXAttrs Lists newArrayListWithCapacity Random rand Random numExpectedXAttrs numExpectedXAttrs
List XAttr existingXAttrs Lists newArrayListWithCapacity Random rand Random numExpectedXAttrs numExpectedXAttrs LOG info numExpectedXAttrs numToAdd rand nextInt List XAttr toAdd Lists newArrayListWithCapacity numToAdd numToAdd numExpectedXAttrs toAdd add generatedXAttrs get numExpectedXAttrs numExpectedXAttrs LOG info toAdd size toAdd size
LOG info numExpectedXAttrs numToAdd rand nextInt List XAttr toAdd Lists newArrayListWithCapacity numToAdd i i numToAdd i numExpectedXAttrs toAdd add generatedXAttrs get numExpectedXAttrs numExpectedXAttrs LOG info toAdd size i i toAdd size i LOG info toAdd get i List XAttr newXAttrs FSDirXAttrOp setINodeXAttrs fsdir existingXAttrs toAdd EnumSet of XAttrSetFlag CREATE verifyXAttrsPresent newXAttrs numExpectedXAttrs existingXAttrs newXAttrs numExpectedXAttrs
startingFileSize BLOCK_SIZE fs mkdirs parent fs setQuota parent contents AppendTestUtil initBuffer startingFileSize fileLength startingFileSize fileLength fileLength BLOCK_SIZE toTruncate toTruncate fileLength toTruncate Path p Path parent fileLength writeContents contents fileLength p newLength fileLength toTruncate isReady fs truncate p newLength
Path dir Path fs mkdirs dir Path p Path dir data BLOCK_SIZE ThreadLocalRandom current nextBytes data writeContents data data length p n data length n newLength ThreadLocalRandom current nextInt n isReady fs truncate p newLength
n String s FsImageValidation Util toCommaSeparatedNumber n
conf path ByteArrayOutputStream bStream ByteArrayOutputStream PrintStream out PrintStream bStream GenericTestUtils setLogLevel FSPermissionChecker LOG org slf4j event Level TRACE errCode ToolRunner run DFSck conf out path
m numMissing m group m NUM_CORRUPT_BLOCKS_PATTERN matcher line m numCorrupt m group numMissing numCorrupt numMissing numCorrupt IOException numMissing equals Integer toString assertTrue numCorrupt equals Integer toString assertTrue outStr contains NamenodeFsck CORRUPT_STATUS Thread sleep
dfsBlockSize numDatanodes replication conf setLong DFSConfigKeys DFS_BLOCK_SIZE_KEY dfsBlockSize conf setLong DFSConfigKeys DFS_BLOCKREPORT_INTERVAL_MSEC_KEY conf setInt DFSConfigKeys DFS_DATANODE_DIRECTORYSCAN_INTERVAL_KEY conf setInt DFSConfigKeys DFS_REPLICATION_KEY replication File builderBaseDir File GenericTestUtils getRandomizedTempPath cluster MiniDFSCluster Builder conf builderBaseDir build DistributedFileSystem dfs cluster getFileSystem cluster waitActive String srcDir DFSTestUtil util DFSTestUtil Builder setName setMinSize dfsBlockSize setMaxSize dfsBlockSize setNumFiles build util createFiles dfs srcDir replication String fileNames util getFileNames srcDir
String str runFsck conf String numCorrupt String line str Matcher m NUM_CORRUPT_BLOCKS_PATTERN matcher line m numCorrupt m group numCorrupt Assert fail numCorrupt assertTrue str contains NamenodeFsck CORRUPT_STATUS
Assert fail assertTrue str contains NamenodeFsck CORRUPT_STATUS e LOG error e Assert fail runFsck conf LOG info runFsck conf List LocatedFileStatus retVal ArrayList RemoteIterator LocatedFileStatus iter dfs listFiles Path iter
LOG info nNameNodes nDataNodes LOG info MiniDFSCluster cluster MiniDFSCluster Builder conf nnTopology MiniDFSNNTopology simpleFederatedTopology nNameNodes numDataNodes nDataNodes build LOG info DFSTestUtil setFederatedConfiguration cluster conf cluster waitActive LOG info Suite s Suite cluster nNameNodes nDataNodes i i nNameNodes i s createFile i LOG info String urls String nNameNodes i i urls i urls i cluster getFileSystem i getUri FILE_NAME
MiniDFSCluster cluster MiniDFSCluster Builder conf nnTopology MiniDFSNNTopology simpleFederatedTopology nNameNodes numDataNodes nDataNodes build LOG info DFSTestUtil setFederatedConfiguration cluster conf cluster waitActive LOG info Suite s Suite cluster nNameNodes nDataNodes i i nNameNodes i s createFile i LOG info String urls String nNameNodes i i urls i urls i cluster getFileSystem i getUri FILE_NAME LOG info i urls i String result TestFsck runFsck conf urls i
LOG info String urls String nNameNodes i i urls i urls i cluster getFileSystem i getUri FILE_NAME LOG info i urls i String result TestFsck runFsck conf urls i LOG info result Assert assertTrue result contains LOG info String vurls String nNameNodes i i vurls i String link i FILE_NAME ConfigUtil addLink conf link URI urls i vurls i link i i vurls i
String urls String nNameNodes i i urls i urls i cluster getFileSystem i getUri FILE_NAME LOG info i urls i String result TestFsck runFsck conf urls i LOG info result Assert assertTrue result contains LOG info String vurls String nNameNodes i i vurls i String link i FILE_NAME ConfigUtil addLink conf link URI urls i vurls i link i i vurls i LOG info i vurls i
Configuration conf getConf REPLICATION_FACTOR Path filePath Path HostsFileWriter hostsFileWriter HostsFileWriter hostsFileWriter initialize conf String racks MiniDFSCluster cluster MiniDFSCluster Builder conf numDataNodes racks length racks racks build FSNamesystem ns cluster getNameNode getNamesystem FileSystem fs cluster getFileSystem DFSTestUtil createFile fs filePath REPLICATION_FACTOR ExtendedBlock b DFSTestUtil getFirstBlock fs filePath DFSTestUtil waitForReplication cluster b REPLICATION_FACTOR BlockLocation locs fs getFileBlockLocations fs getFileStatus filePath Long MAX_VALUE String name locs getNames
FileSystem fs FileSystem get miniDFS getConfiguration FileStatus status fs getFileStatus Path
INodeFile inodeFile INodeFile HdfsConstants GRANDFATHER_INODE_ID perm Short StripedFileTestUtil getDefaultECPolicy getId preferredBlockSize HdfsConstants WARM_STORAGE_POLICY_ID CONTIGUOUS fail iae LOG info iae INodeFile HdfsConstants GRANDFATHER_INODE_ID perm preferredBlockSize HdfsConstants WARM_STORAGE_POLICY_ID CONTIGUOUS fail iae LOG info iae INodeFile HdfsConstants GRANDFATHER_INODE_ID perm Short MAX_VALUE preferredBlockSize HdfsConstants WARM_STORAGE_POLICY_ID CONTIGUOUS fail iae
LOG info iae INodeFile HdfsConstants GRANDFATHER_INODE_ID perm preferredBlockSize HdfsConstants WARM_STORAGE_POLICY_ID CONTIGUOUS fail iae LOG info iae INodeFile HdfsConstants GRANDFATHER_INODE_ID perm Short MAX_VALUE preferredBlockSize HdfsConstants WARM_STORAGE_POLICY_ID CONTIGUOUS fail iae LOG info iae Short replication Short INodeFile HdfsConstants GRANDFATHER_INODE_ID perm replication preferredBlockSize HdfsConstants WARM_STORAGE_POLICY_ID STRIPED fail
Path inodeId remainingPath StringBuilder b StringBuilder b append Path SEPARATOR append FSDirectory DOT_RESERVED_STRING append Path SEPARATOR append FSDirectory DOT_INODES_STRING append Path SEPARATOR append inodeId append Path SEPARATOR append remainingPath Path p Path b toString
ex LOG info ex blockcount getBlockCount blockcount blockcount mc getNamesystem writeLock lockOps mc getNamesystem writeUnlock
blockcount getBlockCount blockcount blockcount mc getNamesystem writeLock lockOps mc getNamesystem writeUnlock Thread sleep ex LOG info ex threads start threads start start Time now
assertCorruptFilesCount cluster badFiles size String bpid cluster getNamesystem getBlockPoolId File storageDir cluster getInstanceStorageDir File data_dir MiniDFSCluster getFinalizedDir storageDir bpid assertTrue data_dir exists List File metaFiles MiniDFSCluster getAllBlockFiles data_dir assertTrue metaFiles metaFiles isEmpty File metaFile metaFiles get RandomAccessFile file RandomAccessFile metaFile FileChannel channel file getChannel position channel size corruptionLength buffer corruptionLength Random nextBytes buffer channel write ByteBuffer wrap buffer position file close
RandomAccessFile file RandomAccessFile metaFile FileChannel channel file getChannel position channel size corruptionLength buffer corruptionLength Random nextBytes buffer channel write ByteBuffer wrap buffer position file close LOG info metaFile getName position corruptionLength util checkFiles fs e System out println e assertTrue e badFiles namenode getNamesystem listCorruptFileBlocks
assertEquals badFiles size badFiles size assertCorruptFilesCount cluster badFiles size File storageDir cluster getInstanceStorageDir File data_dir MiniDFSCluster getFinalizedDir storageDir cluster getNamesystem getBlockPoolId assertTrue data_dir exists List File metaFiles MiniDFSCluster getAllBlockFiles data_dir assertTrue metaFiles metaFiles isEmpty File metaFile metaFiles get RandomAccessFile file RandomAccessFile metaFile FileChannel channel file getChannel position channel size corruptionLength buffer corruptionLength Random nextBytes buffer channel write ByteBuffer wrap buffer position file close
RandomAccessFile file RandomAccessFile metaFile FileChannel channel file getChannel position channel size corruptionLength buffer corruptionLength Random nextBytes buffer channel write ByteBuffer wrap buffer position file close LOG info metaFile getName position corruptionLength util checkFiles fs e System out println e assertTrue e badFiles cluster getNameNode getNamesystem listCorruptFileBlocks
badFiles cluster getNameNode getNamesystem listCorruptFileBlocks LOG info badFiles size assertEquals badFiles size badFiles size assertCorruptFilesCount cluster badFiles size cluster restartNameNode fs cluster getFileSystem cluster getNameNode LOG info Thread sleep util checkFiles fs System out println
LOG info Thread sleep util checkFiles fs e System out println e assertTrue e badFiles cluster getNameNode getNamesystem listCorruptFileBlocks LOG info badFiles size assertEquals badFiles size badFiles size assertCorruptFilesCount cluster badFiles size assertTrue cluster getNameNode isInSafeMode
util createFiles fs NameNode namenode cluster getNameNode Collection FSNamesystem CorruptFileBlockInfo corruptFileBlocks namenode getNamesystem listCorruptFileBlocks numCorrupt corruptFileBlocks size assertEquals numCorrupt assertCorruptFilesCount cluster numCorrupt String bpid cluster getNamesystem getBlockPoolId i i i j j j File storageDir cluster getInstanceStorageDir i j File data_dir MiniDFSCluster getFinalizedDir storageDir bpid List File metadataFiles MiniDFSCluster getAllBlockMetadataFiles data_dir metadataFiles File metadataFile metadataFiles File blockFile Block metaToBlockFile metadataFile
Collection FSNamesystem CorruptFileBlockInfo corruptFileBlocks namenode getNamesystem listCorruptFileBlocks numCorrupt corruptFileBlocks size assertEquals numCorrupt assertCorruptFilesCount cluster numCorrupt String bpid cluster getNamesystem getBlockPoolId i i i j j j File storageDir cluster getInstanceStorageDir i j File data_dir MiniDFSCluster getFinalizedDir storageDir bpid List File metadataFiles MiniDFSCluster getAllBlockMetadataFiles data_dir metadataFiles File metadataFile metadataFiles File blockFile Block metaToBlockFile metadataFile LOG info blockFile getName assertTrue blockFile delete
DistributedFileSystem dfs DistributedFileSystem fs DFSTestUtil util DFSTestUtil Builder setName setNumFiles setMaxLevels setMaxSize build util createFiles fs RemoteIterator Path corruptFileBlocks dfs listCorruptFileBlocks Path numCorrupt countPaths corruptFileBlocks assertEquals numCorrupt assertCorruptFilesCount cluster numCorrupt String bpid cluster getNamesystem getBlockPoolId i i i File storageDir cluster getInstanceStorageDir i File data_dir MiniDFSCluster getFinalizedDir storageDir bpid List File metadataFiles MiniDFSCluster getAllBlockMetadataFiles data_dir metadataFiles File metadataFile metadataFiles File blockFile Block metaToBlockFile metadataFile
util createFiles fs RemoteIterator Path corruptFileBlocks dfs listCorruptFileBlocks Path numCorrupt countPaths corruptFileBlocks assertEquals numCorrupt assertCorruptFilesCount cluster numCorrupt String bpid cluster getNamesystem getBlockPoolId i i i File storageDir cluster getInstanceStorageDir i File data_dir MiniDFSCluster getFinalizedDir storageDir bpid List File metadataFiles MiniDFSCluster getAllBlockMetadataFiles data_dir metadataFiles File metadataFile metadataFiles File blockFile Block metaToBlockFile metadataFile LOG info blockFile getName assertTrue blockFile delete
cluster MiniDFSCluster Builder conf build FileSystem fs cluster getFileSystem maxCorruptFileBlocks conf getInt DFSConfigKeys DFS_NAMENODE_MAX_CORRUPT_FILE_BLOCKS_RETURNED_KEY DFSTestUtil util DFSTestUtil Builder setName setNumFiles maxCorruptFileBlocks setMaxLevels setMaxSize build util createFiles fs util waitReplication fs NameNode namenode cluster getNameNode Collection FSNamesystem CorruptFileBlockInfo badFiles namenode getNamesystem listCorruptFileBlocks assertEquals badFiles size badFiles size assertCorruptFilesCount cluster badFiles size String bpid cluster getNamesystem getBlockPoolId i i i j j j File storageDir cluster getInstanceStorageDir i j File data_dir MiniDFSCluster getFinalizedDir storageDir bpid
File data_dir MiniDFSCluster getFinalizedDir storageDir bpid LOG info data_dir List File metadataFiles MiniDFSCluster getAllBlockMetadataFiles data_dir metadataFiles File metadataFile metadataFiles File blockFile Block metaToBlockFile metadataFile assertTrue blockFile delete assertTrue metadataFile delete DataNode dn cluster getDataNodes get DataNodeTestUtils runDirectoryScanner dn LOG info cluster restartDataNodes cluster waitActive badFiles namenode getNamesystem listCorruptFileBlocks badFiles
File metadataFile File blockFile Block metaToBlockFile metadataFile assertTrue blockFile delete assertTrue metadataFile delete DataNode dn cluster getDataNodes get DataNodeTestUtils runDirectoryScanner dn LOG info cluster restartDataNodes cluster waitActive badFiles namenode getNamesystem listCorruptFileBlocks badFiles size LOG info badFiles size Thread sleep badFiles namenode getNamesystem listCorruptFileBlocks badFiles namenode getNamesystem listCorruptFileBlocks
fs setWorkingDirectory baseDir DFSTestUtil util DFSTestUtil Builder setName setNumFiles setMaxLevels setMaxSize build util createFiles fs RemoteIterator Path corruptFileBlocks dfs listCorruptFileBlocks Path numCorrupt countPaths corruptFileBlocks assertEquals numCorrupt assertCorruptFilesCount cluster numCorrupt String bpid cluster getNamesystem getBlockPoolId i i i File storageDir cluster getInstanceStorageDir i File data_dir MiniDFSCluster getFinalizedDir storageDir bpid List File metadataFiles MiniDFSCluster getAllBlockMetadataFiles data_dir metadataFiles File metadataFile metadataFiles File blockFile Block metaToBlockFile metadataFile
util createFiles fs RemoteIterator Path corruptFileBlocks dfs listCorruptFileBlocks Path numCorrupt countPaths corruptFileBlocks assertEquals numCorrupt assertCorruptFilesCount cluster numCorrupt String bpid cluster getNamesystem getBlockPoolId i i i File storageDir cluster getInstanceStorageDir i File data_dir MiniDFSCluster getFinalizedDir storageDir bpid List File metadataFiles MiniDFSCluster getAllBlockMetadataFiles data_dir metadataFiles File metadataFile metadataFiles File blockFile Block metaToBlockFile metadataFile LOG info blockFile getName assertTrue blockFile delete
ThreadLocalRandom current nextBytes data DFSTestUtil createOpenFiles fileSystem BATCH_SIZE BATCH_SIZE DFSAdmin dfsAdmin DFSAdmin haConf AtomicBoolean failoverCompleted AtomicBoolean AtomicBoolean listOpenFilesError AtomicBoolean listingIntervalMsec Thread Thread run failoverCompleted assertEquals ToolRunner run dfsAdmin String assertEquals ToolRunner run dfsAdmin String Thread sleep listingIntervalMsec listOpenFilesError set
MiniDFSCluster cluster HostsFileWriter hostsFileWriter HostsFileWriter hostsFileWriter initialize conf cluster MiniDFSCluster Builder conf numDataNodes build cluster waitActive FSNamesystem fsn cluster getNameNode namesystem MBeanServer mbs ManagementFactory getPlatformMBeanServer ObjectName mxbeanName ObjectName List String hosts ArrayList dn cluster hosts add dn getDisplayName hostsFileWriter initIncludeHosts hosts toArray String hosts size fsn getBlockManager getDatanodeManager refreshNodes conf String liveNodesInfo String mbs getAttribute mxbeanName
Map String Object liveNode assertTrue liveNode containsKey assertTrue liveNode containsKey Map String Long maintenanceNodes HashMap maintenanceNodes put cluster getDataNodes get getDisplayName Time now expirationInMs hostsFileWriter initOutOfServiceHosts maintenanceNodes fsn getBlockManager getDatanodeManager refreshNodes conf recheck recheck String enteringMaintenanceNodesInfo String mbs getAttribute mxbeanName Map String Map String Object enteringMaintenanceNodes Map String Map String Object JSON parse enteringMaintenanceNodesInfo enteringMaintenanceNodes LOG info Uninterruptibles sleepUninterruptibly TimeUnit SECONDS
FSEditLog spyLog spy cluster getNameNode getFSImage getEditLog doNothing when spyLog endCurrentLogSegment DFSTestUtil setEditLogForTesting cluster getNamesystem spyLog fileSys cluster getFileSystem FSNamesystem namesystem cluster getNamesystem FSImage fsimage namesystem getFSImage fileSys mkdirs Path TEST_PATH fileSys mkdirs Path TEST_PATH2 sd fsimage getStorage dirIterator NameNodeDirType EDITS next cluster cluster shutdown File editFile FSImageTestUtil findLatestEditsLog sd getFile assertTrue editFile editFile exists
cluster cluster shutdown File editFile FSImageTestUtil findLatestEditsLog sd getFile assertTrue editFile editFile exists LOG info editFile corruptor corrupt editFile cluster LOG debug cluster MiniDFSCluster Builder conf numDataNodes enableManagedDfsDirsRedundancy format build cluster waitActive cluster shutdown fail
e LOG error corruptor getName corruptor e fail e getMessage cluster cluster shutdown cluster LOG debug cluster MiniDFSCluster Builder conf numDataNodes enableManagedDfsDirsRedundancy format startupOption recoverStartOpt build e fail e getMessage StringUtils stringifyException e cluster
List DatanodeDescriptor live ArrayList DatanodeDescriptor List DatanodeDescriptor dead ArrayList DatanodeDescriptor dm fetchDatanodes live dead assertTrue live size used remaining configCapacity nonDFSUsed bpUsed percentUsed percentRemaining percentBpUsed DatanodeDescriptor datanode live used datanode getDfsUsed remaining datanode getRemaining nonDFSUsed datanode getNonDfsUsed configCapacity datanode getCapacity percentUsed datanode getDfsUsedPercent percentRemaining datanode getRemainingPercent bpUsed datanode getBlockPoolUsed percentBpUsed datanode getBlockPoolUsedPercent
assertTrue percentUsed DFSUtilClient getPercentUsed used configCapacity assertTrue percentRemaining DFSUtilClient getPercentRemaining remaining configCapacity assertTrue percentBpUsed DFSUtilClient getPercentUsed bpUsed configCapacity FsDatasetTestUtils utils cluster getFsDatasetTestUtils numOfDataDirs utils getDefaultNumOfDataDirs diskCapacity numOfDataDirs utils getRawCapacity reserved numOfDataDirs configCapacity namesystem getCapacityTotal used namesystem getCapacityUsed nonDFSUsed namesystem getNonDfsUsedSpace remaining namesystem getCapacityRemaining percentUsed namesystem getPercentUsed percentRemaining namesystem getPercentRemaining bpUsed namesystem getBlockPoolUsedSpace percentBpUsed namesystem getPercentBlockPoolUsed
assertTrue percentRemaining DFSUtilClient getPercentRemaining remaining configCapacity assertTrue percentBpUsed DFSUtilClient getPercentUsed bpUsed configCapacity FsDatasetTestUtils utils cluster getFsDatasetTestUtils numOfDataDirs utils getDefaultNumOfDataDirs diskCapacity numOfDataDirs utils getRawCapacity reserved numOfDataDirs configCapacity namesystem getCapacityTotal used namesystem getCapacityUsed nonDFSUsed namesystem getNonDfsUsedSpace remaining namesystem getCapacityRemaining percentUsed namesystem getPercentUsed percentRemaining namesystem getPercentRemaining bpUsed namesystem getBlockPoolUsedSpace percentBpUsed namesystem getPercentBlockPoolUsed LOG info cluster getDataDirectory
testMatrixEntry Configuration conf HdfsConfiguration MiniDFSCluster cluster setupTestCase conf testMatrixEntry getProtectedPaths testMatrixEntry getUnprotectedPaths
testMatrixEntry Configuration conf HdfsConfiguration conf setInt DFSConfigKeys FS_TRASH_INTERVAL_KEY MiniDFSCluster cluster setupTestCase conf testMatrixEntry getProtectedPaths testMatrixEntry getUnprotectedPaths
testMatrixEntry Configuration conf HdfsConfiguration MiniDFSCluster cluster setupTestCase conf testMatrixEntry getProtectedPaths testMatrixEntry getUnprotectedPaths
testMatrixEntry Configuration conf HdfsConfiguration conf setBoolean DFS_PROTECTED_SUBDIRECTORIES_ENABLE MiniDFSCluster cluster setupTestCase conf testMatrixEntry getProtectedPaths testMatrixEntry getUnprotectedPaths
testMatrixEntry Configuration conf HdfsConfiguration conf setBoolean DFS_PROTECTED_SUBDIRECTORIES_ENABLE conf setInt DFSConfigKeys FS_TRASH_INTERVAL_KEY MiniDFSCluster cluster setupTestCase conf testMatrixEntry getProtectedPaths testMatrixEntry getUnprotectedPaths
testMatrixEntry Configuration conf HdfsConfiguration conf setBoolean DFS_PROTECTED_SUBDIRECTORIES_ENABLE MiniDFSCluster cluster setupTestCase conf testMatrixEntry getProtectedPaths testMatrixEntry getUnprotectedPaths
dfs setStoragePolicy bar HdfsConstants ONESSD_STORAGE_POLICY_NAME dfs setQuotaByStorageType foo StorageType SSD BLOCKSIZE dfs setQuotaByStorageType bar StorageType SSD BLOCKSIZE INode fnode fsdir getINode4Write foo toString assertTrue fnode isDirectory assertTrue fnode isQuotaSet file1Len BLOCKSIZE bufLen BLOCKSIZE DFSTestUtil createFile dfs createdFile1foo bufLen file1Len BLOCKSIZE REPLICATION seed ssdConsumed fnode asDirectory getDirectoryWithQuotaFeature getSpaceConsumed getTypeSpaces get StorageType SSD assertEquals file1Len ssdConsumed dfs rename createdFile1foo createdFile1bar fail
bufLen BLOCKSIZE DFSTestUtil createFile dfs createdFile1 bufLen file1Len BLOCKSIZE REPLICATION seed currentSSDConsumed fnode asDirectory getDirectoryWithQuotaFeature getSpaceConsumed getTypeSpaces get StorageType SSD assertEquals file1Len currentSSDConsumed Path createdFile2 Path foo file2Len BLOCKSIZE BLOCKSIZE DFSTestUtil createFile dfs createdFile2 bufLen file2Len BLOCKSIZE REPLICATION seed currentSSDConsumed fnode asDirectory getDirectoryWithQuotaFeature getSpaceConsumed getTypeSpaces get StorageType SSD assertEquals file1Len file2Len currentSSDConsumed Path createdFile3 Path foo file3Len BLOCKSIZE DFSTestUtil createFile dfs createdFile3 bufLen file3Len BLOCKSIZE REPLICATION seed fail
Path createdFile1 Path child file1Len BLOCKSIZE BLOCKSIZE bufLen BLOCKSIZE DFSTestUtil createFile dfs createdFile1 bufLen file1Len BLOCKSIZE replication seed INode fnode fsdir getINode4Write parent toString assertTrue fnode isDirectory assertTrue fnode isQuotaSet currentSSDConsumed fnode asDirectory getDirectoryWithQuotaFeature getSpaceConsumed getTypeSpaces get StorageType SSD assertEquals file1Len currentSSDConsumed Path createdFile2 Path child file2Len BLOCKSIZE DFSTestUtil createFile dfs createdFile2 bufLen file2Len BLOCKSIZE replication seed fail
Path parent Path dir Path child Path parent dfs mkdirs parent dfs mkdirs child dfs setStoragePolicy parent HdfsConstants ONESSD_STORAGE_POLICY_NAME dfs setQuotaByStorageType parent StorageType SSD BLOCKSIZE dfs setQuotaByStorageType child StorageType SSD BLOCKSIZE Path createdFile1 Path child file1Len BLOCKSIZE BLOCKSIZE bufLen BLOCKSIZE DFSTestUtil createFile dfs createdFile1 bufLen file1Len BLOCKSIZE REPLICATION seed fail
dfs mkdirs testDir dfs setStoragePolicy testDir HdfsConstants ONESSD_STORAGE_POLICY_NAME ssdQuota BLOCKSIZE ssdQuotaInBlocks storageSpaceQuota BLOCKSIZE storageSpaceQuotaInBlocks dfs setQuota testDir Long MAX_VALUE storageSpaceQuota dfs setQuotaByStorageType testDir StorageType SSD ssdQuota INode testDirNode fsdir getINode4Write testDir toString assertTrue testDirNode isDirectory assertTrue testDirNode isQuotaSet Path createdFile Path testDir fileLen testFileLenInBlocks BLOCKSIZE DFSTestUtil createFile dfs createdFile BLOCKSIZE fileLen BLOCKSIZE replication seed fail
storageTypeSpaceQuota BLOCKSIZE dfs setQuota testDir HdfsConstants QUOTA_DONT_SET storageSpaceQuota Path createdFile fileLen BLOCKSIZE createdFile Path testDir DFSTestUtil createFile dfs createdFile BLOCKSIZE fileLen BLOCKSIZE REPLICATION seed assertTrue dfs exists createdFile assertTrue dfs isFile createdFile dfs setQuotaByStorageType testDir StorageType DISK storageTypeSpaceQuota dfs setStoragePolicy testDir HdfsConstants WARM_STORAGE_POLICY_NAME createdFile Path testDir DFSTestUtil createFile dfs createdFile BLOCKSIZE fileLen BLOCKSIZE REPLICATION seed fail
assertNotEquals fei0 getEzKeyVersionName zs getEzKeyVersionName assertEquals fei1 getEzKeyVersionName zs getEzKeyVersionName assertEquals zs getFilesReencrypted dfsAdmin reencryptEncryptionZone zone ReencryptAction START waitForReencryptedZones assertKeyVersionEquals encFile1 fei1 dfsAdmin reencryptEncryptionZone subdir ReencryptAction START fail expected LOG info expected assertExceptionContains expected dfsAdmin reencryptEncryptionZone Path zone ReencryptAction START fail
dfsAdmin reencryptEncryptionZone subdir ReencryptAction START fail expected LOG info expected assertExceptionContains expected dfsAdmin reencryptEncryptionZone Path zone ReencryptAction START fail expected LOG info expected assertTrue expected unwrapRemoteException FileNotFoundException dfsAdmin reencryptEncryptionZone encFile1 ReencryptAction START fail
dfsAdmin reencryptEncryptionZone Path zone ReencryptAction START fail expected LOG info expected assertTrue expected unwrapRemoteException FileNotFoundException dfsAdmin reencryptEncryptionZone encFile1 ReencryptAction START fail expected LOG info expected assertExceptionContains expected getEzManager pauseReencryptForTesting dfsAdmin reencryptEncryptionZone zone ReencryptAction START waitForQueuedZones
DFSTestUtil createFile fs Path zone Integer toString i len Path subdir Path fsWrapper mkdir subdir FsPermission getDirDefault DFSTestUtil createFile fs Path subdir len Path zoneSnap fs createSnapshot zone fsWrapper rename Path zone Path zone fsWrapper rename Path zone Path zone fsWrapper delete Path zone Path encFile1 Path zone FileEncryptionInfo fei0 getFileEncryptionInfo encFile1 rollKey TEST_KEY dfsAdmin reencryptEncryptionZone zoneSnap ReencryptAction START fail
expected assertExceptionContains expected rollKey TEST_KEY getEzManager pauseForTestingAfterNthSubmission getEzManager resumeReencryptForTesting dfsAdmin reencryptEncryptionZone zone ReencryptAction START waitForReencryptedFiles zone toString dfsAdmin reencryptEncryptionZone zone ReencryptAction CANCEL getEzManager resumeReencryptForTesting waitForZoneCompletes zone toString assertEquals getZoneStatus zone toString getFilesReencrypted assertNull getEzManager getZoneStatus zone toString getLastCheckpointFile assertNull getReencryptionStatus getNextUnprocessedZone dfsAdmin reencryptEncryptionZone subdir ReencryptAction CANCEL
dfsAdmin reencryptEncryptionZone zone ReencryptAction START waitForReencryptedFiles zone toString dfsAdmin reencryptEncryptionZone zone ReencryptAction CANCEL getEzManager resumeReencryptForTesting waitForZoneCompletes zone toString assertEquals getZoneStatus zone toString getFilesReencrypted assertNull getEzManager getZoneStatus zone toString getLastCheckpointFile assertNull getReencryptionStatus getNextUnprocessedZone dfsAdmin reencryptEncryptionZone subdir ReencryptAction CANCEL fail expected LOG info expected assertExceptionContains expected
assertNull getReencryptionStatus getNextUnprocessedZone dfsAdmin reencryptEncryptionZone subdir ReencryptAction CANCEL fail expected LOG info expected assertExceptionContains expected dfsAdmin reencryptEncryptionZone Path zone ReencryptAction CANCEL fail expected LOG info expected assertTrue expected unwrapRemoteException FileNotFoundException Path encFile Path zone
shouldFail fail doAnEdit fsn fsn setSafeMode SafeModeAction SAFEMODE_ENTER fsn saveNamespace shouldFail fail e shouldFail e
originalImage close fsn close fsn LOG info fsn FSNamesystem loadFromDisk conf LOG info checkEditExists fsn LOG info fs setPermission rootPath permissionAll fsn fsn close
NNStorage storage originalImage getStorage storage close NNStorage spyStorage spy storage originalImage storage spyStorage FSImage spyImage spy originalImage Whitebox setInternalState fsn spyImage spyImage storage setStorageDirectories FSNamesystem getNamespaceDirs conf FSNamesystem getNamespaceEditsDirs conf doThrow IOException when spyImage saveFSImage any any any doAnEdit fsn fsn setSafeMode SafeModeAction SAFEMODE_ENTER fsn saveNamespace fail IOException
LOG info MiniDFSCluster cluster SecondaryNameNode sn cluster MiniDFSCluster Builder config manageDataDfsDirs manageNameDfsDirs build cluster waitActive LOG info sn SecondaryNameNode config assertNotNull sn i i i FileSystem fileSys cluster getFileSystem Path p Path i DFSTestUtil createFile fileSys p fileSize fileSize blockSize seed
fi ArrayList StorageDirectory al ArrayList StorageDirectory Iterator StorageDirectory it fi getStorage dirIterator it StorageDirectory sd it next sd
cluster MiniDFSCluster Builder config numDataNodes manageNameDfsDirs build cluster waitActive FSImage fsi cluster getNameNode getFSImage restore fsi getStorage getRestoreFailedStorage
INodeFile inodeFile INodeFile HdfsConstants GRANDFATHER_INODE_ID perm Short StripedFileTestUtil getDefaultECPolicy getId HdfsConstants WARM_STORAGE_POLICY_ID STRIPED fail iae LOG info iae INodeFile HdfsConstants GRANDFATHER_INODE_ID perm HdfsConstants WARM_STORAGE_POLICY_ID STRIPED fail iae LOG info iae INodeFile HdfsConstants GRANDFATHER_INODE_ID perm Byte MAX_VALUE HdfsConstants WARM_STORAGE_POLICY_ID STRIPED fail iae
LOG info iae INodeFile HdfsConstants GRANDFATHER_INODE_ID perm HdfsConstants WARM_STORAGE_POLICY_ID STRIPED fail iae LOG info iae INodeFile HdfsConstants GRANDFATHER_INODE_ID perm Byte MAX_VALUE HdfsConstants WARM_STORAGE_POLICY_ID STRIPED fail iae LOG info iae Byte ecPolicyID StripedFileTestUtil getDefaultECPolicy getId INodeFile HdfsConstants GRANDFATHER_INODE_ID perm ecPolicyID HdfsConstants WARM_STORAGE_POLICY_ID CONTIGUOUS fail
nn0 getRpcServer rollEditLog nn0 getRpcServer rollEditLog NameNodeAdapter enterSafeMode nn0 NameNodeAdapter saveNamespace nn0 NameNodeAdapter leaveSafeMode nn0 expectedCheckpointTxId NameNodeAdapter getNamesystem nn0 getFSImage getMostRecentCheckpointTxId assertEquals expectedCheckpointTxId cluster getFileSystem create Path close URI editsUri cluster getSharedEditsDir maxNNCount seen_txid_shared FSImageTestUtil getStorageTxId nn0 editsUri i i maxNNCount i assertEquals forceBootstrap i
u assertTrue u getScheme equals File dir File u getPath
MiniDFSCluster cluster cluster MiniDFSCluster Builder conf nnTopology MiniDFSNNTopology simpleHATopology numDataNodes build uri cluster File prevTmp File File uri Storage STORAGE_TMP_PREVIOUS
AppendTestUtil write out out hflush cluster triggerBlockReports numQueued numDN IOUtils closeStream out cluster triggerHeartbeats numQueued numDN assertEquals numQueued cluster getNameNode getNamesystem getPendingDataNodeMessageCount out fs append TEST_FILE_PATH AppendTestUtil write out IOUtils closeStream out numQueued numDN
identifier readFields DataInputStream ByteArrayInputStream tokenId LOG info assertTrue dtSecretManager retrievePassword identifier dtSecretManager renewToken token cluster transitionToStandby cluster getNameNodeRpc renewDelegationToken token fail e GenericTestUtils assertExceptionContains HAServiceState STANDBY toString e cluster transitionToActive e
StandbyException e GenericTestUtils assertExceptionContains HAServiceState STANDBY toString e Thread cluster transitionToActive e LOG error e Thread sleep nn1 getNamesystem verifyToken token decodeIdentifier token getPassword fail e assertTrue e StandbyException e RetriableException
Configuration conf Configuration MiniDFSCluster cluster MiniDFSCluster Builder conf nnTopology MiniDFSNNTopology simpleHATopology numDataNodes build URI sharedUri cluster getSharedEditsDir File sharedDir File sharedUri getPath FSNamesystem fsn cluster getNamesystem FSImageTestUtil createAbortedLogWithMkdirs sharedDir NUM_DIRS_IN_LOG fsn getFSDirectory getLastInodeId assertEditFiles Collections singletonList sharedUri NNStorage getInProgressEditsFileName FileOutputStream outs File editLogFile File sharedDir NNStorage getInProgressEditsFileName outs FileOutputStream editLogFile outs write
u File editDirRoot File u getPath File editDir File editDirRoot GenericTestUtils assertExists editDir
conf Configuration conf setInt DFSConfigKeys DFS_NAMENODE_CHECKPOINT_CHECK_PERIOD_KEY conf setInt DFSConfigKeys DFS_NAMENODE_CHECKPOINT_TXNS_KEY conf setInt DFSConfigKeys DFS_NAMENODE_NUM_CHECKPOINTS_RETAINED_KEY conf setInt DFSConfigKeys DFS_HA_TAILEDITS_PERIOD_KEY conf setBoolean DFSConfigKeys DFS_NAMENODE_EDITS_ASYNC_LOGGING useAsyncEditLogging HAUtil setAllowStandbyReads conf basePort retryCount basePort RANDOM nextInt
basePort retryCount basePort RANDOM nextInt LOG info basePort MiniDFSNNTopology topology MiniQJMHACluster createDefaultTopology basePort cluster MiniDFSCluster Builder conf nnTopology topology numDataNodes checkExitOnShutdown build cluster cluster shutdown cluster retryCount
Map Path Boolean results Collections synchronizedMap HashMap Path Boolean Path test Path cluster getConfiguration setInt DFSConfigKeys DFS_NAMENODE_SAFEMODE_MIN_DATANODES_KEY NameNodeAdapter enterSafeMode nn0 Whitebox setInternalState nn0 getNamesystem BlockManagerTestUtil setStartupSafeModeForTest nn0 getNamesystem getBlockManager assertTrue nn0 getNamesystem isInStartupSafeMode LOG info mkdir fs mkdirs test
cluster getConfiguration setInt DFSConfigKeys DFS_NAMENODE_SAFEMODE_MIN_DATANODES_KEY NameNodeAdapter enterSafeMode nn0 Whitebox setInternalState nn0 getNamesystem BlockManagerTestUtil setStartupSafeModeForTest nn0 getNamesystem getBlockManager assertTrue nn0 getNamesystem isInStartupSafeMode LOG info mkdir fs mkdirs test LOG info mkdir TestHASafeMode results put test mkdir TestHASafeMode notifyAll
cluster nsIndex nn0 nsIndex nn1 nsIndex cluster transitionToActive nn0
cluster conf nsIndex nn0 nsIndex nn1 nsIndex cluster transitionToActive nn0 LOG info nsIndex FileSystem fs HATestUtil configureFailoverFs cluster conf fs mkdirs TEST_DIR
cluster conf nsIndex nn0 nsIndex nn1 nsIndex cluster transitionToActive nn0 LOG info nsIndex FileSystem fs HATestUtil configureFailoverFs cluster conf fs mkdirs TEST_DIR LOG info nsIndex cluster transitionToStandby nn0 cluster transitionToActive nn1 assertTrue fs exists TEST_DIR DFSTestUtil writeFile fs TEST_FILE_PATH TEST_FILE_DATA
FileSystem fs HATestUtil configureFailoverFs cluster conf fs mkdirs TEST_DIR LOG info nsIndex cluster transitionToStandby nn0 cluster transitionToActive nn1 assertTrue fs exists TEST_DIR DFSTestUtil writeFile fs TEST_FILE_PATH TEST_FILE_DATA LOG info nsIndex cluster transitionToStandby nn1 cluster transitionToActive nn0 assertTrue fs exists TEST_DIR assertEquals TEST_FILE_DATA DFSTestUtil readFile fs TEST_FILE_PATH LOG info fs delete TEST_DIR assertFalse fs exists TEST_DIR
setObserverRead dfs create testPath close assertSentTo String result TestFsck runFsck conf
setObserverRead DFSTestUtil createFile dfs testPath DFSTestUtil waitForReplication dfs testPath ExtendedBlock block DFSTestUtil getFirstBlock dfs testPath dnToCorrupt DFSTestUtil firstDnWithBlock dfsCluster block FSNamesystem ns dfsCluster getNameNode getNamesystem dfsCluster corruptReplica dnToCorrupt block dfsCluster restartDataNode dnToCorrupt DFSTestUtil waitCorruptReplicas dfs ns testPath block String result TestFsck runFsck conf
MiniDFSCluster cluster newMiniCluster conf cluster waitActive cluster transitionToActive Thread sleep LOG info FileSystem fs HATestUtil configureFailoverFs cluster conf stm fs create TEST_PATH AppendTestUtil write stm BLOCK_AND_A_HALF stm hflush nextActive failover cluster scenario assertTrue fs exists TEST_PATH cluster stopDataNode AppendTestUtil write stm BLOCK_AND_A_HALF BLOCK_AND_A_HALF stm hflush
conf setInt DFSConfigKeys DFS_BLOCK_SIZE_KEY BLOCK_SIZE FSDataOutputStream stm MiniDFSCluster cluster newMiniCluster conf cluster waitActive cluster transitionToActive Thread sleep LOG info FileSystem fs HATestUtil configureFailoverFs cluster conf stm fs create TEST_PATH AppendTestUtil write stm BLOCK_SIZE stm hflush NameNode nn0 cluster getNameNode ExtendedBlock blk DFSTestUtil getFirstBlock fs TEST_PATH DatanodeDescriptor expectedPrimary DFSTestUtil getExpectedPrimaryNode nn0 blk
LOG info String scmds String String scmd scmds String scmd_str StringUtils join scmd ShellCommandExecutor sce ShellCommandExecutor scmd sce execute
op Map String Object results ConcurrentHashMap op prepare DummyRetryInvocationHandler block set op invoke Object result op getResult
op invoke Object result op getResult LOG info op name results put op name result result e LOG info op name e IOUtils cleanup op client assertTrue op name op checkNamenodeBeforeReturn cluster transitionToStandby cluster transitionToActive LOG info DummyRetryInvocationHandler block set GenericTestUtils waitFor results containsKey op name
conf setInt DFSConfigKeys DFS_NAMENODE_NUM_CHECKPOINTS_RETAINED_KEY conf setInt DFSConfigKeys DFS_NAMENODE_NUM_EXTRA_EDITS_RETAINED_KEY retryCount basePort random nextInt MiniDFSNNTopology topology MiniDFSNNTopology addNameservice MiniDFSNNTopology NSConf addNN MiniDFSNNTopology NNConf setHttpPort basePort addNN MiniDFSNNTopology NNConf setHttpPort basePort addNN MiniDFSNNTopology NNConf setHttpPort basePort cluster MiniDFSCluster Builder conf nnTopology topology numDataNodes build cluster waitActive setNNs fs HATestUtil configureFailoverFs cluster conf cluster transitionToActive retryCount
u File editDirRoot File u getPath File editDir File editDirRoot GenericTestUtils assertExists editDir
Path snapRootDir Path String hbaseFileName String snap1Name Path hbaseFile Path snapRootDir hbaseFileName createFile hbaseFile FSDataOutputStream hbaseOutputStream fs append hbaseFile newWriteLength BLOCKSIZE buf newWriteLength Random random Random random nextBytes buf writeToStream hbaseOutputStream buf Path snap1Dir SnapshotTestHelper createSnapshot fs snapRootDir snap1Name
flumeOutputStream write bytes hbaseOutputStream hbaseOutputStream write bytes startLatch countDown deleteLatch countDown hbaseOutputStream hsync fs delete hbaseFile hbaseOutputStream close hbaseOutputStream
i hbaseOutputStream hsync fs delete hbaseFile hbaseOutputStream close e hbaseOutputStream i LOG info flumeOutputStream getPos fs getFileStatus flumeFile getLen i e LOG warn e writerError set t start startLatch await
fs delete hbaseFile hbaseOutputStream close e hbaseOutputStream i LOG info flumeOutputStream getPos fs getFileStatus flumeFile getLen i e LOG warn e writerError set t start startLatch await Path snap1Dir SnapshotTestHelper createSnapshot fs snapRootDir snap1Name Path flumeS1Path Path snap1Dir flumeFileName
hbaseOutputStream close e hbaseOutputStream i LOG info flumeOutputStream getPos fs getFileStatus flumeFile getLen i e LOG warn e writerError set t start startLatch await Path snap1Dir SnapshotTestHelper createSnapshot fs snapRootDir snap1Name Path flumeS1Path Path snap1Dir flumeFileName LOG info fs getFileStatus flumeS1Path
hbaseOutputStream close e hbaseOutputStream i LOG info flumeOutputStream getPos fs getFileStatus flumeFile getLen i e LOG warn e writerError set t start startLatch await Path snap1Dir SnapshotTestHelper createSnapshot fs snapRootDir snap1Name Path flumeS1Path Path snap1Dir flumeFileName LOG info fs getFileStatus flumeS1Path LOG info fs getFileStatus flumeFile
seed System currentTimeMillis
seed System currentTimeMillis LOG info seed generator Random seed fileLen generator nextInt MAX_NUM_FILE_LENGTH createFiles TESTDIRSTRING fileLen SnapshottableDirectoryStatus snapshottableDirectoryStatus hdfs getSnapshottableDirListing SnapshottableDirectoryStatus ssds snapshottableDirectoryStatus snapshottableDirectories add ssds getFullPath snapshottableDirectories hdfs allowSnapshot hdfs getHomeDirectory snapshottableDirectories add hdfs getHomeDirectory numberOfIterations generator nextInt MAX_NUM_ITERATIONS LOG info numberOfIterations numberFileSystemOperations generator nextInt MAX_NUM_FILESYSTEM_OPERATIONS MIN_NUM_OPERATIONS MIN_NUM_OPERATIONS
LOG info seed generator Random seed fileLen generator nextInt MAX_NUM_FILE_LENGTH createFiles TESTDIRSTRING fileLen SnapshottableDirectoryStatus snapshottableDirectoryStatus hdfs getSnapshottableDirListing SnapshottableDirectoryStatus ssds snapshottableDirectoryStatus snapshottableDirectories add ssds getFullPath snapshottableDirectories hdfs allowSnapshot hdfs getHomeDirectory snapshottableDirectories add hdfs getHomeDirectory numberOfIterations generator nextInt MAX_NUM_ITERATIONS LOG info numberOfIterations numberFileSystemOperations generator nextInt MAX_NUM_FILESYSTEM_OPERATIONS MIN_NUM_OPERATIONS MIN_NUM_OPERATIONS LOG info numberFileSystemOperations numberSnapshotOperations generator nextInt MAX_NUM_SNAPSHOT_OPERATIONS MIN_NUM_OPERATIONS MIN_NUM_OPERATIONS
Operations fsOperation Operations getRandomOperation OperationType FileSystem
Operations snapshotOperation Operations getRandomOperation OperationType Snapshot
createSnapshot snapshottableDirectories size index generator nextInt snapshottableDirectories size Path randomDir snapshottableDirectories get index String snapshotName Integer toString generator nextInt hdfs createSnapshot randomDir snapshotName
deleteSnapshot pathToSnapshotsMap index generator nextInt pathToSnapshotsMap size Object snapshotPaths pathToSnapshotsMap keySet toArray Path snapshotPath Path snapshotPaths index ArrayList String snapshotNameList pathToSnapshotsMap get snapshotPath String snapshotNameToBeDeleted snapshotNameList get generator nextInt snapshotNameList size hdfs deleteSnapshot snapshotPath snapshotNameToBeDeleted
renameSnapshot pathToSnapshotsMap index generator nextInt pathToSnapshotsMap size Object snapshotPaths pathToSnapshotsMap keySet toArray Path snapshotPath Path snapshotPaths index ArrayList String snapshotNameList pathToSnapshotsMap get snapshotPath String snapshotOldName snapshotNameList get generator nextInt snapshotNameList size String snapshotOldNameNoExt snapshotOldName substring snapshotOldName lastIndexOf String snapshotNewName snapshotOldNameNoExt hdfs renameSnapshot snapshotPath snapshotOldName snapshotNewName
snapshottableDirectories size index generator nextInt snapshottableDirectories size Path randomDir snapshottableDirectories get index FileStatus fileStatusList hdfs listStatus randomDir FileStatus fsEntry fileStatusList fsEntry Path oldFile fsEntry getPath Path newFile oldFile suffix oldFile Path getNewPathString oldFile toString TESTDIRSTRING WITNESSDIRSTRING newFile Path getNewPathString newFile toString TESTDIRSTRING WITNESSDIRSTRING hdfs rename oldFile newFile Options Rename OVERWRITE assertTrue hdfs exists newFile assertFalse hdfs exists oldFile
String rootDir fileLength rootDir rootDir i i i String filename rootDir dirs generator nextInt MAX_NUM_SUB_DIRECTORIES_LEVEL j i j i dirs j filename j filename i createFile filename fileLength assertTrue hdfs exists Path filename LOG info filename String witnessFile filename replaceAll TESTDIRSTRING WITNESSDIRSTRING createFile witnessFile fileLength assertTrue hdfs exists Path witnessFile
String String originalString String targetString String replacementString String str originalString replaceAll targetString replacementString
String String originalString String targetString String replacementString String str originalString replaceAll targetString replacementString LOG info originalString
hdfs mkdirs sub1 hdfs allowSnapshot sub1 DFSTestUtil createFile hdfs file1 BLOCKSIZE REPL SEED hdfs createSnapshot sub1 snap1 hdfs rename file1 file2 hdfs createSnapshot sub1 snap2 hdfs rename file2 file3 SnapshotDiffReport diffReport diffReport hdfs getSnapshotDiffReport sub1 snap1 snap2
hdfs mkdirs sub1 hdfs allowSnapshot sub1 DFSTestUtil createFile hdfs file1 BLOCKSIZE REPL SEED hdfs createSnapshot sub1 snap1 hdfs rename file1 file2 hdfs createSnapshot sub1 snap2 hdfs rename file2 file3 SnapshotDiffReport diffReport diffReport hdfs getSnapshotDiffReport sub1 snap1 snap2 LOG info diffReport toString List DiffReportEntry entries diffReport getDiffList assertTrue entries size assertTrue existsInDiffReport entries DiffType MODIFY assertTrue existsInDiffReport entries DiffType RENAME file1 getName file2 getName diffReport hdfs getSnapshotDiffReport sub1 snap2
hdfs rename file2 file3 SnapshotDiffReport diffReport diffReport hdfs getSnapshotDiffReport sub1 snap1 snap2 LOG info diffReport toString List DiffReportEntry entries diffReport getDiffList assertTrue entries size assertTrue existsInDiffReport entries DiffType MODIFY assertTrue existsInDiffReport entries DiffType RENAME file1 getName file2 getName diffReport hdfs getSnapshotDiffReport sub1 snap2 LOG info diffReport toString entries diffReport getDiffList assertTrue entries size assertTrue existsInDiffReport entries DiffType MODIFY assertTrue existsInDiffReport entries DiffType RENAME file2 getName file3 getName diffReport hdfs getSnapshotDiffReport sub1 snap1
hdfs mkdirs st hdfs allowSnapshot st Path files Path i i i files i Path st i Path dest Path st hdfs createNewFile dest hdfs createSnapshot st i i i j j j FileSystem fs cluster getFileSystem DFSTestUtil createFile fs files j RandomUtils nextLong hdfs concat dest files hdfs createSnapshot st i SnapshotDiffReport sdr hdfs getSnapshotDiffReport st i
Path subsub1 Path sub1 Path subsubsub1 Path subsub1 hdfs mkdirs subsubsub1 modifyAndCreateSnapshot sub1 Path sub1 subsubsub1 modifyAndCreateSnapshot subsubsub1 Path sub1 subsubsub1 String invalidName hdfs getSnapshotDiffReport sub1 invalidName invalidName fail e GenericTestUtils assertExceptionContains sub1 invalidName e SnapshotDiffReport report hdfs getSnapshotDiffReport sub1 LOG info report toString assertEquals report getDiffList size report hdfs getSnapshotDiffReport sub1
fail e GenericTestUtils assertExceptionContains sub1 invalidName e SnapshotDiffReport report hdfs getSnapshotDiffReport sub1 LOG info report toString assertEquals report getDiffList size report hdfs getSnapshotDiffReport sub1 LOG info report toString assertEquals report getDiffList size report hdfs getSnapshotDiffReport subsubsub1 fail e GenericTestUtils assertExceptionContains e report hdfs getSnapshotDiffReport subsubsub1
GenericTestUtils assertExceptionContains sub1 invalidName e SnapshotDiffReport report hdfs getSnapshotDiffReport sub1 LOG info report toString assertEquals report getDiffList size report hdfs getSnapshotDiffReport sub1 LOG info report toString assertEquals report getDiffList size report hdfs getSnapshotDiffReport subsubsub1 fail e GenericTestUtils assertExceptionContains e report hdfs getSnapshotDiffReport subsubsub1 LOG info report toString assertEquals report getDiffList size
Path snapshotRootDirPath dir Path snapshotDirDescendantPath Path snapshotRootDirPath Path snapshotDirNonDescendantPath Path hdfs mkdirs snapshotDirDescendantPath hdfs mkdirs snapshotDirNonDescendantPath hdfs allowSnapshot snapshotRootDirPath hdfs createSnapshot snapshotRootDirPath hdfs createSnapshot snapshotRootDirPath INodeDirectory snapshotRootDir cluster getNameNode getNamesystem getFSDirectory getINode snapshotRootDirPath toUri getPath asDirectory INodeDirectory snapshotRootDescendantDir cluster getNameNode getNamesystem getFSDirectory getINode snapshotDirDescendantPath toUri getPath asDirectory INodeDirectory snapshotRootNonDescendantDir cluster getNameNode getNamesystem getFSDirectory getINode snapshotDirNonDescendantPath toUri getPath asDirectory SnapshotDiffInfo sdi SnapshotDiffInfo snapshotRootDir snapshotRootDescendantDir Snapshot snapshotRootDescendantDir Snapshot snapshotRootDescendantDir
hdfs mkdirs snapshotDirDescendantPath hdfs mkdirs snapshotDirNonDescendantPath hdfs allowSnapshot snapshotRootDirPath hdfs createSnapshot snapshotRootDirPath hdfs createSnapshot snapshotRootDirPath INodeDirectory snapshotRootDir cluster getNameNode getNamesystem getFSDirectory getINode snapshotRootDirPath toUri getPath asDirectory INodeDirectory snapshotRootDescendantDir cluster getNameNode getNamesystem getFSDirectory getINode snapshotDirDescendantPath toUri getPath asDirectory INodeDirectory snapshotRootNonDescendantDir cluster getNameNode getNamesystem getFSDirectory getINode snapshotDirNonDescendantPath toUri getPath asDirectory SnapshotDiffInfo sdi SnapshotDiffInfo snapshotRootDir snapshotRootDescendantDir Snapshot snapshotRootDescendantDir Snapshot snapshotRootDescendantDir LOG info sdi getFrom sdi getTo iae fail iae SnapshotDiffInfo sdi SnapshotDiffInfo snapshotRootDir snapshotRootNonDescendantDir Snapshot snapshotRootNonDescendantDir Snapshot snapshotRootNonDescendantDir
Path path Path ssRoot ssName Path ssPath getSSpath path ssRoot ssName
dirPath from to SnapshotDiffReport SnapshotDiffReport inverseReport hdfs getSnapshotDiffReport dirPath to from
dirPath from to SnapshotDiffReport report SnapshotDiffReport inverseReport hdfs getSnapshotDiffReport dirPath to from LOG info report toString
cluster fileName fileLen actualStorageCount LocatedBlocks locatedBlocks cluster getFileSystem getClient getLocatedBlocks fileName fileLen locatedBlocks getLocatedBlocks
actualStorageCount LocatedBlocks locatedBlocks cluster getFileSystem getClient getLocatedBlocks fileName fileLen lb locatedBlocks getLocatedBlocks LOG info lb getLocations length lb lb getLocations length storageType lb expectedStorageType storageType actualStorageCount LOG info expectedStorageType storageType LOG info expectedStorageType expectedStorageCount actualStorageCount
Configuration conf WebHdfsTestUtil createConf String racks RACK0 RACK0 RACK1 RACK1 RACK2 RACK2 nDataNodes racks length
Configuration conf WebHdfsTestUtil createConf String racks RACK0 RACK0 RACK1 RACK1 RACK2 RACK2 nDataNodes racks length LOG info nDataNodes Arrays asList racks MiniDFSCluster cluster MiniDFSCluster Builder conf numDataNodes nDataNodes racks racks build cluster waitActive DistributedFileSystem dfs cluster getFileSystem NameNode namenode cluster getNameNode DatanodeManager dm namenode getNamesystem getBlockManager getDatanodeManager
Configuration conf WebHdfsTestUtil createConf String racks RACK0 RACK0 RACK1 RACK1 RACK2 RACK2 String hosts nDataNodes hosts length
Configuration conf WebHdfsTestUtil createConf String racks RACK0 RACK0 RACK1 RACK1 RACK2 RACK2 String hosts nDataNodes hosts length LOG info nDataNodes Arrays asList racks Arrays asList hosts MiniDFSCluster cluster MiniDFSCluster Builder conf hosts hosts numDataNodes nDataNodes racks racks build cluster waitActive DistributedFileSystem dfs cluster getFileSystem NameNode namenode cluster getNameNode DatanodeManager dm namenode getNamesystem getBlockManager getDatanodeManager
String file1 InetSocketAddress favoredNodes InetSocketAddress favoredNodesCount i i favoredNodesCount i favoredNodes i dns get i getXferAddress DFSTestUtil createFile dfs Path file1 DEFAULT_BLOCK_SIZE favoredNodes LocatedBlocks locatedBlocks dfs getClient getLocatedBlocks file1 Assert assertEquals locatedBlocks locatedBlockCount LocatedBlock lb locatedBlocks get StorageType storageTypes lb getStorageTypes StorageType storageType storageTypes Assert assertTrue StorageType DISK storageType DatanodeInfo locations lb getLocations Assert assertEquals locations length Assert assertTrue favoredNodesCount locations length DatanodeInfo locations
actualCount externalSps getAttemptedItemsMonitor getAttemptedItemsCount
resetStream assertEquals ToolRunner run dfsAdmin String verifyNodesAndCorruptBlocks numDn numDn client replFactor fileLength DistributedFileSystem fs miniCluster getFileSystem Path file Path baseDir fs enableErasureCodingPolicy ecPolicy getName DFSTestUtil createFile fs file fileLength replFactor DFSTestUtil waitReplication fs file replFactor ExtendedBlock block DFSTestUtil getFirstBlock fs file LocatedBlocks lbs miniCluster getFileSystem getClient getNamenode getBlockLocations file toString fileLength assertTrue lbs get lbs get LocatedBlock LocatedBlock locatedBlock lbs get DatanodeInfo locatedDataNode locatedBlock getLocations
cellSize ecPolicy getCellSize blockSize stripesPerBlock cellSize blockGroupSize ecPolicy getNumDataUnits blockSize totalBlockGroups DFSTestUtil createStripedFile miniCluster ecFile ecDir totalBlockGroups stripesPerBlock ecPolicy resetStream assertEquals ToolRunner run dfsAdmin String verifyNodesAndCorruptBlocks numDn numDn client List DataNode datanodes miniCluster getDataNodes DataNode dataNodeToShutdown DataNode dn datanodes dn dataNodeToShutdown dn assertTrue dataNodeToShutdown
String outStr scanIntoString out
String args errOutBytes reset outBytes reset LOG info Joiner on join args ret tool run args errOutput String errOutBytes toByteArray Charsets UTF_8 output String outBytes toByteArray Charsets UTF_8
String args errOutBytes reset LOG info Joiner on join args ret tool run args errOutput String errOutBytes toByteArray Charsets UTF_8
cluster waitActive DistributedFileSystem fs cluster getFileSystem LocalFileSystem localFileSystem FileSystem getLocal conf Path p Path f getRoot getAbsolutePath tokenFile p localFileSystem makeQualified p DelegationTokenFetcher saveDelegationToken conf fs p Credentials creds Credentials readTokenStorageFile p conf Iterator Token itr creds getAllTokens iterator assertTrue itr hasNext Token token itr next assertNotNull token String expectedNonVerbose System getProperty String resNonVerbose DelegationTokenFetcher printTokensToString conf p assertTrue expectedNonVerbose resNonVerbose startsWith expectedNonVerbose
cluster waitActive DistributedFileSystem fs cluster getFileSystem LocalFileSystem localFileSystem FileSystem getLocal conf Path p Path f getRoot getAbsolutePath tokenFile p localFileSystem makeQualified p DelegationTokenFetcher saveDelegationToken conf fs p Credentials creds Credentials readTokenStorageFile p conf Iterator Token itr creds getAllTokens iterator assertTrue itr hasNext Token token itr next assertNotNull token String expectedNonVerbose System getProperty String resNonVerbose DelegationTokenFetcher printTokensToString conf p assertTrue expectedNonVerbose resNonVerbose startsWith expectedNonVerbose LOG info resNonVerbose
String edits nnHelper generateEdits
String edits nnHelper generateEdits LOG info edits String editsParsedXml folder newFile getAbsolutePath String editsReparsed folder newFile getAbsolutePath String editsParsedXML_caseInSensitive folder newFile getAbsolutePath assertEquals runOev edits editsParsedXml assertEquals runOev edits editsParsedXML_caseInSensitive assertEquals runOev editsParsedXml editsReparsed assertEquals runOev editsParsedXML_caseInSensitive editsReparsed assertTrue edits hasAllOpCodes edits
String inFilename String outFilename inFilename FileOutputStream fout FileOutputStream outFilename StatisticsEditsVisitor visitor StatisticsEditsVisitor fout OfflineEditsViewer oev OfflineEditsViewer oev go inFilename outFilename Flags visitor
hasAllOpCodes String inFilename String outFilename inFilename FileOutputStream fout FileOutputStream outFilename StatisticsEditsVisitor visitor StatisticsEditsVisitor fout OfflineEditsViewer oev OfflineEditsViewer oev go inFilename outFilename Flags visitor LOG info inFilename visitor getStatisticsString hasAllOpCodes opCode skippedOps contains opCode Long count visitor getStatistics get opCode count count hasAllOpCodes
String edits nnHelper generateEdits
hdfs create emptyECFile close writtenFiles put emptyECFile toString pathToFileEntry hdfs emptyECFile toString filesECCount Path smallECFile Path ecDir FSDataOutputStream out hdfs create smallECFile Random r Random bytes r nextBytes bytes out write bytes writtenFiles put smallECFile toString pathToFileEntry hdfs smallECFile toString filesECCount hdfs setSafeMode SafeModeAction SAFEMODE_ENTER hdfs saveNamespace hdfs setSafeMode SafeModeAction SAFEMODE_LEAVE originalFsimage FSImageTestUtil findLatestImageFile FSImageTestUtil getFSImage cluster getNameNode getStorage getStorageDir
GenericTestUtils setLogLevel OfflineImageReconstructor LOG Level TRACE File reverseImageXml File tempDir File reverseImage File tempDir File reverseImage2Xml File tempDir
o hdfs Path parentDir o write getBytes Path link1 Path Path link2 Path hdfs createSymlink Path link1 summaryFromDFS hdfs getContentSummary parentDir emptyDirSummaryFromDFS hdfs getContentSummary childDir2 fileSummaryFromDFS hdfs getContentSummary file1OnParentDir symLinkSummaryFromDFS hdfs getContentSummary link1 hdfs createSymlink childDir1 link2 symLinkSummaryForDirContainsFromDFS hdfs getContentSummary Path hdfs setSafeMode HdfsConstants SafeModeAction SAFEMODE_ENTER hdfs saveNamespace originalFsimage FSImageTestUtil findLatestImageFile FSImageTestUtil getFSImage cluster getNameNode getStorage getStorageDir originalFsimage
hdfs mkdirs dir hdfs setStoragePolicy dir HdfsConstants ALLSSD_STORAGE_POLICY_NAME dir Path hdfs mkdirs dir file Path o hdfs file o write o close dir Path hdfs mkdirs dir hdfs setStoragePolicy dir HdfsConstants HOT_STORAGE_POLICY_NAME hdfs setSafeMode HdfsConstants SafeModeAction SAFEMODE_ENTER hdfs saveNamespace originalFsimage FSImageTestUtil findLatestImageFile FSImageTestUtil getFSImage cluster getNameNode getStorage getStorageDir originalFsimage
offset length remaining length offset checked
offset length remaining length offset checked
url String TYPE HttpURLConnection conn HttpURLConnection url openConnection conn setRequestMethod TYPE conn setInstanceFollowRedirects String response IOUtils toString conn getInputStream
Configuration conf WebHdfsTestUtil createConf cluster MiniDFSCluster Builder conf numDataNodes build LOG info InetSocketAddress addr cluster getNameNode getHttpAddress URL url URL addr getHostString addr getPort WebHdfsFileSystem PATH_PREFIX Param toSortedString NoRedirectParam
Configuration conf WebHdfsTestUtil createConf cluster MiniDFSCluster Builder conf numDataNodes build LOG info InetSocketAddress addr cluster getNameNode getHttpAddress URL url URL addr getHostString addr getPort WebHdfsFileSystem PATH_PREFIX Param toSortedString NoRedirectParam LOG info url checkResponseContainsLocation url WebHdfsFileSystem fs WebHdfsTestUtil getWebHdfsFileSystem conf WebHdfsConstants WEBHDFS_SCHEME String PATH CONTENTS RANDOM nextBytes CONTENTS os fs PATH os write CONTENTS url URL addr getHostString addr getPort WebHdfsFileSystem PATH_PREFIX Param toSortedString NoRedirectParam
LOG info InetSocketAddress addr cluster getNameNode getHttpAddress URL url URL addr getHostString addr getPort WebHdfsFileSystem PATH_PREFIX Param toSortedString NoRedirectParam LOG info url checkResponseContainsLocation url WebHdfsFileSystem fs WebHdfsTestUtil getWebHdfsFileSystem conf WebHdfsConstants WEBHDFS_SCHEME String PATH CONTENTS RANDOM nextBytes CONTENTS os fs PATH os write CONTENTS url URL addr getHostString addr getPort WebHdfsFileSystem PATH_PREFIX Param toSortedString NoRedirectParam LOG info url checkResponseContainsLocation url url URL addr getHostString addr getPort WebHdfsFileSystem PATH_PREFIX Param toSortedString NoRedirectParam
LOG info url checkResponseContainsLocation url WebHdfsFileSystem fs WebHdfsTestUtil getWebHdfsFileSystem conf WebHdfsConstants WEBHDFS_SCHEME String PATH CONTENTS RANDOM nextBytes CONTENTS os fs PATH os write CONTENTS url URL addr getHostString addr getPort WebHdfsFileSystem PATH_PREFIX Param toSortedString NoRedirectParam LOG info url checkResponseContainsLocation url url URL addr getHostString addr getPort WebHdfsFileSystem PATH_PREFIX Param toSortedString NoRedirectParam LOG info url checkResponseContainsLocation url url URL addr getHostString addr getPort WebHdfsFileSystem PATH_PREFIX Param toSortedString NoRedirectParam
clientSocket serverSocket accept fs connectionFactory connectionFactory consumeConnectionBacklog consumeConnectionBacklog in clientSocket getInputStream isr InputStreamReader in br BufferedReader isr String line br readLine line line out clientSocket getOutputStream out write temporaryRedirect getBytes
String String prefix String String strings String webhdfs length i i webhdfs length i strings i createString prefix i
PermissionParam p PermissionParam PermissionParam DEFAULT Assert assertEquals FsPermission p getDirFsPermission Assert assertEquals FsPermission p getFileFsPermission PermissionParam PermissionParam Assert fail e LOG info e PermissionParam PermissionParam Assert fail e
PermissionParam Assert fail e LOG info e PermissionParam PermissionParam Assert fail e LOG info e PermissionParam Assert fail e
LOG info e PermissionParam PermissionParam Assert fail e LOG info e PermissionParam Assert fail e LOG info e PermissionParam Assert fail
AclPermissionParam p AclPermissionParam List AclEntry setAclList AclEntry parseAclSpec Assert assertEquals setAclList toString p getAclPermission toString AclPermissionParam AclPermissionParam Assert fail e LOG info e AclPermissionParam AclPermissionParam Assert fail e
AclPermissionParam Assert fail e LOG info e AclPermissionParam AclPermissionParam Assert fail e LOG info e AclPermissionParam Assert fail e
LOG info e AclPermissionParam AclPermissionParam Assert fail e LOG info e AclPermissionParam Assert fail e LOG info e AclPermissionParam Assert fail
FsActionParam FsActionParam FsActionParam FsActionParam FsActionParam FsActionParam FsActionParam Assert fail e LOG info e FsActionParam Assert fail e
FsActionParam FsActionParam Assert fail e LOG info e FsActionParam Assert fail e LOG info e FsActionParam Assert fail e
e LOG info e FsActionParam Assert fail e LOG info e FsActionParam Assert fail e LOG info e FsActionParam Assert fail
Assert fail e LOG info e FsActionParam Assert fail e LOG info e FsActionParam Assert fail e LOG info e FsActionParam
FsActionParam Assert fail e LOG info e FsActionParam Assert fail e LOG info e FsActionParam Assert fail e LOG info e
String hosts cluster MiniDFSCluster Builder conf numDataNodes racks racks hosts hosts build cluster waitActive NamenodeProtocols nn cluster getNameNodeRpc Assert assertNotNull nn DatanodeInfo info info nn getDatanodeReport DatanodeReportType LIVE Assert assertFalse info length info length Thread sleep validIdx info getHostName equals hosts invalidIdx validIdx StaticMapping addNodeToRack hosts invalidIdx racks validIdx
Node excludedNodes Node LOG info excludedNodes i i i Node n dataNodes i
fs path FileStatus s fs getFileStatus Path path
out write out close checkPermission fs inheritPerm checkPermission fs inheritPerm checkPermission fs filePerm conf set FsPermission UMASK_LABEL permission FsPermission createImmutable FileSystem mkdirs fs Path FsPermission permission FileSystem create fs Path FsPermission permission checkPermission fs permission checkPermission fs permission fs fs close
checkPermission fs filePerm conf set FsPermission UMASK_LABEL permission FsPermission createImmutable FileSystem mkdirs fs Path FsPermission permission FileSystem create fs Path FsPermission permission checkPermission fs permission checkPermission fs permission fs fs close e LOG error StringUtils stringifyException e cluster cluster shutdown e
DFSAdmin admin DFSAdmin config String args String Groups groups Groups getUserToGroupsMappingService config String user UserGroupInformation getCurrentUser getUserName LOG debug List String g1 groups getGroups user
DFSAdmin admin DFSAdmin config String args String Groups groups Groups getUserToGroupsMappingService config String user UserGroupInformation getCurrentUser getUserName LOG debug List String g1 groups getGroups user LOG debug g1 toString LOG debug List String g2 groups getGroups user
DFSAdmin admin DFSAdmin config String args String Groups groups Groups getUserToGroupsMappingService config String user UserGroupInformation getCurrentUser getUserName LOG debug List String g1 groups getGroups user LOG debug g1 toString LOG debug List String g2 groups getGroups user LOG debug g2 toString i i g2 i assertEquals g1 get i g2 get i admin run args LOG debug List String g3 groups getGroups user
dfs MiniDFSCluster Builder conf nameNodePort nameNodePort nameNodeHttpPort nameNodeHttpPort numDataNodes numDataNodes startupOption dfsOpts format format build dfs waitActive
args Options options makeOptions CommandLine cli CommandLineParser parser GnuParser cli parser parse options args e LOG warn e HelpFormatter printHelp options cli HelpFormatter printHelp options cli cli
taskRunner HadoopExecutors newSingleThreadExecutor ThreadFactoryBuilder setDaemon setNameFormat build eventHandler Thread EventHandler
conf mapId subMapOutputFile FileSystem localFs FileSystem getLocal conf Path mapOut subMapOutputFile getOutputFile FileStatus mStatus localFs getFileStatus mapOut Path reduceIn subMapOutputFile getInputFileForWrite TypeConverter fromYarn mapId getTaskID mStatus getLen Path mapOutIndex subMapOutputFile getOutputIndexFile Path reduceInIndex Path reduceIn toString
diagnosticInfo diagnosticInfo StringInterner weakIntern diagnosticInfo
AMFeedback taskAttemptID org apache hadoop mapreduce v2 api records TaskAttemptId yarnAttemptID TypeConverter toYarn taskAttemptID AMFeedback feedback AMFeedback feedback setTaskFound AtomicReference TaskAttemptStatus lastStatusRef attemptIdToStatus get yarnAttemptID lastStatusRef yarnAttemptID
AMFeedback taskAttemptID org apache hadoop mapreduce v2 api records TaskAttemptId yarnAttemptID TypeConverter toYarn taskAttemptID AMFeedback feedback AMFeedback feedback setTaskFound AtomicReference TaskAttemptStatus lastStatusRef attemptIdToStatus get yarnAttemptID lastStatusRef yarnAttemptID LOG error yarnAttemptID feedback setTaskFound feedback yarnAttemptID feedback setPreemption LOG info yarnAttemptID yarnAttemptID getTaskId getTaskType LOG
context JVMId jvmId context jvmId
JvmTask context JVMId jvmId context jvmId LOG info jvmId JvmTask jvmTask WrappedJvmID wJvmID WrappedJvmID jvmId getJobId jvmId isMap jvmId getId wJvmID
JvmTask context JVMId jvmId context jvmId LOG info jvmId JvmTask jvmTask WrappedJvmID wJvmID WrappedJvmID jvmId getJobId jvmId isMap jvmId getId jvmIDToActiveAttemptMap wJvmID LOG info jvmId jvmTask TASK_FOR_INVALID_JVM launchedJVMs wJvmID jvmTask LOG info jvmId org apache hadoop mapred Task task jvmIDToActiveAttemptMap remove wJvmID launchedJVMs remove wJvmID
TaskAttemptId TaskAttemptStatus taskAttemptStatus TaskAttemptStatus lastStatusRef List TaskAttemptId fetchFailedMaps taskAttemptStatus fetchFailedMaps TaskAttemptStatus lastStatus done done lastStatus lastStatusRef get lastStatus lastStatus fetchFailedMaps taskAttemptStatus fetchFailedMaps taskAttemptStatus fetchFailedMaps lastStatus fetchFailedMaps taskAttemptStatus fetchFailedMaps ArrayList lastStatus fetchFailedMaps size fetchFailedMaps size taskAttemptStatus fetchFailedMaps addAll lastStatus fetchFailedMaps taskAttemptStatus fetchFailedMaps addAll fetchFailedMaps done lastStatusRef compareAndSet lastStatus taskAttemptStatus done
Thread setDefaultUncaughtExceptionHandler YarnUncaughtExceptionHandler LOG debug JobConf job JobConf MRJobConfig JOB_CONF_FILE Limits init job UserGroupInformation setConfiguration job SecurityUtil setConfiguration job String host args port Integer parseInt args InetSocketAddress address NetUtils createSocketAddrForHost host port TaskAttemptID firstTaskid TaskAttemptID forName args jvmIdLong Long parseLong args JVMId jvmId JVMId firstTaskid getJobID firstTaskid getTaskType TaskType MAP jvmIdLong CallerContext setCurrent CallerContext Builder firstTaskid toString build DefaultMetricsSystem initialize StringUtils camelize firstTaskid getTaskType name Credentials credentials UserGroupInformation getCurrentUser getCredentials
taskOwner addToken jt TaskUmbilicalProtocol taskOwner TaskUmbilicalProtocol TaskUmbilicalProtocol TaskUmbilicalProtocol RPC getProxy TaskUmbilicalProtocol TaskUmbilicalProtocol versionID address job JvmContext context JvmContext jvmId LOG debug System getenv get Task task UserGroupInformation childUGI ScheduledExecutorService logSyncer idleLoopCount JvmTask myTask idle myTask idle sleepTimeMilliSecs Math min idle
e LOG error e umbilical fsError taskid e getMessage exception LOG warn StringUtils stringifyException exception task task taskCleanup umbilical Task taskFinal task
job String localSysDirs StringUtils getTrimmedStrings System getenv Environment LOCAL_DIRS name job setStrings MRConfig LOCAL_DIR localSysDirs
job credentials job setCredentials credentials ApplicationAttemptId appAttemptId ContainerId fromString System getenv Environment CONTAINER_ID name getApplicationAttemptId
FSDataInputStream conf applicationAttemptId FSDataInputStream in Path historyFile String jobId TypeConverter fromYarn applicationAttemptId getApplicationId toString String jobhistoryDir JobHistoryUtils getConfiguredHistoryStagingDirPrefix conf jobId Path histDirPath FileContext getFileContext conf makeQualified Path jobhistoryDir FileContext fc FileContext getFileContext histDirPath toUri conf historyFile fc makeQualified JobHistoryUtils getStagingJobHistoryFile histDirPath jobId applicationAttemptId getAttemptId
String stagingDirStr String doneDirStr String userDoneDirStr stagingDirStr JobHistoryUtils getConfiguredHistoryStagingDirPrefix conf jobId doneDirStr JobHistoryUtils getConfiguredHistoryIntermediateDoneDirPrefix conf userDoneDirStr JobHistoryUtils getHistoryIntermediateDoneDirForUser conf e LOG error e YarnRuntimeException e stagingDirPath FileContext getFileContext conf makeQualified Path stagingDirStr stagingDirFS FileSystem get stagingDirPath toUri conf mkdir stagingDirFS stagingDirPath FsPermission JobHistoryUtils HISTORY_STAGING_DIR_PERMISSIONS e
e LOG error e YarnRuntimeException e stagingDirPath FileContext getFileContext conf makeQualified Path stagingDirStr stagingDirFS FileSystem get stagingDirPath toUri conf mkdir stagingDirFS stagingDirPath FsPermission JobHistoryUtils HISTORY_STAGING_DIR_PERMISSIONS e LOG error stagingDirPath e YarnRuntimeException e Path doneDirPath doneDirPath FileContext getFileContext conf makeQualified Path doneDirStr doneDirFS FileSystem get doneDirPath toUri conf doneDirFS doneDirPath
mkdir stagingDirFS stagingDirPath FsPermission JobHistoryUtils HISTORY_STAGING_DIR_PERMISSIONS e LOG error stagingDirPath e YarnRuntimeException e Path doneDirPath doneDirPath FileContext getFileContext conf makeQualified Path doneDirStr doneDirFS FileSystem get doneDirPath toUri conf doneDirFS doneDirPath JobHistoryUtils conf LOG info doneDirPath MRJobConfig MR_AM_CREATE_JH_INTERMEDIATE_BASE_DIR mkdir doneDirFS doneDirPath FsPermission JobHistoryUtils HISTORY_INTERMEDIATE_DONE_DIR_PERMISSIONS toShort String message doneDirPath MRJobConfig MR_AM_CREATE_JH_INTERMEDIATE_BASE_DIR LOG error message
Path doneDirPath doneDirPath FileContext getFileContext conf makeQualified Path doneDirStr doneDirFS FileSystem get doneDirPath toUri conf doneDirFS doneDirPath JobHistoryUtils conf LOG info doneDirPath MRJobConfig MR_AM_CREATE_JH_INTERMEDIATE_BASE_DIR mkdir doneDirFS doneDirPath FsPermission JobHistoryUtils HISTORY_INTERMEDIATE_DONE_DIR_PERMISSIONS toShort String message doneDirPath MRJobConfig MR_AM_CREATE_JH_INTERMEDIATE_BASE_DIR LOG error message YarnRuntimeException message e LOG error doneDirPath YarnRuntimeException e
LOG error doneDirPath YarnRuntimeException e doneDirPrefixPath FileContext getFileContext conf makeQualified Path userDoneDirStr mkdir doneDirFS doneDirPrefixPath JobHistoryUtils getConfiguredHistoryIntermediateUserDoneDirPermissions conf e LOG error doneDirPrefixPath e YarnRuntimeException e maxUnflushedCompletionEvents conf getInt MRJobConfig MR_AM_HISTORY_MAX_UNFLUSHED_COMPLETE_EVENTS MRJobConfig DEFAULT_MR_AM_HISTORY_MAX_UNFLUSHED_COMPLETE_EVENTS postJobCompletionMultiplier conf getInt MRJobConfig MR_AM_HISTORY_JOB_COMPLETE_UNFLUSHED_MULTIPLIER MRJobConfig DEFAULT_MR_AM_HISTORY_JOB_COMPLETE_UNFLUSHED_MULTIPLIER flushTimeout conf getLong MRJobConfig MR_AM_HISTORY_COMPLETE_EVENT_FLUSH_TIMEOUT_MS MRJobConfig DEFAULT_MR_AM_HISTORY_COMPLETE_EVENT_FLUSH_TIMEOUT_MS minQueueSizeForBatchingFlushes conf getInt MRJobConfig MR_AM_HISTORY_USE_BATCHED_FLUSH_QUEUE_SIZE_THRESHOLD MRJobConfig DEFAULT_MR_AM_HISTORY_USE_BATCHED_FLUSH_QUEUE_SIZE_THRESHOLD conf MRJobConfig MRJobConfig LOG info conf
fs path fsp fs path fs mkdirs path fsp FileStatus fsStatus fs getFileStatus path LOG info fsStatus getPermission toShort fsp toShort fsStatus getPermission toShort fsp toShort
eventHandlingThread LOG debug eventHandlingThread interrupt LOG debug eventHandlingThread LOG debug eventHandlingThread join ie LOG info ie LOG
eventHandlingThread interrupt LOG debug eventHandlingThread LOG debug eventHandlingThread join ie LOG info ie mi LOG LOG debug mi mi shutDownTimer
e LOG info e getMessage Iterator JobHistoryEvent it eventQueue iterator it JobHistoryEvent ev it next LOG info ev getType handleEvent ev JobId MetaInfo jobIt JobId toClose jobIt getKey MetaInfo mi jobIt getValue mi mi LOG warn toClose Job job context getJob toClose successfulMaps job getCompletedMaps job getFailedMaps job getKilledMaps
stagingDirPath LOG error IOException MetaInfo oldFi fileMap get jobId Configuration conf getConfig Path historyFile JobHistoryUtils getStagingJobHistoryFile stagingDirPath jobId startCount String user UserGroupInformation getCurrentUser getShortUserName user IOException String jobName context getJob jobId getName EventWriter writer oldFi oldFi writer Path logDirConfPath JobHistoryUtils getStagingConfFile stagingDirPath jobId startCount writer writer createEventWriter historyFile
IOException MetaInfo oldFi fileMap get jobId Configuration conf getConfig Path historyFile JobHistoryUtils getStagingJobHistoryFile stagingDirPath jobId startCount String user UserGroupInformation getCurrentUser getShortUserName user IOException String jobName context getJob jobId getName EventWriter writer oldFi oldFi writer Path logDirConfPath JobHistoryUtils getStagingConfFile stagingDirPath jobId startCount writer writer createEventWriter historyFile LOG info jobId historyFile IOException
AMStartedEvent amStartedEvent AMStartedEvent event getHistoryEvent setupEventWriter event getJobID amStartedEvent ioe LOG error event ioe YarnRuntimeException ioe MetaInfo mi fileMap get event getJobID HistoryEvent historyEvent event getHistoryEvent historyEvent mi writeEvent historyEvent processEventForJobSummary event getHistoryEvent mi getJobSummary event getJobID LOG LOG debug event getHistoryEvent getEventType
tEvent addEventInfo ase getStartTime tEvent addEventInfo ase getSubmitTime tEntity addEvent tEvent tEntity setEntityId jobId toString tEntity setEntityType MAPREDUCE_JOB_ENTITY_TYPE TimelinePutResponse response timelineClient putEntities tEntity List TimelinePutResponse TimelinePutError errors response getErrors errors LOG LOG debug event getEventType TimelinePutResponse TimelinePutError errors
tEntity addEvent tEvent tEntity setEntityId jobId toString tEntity setEntityType MAPREDUCE_JOB_ENTITY_TYPE TimelinePutResponse response timelineClient putEntities tEntity List TimelinePutResponse TimelinePutError errors response getErrors errors LOG LOG debug event getEventType TimelinePutResponse TimelinePutError error errors LOG error error getEntityType error getEntityId error getErrorCode
size entry getKey length entry getValue length configSize size configSize jobEntityForConfigs size timelineV2Client putEntities jobEntityForConfigs timelineV2Client putEntities appEntityForConfigs jobEntityForConfigs createJobEntity jobId appEntityForConfigs ApplicationEntity appEntityForConfigs setId appId configSize size jobEntityForConfigs addConfig entry getKey entry getValue appEntityForConfigs addConfig entry getKey entry getValue configSize timelineV2Client putEntities jobEntityForConfigs timelineV2Client putEntities appEntityForConfigs
org apache hadoop yarn api records timelineservice TimelineEntity appEntityWithJobMetrics taskId tEntity createJobEntity event timestamp jobId MAPREDUCE_JOB_ENTITY_TYPE setCreatedTime event event appEntityWithJobMetrics createAppEntityWithJobMetrics event jobId taskAttemptId tEntity createTaskEntity event timestamp taskId MAPREDUCE_TASK_ENTITY_TYPE MAPREDUCE_JOB_ENTITY_TYPE jobId setCreatedTime taskIdPrefix tEntity createTaskAttemptEntity event timestamp taskAttemptId MAPREDUCE_TASK_ATTEMPT_ENTITY_TYPE MAPREDUCE_TASK_ENTITY_TYPE taskId setCreatedTime taskAttemptIdPrefix appEntityWithJobMetrics timelineV2Client putEntitiesAsync tEntity timelineV2Client putEntities tEntity appEntityWithJobMetrics
IOException jobId mi LOG warn jobId mi LOG warn jobId Path qualifiedSummaryDoneFile FSDataOutputStream summaryFileOut String doneSummaryFileName getTempFileName JobHistoryUtils getIntermediateSummaryFileName jobId qualifiedSummaryDoneFile doneDirFS makeQualified Path doneDirPrefixPath doneSummaryFileName summaryFileOut doneDirFS create qualifiedSummaryDoneFile summaryFileOut writeUTF mi getJobSummary getJobSummaryString summaryFileOut close doneDirFS setPermission qualifiedSummaryDoneFile FsPermission JobHistoryUtils HISTORY_INTERMEDIATE_FILE_PERMISSIONS IOException
Path historyFile mi getHistoryFile Path qualifiedLogFile stagingDirFS makeQualified historyFile jobNameLimit getConfig getInt JHAdminConfig MR_HS_JOBNAME_LIMIT JHAdminConfig DEFAULT_MR_HS_JOBNAME_LIMIT String doneJobHistoryFileName getTempFileName FileNameIndexUtils getDoneFileName mi getJobIndexInfo jobNameLimit qualifiedDoneFile doneDirFS makeQualified Path doneDirPrefixPath doneJobHistoryFileName qualifiedLogFile qualifiedDoneFile String historyUrl MRWebAppUtil getApplicationWebURLOnJHSWithScheme getConfig context getApplicationID context setHistoryUrl historyUrl LOG info historyUrl Path qualifiedConfDoneFile mi getConfFile Path confFile mi getConfFile Path qualifiedConfFile stagingDirFS makeQualified confFile String doneConfFileName getTempFileName JobHistoryUtils getIntermediateConfFileName jobId qualifiedConfDoneFile doneDirFS makeQualified Path doneDirPrefixPath doneConfFileName
Path tmpPath tmpPath String tmpFileName tmpPath getName String fileName getFileNameFromTmpFN tmpFileName Path path Path tmpPath getParent fileName doneDirFS rename tmpPath path
success
fromPath toPath success stagingDirFS fromPath LOG info fromPath toString toPath toString doneDirFS delete toPath copied FileUtil copy stagingDirFS fromPath doneDirFS toPath getConfig doneDirFS setPermission toPath FsPermission JobHistoryUtils HISTORY_INTERMEDIATE_FILE_PERMISSIONS copied
forceJobCompletion forceJobCompletion forceJobCompletion
copyHistory committer createOutputCommitter conf String user UserGroupInformation getCurrentUser getShortUserName Path stagingDir MRApps getStagingAreaDir conf user FileSystem fs getFileSystem conf stagingExists fs exists stagingDir Path startCommitFile MRApps getStartJobCommitFile conf user jobId commitStarted fs exists startCommitFile Path endCommitSuccessFile MRApps getEndJobCommitSuccessFile conf user jobId commitSuccess fs exists endCommitSuccessFile Path endCommitFailureFile MRApps getEndJobCommitFailureFile conf user jobId commitFailure fs exists endCommitFailureFile stagingExists isLastAMRetry
Path startCommitFile MRApps getStartJobCommitFile conf user jobId commitStarted fs exists startCommitFile Path endCommitSuccessFile MRApps getEndJobCommitSuccessFile conf user jobId commitSuccess fs exists endCommitSuccessFile Path endCommitFailureFile MRApps getEndJobCommitFailureFile conf user jobId commitFailure fs exists endCommitFailureFile isLastAMRetry LOG info appAttemptID getAttemptId isLastAMRetry errorHappenedShutDown forcedState JobStateInternal ERROR shutDownMessage stagingDir LOG error shutDownMessage commitStarted errorHappenedShutDown
OutputCommitter OutputCommitter OutputCommitter OutputCommitter committer
conf Speculator Speculator Configuration conf Class Speculator speculatorClass speculatorClass conf getClass MRJobConfig MR_AM_JOB_SPECULATOR DefaultSpeculator Speculator Constructor Speculator speculatorConstructor speculatorClass getConstructor Configuration AppContext Speculator result speculatorConstructor newInstance conf context result ex LOG error MRJobConfig MR_AM_JOB_SPECULATOR ex YarnRuntimeException ex ex LOG error MRJobConfig MR_AM_JOB_SPECULATOR ex YarnRuntimeException ex ex
speculatorClass conf getClass MRJobConfig MR_AM_JOB_SPECULATOR DefaultSpeculator Speculator Constructor Speculator speculatorConstructor speculatorClass getConstructor Configuration AppContext Speculator result speculatorConstructor newInstance conf context result ex LOG error MRJobConfig MR_AM_JOB_SPECULATOR ex YarnRuntimeException ex ex LOG error MRJobConfig MR_AM_JOB_SPECULATOR ex YarnRuntimeException ex ex LOG error MRJobConfig MR_AM_JOB_SPECULATOR ex YarnRuntimeException ex ex
cleanUpPreviousJobOutput AMInfo amInfo MRBuilderUtils newAMInfo appAttemptID startTime containerID nmHost nmPort nmHttpPort job createJob getConfig forcedState shutDownMessage AMInfo info amInfos dispatcher getEventHandler handle JobHistoryEvent job getID AMStartedEvent info getAppAttemptId info getStartTime info getContainerId info getNodeManagerHost info getNodeManagerPort info getNodeManagerHttpPort appSubmitTime dispatcher getEventHandler handle JobHistoryEvent job getID AMStartedEvent amInfo getAppAttemptId amInfo getStartTime amInfo getContainerId amInfo getNodeManagerHost amInfo getNodeManagerPort amInfo getNodeManagerHttpPort forcedState forcedState toString appSubmitTime amInfos add amInfo DefaultMetricsSystem initialize initFailed JobEvent initJobEvent JobEvent job getID JobEventType JOB_INIT jobEventDispatcher handle initJobEvent initFailed JobImpl job getInternalState JobStateInternal INITED job speculatorEventDispatcher disableSpeculation
info amInfos dispatcher getEventHandler handle JobHistoryEvent job getID AMStartedEvent info getAppAttemptId info getStartTime info getContainerId info getNodeManagerHost info getNodeManagerPort info getNodeManagerHttpPort appSubmitTime dispatcher getEventHandler handle JobHistoryEvent job getID AMStartedEvent amInfo getAppAttemptId amInfo getStartTime amInfo getContainerId amInfo getNodeManagerHost amInfo getNodeManagerPort amInfo getNodeManagerHttpPort forcedState forcedState toString appSubmitTime amInfos add amInfo DefaultMetricsSystem initialize initFailed JobEvent initJobEvent JobEvent job getID JobEventType JOB_INIT jobEventDispatcher handle initJobEvent initFailed JobImpl job getInternalState JobStateInternal INITED job speculatorEventDispatcher disableSpeculation LOG info job getID nmHost nmPort dispatcher getEventHandler handle SpeculatorEvent job getID clock getTime
conf appAttemptId Path historyFile JobHistoryUtils getPreviousJobHistoryPath conf appAttemptId
FSDataInputStream in getPreviousJobHistoryStream getConfig appAttemptID JobHistoryParser parser JobHistoryParser in JobInfo jobInfo parser parse Exception parseException parser getParseException parseException
FSDataInputStream in getPreviousJobHistoryStream getConfig appAttemptID JobHistoryParser parser JobHistoryParser in JobInfo jobInfo parser parse Exception parseException parser getParseException parseException LOG info parseException Map org apache hadoop mapreduce TaskID TaskInfo taskInfos jobInfo getAllTasks TaskInfo taskInfo taskInfos taskInfo Iterator Entry TaskAttemptID TaskAttemptInfo taskAttemptIterator taskInfo getAllTaskAttempts entrySet iterator taskAttemptIterator Map Entry TaskAttemptID TaskAttemptInfo currentEntry taskAttemptIterator next jobInfo currentEntry taskAttemptIterator remove completedTasksFromPreviousRun put TypeConverter toYarn taskInfo getTaskId taskInfo
String String param String msg param
validateInputParam nodePortString Environment NM_PORT name validateInputParam nodeHttpPortString Environment NM_HTTP_PORT name validateInputParam appSubmitTimeStr ApplicationConstants APP_SUBMIT_TIME_ENV ContainerId containerId ContainerId fromString containerIdStr ApplicationAttemptId applicationAttemptId containerId getApplicationAttemptId applicationAttemptId CallerContext setCurrent CallerContext Builder applicationAttemptId toString build appSubmitTime Long parseLong appSubmitTimeStr MRAppMaster appMaster MRAppMaster applicationAttemptId containerId nodeHostString Integer parseInt nodePortString Integer parseInt nodeHttpPortString appSubmitTime ShutdownHookManager get addShutdownHook MRAppMasterShutdownHook appMaster SHUTDOWN_HOOK_PRIORITY JobConf conf JobConf YarnConfiguration conf addResource Path MRJobConfig JOB_CONF_FILE MRWebAppUtil initialize conf String systemPropsToLog MRApps getSystemPropertiesToLog conf systemPropsToLog
applicationAttemptId CallerContext setCurrent CallerContext Builder applicationAttemptId toString build appSubmitTime Long parseLong appSubmitTimeStr MRAppMaster appMaster MRAppMaster applicationAttemptId containerId nodeHostString Integer parseInt nodePortString Integer parseInt nodeHttpPortString appSubmitTime ShutdownHookManager get addShutdownHook MRAppMasterShutdownHook appMaster SHUTDOWN_HOOK_PRIORITY JobConf conf JobConf YarnConfiguration conf addResource Path MRJobConfig JOB_CONF_FILE MRWebAppUtil initialize conf String systemPropsToLog MRApps getSystemPropertiesToLog conf systemPropsToLog LOG info systemPropsToLog String jobUserName System getenv ApplicationConstants Environment USER name conf set MRJobConfig USER_NAME jobUserName initAndStartAppMaster appMaster conf jobUserName
conf UserGroupInformation setConfiguration conf SecurityUtil setConfiguration conf Credentials credentials UserGroupInformation getCurrentUser getCredentials
serviceInit conf serviceInit conf taskTimeOut conf getLong MRJobConfig TASK_TIMEOUT MRJobConfig DEFAULT_TASK_TIMEOUT_MILLIS unregisterTimeOut conf getLong MRJobConfig TASK_EXIT_TIMEOUT MRJobConfig TASK_EXIT_TIMEOUT_DEFAULT taskStuckTimeOut conf getLong MRJobConfig TASK_STUCK_TIMEOUT_MS MRJobConfig DEFAULT_TASK_STUCK_TIMEOUT_MS taskProgressReportIntervalMillis MRJobConfUtil getTaskProgressReportInterval conf minimumTaskTimeoutAllowed taskProgressReportIntervalMillis taskTimeOut minimumTaskTimeoutAllowed taskTimeOut minimumTaskTimeoutAllowed
Configuration conf getConfig YarnRPC rpc YarnRPC create conf InetSocketAddress address InetSocketAddress server rpc getServer MRClientProtocol protocolHandler address conf appContext getClientToAMTokenSecretManager conf getInt MRJobConfig MR_AM_JOB_CLIENT_THREAD_COUNT MRJobConfig DEFAULT_MR_AM_JOB_CLIENT_THREAD_COUNT MRJobConfig MR_AM_JOB_CLIENT_PORT_RANGE conf getBoolean refreshServiceAcls conf MRAMPolicyProvider server start bindAddress NetUtils createSocketAddrForHost appContext getNMHostname server getListenerAddress getPort LOG info bindAddress HttpConfig Policy httpPolicy conf getBoolean MRJobConfig MR_AM_WEBAPP_HTTPS_ENABLED MRJobConfig DEFAULT_MR_AM_WEBAPP_HTTPS_ENABLED Policy HTTPS_ONLY Policy HTTP_ONLY needsClientAuth conf getBoolean MRJobConfig MR_AM_WEBAPP_HTTPS_CLIENT_AUTH MRJobConfig DEFAULT_MR_AM_WEBAPP_HTTPS_CLIENT_AUTH webApp WebApps $for AppContext appContext withHttpPolicy conf httpPolicy withPortRange conf MRJobConfig MR_AM_WEBAPP_PORT_RANGE needsClientAuth needsClientAuth start AMWebApp
Thread thread Thread r thread setContextClassLoader jobClassLoader thread tfBuilder setThreadFactory backingTf ThreadFactory tf tfBuilder build launcherPool HadoopThreadPoolExecutor TimeUnit HOURS LinkedBlockingQueue Runnable tf Thread Runnable CommitterEvent event Thread event eventQueue take
smallInput dataInputLength sysMaxBytes requiredMapMB conf getLong MRJobConfig MAP_MEMORY_MB requiredReduceMB conf getLong MRJobConfig REDUCE_MEMORY_MB requiredMB Math max requiredMapMB requiredReduceMB requiredMapCores conf getInt MRJobConfig MAP_CPU_VCORES MRJobConfig DEFAULT_MAP_CPU_VCORES requiredReduceCores conf getInt MRJobConfig REDUCE_CPU_VCORES MRJobConfig DEFAULT_REDUCE_CPU_VCORES requiredCores Math max requiredMapCores requiredReduceCores requiredMB requiredMapMB requiredCores requiredMapCores smallMemory requiredMB sysMemSizeForUberSlot sysMemSizeForUberSlot JobConf DISABLED_MEMORY_LIMIT smallCpu requiredCores sysCPUSizeForUberSlot notChainJob isChainJob conf isUber uberEnabled smallNumMapTasks smallNumReduceTasks smallInput smallMemory smallCpu notChainJob isUber
conf setFloat MRJobConfig COMPLETED_MAPS_FOR_REDUCE_SLOWSTART conf setInt MRJobConfig MAP_MAX_ATTEMPTS conf setInt MRJobConfig REDUCE_MAX_ATTEMPTS conf setBoolean MRJobConfig MAP_SPECULATIVE conf setBoolean MRJobConfig REDUCE_SPECULATIVE StringBuilder msg StringBuilder msg append append jobId append uberEnabled msg append smallNumMapTasks msg append smallNumReduceTasks msg append smallInput msg append smallCpu msg append smallMemory msg append smallCpu msg append
nodeId List TaskAttemptId taskAttemptIdList nodesToSucceededTaskAttempts get nodeId taskAttemptIdList String mesg nodeId TaskAttemptId taskAttemptIdList
jobToken Credentials credentials LOG info credentials numberOfTokens credentials numberOfSecretKeys Credentials taskCredentials Credentials credentials TokenCache setJobToken jobToken taskCredentials DataOutputBuffer containerTokens_dob DataOutputBuffer
handle event LOG LOG debug event getTaskAttemptID event getType writeLock lock TaskAttemptStateInternal oldState getInternalState stateMachine doTransition event getType event e LOG error attemptId e eventHandler handle JobDiagnosticsUpdateEvent attemptId getTaskId getJobId event getType attemptId eventHandler handle JobEvent attemptId getTaskId getJobId JobEventType INTERNAL_ERROR oldState getInternalState getInternalState TaskAttemptStateInternal String nodeId container container getNodeId toString
LOG debug event getTaskAttemptID event getType writeLock lock TaskAttemptStateInternal oldState getInternalState stateMachine doTransition event getType event e LOG error attemptId e eventHandler handle JobDiagnosticsUpdateEvent attemptId getTaskId getJobId event getType attemptId eventHandler handle JobEvent attemptId getTaskId getJobId JobEventType INTERNAL_ERROR oldState getInternalState getInternalState TaskAttemptStateInternal String nodeId container container getNodeId toString LOG info attemptId oldState getInternalState event getType nodeId
reportedStatus id attemptId reportedStatus progress reportedStatus counters taInfo getCounters reportedStatus stateString taInfo getState reportedStatus phase Phase CLEANUP reportedStatus mapFinishTime taInfo getMapFinishTime reportedStatus shuffleFinishTime taInfo getShuffleFinishTime reportedStatus sortFinishTime taInfo getSortFinishTime addDiagnosticInfo taInfo getError needToClean String recoveredState taInfo getTaskStatus recoveredState TaskAttemptContext tac TaskAttemptContextImpl conf TypeConverter fromYarn attemptId committer recoverTask tac
reportedStatus counters taInfo getCounters reportedStatus stateString taInfo getState reportedStatus phase Phase CLEANUP reportedStatus mapFinishTime taInfo getMapFinishTime reportedStatus shuffleFinishTime taInfo getShuffleFinishTime reportedStatus sortFinishTime taInfo getSortFinishTime addDiagnosticInfo taInfo getError needToClean String recoveredState taInfo getTaskStatus recoveredState TaskAttemptContext tac TaskAttemptContextImpl conf TypeConverter fromYarn attemptId committer recoverTask tac LOG info attemptId
reportedStatus stateString taInfo getState reportedStatus phase Phase CLEANUP reportedStatus mapFinishTime taInfo getMapFinishTime reportedStatus shuffleFinishTime taInfo getShuffleFinishTime reportedStatus sortFinishTime taInfo getSortFinishTime addDiagnosticInfo taInfo getError needToClean String recoveredState taInfo getTaskStatus recoveredState TaskAttemptContext tac TaskAttemptContextImpl conf TypeConverter fromYarn attemptId committer recoverTask tac LOG info attemptId e LOG error attemptId e
needToClean TaskAttemptStateInternal attemptState TaskAttemptState SUCCEEDED attemptState TaskAttemptStateInternal SUCCEEDED reportedStatus taskState TaskAttemptState SUCCEEDED eventHandler handle createJobCounterUpdateEventTASucceeded logAttemptFinishedEvent attemptState TaskAttemptState FAILED attemptState TaskAttemptStateInternal FAILED reportedStatus taskState TaskAttemptState FAILED eventHandler handle createJobCounterUpdateEventTAFailed TaskAttemptUnsuccessfulCompletionEvent tauce createTaskAttemptUnsuccessfulCompletionEvent TaskAttemptStateInternal FAILED eventHandler handle JobHistoryEvent attemptId getTaskId getJobId tauce TaskAttemptState
JobCounterUpdateEvent jce JobCounterUpdateEvent attemptId getTaskId getJobId jce addCounterUpdate attemptId getTaskId getTaskType TaskType MAP JobCounter TOTAL_LAUNCHED_MAPS JobCounter TOTAL_LAUNCHED_REDUCES eventHandler handle jce
canCommit taskAttemptID readLock lock canCommit commitAttempt canCommit taskAttemptID equals commitAttempt
TaskAttemptImpl avataar TaskAttemptImpl attempt createAttempt attempt setAvataar avataar
Set String allNodes HashSet String event eventQueue take e LOG error e allNodes add event getContainerMgrAddress poolSize launcherPool getCorePoolSize poolSize limitOnPoolSize numNodes allNodes size idealPoolSize Math min limitOnPoolSize numNodes poolSize idealPoolSize newPoolSize Math min limitOnPoolSize idealPoolSize initialPoolSize
AllocateRequest allocateRequest AllocateRequest newInstance lastResponseID getApplicationProgress ArrayList ResourceRequest ArrayList ContainerId AllocateResponse allocateResponse allocateResponse scheduler allocate allocateRequest retrystartTime System currentTimeMillis e LOG info eventHandler handle JobEvent getJob getID JobEventType JOB_AM_REBOOT YarnRuntimeException getContext getApplicationID e e LOG info lastResponseID register e System currentTimeMillis retrystartTime
clientService serviceAddr clientService getBindAddress RegisterApplicationMasterRequest request recordFactory newRecordInstance RegisterApplicationMasterRequest serviceAddr request setHost serviceAddr getHostName request setRpcPort serviceAddr getPort request setTrackingUrl MRWebAppUtil getAMWebappScheme getConfig serviceAddr getHostName clientService getHttpPort RegisterApplicationMasterResponse response scheduler registerApplicationMaster request isApplicationMasterRegistered maxContainerCapability response getMaximumResourceCapability context getClusterInfo setMaxContainerCapability maxContainerCapability setClientToAMToken response getClientToAMTokenMasterKey applicationACLs response getApplicationACLs
RegisterApplicationMasterRequest request recordFactory newRecordInstance RegisterApplicationMasterRequest serviceAddr request setHost serviceAddr getHostName request setRpcPort serviceAddr getPort request setTrackingUrl MRWebAppUtil getAMWebappScheme getConfig serviceAddr getHostName clientService getHttpPort RegisterApplicationMasterResponse response scheduler registerApplicationMaster request isApplicationMasterRegistered maxContainerCapability response getMaximumResourceCapability context getClusterInfo setMaxContainerCapability maxContainerCapability setClientToAMToken response getClientToAMTokenMasterKey applicationACLs response getApplicationACLs LOG info maxContainerCapability String queue response getQueue
shouldUnregister shouldUnregister shouldUnregister
isSignalled isSignalled isSignalled
qSize eventQueue size qSize qSize
handleReduceContainerRequest reqEvent event LOG info event toString TaskAttemptId aId event getAttemptID removed scheduledRequests remove aId removed ContainerId containerId assignedRequests get aId containerId removed assignedRequests remove aId containersReleased pendingRelease add containerId release containerId removed
reqEvent assert reqEvent getAttemptID getTaskId getTaskType equals TaskType REDUCE Resource supportedMaxContainerCapability getMaxContainerCapability JobId jobId getJob getID reduceResourceRequest equals reduceResourceRequest reqEvent getCapability eventHandler handle JobHistoryEvent jobId NormalizedResourceEvent org apache hadoop mapreduce TaskType REDUCE reduceResourceRequest getMemorySize
reduceResourceRequest reqEvent getCapability eventHandler handle JobHistoryEvent jobId NormalizedResourceEvent org apache hadoop mapreduce TaskType REDUCE reduceResourceRequest getMemorySize LOG info reduceResourceRequest reduceContainerRequestAccepted reduceResourceRequest getMemorySize supportedMaxContainerCapability getMemorySize reduceResourceRequest getVirtualCores supportedMaxContainerCapability getVirtualCores reduceContainerRequestAccepted reduceContainerRequestAccepted reqEvent getCapability setVirtualCores reduceResourceRequest getVirtualCores reqEvent getCapability setMemorySize reduceResourceRequest getMemorySize reqEvent pendingReduces addFirst ContainerRequest reqEvent PRIORITY_REDUCE reduceNodeLabelExpression pendingReduces add ContainerRequest reqEvent PRIORITY_REDUCE reduceNodeLabelExpression String diagMsg reduceResourceRequest supportedMaxContainerCapability
reqEvent assert reqEvent getAttemptID getTaskId getTaskType equals TaskType MAP Resource supportedMaxContainerCapability getMaxContainerCapability JobId jobId getJob getID mapResourceRequest equals mapResourceRequest reqEvent getCapability eventHandler handle JobHistoryEvent jobId NormalizedResourceEvent org apache hadoop mapreduce TaskType MAP mapResourceRequest getMemorySize
Resource supportedMaxContainerCapability getMaxContainerCapability JobId jobId getJob getID mapResourceRequest mapResourceRequest reqEvent getCapability eventHandler handle JobHistoryEvent jobId NormalizedResourceEvent org apache hadoop mapreduce TaskType MAP mapResourceRequest getMemorySize LOG info mapResourceRequest mapContainerRequestAccepted mapResourceRequest getMemorySize supportedMaxContainerCapability getMemorySize mapResourceRequest getVirtualCores supportedMaxContainerCapability getVirtualCores mapContainerRequestAccepted mapContainerRequestAccepted reqEvent getCapability setMemorySize mapResourceRequest getMemorySize reqEvent getCapability setVirtualCores mapResourceRequest getVirtualCores scheduledRequests addMap reqEvent String diagMsg mapResourceRequest supportedMaxContainerCapability
hangingMapRequests clearAllPendingReduceRequests preemptionReduceNumForOneMap ResourceCalculatorUtils divideAndCeilContainers mapResourceRequest reduceResourceRequest getSchedulerResourceTypes preemptionReduceNumForPreemptionLimit ResourceCalculatorUtils divideAndCeilContainers Resources multiply getResourceLimit maxReducePreemptionLimit reduceResourceRequest getSchedulerResourceTypes preemptionReduceNumForAllMaps ResourceCalculatorUtils divideAndCeilContainers Resources multiply mapResourceRequest hangingMapRequests reduceResourceRequest getSchedulerResourceTypes toPreempt Math min Math max preemptionReduceNumForOneMap preemptionReduceNumForPreemptionLimit preemptionReduceNumForAllMaps
completedMapPercent totalMaps completedMapPercent completedMaps totalMaps completedMapPercent Resource netScheduledMapResource Resources multiply mapResourceReqt scheduledMaps assignedMaps Resource netScheduledReduceResource Resources multiply reduceResourceReqt scheduledReduces assignedReduces Resource finalMapResourceLimit Resource finalReduceResourceLimit Resource totalResourceLimit getResourceLimit Resource idealReduceResourceLimit Resources multiply totalResourceLimit Math min completedMapPercent maxReduceRampupLimit Resource ideaMapResourceLimit Resources subtract totalResourceLimit idealReduceResourceLimit ideaMapResourceLimit mapResourceReqt scheduledMaps assignedMaps Resource unusedMapResourceLimit Resources subtract ideaMapResourceLimit netScheduledMapResource finalReduceResourceLimit Resources add idealReduceResourceLimit unusedMapResourceLimit
AllocateResponse response response makeRemoteRequest retrystartTime System currentTimeMillis e eventHandler handle JobEvent getJob getID JobEventType JOB_AM_REBOOT RMContainerAllocationException getContext getApplicationAttemptId e e LOG info lastResponseID register addOutstandingRequestOnResync e String diagMsg StringUtils stringifyException e
retryInterval LOG error retryInterval eventHandler handle JobEvent getJob getID JobEventType JOB_AM_REBOOT RMContainerAllocationException retryInterval e Resource newHeadRoom getAvailableResources List Container newContainers response getAllocatedContainers response nmToken response NMTokenCache setNMToken nmToken getNodeId toString nmToken getToken response getAMRMToken updateAMRMToken response getAMRMToken List ContainerStatus finishedContainers response getCompletedContainersStatuses PreemptionMessage preemptReq response getPreemptionMessage preemptReq
container LOG info container getContainerId TaskAttemptId attemptID assignedRequests get container getContainerId attemptID
response List NodeReport updatedNodes response getUpdatedNodes updatedNodes eventHandler handle JobUpdatedNodesEvent getJob getID updatedNodes HashSet NodeId unusableNodes HashSet NodeId NodeReport nr updatedNodes NodeState nodeState nr getNodeState nodeState unusableNodes add nr getNodeId i i i HashMap TaskAttemptId Container taskSet i assignedRequests maps assignedRequests reduces TaskAttemptId Container entry taskSet TaskAttemptId tid entry getKey NodeId taskAttemptNodeId entry getValue getNodeId unusableNodes taskAttemptNodeId
serviceInit conf serviceInit conf nodeBlacklistingEnabled conf getBoolean MRJobConfig MR_AM_JOB_NODE_BLACKLISTING_ENABLE
serviceInit conf serviceInit conf nodeBlacklistingEnabled conf getBoolean MRJobConfig MR_AM_JOB_NODE_BLACKLISTING_ENABLE LOG info nodeBlacklistingEnabled maxTaskFailuresPerNode conf getInt MRJobConfig MAX_TASK_FAILURES_PER_TRACKER blacklistDisablePercent conf getInt MRJobConfig MR_AM_IGNORE_BLACKLISTING_BLACKLISTED_NODE_PERECENT MRJobConfig DEFAULT_MR_AM_IGNORE_BLACKLISTING_BLACKLISTED_NODE_PERCENT
AllocateResponse applyRequestLimits ResourceBlacklistRequest blacklistRequest ResourceBlacklistRequest newInstance ArrayList String blacklistAdditions ArrayList String blacklistRemovals AllocateRequest allocateRequest AllocateRequest newInstance lastResponseID getApplicationProgress ArrayList ResourceRequest ask ArrayList ContainerId release blacklistRequest AllocateResponse allocateResponse scheduler allocate allocateRequest lastResponseID allocateResponse getResponseId availableResources allocateResponse getAvailableResources lastClusterNmCount clusterNmCount clusterNmCount allocateResponse getNumClusterNodes numCompletedContainers allocateResponse getCompletedContainersStatuses size ask size release size
ResourceBlacklistRequest blacklistRequest ResourceBlacklistRequest newInstance ArrayList String blacklistAdditions ArrayList String blacklistRemovals AllocateRequest allocateRequest AllocateRequest newInstance lastResponseID getApplicationProgress ArrayList ResourceRequest ask ArrayList ContainerId release blacklistRequest AllocateResponse allocateResponse scheduler allocate allocateRequest lastResponseID allocateResponse getResponseId availableResources allocateResponse getAvailableResources lastClusterNmCount clusterNmCount clusterNmCount allocateResponse getNumClusterNodes numCompletedContainers allocateResponse getCompletedContainersStatuses size ask size release size LOG info applicationId ask size release size allocateResponse getAllocatedContainers size numCompletedContainers availableResources clusterNmCount ask clear release clear numCompletedContainers requestLimitsToUpdate addAll requestLimits keySet blacklistAdditions size blacklistRemovals size
blacklistedNodeCount blacklistedNodes size clusterNmCount blacklistedNodeCount blacklistedNodes size clusterNmCount LOG info val blacklistedNodes size clusterNmCount val LOG info clusterNmCount blacklistedNodeCount val blacklistAdditions clear blacklistRemovals addAll blacklistedNodes
priority String Resource String Map String Map Resource ResourceRequest remoteRequests remoteRequestsTable get priority remoteRequests remoteRequests HashMap String Map Resource ResourceRequest remoteRequestsTable put priority remoteRequests
Map Resource ResourceRequest reqMap remoteRequests get resourceName reqMap reqMap HashMap Resource ResourceRequest remoteRequests put resourceName reqMap ResourceRequest remoteRequest reqMap get capability remoteRequest remoteRequest recordFactory newRecordInstance ResourceRequest remoteRequest setPriority priority remoteRequest setResourceName resourceName remoteRequest setCapability capability remoteRequest setNumContainers remoteRequest setNodeLabelExpression nodeLabelExpression remoteRequest setExecutionTypeRequest ExecutionTypeRequest newInstance executionType reqMap put capability remoteRequest remoteRequest setNumContainers remoteRequest getNumContainers
priority String resourceName Resource Map String Map Resource ResourceRequest remoteRequests remoteRequestsTable get priority Map Resource ResourceRequest reqMap remoteRequests get resourceName reqMap
LOG debug resourceName ResourceRequest remoteRequest reqMap get capability LOG LOG debug applicationId getId priority getPriority resourceName remoteRequest getNumContainers ask size remoteRequest getNumContainers remoteRequest setNumContainers remoteRequest getNumContainers remoteRequest getNumContainers reqMap remove capability reqMap size remoteRequests remove resourceName remoteRequests size remoteRequestsTable remove priority addResourceRequestToAsk remoteRequest LOG
ctxt preemptionRequests preemptionRequests StrictPreemptionContract cStrict preemptionRequests getStrictContract cStrict cStrict getContainers cStrict getContainers size LOG info preemptionRequests getStrictContract getContainers size c preemptionRequests getStrictContract getContainers ContainerId reqCont c getId TaskAttemptId reqTask ctxt getTaskAttempt reqCont reqTask reqTask toBePreempted add reqTask
LOG info reqCont reqTask PreemptionContract cNegot preemptionRequests getContract cNegot cNegot getResourceRequest cNegot getResourceRequest size cNegot getContainers cNegot getContainers size LOG info preemptionRequests getContract getResourceRequest size preemptionRequests getContract getContainers size List PreemptionResourceRequest reqResources preemptionRequests getContract getResourceRequest pendingPreemptionRam pendingPreemptionCores r pendingPreemptionRam r getMemorySize pendingPreemptionCores r getVirtualCores PreemptionResourceRequest rr reqResources ResourceRequest reqRsrc rr getResourceRequest ResourceRequest reqRsrc
totalMemoryToRelease pendingPreemptionRam pendingPreemptionRam totalMemoryToRelease pendingPreemptionCores totalCoresToRelease pendingPreemptionCores pendingPreemptionCores totalCoresToRelease List Container listOfCont ctxt getContainers TaskType REDUCE listOfCont Container Container o1 Container o2 o2 getId compareTo o1 getId Container cont listOfCont totalMemoryToRelease totalCoresToRelease TaskAttemptId reduceId ctxt getTaskAttempt cont getId cMem cont getResource getMemorySize
ctxt c ContainerId reqCont c getId TaskAttemptId reqTask ctxt getTaskAttempt reqCont
Class TaskRuntimeEstimator estimatorClass conf getClass MRJobConfig MR_AM_TASK_ESTIMATOR LegacyTaskRuntimeEstimator TaskRuntimeEstimator Constructor TaskRuntimeEstimator estimatorConstructor estimatorClass getConstructor estimator estimatorConstructor newInstance estimator contextualize conf context ex LOG error ex YarnRuntimeException ex ex LOG error ex YarnRuntimeException ex ex LOG error ex YarnRuntimeException ex ex
backgroundRunStartTime clock getTime speculations computeSpeculations mininumRecomp speculations soonestRetryAfterSpeculate soonestRetryAfterNoSpeculate wait Math max mininumRecomp clock getTime backgroundRunStartTime speculations
requireJob e renderText e getMessage String taskType $ TASK_TYPE taskType RuntimeException String attemptState $ ATTEMPT_STATE attemptState RuntimeException setTitle join attemptState MRApps taskType taskType toString $ JOB_ID render attemptsPage e
Path confPath job getConfFile ConfInfo info ConfInfo job html div a jid confPath toString __ TBODY TABLE Hamlet tbody html table thead tr th _TH th _TH th _TH __ __ tbody entry info StringBuffer buffer StringBuffer String sources entry getSource first i sources i i first buffer append first buffer append sources i tbody tr td entry getName td entry getValue td buffer toString __
JobConf conf JobConf AppContext context mock AppContext CountDownLatch isDone CountDownLatch
summary setJobName String out summary getJobSummaryString
job JobReport jobReport job getReport
job JobReport jobReport job getReport LOG info jobReport getStartTime
job JobReport jobReport job getReport LOG info jobReport getStartTime LOG info jobReport getFinishTime Assert assertTrue jobReport getStartTime jobReport getFinishTime Assert assertTrue jobReport getFinishTime System currentTimeMillis task job TaskReport taskReport task getReport
job JobReport jobReport job getReport LOG info jobReport getStartTime LOG info jobReport getFinishTime Assert assertTrue jobReport getStartTime jobReport getFinishTime Assert assertTrue jobReport getFinishTime System currentTimeMillis task job TaskReport taskReport task getReport LOG info task getID taskReport getStartTime
String userName JobConf conf JobConf conf set MRJobConfig MR_AM_STAGING_DIR stagingDir conf setInt org apache hadoop mapreduce lib output FileOutputCommitter FILEOUTPUTCOMMITTER_ALGORITHM_VERSION ApplicationAttemptId applicationAttemptId ApplicationAttemptId fromString applicationAttemptIdStr JobId jobId TypeConverter toYarn TypeConverter fromYarn applicationAttemptId getApplicationId Path start MRApps getStartJobCommitFile conf userName jobId FileSystem fs FileSystem get conf fs create start close ContainerId containerId ContainerId fromString containerIdStr MRAppMaster appMaster MRAppMasterTest applicationAttemptId containerId System currentTimeMillis caught MRAppMaster initAndStartAppMaster appMaster conf userName
JobConf conf JobConf conf set MRJobConfig MR_AM_STAGING_DIR stagingDir ApplicationAttemptId applicationAttemptId ApplicationAttemptId fromString applicationAttemptIdStr JobId jobId TypeConverter toYarn TypeConverter fromYarn applicationAttemptId getApplicationId Path start MRApps getStartJobCommitFile conf userName jobId Path end MRApps getEndJobCommitSuccessFile conf userName jobId FileSystem fs FileSystem get conf fs create start close fs create end close ContainerId containerId ContainerId fromString containerIdStr MRAppMaster appMaster MRAppMasterTest applicationAttemptId containerId System currentTimeMillis caught MRAppMaster initAndStartAppMaster appMaster conf userName
JobConf conf JobConf conf set MRJobConfig MR_AM_STAGING_DIR stagingDir ApplicationAttemptId applicationAttemptId ApplicationAttemptId fromString applicationAttemptIdStr JobId jobId TypeConverter toYarn TypeConverter fromYarn applicationAttemptId getApplicationId Path start MRApps getStartJobCommitFile conf userName jobId Path end MRApps getEndJobCommitFailureFile conf userName jobId FileSystem fs FileSystem get conf fs create start close fs create end close ContainerId containerId ContainerId fromString containerIdStr MRAppMaster appMaster MRAppMasterTest applicationAttemptId containerId System currentTimeMillis caught MRAppMaster initAndStartAppMaster appMaster conf userName
String applicationAttemptIdStr String containerIdStr String userName JobConf conf JobConf conf set MRJobConfig MR_AM_STAGING_DIR stagingDir ApplicationAttemptId applicationAttemptId ApplicationAttemptId fromString applicationAttemptIdStr File dir File stagingDir dir FileUtils deleteDirectory dir ContainerId containerId ContainerId fromString containerIdStr MRAppMaster appMaster MRAppMasterTest applicationAttemptId containerId System currentTimeMillis caught MRAppMaster initAndStartAppMaster appMaster conf userName
Task mapTask2 it next Task reduceTask it next app waitForState mapTask1 TaskState RUNNING app waitForState mapTask2 TaskState RUNNING app getContext getEventHandler handle TaskEvent mapTask1 getID TaskEventType T_ADD_SPEC_ATTEMPT timeOut mapTask1 getAttempts timeOut Thread sleep LOG info Iterator TaskAttempt t1it mapTask1 getAttempts values iterator TaskAttempt task1Attempt1 t1it next TaskAttempt task1Attempt2 t1it next TaskAttempt task2Attempt mapTask2 getAttempts values iterator next waitForContainerAssignment task1Attempt2 ContainerId t1a2contId task1Attempt2 getAssignedContainerID
assertThat containerLauncher initialPoolSize isEqualTo MRJobConfig DEFAULT_MR_AM_CONTAINERLAUNCHER_THREADPOOL_INITIAL_SIZE Assert assertEquals threadPool getPoolSize Assert assertEquals containerLauncher initialPoolSize threadPool getCorePoolSize Assert assertNull containerLauncher foundErrors containerLauncher expectedCorePoolSize containerLauncher initialPoolSize i i i ContainerId containerId ContainerId newContainerId appAttemptId i TaskAttemptId taskAttemptId MRBuilderUtils newTaskAttemptId taskId i containerLauncher handle ContainerLauncherEvent taskAttemptId containerId i ContainerLauncher EventType CONTAINER_REMOTE_LAUNCH waitForEvents containerLauncher Assert assertEquals threadPool getPoolSize Assert assertNull containerLauncher foundErrors containerLauncher finishEventHandling timeOut containerLauncher timeOut
timeOut timeOut
server start MRApp app MRAppWithSlowNM tokenSecretManager Job job app submit conf app waitForState job JobState RUNNING Map TaskId Task tasks job getTasks Assert assertEquals tasks size Task task tasks values iterator next app waitForState task TaskState SCHEDULED Map TaskAttemptId TaskAttempt attempts tasks values iterator next getAttempts Assert assertEquals maxAttempts attempts size TaskAttempt attempt attempts values iterator next app waitForInternalState TaskAttemptImpl attempt TaskAttemptStateInternal ASSIGNED app waitForState job JobState FAILED String diagnostics attempt getDiagnostics toString
assertBlacklistAdditionsAndRemovals rm Assert assertEquals assigned size LOG info assigned allocator schedule rm drainEvents assertBlacklistAdditionsAndRemovals rm Assert assertEquals assigned size LOG info nodeManager3 nodeHeartbeat rm drainEvents LOG info assigned allocator schedule assertBlacklistAdditionsAndRemovals rm rm drainEvents assigned
e IOException e e IOException e String pathString path toUri toString String link entry getKey String target File path toUri getPath symlink workDir target link resource localArchives add pathString resource localFiles add pathString resource IllegalArgumentException resource getResource Path resourcePath
File workDir link link link workDir toString Path SEPARATOR link File flink File link flink
Path outDir conf FileSystem fs outDir getFileSystem conf StringBuffer result StringBuffer Path fileList FileUtil stat2Paths fs listStatus outDir Utils OutputFileUtils OutputFilesFilter Path fileList
assert readSegmentIndex assert currentKVOffset readSegmentIndex i Iterator Segment K V itr segmentList iterator itr Segment K V s itr next i readSegmentIndex s close itr remove i LOG debug firstSegmentOffset currentKVOffset readSegmentIndex
inReset i i segmentList i Segment K V s segmentList get i s offset i firstSegmentOffset s getReader reset offset s closeReader i s reinitReader firstSegmentOffset s getReader disableChecksumValidation currentKVOffset firstSegmentOffset nextKVOffset readSegmentIndex hasMore
context context enablePathForCleanup
log log log info size
log log log info size group log info group getDisplayName group
numThreads job getInt org apache hadoop mapreduce lib input FileInputFormat LIST_STATUS_NUM_THREADS org apache hadoop mapreduce lib input FileInputFormat DEFAULT_LIST_STATUS_NUM_THREADS StopWatch sw StopWatch start numThreads List FileStatus locatedFiles singleThreadedListStatus job dirs inputFilter recursive result locatedFiles toArray FileStatus locatedFiles size Iterable FileStatus locatedFiles LocatedFileStatusFetcher locatedFileStatusFetcher LocatedFileStatusFetcher job dirs recursive inputFilter locatedFiles locatedFileStatusFetcher getFileStatuses e IOException InterruptedIOException initCause e result Iterables toArray locatedFiles FileStatus sw stop
BlockLocation blkLocations file LocatedFileStatus blkLocations LocatedFileStatus file getBlockLocations blkLocations fs getFileBlockLocations file length fs path blockSize file getBlockSize splitSize computeSplitSize goalSize minSize blockSize bytesRemaining length bytesRemaining splitSize String splitHosts getSplitHostsAndCachedHosts blkLocations length bytesRemaining splitSize clusterMap splits add makeSplit path length bytesRemaining splitSize splitHosts splitHosts bytesRemaining splitSize bytesRemaining String splitHosts getSplitHostsAndCachedHosts blkLocations length bytesRemaining bytesRemaining clusterMap
path blockSize file getBlockSize splitSize computeSplitSize goalSize minSize blockSize bytesRemaining length bytesRemaining splitSize String splitHosts getSplitHostsAndCachedHosts blkLocations length bytesRemaining splitSize clusterMap splits add makeSplit path length bytesRemaining splitSize splitHosts splitHosts bytesRemaining splitSize bytesRemaining String splitHosts getSplitHostsAndCachedHosts blkLocations length bytesRemaining bytesRemaining clusterMap splits add makeSplit path length bytesRemaining bytesRemaining splitHosts splitHosts LOG length file getBlockSize minSize LOG debug file getPath
configName heapSize heapRatio memory getInt configName memory heapSize memory Math ceil heapSize heapRatio
notification code httpNotification notification getUri notification getTimeout code IOException code IOException ioex LOG error notification getUri ioex ex LOG error notification getUri ex Thread sleep notification getRetryInterval
runningTasks incrementAndGet
INKEY INVALUE job splitIndex umbilical reporter InputSplit inputSplit getSplitDetails Path splitIndex getSplitLocation splitIndex getStartOffset updateJobWithSplit job inputSplit reporter setInputSplit inputSplit RecordReader INKEY INVALUE in isSkipping SkippingRecordReader INKEY INVALUE umbilical reporter job TrackedRecordReader INKEY INVALUE reporter job job setBoolean JobContext SKIP_RECORDS isSkipping numReduceTasks conf getNumReduceTasks
INKEY INVALUE OUTKEY OUTVALUE job splitIndex reporter org apache hadoop mapreduce TaskAttemptContext taskContext org apache hadoop mapreduce task TaskAttemptContextImpl job getTaskID reporter org apache hadoop mapreduce Mapper INKEY INVALUE OUTKEY OUTVALUE mapper org apache hadoop mapreduce Mapper INKEY INVALUE OUTKEY OUTVALUE ReflectionUtils newInstance taskContext getMapperClass job org apache hadoop mapreduce InputFormat INKEY INVALUE inputFormat org apache hadoop mapreduce InputFormat INKEY INVALUE ReflectionUtils newInstance taskContext getInputFormatClass job org apache hadoop mapreduce InputSplit split split getSplitDetails Path splitIndex getSplitLocation splitIndex getStartOffset
JobQueueInfo JobQueueInfo queueInfo JobQueueInfo queueInfo setQueueName name
name newState getName LOG info name newState getName children children size newState getChildren newState getChildren size LOG info newState children size newState getChildren LOG error getName children size childrenSize children size newChildrenSize newState getChildren size childrenSize newChildrenSize
LOG info newState children size newState getChildren LOG error getName children size childrenSize children size newChildrenSize newState getChildren size childrenSize newChildrenSize LOG error newState getName newChildrenSize childrenSize Iterator Queue itr1 children iterator Iterator Queue itr2 newState getChildren iterator itr1 Queue q itr1 next
cp root cp getRoot leafQueues clear allQueues clear leafQueues getRoot getLeafQueues allQueues putAll getRoot getInnerQueues allQueues putAll leafQueues
queueName Queue q leafQueues get queueName q
runJobCleanupTask umbilical reporter runJobSetupTask umbilical reporter runTaskCleanupTask umbilical reporter codec initCodec RawKeyValueIterator rIter ShuffleConsumerPlugin shuffleConsumerPlugin Class combinerClass conf getCombinerClass CombineOutputCollector combineCollector combinerClass CombineOutputCollector reduceCombineOutputCounter reporter conf Class ShuffleConsumerPlugin clazz job getClass MRConfig SHUFFLE_CONSUMER_PLUGIN Shuffle ShuffleConsumerPlugin
startIndex range getStartIndex endIndex range getEndIndex SortedSet Range headSet ranges headSet range headSet Range previousRange headSet last LOG debug previousRange startIndex previousRange getEndIndex ranges previousRange indicesCount previousRange getLength startIndex previousRange getStartIndex endIndex endIndex previousRange getEndIndex endIndex previousRange getEndIndex Iterator Range tailSetIt ranges tailSet range iterator tailSetIt Range nextRange tailSetIt next
startIndex range getStartIndex endIndex range getEndIndex SortedSet Range headSet ranges headSet range headSet Range previousRange headSet last LOG debug previousRange startIndex previousRange getEndIndex ranges previousRange indicesCount previousRange getLength LOG debug previousRange add previousRange getStartIndex startIndex endIndex previousRange getEndIndex add endIndex previousRange getEndIndex Iterator Range tailSetIt ranges tailSet range iterator tailSetIt
add start end end start Range recRange Range start end start ranges add recRange indicesCount recRange getLength
nextRecIndex len nextRecIndex currentRecStartIndex SortedRanges Range range SortedRanges Range currentRecStartIndex len taskStatus setNextRecordRange range
setState TaskStatus State COMMIT_PENDING umbilical commitPending taskId taskStatus ie ie LOG warn StringUtils stringifyException ie System exit commit umbilical reporter committer taskDone set reporter stopCommunicationThread updateCounters sendLastUpdate umbilical
retries MAX_RETRIES Thread sleep ie reporter setProgressFlag ie LOG warn StringUtils stringifyException ie retries discardOutput taskContext System exit
umbilical setPhase TaskStatus Phase CLEANUP getProgress setStatus statusUpdate umbilical LOG info
jobConf numberOfThreads jobConf getInt MultithreadedMapper NUM_THREADS
K1 V1 input output reporter K1 key input createKey V1 value input createValue input key value executorService execute MapperInvokeRunable key value output reporter checkForExceptionsFromProcessingThreads key input createKey value input createValue LOG LOG debug job getJobName executorService shutdown executorService LOG
IOException initProviderList IOException initEx IOException MRConfig FRAMEWORK_NAME
ClientProtocol clientProtocol jobTrackAddr clientProtocol provider create conf clientProtocol provider create jobTrackAddr conf clientProtocol clientProtocolProvider provider client clientProtocol LOG debug provider getClass getName LOG debug provider getClass getName String errMsg provider getClass getName
conf out conf out write ByteBuffer allocate putLong out getPos array iv createIV conf out write iv
conf in conf CryptoCodec cryptoCodec CryptoCodec getInstance conf bufferSize getBufferSize conf IOUtils readFully in iv cryptoCodec getCipherSuite getAlgorithmBlockSize IOUtils readFully in iv cryptoCodec getCipherSuite getAlgorithmBlockSize
Map String Boolean conf areFiles String confParam areFiles MRJobConfig CACHE_FILES_SHARED_CACHE_UPLOAD_POLICIES MRJobConfig CACHE_ARCHIVES_SHARED_CACHE_UPLOAD_POLICIES Collection String policies conf getStringCollection confParam String policy Map String Boolean policyMap LinkedHashMap String Boolean String s policies policy s split DELIM policy
String lastReport Job TaskStatusFilter filter Configuration clientConf getConfiguration filter Job getTaskOutputFilter clientConf JobID jobId getJobID
progMonitorPollIntervalMillis Job getProgressPollInterval clientConf reportedAfterCompletion reportedUberMode reportedAfterCompletion reportedAfterCompletion Thread sleep progMonitorPollIntervalMillis reportedUberMode reportedUberMode LOG info jobId isUber String report StringUtils formatPercent mapProgress StringUtils formatPercent reduceProgress report
Thread sleep progMonitorPollIntervalMillis reportedUberMode reportedUberMode LOG info jobId isUber String report StringUtils formatPercent mapProgress StringUtils formatPercent reduceProgress report lastReport LOG info report lastReport report TaskCompletionEvent events getTaskCompletionEvents eventCounter eventCounter events length printTaskEvents events filter profiling mapRanges reduceRanges success isSuccessful
reportedUberMode reportedUberMode LOG info jobId isUber String report StringUtils formatPercent mapProgress StringUtils formatPercent reduceProgress report lastReport LOG info report lastReport report TaskCompletionEvent events getTaskCompletionEvents eventCounter eventCounter events length printTaskEvents events filter profiling mapRanges reduceRanges success isSuccessful success LOG info jobId
event event LOG info event toString event LOG info event toString TaskAttemptID taskId event getTaskAttemptId String taskDiagnostics getTaskDiagnostics taskId taskDiagnostics String diagnostics taskDiagnostics System err println diagnostics event
Path jobStagingArea JobSubmissionFiles getStagingDir cluster conf InetAddress ip InetAddress getLocalHost ip submitHostAddress ip getHostAddress submitHostName ip getHostName conf set MRJobConfig JOB_SUBMITHOST submitHostName conf set MRJobConfig JOB_SUBMITHOSTADDR submitHostAddress JobID jobId submitClient getNewJobID job setJobID jobId Path submitJobDir Path jobStagingArea jobId toString JobStatus status conf set MRJobConfig USER_NAME UserGroupInformation getCurrentUser getShortUserName conf set conf set MRJobConfig MAPREDUCE_JOB_DIR submitJobDir toString
TokenCache obtainTokensForNamenodes job getCredentials Path submitJobDir conf populateTokenCache conf job getCredentials TokenCache job getCredentials KeyGenerator keyGen keyGen KeyGenerator getInstance SHUFFLE_KEYGEN_ALGORITHM keyGen init SHUFFLE_KEY_LENGTH e IOException e SecretKey shuffleKey keyGen generateKey TokenCache setShuffleSecretKey shuffleKey getEncoded job getCredentials conf conf setInt MRJobConfig MR_AM_MAX_ATTEMPTS LOG warn copyAndConfigureFiles job submitJobDir
KeyGenerator keyGen keyGen KeyGenerator getInstance SHUFFLE_KEYGEN_ALGORITHM keyGen init SHUFFLE_KEY_LENGTH e IOException e SecretKey shuffleKey keyGen generateKey TokenCache setShuffleSecretKey shuffleKey getEncoded job getCredentials conf conf setInt MRJobConfig MR_AM_MAX_ATTEMPTS LOG warn copyAndConfigureFiles job submitJobDir Path submitJobFile JobSubmissionFiles getJobConfPath submitJobDir LOG debug jtFs makeQualified submitJobDir maps writeSplits job submitJobDir
String queue conf get MRJobConfig QUEUE_NAME JobConf DEFAULT_QUEUE_NAME AccessControlList acl submitClient getQueueAdmins queue conf set toFullPropertyName queue QueueACL ADMINISTER_JOBS getAclName acl getAclString TokenCache cleanUpTokenReferral conf conf MRJobConfig MRJobConfig ArrayList String trackingIds ArrayList String t job getCredentials trackingIds add t decodeIdentifier getTrackingId conf setStrings MRJobConfig JOB_TOKEN_TRACKING_IDS trackingIds toArray String trackingIds size ReservationId reservationId job getReservationId reservationId conf set MRJobConfig RESERVATION_ID reservationId toString writeConf conf submitJobFile printTokens jobId job getCredentials status submitClient submitJob jobId submitJobDir toString job getCredentials
jobId LOG info jobId
conf credentials readTokensFromFiles conf credentials String nameNodes conf getStrings MRJobConfig JOB_NAMENODES
DBSplitter splitter getSplitter sqlDataType splitter IOException sqlDataType splitter split job getConfiguration results getDBConf getInputOrderBy e IOException e getMessage results results close se LOG debug se toString statement statement close
e IOException e getMessage results results close se LOG debug se toString statement statement close se LOG debug se toString connection commit
T DBConfiguration dbConf getDBConf SuppressWarnings Class T inputClass Class T dbConf getInputClass String dbProductName getDBProductName
query append i i fieldNames i query append fieldNames i i fieldNames query append query append append tableName query append append tableName query append conditions conditions query append append conditions append query append conditionClauses toString String inputQuery dbConf getInputQuery inputQuery
method conn getClass getMethod Class String ex LOG error conn getClass getName ex SQLException ex String clientTimeZone conf get SESSION_TIMEZONE_KEY method setAccessible method invoke conn clientTimeZone LOG info clientTimeZone ex LOG warn clientTimeZone LOG warn method invoke conn
context Configuration conf context getConfiguration fieldSeparator conf get FieldSelectionHelper DATA_FIELD_SEPARATOR reduceOutputKeyValueSpec conf get FieldSelectionHelper REDUCE_OUTPUT_KEY_VALUE_SPEC allReduceValueFieldsFrom FieldSelectionHelper parseOutputKeyValueSpec reduceOutputKeyValueSpec reduceOutputKeyFieldList reduceOutputValueFieldList
List FileStatus result numThreads job getConfiguration getInt LIST_STATUS_NUM_THREADS DEFAULT_LIST_STATUS_NUM_THREADS StopWatch sw StopWatch start numThreads result singleThreadedListStatus job dirs inputFilter recursive Iterable FileStatus locatedFiles LocatedFileStatusFetcher locatedFileStatusFetcher LocatedFileStatusFetcher job getConfiguration dirs recursive inputFilter locatedFiles locatedFileStatusFetcher getFileStatuses e IOException InterruptedIOException initCause e result Lists newArrayList locatedFiles sw stop
FileSystem fs path getFileSystem job getConfiguration blkLocations fs getFileBlockLocations file length job path blockSize file getBlockSize splitSize computeSplitSize blockSize minSize maxSize bytesRemaining length bytesRemaining splitSize blkIndex getBlockIndex blkLocations length bytesRemaining splits add makeSplit path length bytesRemaining splitSize blkLocations blkIndex getHosts blkLocations blkIndex getCachedHosts bytesRemaining splitSize bytesRemaining blkIndex getBlockIndex blkLocations length bytesRemaining splits add makeSplit path length bytesRemaining bytesRemaining blkLocations blkIndex getHosts blkLocations blkIndex getCachedHosts
bytesRemaining length bytesRemaining splitSize blkIndex getBlockIndex blkLocations length bytesRemaining splits add makeSplit path length bytesRemaining splitSize blkLocations blkIndex getHosts blkLocations blkIndex getCachedHosts bytesRemaining splitSize bytesRemaining blkIndex getBlockIndex blkLocations length bytesRemaining splits add makeSplit path length bytesRemaining bytesRemaining blkLocations blkIndex getHosts blkLocations blkIndex getCachedHosts LOG length file LOG debug file getPath splits add makeSplit path length blkLocations getHosts blkLocations getCachedHosts splits add makeSplit path length String
isCompressedInput decompressor CodecPool getDecompressor codec CompressionInputStream cIn codec createInputStream fileIn decompressor filePosition cIn inputStream cIn numRecordsRemainingInSplit Long MAX_VALUE LOG info fileIn seek start filePosition fileIn inputStream fileIn splitSize end start numBytesToSkip numRecordsRemainingInSplit splitSize recordLength recordLength numRecordsRemainingInSplit numRecordsRemainingInSplit
ControlledJob n n processedMap SourceSet add n SourceSet ControlledJob controlledJob SourceSet iterator next SourceSet remove controlledJob controlledJob getDependentJobs i i controlledJob getDependentJobs i ControlledJob depenControlledJob controlledJob getDependentJobs get i processedMap get controlledJob add depenControlledJob controlledJob processedMap SourceSet add depenControlledJob ControlledJob controlledJob controlledJob getDependentJobs controlledJob getDependentJobs processedMap get controlledJob cyclePresent
context outer context numberOfThreads getNumberOfThreads context mapClass getMapperClass context
context Path jobAttemptPath getJobAttemptPath context FileSystem fs jobAttemptPath getFileSystem context getConfiguration fs jobAttemptPath
FileStatus taskAttemptDirStatus taskAttemptDirStatus fs getFileStatus taskAttemptPath taskAttemptDirStatus taskAttemptDirStatus Path committedTaskPath getCommittedTaskPath context fs committedTaskPath fs committedTaskPath IOException committedTaskPath fs taskAttemptPath committedTaskPath IOException taskAttemptPath committedTaskPath LOG info attemptId committedTaskPath
taskAttemptDirStatus fs getFileStatus taskAttemptPath taskAttemptDirStatus taskAttemptDirStatus Path committedTaskPath getCommittedTaskPath context fs committedTaskPath fs committedTaskPath IOException committedTaskPath fs taskAttemptPath committedTaskPath IOException taskAttemptPath committedTaskPath LOG info attemptId committedTaskPath mergePaths fs taskAttemptDirStatus outputPath context LOG info attemptId outputPath
LOG LOG debug previousCommittedTaskPath fs previousCommittedTaskPath Path committedTaskPath getCommittedTaskPath context fs committedTaskPath fs committedTaskPath IOException committedTaskPath Path committedParent committedTaskPath getParent fs mkdirs committedParent fs previousCommittedTaskPath committedTaskPath IOException previousCommittedTaskPath committedTaskPath LOG warn attemptId
fs previousCommittedTaskPath Path committedTaskPath getCommittedTaskPath context fs committedTaskPath fs committedTaskPath IOException committedTaskPath Path committedParent committedTaskPath getParent fs mkdirs committedParent fs previousCommittedTaskPath committedTaskPath IOException previousCommittedTaskPath committedTaskPath LOG warn attemptId FileStatus from fs getFileStatus previousCommittedTaskPath LOG info previousCommittedTaskPath outputPath mergePaths fs from outputPath context
Path context PathOutputCommitter committer PathOutputCommitter context getOutputCommitter Path workPath committer getWorkPath
Path context extension OutputCommitter c getOutputCommitter context Preconditions checkState c PathOutputCommitter c Path workPath PathOutputCommitter c getWorkPath Preconditions checkNotNull workPath c Path workFile Path workPath getUniqueFile context getOutputName context extension
PathOutputCommitter context Class PathOutputCommitter clazz loadCommitterClass context
outputPath LOG debug outputPath String key COMMITTER_FACTORY_CLASS key outputPath String scheme outputPath toUri getScheme String schemeKey String format COMMITTER_FACTORY_SCHEME_PATTERN scheme schemeKey
conf getTrimmed key outputPath String scheme outputPath toUri getScheme String schemeKey String format COMMITTER_FACTORY_SCHEME_PATTERN scheme conf getTrimmed schemeKey LOG debug outputPath key schemeKey LOG debug schemeKey Class PathOutputCommitterFactory factory String trimmedValue conf getTrimmed key trimmedValue LOG debug factory FileOutputCommitterFactory factory conf getClass key FileOutputCommitterFactory PathOutputCommitterFactory
K job K sampler Configuration conf job getConfiguration InputFormat inf ReflectionUtils newInstance job getInputFormatClass conf numPartitions job getNumReduceTasks K samples K sampler getSample inf job
Credentials jobTokenFile conf Path localJobTokenFile Path jobTokenFile Credentials ts Credentials readTokenStorageFile localJobTokenFile conf
failures LOG info reduce getName numNewMaps getMapCompletionEvents failures numNewMaps
LOG info reduce getName Thread numNewMaps getMapCompletionEvents failures numNewMaps LOG info reduce numNewMaps LOG debug SLEEP_TIME Thread Thread sleep SLEEP_TIME LOG info
rc backoff connection getHeaderFieldLong FETCH_RETRY_AFTER_HEADER FETCH_RETRY_DELAY_DEFAULT backoff backoff FETCH_RETRY_DELAY_DEFAULT LOG warn FETCH_RETRY_DELAY_DEFAULT TryAgainLaterException backoff url getHost rc IOException rc url connection getResponseMessage connection getHeaderField connection getHeaderField IOException String replyHash connection getHeaderField SecureShuffleUtils HTTP_HEADER_REPLY_URL_HASH replyHash IOException LOG debug msgToEncode encHash replyHash SecureShuffleUtils verifyReply replyHash encHash shuffleSecretKey
mapId TaskAttemptID forName header mapId compressedLength header compressedLength decompressedLength header uncompressedLength forReduce header forReduce e badIdErrs increment LOG warn e remaining toArray TaskAttemptID remaining size InputStream is input is CryptoUtils wrapIfNecessary jobConf is compressedLength compressedLength CryptoUtils cryptoPadding jobConf decompressedLength CryptoUtils cryptoPadding jobConf compressedLength decompressedLength forReduce remaining mapId TaskAttemptID mapId LOG
remaining toArray TaskAttemptID remaining size InputStream is input is CryptoUtils wrapIfNecessary jobConf is compressedLength compressedLength CryptoUtils cryptoPadding jobConf decompressedLength CryptoUtils cryptoPadding jobConf compressedLength decompressedLength remaining mapId TaskAttemptID mapId LOG LOG debug mapId compressedLength decompressedLength mapOutput merger reserve mapId decompressedLength id ioe ioErrs increment scheduler reportLocalError ioe EMPTY_ATTEMPT_ID_ARRAY
is CryptoUtils wrapIfNecessary jobConf is compressedLength compressedLength CryptoUtils cryptoPadding jobConf decompressedLength CryptoUtils cryptoPadding jobConf compressedLength decompressedLength mapId TaskAttemptID mapId LOG LOG debug mapId compressedLength decompressedLength mapOutput merger reserve mapId decompressedLength id ioe ioErrs increment scheduler reportLocalError ioe EMPTY_ATTEMPT_ID_ARRAY mapOutput LOG info id
startTime Time monotonicNow lastTime startTime attempts connection setConnectTimeout unit attempts connection connect currentTime Time monotonicNow retryTime currentTime startTime leftTime connectionTimeout retryTime timeSinceLastIteration currentTime lastTime leftTime
TaskAttemptID maps Iterator TaskAttemptID iter maps iterator iter TaskAttemptID map iter next
mapTaskId Path mapOutputFileName localMapFiles get mapTaskId getOutputFile Path indexFileName mapOutputFileName suffix SpillRecord sr SpillRecord indexFileName job IndexRecord ir sr getIndex reduce compressedLength ir partLength decompressedLength ir rawLength compressedLength CryptoUtils cryptoPadding job decompressedLength CryptoUtils cryptoPadding job MapOutput K V mapOutput merger reserve mapTaskId decompressedLength id mapOutput
mapOutput inMemoryMapOutputs add mapOutput
mapOutput inMemoryMapOutputs add mapOutput LOG info mapOutput getSize inMemoryMapOutputs size commitMemory usedMemory commitMemory mapOutput getSize commitMemory
mapOutput inMemoryMergedMapOutputs add mapOutput
onDiskMapOutputs add CompressAwarePath outputPath writer getRawLength writer getCompressedLength writer e outputPath fs delete outputPath e writer writer close LOG info numMemDiskSegments inMemToDiskBytes inMemToDiskBytes memDiskSegments clear inMemToDiskBytes
e writer writer close LOG info numMemDiskSegments inMemToDiskBytes inMemToDiskBytes memDiskSegments clear inMemToDiskBytes LOG info numMemDiskSegments inMemToDiskBytes List Segment K V diskSegments ArrayList Segment K V onDiskBytes inMemToDiskBytes rawBytes inMemToDiskBytes CompressAwarePath onDisk onDiskMapOutputs toArray CompressAwarePath onDiskMapOutputs size CompressAwarePath file onDisk fileLength fs getFileStatus file getLen
writer writer close LOG info numMemDiskSegments inMemToDiskBytes inMemToDiskBytes memDiskSegments clear inMemToDiskBytes LOG info numMemDiskSegments inMemToDiskBytes List Segment K V diskSegments ArrayList Segment K V onDiskBytes inMemToDiskBytes rawBytes inMemToDiskBytes CompressAwarePath onDisk onDiskMapOutputs toArray CompressAwarePath onDiskMapOutputs size CompressAwarePath file onDisk fileLength fs getFileStatus file getLen onDiskBytes fileLength
event event u event addKnownMapOutput u getHost u getPort u toString event getTaskAttemptId maxMapRuntime Math max maxMapRuntime event getTaskRunTime event getTaskAttemptId
event event getTaskStatus u event addKnownMapOutput u getHost u getPort u toString event getTaskAttemptId maxMapRuntime Math max maxMapRuntime event getTaskRunTime event getTaskAttemptId LOG info event getTaskStatus event getTaskAttemptId event getTaskAttemptId
output commit finishedMaps mapIndex shuffledMapsCounter increment notifyAll copyMillis endMillis startMillis copyMillis copyMillis bytesPerMillis bytes copyMillis transferRate bytesPerMillis BYTES_PER_MILLIS_TO_MBS String individualProgress mapId mbpsFormat format transferRate copyTimeTracker add startMillis endMillis totalBytesShuffledTillNow bytes updateStatus individualProgress reduceShuffleBytes increment bytes lastProgressTime Time monotonicNow
Iterator TaskAttemptID itr list iterator List TaskAttemptID result ArrayList TaskAttemptID includedMaps totalSize list size itr TaskAttemptID id itr next id id result add id includedMaps itr TaskAttemptID id itr next id id host addKnownMap id
String printer ByteArrayOutputStream boas ByteArrayOutputStream PrintStream out PrintStream boas printer print out out close String outStr boas toString
report setUser jobInfo getUsername report setDiagnostics jobInfo getErrorInfo getTotalMaps report setMapProgress report setMapProgress getCompletedMaps getTotalMaps getTotalReduces report setReduceProgress report setReduceProgress getCompletedReduces getTotalReduces report setJobFile getConfFile toString String historyUrl historyUrl MRWebAppUtil getApplicationWebURLOnJHSWithScheme conf jobId getAppId
mkdir fc path fsp fc path fc mkdir path fsp FileStatus fsStatus fc getFileStatus path LOG info fsStatus getPermission toShort fsp toShort fsStatus getPermission toShort fsp toShort
LOG info List FileStatus timestampedDirList findTimestampedDirectories Collections sort timestampedDirList
List FileStatus timestampedDirList findTimestampedDirectories Collections sort timestampedDirList LOG info timestampedDirList size FileStatus fs timestampedDirList addDirectoryToSerialNumberIndex fs getPath maxCacheSize jobListCache maxSize prevCacheSize jobListCache size i timestampedDirList size i jobListCache i FileStatus fs timestampedDirList get i addDirectoryToJobListCache fs getPath currCacheSize jobListCache size currCacheSize prevCacheSize maxCacheSize LOG info currCacheSize maxCacheSize prevCacheSize currCacheSize loadedPercent maxCacheSize prevCacheSize maxCacheSize
LOG LOG debug fs getPath JobIndexInfo jobIndexInfo FileNameIndexUtils getIndexInfo fs getPath getName String confFileName JobHistoryUtils getIntermediateConfFileName jobIndexInfo getJobId String summaryFileName JobHistoryUtils getIntermediateSummaryFileName jobIndexInfo getJobId HistoryFileInfo fileInfo createHistoryFileInfo fs getPath Path fs getPath getParent confFileName Path fs getPath getParent summaryFileName jobIndexInfo HistoryFileInfo old jobListCache addIfAbsent fileInfo old old HistoryFileInfo found old fileInfo old cutoff System currentTimeMillis maxHistoryAge found cutoff found delete e LOG warn e
HistoryFileInfo fileInfo createHistoryFileInfo fs getPath Path fs getPath getParent confFileName Path fs getPath getParent summaryFileName jobIndexInfo HistoryFileInfo old jobListCache addIfAbsent fileInfo old old HistoryFileInfo found old fileInfo old cutoff System currentTimeMillis maxHistoryAge found cutoff found delete e LOG warn e LOG LOG debug found
state numKeys loadKeys state numTokens loadTokens state
Path storeRoot createStorageDir getConfig Options options Options options createIfMissing
HistoryServerState HistoryServerState state HistoryServerState numKeys loadTokenMasterKeys state
HistoryServerState HistoryServerState state HistoryServerState numKeys loadTokenMasterKeys state LOG info numKeys numTokens loadTokens state
Version loadedVersion loadVersion
amStartTimeEst System currentTimeMillis conf setClass NET_TOPOLOGY_NODE_SWITCH_MAPPING_IMPL_KEY MyResolver DNSToSwitchMapping RackResolver init conf MRApp app MRAppWithHistory numMaps numReduces getClass getName app submit conf Job job app getContext getAllJobs values iterator next JobId jobId job getID LOG info TypeConverter fromYarn jobId toString app waitForState job JobState SUCCEEDED app waitForState Service STATE STOPPED String jobhistoryDir JobHistoryUtils getHistoryIntermediateDoneDirForUser conf FileContext fc fc FileContext getFileContext conf
Assert assertTrue Long parseLong jobSummaryElements get Assert assertEquals numSuccessfulMaps Integer parseInt jobSummaryElements get Assert assertEquals numReduces Integer parseInt jobSummaryElements get Assert assertEquals System getProperty jobSummaryElements get Assert assertEquals jobSummaryElements get Assert assertEquals jobSummaryElements get JobHistory jobHistory JobHistory jobHistory init conf HistoryFileInfo fileInfo jobHistory getJobFileInfo jobId JobInfo jobInfo numFinishedMaps fileInfo Path historyFilePath fileInfo getHistoryFile FSDataInputStream in LOG info historyFilePath
app waitForState job JobState SUCCEEDED app waitForState Service STATE STOPPED JobHistory jobHistory JobHistory jobHistory init conf HistoryFileInfo fileInfo jobHistory getJobFileInfo jobId JobHistoryParser parser JobInfo jobInfo fileInfo Path historyFilePath fileInfo getHistoryFile FSDataInputStream in FileContext fc fc FileContext getFileContext conf in fc open fc makeQualified historyFilePath
app waitForState job JobState SUCCEEDED app waitForState Service STATE STOPPED jobHistory JobHistory jobHistory init conf HistoryFileInfo fileInfo jobHistory getJobFileInfo jobId JobHistoryParser parser JobInfo jobInfo fileInfo Path historyFilePath fileInfo getHistoryFile FSDataInputStream in FileContext fc fc FileContext getFileContext conf in fc open fc makeQualified historyFilePath
app waitForState job JobState FAILED app waitForState Service STATE STOPPED JobHistory jobHistory JobHistory jobHistory init conf HistoryFileInfo fileInfo jobHistory getJobFileInfo jobId JobHistoryParser parser JobInfo jobInfo fileInfo Path historyFilePath fileInfo getHistoryFile FSDataInputStream in FileContext fc fc FileContext getFileContext conf in fc open fc makeQualified historyFilePath
app waitForState job JobState KILLED app waitForState Service STATE STOPPED JobHistory jobHistory JobHistory jobHistory init conf HistoryFileInfo fileInfo jobHistory getJobFileInfo jobId JobHistoryParser parser JobInfo jobInfo fileInfo Path historyFilePath fileInfo getHistoryFile FSDataInputStream in FileContext fc fc FileContext getFileContext conf in fc open fc makeQualified historyFilePath
Path histPath Path getClass getClassLoader getResource getFile JobHistoryParser parser JobHistoryParser FileSystem getLocal Configuration histPath JobInfo jobInfo parser parse
Path histPath Path getClass getClassLoader getResource getFile JobHistoryParser parser JobHistoryParser FileSystem getLocal Configuration histPath JobInfo jobInfo parser parse
Path histPath Path getClass getClassLoader getResource getFile JobHistoryParser parser JobHistoryParser FileSystem getLocal Configuration histPath JobInfo jobInfo parser parse
application rm getApplicationReport appId application e2 IOException e2 application trackingUrl application getTrackingUrl InetSocketAddress serviceAddr application application application LOG info jobId checkAndGetHSProxy JobState NEW application application LOG debug
e2 IOException e2 application trackingUrl application getTrackingUrl InetSocketAddress serviceAddr application application getYarnApplicationState application LOG info jobId checkAndGetHSProxy JobState NEW application application LOG debug Thread sleep LOG debug application getYarnApplicationState application rm getApplicationReport appId
application getHost application getHost LOG debug Thread sleep LOG debug application getYarnApplicationState application rm getApplicationReport appId application getHost amAclDisabledStatusLogged LOG info jobId amAclDisabledStatusLogged getNotRunningJob application JobState RUNNING UserGroupInformation newUgi UserGroupInformation createRemoteUser UserGroupInformation getCurrentUser getUserName serviceAddr NetUtils createSocketAddrForHost application getHost application getRpcPort
application getHost amAclDisabledStatusLogged LOG info jobId amAclDisabledStatusLogged getNotRunningJob application JobState RUNNING UserGroupInformation newUgi UserGroupInformation createRemoteUser UserGroupInformation getCurrentUser getUserName serviceAddr NetUtils createSocketAddrForHost application getHost application getRpcPort UserGroupInformation org apache hadoop yarn api records Token clientToAMToken application getClientToAMToken Token ClientToAMTokenIdentifier token ConverterUtils convertFromYarn clientToAMToken serviceAddr newUgi addToken token LOG debug serviceAddr InetSocketAddress finalServiceAddr serviceAddr
amAclDisabledStatusLogged getNotRunningJob application JobState RUNNING UserGroupInformation newUgi UserGroupInformation createRemoteUser UserGroupInformation getCurrentUser getUserName serviceAddr NetUtils createSocketAddrForHost application getHost application getRpcPort UserGroupInformation org apache hadoop yarn api records Token clientToAMToken application getClientToAMToken Token ClientToAMTokenIdentifier token ConverterUtils convertFromYarn clientToAMToken serviceAddr newUgi addToken token LOG debug serviceAddr InetSocketAddress finalServiceAddr serviceAddr newUgi instantiateAMProxy finalServiceAddr
LOG debug serviceAddr InetSocketAddress finalServiceAddr serviceAddr realProxy instantiateAMProxy finalServiceAddr amAclDisabledStatusLogged LOG info jobId amAclDisabledStatusLogged getNotRunningJob JobState RUNNING realProxy LOG info serviceAddr
Method methodOb methodOb MRClientProtocol getMethod method argClass e YarnRuntimeException e e YarnRuntimeException e maxClientRetry conf getInt MRJobConfig MR_CLIENT_MAX_RETRIES MRJobConfig DEFAULT_MR_CLIENT_MAX_RETRIES IOException lastException maxClientRetry MRClientProtocol MRClientProxy MRClientProxy getProxy methodOb invoke MRClientProxy args e
MRClientProxy getProxy methodOb invoke MRClientProxy args e LOG debug jobId e getTargetException realProxy e IOException e getTargetException usingAMProxy maxClientRetry usingAMProxy set lastException IOException e getTargetException Thread sleep
String getStagingAreaDir String user UserGroupInformation getCurrentUser getShortUserName Path path MRApps getStagingAreaDir conf user
Map String LocalResource String jobSubmitDir Map String LocalResource localResources HashMap Path jobConfPath Path jobSubmitDir MRJobConfig JOB_CONF_FILE URL yarnUrlForJobSubmitDir URL fromPath defaultFileContext getDefaultFileSystem resolvePath defaultFileContext makeQualified Path jobSubmitDir
regex regex setTokenRenewerConf amContainer conf regex Collection String tagsFromConf jobConf getTrimmedStringCollection MRJobConfig JOB_TAGS ApplicationSubmissionContext appContext recordFactory newRecordInstance ApplicationSubmissionContext appContext setApplicationId applicationId appContext setQueue jobConf get JobContext QUEUE_NAME YarnConfiguration DEFAULT_QUEUE_NAME ReservationId reservationID reservationID ReservationId parseReservationId jobConf get JobContext RESERVATION_ID String errMsg jobConf get JobContext RESERVATION_ID applicationId LOG warn errMsg IOException errMsg reservationID appContext setReservationID reservationID
LOG warn MR_AM_RESOURCE_PREFIX resourceName resourceReq getValue resourceReq getUnits MRJobConfig MR_AM_VMEM_MB conf get MRJobConfig MR_AM_VMEM_MB MRJobConfig resourceName capability setVirtualCores UnitsConversionUtil convert resourceReq getUnits resourceReq getValue cpuVcoresSet conf get MRJobConfig MR_AM_CPU_VCORES LOG warn MR_AM_RESOURCE_PREFIX resourceName resourceReq getValue resourceReq getUnits MRJobConfig MR_AM_CPU_VCORES conf get MRJobConfig MR_AM_CPU_VCORES MRJobConfig MR_AM_VMEM_MB MR_AM_RESOURCE_PREFIX resourceName MRJobConfig MR_AM_CPU_VCORES MR_AM_RESOURCE_PREFIX resourceName ResourceInformation resourceInformation capability getResourceInformation resourceName resourceInformation setUnits resourceReq getUnits resourceInformation setValue resourceReq getValue capability setResourceInformation resourceName resourceInformation capability setMemorySize conf getInt MRJobConfig MR_AM_VMEM_MB MRJobConfig DEFAULT_MR_AM_VMEM_MB cpuVcoresSet capability setVirtualCores conf getInt MRJobConfig MR_AM_CPU_VCORES MRJobConfig DEFAULT_MR_AM_CPU_VCORES
Configuration copy Configuration copy clear count Map Entry String String map String key map getKey String val map getValue key regex copy set key val count copy write dob ByteBuffer appConf ByteBuffer wrap dob getData dob getLength LOG info regex count dob getLength LOG Map Entry String String itor copy itor Map Entry String String entry itor next
String klass String newProbName FPROB_NAME klass String newValue System getProperty newProbName conf get ALL_PROBABILITIES newValue newValue equals conf get newProbName conf set newProbName newValue ret conf getFloat newProbName conf getFloat ALL_PROBABILITIES DEFAULT_PROB
testType TEST_TYPE_READ args i testType TEST_TYPE_WRITE args i testType TEST_TYPE_CLEANUP args i isSequential args i nrFiles Integer parseInt args i args i fileSize Integer parseInt args i args i bufferSize Integer parseInt args i args i resFileName args i
testType TEST_TYPE_READ args i testType TEST_TYPE_WRITE args i testType TEST_TYPE_CLEANUP args i isSequential args i nrFiles Integer parseInt args i args i fileSize Integer parseInt args i args i bufferSize Integer parseInt args i args i resFileName args i
args i testType TEST_TYPE_WRITE args i testType TEST_TYPE_CLEANUP args i isSequential args i nrFiles Integer parseInt args i args i fileSize Integer parseInt args i args i bufferSize Integer parseInt args i args i resFileName args i LOG info nrFiles
sqrate String line line StringTokenizer tokens StringTokenizer line String attr tokens nextToken attr endsWith tasks Long parseLong tokens nextToken attr endsWith size Long parseLong tokens nextToken attr endsWith time Long parseLong tokens nextToken attr endsWith rate tokens nextToken attr endsWith sqrate tokens nextToken med rate tasks stdDev Math sqrt Math abs sqrate tasks med med String resultLines testType TEST_TYPE_WRITE testType TEST_TYPE_READ Date System currentTimeMillis tasks size MEGA size time MEGA med stdDev execTime PrintStream res PrintStream FileOutputStream File resFileName resultLines
args args System err println usage System exit i i args i args i rootName args i args i testType TEST_TYPE_CLEANUP args i bufferSize Integer parseInt args i args i resFileName args i args i viewStats LOG info rootName
i i i String name getFileName i Path controlFile Path INPUT_DIR name SequenceFile Writer writer writer SequenceFile createWriter fs fs getConf controlFile Text LongWritable CompressionType NONE String logFile jhLogFiles i getPath toString writer append Text logFile LongWritable e IOException e writer writer close writer IOException
start step jhLogFiles length NUM_CREATE_THREADS jhLogFiles length NUM_CREATE_THREADS FileCreateDaemon daemons FileCreateDaemon NUM_CREATE_THREADS numRunningThreads tIdx tIdx NUM_CREATE_THREADS start jhLogFiles length tIdx end Math min start step jhLogFiles length daemons tIdx FileCreateDaemon fs start end start step numRunningThreads tIdx tIdx numRunningThreads tIdx daemons tIdx start prevValue numRunningThreads prevValue
createControlFile fs jhLogDir LOG info jhLogDir FileCreateDaemon createControlFile fs jhLogDir
String TestType testType bufferSize DEFAULT_BUFFER_SIZE nrBytes MEGA String erasureCodePolicyName nrFiles skipSize String resFileName DEFAULT_RES_FILE_NAME String compressionClass String storagePolicy isSequential String version TestDFSIO getSimpleName
compressionClass args i args i nrFiles Integer parseInt args i args i args i nrBytes parseSize args i args i skipSize parseSize args i args i bufferSize Integer parseInt args i args i resFileName args i args i storagePolicy args i args i erasureCodePolicyName args i
compressionClass args i args i nrFiles Integer parseInt args i args i args i nrBytes parseSize args i args i skipSize parseSize args i args i bufferSize Integer parseInt args i args i resFileName args i args i storagePolicy args i args i erasureCodePolicyName args i
args i nrFiles Integer parseInt args i args i args i nrBytes parseSize args i args i skipSize parseSize args i args i bufferSize Integer parseInt args i args i resFileName args i args i storagePolicy args i args i erasureCodePolicyName args i
nrFiles Integer parseInt args i args i args i nrBytes parseSize args i args i skipSize parseSize args i args i bufferSize Integer parseInt args i args i resFileName args i args i storagePolicy args i args i erasureCodePolicyName args i System err println args i
isValid ec erasureCodePolicyName ec getPolicy getName isValid isValid System out println erasureCodePolicyName System out println ec System out println ec getPolicy getName System out println config set ERASURE_CODE_POLICY_NAME_KEY erasureCodePolicyName
Collection BlockStoragePolicy storagePolicies DistributedFileSystem fs getAllStoragePolicies BlockStoragePolicy policy storagePolicies policy getName storagePolicy isValid e IOException e isValid System out println storagePolicy System out println BlockStoragePolicy policy storagePolicies System out println policy getName config set STORAGE_POLICY_NAME_KEY storagePolicy
fs path String erasureCodePolicyName getConf get ERASURE_CODE_POLICY_NAME_KEY fs mkdirs path Collection ErasureCodingPolicyInfo list DistributedFileSystem fs getAllErasureCodingPolicies ErasureCodingPolicyInfo info list ErasureCodingPolicy ec info getPolicy erasureCodePolicyName ec getName DistributedFileSystem fs setErasureCodingPolicy path ec getName
size time rate sqrate in in close lines lines close med rate tasks stdDev Math sqrt Math abs sqrate tasks med med DecimalFormat df DecimalFormat String resultLines testType Date System currentTimeMillis tasks df format toMB size df format toMB size msToSecs time df format med df format stdDev df format msToSecs execTime PrintStream res res PrintStream FileOutputStream File resFileName resultLines
seed FileSystem fs FileSystem get conf seed seed Random nextLong
System exit i i args i args i files Integer parseInt args i args i megaBytes Integer parseInt args i args i noRead args i noWrite args i noSeek args i fastCheck LOG info seed
i i args i args i files Integer parseInt args i args i megaBytes Integer parseInt args i args i noRead args i noWrite args i noSeek args i fastCheck LOG info seed LOG info files
port Configuration conf Configuration MiniDFSCluster cluster cluster MiniDFSCluster Builder conf nameNodePort port numDataNodes build URI uri cluster getFileSystem getUri
timeTaken bytesAppended DataWriter writer DataWriter getRandom LOG info fn Helper toByteInfo appendSize startTime Timer now os fs append fn timeTaken Timer elapsed startTime GenerateOutput stats writer writeSegment appendSize os timeTaken stats getTimeTaken bytesAppended stats getBytesWritten startTime Timer now os close os timeTaken Timer elapsed startTime out add OperationOutput OutputType LONG getType ReportWriter BYTES_WRITTEN bytesAppended out add OperationOutput OutputType LONG getType ReportWriter OK_TIME_TAKEN timeTaken
cfg LOG info cfg getBaseDirectory LOG info cfg getDataPath LOG info cfg getOutputPath LOG info cfg getResultFile LOG info cfg getQueueName LOG info cfg shouldExitOnFirstError String duration cfg getDurationMilliseconds duration duration cfg getDurationMilliseconds LOG info duration LOG info cfg getMapAmount
LOG info cfg getBaseDirectory LOG info cfg getDataPath LOG info cfg getOutputPath LOG info cfg getResultFile LOG info cfg getQueueName LOG info cfg shouldExitOnFirstError String duration cfg getDurationMilliseconds duration duration cfg getDurationMilliseconds LOG info duration LOG info cfg getMapAmount LOG info cfg getReducerAmount
LOG info cfg getBaseDirectory LOG info cfg getDataPath LOG info cfg getOutputPath LOG info cfg getResultFile LOG info cfg getQueueName LOG info cfg shouldExitOnFirstError String duration cfg getDurationMilliseconds duration duration cfg getDurationMilliseconds LOG info duration LOG info cfg getMapAmount LOG info cfg getReducerAmount LOG info cfg getOpCount
LOG info cfg getBaseDirectory LOG info cfg getDataPath LOG info cfg getOutputPath LOG info cfg getResultFile LOG info cfg getQueueName LOG info cfg shouldExitOnFirstError String duration cfg getDurationMilliseconds duration duration cfg getDurationMilliseconds LOG info duration LOG info cfg getMapAmount LOG info cfg getReducerAmount LOG info cfg getOpCount
String duration cfg getDurationMilliseconds duration duration cfg getDurationMilliseconds LOG info duration LOG info cfg getMapAmount LOG info cfg getReducerAmount LOG info cfg getOpCount LOG info cfg getTotalFiles LOG info cfg getDirSize String read cfg read
LOG info duration LOG info cfg getMapAmount LOG info cfg getReducerAmount LOG info cfg getOpCount LOG info cfg getTotalFiles LOG info cfg getDirSize String read cfg read read cfg getReadSize LOG info read String write cfg write
LOG info cfg getTotalFiles LOG info cfg getDirSize String read cfg read read cfg getReadSize LOG info read String write cfg write write cfg getWriteSize LOG info write String append
cfg read read cfg getReadSize LOG info read String write cfg write write cfg getWriteSize LOG info write String append cfg append
read cfg getReadSize LOG info read String write cfg write write cfg getWriteSize LOG info write String append cfg append append cfg getAppendSize LOG info append
read cfg getReadSize LOG info read String write cfg write write cfg getWriteSize LOG info write String append cfg append append cfg getAppendSize LOG info append String bsize
FSDataOutputStream os Path fn getCreateFile Range Long writeSizeRange getConfig getWriteSize writeSize blockSize determineBlockSize replicationAmount determineReplication getConfig writeSizeRange getConfig getBlockSize writeSize Range betweenPositive getRandom writeSizeRange bytesWritten timeTaken bufSize getBufferSize overWrite DataWriter writer DataWriter getRandom
timeTaken bufSize getBufferSize overWrite DataWriter writer DataWriter getRandom LOG info fn Helper toByteInfo writeSize Helper toByteInfo blockSize replicationAmount startTime Timer now os fs create fn overWrite bufSize replicationAmount blockSize timeTaken Timer elapsed startTime GenerateOutput stats writer writeSegment writeSize os bytesWritten stats getBytesWritten timeTaken stats getTimeTaken startTime Timer now os close os timeTaken Timer elapsed startTime
List OperationOutput run fs List OperationOutput out run fs Path fn getDeleteFile timeTaken deleteStatus startTime Timer now deleteStatus fs delete fn timeTaken Timer elapsed startTime deleteStatus out add OperationOutput OutputType LONG getType ReportWriter FAILURES LOG info fn out add OperationOutput OutputType LONG getType ReportWriter OK_TIME_TAKEN timeTaken out add OperationOutput OutputType LONG getType ReportWriter SUCCESSES
Range Long readSizeRange getConfig getReadSize readSize String readStrAm getConfig readSize Long MAX_VALUE readStrAm readSize Range betweenPositive getRandom readSizeRange readStrAm Helper toByteInfo readSize timeTaken chunkSame chunkDiff bytesRead startTime DataVerifier vf DataVerifier
startTime Timer now is fs open fn timeTaken Timer elapsed startTime VerifyOutput vo vf verifyFile readSize is timeTaken vo getReadTime chunkSame vo getChunksSame chunkDiff vo getChunksDifferent bytesRead vo getBytesRead startTime Timer now is close is timeTaken Timer elapsed startTime out add OperationOutput OutputType LONG getType ReportWriter OK_TIME_TAKEN timeTaken out add OperationOutput OutputType LONG getType ReportWriter BYTES_READ bytesRead out add OperationOutput OutputType LONG getType ReportWriter SUCCESSES
r msg r setStatus msg
r msg r setStatus msg
parsedOpts argHolder parse parsedOpts parsedOpts outputHelp e LOG error e LOG info Helper stringifyArray args ConfigExtractor config ConfigMerger cfgMerger ConfigMerger Configuration cfg cfgMerger getMerged parsedOpts Configuration base cfg config ConfigExtractor cfg e
LOG info Helper stringifyArray args ConfigExtractor config ConfigMerger cfgMerger ConfigMerger Configuration cfg cfgMerger getMerged parsedOpts Configuration base cfg config ConfigExtractor cfg e LOG error e config LOG error LOG info
e LOG error e config LOG error LOG info ConfigExtractor dumpOptions config e LOG error e jobOk LOG info
config LOG error LOG info ConfigExtractor dumpOptions config e LOG error e jobOk LOG info runJob config jobOk e
e LOG error e jobOk LOG info runJob config jobOk e LOG error e jobOk LOG info writeReport config e
cfg Path dn cfg getOutputPath
List OperationOutput opList splitTypes get op opList opList ArrayList OperationOutput opList add data splitTypes put op opList noOperations add data IOException line fileReader close fileReader File resFile cfg getResultFile resFile File cfg getResultFile resFile
cfg Path base cfg getBaseDirectory base
byteAm File fn getTestFile DataWriter writer DataWriter rnd FileOutputStream fs FileOutputStream fn GenerateOutput ostat writer writeSegment byteAm fs
byteAm File fn getTestFile DataWriter writer DataWriter rnd FileOutputStream fs FileOutputStream fn GenerateOutput ostat writer writeSegment byteAm fs LOG info ostat toString fs close assertTrue ostat getBytesWritten byteAm DataVerifier vf DataVerifier FileInputStream fin FileInputStream fn VerifyOutput vfout vf verifyFile byteAm DataInputStream fin
waitOnTruncate getConfig shouldWaitOnTruncate currentSize fs getFileStatus fn getLen Range Long truncateSizeRange getConfig getTruncateSize getConfig truncateSizeRange getConfig getBlockSize truncateSize Math max currentSize Range betweenPositive getRandom truncateSizeRange timeTaken LOG info fn Helper toByteInfo truncateSize startTime Timer now completed fs truncate fn truncateSize completed waitOnTruncate waitForRecovery fs fn truncateSize timeTaken Timer elapsed startTime out add OperationOutput OutputType LONG getType ReportWriter BYTES_WRITTEN out add OperationOutput OutputType LONG getType ReportWriter OK_TIME_TAKEN timeTaken out add OperationOutput OutputType LONG getType ReportWriter SUCCESSES
cfg operations TreeMap OperationType OperationInfo Map OperationType OperationData opinfo cfg getOperations totalAm cfg getOpCount opsLeft totalAm NumberFormat formatter Formatter getPercentFormatter OperationType type opinfo OperationData opData opinfo get type OperationInfo info OperationInfo info distribution opData getDistribution amLeft determineHowMany totalAm opData type opsLeft amLeft
opsLeft amLeft LOG info type name amLeft totalAm formatter format opData getPercent info amountLeft amLeft Operation op factory getOperation type op fn Operation op OperationInfo opInfo operations get type opInfo opInfo amountLeft Operation op info operation ObserveableOp op fn operations put type info opsLeft
args i checkArgs i args length numberOfFiles Long parseLong args i args i checkArgs i args length replicationFactorPerFile Short parseShort args i args i checkArgs i args length baseDir args i args i checkArgs i args length readFileAfterOpen Boolean parseBoolean args i args i displayUsage isHelpMessage
checkArgs i args length numberOfFiles Long parseLong args i args i checkArgs i args length replicationFactorPerFile Short parseShort args i args i checkArgs i args length baseDir args i args i checkArgs i args length readFileAfterOpen Boolean parseBoolean args i args i displayUsage isHelpMessage LOG info
numberOfFiles Long parseLong args i args i checkArgs i args length replicationFactorPerFile Short parseShort args i args i checkArgs i args length baseDir args i args i checkArgs i args length readFileAfterOpen Boolean parseBoolean args i args i displayUsage isHelpMessage LOG info LOG info operation
args i checkArgs i args length replicationFactorPerFile Short parseShort args i args i checkArgs i args length baseDir args i args i checkArgs i args length readFileAfterOpen Boolean parseBoolean args i args i displayUsage isHelpMessage LOG info LOG info operation LOG info sdf format Date startTime
Path tempDir Path dir fs delete dir FileInputFormat setInputPaths job dir fs mkdirs tempDir LongWritable tkey LongWritable Text tval Text SequenceFile Writer writer SequenceFile createWriter fs job file LongWritable Text compressionType DefaultCodec tkey set tval set writer append tkey tval writer close fileLength fs getFileStatus file getLen
conf fs Path dir fileSizeInMB IOException fs dir FileStatus list fs listStatus dir list IOException dir Path file Path dir SequenceFile Writer writer SequenceFile createWriter fs conf file BytesWritable BytesWritable CompressionType NONE numBytesToWrite fileSizeInMB minKeySize conf getInt MIN_KEY keySizeRange conf getInt MAX_KEY minKeySize minValueSize conf getInt MIN_VALUE valueSizeRange conf getInt MAX_VALUE minValueSize BytesWritable randomKey BytesWritable BytesWritable randomValue BytesWritable
ArrayList Long JobConf masterJobConf Random rand Random ArrayList Long execTimes ArrayList Long JobConf jobConf JobConf masterJobConf jobConf setJar masterJobConf getJar FileOutputFormat setOutputPath jobConf Path OUTPUT_DIR rand nextInt
conf jobClass args t run Class jobClassObj conf getClassByName jobClass status ToolRunner run conf Tool jobClassObj newInstance args checkJobExitStatus status jobClass LOG error jobClass System exit t setDaemon t start JobStatus jobs jobs
status ToolRunner run conf Tool jobClassObj newInstance args checkJobExitStatus status jobClass LOG error jobClass System exit t setDaemon t start JobStatus jobs jobs jc length LOG info jobClass Thread sleep JobID jobId jobs jobs length getJobID RunningJob rJob jc getJob jobId rJob
LOG error jobClass System exit t setDaemon t start JobStatus jobs jobs jc length LOG info jobClass Thread sleep JobID jobId jobs jobs length getJobID RunningJob rJob jc getJob jobId rJob LOG error rJob getJobID System exit
mapRecs input size mapperBadRecords size assertEquals counters findCounter TaskCounter MAP_INPUT_RECORDS getCounter mapRecs assertEquals counters findCounter TaskCounter MAP_OUTPUT_RECORDS getCounter mapRecs redRecs mapRecs redBadRecords size assertEquals counters findCounter TaskCounter REDUCE_SKIPPED_RECORDS getCounter redBadRecords size assertEquals counters findCounter TaskCounter REDUCE_SKIPPED_GROUPS getCounter redBadRecords size assertEquals counters findCounter TaskCounter REDUCE_INPUT_GROUPS getCounter redRecs assertEquals counters findCounter TaskCounter REDUCE_INPUT_RECORDS getCounter redRecs assertEquals counters findCounter TaskCounter REDUCE_OUTPUT_RECORDS getCounter redRecs Path skipDir SkipBadRecords getSkipOutputPath conf assertNotNull skipDir Path skips FileUtil stat2Paths getFileSystem listStatus skipDir List String mapSkipped ArrayList String List String redSkipped ArrayList String Path skips
assertEquals counters findCounter TaskCounter REDUCE_INPUT_RECORDS getCounter redRecs assertEquals counters findCounter TaskCounter REDUCE_OUTPUT_RECORDS getCounter redRecs Path skipDir SkipBadRecords getSkipOutputPath conf assertNotNull skipDir Path skips FileUtil stat2Paths getFileSystem listStatus skipDir List String mapSkipped ArrayList String List String redSkipped ArrayList String Path skipPath skips LOG info skipPath SequenceFile Reader reader SequenceFile Reader getFileSystem skipPath conf Object key ReflectionUtils newInstance reader getKeyClass conf Object value ReflectionUtils newInstance reader getValueClass conf key reader next key key value reader getCurrentValue value
Object value ReflectionUtils newInstance reader getValueClass conf key reader next key key value reader getCurrentValue value LOG debug key value toString redSkipped add value toString mapSkipped add value toString key reader next key reader close assertTrue mapSkipped containsAll mapperBadRecords assertTrue redSkipped containsAll redBadRecords Path outputFiles FileUtil stat2Paths getFileSystem listStatus getOutputDir Utils OutputFileUtils OutputFilesFilter List String mapperOutput getProcessed input mapperBadRecords
key value reader getCurrentValue value LOG debug key value toString redSkipped add value toString mapSkipped add value toString key reader next key reader close assertTrue mapSkipped containsAll mapperBadRecords assertTrue redSkipped containsAll redBadRecords Path outputFiles FileUtil stat2Paths getFileSystem listStatus getOutputDir Utils OutputFileUtils OutputFilesFilter List String mapperOutput getProcessed input mapperBadRecords LOG debug mapperOutput size List String reducerOutput getProcessed mapperOutput redBadRecords
org apache hadoop mapreduce counters Iterator org apache hadoop mapreduce CounterGroup it counters iterator it org apache hadoop mapreduce CounterGroup group it next
JobConf job JobConf conf Reporter reporter Reporter NULL Random random Random seed random nextLong
Reporter reporter Reporter NULL Random random Random seed random nextLong LOG info seed random setSeed seed localFs delete workDir FileInputFormat setInputPaths job workDir length numFiles createFiles length numFiles random InputFormat IntWritable BytesWritable format CombineSequenceFileInputFormat IntWritable BytesWritable IntWritable key IntWritable BytesWritable value BytesWritable numSplits random nextInt length SequenceFile SYNC_INTERVAL
seed random nextLong LOG info seed random setSeed seed localFs delete workDir FileInputFormat setInputPaths job workDir length numFiles createFiles length numFiles random InputFormat IntWritable BytesWritable format CombineSequenceFileInputFormat IntWritable BytesWritable IntWritable key IntWritable BytesWritable value BytesWritable numSplits random nextInt length SequenceFile SYNC_INTERVAL LOG info numSplits InputSplit splits format getSplits job numSplits
JobConf job JobConf defaultConf Random random Random seed random nextLong
JobConf job JobConf defaultConf Random random Random seed random nextLong LOG info seed random setSeed seed localFs delete workDir FileInputFormat setInputPaths job workDir length numFiles createFiles length numFiles random CombineTextInputFormat format CombineTextInputFormat LongWritable key LongWritable Text value Text numSplits random nextInt length
seed random nextLong LOG info seed random setSeed seed localFs delete workDir FileInputFormat setInputPaths job workDir length numFiles createFiles length numFiles random CombineTextInputFormat format CombineTextInputFormat LongWritable key LongWritable Text value Text numSplits random nextInt length LOG info numSplits InputSplit splits format getSplits job numSplits
length numFiles createFiles length numFiles random CombineTextInputFormat format CombineTextInputFormat LongWritable key LongWritable Text value Text numSplits random nextInt length LOG info numSplits InputSplit splits format getSplits job numSplits LOG info splits length assertEquals splits length InputSplit split splits assertEquals CombineFileSplit split getClass BitSet bits BitSet length
numSplits random nextInt length LOG info numSplits InputSplit splits format getSplits job numSplits LOG info splits length assertEquals splits length InputSplit split splits assertEquals CombineFileSplit split getClass BitSet bits BitSet length LOG debug split RecordReader LongWritable Text reader format getRecordReader split job voidReporter count reader value v Integer parseInt value toString
localFs delete workDir Path file Path workDir String createFile file JobConf job JobConf defaultConf FileInputFormat setInputPaths job workDir FixedLengthInputFormat format FixedLengthInputFormat format configure job InputSplit splits format getSplits job exceptionThrown InputSplit split splits RecordReader LongWritable BytesWritable reader format getRecordReader split job voidReporter exceptionThrown
localFs delete workDir Path file Path workDir String createFile file JobConf job JobConf defaultConf FileInputFormat setInputPaths job workDir FixedLengthInputFormat format FixedLengthInputFormat format setRecordLength job format configure job InputSplit splits format getSplits job exceptionThrown InputSplit split splits RecordReader LongWritable BytesWritable reader format getRecordReader split job voidReporter exceptionThrown
localFs delete workDir Path file Path workDir String createFile file JobConf job JobConf defaultConf FileInputFormat setInputPaths job workDir FixedLengthInputFormat format FixedLengthInputFormat format setRecordLength job format configure job InputSplit splits format getSplits job exceptionThrown InputSplit split splits RecordReader LongWritable BytesWritable reader format getRecordReader split job voidReporter exceptionThrown
Path file Path workDir fileName toString seed Random nextInt LOG info seed Random random Random seed MAX_TESTS LongWritable key LongWritable BytesWritable value BytesWritable MAX_TESTS LOG info totalRecords random nextInt totalRecords recordLength random nextInt recordLength
fileSize totalRecords recordLength LOG info totalRecords recordLength JobConf job JobConf defaultConf codec ReflectionUtils setConf codec job ArrayList String recordList createFile file codec recordLength totalRecords assertTrue localFs exists file FixedLengthInputFormat setRecordLength job recordLength numSplits numSplits fileSize Math max Math floor recordLength numSplits fileSize fileSize random nextInt fileSize
JobConf job JobConf defaultConf format setRecordLength job FileInputFormat setInputPaths job workDir codec ReflectionUtils setConf codec job format configure job writeFile localFs Path workDir fileName toString codec InputSplit splits format getSplits job codec assertEquals splits length exceptionThrown InputSplit split splits List String results readSplit format split job
committer JobConf jc mr createJobConf Path outDir getNewOutputDir configureJob jc outDir jc setOutputCommitter committer JobClient jobClient JobClient jc RunningJob job jobClient submitJob jc JobID id job getID job waitForCompletion
JobConf job JobConf Path file Path workDir Reporter reporter Reporter NULL seed Random nextInt
JobConf job JobConf Path file Path workDir Reporter reporter Reporter NULL seed Random nextInt LOG info seed Random random Random seed localFs delete workDir FileInputFormat setInputPaths job workDir random nextInt
length length MAX_LENGTH length random nextInt MAX_LENGTH LOG debug length Writer writer OutputStreamWriter localFs create file i i length i writer write Integer toString i writer write writer write Integer toString i writer write writer close KeyValueTextInputFormat format KeyValueTextInputFormat format configure job i i i numSplits random nextInt MAX_LENGTH
Writer writer OutputStreamWriter localFs create file i i i writer write Integer toString i writer write writer write Integer toString i writer write writer close KeyValueTextInputFormat format KeyValueTextInputFormat format configure job i i i numSplits random nextInt MAX_LENGTH LOG debug numSplits InputSplit splits format getSplits job numSplits
writer write Integer toString i writer write writer write Integer toString i writer write writer close KeyValueTextInputFormat format KeyValueTextInputFormat format configure job i i i numSplits random nextInt MAX_LENGTH LOG debug numSplits InputSplit splits format getSplits job numSplits LOG debug splits length BitSet bits BitSet length splits length
assertEquals KeyValueLineRecordReader readerClass Text key reader createKey Class keyClass key getClass Text value reader createValue Class valueClass value getClass assertEquals Text keyClass assertEquals Text valueClass count reader key value v Integer parseInt value toString LOG debug v bits get v LOG warn v j reader getPos assertFalse bits get v
entityFile String String BufferedReader reader String strLine reader BufferedReader FileReader entityFile idPrefix strLine reader strLine trim org apache hadoop yarn api records timelineservice TimelineEntity entity FileSystemTimelineReaderImpl getTimelineRecordFromJSON strLine trim org apache hadoop yarn api records timelineservice TimelineEntity
dfs MiniDFSCluster Builder conf build fileSys dfs getFileSystem
Path fs Path dir Path System getProperty Path multiFileDir Path dir fs delete multiFileDir fs mkdirs multiFileDir
Path fs numFiles numBytes Path dir Path System getProperty Path multiFileDir Path dir fs delete multiFileDir fs mkdirs multiFileDir LOG info numFiles multiFileDir i i numFiles i Path path Path multiFileDir i FSDataOutputStream out fs create path numBytes numBytes rand nextInt MAX_BYTES numBytes out write rand nextInt out close LOG
LOG info LOG info MAX_SPLIT_COUNT LOG info SPLIT_COUNT_INCR LOG info MAX_BYTES LOG info MAX_NUM_FILES LOG info NUM_FILES_INCR MultiFileInputFormat Text Text format DummyMultiFileInputFormat FileSystem fs FileSystem getLocal job numFiles numFiles MAX_NUM_FILES numFiles NUM_FILES_INCR NUM_FILES_INCR Path dir initFiles fs numFiles BitSet bits BitSet numFiles MAX_SPLIT_COUNT SPLIT_COUNT_INCR
LOG info SequenceFileInputFilter setFilterClass job SequenceFileInputFilter RegexFilter SequenceFileInputFilter RegexFilter setPattern job fs delete inDir
LOG info SequenceFileInputFilter setFilterClass job SequenceFileInputFilter PercentFilter SequenceFileInputFilter PercentFilter setFrequency job fs delete inDir
LOG info SequenceFileInputFilter setFilterClass job SequenceFileInputFilter PercentFilter SequenceFileInputFilter PercentFilter setFrequency job fs delete inDir length length length LOG info length createSequenceFile length count countRecords
LOG info SequenceFileInputFilter setFilterClass job SequenceFileInputFilter MD5Filter SequenceFileInputFilter MD5Filter setFrequency job fs delete inDir
assertEquals sr getIndicesCount sr add SortedRanges Range assertEquals sr getIndicesCount sr add SortedRanges Range assertEquals sr getIndicesCount sr add Range assertEquals sr getIndicesCount sr add Range assertEquals sr getIndicesCount sr add Range sr add Range sr add Range assertEquals sr getIndicesCount sr add Range assertEquals sr getIndicesCount
assertEquals sr getIndicesCount sr remove SortedRanges Range assertEquals sr getIndicesCount sr remove SortedRanges Range assertEquals sr getIndicesCount sr remove SortedRanges Range assertEquals sr getIndicesCount sr add Range assertEquals sr getIndicesCount sr add Range assertEquals sr getIndicesCount sr remove SortedRanges Range assertEquals sr getIndicesCount sr remove SortedRanges Range assertEquals sr getIndicesCount
conf setOutputKeyClass LongWritable conf setOutputValueClass Text conf setMapperClass IdentityMapper conf setReducerClass IdentityReducer FileInputFormat setInputPaths conf inDir FileOutputFormat setOutputPath conf outDir conf setNumMapTasks numMaps conf setNumReduceTasks numReduces RunningJob runningJob JobClient runJob conf assertTrue runningJob isComplete assertTrue runningJob isSuccessful assertTrue fs exists Path OUTPUT_FILENAME fail
JobConf job JobConf defaultConf Path file Path workDir Reporter reporter Reporter NULL seed Random nextInt
JobConf job JobConf defaultConf Path file Path workDir Reporter reporter Reporter NULL seed Random nextInt LOG info seed Random random Random seed localFs delete workDir FileInputFormat setInputPaths job workDir random nextInt
length length MAX_LENGTH length random nextInt MAX_LENGTH LOG debug length Writer writer OutputStreamWriter localFs create file i i length i writer write Integer toString i writer write writer close TextInputFormat format TextInputFormat format configure job LongWritable key LongWritable Text value Text i i i numSplits random nextInt MAX_LENGTH
Writer writer OutputStreamWriter localFs create file i i i writer write Integer toString i writer write writer close TextInputFormat format TextInputFormat format configure job LongWritable key LongWritable Text value Text i i i numSplits random nextInt MAX_LENGTH LOG debug numSplits InputSplit splits format getSplits job numSplits
length assertEquals splits length assertEquals splits getLength BitSet bits BitSet length j j splits length j LOG debug j splits j RecordReader LongWritable Text reader format getRecordReader splits j job reporter count reader value v Integer parseInt value toString LOG debug v bits get v LOG warn v j reader getPos assertFalse bits get v
Path file Path workDir codec getDefaultExtension FileSystem localFs FileSystem getLocal conf localFs delete workDir FileInputFormat setInputPaths conf workDir length LOG info length Writer writer OutputStreamWriter codec createOutputStream localFs create file i i length i writer write Integer toString i writer write writer close TextInputFormat format TextInputFormat
conf setLong splitpos LongWritable key LongWritable Text value Text InputSplit splits format getSplits conf LOG info splits length BitSet bits BitSet length j j splits length j LOG debug j splits j RecordReader LongWritable Text reader format getRecordReader splits j conf Reporter NULL counter reader key value v Integer parseInt value toString LOG debug v bits v
Text value Text InputSplit splits format getSplits conf LOG info splits length BitSet bits BitSet length j j splits length j LOG debug j splits j RecordReader LongWritable Text reader format getRecordReader splits j conf Reporter NULL counter reader value v Integer parseInt value toString LOG debug v bits get v LOG warn v j reader getPos assertFalse bits get v
length numSplits file codec conf LOG info length Writer writer OutputStreamWriter codec createOutputStream localFs create file i i length i writer write Integer toString i writer write writer close TextInputFormat format TextInputFormat format configure conf LongWritable key LongWritable Text value Text LOG info numSplits InputSplit splits format getSplits conf numSplits
i i length i writer write Integer toString i writer write writer close TextInputFormat format TextInputFormat format configure conf LongWritable key LongWritable Text value Text LOG info numSplits InputSplit splits format getSplits conf numSplits LOG info splits length BitSet bits BitSet length splits length
LOG info numSplits InputSplit splits format getSplits conf numSplits LOG info splits length BitSet bits BitSet length j j splits length j LOG debug j splits j RecordReader LongWritable Text reader format getRecordReader splits j conf Reporter NULL counter reader value v Integer parseInt value toString LOG debug v bits get v LOG warn v j reader getPos assertFalse bits get v
LOG info splits length BitSet bits BitSet length j j splits length j LOG debug j splits j RecordReader LongWritable Text reader format getRecordReader splits j conf Reporter NULL counter reader value v Integer parseInt value toString LOG debug v bits get v LOG warn v j reader getPos assertFalse bits get v bits set v counter
when resourceMgrDelegate submitApplication any ApplicationSubmissionContext thenReturn appId ApplicationReport report mock ApplicationReport when report getApplicationId thenReturn appId when report getDiagnostics thenReturn failString when report getYarnApplicationState thenReturn YarnApplicationState FAILED when resourceMgrDelegate getApplicationReport appId thenReturn report Credentials credentials Credentials File jobxml File testWorkDir OutputStream out FileOutputStream jobxml conf writeXml out out close yarnRunner submitJob jobId testWorkDir getAbsolutePath toString credentials
job setOutputFormat SequenceFileOutputFormat job setMapperClass Map job setReducerClass IdentityReducer job setOutputKeyClass BytesWritable job setOutputValueClass BytesWritable JobClient client JobClient job ClusterStatus cluster client getClusterStatus totalDataSize dataSizePerMap numMapsPerHost cluster getTaskTrackers job set String valueOf dataSizePerMap job setNumReduceTasks job setNumMapTasks numMapsPerHost cluster getTaskTrackers FileOutputFormat setOutputPath job INPUT_DIR FileSystem fs FileSystem get job fs delete BASE_DIR LOG info
job setMapperClass Map job setReducerClass IdentityReducer job setOutputKeyClass BytesWritable job setOutputValueClass BytesWritable JobClient client JobClient job ClusterStatus cluster client getClusterStatus totalDataSize dataSizePerMap numMapsPerHost cluster getTaskTrackers job set String valueOf dataSizePerMap job setNumReduceTasks job setNumMapTasks numMapsPerHost cluster getTaskTrackers FileOutputFormat setOutputPath job INPUT_DIR FileSystem fs FileSystem get job fs delete BASE_DIR LOG info LOG info totalDataSize
job setOutputKeyClass BytesWritable job setOutputValueClass BytesWritable JobClient client JobClient job ClusterStatus cluster client getClusterStatus totalDataSize dataSizePerMap numMapsPerHost cluster getTaskTrackers job set String valueOf dataSizePerMap job setNumReduceTasks job setNumMapTasks numMapsPerHost cluster getTaskTrackers FileOutputFormat setOutputPath job INPUT_DIR FileSystem fs FileSystem get job fs delete BASE_DIR LOG info LOG info totalDataSize LOG info dataSizePerMap LOG info numSpillsPerMap
job setOutputValueClass BytesWritable JobClient client JobClient job ClusterStatus cluster client getClusterStatus totalDataSize dataSizePerMap numMapsPerHost cluster getTaskTrackers job set String valueOf dataSizePerMap job setNumReduceTasks job setNumMapTasks numMapsPerHost cluster getTaskTrackers FileOutputFormat setOutputPath job INPUT_DIR FileSystem fs FileSystem get job fs delete BASE_DIR LOG info LOG info totalDataSize LOG info dataSizePerMap LOG info numSpillsPerMap LOG info numMapsPerHost
ClusterStatus cluster client getClusterStatus job setNumMapTasks numMapsPerHost cluster getTaskTrackers job setNumReduceTasks ioSortMb Math ceil FACTOR dataSizePerMap job set JobContext IO_SORT_MB String valueOf ioSortMb fs FileSystem get job LOG info startTime System currentTimeMillis JobClient runJob job endTime System currentTimeMillis LOG info String valueOf endTime startTime fs delete OUTPUT_DIR JobConf spilledJob JobConf job ThreadedMapBenchmark ioSortMb Math ceil FACTOR Math ceil dataSizePerMap numSpillsPerMap spilledJob set JobContext IO_SORT_MB String valueOf ioSortMb
LOG info context getTaskAttemptID getTaskID LOG info context getTaskAttemptID getTaskID jobs size job jobs String jobIdStr job getJobId LOG info jobIdStr JobId jobId TypeConverter toYarn JobID forName jobIdStr ApplicationId appId jobId getAppId Path historyFilePath job getJobHistoryFilePath Path confFilePath job getJobConfFilePath historyFilePath confFilePath JobInfo jobInfo parser parseHistoryFile historyFilePath Configuration jobConf parser parseConfiguration confFilePath
LOG info context getTaskAttemptID getTaskID jobs size job jobs String jobIdStr job getJobId LOG info jobIdStr JobId jobId TypeConverter toYarn JobID forName jobIdStr ApplicationId appId jobId getAppId Path historyFilePath job getJobHistoryFilePath Path confFilePath job getJobConfFilePath historyFilePath confFilePath JobInfo jobInfo parser parseHistoryFile historyFilePath Configuration jobConf parser parseConfiguration confFilePath LOG info jobIdStr totalTime
totalTime Set TimelineEntity entitySet converter createTimelineEntities jobInfo jobConf LOG info jobIdStr UserGroupInformation ugi UserGroupInformation getCurrentUser startWrite System nanoTime entitySet ugi entitySet ugi e context getCounter PerfCounters TIMELINE_SERVICE_WRITE_FAILURES increment LOG error e
tlc entity tlc putEntities entity
LOG info context getTaskAttemptID getTaskID jobs size job jobs String jobIdStr job getJobId job getJobConfFilePath job getJobHistoryFilePath LOG info jobIdStr LOG info jobIdStr JobId jobId TypeConverter toYarn JobID forName jobIdStr ApplicationId appId jobId getAppId AppLevelTimelineCollector collector AppLevelTimelineCollector appId manager putIfAbsent appId collector JobInfo jobInfo parser parseHistoryFile job getJobHistoryFilePath Configuration jobConf parser parseConfiguration job getJobConfFilePath
LOG info jobIdStr LOG info jobIdStr JobId jobId TypeConverter toYarn JobID forName jobIdStr ApplicationId appId jobId getAppId AppLevelTimelineCollector collector AppLevelTimelineCollector appId manager putIfAbsent appId collector JobInfo jobInfo parser parseHistoryFile job getJobHistoryFilePath Configuration jobConf parser parseConfiguration job getJobConfFilePath LOG info jobIdStr TimelineCollectorContext tlContext collector getTimelineEntityContext tlContext setFlowName jobInfo getJobname tlContext setFlowRunId jobInfo getSubmitTime tlContext setUserId jobInfo getUsername
totalTime List TimelineEntity entitySet converter createTimelineEntities jobInfo jobConf LOG info jobIdStr UserGroupInformation ugi UserGroupInformation getCurrentUser startWrite System nanoTime entitySet ugi entitySet ugi e context getCounter PerfCounters TIMELINE_SERVICE_WRITE_FAILURES increment LOG error e
collector ugi entity TimelineEntities entities TimelineEntities entities addEntity entity collector putEntities entities ugi
Path outDir conf FileSystem fs outDir getFileSystem conf StringBuffer result StringBuffer Path fileList FileUtil stat2Paths fs listStatus outDir Utils OutputFileUtils OutputFilesFilter Path fileList
String entId taskAttemptId Integer toString i TimelineEntity entity TimelineEntity entity setEntityId entId entity setEntityType entity addOtherInfo payLoad TimelineEvent event TimelineEvent event setTimestamp System currentTimeMillis event setEventType entity addEvent event UserGroupInformation ugi UserGroupInformation getCurrentUser startWrite System nanoTime tlc putEntities entity context getCounter PerfCounters TIMELINE_SERVICE_WRITE_FAILURES increment
event setTimestamp System currentTimeMillis event addInfo entity addEvent event TimelineMetric metric TimelineMetric metric setId metric addValue System currentTimeMillis entity addMetric metric entity addConfig TimelineEntities entities TimelineEntities entities addEntity entity UserGroupInformation ugi UserGroupInformation getCurrentUser startWrite System nanoTime collector putEntities entities ugi
Thread toInterrupt Thread currentThread Thread interrupter Thread Thread sleep toInterrupt interrupt LOG info job submit LOG info interrupter start LOG info job waitForCompletion
Path outputDir getOutputPath Configuration conf Configuration FileSystem fs FileSystem getLocal conf FileStatus stats fs listStatus outputDir valueSum FileStatus f stats FSDataInputStream istream fs open f getPath BufferedReader r BufferedReader InputStreamReader istream String line line r valueSum Integer valueOf line trim r close maxVal NUMBER_FILE_VAL expectedPerMapper maxVal maxVal expectedSum expectedPerMapper numMaps
conf CLI jc createJobClient ByteArrayOutputStream out ByteArrayOutputStream exitCode runTool conf jc String out assertEquals exitCode exitCode runTool conf jc String out assertEquals exitCode String line BufferedReader br BufferedReader InputStreamReader ByteArrayInputStream out toByteArray counter line br
String jobId conf CLI jc createJobClient ByteArrayOutputStream out ByteArrayOutputStream exitCode runTool conf jc String out assertEquals exitCode exitCode runTool conf jc String jobId out assertEquals exitCode String line BufferedReader br BufferedReader InputStreamReader ByteArrayInputStream out toByteArray counter line br
conf CLI jc createJobClient ByteArrayOutputStream out ByteArrayOutputStream exitCode runTool conf jc String out assertEquals exitCode exitCode runTool conf jc String out assertEquals exitCode String line BufferedReader br BufferedReader InputStreamReader ByteArrayInputStream out toByteArray counter line br
String jobId conf CLI jc createJobClient ByteArrayOutputStream out ByteArrayOutputStream exitCode runTool conf jc String out assertEquals exitCode exitCode runTool conf jc String jobId out assertEquals exitCode String line BufferedReader br BufferedReader InputStreamReader ByteArrayInputStream out toByteArray counter String attemptId jobId substring line br
String jobId conf CLI jc createJobClient ByteArrayOutputStream out ByteArrayOutputStream exitCode runTool conf jc String out assertEquals exitCode exitCode runTool conf jc String jobId out assertEquals exitCode String line BufferedReader br BufferedReader InputStreamReader ByteArrayInputStream out toByteArray line br
String conf ByteArrayOutputStream out ByteArrayOutputStream exitCode runTool conf createJobClient String out assertEquals exitCode exitCode runTool conf createJobClient String out assertEquals exitCode BufferedReader br BufferedReader InputStreamReader ByteArrayInputStream out toByteArray String line counter line br
conf Job job runJobInBackGround conf ByteArrayOutputStream out ByteArrayOutputStream String line counter exitCode runTool conf createJobClient String out assertEquals exitCode BufferedReader br BufferedReader InputStreamReader ByteArrayInputStream out toByteArray counter line br
String String conf jc PipedInputStream pis PipedInputStream PipedOutputStream pos PipedOutputStream pis exitCode runTool conf jc String pos assertEquals exitCode BufferedReader br BufferedReader InputStreamReader pis String line line br
String String conf jc PipedInputStream pis PipedInputStream PipedOutputStream pos PipedOutputStream pis exitCode runTool conf jc String pos assertEquals exitCode BufferedReader br BufferedReader InputStreamReader pis String line line br
job job setNumReduceTasks job getConfiguration set MRConfig FRAMEWORK_NAME MRConfig LOCAL_FRAMEWORK_NAME job getConfiguration setInt MRJobConfig IO_SORT_FACTOR job getConfiguration set job getConfiguration setInt job setInputFormatClass FakeIF job setOutputFormatClass NullOutputFormat job setMapperClass Mapper job setReducerClass SpillReducer job setMapOutputKeyClass KeyWritable job setMapOutputValueClass ValWritable job setSortComparatorClass VariableComparator
Configuration conf Configuration conf setInt Job COMPLETION_POLL_INTERVAL_KEY Job job Job getInstance conf conf job getConfiguration conf setInt MRJobConfig IO_SORT_MB conf setClass RandomFactory RecordFactory Random r Random seed r nextLong
Configuration conf Configuration conf setInt Job COMPLETION_POLL_INTERVAL_KEY Job job Job getInstance conf conf job getConfiguration conf setInt MRJobConfig IO_SORT_MB conf setBoolean MRJobConfig MAP_OUTPUT_COMPRESS conf setClass RandomFactory RecordFactory Random r Random seed r nextLong
IntWritable IntWritable errors IntWritable i ArrayList IntWritable expectedValues ArrayList IntWritable
IntWritable key IntWritable values errors IntWritable i ArrayList IntWritable expectedValues ArrayList IntWritable LOG info key toString values mark LOG info values i values next expectedValues add i
errors IntWritable i ArrayList IntWritable expectedValues ArrayList IntWritable LOG info key toString values mark LOG info values i values next expectedValues add i LOG info key i values reset LOG info count values i values next
ArrayList IntWritable expectedValues ArrayList IntWritable LOG info key toString values mark LOG info values i values next expectedValues add i LOG info key i values reset LOG info count values i values next LOG info key i i expectedValues count
IntWritable IntWritable IntWritable i errors count ArrayList IntWritable expectedValues ArrayList IntWritable ArrayList IntWritable expectedValues1 ArrayList IntWritable
IntWritable key IntWritable values IntWritable i errors count ArrayList IntWritable expectedValues ArrayList IntWritable ArrayList IntWritable expectedValues1 ArrayList IntWritable LOG info key values mark LOG info values i values next
LOG info key values mark LOG info values i values next LOG info key i expectedValues add i count count values reset LOG info count values i values next
i values next LOG info key i expectedValues add i count count values reset LOG info count values i values next LOG info key i count expectedValues i expectedValues count errors
count values mark LOG info key i count expectedValues1 add i count count count LOG info errors errors values reset count LOG info
count expectedValues1 add i count count count expectedValues LOG info errors errors values reset count LOG info expectedValues clear values i values next
expectedValues clear values i values next LOG info key i count expectedValues1 i expectedValues1 get count errors LOG info expectedValues1 get count i errors count values mark LOG info key i count expectedValues add i count
LOG info key i count expectedValues1 i expectedValues1 get count errors LOG info expectedValues1 get count i errors count values mark LOG info key i count expectedValues add i count count expectedValues1 LOG info errors
IntWritable IntWritable IntWritable i errors count ArrayList IntWritable expectedValues ArrayList IntWritable ArrayList IntWritable expectedValues1 ArrayList IntWritable
IntWritable key IntWritable values IntWritable i errors count ArrayList IntWritable expectedValues ArrayList IntWritable ArrayList IntWritable expectedValues1 ArrayList IntWritable LOG info key values mark LOG info values i values next
LOG info key values mark LOG info values i values next LOG info key i expectedValues add i count count values reset count LOG info values i values next
i values next LOG info key i expectedValues add i count count values reset count LOG info values i values next LOG info key i count expectedValues i expectedValues count errors
count expectedValues i expectedValues get count errors LOG info expectedValues get count i errors count values mark LOG info key i count expectedValues1 add i count values reset LOG info expectedValues clear count
errors count values mark LOG info key i count expectedValues1 add i count values reset LOG info expectedValues clear count values i values next LOG info key i count expectedValues1
LOG info expectedValues clear count values i values next LOG info key i count expectedValues1 i expectedValues1 get count errors LOG info expectedValues1 get count i errors count values mark LOG info key i count
values i values next LOG info key i count expectedValues1 i expectedValues1 get count errors LOG info expectedValues1 get count i errors count values mark LOG info key i count expectedValues add i count values reset
IntWritable IntWritable errors IntWritable i ArrayList IntWritable expectedValues ArrayList IntWritable
IntWritable key IntWritable values errors IntWritable i ArrayList IntWritable expectedValues ArrayList IntWritable LOG info key values mark LOG info count values i values next
count LOG info key i values mark count expectedValues add i count values reset LOG info values errors LOG info errors count values i values next
count expectedValues add i count values reset LOG info values errors LOG info errors count values i values next LOG info key i count expectedValues i expectedValues count
Path outputFiles FileUtil stat2Paths localFs listStatus Path TEST_ROOT_DIR Utils OutputFileUtils OutputFilesFilter outputFiles InputStream is localFs open outputFiles BufferedReader reader BufferedReader InputStreamReader is String line reader readLine line StringTokenizer tokeniz StringTokenizer line String key tokeniz nextToken String value tokeniz nextToken
job setEntityType JOB job setEntityId jobInfo getJobId toString job setStartTime jobInfo getSubmitTime job addPrimaryFilter jobInfo getJobname job addPrimaryFilter jobInfo getUsername job addOtherInfo jobInfo getJobQueueName job addOtherInfo jobInfo getSubmitTime job addOtherInfo jobInfo getLaunchTime job addOtherInfo jobInfo getFinishTime job addOtherInfo jobInfo getJobStatus job addOtherInfo jobInfo getPriority job addOtherInfo jobInfo getTotalMaps job addOtherInfo jobInfo getTotalReduces job addOtherInfo jobInfo getUberized job addOtherInfo jobInfo getErrorInfo
Set TimelineEntity jobInfo Set TimelineEntity entities HashSet Map TaskID TaskInfo taskInfoMap jobInfo getAllTasks
TimelineEntity taskInfo TimelineEntity task TimelineEntity task setEntityType TASK task setEntityId taskInfo getTaskId toString task setStartTime taskInfo getStartTime task addOtherInfo taskInfo getStartTime task addOtherInfo taskInfo getFinishTime task addOtherInfo taskInfo getTaskType task addOtherInfo taskInfo getTaskStatus task addOtherInfo taskInfo getError
Set TimelineEntity taskInfo Set TimelineEntity taskAttempts HashSet TimelineEntity Map TaskAttemptID TaskAttemptInfo taskAttemptInfoMap taskInfo getAllTaskAttempts
TimelineEntity taskAttemptInfo TimelineEntity taskAttempt TimelineEntity taskAttempt setEntityType TASK_ATTEMPT taskAttempt setEntityId taskAttemptInfo getAttemptId toString taskAttempt setStartTime taskAttemptInfo getStartTime taskAttempt addOtherInfo taskAttemptInfo getStartTime taskAttempt addOtherInfo taskAttemptInfo getFinishTime taskAttempt addOtherInfo taskAttemptInfo getMapFinishTime taskAttempt addOtherInfo taskAttemptInfo getShuffleFinishTime taskAttempt addOtherInfo taskAttemptInfo getSortFinishTime taskAttempt addOtherInfo taskAttemptInfo getTaskStatus taskAttempt addOtherInfo taskAttemptInfo getState taskAttempt addOtherInfo taskAttemptInfo getError taskAttempt addOtherInfo taskAttemptInfo getContainerId toString
job addInfo jobInfo getUsername job addInfo jobInfo getJobQueueName job addInfo jobInfo getSubmitTime job addInfo jobInfo getLaunchTime job addInfo jobInfo getFinishTime job addInfo jobInfo getJobStatus job addInfo jobInfo getPriority job addInfo jobInfo getTotalMaps job addInfo jobInfo getTotalReduces job addInfo jobInfo getUberized job addInfo jobInfo getErrorInfo Counters totalCounters jobInfo getTotalCounters totalCounters addMetrics job totalCounters addConfiguration job conf
List TimelineEntity jobInfo List TimelineEntity entities ArrayList Map TaskID TaskInfo taskInfoMap jobInfo getAllTasks
Set TimelineEntity taskInfo Set TimelineEntity taskAttempts HashSet TimelineEntity Map TaskAttemptID TaskAttemptInfo taskAttemptInfoMap taskInfo getAllTaskAttempts
Job job Job getInstance conf Random random Random seed random nextLong random setSeed seed localFs delete workDir FileInputFormat setInputPaths job workDir length numFiles createFiles length numFiles random job TaskAttemptContext context MapReduceTestUtil createDummyMapTaskAttemptContext job getConfiguration InputFormat IntWritable BytesWritable format CombineSequenceFileInputFormat IntWritable BytesWritable numSplits random nextInt length SequenceFile SYNC_INTERVAL
Job job Job getInstance conf Random random Random seed random nextLong random setSeed seed localFs delete workDir FileInputFormat setInputPaths job workDir length numFiles createFiles length numFiles random job TaskAttemptContext context MapReduceTestUtil createDummyMapTaskAttemptContext job getConfiguration InputFormat IntWritable BytesWritable format CombineSequenceFileInputFormat IntWritable BytesWritable numSplits random nextInt length SequenceFile SYNC_INTERVAL LOG info numSplits List InputSplit splits format getSplits job
LOG info splits size assertEquals splits size InputSplit split splits get assertEquals CombineFileSplit split getClass BitSet bits BitSet length RecordReader IntWritable BytesWritable reader format createRecordReader split context MapContext IntWritable BytesWritable IntWritable BytesWritable mcontext MapContextImpl IntWritable BytesWritable IntWritable BytesWritable job getConfiguration context getTaskAttemptID reader MapReduceTestUtil createDummyReporter split reader initialize split mcontext assertEquals CombineFileRecordReader reader getClass reader IntWritable key reader getCurrentKey BytesWritable value reader getCurrentValue assertNotNull value k key get
Job job Job getInstance Configuration defaultConf Random random Random seed random nextLong
Job job Job getInstance Configuration defaultConf Random random Random seed random nextLong LOG info seed random setSeed seed localFs delete workDir FileInputFormat setInputPaths job workDir length numFiles createFiles length numFiles random CombineTextInputFormat format CombineTextInputFormat numSplits random nextInt length
Job job Job getInstance Configuration defaultConf Random random Random seed random nextLong LOG info seed random setSeed seed localFs delete workDir FileInputFormat setInputPaths job workDir length numFiles createFiles length numFiles random CombineTextInputFormat format CombineTextInputFormat numSplits random nextInt length LOG info numSplits List InputSplit splits format getSplits job
localFs delete workDir FileInputFormat setInputPaths job workDir length numFiles createFiles length numFiles random CombineTextInputFormat format CombineTextInputFormat numSplits random nextInt length LOG info numSplits List InputSplit splits format getSplits job LOG info splits size assertEquals splits size InputSplit split splits get assertEquals CombineFileSplit split getClass BitSet bits BitSet length
assertEquals CombineFileSplit split getClass BitSet bits BitSet length LOG debug split TaskAttemptContext context MapReduceTestUtil createDummyMapTaskAttemptContext job getConfiguration RecordReader LongWritable Text reader format createRecordReader split context assertEquals CombineFileRecordReader reader getClass MapContext LongWritable Text LongWritable Text mcontext MapContextImpl LongWritable Text LongWritable Text job getConfiguration context getTaskAttemptID reader MapReduceTestUtil createDummyReporter split reader initialize split mcontext count reader LongWritable key reader getCurrentKey assertNotNull key Text value reader getCurrentValue v Integer parseInt value toString
Path file Path workDir String createFile file Job job Job getInstance defaultConf FileInputFormat setInputPaths job workDir FixedLengthInputFormat format FixedLengthInputFormat List InputSplit splits format getSplits job exceptionThrown InputSplit split splits TaskAttemptContext context MapReduceTestUtil createDummyMapTaskAttemptContext job getConfiguration RecordReader LongWritable BytesWritable reader format createRecordReader split context MapContext LongWritable BytesWritable LongWritable BytesWritable mcontext MapContextImpl LongWritable BytesWritable LongWritable BytesWritable job getConfiguration context getTaskAttemptID reader MapReduceTestUtil createDummyReporter split reader initialize split mcontext exceptionThrown
createFile file Job job Job getInstance defaultConf FixedLengthInputFormat format FixedLengthInputFormat format setRecordLength job getConfiguration FileInputFormat setInputPaths job workDir List InputSplit splits format getSplits job exceptionThrown InputSplit split splits TaskAttemptContext context MapReduceTestUtil createDummyMapTaskAttemptContext job getConfiguration RecordReader LongWritable BytesWritable reader format createRecordReader split context MapContext LongWritable BytesWritable LongWritable BytesWritable mcontext MapContextImpl LongWritable BytesWritable LongWritable BytesWritable job getConfiguration context getTaskAttemptID reader MapReduceTestUtil createDummyReporter split reader initialize split mcontext exceptionThrown
createFile file Job job Job getInstance defaultConf FixedLengthInputFormat format FixedLengthInputFormat format setRecordLength job getConfiguration FileInputFormat setInputPaths job workDir List InputSplit splits format getSplits job exceptionThrown InputSplit split splits TaskAttemptContext context MapReduceTestUtil createDummyMapTaskAttemptContext job getConfiguration RecordReader LongWritable BytesWritable reader format createRecordReader split context MapContext LongWritable BytesWritable LongWritable BytesWritable mcontext MapContextImpl LongWritable BytesWritable LongWritable BytesWritable job getConfiguration context getTaskAttemptID reader MapReduceTestUtil createDummyReporter split reader initialize split mcontext exceptionThrown
Path file Path workDir fileName toString seed Random nextInt LOG info seed Random random Random seed MAX_TESTS LongWritable key BytesWritable value MAX_TESTS LOG info totalRecords random nextInt totalRecords recordLength random nextInt recordLength
fileSize totalRecords recordLength LOG info totalRecords recordLength Job job Job getInstance defaultConf codec ReflectionUtils setConf codec job getConfiguration ArrayList String recordList createFile file codec recordLength totalRecords assertTrue localFs exists file FixedLengthInputFormat setRecordLength job getConfiguration recordLength numSplits numSplits fileSize Math floor recordLength numSplits fileSize fileSize random nextInt fileSize
fileName append ReflectionUtils setConf codec job getConfiguration writeFile localFs Path workDir fileName toString codec FixedLengthInputFormat format FixedLengthInputFormat format setRecordLength job getConfiguration FileInputFormat setInputPaths job workDir List InputSplit splits format getSplits job codec assertEquals splits size exceptionThrown InputSplit split splits List String results readSplit format split job exceptionThrown
Job job Job getInstance Configuration defaultConf Path file Path workDir seed Random nextInt
Job job Job getInstance Configuration defaultConf Path file Path workDir seed Random nextInt LOG info seed Random random Random seed localFs delete workDir FileInputFormat setInputPaths job workDir MAX_LENGTH MAX_LENGTH random nextInt MAX_LENGTH
MAX_LENGTH length length MAX_LENGTH length random nextInt MAX_LENGTH LOG debug length Writer writer OutputStreamWriter localFs create file i i length i writer write Integer toString i writer write writer write Integer toString i writer write writer close KeyValueTextInputFormat format KeyValueTextInputFormat i i i numSplits random nextInt MAX_LENGTH
LOG debug length Writer writer OutputStreamWriter localFs create file i i length i writer write Integer toString i writer write writer write Integer toString i writer write writer close KeyValueTextInputFormat format KeyValueTextInputFormat i i i numSplits random nextInt MAX_LENGTH LOG debug numSplits List InputSplit splits format getSplits job
i i length i writer write Integer toString i writer write writer write Integer toString i writer write writer close KeyValueTextInputFormat format KeyValueTextInputFormat i i i numSplits random nextInt MAX_LENGTH LOG debug numSplits List InputSplit splits format getSplits job LOG debug splits size BitSet bits BitSet length splits size
count reader key reader getCurrentKey clazz key getClass assertEquals Text clazz value reader getCurrentValue clazz value getClass assertEquals Text clazz k Integer parseInt key toString v Integer parseInt value toString assertEquals k assertEquals k v LOG debug v assertFalse bits get v
Configuration conf job getConfiguration CompressionCodec codec codec CompressionCodec ReflectionUtils newInstance conf getClassByName conf IOException Path file Path workDir codec getDefaultExtension seed Random nextInt LOG info seed Random random Random seed localFs delete workDir FileInputFormat setInputPaths job workDir MAX_LENGTH FileInputFormat setMaxInputSplitSize job MAX_LENGTH MAX_LENGTH random nextInt MAX_LENGTH
RecordReader Text Text reader format createRecordReader splits get j context Class clazz reader getClass MapContext Text Text Text Text mcontext MapContextImpl Text Text Text Text job getConfiguration context getTaskAttemptID reader MapReduceTestUtil createDummyReporter splits get j reader initialize splits get j mcontext Text key Text value count reader key reader getCurrentKey value reader getCurrentValue k Integer parseInt key toString v Integer parseInt value toString assertEquals k assertEquals k v
MapContext Text Text Text Text mcontext MapContextImpl Text Text Text Text job getConfiguration context getTaskAttemptID reader MapReduceTestUtil createDummyReporter splits get j reader initialize splits get j mcontext Text key Text value count reader key reader getCurrentKey value reader getCurrentValue k Integer parseInt key toString v Integer parseInt value toString assertEquals k assertEquals k v LOG debug k v assertFalse k v bits get v
LOG info SequenceFileInputFilter setFilterClass job SequenceFileInputFilter RegexFilter SequenceFileInputFilter RegexFilter setPattern job getConfiguration fs delete inDir
LOG info SequenceFileInputFilter setFilterClass job SequenceFileInputFilter PercentFilter SequenceFileInputFilter PercentFilter setFrequency job getConfiguration fs delete inDir
LOG info SequenceFileInputFilter setFilterClass job SequenceFileInputFilter PercentFilter SequenceFileInputFilter PercentFilter setFrequency job getConfiguration fs delete inDir length length length LOG info length createSequenceFile length count countRecords
LOG info SequenceFileInputFilter setFilterClass job SequenceFileInputFilter MD5Filter SequenceFileInputFilter MD5Filter setFrequency job getConfiguration fs delete inDir
String input String helper LOG info input String keySpecs helper keySpecs get toString
String input String helper s1 e1 LOG info input String keySpecs helper keySpecs get toString LOG info keySpecs inputBytes input getBytes e1 e1 inputBytes length LOG info e1 indices helper getWordLengths inputBytes s1 e1 start helper getStartOffset inputBytes s1 e1 indices helper keySpecs get LOG info start assertEquals start end helper getEndOffset inputBytes s1 e1 indices helper keySpecs get
LOG info keySpecs inputBytes input getBytes e1 e1 inputBytes length LOG info e1 indices helper getWordLengths inputBytes s1 e1 start helper getStartOffset inputBytes s1 e1 indices helper keySpecs get LOG info start assertEquals start end helper getEndOffset inputBytes s1 e1 indices helper keySpecs get LOG info end end end inputBytes length inputBytes length end length end start
LOG info e1 indices helper getWordLengths inputBytes s1 e1 start helper getStartOffset inputBytes s1 e1 indices helper keySpecs get LOG info start assertEquals start end helper getEndOffset inputBytes s1 e1 indices helper keySpecs get LOG info end end end inputBytes length inputBytes length end length end start LOG info length outputBytes length System arraycopy inputBytes start outputBytes length String output String outputBytes
LOG info e1 indices helper getWordLengths inputBytes s1 e1 start helper getStartOffset inputBytes s1 e1 indices helper keySpecs get LOG info start assertEquals start end helper getEndOffset inputBytes s1 e1 indices helper keySpecs get LOG info end end end inputBytes length inputBytes length end length end start LOG info length outputBytes length System arraycopy inputBytes start outputBytes length String output String outputBytes
tokenFetchTime jobHistoryServer conf JHSDelegationTokenSecretManager conf store JHSDelegationTokenSecretManager initialInterval maxLifetime renewInterval store jobHistoryServer init conf jobHistoryServer start MRClientProtocol hsService jobHistoryServer getClientService getClientHandler UserGroupInformation loggedInUser UserGroupInformation createRemoteUser Assert assertEquals loggedInUser getShortUserName loggedInUser setAuthenticationMethod AuthenticationMethod KERBEROS Token token getDelegationToken loggedInUser hsService loggedInUser getShortUserName tokenFetchTime System currentTimeMillis
clientUsingDT getJobReport jobReportRequest e Assert assertEquals e getMessage System currentTimeMillis Thread sleep nextExpTime renewDelegationToken loggedInUser hsService token renewalTime System currentTimeMillis LOG info renewalTime nextExpTime System currentTimeMillis System currentTimeMillis nextExpTime Thread sleep Thread sleep clientUsingDT getJobReport jobReportRequest e Assert assertEquals e getMessage
LOG info renewalTime nextExpTime System currentTimeMillis System currentTimeMillis nextExpTime Thread sleep Thread sleep clientUsingDT getJobReport jobReportRequest e Assert assertEquals e getMessage System currentTimeMillis renewalTime Thread sleep Thread sleep LOG info System currentTimeMillis clientUsingDT getJobReport jobReportRequest fail
Thread sleep Thread sleep LOG info System currentTimeMillis clientUsingDT getJobReport jobReportRequest fail e assertTrue e getCause getMessage contains clientUsingDT clientUsingDT token getDelegationToken loggedInUser hsService loggedInUser getShortUserName tokenFetchTime System currentTimeMillis LOG info tokenFetchTime clientUsingDT getMRClientProtocol token jobHistoryServer getClientService getBindAddress conf
TaskUmbilicalProtocol mockTT mock TaskUmbilicalProtocol doReturn TaskUmbilicalProtocol versionID when mockTT getProtocolVersion anyString anyLong doReturn ProtocolSignature getProtocolSignature mockTT TaskUmbilicalProtocol getName TaskUmbilicalProtocol versionID when mockTT getProtocolSignature anyString anyLong anyInt JobTokenSecretManager sm JobTokenSecretManager Server server RPC Builder conf setProtocol TaskUmbilicalProtocol setInstance mockTT setBindAddress ADDRESS setPort setNumHandlers setVerbose setSecretManager sm build server start UserGroupInformation current UserGroupInformation getCurrentUser InetSocketAddress addr NetUtils getConnectAddress server String jobId current getUserName JobTokenIdentifier tokenId JobTokenIdentifier Text jobId Token JobTokenIdentifier token Token JobTokenIdentifier tokenId sm sm addTokenForJob jobId token SecurityUtil setTokenService token addr
String String pathname String cwd System getProperty pathname Path pathname toUri getPath cwd Path cwd toUri getPath String cwdParts cwd split Path SEPARATOR String pathParts pathname split Path SEPARATOR cwd pathname
cwdParts i pathParts i common StringBuilder sb StringBuilder parentDirsRequired cwdParts length common i i parentDirsRequired i sb append sb append Path SEPARATOR i common i pathParts length i sb append pathParts i sb append Path SEPARATOR String s sb toString s Path SEPARATOR s s substring s length
conf set MRConfig FRAMEWORK_NAME MRConfig YARN_FRAMEWORK_NAME String stagingDir conf get MRJobConfig MR_AM_STAGING_DIR stagingDir stagingDir MRJobConfig conf set MRJobConfig MR_AM_STAGING_DIR File getTestWorkDir getAbsolutePath conf MRConfig MRConfig conf setBoolean YarnConfiguration NM_PMEM_CHECK_ENABLED conf setBoolean YarnConfiguration NM_VMEM_CHECK_ENABLED conf set CommonConfigurationKeys FS_PERMISSIONS_UMASK_KEY Path stagingPath FileContext getFileContext conf makeQualified Path conf get MRJobConfig MR_AM_STAGING_DIR Path stagingPath conf conf set MRJobConfig MR_AM_STAGING_DIR File conf get MRJobConfig MR_AM_STAGING_DIR getAbsolutePath FileContext fc FileContext getFileContext stagingPath toUri conf fc stagingPath
MRJobConfig conf set MRJobConfig MR_AM_STAGING_DIR File getTestWorkDir getAbsolutePath conf conf setBoolean YarnConfiguration NM_PMEM_CHECK_ENABLED conf setBoolean YarnConfiguration NM_VMEM_CHECK_ENABLED conf set CommonConfigurationKeys FS_PERMISSIONS_UMASK_KEY Path stagingPath FileContext getFileContext conf makeQualified Path conf get MRJobConfig MR_AM_STAGING_DIR Path stagingPath conf conf set MRJobConfig MR_AM_STAGING_DIR File conf get MRJobConfig MR_AM_STAGING_DIR getAbsolutePath FileContext fc FileContext getFileContext stagingPath toUri conf fc stagingPath LOG info stagingPath fc delete stagingPath
Configuration sleepConf Configuration mrCluster getConfig Assume assumeFalse sleepConf get YarnConfiguration RM_SCHEDULER equals FairScheduler getCanonicalName
Configuration sleepConf Configuration mrCluster getConfig
useCustomClasses LOG info useCustomClasses
LOG info
LOG info
Path localJobJarPath makeJobJarWithLib TEST_ROOT_DIR toUri toString
job waitForCompletion Counters counterMR job getCounters JobId jobId TypeConverter toYarn job getJobID ApplicationId appID jobId getAppId pollElapsed Thread sleep pollElapsed mrCluster getResourceManager getRMContext getRMApps get appID getState pollElapsed LOG warn Assert assertEquals RMAppState FINISHED mrCluster getResourceManager getRMContext getRMApps get appID getState Counters counterHS job getCounters
LOG info
LOG info
LOG info
conf bufferSize conf getInt Constants NATIVE_PROCESSOR_BUFFER_KB
init context context context job context getJobConf Platforms init job job String message
init context context context job context getJobConf Platforms init job job String message LOG error message InvalidJobConfException message Class comparatorClass job getClass MRJobConfig KEY_COMPARATOR RawComparator comparatorClass Platforms comparatorClass String message job get MRJobConfig KEY_COMPARATOR LOG error message InvalidJobConfException message job get Constants MAP_SORT_CLASS String message job get Constants MAP_SORT_CLASS
job String message LOG error message InvalidJobConfException message Class comparatorClass job getClass MRJobConfig KEY_COMPARATOR RawComparator comparatorClass comparatorClass String message job get MRJobConfig KEY_COMPARATOR LOG error message InvalidJobConfException message job get Constants MAP_SORT_CLASS String message job get Constants MAP_SORT_CLASS LOG error message InvalidJobConfException message job String message
String message job get MRJobConfig KEY_COMPARATOR LOG error message InvalidJobConfException message job get Constants MAP_SORT_CLASS String message job get Constants MAP_SORT_CLASS LOG error message InvalidJobConfException message job String message LOG error message InvalidJobConfException message Class keyCls job getMapOutputKeyClass SuppressWarnings INativeSerializer serializer NativeSerialization getInstance getSerializer keyCls serializer
getName job get Constants MAP_SORT_CLASS String message job get Constants MAP_SORT_CLASS LOG error message InvalidJobConfException message job String message LOG error message InvalidJobConfException message Class keyCls job getMapOutputKeyClass SuppressWarnings INativeSerializer serializer NativeSerialization getInstance getSerializer keyCls serializer String message keyCls getName LOG error message InvalidJobConfException message
job String message LOG error message InvalidJobConfException message Class keyCls job getMapOutputKeyClass SuppressWarnings INativeSerializer serializer NativeSerialization getInstance getSerializer keyCls serializer String message keyCls getName LOG error message InvalidJobConfException message keyCls getName serializer job String message keyCls getName LOG error message InvalidJobConfException message
SuppressWarnings INativeSerializer serializer NativeSerialization getInstance getSerializer keyCls serializer String message keyCls getName LOG error message InvalidJobConfException message keyCls getName serializer String message keyCls getName LOG error message InvalidJobConfException message IOException String message keyCls getName LOG error message IOException message ret NativeRuntime isNativeLibraryLoaded ret
LOG error message InvalidJobConfException message IOException String message keyCls getName LOG error message IOException message ret NativeRuntime isNativeLibraryLoaded ret job MRJobConfig String codec job get MRJobConfig MAP_OUTPUT_COMPRESS_CODEC NativeRuntime codec String message codec LOG error message InvalidJobConfException message NativeRuntime configure job
job MRJobConfig String codec job get MRJobConfig MAP_OUTPUT_COMPRESS_CODEC NativeRuntime codec String message codec LOG error message InvalidJobConfException message NativeRuntime configure job updateInterval job getLong Constants NATIVE_STATUS_UPDATE_INTERVAL Constants NATIVE_STATUS_UPDATE_INTERVAL_DEFVAL updater StatusReportChecker context getReporter updateInterval updater start String message LOG error message InvalidJobConfException message handler
conf Class clazz conf getClass OutputUtil NATIVE_TASK_OUTPUT_MANAGER NativeTaskOutputFiles
Configuration normalConf ScenarioConfiguration getNormalConfiguration Configuration nativeConf ScenarioConfiguration getNativeConfiguration normalConf addResource TestConstants COMBINER_CONF_PATH nativeConf addResource TestConstants COMBINER_CONF_PATH deafult_KVSize_Maximum KVSize_Maximum normalConf getInt TestConstants NATIVETASK_KVSIZE_MAX_LARGEKV_TEST deafult_KVSize_Maximum String inputPath TestConstants NATIVETASK_COMBINER_TEST_INPUTDIR String nativeOutputPath TestConstants NATIVETASK_COMBINER_TEST_NATIVE_OUTPUTDIR String hadoopOutputPath TestConstants NATIVETASK_COMBINER_TEST_NORMAL_OUTPUTDIR FileSystem fs FileSystem get normalConf i i KVSize_Maximum i max i min Math max i max
String valueClassesStr nativekvtestconf get TestConstants NATIVETASK_KVTEST_VALUECLASSES
Class String valueClassesStr nativekvtestconf get TestConstants NATIVETASK_KVTEST_VALUECLASSES LOG info valueClassesStr List Class valueClasses parseClassNames valueClassesStr String keyClassesStr nativekvtestconf get TestConstants NATIVETASK_KVTEST_KEYCLASSES
ServerBootstrap bootstrap ServerBootstrap selector timer HashedWheelTimer pipelineFact HttpPipelineFactory conf timer ex RuntimeException ex bootstrap setOption conf getInt SHUFFLE_LISTEN_QUEUE_SIZE DEFAULT_SHUFFLE_LISTEN_QUEUE_SIZE bootstrap setOption bootstrap setPipelineFactory pipelineFact port conf getInt SHUFFLE_PORT_CONFIG_KEY DEFAULT_SHUFFLE_PORT Channel ch bootstrap bind InetSocketAddress port accepted add ch port InetSocketAddress ch getLocalAddress getPort conf set SHUFFLE_PORT_CONFIG_KEY Integer toString port pipelineFact SHUFFLE setPort port
Path recoveryRoot Options options Options options createIfMissing Path dbPath Path recoveryRoot STATE_DB_NAME
Version loadedVersion loadVersion
jobId user jobToken userRsrc put jobId toString user secretManager addTokenForJob jobId toString jobToken
assumeTrue NativeIO isAvailable Configuration conf Configuration conf setInt ShuffleHandler SHUFFLE_PORT_CONFIG_KEY conf setInt ShuffleHandler MAX_SHUFFLE_CONNECTIONS conf set CommonConfigurationKeysPublic HADOOP_SECURITY_AUTHENTICATION UserGroupInformation setConfiguration conf conf set YarnConfiguration NM_LOCAL_DIRS ABS_LOG_DIR getAbsolutePath ApplicationId appId ApplicationId newInstance
parseLists String list StringUtils split input File pathSeparatorChar String list
parseLists String list StringUtils split input File pathSeparatorChar String item list LOG info item String expanded expandEnvironmentVariables item System getenv
parseLists String list StringUtils split input File pathSeparatorChar String item list LOG info item String expanded expandEnvironmentVariables item System getenv LOG info expanded expanded File path File expanded substring expanded length path File files path listFiles files File jar files jar addJar jar
lastIndex target indexOf targetPath Path target substring lastIndex target length lastIndex alias lastIndex target substring lastIndex targetPath getName
targetStream lastIndex target indexOf targetPath Path target substring lastIndex target length lastIndex alias lastIndex target substring lastIndex targetPath getName LOG info targetPath FileSystem fileSystem targetPath getFileSystem conf targetStream fileSystem
targetStream lastIndex target indexOf targetPath Path target substring lastIndex target length lastIndex alias lastIndex target substring lastIndex targetPath getName LOG info targetPath FileSystem fileSystem targetPath getFileSystem conf targetStream fileSystem LOG info initialReplication targetPath
FileSystem fileSystem targetPath getFileSystem conf targetStream fileSystem DistributedFileSystem LOG info initialReplication targetPath LOG info targetPath DistributedFileSystem dfs DistributedFileSystem fileSystem DistributedFileSystem HdfsDataOutputStreamBuilder builder dfs createFile targetPath overwrite ecPolicyName SystemErasureCodingPolicies getReplicationPolicy getName initialReplication builder replication initialReplication targetStream builder build LOG warn initialReplication targetPath fileSystem getClass getName targetStream targetStream fileSystem create targetPath conf
FileSystem fileSystem targetPath getFileSystem conf fileSystem fileSystem setReplication targetPath finalReplication
FileSystem fileSystem targetPath getFileSystem conf fileSystem fileSystem setReplication targetPath finalReplication LOG info finalReplication targetPath LOG info startTime System currentTimeMillis endTime startTime currentReplication endTime startTime currentReplication Thread sleep endTime System currentTimeMillis currentReplication getSmallestReplicatedBlockCount endTime startTime
fileSystem setReplication targetPath finalReplication LOG info finalReplication targetPath timeout LOG info startTime System currentTimeMillis endTime startTime currentReplication endTime startTime timeout currentReplication acceptableReplication Thread sleep endTime System currentTimeMillis currentReplication getSmallestReplicatedBlockCount endTime startTime timeout LOG error String format timeout acceptableReplication currentReplication
beginUpload LOG info
Map String String env System getenv Map String String env
found
pattern Matcher matcher pattern matcher jar getAbsolutePath matcher LOG info jar getAbsolutePath found excluded pattern Matcher matcher pattern matcher jar getAbsolutePath matcher LOG info jar getAbsolutePath excluded excluded excluded checkSymlink jar
found excluded pattern Matcher matcher pattern matcher jar getAbsolutePath matcher LOG info jar getAbsolutePath excluded excluded excluded checkSymlink jar found excluded LOG info jar getAbsolutePath jar getAbsolutePath UploaderException jar getAbsolutePath
excluded pattern Matcher matcher pattern matcher jar getAbsolutePath matcher LOG info jar getAbsolutePath excluded excluded excluded checkSymlink jar excluded LOG info jar getAbsolutePath jar getAbsolutePath UploaderException jar getAbsolutePath LOG info jar getAbsolutePath
jar Files jar toPath java nio file Path link Files readSymbolicLink jar toPath java nio file Path jarPath Paths get jar getAbsolutePath String linkString link toString java nio file Path jarParent jarPath getParent java nio file Path linkPath jarParent jarParent resolve linkString java nio file Path linkPathParent linkPath linkPath getParent java nio file Path normalizedLinkPath linkPathParent linkPathParent normalize normalizedLinkPath jarParent normalize normalizedLinkPath
initialReplication Short parseShort parser getCommandLine getOptionValue finalReplication Short parseShort parser getCommandLine getOptionValue acceptableReplication Short parseShort parser getCommandLine getOptionValue timeout Integer parseInt parser getCommandLine getOptionValue parser getCommandLine ignoreSymlink String fs parser getCommandLine getOptionValue String path parser getCommandLine getOptionValue isFullPath path startsWith path startsWith fs fs conf getTrimmed FS_DEFAULT_NAME_KEY fs isFullPath LOG error printHelp opts
String countAccessQuery String sumPageviewQuery Statement st ResultSet rs st connection createStatement rs st executeQuery countAccessQuery rs next totalPageview rs getLong rs st executeQuery sumPageviewQuery rs next sumPageview rs getLong
String countAccessQuery String sumPageviewQuery Statement st ResultSet rs st connection createStatement rs st executeQuery countAccessQuery rs next totalPageview rs getLong rs st executeQuery sumPageviewQuery rs next sumPageview rs getLong LOG info totalPageview
tasksToPick Math min slotsPerHost Math ceil remainingSplits hosts size Split best Split tasksToPick Split
f String key pathToKey f key f
path String key pathToKey path
FileStatus path String key pathToKey path LOG LOG debug path List FileStatus result ArrayList FileStatus FileStatus fileStatus getFileStatus path fileStatus LOG LOG debug key ObjectListing objects store listObjects key maxKeys objectSummary objects String objKey objectSummary getKey objKey key LOG
List FileStatus result ArrayList FileStatus FileStatus fileStatus getFileStatus path fileStatus LOG LOG debug key ObjectListing objects store listObjects key maxKeys objectSummary objects String objKey objectSummary getKey objKey key LOG LOG debug objKey Path keyPath keyToPath objectSummary getKey makeQualified uri workingDir
ObjectListing objects store listObjects key maxKeys objectSummary objects String objKey objectSummary getKey objKey key LOG LOG debug objKey Path keyPath keyToPath objectSummary getKey makeQualified uri workingDir LOG LOG debug keyPath result add OSSFileStatus objectSummary getSize getDefaultBlockSize keyPath objectSummary getLastModified getTime keyPath username String objects key
objKey LOG LOG debug objKey Path keyPath keyToPath objectSummary getKey makeQualified uri workingDir LOG LOG debug keyPath result add OSSFileStatus objectSummary getSize getDefaultBlockSize keyPath objectSummary getLastModified getTime keyPath username prefix prefix LOG LOG debug prefix
Path f Path qualifiedPath f makeQualified uri workingDir String key pathToKey qualifiedPath
proxyHost clientConf setProxyHost proxyHost proxyPort clientConf setProxyPort proxyPort LOG warn clientConf setProxyPort LOG warn clientConf setProxyPort String proxyUsername conf getTrimmed PROXY_USERNAME_KEY String proxyPassword conf getTrimmed PROXY_PASSWORD_KEY proxyUsername proxyPassword String msg PROXY_USERNAME_KEY PROXY_PASSWORD_KEY
clientConf setProxyPort LOG warn clientConf setProxyPort String proxyUsername conf getTrimmed PROXY_USERNAME_KEY String proxyPassword conf getTrimmed PROXY_PASSWORD_KEY proxyUsername proxyPassword String msg PROXY_USERNAME_KEY PROXY_PASSWORD_KEY LOG error msg IllegalArgumentException msg clientConf setProxyUsername proxyUsername clientConf setProxyPassword proxyPassword clientConf setProxyDomain conf getTrimmed PROXY_DOMAIN_KEY clientConf setProxyWorkstation conf getTrimmed PROXY_WORKSTATION_KEY
srcKey dstKey CopyObjectResult copyResult ossClient copyObject bucketName srcKey bucketName dstKey statistics incrementWriteOps
tries tries instream FileInputStream file UploadPartRequest uploadRequest UploadPartRequest uploadRequest setBucketName bucketName uploadRequest setKey key uploadRequest setUploadId uploadId uploadRequest setInputStream instream uploadRequest setPartSize file length uploadRequest setPartNumber idx UploadPartResult uploadResult ossClient uploadPart uploadRequest statistics incrementWriteOps uploadResult getPartETag
conf String key defVal min v conf getInt key defVal Preconditions checkArgument v min String format key v min
conf String key defVal min v conf getLong key defVal Preconditions checkArgument v min String format key v min
Path smallSeekFile setPath size ContractTestUtils generateTestFile fs smallSeekFile size LOG info FSDataInputStream instream fs open smallSeekFile seekTimes LOG info i i seekTimes i pos size seekTimes i
Path smallSeekFile setPath size ContractTestUtils generateTestFile fs smallSeekFile size LOG info FSDataInputStream instream fs open smallSeekFile seekTimes LOG info i i seekTimes i pos size seekTimes i LOG info pos instream seek pos assertTrue pos instream getPos instream getPos pos
ContractTestUtils generateTestFile fs smallSeekFile size LOG info FSDataInputStream instream fs open smallSeekFile seekTimes LOG info i i seekTimes i pos size seekTimes i LOG info pos instream seek pos assertTrue pos instream getPos instream getPos pos LOG info instream getPos LOG info Random rand Random i i seekTimes i pos Math abs rand nextLong size
seekTimes LOG info i i seekTimes i pos size seekTimes i LOG info pos instream seek pos assertTrue pos instream getPos instream getPos pos LOG info instream getPos LOG info Random rand Random i i seekTimes i pos Math abs rand nextLong size LOG info pos instream seek pos assertTrue pos instream getPos instream getPos pos
bufLen sizeFlag String filename sizeFlag Path readTestFile setPath filename size sizeFlag ContractTestUtils generateTestFile fs readTestFile size
testListEmptyRootDirectory attempt maxAttempts attempt maxAttempts attempt testListEmptyRootDirectory attempt maxAttempts LOG info attempt maxAttempts Thread sleep Thread currentThread interrupt fail
List LogAggregationFileController fileControllers factory getConfiguredLogAggregationFileControllerList fileControllers fileControllers LOG info LOG info YarnConfiguration LOG_AGGREGATION_FILE_FORMATS fs FileSystem get conf previousTotal LogAggregationFileController fileController fileControllers Path remoteRootLogDir fileController getRemoteRootLogDir String suffix fileController getRemoteRootLogDirSuffix Path workingDir Path remoteRootLogDir LOG info fileController getClass getName
LOG info LOG info YarnConfiguration LOG_AGGREGATION_FILE_FORMATS fs FileSystem get conf previousTotal fileController Path remoteRootLogDir fileController getRemoteRootLogDir String suffix fileController getRemoteRootLogDirSuffix Path workingDir Path remoteRootLogDir LOG info fileController getClass getName LOG info remoteRootLogDir
LOG info LOG info YarnConfiguration LOG_AGGREGATION_FILE_FORMATS fs FileSystem get conf previousTotal fileController Path remoteRootLogDir fileController getRemoteRootLogDir String suffix fileController getRemoteRootLogDirSuffix Path workingDir Path remoteRootLogDir LOG info fileController getClass getName LOG info remoteRootLogDir LOG info suffix
Path workingDir Path remoteRootLogDir LOG info fileController getClass getName LOG info remoteRootLogDir LOG info suffix LOG info workingDir checkFilesAndSeedApps fs remoteRootLogDir suffix workingDir filterAppsByAggregatedStatus eligibleApplications size previousTotal workingDirs add workingDir previousTotal eligibleApplications size checkMaxEligible workingDirs eligibleApplications LOG info
checkFilesAndSeedApps fs remoteRootLogDir suffix workingDir filterAppsByAggregatedStatus eligibleApplications size previousTotal workingDirs add workingDir previousTotal eligibleApplications size checkMaxEligible workingDirs eligibleApplications LOG info workingDir workingDirs fs workingDir LOG error workingDir toString StringBuilder sb StringBuilder eligibleApplications
opts addOption maxTotalLogsSizeOpt opts addOption memoryOpt opts addOption verboseOpt opts addOption forceOpt opts addOption noProxyOpt CommandLineParser parser GnuParser CommandLine commandLine parser parse opts args commandLine HelpFormatter formatter HelpFormatter formatter printHelp opts System exit commandLine MAX_ELIGIBLE_APPS_OPTION maxEligible Integer parseInt commandLine getOptionValue MAX_ELIGIBLE_APPS_OPTION maxEligible
YarnClient client YarnClient createYarnClient client init getConf client start AppInfo it it AppInfo app it next ApplicationReport report client getApplicationReport ApplicationId fromString app getAppId LogAggregationStatus aggStatus report getLogAggregationStatus aggStatus LogAggregationStatus aggStatus LogAggregationStatus aggStatus LogAggregationStatus aggStatus LogAggregationStatus aggStatus LogAggregationStatus
YarnClient client YarnClient createYarnClient client init getConf client start AppInfo it it AppInfo app it next ApplicationReport report client getApplicationReport ApplicationId fromString app getAppId LogAggregationStatus aggStatus report getLogAggregationStatus aggStatus LogAggregationStatus aggStatus LogAggregationStatus aggStatus LogAggregationStatus aggStatus LogAggregationStatus aggStatus LogAggregationStatus LOG info app getAppId aggStatus it remove
AppInfo it it AppInfo app it next ApplicationReport report client getApplicationReport ApplicationId fromString app getAppId LogAggregationStatus aggStatus report getLogAggregationStatus aggStatus LogAggregationStatus aggStatus LogAggregationStatus aggStatus LogAggregationStatus aggStatus LogAggregationStatus aggStatus LogAggregationStatus LOG info app getAppId aggStatus it remove LOG info app getAppId aggStatus app setFinishTime report getFinishTime
fs Path Path FileStatus userIt fs userIt Path userLogPath userIt next getPath FileStatus appIt fs Path userLogPath appIt Path appLogPath appIt next getPath FileStatus files fs listStatus appLogPath files eligible totalFileSize FileStatus files getPath appLogPath eligible
FileStatus files fs listStatus appLogPath files eligible totalFileSize FileStatus file files file getName appLogPath getName eligible LOG info appLogPath getName totalFileSize file getLen totalFileSize eligible
totalFileSize file file getName appLogPath getName eligible LOG info appLogPath getName totalFileSize file getLen totalFileSize maxTotalLogsSize eligible LOG info appLogPath getName totalFileSize maxTotalLogsSize eligible
totalFileSize maxTotalLogsSize eligible LOG info appLogPath getName totalFileSize maxTotalLogsSize eligible LOG info appLogPath getName userLogPath getName AppInfo context AppInfo context setAppId appLogPath getName context setUser userLogPath getName context setSuffix suffix context setRemoteRootLogDir remoteRootLogDir context setWorkingDir workingDir eligibleApplications add context
LOG info appLogPath getName totalFileSize maxTotalLogsSize LOG info appLogPath getName userLogPath getName AppInfo context AppInfo context setAppId appLogPath getName context setUser userLogPath getName context setSuffix suffix context setRemoteRootLogDir remoteRootLogDir context setWorkingDir workingDir eligibleApplications add context LOG info appLogPath getName files length minNumLogFiles
LOG info appLogPath getName userLogPath getName AppInfo context AppInfo context setAppId appLogPath getName context setUser userLogPath getName context setSuffix suffix context setRemoteRootLogDir remoteRootLogDir context setWorkingDir workingDir eligibleApplications add context LOG info appLogPath getName files length minNumLogFiles
localScript String dsArgs ApplicationMaster getProtectionDomain getCodeSource getLocation getPath Integer toString eligibleApplications size Long toString memory localScript getAbsolutePath
args handleOpts args Integer exitCode UserGroupInformation loginUser UserGroupInformation getLoginUser loginUser
checkNotEmpty lastProvider lastProvider getCredentials AmazonClientException lastException provider AWSCredentials credentials provider getCredentials Preconditions checkNotNull credentials provider credentials credentials credentials lastProvider provider LOG debug provider credentials e lastException lastException e
lastProvider getCredentials AmazonClientException lastException provider AWSCredentials credentials provider getCredentials Preconditions checkNotNull credentials provider credentials credentials credentials lastProvider provider LOG debug provider credentials e lastException lastException e LOG debug provider e toString AmazonClientException e
key p getDelayKeyProbability delay key contains getDelayKeySubstring delay delay trueWithProbability p
deleteObjectRequest String key deleteObjectRequest getKey
item String key item getKey getKey key
String String ancestor String child Path prefixCandidate Path child getParent Path ancestorPath Path ancestor Preconditions checkArgument child startsWith ancestor child ancestor prefixCandidate Path nextParent prefixCandidate getParent nextParent ancestorPath String prefix prefixCandidate toString prefix
S3Object getObject var1 maybeFail S3Object o getObject var1
S3Object getObject bucketName key S3Object o getObject bucketName key
retrying Preconditions checkArgument retrying retryCount Exception caught RetryPolicy RetryAction retryAction shouldRetry retryCount
path recursive String key maybeAddTrailingSlash pathToKey path String delimiter recursive recursive
delta upload getProgress getBytesTransferred lastBytesTransferred delta
blockCount blockCount
multiPartUpload bytes putObject bytesSubmitted bytes multiPartUpload uploadCurrentBlock List PartETag partETags multiPartUpload waitForAllPartUploads bytes bytesSubmitted multiPartUpload partETags bytes multiPartUpload complete partETags LOG info key statistics commitUploaded bytes
multiPartUpload uploadCurrentBlock List PartETag partETags multiPartUpload waitForAllPartUploads bytes bytesSubmitted multiPartUpload partETags bytes multiPartUpload complete partETags LOG info key statistics commitUploaded bytes LOG debug key writeOperationHelper ioe multiPartUpload multiPartUpload abort writeOperationHelper writeFailed ioe
name bucket name getHost
initCannedAcls conf doBucketProbing inputPolicy S3AInputPolicy getPolicy conf getTrimmed INPUT_FADVISE INPUT_FADV_NORMAL LOG debug inputPolicy changeDetectionPolicy ChangeDetectionPolicy getPolicy conf LOG debug changeDetectionPolicy magicCommitterEnabled conf getBoolean CommitConstants MAGIC_COMMITTER_ENABLED CommitConstants DEFAULT_MAGIC_COMMITTER_ENABLED LOG debug magicCommitterEnabled committerIntegration MagicCommitIntegration magicCommitterEnabled selectBinding SelectBinding writeHelper blockUploadEnabled conf getBoolean FAST_UPLOAD blockUploadEnabled LOG warn blockOutputBuffer conf getTrimmed FAST_UPLOAD_BUFFER DEFAULT_FAST_UPLOAD_BUFFER partSize ensureOutputParameterInRange MULTIPART_SIZE partSize
LOG debug magicCommitterEnabled committerIntegration MagicCommitIntegration magicCommitterEnabled selectBinding SelectBinding writeHelper blockUploadEnabled conf getBoolean FAST_UPLOAD blockUploadEnabled LOG warn blockOutputBuffer conf getTrimmed FAST_UPLOAD_BUFFER DEFAULT_FAST_UPLOAD_BUFFER partSize ensureOutputParameterInRange MULTIPART_SIZE partSize blockFactory S3ADataBlocks createFactory blockOutputBuffer blockOutputActiveBlocks intOption conf FAST_UPLOAD_ACTIVE_BLOCKS DEFAULT_FAST_UPLOAD_ACTIVE_BLOCKS LOG debug blockOutputBuffer partSize blockOutputActiveBlocks authDirTtl conf getTimeDuration METADATASTORE_METADATA_TTL DEFAULT_METADATASTORE_METADATA_TTL TimeUnit MILLISECONDS ttlTimeProvider S3Guard TtlTimeProvider authDirTtl setMetadataStore S3Guard getMetadataStore ttlTimeProvider allowAuthoritativeMetadataStore conf getBoolean METADATASTORE_AUTHORITATIVE DEFAULT_METADATASTORE_AUTHORITATIVE
seconds Preconditions checkArgument seconds Date purgeBefore Date Date getTime seconds
client Preconditions checkNotNull client
inputPolicy Objects requireNonNull inputPolicy
Path makeQualified Path path Path q makeQualified path q String urlString q toUri toString urlString Path
src dst src dst bytesCopied innerRename src dst
S3AFileStatus srcStatus innerGetFileStatus src StatusProbeEnum ALL LOG debug dst RenameFailedException src dst withExitCode srcStatus isFile S3AFileStatus dstStatus dstStatus innerGetFileStatus dst StatusProbeEnum ALL srcStatus dstStatus isFile RenameFailedException src dst withExitCode srcStatus isFile dstStatus RenameFailedException src dst withExitCode dstStatus isFile RenameFailedException src dst withExitCode
Path source Path dest Path src qualify source Path dst qualify dest
key GetObjectMetadataRequest request GetObjectMetadataRequest bucket key generateSSECustomerKey ifPresent request setSSECustomerKey key incrementStatistic OBJECT_METADATA_REQUESTS
incrementReadOperations incrementStatistic OBJECT_LIST_REQUESTS
putObjectRequest len getPutRequestLength putObjectRequest
putObjectRequest len getPutRequestLength putObjectRequest
keysToDelete LOG LOG debug keysToDelete size keysToDelete
f String key pathToKey f key f
Path f Path path qualify f String key pathToKey path
S3AFileStatus Path f Path path qualify f String key pathToKey path LOG debug path entryPoint INVOCATION_LIST_STATUS List S3AFileStatus result S3AFileStatus fileStatus innerGetFileStatus path StatusProbeEnum ALL fileStatus key key key allowAuthoritative allowAuthoritative f DirListingMetadata dirMeta S3Guard listChildrenWithTtl metadataStore path ttlTimeProvider allowAuthoritative allowAuthoritative dirMeta dirMeta S3Guard dirMetaToStatuses dirMeta S3ListRequest request createListObjectsRequest key
key key key allowAuthoritative allowAuthoritative f DirListingMetadata dirMeta S3Guard listChildrenWithTtl metadataStore path ttlTimeProvider allowAuthoritative allowAuthoritative dirMeta dirMeta S3Guard dirMetaToStatuses dirMeta S3ListRequest request createListObjectsRequest key LOG debug key Listing FileStatusListingIterator files listing createFileStatusListingIterator path request ACCEPT_ALL Listing AcceptAllButSelfAndS3nDirs path result ArrayList files getBatchSize files result add files next S3Guard dirListingUnion metadataStore path result dirMeta allowAuthoritative ttlTimeProvider
Path p Path f qualify p
Path f Path path qualify f String key pathToKey path
S3AFileStatus Path f needEmptyDirectoryFlag Set Path path qualify f String key pathToKey path LOG debug path key needEmptyDirectoryFlag allowAuthoritative allowAuthoritative path PathMetadata pm pm S3Guard getWithTtl metadataStore path ttlTimeProvider needEmptyDirectoryFlag allowAuthoritative Set Path tombstones Collections emptySet pm S3AFileStatus msStatus pm getFileStatus pm OffsetDateTime deletedAt OffsetDateTime ofInstant Instant ofEpochMilli msStatus getModificationTime ZoneOffset UTC FileNotFoundException path deletedAt msStatus allowAuthoritative
allowAuthoritative allowAuthoritative path PathMetadata pm pm S3Guard getWithTtl metadataStore path ttlTimeProvider needEmptyDirectoryFlag allowAuthoritative Set Path tombstones Collections emptySet pm S3AFileStatus msStatus pm getFileStatus pm OffsetDateTime deletedAt OffsetDateTime ofInstant Instant ofEpochMilli msStatus getModificationTime ZoneOffset UTC FileNotFoundException path deletedAt msStatus allowAuthoritative LOG debug path validTime ttlTimeProvider getNow ttlTimeProvider getMetadataTtl msModTime msStatus getModificationTime msModTime validTime
Set Path tombstones Collections emptySet pm S3AFileStatus msStatus pm getFileStatus pm OffsetDateTime deletedAt OffsetDateTime ofInstant Instant ofEpochMilli msStatus getModificationTime ZoneOffset UTC FileNotFoundException path deletedAt msStatus probes LOG debug path validTime ttlTimeProvider getNow ttlTimeProvider getMetadataTtl msModTime msStatus getModificationTime msModTime validTime LOG debug path S3AFileStatus s3AFileStatus s3GetFileStatus path key probes tombstones needEmptyDirectoryFlag s3ModTime s3AFileStatus getModificationTime
s3ModTime s3AFileStatus getModificationTime s3ModTime msModTime LOG debug path s3ModTime msModTime S3Guard putAndReturn metadataStore s3AFileStatus ttlTimeProvider S3Guard refreshEntry metadataStore pm s3AFileStatus ttlTimeProvider s3AFileStatus LOG warn path msStatus pm msStatus DirListingMetadata children S3Guard listChildrenWithTtl metadataStore path ttlTimeProvider allowAuthoritative children
path key StatusProbeEnum probes needEmptyDirectoryFlag LOG debug path Preconditions checkArgument needEmptyDirectoryFlag probes contains StatusProbeEnum List path key key probes contains StatusProbeEnum ObjectMetadata meta getObjectMetadata key
listSize Math min tombstones size Math max maxKeys S3ListRequest request createListObjectsRequest dirKey listSize S3ListResult listResult listObjects request listResult tombstones LOG LOG debug listResult logAtDebug LOG listResult dirKey tombstones S3AFileStatus Tristate TRUE path username S3AFileStatus Tristate FALSE path username LOG debug S3AFileStatus Tristate TRUE path username
entryPoint INVOCATION_COPY_FROM_LOCAL_FILE
entryPoint INVOCATION_COPY_FROM_LOCAL_FILE
String srcKey String dstKey srcAttributes readContext LOG debug srcKey dstKey ChangeTracker changeTracker ChangeTracker keyToQualifiedPath srcKey toString changeDetectionPolicy readContext instrumentation newInputStreamStatistics getVersionMismatchCounter srcAttributes String action srcKey dstKey Invoker readInvoker readContext getReadInvoker ObjectMetadata srcom srcom once action srcKey getObjectMetadata srcKey changeTracker readInvoker
srcom String sourceKMSId srcom getSSEAwsKmsKeyId sourceKMSId
activeState stateToClose S3Guard initiateBulkWrite metadataStore isDir BulkOperationState OperationType Mkdir BulkOperationState OperationType Put keyToPath key activeState stateToClose S3Guard addAncestors metadataStore p ttlTimeProvider activeState S3AFileStatus status createUploadFileStatus p isDir length getDefaultBlockSize p username eTag versionId authoritative isDir status setIsEmptyDirectory Tristate TRUE authoritative allowAuthoritative p authoritative S3Guard putAndReturn metadataStore status ttlTimeProvider activeState S3Guard putAuthDirectoryMarker metadataStore status ttlTimeProvider activeState waitForCompletionIgnoringExceptions deletion
Path f length Preconditions checkArgument length entryPoint INVOCATION_GET_FILE_CHECKSUM Path path qualify f
Path f entryPoint INVOCATION_LIST_FILES Path path qualify f
Path f recursive entryPoint INVOCATION_LIST_FILES Path path qualify f LOG debug path recursive
Path f entryPoint INVOCATION_LIST_LOCATED_STATUS Path path qualify f
upload String destKey String uploadId destKey upload getKey uploadId upload getUploadId DateFormat df SimpleDateFormat
Path rawPath parameters Path path qualify rawPath Configuration options parameters getOptions Set String mandatoryKeys parameters getMandatoryKeys String sql options get SelectConstants SELECT_SQL isSelect sql isSelect rejectUnknownMandatoryKeys mandatoryKeys InternalSelectConstants SELECT_OPTIONS path rejectUnknownMandatoryKeys mandatoryKeys InternalConstants STANDARD_OPENFILE_KEYS path FileStatus providedStatus parameters getStatus S3AFileStatus fileStatus providedStatus Preconditions checkArgument path equals providedStatus getPath path providedStatus providedStatus S3AFileStatus
Set String mandatoryKeys parameters getMandatoryKeys String sql options get SelectConstants SELECT_SQL isSelect sql isSelect rejectUnknownMandatoryKeys mandatoryKeys InternalSelectConstants SELECT_OPTIONS path rejectUnknownMandatoryKeys mandatoryKeys InternalConstants STANDARD_OPENFILE_KEYS path FileStatus providedStatus parameters getStatus S3AFileStatus fileStatus providedStatus Preconditions checkArgument path equals providedStatus getPath path providedStatus providedStatus S3AFileStatus LOG debug providedStatus fileStatus S3AFileStatus providedStatus providedStatus
rejectUnknownMandatoryKeys mandatoryKeys InternalSelectConstants SELECT_OPTIONS path rejectUnknownMandatoryKeys mandatoryKeys InternalConstants STANDARD_OPENFILE_KEYS path FileStatus providedStatus parameters getStatus S3AFileStatus fileStatus providedStatus Preconditions checkArgument path equals providedStatus getPath path providedStatus providedStatus S3AFileStatus LOG debug providedStatus fileStatus S3AFileStatus providedStatus providedStatus S3ALocatedFileStatus LOG debug providedStatus fileStatus S3ALocatedFileStatus providedStatus toS3AFileStatus
diff targetPos pos diff available wrappedStream available forwardSeekRange Math max readahead available remainingInCurrentRequest remainingInCurrentRequest forwardSeekLimit Math min remainingInCurrentRequest forwardSeekRange skipForward remainingInCurrentRequest diff forwardSeekLimit skipForward LOG debug uri diff streamStatistics seekForwards diff skipped wrappedStream skip diff skipped pos skipped incrementBytesRead diff pos targetPos
remaining remainingInCurrentRequest
name MutableMetric metric lookupMetric name metric
name MutableMetric metric lookupMetric name metric
op count updated opsCount get op addAndGet count
AWSCredentialProviderList binding conf S3xLoginHelper rejectSecretsInURIs binding AWSCredentialProviderList credentials buildAWSProviderList binding conf AWS_CREDENTIALS_PROVIDER STANDARD_AWS_PROVIDERS HashSet
conf String key defVal min v conf getInt key defVal Preconditions checkArgument v min String format key v min
conf String key defVal min v conf getLong key defVal Preconditions checkArgument v min String format key v min
conf String key defVal min v conf getLongBytes key defVal Preconditions checkArgument v min String format key v min
String bucket Preconditions checkArgument StringUtils isNotEmpty bucket String bucketPrefix FS_S3A_BUCKET_PREFIX bucket
Preconditions checkArgument StringUtils isNotEmpty bucket String bucketPrefix FS_S3A_BUCKET_PREFIX bucket LOG debug bucketPrefix Configuration dest Configuration source String String entry source String key entry getKey String value entry getValue key bucketPrefix bucketPrefix key String stripped key substring bucketPrefix length stripped stripped LOG debug key String origin StringUtils join source getPropertySources key String generic FS_S3A_PREFIX stripped
initProxySupport conf bucket awsConf initUserAgent conf awsConf String configKey configKey configKey configKey configKey String signerOverride conf getTrimmed configKey signerOverride
conf awsConf awsConf setMaxConnections intOption conf MAXIMUM_CONNECTIONS DEFAULT_MAXIMUM_CONNECTIONS initProtocolSettings conf awsConf awsConf setMaxErrorRetry intOption conf MAX_ERROR_RETRIES DEFAULT_MAX_ERROR_RETRIES awsConf setConnectionTimeout intOption conf ESTABLISH_TIMEOUT DEFAULT_ESTABLISH_TIMEOUT awsConf setSocketTimeout intOption conf SOCKET_TIMEOUT DEFAULT_SOCKET_TIMEOUT sockSendBuffer intOption conf SOCKET_SEND_BUFFER DEFAULT_SOCKET_SEND_BUFFER sockRecvBuffer intOption conf SOCKET_RECV_BUFFER DEFAULT_SOCKET_RECV_BUFFER requestTimeoutMillis conf getTimeDuration REQUEST_TIMEOUT DEFAULT_REQUEST_TIMEOUT TimeUnit SECONDS TimeUnit MILLISECONDS requestTimeoutMillis
awsConf setMaxConnections intOption conf MAXIMUM_CONNECTIONS DEFAULT_MAXIMUM_CONNECTIONS initProtocolSettings conf awsConf awsConf setMaxErrorRetry intOption conf MAX_ERROR_RETRIES DEFAULT_MAX_ERROR_RETRIES awsConf setConnectionTimeout intOption conf ESTABLISH_TIMEOUT DEFAULT_ESTABLISH_TIMEOUT awsConf setSocketTimeout intOption conf SOCKET_TIMEOUT DEFAULT_SOCKET_TIMEOUT sockSendBuffer intOption conf SOCKET_SEND_BUFFER DEFAULT_SOCKET_SEND_BUFFER sockRecvBuffer intOption conf SOCKET_RECV_BUFFER DEFAULT_SOCKET_RECV_BUFFER requestTimeoutMillis conf getTimeDuration REQUEST_TIMEOUT DEFAULT_REQUEST_TIMEOUT TimeUnit SECONDS TimeUnit MILLISECONDS requestTimeoutMillis Integer MAX_VALUE LOG debug requestTimeoutMillis Integer MAX_VALUE requestTimeoutMillis Integer MAX_VALUE awsConf setRequestTimeout requestTimeoutMillis awsConf setSocketBufferSizeHints sockSendBuffer sockRecvBuffer String signerOverride conf getTrimmed SIGNING_ALGORITHM signerOverride
proxyHost awsConf setProxyHost proxyHost proxyPort awsConf setProxyPort proxyPort conf LOG warn awsConf setProxyPort LOG warn awsConf setProxyPort String proxyUsername lookupPassword bucket conf PROXY_USERNAME String proxyPassword lookupPassword bucket conf PROXY_PASSWORD proxyUsername proxyPassword String msg PROXY_USERNAME PROXY_PASSWORD
LOG warn awsConf setProxyPort LOG warn awsConf setProxyPort String proxyUsername lookupPassword bucket conf PROXY_USERNAME String proxyPassword lookupPassword bucket conf PROXY_PASSWORD proxyUsername proxyPassword String msg PROXY_USERNAME PROXY_PASSWORD LOG error msg IllegalArgumentException msg awsConf setProxyUsername proxyUsername awsConf setProxyPassword proxyPassword awsConf setProxyDomain conf getTrimmed PROXY_DOMAIN awsConf setProxyWorkstation conf getTrimmed PROXY_WORKSTATION
LOG warn awsConf setProxyPort String proxyUsername lookupPassword bucket conf PROXY_USERNAME String proxyPassword lookupPassword bucket conf PROXY_PASSWORD proxyUsername proxyPassword String msg PROXY_USERNAME PROXY_PASSWORD LOG error msg IllegalArgumentException msg awsConf setProxyUsername proxyUsername awsConf setProxyPassword proxyPassword awsConf setProxyDomain conf getTrimmed PROXY_DOMAIN awsConf setProxyWorkstation conf getTrimmed PROXY_WORKSTATION LOG LOG debug awsConf getProxyHost awsConf getProxyPort String valueOf awsConf getProxyUsername awsConf getProxyPassword awsConf getProxyDomain awsConf getProxyWorkstation
conf Collection String customCredentials conf getStringCollection S3A_SECURITY_CREDENTIAL_PROVIDER_PATH Collection String hadoopCredentials conf getStringCollection CREDENTIAL_PROVIDER_PATH customCredentials List String all Lists newArrayList customCredentials all addAll hadoopCredentials String joined StringUtils join all
String bucket String genericKey String baseKey genericKey startsWith FS_S3A_PREFIX genericKey substring FS_S3A_PREFIX length genericKey String k FS_S3A_BUCKET_PREFIX bucket baseKey
Map Class Exception RetryPolicy createExceptionMap Map Class Exception RetryPolicy b createExceptionMap Configuration conf getConfiguration limit conf getInt S3GUARD_CONSISTENCY_RETRY_LIMIT S3GUARD_CONSISTENCY_RETRY_LIMIT_DEFAULT interval conf getTimeDuration S3GUARD_CONSISTENCY_RETRY_INTERVAL S3GUARD_CONSISTENCY_RETRY_INTERVAL_DEFAULT TimeUnit MILLISECONDS RetryPolicy retryPolicy retryUpToMaximumCountWithProportionalSleep limit interval TimeUnit MILLISECONDS
Collection String prefixes getCommonPrefixes Collection S3ObjectSummary summaries getObjectSummaries
log Collection String prefixes getCommonPrefixes Collection S3ObjectSummary summaries getObjectSummaries log debug prefixes size summaries size S3ObjectSummary summaries
uploadId partETags checkNotNull uploadId checkNotNull partETags
prefix LOG debug prefix count List MultipartUpload multipartUploads owner listMultipartUploads prefix
uploadId partNumber size uploadStream sourceFile checkNotNull uploadId checkArgument uploadStream sourceFile checkArgument size size checkArgument partNumber DEFAULT_UPLOAD_PART_COUNT_LIMIT partNumber
uploadId partETags checkNotNull uploadId checkNotNull partETags
request String String bucketName request getBucketName Preconditions checkArgument bucket equals bucketName bucketName
source request String String bucketName request getBucketName Preconditions checkArgument bucket equals bucketName bucketName LOG LOG debug source request getExpression
AWSSecurityTokenServiceClientBuilder builder credentials awsConf stsEndpoint stsRegion AWSSecurityTokenServiceClientBuilder builder AWSSecurityTokenServiceClientBuilder standard Preconditions checkArgument credentials builder withClientConfiguration awsConf builder withCredentials credentials destIsStandardEndpoint STS_STANDARD equals stsEndpoint isNotEmpty stsEndpoint destIsStandardEndpoint Preconditions checkArgument isNotEmpty stsRegion stsEndpoint
String customSigner String parts customSigner split parts parts parts String message customSigner LOG error message IllegalArgumentException message parts maybeRegisterSigner parts parts ownerConf parts Class AwsSignerInitializer clazz clazz Class AwsSignerInitializer ownerConf getClassByName parts e RuntimeException String format parts parts e
Token AbstractS3ATokenIdentifier policy encryptionSecrets renewer requireServiceStarted AbstractS3ATokenIdentifier tokenIdentifier createTokenIdentifier policy encryptionSecrets renewer tokenIdentifier Token AbstractS3ATokenIdentifier token Token tokenIdentifier secretManager token setKind getKind
serviceInit conf serviceInit conf checkState hasDelegationTokenBinding conf E_DELEGATION_TOKENS_DISABLED Class AbstractDelegationTokenBinding binding conf getClass DelegationConstants DELEGATION_TOKEN_BINDING SessionTokenBinding AbstractDelegationTokenBinding tokenBinding binding newInstance tokenBinding bindToFileSystem getCanonicalUri getStoreContext getPolicyProvider tokenBinding init conf tokenBindingName tokenBinding getKind toString
serviceStart serviceStart tokenBinding start bindToAnyDelegationToken
AbstractS3ATokenIdentifier token checkState credentialProviders isPresent E_ALREADY_DEPLOYED boundDT Optional of token AbstractS3ATokenIdentifier dti extractIdentifier token
Token credentials Text service Text LOG debug service Token token credentials getToken service token Text tokenKind token getKind
numThreads Preconditions checkArgument numThreads
MaybeIOE commit commit String operationState LOG debug commit MaybeIOE outcome String destKey commit validate destKey commit getDestinationKey l innerCommit commit operationState
commit String destKey commit getDestinationKey String origin commit getFilename commit getFilename String uploadId commit getUploadId
pendingDir Preconditions checkArgument pendingDir
RemoteIterator LocatedFileStatus pendingFiles pendingFiles ls pendingDir recursive LOG info pendingDir MaybeIOE NONE MaybeIOE outcome MaybeIOE NONE pendingFiles LOG debug pendingDir pendingFiles Path pendingFile pendingFiles next getPath pendingFile abortSingleCommit SinglePendingCommit load fs pendingFile
length localFile length SinglePendingCommit commitData SinglePendingCommit commitData setDestinationKey destKey commitData setBucket fs getBucket commitData touch System currentTimeMillis commitData setUploadId uploadId commitData setUri destURI commitData setText partition partition commitData setLength length offset numParts length uploadPartSize length uploadPartSize numParts numParts numParts PathIOException destPath toString String format numParts length
partNumber partNumber numParts partNumber size Math min length offset uploadPartSize UploadPartRequest part part writeOperations newUploadPartRequest destKey uploadId partNumber size localFile offset part setLastPart partNumber numParts UploadPartResult partResult writeOperations uploadPart part offset uploadPartSize parts add partResult getPartETag commitData bindCommitData parts statistics commitUploaded length progress progress threw commitData threw uploadId
fs fs String fsUri fs getUri toString
PutTracker path String key List String elements splitPathToElements path PutTracker tracker elements elements String destKey keyOfFinalDestination elements key String pendingsetPath key CommitConstants PENDING_SUFFIX owner getInstrumentation incrementCounter Statistic COMMITTER_MAGIC_FILES_CREATED tracker MagicCommitTracker path owner getBucket key destKey pendingsetPath owner getWriteOperationHelper
PathOutputCommitter createTaskCommitter fileSystem outputPath context AbstractS3ACommitterFactory factory chooseCommitterFactory fileSystem outputPath context getConfiguration factory PathOutputCommitter committer factory createTaskCommitter fileSystem outputPath context
AbstractS3ACommitterFactory fileSystem Configuration taskConf AbstractS3ACommitterFactory factory Configuration fsConf fileSystem getConf String name fsConf getTrimmed FS_S3A_COMMITTER_NAME COMMITTER_NAME_FILE name taskConf getTrimmed FS_S3A_COMMITTER_NAME name
futures size futures size
Future futures size futures size LOG debug size oldNumFinished numFinished futures stream filter Future isDone count oldNumFinished numFinished
uploadId parts bytesWritten Preconditions checkArgument StringUtils isNotEmpty uploadId uploadId Preconditions checkArgument parts Preconditions checkArgument parts isEmpty SinglePendingCommit commitData SinglePendingCommit commitData touch System currentTimeMillis commitData setDestinationKey getDestKey commitData setBucket bucket commitData setUri path toUri toString commitData setUploadId uploadId commitData setText commitData setLength bytesWritten commitData bindCommitData parts bytes commitData toBytes
uploadId parts bytesWritten Preconditions checkArgument StringUtils isNotEmpty uploadId uploadId Preconditions checkArgument parts Preconditions checkArgument parts isEmpty SinglePendingCommit commitData SinglePendingCommit commitData touch System currentTimeMillis commitData setDestinationKey getDestKey commitData setBucket bucket commitData setUri path toUri toString commitData setUploadId uploadId commitData setText commitData setLength bytesWritten commitData bindCommitData parts bytes commitData toBytes LOG info path toUri parts size pendingPartKey bytesWritten
context context PendingSet commits innerCommitTask context
Pair PendingSet List Pair LocatedFileStatus IOException loaded actions loadSinglePendingCommits taskAttemptPath PendingSet pendingSet loaded getKey List Pair LocatedFileStatus IOException failures loaded getValue failures LOG error abortPendingUploads context pendingSet getCommits failures get getValue String jobId String valueOf context getJobID String taskId String valueOf context getTaskAttemptID commit pendingSet getCommits commit setJobId jobId commit setTaskId taskId Path jobAttemptPath getJobAttemptPath context TaskAttemptID taskAttemptID context getTaskAttemptID Path taskOutcomePath Path jobAttemptPath taskAttemptID getTaskID toString CommitConstants PENDINGSET_SUFFIX
context Path outputPath getOutputPath FileSystem fs getDestFS ConflictResolution conflictResolution getConflictResolutionMode context fs getConf
preCommitJob context pending preCommitJob context pending Path outputPath getOutputPath FileSystem fs getDestFS Configuration fsConf fs getConf context fsConf fs outputPath
Map Path String partitions ConcurrentHashMap FileSystem sourceFS pending getSourceFS Tasks Submitter submitter buildSubmitter context Tasks pending submitter path PendingSet pendingSet PendingSet load sourceFS path Path lastParent commit pendingSet Path parent commit destinationPath getParent parent parent lastParent partitions put parent lastParent parent FileSystem fs getDestFS Tasks partitions submitter
context Path attemptPath getTaskAttemptPath context Preconditions checkNotNull attemptPath
Path workPath getWorkPath workPath
context context Path attemptPath getTaskAttemptPath context FileSystem fs getTaskAttemptFilesystem context FileStatus stats fs listStatus attemptPath
context context count commitTaskInternal context getTaskOutput context
context LOG debug getRole Configuration conf context getConfiguration Path attemptPath getTaskAttemptPath context FileSystem attemptFS getTaskAttemptFilesystem context
context taskOutput LOG debug getRole Configuration conf context getConfiguration Path attemptPath getTaskAttemptPath context FileSystem attemptFS getTaskAttemptFilesystem context LOG debug getRole attemptPath Path commitsAttemptPath wrappedCommitter getTaskAttemptPath context FileSystem commitsFS commitsAttemptPath getFileSystem conf commitCount taskOutput size Queue SinglePendingCommit commits ConcurrentLinkedQueue
context taskOutput LOG debug getRole Configuration conf context getConfiguration Path attemptPath getTaskAttemptPath context FileSystem attemptFS getTaskAttemptFilesystem context LOG debug getRole attemptPath Path commitsAttemptPath wrappedCommitter getTaskAttemptPath context FileSystem commitsFS commitsAttemptPath getFileSystem conf commitCount taskOutput size Queue SinglePendingCommit commits ConcurrentLinkedQueue LOG info getRole attemptPath
LOG warn getRole threw context progress PendingSet pendingCommits PendingSet commitCount context stat Path path stat getPath File localFile File path toUri getPath String relative Paths getRelativePath attemptPath path String partition Paths getPartition relative String key getFinalKey relative context Path destPath getDestS3AFS keyToQualifiedPath key SinglePendingCommit commit getCommitOperations uploadFileToPendingCommit localFile destPath partition uploadPartSize context
PendingSet pendingCommits PendingSet commitCount context stat Path path stat getPath File localFile File path toUri getPath String relative Paths getRelativePath attemptPath path String partition Paths getPartition relative String key getFinalKey relative context Path destPath getDestS3AFS keyToQualifiedPath key SinglePendingCommit commit getCommitOperations uploadFileToPendingCommit localFile destPath partition uploadPartSize context LOG debug getRole commit commits add commit SinglePendingCommit commit commits pendingCommits add commit
File localFile File path toUri getPath String relative Paths getRelativePath attemptPath path String partition Paths getPartition relative String key getFinalKey relative context Path destPath getDestS3AFS keyToQualifiedPath key SinglePendingCommit commit getCommitOperations uploadFileToPendingCommit localFile destPath partition uploadPartSize context LOG debug getRole commit commits add commit SinglePendingCommit commit commits pendingCommits add commit LOG debug pendingCommits size commitsAttemptPath pendingCommits save commitsFS commitsAttemptPath threw
path description LOG error description getJobContext getJobID path limit RemoteIterator LocatedFileStatus lf getDestFS listFiles path LOG info limit lf limit LocatedFileStatus status lf next
DeleteObjectsRequest deleteRequest List DeleteObjectsRequest KeyVersion keys deleteRequest getKeys size keys size incrementStatistic STORE_IO_THROTTLED size instrumentation addValueToQuantiles STORE_IO_THROTTLE_RATE size
copyResult String newRevisionId policy getRevisionId copyResult
executeOnlyOnce StoreContext context getStoreContext Path path status getPath
executeOnlyOnce StoreContext context getStoreContext Path path status getPath LOG debug path recursive LOG debug status isFile status isEmptyDirectory Tristate TRUE String key context pathToKey path status
Path path status getPath LOG debug path recursive LOG debug status isFile status isEmptyDirectory Tristate TRUE String key context pathToKey path status LOG debug path checkArgument status isEmptyDirectory Tristate UNKNOWN key key key key LOG error status getPath recursive recursive status isEmptyDirectory Tristate PathIsNotEmptyDirectoryException path toString status isEmptyDirectory Tristate TRUE
LOG debug path checkArgument status isEmptyDirectory Tristate UNKNOWN key key key key LOG error status getPath recursive recursive status isEmptyDirectory Tristate PathIsNotEmptyDirectoryException path toString status isEmptyDirectory Tristate LOG debug path deleteObjectAtPath path key deleteDirectoryTree path key
path operationState S3Guard initiateBulkWrite metadataStore BulkOperationState OperationType Delete path resetDeleteList deleteFuture
LOG debug dirKey RemoteIterator S3ALocatedFileStatus locatedFiles callbacks listFilesAndEmptyDirectories path status locatedFiles S3AFileStatus child locatedFiles next toS3AFileStatus queueForDeletion child LOG debug submitNextBatch maybeAwaitCompletion deleteFuture callbacks path LOG debug RemoteIterator S3AFileStatus objects callbacks listObjects path dirKey objects extraFilesDeleted queueForDeletion deletionKey objects next extraFilesDeleted
maybeAwaitCompletion deleteFuture callbacks path LOG debug RemoteIterator S3AFileStatus objects callbacks listObjects path dirKey objects extraFilesDeleted queueForDeletion deletionKey objects next extraFilesDeleted LOG debug extraFilesDeleted submitNextBatch maybeAwaitCompletion deleteFuture LOG metadataStore deleteSubtree path operationState IOUtils cleanupWithLogger LOG operationState
state List keyList List Path pathList auditDeletedKeys LOG DeleteObjectsResult result List Path undeletedObjects ArrayList keyList result Invoker once status getPath toString callbacks removeKeys keyList undeletedObjects state auditDeletedKeys pathList metadataStore deletePaths pathList state auditDeletedKeys result List DeleteObjectsResult DeletedObject deletedObjects result getDeletedObjects deletedObjects size keyList size LOG warn keyList size deletedObjects size DeleteObjectsResult DeletedObject del deletedObjects keyList removeIf kv kv getKey equals del getKey kv keyList
List Path List Path removed ArrayList Iterator Map Entry Path Marker entries surplusMarkers entrySet iterator entries Map Entry Path Marker entry entries next Path path entry getKey path entries remove
String srcKey String dstKey DirMarkerTracker dirMarkerTracker LOG debug dirMarkerTracker StoreContext storeContext getStoreContext Map Path DirMarkerTracker Marker leafMarkers dirMarkerTracker getLeafMarkers Map Path DirMarkerTracker Marker surplus dirMarkerTracker getSurplusMarkers DurationInfo duration DurationInfo LOG leafMarkers size surplus size DirMarkerTracker Marker entry leafMarkers Path source entry getPath String key entry getKey String newDestKey dstKey key substring srcKey length Path childDestPath storeContext keyToPath newDestKey
List List Path List Path undeletedObjects ArrayList
List keys List Path List Path undeletedObjects ArrayList LOG LOG debug keys size keys
nonauth Queue DDBPathMetadata queue ArrayDeque isRoot path isRoot DDBPathMetadata baseData metastore get path baseData ExitUtil ExitException LauncherExitCodes EXIT_NOT_FOUND path isRoot baseData queue add baseData LOG info Pair of queue dirs DDBPathMetadata dir queue poll Path p dir getFileStatus getPath
baseData queue add baseData LOG info Pair of queue dirs DDBPathMetadata dir queue poll Path p dir getFileStatus getPath LOG debug dir prettyPrint p dir LOG warn p nonauth verifyAuthDir dir requireAuth
LOG info Pair of queue dirs DDBPathMetadata dir queue poll Path p dir getFileStatus getPath LOG debug dir prettyPrint p dir LOG warn p nonauth verifyAuthDir dir requireAuth LOG info p
nonauth verifyAuthDir dir requireAuth LOG info p LOG info p DirListingMetadata entry metastore listChildren p entry Collection PathMetadata listing entry getListing files subdirs PathMetadata e listing e queue add DDBPathMetadata e subdirs
S3AFileSystem fs getFilesystem Path rootPath fs qualify Path Listing listing fs getListing S3ListRequest request listing createListObjectsRequest count RemoteIterator S3AFileStatus st listing createFileStatusListingIterator rootPath request ACCEPT_ALL Listing AcceptAllButSelfAndS3nDirs rootPath st count S3AFileStatus next st next
DumpS3GuardDynamoTable fs DynamoDBMetadataStore store conf destFile uri ExitUtil ExitException ServiceLauncher Service serviceLauncher ServiceLauncher NAME conf conf checkNotNull fs getConf store store DynamoDBMetadataStore checkNotNull fs getMetadataStore DumpS3GuardDynamoTable dump DumpS3GuardDynamoTable fs store destFile uri ExitUtil ExitException ex serviceLauncher launchService conf dump Collections emptyList ex ex ex LOG info Pair Long Long r dump getScanEntryResult LOG info r LOG info r getLeft r getRight r getLeft r getRight LOG info dump getRawObjectStoreCount
ServiceLauncher Service serviceLauncher ServiceLauncher NAME conf conf checkNotNull fs getConf store store DynamoDBMetadataStore checkNotNull fs getMetadataStore DumpS3GuardDynamoTable dump DumpS3GuardDynamoTable fs store destFile uri ExitUtil ExitException ex serviceLauncher launchService conf dump Collections emptyList ex ex ex LOG info Pair Long Long r dump getScanEntryResult LOG info r LOG info r getLeft r getRight r getLeft r getRight LOG info dump getRawObjectStoreCount LOG info dump getTreewalkCount
store store DynamoDBMetadataStore checkNotNull fs getMetadataStore DumpS3GuardDynamoTable dump DumpS3GuardDynamoTable fs store destFile uri ExitUtil ExitException ex serviceLauncher launchService conf dump Collections emptyList ex ex ex LOG info Pair Long Long r dump getScanEntryResult LOG info r LOG info r getLeft r getRight r getLeft r getRight LOG info dump getRawObjectStoreCount LOG info dump getTreewalkCount LOG info dump getListStatusCount r dump getSecondScanResult r
conf Preconditions checkNotNull conf Class DynamoDBClientFactory cls conf getClass S3GUARD_DDB_CLIENT_FACTORY_IMPL S3GUARD_DDB_CLIENT_FACTORY_IMPL_DEFAULT DynamoDBClientFactory
fs Preconditions checkNotNull fs Preconditions checkArgument fs S3AFileSystem fs bindToOwnerFilesystem S3AFileSystem fs String bucket owner getBucket String confRegion conf getTrimmed S3GUARD_DDB_REGION_KEY confRegion region confRegion
fs Preconditions checkNotNull fs Preconditions checkArgument fs S3AFileSystem fs bindToOwnerFilesystem S3AFileSystem fs String bucket owner getBucket String confRegion conf getTrimmed S3GUARD_DDB_REGION_KEY confRegion region confRegion LOG debug region region owner getBucketLocation URI uri owner getUri String message RolePolicies S3_GET_BUCKET_LOCATION uri
path checkPath path
path checkPath path
path checkPath path LOG debug tableName region path PathMetadata meta get path meta
path checkPath path
DDBPathMetadata path wantEmptyDirectoryFlag checkPath path LOG debug tableName region path wantEmptyDirectoryFlag DDBPathMetadata result innerGet path wantEmptyDirectoryFlag
DDBPathMetadata meta path meta DDBPathMetadata makeDirStatus username path Item item getConsistentItem path meta itemToPathMetadata item username LOG debug tableName region path meta meta meta FileStatus status meta getFileStatus status QuerySpec spec QuerySpec withHashKey pathToParentKeyAttribute path withConsistentRead withFilterExpression IS_DELETED withValueMap DELETE_TRACKING_VALUE_MAP path IteratorSupport Item QueryOutcome it table query spec iterator it LOG
meta DDBPathMetadata makeDirStatus username path Item item getConsistentItem path meta itemToPathMetadata item username LOG debug tableName region path meta meta meta FileStatus status meta getFileStatus status QuerySpec spec QuerySpec withHashKey pathToParentKeyAttribute path withConsistentRead withFilterExpression IS_DELETED withValueMap DELETE_TRACKING_VALUE_MAP path IteratorSupport Item QueryOutcome it table query spec iterator it LOG LOG debug status getPath it
path checkPath path
DDBPathMetadata DDBPathMetadata Map Path Pair EntryOrigin DDBPathMetadata ancestry HashMap
DDBPathMetadata DDBPathMetadata pathsToCreate Map Path Pair EntryOrigin DDBPathMetadata ancestry HashMap LOG debug pathsToCreate size List DDBPathMetadata sortedPaths ArrayList pathsToCreate sortedPaths sort PathOrderComparators TOPMOST_PM_FIRST DDBPathMetadata entry sortedPaths Preconditions checkArgument entry Path path entry getFileStatus getPath
Path path entry getFileStatus getPath LOG debug path path DDBPathMetadata oldEntry ancestorState put path entry addAncestors oldEntry oldWasDir oldEntry getFileStatus isDirectory newIsDir entry getFileStatus isDirectory oldWasDir newIsDir oldWasDir newIsDir LOG warn oldEntry LOG warn entry ancestorState put path oldEntry PathIOException path toString String format E_INCONSISTENT_UPDATE oldEntry entry
LOG warn oldEntry LOG warn entry ancestorState put path oldEntry PathIOException path toString String format E_INCONSISTENT_UPDATE oldEntry entry LOG debug path entry addAncestors ancestry put path Pair of EntryOrigin Requested entry Path parent path getParent addAncestors parent ancestry parent ancestorState parent DDBPathMetadata md Pair EntryOrigin DDBPathMetadata newEntry Item item getConsistentItem parent item item
LOG debug path entry addAncestors ancestry put path Pair of EntryOrigin Requested entry Path parent path getParent addAncestors parent ancestry parent parent DDBPathMetadata md Pair EntryOrigin DDBPathMetadata newEntry Item item getConsistentItem parent item itemToPathMetadata item username md itemToPathMetadata item username LOG debug md newEntry Pair of EntryOrigin Retrieved md addAncestors
delay conf getTimeDuration S3GUARD_DDB_BACKGROUND_SLEEP_MSEC_KEY S3GUARD_DDB_BACKGROUND_SLEEP_MSEC_DEFAULT TimeUnit MILLISECONDS Set Path parentPathSet HashSet Set Path clearedParentPathSet HashSet deletionBatch sort PathOrderComparators TOPMOST_PATH_LAST processBatchWriteRequest state pathToKey deletionBatch removeAuthoritativeDirFlag parentPathSet state clearedParentPathSet addAll parentPathSet parentPathSet clear item DDBPathMetadata md PathMetadataDynamoDBTranslation itemToPathMetadata item username Path path md getFileStatus getPath tombstone md isDeleted
parentPath parentPath parentPath parentPathSet add parentPath itemCount deletionBatch deleteBatchOperation apply deletionBatch clear delay Thread sleep delay deletionBatch deleteBatchOperation apply e Thread currentThread interrupt InterruptedIOException e translateDynamoDBException keyPrefix keyPrefix e
IOException AtomicReference IOException rIOException AtomicReference DDBPathMetadata path path LOG debug get path LOG debug DDBPathMetadata ddbPathMetadata get path ddbPathMetadata LOG debug path ddbPathMetadata
path LOG debug get path LOG debug DDBPathMetadata ddbPathMetadata get path ddbPathMetadata LOG debug path ddbPathMetadata LOG debug path ddbPathMetadata
DDBPathMetadata ddbPathMetadata get path ddbPathMetadata LOG debug path ddbPathMetadata LOG debug path ddbPathMetadata LOG debug path LOG debug ddbPathMetadata ddbPathMetadata setAuthoritativeDir ddbPathMetadata setLastUpdated ttlTimeProvider getNow ddbPathMetadata
ddbPathMetadata LOG debug path LOG debug ddbPathMetadata ddbPathMetadata setAuthoritativeDir ddbPathMetadata setLastUpdated ttlTimeProvider getNow ddbPathMetadata e String msg String format path LOG error msg e rIOException set e LOG debug metas
parameters IOException Preconditions checkNotNull table TableDescription desc getTableDescription ProvisionedThroughputDescription current desc getProvisionedThroughput currentRead current getReadCapacityUnits newRead getLongParam parameters S3GUARD_DDB_TABLE_CAPACITY_READ_KEY currentRead currentWrite current getWriteCapacityUnits newWrite getLongParam parameters S3GUARD_DDB_TABLE_CAPACITY_WRITE_KEY currentWrite currentRead currentWrite IOException E_ON_DEMAND_NO_SET_CAPACITY newRead currentRead newWrite currentWrite LOG info currentRead currentWrite LOG info newRead newWrite tableHandler provisionTableBlocking newRead newWrite
text ex ex instrumentation throttled eventCount throttleEventCount addAndGet eventCount LOG warn text ex toString
Preconditions checkArgument operationState AncestorState operationState AncestorState state AncestorState operationState String simpleDestKey pathToParentKey dest String destPathKey simpleDestKey String opId AncestorState stateAsString state LOG debug opId destPathKey List DDBPathMetadata dirsToUpdate ArrayList state Path DDBPathMetadata entry state Path path entry getKey DDBPathMetadata md entry getValue String key pathToParentKey path md key simpleDestKey key destPathKey md setAuthoritativeDir md setLastUpdated ttlTimeProvider getNow
AncestorState state String stateStr AncestorState stateAsString state item tombstone itemExists item isDir getBoolAttribute item IS_DIR auth getBoolAttribute item IS_AUTHORITATIVE
AncestorState state String stateStr AncestorState stateAsString state
table dynamoDB getTable tableName
table dynamoDB getTable tableName LOG debug tableName TableDescription description table describe
LOG debug description tableArn description getTableArn String status description getTableStatus status LOG debug waitForTableActive table LOG debug status verifyVersionCompatibility Item versionMarker getVersionMarkerItem Long created extractCreationTimeFromMarker versionMarker
IOException Item versionMarkerItem getVersionMarkerItem Item versionMarkerFromTag canReadDdbTags versionMarkerFromTag getVersionMarkerFromTags table amazonDynamoDB LOG debug canReadDdbTags LOG debug versionMarkerItem versionMarkerFromTag versionMarkerItem versionMarkerFromTag tableName amazonDynamoDB LOG error IOException E_NO_VERSION_MARKER_AND_NOT_EMPTY tableName canReadDdbTags
versionMarkerFromTag getVersionMarkerFromTags table amazonDynamoDB LOG debug canReadDdbTags LOG debug versionMarkerItem versionMarkerFromTag versionMarkerItem versionMarkerFromTag tableName amazonDynamoDB LOG error IOException E_NO_VERSION_MARKER_AND_NOT_EMPTY tableName canReadDdbTags LOG info tableName putVersionMarkerItemToTable tagTableWithVersionMarker canReadDdbTags
canReadDdbTags LOG debug versionMarkerItem versionMarkerFromTag versionMarkerItem versionMarkerFromTag tableName LOG error IOException E_NO_VERSION_MARKER_AND_NOT_EMPTY tableName canReadDdbTags LOG info tableName putVersionMarkerItemToTable tagTableWithVersionMarker canReadDdbTags LOG info tableName putVersionMarkerItemToTable versionMarkerItem versionMarkerFromTag tagVersionMarker extractVersionFromMarker versionMarkerFromTag
LOG error IOException E_NO_VERSION_MARKER_AND_NOT_EMPTY tableName LOG info tableName putVersionMarkerItemToTable tagTableWithVersionMarker LOG info tableName putVersionMarkerItemToTable versionMarkerFromTag tagVersionMarker extractVersionFromMarker versionMarkerFromTag throwExceptionOnVersionMismatch tagVersionMarker tableName E_INCOMPATIBLE_TAG_VERSION LOG info tableName putVersionMarkerItemToTable versionMarkerFromTag
LOG info tableName putVersionMarkerItemToTable versionMarkerItem versionMarkerFromTag tagVersionMarker extractVersionFromMarker versionMarkerFromTag throwExceptionOnVersionMismatch tagVersionMarker tableName E_INCOMPATIBLE_TAG_VERSION LOG info tableName putVersionMarkerItemToTable versionMarkerItem versionMarkerFromTag itemVersionMarker extractVersionFromMarker versionMarkerItem throwExceptionOnVersionMismatch itemVersionMarker tableName E_INCOMPATIBLE_ITEM_VERSION LOG info tableName tagTableWithVersionMarker versionMarkerItem versionMarkerFromTag tagVersionMarker extractVersionFromMarker versionMarkerFromTag
Preconditions checkArgument status isDirectory totalCountOfEntriesWritten Path basePath status getPath MetadataStore ms getStore
countOfFilesWritten countOfDirsWritten RemoteIterator S3ALocatedFileStatus it getFilesystem listFilesAndEmptyDirectoriesForceNonAuth basePath it S3ALocatedFileStatus located it next S3AFileStatus child Path path located getPath isDirectory located isDirectory isDirectory child DynamoDBMetadataStore makeDirStatus path located getOwner dirCache add path countOfDirsWritten child located toS3AFileStatus parentsWritten putParentsIfNotPresent child operationState
PathMetadata existingEntry S3Guard getWithTtl ms path existingEntry S3AFileStatus existingStatus existingEntry getFileStatus existingStatus String existingEtag existingStatus getETag String childEtag child getETag child existingStatus existingStatus child existingEtag existingEtag childEtag childEtag existingEtag child setVersionId existingStatus getVersionId child child countOfFilesWritten child
existingEntry S3AFileStatus existingStatus existingEntry getFileStatus existingStatus String existingEtag existingStatus getETag String childEtag child getETag child existingStatus existingStatus child existingEtag existingEtag childEtag childEtag existingEtag child setVersionId existingStatus getVersionId child child countOfFilesWritten child String t isDirectory
String childEtag child getETag child existingStatus existingStatus child childEtag childEtag child setVersionId existingStatus getVersionId child child countOfFilesWritten child String t isDirectory LOG info t path LOG debug t path S3Guard putWithTtl ms PathMetadata child getFilesystem getTtlTimeProvider operationState
DirListingMetadata Path p Path path standardize p DirListingMetadata listing getDirListingMeta path
meta Preconditions checkNotNull meta S3AFileStatus status meta getFileStatus Path path standardize status getPath
LOG debug path entry tombstone PathMetadata pmd PathMetadata tombstone path ttlTimeProvider getNow entry setPathMetadata pmd entry setPathMetadata entry LOG debug path entry setDirListingMetadata entry entry localCache invalidate entry Path parent path getParent parent DirListingMetadata dir getDirListingMeta parent
List PathMetadata entriesToAdd ArrayList
sourcePath sourceAttributes destAttributes destPath blockSize List PathMetadata entriesToAdd ArrayList LOG debug sourcePath MetadataStore store getMetadataStore checkArgument pathsToDelete contains sourcePath destPath S3Guard addMoveFile store pathsToDelete entriesToAdd sourcePath destPath sourceAttributes getLen blockSize getOwner destAttributes getETag destAttributes getVersionId
URI uri getUri String host uri getHost String prefix host DynamoDBMetadataStore ddbms getStore S3GuardTableAccess tableAccess S3GuardTableAccess ddbms ExpressionSpecBuilder builder ExpressionSpecBuilder builder withKeyCondition ExpressionSpecBuilder S PARENT beginsWith prefix
LOG info prefix ddbms Iterable DDBPathMetadata entries ddbms wrapWithRetries tableAccess scanMetadata builder List Path list ArrayList entries e e Path p e getFileStatus getPath String type e getFileStatus isFile tombstone e isDeleted tombstone type type LOG info type p list add p count list size filesFound count
type type LOG info type p list add p count list size filesFound count LOG info count count count DurationInfo duration DurationInfo LOG count ddbms toString path list ddbms getInvoker retry prefix tableAccess delete path duration close durationMillis duration value timePerEntry durationMillis count
MetadataStore fs Preconditions checkNotNull fs Configuration conf fs getConf Preconditions checkNotNull conf MetadataStore msInstance Class MetadataStore msClass getMetadataStoreClass conf msInstance ReflectionUtils newInstance msClass conf
MetadataStore fs ttlTimeProvider Preconditions checkNotNull fs Configuration conf fs getConf Preconditions checkNotNull conf MetadataStore msInstance Class MetadataStore msClass getMetadataStoreClass conf msInstance ReflectionUtils newInstance msClass conf LOG debug msClass getSimpleName fs getScheme msInstance initialize fs ttlTimeProvider msInstance e e e String message conf get S3_METADATA_STORE_IMPL S3_METADATA_STORE_IMPL e
Set Path deleted dirMeta listTombstones Map Path PathMetadata dirMetaMap dirMeta getListing stream collect Collectors toMap pm pm getFileStatus getPath pm pm s Path statusPath s getPath deleted statusPath PathMetadata pathMetadata dirMetaMap get statusPath shouldUpdate pathMetadata shouldUpdate s getModificationTime pathMetadata getFileStatus getModificationTime pathMetadata PathMetadata s pathMetadata PathMetadata s shouldUpdate DIR_MERGE_UPDATES_ALL_RECORDS_NONAUTH shouldUpdate
statusPath PathMetadata pathMetadata dirMetaMap get statusPath shouldUpdate pathMetadata shouldUpdate s getModificationTime pathMetadata getFileStatus getModificationTime pathMetadata PathMetadata s pathMetadata PathMetadata s shouldUpdate DIR_MERGE_UPDATES_ALL_RECORDS_NONAUTH shouldUpdate LOG debug s entriesToAdd add pathMetadata dirMeta put pathMetadata entriesToAdd
PathMetadata pathMetadata ms get path needEmptyDirectoryFlag timeProvider LOG debug pathMetadata LOG debug pathMetadata ttl timeProvider getMetadataTtl pathMetadata pathMetadata LOG debug path pathMetadata pathMetadata ttl timeProvider pathMetadata
Queue S3AFileStatus queue ArrayDeque queue add root queue S3AFileStatus currentDir queue poll Path currentDirPath currentDir getPath List FileStatus s3DirListing Arrays asList rawFS listStatus currentDirPath compareAuthoritativeDirectoryFlag comparePairs currentDirPath s3DirListing s3DirListing stream filter pm pm isDirectory map S3AFileStatus cast forEach pm queue add pm List S3AFileStatus children s3DirListing stream filter status status isDirectory map S3AFileStatus cast collect toList List ComparePair compareResult compareS3DirContentToMs currentDir children comparePairs addAll compareResult scannedItems scannedItems children size
List FileStatus s3DirListing Arrays asList rawFS listStatus currentDirPath compareAuthoritativeDirectoryFlag comparePairs currentDirPath s3DirListing s3DirListing stream filter pm pm isDirectory map S3AFileStatus cast forEach pm queue add pm List S3AFileStatus children s3DirListing stream filter status status isDirectory map S3AFileStatus cast collect toList List ComparePair compareResult compareS3DirContentToMs currentDir children comparePairs addAll compareResult scannedItems scannedItems children size e LOG error currentDirPath e stopwatch stop S3GuardFsckViolationHandler handler S3GuardFsckViolationHandler rawFS metadataStore ComparePair comparePair comparePairs handler logError comparePair LOG info stopwatch now TimeUnit SECONDS
s3FileStatus Path path s3FileStatus getPath
List ComparePair basePath Preconditions checkArgument basePath isAbsolute List ComparePair comparePairs ArrayList String rootStr basePath toString
baseMeta FileNotFoundException baseMeta DDBPathMetadata S3AFileStatus Tristate UNKNOWN basePath username DDBTreeNode root DDBTreeNode baseMeta ddbTree addNode root ddbTree setRoot root ExpressionSpecBuilder builder ExpressionSpecBuilder builder withCondition ExpressionSpecBuilder S beginsWith pathToParentKey basePath IteratorSupport Item ScanOutcome resultIterator table scan builder buildForScan iterator resultIterator item DDBPathMetadata pmd itemToPathMetadata item username DDBTreeNode ddbTreeNode DDBTreeNode pmd ddbTree addNode ddbTreeNode
S3GuardFsck ComparePair comparePair sB S3GuardFsck violation comparePair ViolationHandler handler violation getHandler getDeclaredConstructor S3GuardFsck ComparePair newInstance comparePair errorStr handler sB append errorStr LOG fixStr handler sB append fixStr LOG error violation getHandler
String path LOG debug path URI uri toUri path Configuration conf Configuration getConf String nullStore NullMetadataStore getName conf set S3_METADATA_STORE_IMPL nullStore String bucket uri getHost S3AUtils setBucketOption conf bucket S3_METADATA_STORE_IMPL S3GUARD_METASTORE_NULL String updatedBucketOption S3AUtils getBucketOption conf bucket S3_METADATA_STORE_IMPL
exit ret e errorln e getMessage printHelp exit E_USAGE e getMessage e LOG debug e exit e getExitCode e toString e errorln e toString LOG debug e exit EXIT_NOT_FOUND e toString e e ExitCodeProvider ExitCodeProvider ec ExitCodeProvider e
stream FutureIOSupport awaitFuture builder build e storeNotFound e bytesRead SuppressWarnings Scanner scanner Scanner BufferedReader InputStreamReader stream StandardCharsets UTF_8 scanner useDelimiter scanner linesRead String l scanner nextLine bytesRead l length println out l FileSystem destFS destPath getFileSystem getConf
describe maxAttempts attempt attempt maxAttempts attempt testListEmptyRootDirectory e attempt maxAttempts LOG info attempt maxAttempts e Thread sleep Thread currentThread interrupt fail
describe Path path path FileSystem fs getFileSystem writeTestDataset path in fs path readAtEndAndReturn in temp offset READAHEAD in seek offset l in read temp assertTrue l
describe Path path path FileSystem fs getFileSystem writeTestDataset path in fs path readAtEndAndReturn in temp offset READAHEAD in seek offset l in read temp
describe Path path path FileSystem fs getFileSystem writeTestDataset path in fs path readAtEndAndReturn in temp offset READAHEAD in seek offset temp in readByte assertDatasetEquals READAHEAD temp
FileSystem fs getFileSystem defaultBlockSize fs getDefaultBlockSize assertEquals S3AFileSystem DEFAULT_BLOCKSIZE defaultBlockSize newBlockSize defaultBlockSize fs getConf setLong Constants FS_S3A_BLOCK_SIZE newBlockSize Path dir path Path file Path dir createFile fs file dataset FileStatus fileStatus fs getFileStatus file assertEquals fileStatus newBlockSize fileStatus getBlockSize found FileStatus listing fs listStatus dir FileStatus listing
assumeEnabled Configuration conf createConfiguration conf set Constants SERVER_SIDE_ENCRYPTION_ALGORITHM S3AContract contract S3AContract createContract conf contract init FileSystem fileSystem contract getTestFileSystem assertNotNull fileSystem URI fsURI fileSystem getUri
assumeEnabled Constants SERVER_SIDE_ENCRYPTION_KEY Configuration conf createConfiguration conf set Constants SERVER_SIDE_ENCRYPTION_ALGORITHM S3AEncryptionMethods SSE_C getMethod conf set Constants SERVER_SIDE_ENCRYPTION_KEY S3AContract contract S3AContract createContract conf contract init FileSystem fileSystem contract getTestFileSystem assertNotNull fileSystem URI fsURI fileSystem getUri
Configuration conf createConfiguration conf set Constants SERVER_SIDE_ENCRYPTION_ALGORITHM S3AEncryptionMethods SSE_C getMethod conf set Constants SERVER_SIDE_ENCRYPTION_KEY S3AContract contract S3AContract createContract conf contract init FileSystem fileSystem contract getTestFileSystem assertNotNull fileSystem URI fsURI fileSystem getUri
assumeEnabled Configuration conf createConfiguration conf set Constants SERVER_SIDE_ENCRYPTION_ALGORITHM S3AEncryptionMethods SSE_S3 getMethod conf set Constants SERVER_SIDE_ENCRYPTION_KEY S3AContract contract S3AContract createContract conf contract init FileSystem fileSystem contract getTestFileSystem assertNotNull fileSystem URI fsURI fileSystem getUri
tmpFile delete URI localFileURI tmpFile toURI FileSystem localFS FileSystem get localFileURI getFileSystem getConf Path localPath Path localFileURI len data dataset len writeDataset localFS localPath data len S3AFileSystem s3a getFileSystem Path remotePath methodPath s3a copyFromLocalFile localPath remotePath len verifyFileContents s3a remotePath data
assumeNoDefaultEncryption S3AFileSystem fs getFileSystem Path file1 touchFile EtagChecksum checksum1 fs getFileChecksum file1
list Set MultipartTestUtils IdKey ourUploads Set MultipartTestUtils IdKey uploads HashSet ourUploads list MultipartTestUtils IdKey listing toIdKey list next uploads listing
testpath dataset writeDataset fs testpath dataset dataset length S3AFileStatus originalStatus S3AFileStatus fs getFileStatus testpath writeDataset fs testpath dataset dataset length
testpath dataset writeDataset fs testpath dataset dataset length S3AFileStatus originalStatus S3AFileStatus fs getFileStatus testpath writeDataset fs testpath dataset dataset length LOG debug testpath originalStatus getVersionId originalStatus getETag S3AFileStatus newStatus S3AFileStatus fs getFileStatus testpath
testpath dataset writeDataset fs testpath dataset dataset length S3AFileStatus originalStatus S3AFileStatus fs getFileStatus testpath writeDataset fs testpath dataset dataset length LOG debug testpath originalStatus getVersionId originalStatus getETag S3AFileStatus newStatus S3AFileStatus fs getFileStatus testpath LOG debug testpath newStatus getVersionId newStatus getETag
s3ClientSpy testpath dataset getObjectInconsistencyCount getMetadataInconsistencyCount writeDataset fs testpath dataset dataset length S3AFileStatus originalStatus S3AFileStatus fs getFileStatus testpath writeDataset fs testpath dataset dataset length LOG debug testpath originalStatus getVersionId originalStatus getETag S3AFileStatus newStatus S3AFileStatus fs getFileStatus testpath LOG debug testpath newStatus getVersionId newStatus getETag LOG debug testpath getMetadataInconsistencyCount getObjectInconsistencyCount stubTemporaryUnavailable s3ClientSpy getObjectInconsistencyCount testpath newStatus stubTemporaryWrongVersion s3ClientSpy getObjectInconsistencyCount testpath originalStatus
callCount callCount callCount
S3Object S3Object callCount S3Object invocation callCount S3Object s3Object S3Object invocation callRealMethod callCount
copyInconsistentCallCount callCount callCount callCount copyInconsistentCallCount String message callCount copyInconsistentCallCount
ObjectMetadata ObjectMetadata callCount ObjectMetadata invocation ObjectMetadata objectMetadata ObjectMetadata invocation callRealMethod callCount callCount
callCount callCount callCount
Configuration conf2 Configuration conf S3AUtils clearBucketOption conf2 bucket AWS_CREDENTIALS_PROVIDER S3AUtils clearBucketOption conf2 bucket ACCESS_KEY S3AUtils clearBucketOption conf2 bucket SECRET_KEY S3AUtils clearBucketOption conf2 bucket SESSION_TOKEN MarshalledCredentials mc fromSTSCredentials sessionCreds updateConfigWithSessionCreds conf2 mc conf2 set AWS_CREDENTIALS_PROVIDER TEMPORARY_AWS_CREDENTIALS fs conf2 createAndVerifyFile fs path TEST_FILE_SIZE conf2 set SESSION_TOKEN sessionCreds getSessionToken fs conf2 createAndVerifyFile fs path TEST_FILE_SIZE fail fs getUri fs
S3AUtils clearBucketOption conf2 bucket AWS_CREDENTIALS_PROVIDER S3AUtils clearBucketOption conf2 bucket ACCESS_KEY S3AUtils clearBucketOption conf2 bucket SECRET_KEY S3AUtils clearBucketOption conf2 bucket SESSION_TOKEN MarshalledCredentials mc fromSTSCredentials sessionCreds updateConfigWithSessionCreds conf2 mc conf2 set AWS_CREDENTIALS_PROVIDER TEMPORARY_AWS_CREDENTIALS fs conf2 createAndVerifyFile fs path TEST_FILE_SIZE conf2 set SESSION_TOKEN sessionCreds getSessionToken fs conf2 createAndVerifyFile fs path TEST_FILE_SIZE fail fs getUri fs ex LOG info ex toString
describe IllegalArgumentException ex expectedSessionRequestFailure IllegalArgumentException EU_IRELAND
S3AFileSystem fs getFileSystem String rootDir fs mkdirs path rootDir numOfPaths numOfPaths
index index fileNames add index index index fileNames add index DEFAULT_DELAY_KEY_SUBSTRING filesAndEmptyDirectories Path dir fileName fileNames writeTextFile fs Path dir fileName fileName filesAndEmptyDirectories RemoteIterator LocatedFileStatus statusIterator fs listFiles baseTestDir recursive Collection Path listedFiles HashSet statusIterator FileStatus status statusIterator next assertTrue status status isFile listedFiles add status getPath
describe assumeV2ListAPI S3AFileSystem fs getFileSystem Path root path DEFAULT_DELAY_KEY_SUBSTRING i i i fs mkdirs Path root i touch fs Path root i j j j touch fs Path Path root i i j clearInconsistency fs String key fs pathToKey root LOG info ListObjectsV2Result preDeleteDelimited listObjectsV2 fs key ListObjectsV2Result preDeleteUndelimited listObjectsV2 fs key
String expected actual String leftContents expected stream map n n toString collect Collectors joining String rightContents actual stream map n n toString collect Collectors joining String summary leftContents rightContents expected actual
allowAuthoritative authoritative Path testFilePath path UUID randomUUID
AtomicLong now AtomicLong AtomicLong metadataTtl AtomicLong testTimeProvider now get metadataTtl get guardedFs setTtlTimeProvider testTimeProvider createAndAwaitFs guardedFs testFilePath originalText deleteGuardedTombstoned guardedFs testFilePath now createAndAwaitFs rawFS testFilePath newText checkListingDoesNotContainPath guardedFs testFilePath willExpire now get metadataTtl get now set willExpire
getMetadataTtl metadataTtl get guardedFs setTtlTimeProvider testTimeProvider createAndAwaitFs guardedFs testFilePath originalText deleteGuardedTombstoned guardedFs testFilePath now createAndAwaitFs rawFS testFilePath newText checkListingDoesNotContainPath guardedFs testFilePath willExpire now get metadataTtl get now set willExpire LOG info willExpire testTimeProvider getNow testTimeProvider getMetadataTtl intercept FileNotFoundException testFilePath toString readBytesToString guardedFs testFilePath newText length String newRead readBytesToString guardedFs testFilePath newText length
testFilePath String text writeTextFile guardedFs testFilePath text awaitFileStatus rawFS testFilePath deleteFile rawFS testFilePath FileStatus status guardedFs getFileStatus testFilePath
allowAuthoritative authoritative Path testFilePath path UUID randomUUID
allowAuthoritative authoritative
allowAuthoritative authoritative
String testFile testDir rUUID Path testDirPath path testDir Path testFilePath guardedFs qualify path testFile String text writeTextFile guardedFs testFilePath text awaitFileStatus rawFS testFilePath FileStatus origList guardedFs listStatus testDirPath assertEquals origList length DirListingMetadata dirListingMetadata realMs listChildren guardedFs qualify testDirPath assertListingAuthority allowAuthoritative dirListingMetadata deleteFile rawFS testFilePath interceptFuture FileNotFoundException rawFS openFile testFilePath build intercept FileNotFoundException rawFS open testFilePath close S3AFileStatus status S3AFileStatus guardedFs getFileStatus testFilePath
describe Path dir path Path testFilePath Path dir createAndAwaitFs guardedFs testFilePath
describe Path dir path Path testFilePath Path dir createAndAwaitFs guardedFs testFilePath LOG info dir guardedFs delete dir awaitDeletedFileDisappearance guardedFs testFilePath createAndAwaitFs rawFS testFilePath awaitListingContainsChild rawFS dir testFilePath Path sibling Path dir guardedFs mkdirs sibling
describe Path dir path Path testFilePath Path dir createAndAwaitFs guardedFs testFilePath LOG info dir guardedFs delete dir awaitDeletedFileDisappearance guardedFs testFilePath createAndAwaitFs rawFS testFilePath awaitListingContainsChild rawFS dir testFilePath Path sibling Path dir guardedFs mkdirs sibling LOG info dir guardedFs delete dir
anyFailure
fs String key len partNo WriteOperationHelper writeHelper fs getWriteOperationHelper data dataset len InputStream in ByteArrayInputStream data String uploadId writeHelper initiateMultiPartUpload key UploadPartRequest req writeHelper newUploadPartRequest key uploadId partNo len in PartETag partEtag fs uploadPart req getPartETag
fs path String key fs pathToKey path MultipartUtils UploadIterator uploads fs listUploads key uploads MultipartUpload upload uploads next fs getWriteOperationHelper abortMultipartUpload upload getKey upload getUploadId LOG_EVENT
describe Configuration conf createValidRoleConf conf
describe Configuration conf createValidRoleConf conf
describe String roleARN getAssumedRoleARN Configuration conf createAssumedRoleConfig roleARN Path path Path getFileSystem getUri
SinglePendingCommit pending fullOperations uploadFileToPendingCommit src dest uploadPartSize progress pending save fs Path readOnlyDir name CommitConstants PENDING_SUFFIX assertTrue src delete progress assertCount range Pair PendingSet List Pair LocatedFileStatus IOException pendingCommits operations loadSinglePendingCommits readOnlyDir List SinglePendingCommit commits pendingCommits getLeft getCommits assertEquals range commits size CommitOperations commitContext operations commits c CommitOperations MaybeIOE maybeIOE commitContext commit c Path path c destinationPath assertCommitAccessDenied path maybeIOE
setup setup regionName determineRegion getFileSystem getBucket
FileStatus fs path filter LOG info path S3ATestUtils MetricDiff getMetric S3ATestUtils MetricDiff fs Statistic OBJECT_METADATA_REQUESTS S3ATestUtils MetricDiff listMetric S3ATestUtils MetricDiff fs Statistic OBJECT_LIST_REQUESTS FileStatus st st filter fs globStatus path fs globStatus path filter
LOG info path S3ATestUtils MetricDiff getMetric S3ATestUtils MetricDiff fs Statistic OBJECT_METADATA_REQUESTS S3ATestUtils MetricDiff listMetric S3ATestUtils MetricDiff fs Statistic OBJECT_LIST_REQUESTS FileStatus st st filter fs globStatus path fs globStatus path filter LOG info getMetric listMetric String resultStr st resultStr resultStr StringUtils join st fail String format path resultStr
policy String p MODEL toJson policy
AbstractS3ATokenIdentifier submittedCredentials uri kind Token AbstractS3ATokenIdentifier token requireNonNull lookupS3ADelegationToken submittedCredentials uri uri assertEquals token kind token getKind AbstractS3ATokenIdentifier tid token decodeIdentifier
conf removeBaseAndBucketOverrides conf DELEGATION_TOKEN_BINDING
File file fetchTokens String csv FileUtils readFileToString file
e ex e timer end Outcome id startTime timer ex NanoTimerStats stats NanoTimerStats NanoTimerStats success NanoTimerStats NanoTimerStats throttled NanoTimerStats List Outcome throttledEvents ArrayList Outcome outcome completionService take get ContractTestUtils NanoTimer timer outcome timer Exception ex outcome exception outcome writeln csvout stats add timer
NanoTimerStats stats NanoTimerStats NanoTimerStats success NanoTimerStats NanoTimerStats throttled NanoTimerStats List Outcome throttledEvents ArrayList i i i Outcome outcome completionService take get ContractTestUtils NanoTimer timer outcome timer Exception ex outcome exception outcome writeln csvout stats add timer ex LOG info i ex throttled add timer throttledEvents add outcome
ContractTestUtils NanoTimer timer outcome timer Exception ex outcome exception outcome writeln csvout stats add timer ex LOG info i ex throttled add timer throttledEvents add outcome success add timer csvout close jobTimer end LOG info csvFile LOG info tokens throttled getCount stats throttled success duration jobTimer duration
FileSystem resourceFS EXTRA_JOB_RESOURCE_PATH getFileSystem getConfiguration FileStatus status resourceFS getFileStatus EXTRA_JOB_RESOURCE_PATH
job setOutputKeyClass Text job setOutputValueClass IntWritable FileInputFormat addInputPath job input FileOutputFormat setOutputPath job output job setMaxMapAttempts job setMaxReduceAttempts URI partitionUri URI EXTRA_JOB_RESOURCE_PATH toString job addCacheFile partitionUri describe output job submit JobStatus status job getStatus assertEquals MockJob NAME status getSchedulingInfo assertEquals JobStatus State RUNNING status getState Credentials submittedCredentials requireNonNull job getSubmittedCredentials Collection Token TokenIdentifier tokens submittedCredentials getAllTokens
FileInputFormat addInputPath job input FileOutputFormat setOutputPath job output job setMaxMapAttempts job setMaxReduceAttempts URI partitionUri URI EXTRA_JOB_RESOURCE_PATH toString job addCacheFile partitionUri describe output job submit JobStatus status job getStatus assertEquals MockJob NAME status getSchedulingInfo assertEquals JobStatus State RUNNING status getState Credentials submittedCredentials requireNonNull job getSubmittedCredentials Collection Token TokenIdentifier tokens submittedCredentials getAllTokens LOG info tokens size Token TokenIdentifier tokens
describe EnumSet AWSPolicyProvider AccessLevel access EnumSet of AWSPolicyProvider AccessLevel READ AWSPolicyProvider AccessLevel WRITE S3AFileSystem fs getFileSystem List RoleModel Statement rules fs listAWSPolicyRules access assertTrue rules isEmpty String ruleset RoleModel toJson RoleModel Policy rules
describe S3AFileSystem fs getFileSystem Credentials cred Credentials Token tokens fs addDelegationTokens YARN_RM cred assertEquals tokens length Token token requireNonNull tokens
describe delegationTokens start Credentials cred createDelegationTokens UserGroupInformation ugi UserGroupInformation getCurrentUser ugi addCredentials cred Token tokens cred getAllTokens toArray Token Token token0 tokens Text service token0 getService
Text tokenKind getTokenKind AbstractS3ATokenIdentifier origTokenId requireNonNull lookupToken creds uri tokenKind UserGroupInformation currentUser UserGroupInformation getCurrentUser currentUser addCredentials creds requireNonNull lookupToken currentUser getCredentials uri tokenKind Configuration conf Configuration getConfiguration String bucket fs getBucket disableFilesystemCaching conf unsetHadoopCredentialProviders conf removeBaseAndBucketOverrides bucket conf ACCESS_KEY SECRET_KEY SESSION_TOKEN SERVER_SIDE_ENCRYPTION_ALGORITHM SERVER_SIDE_ENCRYPTION_KEY DELEGATION_TOKEN_ROLE_ARN DELEGATION_TOKEN_ENDPOINT conf set DELEGATION_TOKEN_ENDPOINT bindProviderList bucket conf CountInvocationsProvider NAME originalCount CountInvocationsProvider getInvocationCount Path testPath path uri conf
describe ExitUtil disableSystemExit S3AFileSystem fs getFileSystem Configuration conf fs getConf URI fsUri fs getUri String fsurl fsUri toString File tokenfile createTempTokenFile String tokenFilePath tokenfile getAbsolutePath doAs bobUser DelegationTokenFetcher main conf args fsurl tokenFilePath assertTrue tokenfile tokenfile exists String s DelegationTokenFetcher printTokensToString conf Path tokenfile toURI
String String args ByteArrayOutputStream dtUtilContent ByteArrayOutputStream DtUtilShell dt DtUtilShell dt setOut PrintStream dtUtilContent dtUtilContent reset r doAs aliceUser ToolRunner run getConfiguration dt args String s dtUtilContent toString
AbstractS3ATokenIdentifier fs session conf describe unsetHadoopCredentialProviders conf conf set DELEGATION_TOKEN_CREDENTIALS_PROVIDER TemporaryAWSCredentialsProvider NAME session setSecretsInConfiguration conf delegationTokens2 delegationTokens2 bindToFileSystem fs getCanonicalUri fs createStoreContext fs createDelegationOperations delegationTokens2 init conf delegationTokens2 start Token AbstractS3ATokenIdentifier newDT delegationTokens2 getBoundOrNewDT EncryptionSecrets delegationTokens2 resetTokenBindingToDT newDT AbstractS3ATokenIdentifier boundId delegationTokens2 getDecodedIdentifier get
SuccessData outputPath String fs String origin SuccessData successData loadSuccessFile fs outputPath origin String commitDetails successData toString
SuccessData outputPath String committerName fs String origin SuccessData successData loadSuccessFile fs outputPath origin String commitDetails successData toString LOG info committerName commitDetails
SuccessData outputPath String committerName fs String origin SuccessData successData loadSuccessFile fs outputPath origin String commitDetails successData toString LOG info committerName commitDetails LOG info successData dumpMetrics
fs Path outputPath origin ContractTestUtils assertPathExists fs outputPath origin outputPath Path success Path outputPath _SUCCESS FileStatus status ContractTestUtils verifyPathExists fs success origin success assertTrue origin status status isFile assertTrue success origin status getLen
jobConf jobConf setBoolean FS_S3A_COMMITTER_STAGING_UNIQUE_FILENAMES isUniqueFilenames bindCommitter jobConf CommitConstants S3A_COMMITTER_FACTORY committerName jobConf setBoolean KEY_SCALE_TESTS_ENABLED isScaleTest String staging stagingFilesDir getRoot getAbsolutePath
commit commit validate Path path getFileSystem keyToQualifiedPath commit getDestinationKey FileStatus status getFileSystem getFileStatus path
Path String filename Path magicFile S3AFileSystem fs getFileSystem Path pendingDataPath Path magicFile getParent filename PENDING_SUFFIX FileStatus fileStatus verifyPathExists fs pendingDataPath assertTrue fileStatus fileStatus getLen String data read fs pendingDataPath
Path destFile3 Path subdir List Path destinations Lists newArrayList destFile1 destFile2 destFile3 List SinglePendingCommit commits ArrayList Path destination destinations SinglePendingCommit commit1 actions uploadFileToPendingCommit localFile destination DEFAULT_MULTIPART_SIZE progress commits add commit1 resetFailures assertPathDoesNotExist destDir assertPathDoesNotExist subdir LOG info commitContext actions destDir MetricDiff writes MetricDiff fs Statistic S3GUARD_METADATASTORE_RECORD_WRITES LOG info commitContext commitOrFail commits get String firstCommitContextString commitContext toString
AmazonS3Client mockClient mock AmazonS3Client Object lock Object mockClient
mockClient InitiateMultipartUploadRequest invocation LOG debug mockClient results requests size errors failOnInit errors errors failOnInit AmazonClientException results requests size String uploadId UUID randomUUID toString InitiateMultipartUploadRequest req getArgumentAt invocation InitiateMultipartUploadRequest results requests put uploadId req results activeUploads put uploadId req getKey results uploads add uploadId newResult results requests get uploadId uploadId mockClient invocation
mockClient UploadPartRequest invocation LOG debug mockClient results parts size errors failOnUpload errors errors failOnUpload LOG info AmazonClientException results parts size UploadPartRequest req getArgumentAt invocation UploadPartRequest results parts add req String etag UUID randomUUID toString List String etags results tagsByUpload get req getUploadId etags etags Lists newArrayList results tagsByUpload put req getUploadId etags
List String etags results tagsByUpload get req getUploadId etags etags Lists newArrayList results tagsByUpload put req getUploadId etags etags add etag newResult req etag mockClient CompleteMultipartUploadRequest invocation LOG debug mockClient results commits size errors failOnCommit errors errors failOnCommit AmazonClientException results commits size CompleteMultipartUploadRequest req getArgumentAt invocation CompleteMultipartUploadRequest
results commits size errors failOnCommit errors errors failOnCommit AmazonClientException results commits size CompleteMultipartUploadRequest req getArgumentAt invocation CompleteMultipartUploadRequest String uploadId req getUploadId removeUpload results uploadId results commits add req newResult req invocation LOG debug mockClient results size errors errors
CompleteMultipartUploadRequest req getArgumentAt invocation CompleteMultipartUploadRequest String uploadId req getUploadId removeUpload results uploadId results commits add req newResult req invocation LOG debug mockClient results aborts size errors failOnAbort errors errors failOnAbort AmazonClientException results aborts size AbortMultipartUploadRequest req getArgumentAt invocation AbortMultipartUploadRequest String id req getUploadId
Configuration baseConf Configuration String sources baseConf getPropertySources FS_S3A_COMMITTER_STAGING_CONFLICT_MODE String sourceStr Arrays stream sources collect Collectors joining
completedStage d StringBuilder results StringBuilder results append String stage s DurationInfo duration completedStages get s results append String format s duration duration stage accept stage accept stage accept stage accept String text results toString File resultsFile File createTempFile FileUtils write resultsFile text StandardCharsets UTF_8
describe multiDelete S3AFileSystem fs getFileSystem roleFS mkdirs writableDir List Path createdFiles createFiles fs readOnlyDir dirDepth fileCount dirCount expectedFileCount createdFiles size assertFileCount roleFS readOnlyDir expectedFileCount
src dest src dest src dest result roleFS rename src dest
src dest LOG src dest src dest result roleFS rename src dest LOG error result
src dest LOG src dest src dest result roleFS rename src dest LOG error result LOG error ContractTestUtils ls getFileSystem src getParent
c
T T T eval ExpectedProbe expectedA List ExpectedProbe expected Arrays asList expectedA resetMetricDiffs assumeProbesEnabled expected T r eval call String text r r toString
T T T eval ExpectedProbe expectedA List ExpectedProbe expected Arrays asList expectedA resetMetricDiffs assumeProbesEnabled expected T r eval call String text r r toString LOG info text LOG info
numDelete numPut Path path Path numDelete numPut Path root fileSystem makeQualified path Path oldDir Path root Path newDir Path root
newMetas add PathMetadata basicFileStatus Path newDir i i Collection Path pathsToDelete oldMetas ms put DirListingMetadata oldDir oldMetas UNCHANGED_ENTRIES putState assertEquals ms listChildren newDir withoutTombstones numEntries Assertions assertThat ms listChildren oldDir getListing describedAs containsExactlyInAnyOrderElementsOf oldMetas assertTrue CollectionUtils isEqualCollection oldMetas ms listChildren oldDir getListing pathsToDelete ArrayList oldMetas size PathMetadata meta oldMetas pathsToDelete add meta getFileStatus getPath AncestorState state checkNotNull ms initiateBulkWrite BulkOperationState OperationType Put newDir assertEquals newDir state getDest ThrottleTracker throttleTracker ThrottleTracker ms ms move pathsToDelete newMetas state
String subdir base Path subDirPath strToPath subdir createNewDirs base subdir String subFile subdir Path subFilePath strToPath subFile putListStatusFiles subdir subFile DDBPathMetadata subDirMetadataOrig ms get subDirPath Assertions assertThat subDirMetadataOrig isAuthoritativeDir describedAs subDirMetadataOrig isTrue now getTime oldTime now MINUTE putFile subdir oldTime getFile subdir Path basePath strToPath base DirListingMetadata listing ms listChildren basePath String childText listing prettyPrint
describe String target System getProperty File buildDir File target getAbsoluteFile String name File destFile File buildDir name DumpS3GuardDynamoTable dumpStore ddbmsStatic getFileSystem getConf destFile fsUri File storeFile File buildDir name DumpS3GuardDynamoTable SCAN_CSV storeFile String
describe Assume assumeTrue expectThrottling S3AFileSystem fs getFileSystem String fsSummary fs toString S3AStorageStatistics statistics fs getStorageStatistics statistics
describe S3GuardTableAccess tableAccess S3GuardTableAccess ddbms ExpressionSpecBuilder builder ExpressionSpecBuilder String path builder withCondition ExpressionSpecBuilder S PARENT beginsWith path Iterable DDBPathMetadata entries ddbms wrapWithRetries tableAccess scanMetadata builder List Path list ArrayList entries e Path p e getFileStatus getPath
ExecutorService executorService Executors newFixedThreadPool THREADS List Callable ExecutionOutcome tasks ArrayList THREADS AtomicInteger throttleExceptions AtomicInteger THREADS tasks ExecutionOutcome outcome ExecutionOutcome ContractTestUtils NanoTimer t ContractTestUtils NanoTimer throttleExceptions outcome skipped outcome action call outcome completed
List Callable ExecutionOutcome tasks ArrayList THREADS AtomicInteger throttleExceptions AtomicInteger THREADS tasks ExecutionOutcome outcome ExecutionOutcome ContractTestUtils NanoTimer t ContractTestUtils NanoTimer j j j throttleExceptions outcome skipped outcome action call outcome completed e LOG info e j e
ContractTestUtils NanoTimer t ContractTestUtils NanoTimer j j j throttleExceptions outcome skipped outcome action call outcome completed e LOG info e j e LOG debug e toString e throttleExceptions incrementAndGet outcome throttleExceptions add e outcome throttled e
e LOG info e j e LOG debug e toString e throttleExceptions incrementAndGet outcome throttleExceptions add e outcome throttled e LOG error operation e outcome exceptions add e tracker probe LOG info operation t elapsedTimeMs outcome tracker outcome List Future ExecutionOutcome futures executorService invokeAll tasks getTestTimeoutMillis TimeUnit MILLISECONDS
Thread r count getAndIncrement ThreadPoolExecutor executor prestartAllCoreThreads Future Exception futures Future concurrentOps f f concurrentOps f index f futures f executor Exception Exception Exception ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer Exception result store store initialize conf S3Guard TtlTimeProvider conf Exception e LOG error e getClass e getMessage result e
LOG info result run S3GuardTool Fsck NAME getFileSystem getBucket
describe result run S3GuardTool Fsck NAME Fsck DDB_MS_CONSISTENCY_FLAG getFileSystem getBucket
describe result run S3GuardTool Fsck NAME Fsck FIX_FLAG getFileSystem getBucket
describe result run S3GuardTool Fsck NAME Fsck FIX_FLAG Fsck DDB_MS_CONSISTENCY_FLAG getFileSystem getBucket
S3GuardTool BucketInfo cmd toClose S3GuardTool BucketInfo getFileSystem getConf cmd setStore getMetadataStore String output exec cmd cmd getName BucketInfo GUARDED_FLAG getFileSystem getUri toString
S3GuardTool cmd toClose S3GuardTool SetCapacity getFileSystem getConf cmd setStore getMetadataStore String output exec cmd cmd getName READ_FLAG WRITE_FLAG getFileSystem getUri toString
S3GuardTool Uploads cmd S3GuardTool Uploads fs getConf ByteArrayOutputStream buf ByteArrayOutputStream allOptions add cmd getName allOptions addAll Arrays asList options ageSeconds allOptions add Uploads SECONDS_FLAG allOptions add String valueOf ageSeconds allOptions add path toString exec cmd buf allOptions toArray String buf String line line String fields line split fields fields Uploads parsedUploads Integer parseInt fields
describe width getConf getInt KEY_DIRECTORY_COUNT DEFAULT_DIRECTORY_COUNT depth width operations getConf getLong KEY_OPERATION_COUNT DEFAULT_OPERATION_COUNT List PathMetadata origMetas ArrayList createDirTree BUCKET_ROOT depth width origMetas List Path origPaths metasToPaths origMetas List PathMetadata movedMetas moveMetas origMetas BUCKET_ROOT Path BUCKET_ROOT List Path movedPaths metasToPaths movedMetas count ms count populateMetadataStore origMetas ms describe NanoTimer moveTimer NanoTimer
timer count msec timer duration msecPerOp msec count
blocks filesize uploadBlockSize blocksPerMB _1MB uploadBlockSize S3AFileSystem fs getFileSystem StorageStatistics storageStatistics fs getStorageStatistics String putRequests Statistic OBJECT_PUT_REQUESTS getSymbol String putBytes Statistic OBJECT_PUT_BYTES getSymbol Statistic putRequestsActive Statistic OBJECT_PUT_REQUESTS_ACTIVE Statistic putBytesPending Statistic OBJECT_PUT_BYTES_PENDING ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer S3AInstrumentation OutputStreamStatistics streamStatistics blocksPer10MB blocksPerMB ProgressCallback progress ProgressCallback timer out fs uploadBlockSize progress streamStatistics getOutputStreamStatistics out
S3AInstrumentation OutputStreamStatistics streamStatistics blocksPer10MB blocksPerMB ProgressCallback progress ProgressCallback timer out uploadBlockSize progress streamStatistics getOutputStreamStatistics out LOG info out getWrappedStream streamStatistics block block block out write data written block uploadBlockSize block blocksPer10MB written filesize percentage written filesize elapsedTime timer elapsedTime
ProgressCallback progress ProgressCallback timer out uploadBlockSize progress streamStatistics getOutputStreamStatistics out LOG info out getWrappedStream streamStatistics block block block out write data written block uploadBlockSize block written filesize percentage written filesize elapsedTime timer elapsedTime writtenMB written _1MB LOG info String format percentage writtenMB filesizeMB storageStatistics getLong putBytes gaugeValue putBytesPending storageStatistics getLong putRequests gaugeValue putRequestsActive elapsedTime writtenMB elapsedTime
ProgressCallback progress ProgressCallback timer out uploadBlockSize progress streamStatistics getOutputStreamStatistics out LOG info out getWrappedStream streamStatistics block block block out write data written block uploadBlockSize block written filesize percentage written filesize elapsedTime timer elapsedTime writtenMB written _1MB LOG info String format percentage writtenMB filesizeMB storageStatistics getLong putBytes gaugeValue putBytesPending storageStatistics getLong putRequests gaugeValue putRequestsActive elapsedTime writtenMB elapsedTime
streamStatistics block block block out write data written block uploadBlockSize block written filesize percentage written filesize elapsedTime timer elapsedTime writtenMB written _1MB LOG info String format percentage writtenMB filesizeMB storageStatistics getLong putBytes gaugeValue putBytesPending storageStatistics getLong putRequests gaugeValue putRequestsActive elapsedTime writtenMB elapsedTime LOG info out LOG info streamStatistics ContractTestUtils NanoTimer closeTimer ContractTestUtils NanoTimer out close closeTimer end timer end filesizeMB uploadBlockSize
written block uploadBlockSize block written filesize percentage written filesize elapsedTime timer elapsedTime writtenMB written _1MB LOG info String format percentage writtenMB filesizeMB storageStatistics getLong putBytes gaugeValue putBytesPending storageStatistics getLong putRequests gaugeValue putRequestsActive elapsedTime writtenMB elapsedTime LOG info out LOG info streamStatistics ContractTestUtils NanoTimer closeTimer ContractTestUtils NanoTimer out close closeTimer end timer end filesizeMB uploadBlockSize logFSState bandwidth timer filesize LOG info streamStatistics
assumeHugeFileExists String encryption getConf getTrimmed SERVER_SIDE_ENCRYPTION_ALGORITHM encrypted encryption encrypted
eof size ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer ContractTestUtils NanoTimer readAtByte0 readAtByte0Again readAtEOF in readAtByte0 ContractTestUtils NanoTimer in readFully buffer readAtByte0 end ops readAtEOF ContractTestUtils NanoTimer in readFully eof bufferSize buffer readAtEOF end ops readAtByte0Again ContractTestUtils NanoTimer in readFully buffer readAtByte0Again end
readAtByte0 ContractTestUtils NanoTimer in readFully buffer readAtByte0 end ops readAtEOF ContractTestUtils NanoTimer in readFully eof bufferSize buffer readAtEOF end ops readAtByte0Again ContractTestUtils NanoTimer in readFully buffer readAtByte0Again end ops LOG info in mb Math max size _1MB logFSState
assumeHugeFileExists describe hugefile S3AFileSystem fs getFileSystem FileStatus status fs getFileStatus hugefile size status getLen blocks size uploadBlockSize data uploadBlockSize ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer in fs hugefile uploadBlockSize blocks in readFully data LOG info in mb Math max size _1MB timer end mb
assumeHugeFileExists describe hugefile hugefileRenamed S3AFileSystem fs getFileSystem FileStatus status fs getFileStatus hugefile size status getLen fs delete hugefileRenamed ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer fs rename hugefile hugefileRenamed mb Math max size _1MB timer end mb
FileStatus status fs getFileStatus hugefile size status getLen fs delete hugefileRenamed ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer fs rename hugefile hugefileRenamed mb Math max size _1MB timer end mb LOG info toHuman timer nanosPerOperation mb bandwidth timer size logFSState FileStatus destFileStatus fs getFileStatus hugefileRenamed assertEquals size destFileStatus getLen ContractTestUtils NanoTimer timer2 ContractTestUtils NanoTimer fs rename hugefileRenamed hugefile timer2 end
StringBuilder sb StringBuilder getFileSystem getStorageStatistics forEach kv sb append kv toString append
describe File results deleteFiles requests pageSize
File csvFile File dataDir String format requestCount entries throttle describe requestCount entries csvFile Path basePath path S3AFileSystem fs getFileSystem String base fs pathToKey basePath List DeleteObjectsRequest KeyVersion fileList buildDeleteRequest base entries FileWriter out FileWriter csvFile Csvout csvout Csvout out Outcome writeSchema csvout ContractTestUtils NanoTimer jobTimer ContractTestUtils NanoTimer i i requestCount i id i startTime System currentTimeMillis Thread currentThread setName id
e ex e timer end id Outcome id startTime timer ex NanoTimerStats stats NanoTimerStats NanoTimerStats success NanoTimerStats NanoTimerStats throttled NanoTimerStats List Outcome throttledEvents ArrayList Outcome outcome completionService take get ContractTestUtils NanoTimer timer outcome timer Exception ex outcome exception outcome writeln csvout stats add timer
NanoTimerStats stats NanoTimerStats NanoTimerStats success NanoTimerStats NanoTimerStats throttled NanoTimerStats List Outcome throttledEvents ArrayList i i i Outcome outcome completionService take get ContractTestUtils NanoTimer timer outcome timer Exception ex outcome exception outcome writeln csvout stats add timer ex LOG info i ex throttled add timer throttledEvents add outcome
ContractTestUtils NanoTimer timer outcome timer Exception ex outcome exception outcome writeln csvout stats add timer ex LOG info i ex throttled add timer throttledEvents add outcome success add timer csvout close jobTimer end LOG info csvFile LOG info requestCount throttled getCount stats throttled success duration jobTimer duration
LOG info executor concurrentRenames AtomicInteger count AtomicInteger Thread r Thread r count getAndIncrement ThreadPoolExecutor executor prestartAllCoreThreads Future Boolean futures Future concurrentRenames i i concurrentRenames i index i futures i executor Boolean Boolean NanoTimer timer NanoTimer result fs rename source index target index
Path finalParentDir Path scaleTestDir Path finalDir Path finalParentDir S3AFileSystem fs getFileSystem rm fs scaleTestDir fs mkdirs srcDir fs mkdirs finalParentDir createFiles fs srcDir count FileStatus statuses fs listStatus srcDir nSrcFiles statuses length sourceSize Arrays stream statuses mapToLong FileStatus getLen sum assertEquals count nSrcFiles ContractTestUtils NanoTimer renameTimer ContractTestUtils NanoTimer srcDir finalDir rename srcDir finalDir renameTimer end
renameTimer end LOG info renameTimer bandwidthDescription sourceSize LOG info String format renameTimer nanosPerOperation count Assertions assertThat lsR fs srcParentDir describedAs srcParentDir isEqualTo assertPathDoesNotExist Path srcDir filenameOfIndex assertPathDoesNotExist Path srcDir filenameOfIndex count assertPathDoesNotExist Path srcDir filenameOfIndex count Assertions assertThat lsR fs finalDir describedAs finalDir isEqualTo count Assertions assertThat fs listStatus finalDir describedAs finalDir hasSize count assertPathExists Path finalDir filenameOfIndex assertPathExists Path finalDir filenameOfIndex count assertPathExists Path finalDir filenameOfIndex count ContractTestUtils NanoTimer deleteTimer ContractTestUtils NanoTimer LOG finalDir assertDeleted finalDir
scale getConf getInt KEY_DIRECTORY_COUNT DEFAULT_DIRECTORY_COUNT width scale depth scale files scale MetricDiff metadataRequests MetricDiff fs OBJECT_METADATA_REQUESTS MetricDiff listRequests MetricDiff fs OBJECT_LIST_REQUESTS MetricDiff listContinueRequests MetricDiff fs OBJECT_CONTINUE_LIST_REQUESTS MetricDiff listStatusCalls MetricDiff fs INVOCATION_LIST_FILES MetricDiff getFileStatusCalls MetricDiff fs INVOCATION_GET_FILE_STATUS NanoTimer createTimer NanoTimer TreeScanResults created createSubdirs fs listDir depth width files emptyDepth scale emptyWidth scale created add createSubdirs fs listDir emptyDepth emptyWidth createTimer end created
remaining blockSize blockId i NanoTimer blockTimer NanoTimer reads remaining NanoTimer readTimer NanoTimer bytesRead in read block offset remaining reads bytesRead remaining bytesRead offset bytesRead count bytesRead readTimer end bytesRead
NanoTimer readTimer NanoTimer bytesRead in read block offset remaining reads bytesRead remaining bytesRead offset bytesRead count bytesRead readTimer end bytesRead LOG debug reads bytesRead blockSize remaining remaining readTimer duration readTimer nanosPerOperation bytesRead readTimer bandwidthDescription bytesRead LOG warn reads blockTimer end blockId reads String bw blockTimer bandwidthDescription blockSize
offset bytesRead count bytesRead readTimer end bytesRead LOG debug reads bytesRead blockSize remaining remaining readTimer duration readTimer nanosPerOperation bytesRead readTimer bandwidthDescription bytesRead LOG warn reads blockTimer end blockId reads String bw blockTimer bandwidthDescription blockSize LOG info blockId bw blockTimer blockSize LOG warn bw blockId Assert assertTrue bw resetCount resetCount maxResetCount resetCount getS3AInputStream in resetConnection
blockSize readahead policy in openTestFile policy readahead len testDataStatus getLen NanoTimer timer NanoTimer blockCount len blockSize
readOps bytesRead length buffer length offset read in read currentPos buffer offset length bytesRead read offset read readOps assertEquals readOps bytesRead currentPos fs in streamStatistics openOperations i currentPos i currentPos read i assertEquals i sourceData i buffer i currentPos read assertStreamOpenedExactlyOnce assertEquals readahead currentPos readTimer end bytesRead readOps bandwidth readTimer bytesRead
bytesRead length buffer length offset read in read currentPos buffer offset length bytesRead read offset read readOps assertEquals readOps bytesRead currentPos fs in streamStatistics openOperations i currentPos i currentPos read i assertEquals i sourceData i buffer i currentPos read assertStreamOpenedExactlyOnce assertEquals readahead currentPos readTimer end bytesRead readOps bandwidth readTimer bytesRead LOG info toHuman readTimer nanosPerOperation bytesRead
assertEquals sourceData currentPos buffer currentPos currentPos describe in readCount NanoTimer timer NanoTimer LOG info in seek currentPos LOG info currentPos r in read assertTrue currentPos in r buffer currentPos r assertEquals in sourceData currentPos r currentPos readCount
List String List String result ArrayList String stats scanner scanner useDelimiter CSV_INPUT_RECORD_DELIMITER_DEFAULT String l scanner nextLine
String String String selection size selection size size size String listing prepareToPrint selection
describe lines lines String line line lines
S3AFileSystem fs getFileSystem len fs getFileStatus path getLen fullData len actualLen path sourceStream fs path actualLen IOUtils read sourceStream fullData seekRange seekStream fs path SelectInputStream sis SelectInputStream seekStream getWrappedStream S3AInstrumentation InputStreamStatistics streamStats sis getS3AStreamStatistics seekStream seek assertEquals fullData seekStream read seekStream seek seekStream seek PathIOException ex intercept PathIOException SelectInputStream SEEK_UNSUPPORTED seekStream seek
intercept PathIOException SelectInputStream SEEK_UNSUPPORTED seekStream readFully buffer assertPosition seekStream pos intercept PathIOException SelectInputStream SEEK_UNSUPPORTED seekStream readFully pos buffer seekStream setReadahead assertEquals Constants DEFAULT_READAHEAD_RANGE sis getReadahead target seekStream getPos seekRange seek seekStream target assertPosition seekStream target assertEquals fullData seekStream getPos seekStream read assertEquals streamStats seekRange streamStats bytesSkippedOnSeek intercept IllegalArgumentException S3AInputStream E_NEGATIVE_READAHEAD_VALUE seekStream setReadahead read seekStream read seekStream getPos buffer assertEquals read logIntercepted expectSeekEOF seekStream actualLen assertPosition seekStream actualLen
assertEquals Constants DEFAULT_READAHEAD_RANGE sis getReadahead target seekStream getPos seekRange seek seekStream target assertPosition seekStream target assertEquals fullData seekStream getPos seekStream read assertEquals streamStats seekRange streamStats bytesSkippedOnSeek intercept IllegalArgumentException S3AInputStream E_NEGATIVE_READAHEAD_VALUE seekStream setReadahead read seekStream read seekStream getPos buffer assertEquals read logIntercepted expectSeekEOF seekStream actualLen assertPosition seekStream actualLen assertEquals seekStream read LOG info streamStats assertFalse seekStream seekStream seekToNewSource seekStream setReadahead
describe len getFileSystem getFileStatus csvPath getLen FutureDataInputStreamBuilder builder getFileSystem openFile csvPath must SELECT_ODD_ENTRIES must must must must CompletableFuture FSDataInputStream future builder build FSDataInputStream select future bytes len actual select read bytes
describe JobConf conf createJobConf inputMust conf CSV_INPUT_HEADER CSV_HEADER_OPT_USE inputMust conf CSV_OUTPUT_QUOTE_FIELDS CSV_OUTPUT_QUOTE_FIELDS_AS_NEEEDED String sql SELECT_TO_DATE List String records expectRecordsRead ALL_ROWS_COUNT conf sql
describe selectConf set CSV_INPUT_HEADER CSV_HEADER_OPT_USE List String lines verifySelectionCount ALL_ROWS_COUNT_WITH_HEADER parseToLines select getFileSystem brokenCSV selectConf
describe selectConf set CSV_INPUT_HEADER CSV_HEADER_OPT_USE List String lines verifySelectionCount ALL_ROWS_COUNT_WITH_HEADER parseToLines select getFileSystem brokenCSV selectConf
describe lineCount LINE_COUNT S3AFileSystem landsatFS S3AFileSystem getLandsatGZ getFileSystem getConfiguration S3ATestUtils MetricDiff selectCount S3ATestUtils MetricDiff landsatFS Statistic OBJECT_SELECT_REQUESTS run selectConf selectTool D v CSV_OUTPUT_QUOTE_CHARACTER D v CSV_OUTPUT_QUOTE_FIELDS CSV_OUTPUT_QUOTE_FIELDS_AS_NEEEDED o OPT_HEADER CSV_HEADER_OPT_USE o OPT_COMPRESSION COMPRESSION_OPT_GZIP o OPT_LIMIT Integer toString lineCount o OPT_OUTPUT localFile toString landsatSrc SELECT_SUNNY_ROWS_NO_LIMIT List String lines IOUtils readLines FileInputStream localFile Charset defaultCharset
describe selectConf set CSV_INPUT_HEADER CSV_HEADER_OPT_IGNORE String sql LIMITED List String list selectLandsatFile selectConf sql
describe S3ATestUtils MetricDiff selectCount S3ATestUtils MetricDiff getLandsatFS Statistic OBJECT_SELECT_REQUESTS List String list selectLandsatFile selectConf SELECT_ENTITY_ID_ALL_CLOUDS
describe FileContext fc S3ATestUtils createTestFileContext getConfiguration List String list parseToLines select fc getLandsatGZ selectConf SELECT_ENTITY_ID_ALL_CLOUDS SELECT_LIMIT
intercept PathIOException SelectInputStream SEEK_UNSUPPORTED seekStream readFully buffer target seekStream getPos seekRange seek seekStream target assertEquals seekStream target seekStream getPos assertEquals dataset seekStream getPos seekStream read assertEquals streamStats seekRange streamStats bytesSkippedOnSeek offset increment _1KB offset _1KB offset offset increment seek seekStream offset assertEquals seekStream offset seekStream getPos assertEquals dataset seekStream getPos seekStream read offset offset seek seekStream offset assertEquals seekStream offset seekStream getPos
jobConf set FS_S3A_COMMITTER_NAME StagingCommitter NAME jobConf setBoolean FS_S3A_COMMITTER_STAGING_UNIQUE_FILENAMES String query ITestS3SelectLandsat SELECT_PROCESSING_LEVEL_NO_LIMIT inputMust jobConf SELECT_SQL query inputMust jobConf SELECT_INPUT_COMPRESSION COMPRESSION_OPT_GZIP inputMust jobConf SELECT_INPUT_FORMAT SELECT_FORMAT_CSV inputMust jobConf CSV_INPUT_HEADER CSV_HEADER_OPT_USE inputMust jobConf SELECT_OUTPUT_FORMAT SELECT_FORMAT_CSV inputMust jobConf CSV_OUTPUT_QUOTE_FIELDS CSV_OUTPUT_QUOTE_FIELDS_AS_NEEEDED enablePassthroughCodec jobConf query exitCode job waitForCompletion assertEquals exitCode Path successPath Path output SuccessData success SuccessData load fs successPath
jobConf setBoolean FS_S3A_COMMITTER_STAGING_UNIQUE_FILENAMES String query ITestS3SelectLandsat SELECT_PROCESSING_LEVEL_NO_LIMIT inputMust jobConf SELECT_SQL query inputMust jobConf SELECT_INPUT_COMPRESSION COMPRESSION_OPT_GZIP inputMust jobConf SELECT_INPUT_FORMAT SELECT_FORMAT_CSV inputMust jobConf CSV_INPUT_HEADER CSV_HEADER_OPT_USE inputMust jobConf SELECT_OUTPUT_FORMAT SELECT_FORMAT_CSV inputMust jobConf CSV_OUTPUT_QUOTE_FIELDS CSV_OUTPUT_QUOTE_FIELDS_AS_NEEEDED enablePassthroughCodec jobConf LOG query exitCode job waitForCompletion assertEquals exitCode Path successPath Path output SuccessData success SuccessData load fs successPath LOG info success
inputMust jobConf CSV_OUTPUT_QUOTE_FIELDS CSV_OUTPUT_QUOTE_FIELDS_AS_NEEEDED enablePassthroughCodec jobConf LOG query exitCode job waitForCompletion assertEquals exitCode Path successPath Path output SuccessData success SuccessData load fs successPath LOG info success LOG info query AtomicLong parts AtomicLong fs output status Path path status getPath path parts incrementAndGet String result readStringFromFile path
List String reader List String lines org apache commons io IOUtils readLines reader
job setJarByClass WordCount job setMapperClass WordCount TokenizerMapper job setCombinerClass WordCount IntSumReducer job setReducerClass WordCount IntSumReducer job setOutputKeyClass Text job setOutputValueClass IntWritable FileInputFormat addInputPath job input FileOutputFormat setOutputPath job output exitCode job waitForCompletion assertEquals exitCode Path success Path output _SUCCESS FileStatus status fs getFileStatus success assertTrue success status getLen SuccessData successData SuccessData load fs success String commitDetails successData toString
String invocation Object args invocation getArguments String name String args
String accountName Preconditions checkArgument StringUtils isNotEmpty accountName String accountPrefix AZURE_AD_ACCOUNT_PREFIX accountName
operationStatus threadsEnabled threadCount threadCount ThreadPoolExecutor ioThreadPool start Time monotonicNow threadCount Math min contents length threadCount threadCount ioThreadPool getThreadPool threadCount threadsEnabled LOG warn threadCount operation key config LOG warn operation threadCount threadsEnabled
ioThreadPool getThreadPool threadCount threadsEnabled LOG warn threadCount operation key config LOG warn operation threadCount threadsEnabled LOG debug operation threadCount started AzureFileSystemThreadRunnable runnable AzureFileSystemThreadRunnable contents threadOperation operation threadCount runnable runnable ioThreadPool execute runnable started
LOG warn operation threadCount LOG debug operation threadCount started AzureFileSystemThreadRunnable runnable AzureFileSystemThreadRunnable contents threadOperation operation threadCount runnable runnable ioThreadPool execute runnable started LOG error operation key config ioThreadPool shutdown ioThreadPool awaitTermination Long MAX_VALUE TimeUnit DAYS
AzureFileSystemThreadRunnable runnable AzureFileSystemThreadRunnable contents threadOperation operation threadCount runnable runnable ioThreadPool execute runnable started LOG error operation key config ioThreadPool shutdown ioThreadPool awaitTermination Long MAX_VALUE TimeUnit DAYS ioThreadPool shutdownNow Thread currentThread interrupt LOG error operation key threadsNotUsed threadCount runnable threadsUsed get
started LOG error operation key config ioThreadPool shutdown ioThreadPool awaitTermination Long MAX_VALUE TimeUnit DAYS ioThreadPool shutdownNow Thread currentThread interrupt LOG error operation key threadsNotUsed threadCount runnable threadsUsed get threadsNotUsed LOG warn threadsNotUsed operation key started threadsEnabled
ioThreadPool shutdown ioThreadPool awaitTermination Long MAX_VALUE TimeUnit DAYS ioThreadPool shutdownNow Thread currentThread interrupt LOG error operation key threadsNotUsed threadCount runnable threadsUsed get threadsNotUsed LOG warn threadsNotUsed operation key threadsEnabled LOG info operation key operation IOException lastException runnable lastException
LOG error operation key threadsNotUsed threadCount runnable threadsUsed get threadsNotUsed LOG warn threadsNotUsed operation key threadsEnabled LOG info operation key operation IOException lastException runnable lastException lastException runnable operationStatus runnable get LOG error operation lastException IOException operation lastException lastException operationStatus runnable operationStatus
storageInteractionLayer StorageInterfaceImpl storageInteractionLayer SecureStorageInterfaceImpl useLocalSasKeyMode conf configureAzureStorageSession createAzureStorageSession pageBlobDirs getDirectorySet KEY_PAGE_BLOB_DIRECTORIES LOG debug setToString pageBlobDirs userAgentId conf get USER_AGENT_ID_KEY USER_AGENT_ID_DEFAULT blockBlobWithCompationDirs getDirectorySet KEY_BLOCK_BLOB_WITH_COMPACTION_DIRECTORIES LOG debug setToString blockBlobWithCompationDirs atomicRenameDirs getDirectorySet KEY_ATOMIC_RENAME_DIRECTORIES String hbaseRoot hbaseRoot verifyAndConvertToStandardFormat sessionConfiguration get hbaseRoot
cpuCores Runtime getRuntime availableProcessors concurrentWrites sessionConfiguration getInt KEY_CONCURRENT_CONNECTION_VALUE_OUT Math min cpuCores DEFAULT_CONCURRENT_WRITES minBackoff sessionConfiguration getInt KEY_MIN_BACKOFF_INTERVAL DEFAULT_MIN_BACKOFF_INTERVAL maxBackoff sessionConfiguration getInt KEY_MAX_BACKOFF_INTERVAL DEFAULT_MAX_BACKOFF_INTERVAL deltaBackoff sessionConfiguration getInt KEY_BACKOFF_INTERVAL DEFAULT_BACKOFF_INTERVAL maxRetries sessionConfiguration getInt KEY_MAX_IO_RETRIES DEFAULT_MAX_RETRY_ATTEMPTS storageInteractionLayer setRetryPolicyFactory RetryExponentialRetry minBackoff deltaBackoff maxBackoff maxRetries selfThrottlingEnabled sessionConfiguration getBoolean KEY_SELF_THROTTLE_ENABLE DEFAULT_SELF_THROTTLE_ENABLE selfThrottlingReadFactor sessionConfiguration getFloat KEY_SELF_THROTTLE_READ_FACTOR DEFAULT_SELF_THROTTLE_READ_FACTOR selfThrottlingWriteFactor sessionConfiguration getFloat KEY_SELF_THROTTLE_WRITE_FACTOR DEFAULT_SELF_THROTTLE_WRITE_FACTOR selfThrottlingEnabled autoThrottlingEnabled sessionConfiguration getBoolean KEY_AUTO_THROTTLE_ENABLE DEFAULT_AUTO_THROTTLE_ENABLE autoThrottlingEnabled ClientThrottlingIntercept initializeSingleton
instrumentation setAccountName accountName String containerName getContainerFromAuthority sessionUri instrumentation setContainerName containerName accountName connectUsingCredentials accountName containerName connectToAzureStorageInSecureMode accountName containerName sessionUri String propertyValue sessionConfiguration get KEY_ACCOUNT_SAS_PREFIX containerName accountName propertyValue connectUsingSASCredentials accountName containerName propertyValue propertyValue getAccountKeyFromConfiguration accountName sessionConfiguration propertyValue
String errMsg String format sessionUri AssertionError errMsg LOG debug key key FileMetadata key defaultPermissionNoBlobMetadata BlobMaterialization Implicit hadoopBlockSize CloudBlobWrapper blob getBlobReference key blob blob getInstrumentedContext LOG debug key blob downloadAttributes getInstrumentedContext BlobProperties properties blob getProperties blob
LOG debug key key FileMetadata key defaultPermissionNoBlobMetadata BlobMaterialization Implicit hadoopBlockSize CloudBlobWrapper blob getBlobReference key blob blob getInstrumentedContext LOG debug key blob downloadAttributes getInstrumentedContext BlobProperties properties blob getProperties blob LOG debug key FileMetadata key properties getLastModified getTime getPermissionStatus blob BlobMaterialization Explicit hadoopBlockSize
Throwable t e getCause t StorageException StorageException se StorageException t se SelfRenewingLease lease lease acquireLease key delete key lease e3 LOG warn key e3 getMessage e3 lease lease free
flush ioThreadPool shutdown ioThreadPool LOG error key NativeAzureFileSystemHelper logAllLiveStackTraces AzureException Thread currentThread interrupt lease free
blockId dataPayload IOException lastLocalException uploadRetryAttempts uploadRetryAttempts startTime System nanoTime blob uploadBlock blockId accessCondition ByteArrayInputStream dataPayload array dataPayload position BlobRequestOptions opContext
IOException lastLocalException uploadRetryAttempts uploadRetryAttempts startTime System nanoTime blob commitBlockList blockEntries accessCondition BlobRequestOptions opContext
reductionFactor consecutiveNoErrorCount analysisPeriodMs RAPID_SLEEP_DECREASE_TRANSITION_PERIOD_MS RAPID_SLEEP_DECREASE_FACTOR SLEEP_DECREASE_FACTOR newSleepDuration sleepDuration reductionFactor newSleepDuration sleepDuration consecutiveNoErrorCount additionalDelayNeeded analysisPeriodMs bytesSuccessful additionalDelayNeeded bytesSuccessful bytesFailed periodMs bytesSuccessful periodMs newSleepDuration additionalDelayNeeded operationsFailed operationsSuccessful maxSleepDuration analysisPeriodMs minSleepDuration sleepDuration SLEEP_INCREASE_FACTOR newSleepDuration Math max newSleepDuration minSleepDuration newSleepDuration Math min newSleepDuration maxSleepDuration
initialize uri conf store store createDefaultStore conf instrumentation AzureFileSystemInstrumentation conf conf getBoolean AzureFileSystemMetricsSystem fileSystemStarted metricsSourceName newMetricsSourceName String sourceDesc AzureFileSystemMetricsSystem registerSource metricsSourceName sourceDesc instrumentation store initialize uri conf instrumentation setConf conf ugi UserGroupInformation getCurrentUser uri URI create uri getScheme uri getAuthority workingDir Path UserGroupInformation getCurrentUser getShortUserName makeQualified getUri getWorkingDirectory appendSupportEnabled conf getBoolean APPEND_SUPPORT_ENABLE_PROPERTY_NAME
FileMetadata parentMetadata String parentKey parentPath parentKey pathToKey parentPath parentMetadata store retrieveMetadata parentKey IOException e Throwable innerException checkForAzureStorageException e innerException innerException IOException f parentPath e parentMetadata IOException f parentPath
IOException f parentPath AzureException f parentPath parentPath parentPath LOG debug f parentKey store storeEmptyFolder parentKey createPermissionStatus FsPermission getDefault updateParentFolderLastModifiedTime key WasbAuthorizationException String format parentPath f
AzureException f parentPath parentPath parentPath LOG debug f parentKey store storeEmptyFolder parentKey createPermissionStatus FsPermission getDefault updateParentFolderLastModifiedTime key WasbAuthorizationException String format parentPath f store key instrumentation fileDeleted
e LOG debug f parentPath parentPath LOG debug f parentKey store storeEmptyFolder parentKey createPermissionStatus FsPermission getDefault metaFile metaFile WasbAuthorizationException String format parentPath f ArrayList FileMetadata fileMetadataList ArrayList isPartialDelete start Time monotonicNow isPartialDelete getFolderContentsToDelete metaFile fileMetadataList
LOG debug f parentPath parentPath LOG debug f parentKey store storeEmptyFolder parentKey createPermissionStatus FsPermission getDefault metaFile metaFile WasbAuthorizationException String format parentPath f ArrayList FileMetadata fileMetadataList ArrayList isPartialDelete start Time monotonicNow isPartialDelete getFolderContentsToDelete metaFile fileMetadataList e Throwable innerException checkForAzureStorageException e
store storeEmptyFolder parentKey createPermissionStatus FsPermission getDefault metaFile metaFile WasbAuthorizationException String format parentPath f ArrayList FileMetadata fileMetadataList ArrayList isPartialDelete start Time monotonicNow isPartialDelete getFolderContentsToDelete metaFile fileMetadataList e Throwable innerException checkForAzureStorageException e innerException innerException e end Time monotonicNow LOG debug fileMetadataList size end start
parentPath String parentKey pathToKey parentPath FileMetadata parentMetadata parentMetadata store retrieveMetadata parentKey IOException e Throwable innerException checkForAzureStorageException e innerException innerException IOException f parentPath e parentMetadata IOException f parentPath
e IOException f parentPath AzureException f parentPath LOG debug f parentKey store storeEmptyFolder parentKey createPermissionStatus FsPermission getDefault updateParentFolderLastModifiedTime key store key instrumentation fileDeleted
instrumentation fileDeleted e Throwable innerException checkForAzureStorageException e innerException innerException e LOG debug f parentPath String parentKey pathToKey parentPath FileMetadata parentMetadata
IOException e Throwable innerException checkForAzureStorageException e innerException innerException IOException f parentPath e IOException f parentPath LOG debug f parentKey store storeEmptyFolder parentKey createPermissionStatus FsPermission getDefault start Time monotonicNow FileMetadata contents contents store list key AZURE_LIST_ALL AZURE_UNBOUNDED_DEPTH
e IOException f parentPath LOG debug f parentKey store storeEmptyFolder parentKey createPermissionStatus FsPermission getDefault start Time monotonicNow FileMetadata contents contents store list key AZURE_LIST_ALL AZURE_UNBOUNDED_DEPTH IOException e Throwable innerException checkForAzureStorageException e innerException innerException e
foldersToProcess FileMetadata currentFolder foldersToProcess pop Path currentPath makeAbsolute currentFolder getPath canDeleteChildren performAuthCheck currentPath WasbAuthorizationOperations WRITE pathToDelete LOG debug currentPath canDeleteChildren canDeleteChildren FileMetadata fileMetadataList store list currentFolder getKey AZURE_LIST_ALL maxListingDepth FileMetadata childItem fileMetadataList childItem currentFolder canDeleteChildren Path filePath makeAbsolute childItem getPath
LOG debug currentPath canDeleteChildren canDeleteChildren FileMetadata fileMetadataList store list currentFolder getKey AZURE_LIST_ALL maxListingDepth FileMetadata childItem fileMetadataList childItem currentFolder canDeleteChildren Path filePath makeAbsolute childItem getPath LOG error filePath childItem foldersToProcess push childItem folderContentsMap put childItem getKey childItem
canDeleteChildren FileMetadata fileMetadataList store list currentFolder getKey AZURE_LIST_ALL maxListingDepth FileMetadata childItem fileMetadataList childItem currentFolder canDeleteChildren Path filePath makeAbsolute childItem getPath LOG error filePath childItem foldersToProcess push childItem folderContentsMap put childItem getKey childItem LOG error currentPath canDeleteChildren String pathToRemove currentFolder getKey
FileStatus Path f FileNotFoundException Path absolutePath makeAbsolute f String key pathToKey absolutePath key FileStatus store getHadoopBlockSize FsPermission getDefault absolutePath makeQualified getUri getWorkingDirectory FileMetadata meta meta store retrieveMetadata key ex Throwable innerException NativeAzureFileSystemHelper checkForAzureStorageException ex innerException NativeAzureFileSystemHelper innerException FileNotFoundException String format key ex meta meta
renamed conditionalRedoFolderRenames listing renamed listing listWithErrorHandling key AZURE_LIST_ALL FileMetadata result key ArrayList FileMetadata status ArrayList listing length FileMetadata fileMetadata listing fileMetadata fileMetadata status add updateFileStatusPath fileMetadata fileMetadata getPath status add updateFileStatusPath fileMetadata fileMetadata getPath result status toArray FileMetadata
Path Path Path current current current current String currentKey pathToKey current FileMetadata currentMetadata store retrieveMetadata currentKey currentMetadata currentMetadata Path ancestor currentMetadata getPath
FolderRenamePending renamePending
Path absoluteSrcPath makeAbsolute src Path srcParentFolder absoluteSrcPath getParent srcParentFolder String srcKey pathToKey absoluteSrcPath srcKey performAuthCheck srcParentFolder WasbAuthorizationOperations WRITE absoluteSrcPath performStickyBitCheckForRenameOperation absoluteSrcPath srcParentFolder ex ex Throwable innerException checkForAzureStorageException ex
ex ex Throwable innerException checkForAzureStorageException ex innerException innerException LOG debug srcKey ex Path absoluteDstPath makeAbsolute dst Path dstParentFolder absoluteDstPath getParent String dstKey pathToKey absoluteDstPath FileMetadata dstMetadata dstMetadata store retrieveMetadata dstKey ex
innerException innerException LOG debug srcKey ex Path absoluteDstPath makeAbsolute dst Path dstParentFolder absoluteDstPath getParent String dstKey pathToKey absoluteDstPath FileMetadata dstMetadata dstMetadata store retrieveMetadata dstKey ex Throwable innerException NativeAzureFileSystemHelper checkForAzureStorageException ex innerException NativeAzureFileSystemHelper innerException LOG debug dstKey
ex Path absoluteDstPath makeAbsolute dst Path dstParentFolder absoluteDstPath getParent String dstKey pathToKey absoluteDstPath FileMetadata dstMetadata dstMetadata store retrieveMetadata dstKey ex Throwable innerException NativeAzureFileSystemHelper checkForAzureStorageException ex innerException NativeAzureFileSystemHelper innerException LOG debug dstKey ex
dstMetadata store retrieveMetadata dstKey ex Throwable innerException NativeAzureFileSystemHelper checkForAzureStorageException ex innerException NativeAzureFileSystemHelper innerException LOG debug dstKey ex dstMetadata dstMetadata performAuthCheck absoluteDstPath WasbAuthorizationOperations WRITE absoluteDstPath dstKey pathToKey makeAbsolute Path dst src getName LOG debug dst dstKey dstMetadata LOG debug dst
Throwable innerException NativeAzureFileSystemHelper checkForAzureStorageException ex innerException NativeAzureFileSystemHelper innerException LOG debug dstKey ex performAuthCheck absoluteDstPath WasbAuthorizationOperations WRITE absoluteDstPath dstKey pathToKey makeAbsolute Path dst src getName LOG debug dst dstKey LOG debug dst FileMetadata parentOfDestMetadata
LOG debug dstKey ex performAuthCheck absoluteDstPath WasbAuthorizationOperations WRITE absoluteDstPath dstKey pathToKey makeAbsolute Path dst src getName LOG debug dst dstKey LOG debug dst FileMetadata parentOfDestMetadata parentOfDestMetadata store retrieveMetadata pathToKey absoluteDstPath getParent ex
LOG debug dst performAuthCheck dstParentFolder WasbAuthorizationOperations WRITE absoluteDstPath FileMetadata srcMetadata srcMetadata store retrieveMetadata srcKey ex Throwable innerException NativeAzureFileSystemHelper checkForAzureStorageException ex innerException NativeAzureFileSystemHelper innerException LOG debug src ex srcMetadata
performAuthCheck dstParentFolder WasbAuthorizationOperations WRITE absoluteDstPath FileMetadata srcMetadata srcMetadata store retrieveMetadata srcKey ex Throwable innerException NativeAzureFileSystemHelper checkForAzureStorageException ex innerException NativeAzureFileSystemHelper innerException LOG debug src ex srcMetadata LOG debug src srcMetadata LOG debug src
store updateFolderLastModifiedTime parentKey lease e String errorCode StorageException e2 StorageException e getCause errorCode e2 getErrorCode errorCode FileNotFoundException parentKey LOG warn parentKey e getMessage e lease lease free
srcPath String srcKey pathToKey srcPath FileMetadata srcMetadata srcMetadata store retrieveMetadata srcKey srcMetadata
String absolutePath String owner FileMetadata meta String key pathToKey absolutePath meta store retrieveMetadata key meta owner meta getOwner
String owner FileMetadata meta String key pathToKey absolutePath meta store retrieveMetadata key meta owner meta getOwner LOG debug owner absolutePath LOG debug absolutePath ex Throwable innerException NativeAzureFileSystemHelper checkForAzureStorageException ex isfileNotFoundException innerException StorageException NativeAzureFileSystemHelper isFileNotFoundException StorageException innerException isfileNotFoundException String errorMsg absolutePath
String errorMsg
String errorMsg
String errorMsg
String errorMsg
Token Token token Token iterToken iterToken token iterToken
sleepMultiple writeFactor operationIsRead sleepMultiple readFactor sleepDuration sleepMultiple lastLatency sleepDuration sleepDuration sleepDuration Thread sleep sleepDuration Thread currentThread interrupt sendEvent getRequestResult setStartDate Date isFirstRequest lastLatency
RetryPolicy RetryAction a retryPolicy retryPolicy shouldRetry ioe retry RetryPolicy RetryAction FAIL isRetry a action RetryPolicy RetryAction RetryDecision RETRY isFailoverAndRetry a action RetryPolicy RetryAction RetryDecision FAILOVER_AND_RETRY isRetry isFailoverAndRetry LOG debug url retry retryPolicy a delayMillis Thread sleep a delayMillis e LOG warn e getMessage e Thread currentThread interrupt e LOG warn ioe WasbRemoteCallException e getMessage e
initialize uri configuration uri ensureAuthority uri configuration initialize uri configuration setConf configuration
abfsCounters AbfsCountersImpl uri abfsStore AzureBlobFileSystemStore uri isSecureScheme configuration abfsCounters LOG trace AbfsConfiguration abfsConfiguration abfsStore getAbfsConfiguration setWorkingDirectory getHomeDirectory abfsConfiguration createFileSystem ex checkException ex AzureServiceErrorCode FILE_SYSTEM_ALREADY_EXISTS LOG trace delegationTokenEnabled abfsConfiguration isDelegationTokenManagerEnabled delegationTokenEnabled
AbfsConfiguration abfsConfiguration abfsStore getAbfsConfiguration setWorkingDirectory getHomeDirectory abfsConfiguration createFileSystem ex checkException ex AzureServiceErrorCode FILE_SYSTEM_ALREADY_EXISTS LOG trace delegationTokenEnabled abfsConfiguration isDelegationTokenManagerEnabled delegationTokenEnabled LOG debug uri delegationTokenManager abfsConfiguration getDelegationTokenManager delegationTokenManager bind getUri configuration
abfsConfiguration createFileSystem ex checkException ex AzureServiceErrorCode FILE_SYSTEM_ALREADY_EXISTS LOG trace delegationTokenEnabled abfsConfiguration isDelegationTokenManagerEnabled delegationTokenEnabled LOG debug uri delegationTokenManager abfsConfiguration getDelegationTokenManager delegationTokenManager bind getUri configuration LOG debug delegationTokenManager AbfsClientThrottlingIntercept initializeSingleton abfsConfiguration isAutoThrottlingEnabled
isNamespaceEnabled getIsNamespaceEnabled
isNamespaceEnabled getIsNamespaceEnabled
Instant startAggregate abfsPerfTracker getLatencyInstant countAggregate shouldContinue
isNamespaceEnabled getIsNamespaceEnabled
Instant startAggregate abfsPerfTracker getLatencyInstant countAggregate shouldContinue
tenantGuid authority QueryParams qp QueryParams qp add qp add RESOURCE_NAME tenantGuid tenantGuid authority authority tenantGuid
httperror ex token getTokenSingleCall authEndpoint body headers httpMethod isMsi HttpException e httperror e httpErrorCode ex e e httperror isRecoverableFailure isRecoverableFailure e ex HttpException httperror String format e getClass getTypeName e getMessage authEndpoint succeeded httperror ex shouldRetry succeeded isRecoverableFailure tokenFetchRetryPolicy shouldRetry retryCount httperror retryCount shouldRetry
jp nextToken jp jp fieldName jp getCurrentName jp nextToken fieldValue jp getText fieldName token setAccessToken fieldValue fieldName expiryPeriodInSecs Integer parseInt fieldValue fieldName expiresOnInSecs Long parseLong fieldValue jp nextToken jp close expiresOnInSecs
expiryPeriodInSecs Integer parseInt fieldValue expiresOnInSecs Long parseLong fieldValue jp nextToken jp close expiresOnInSecs LOG debug expiresOnInSecs token setExpiry Date expiresOnInSecs UnsupportedOperationException LOG debug expiryPeriodInSecs expiry System currentTimeMillis expiry expiry expiryPeriodInSecs token setExpiry Date expiry
reductionFactor consecutiveNoErrorCount analysisPeriodMs RAPID_SLEEP_DECREASE_TRANSITION_PERIOD_MS RAPID_SLEEP_DECREASE_FACTOR SLEEP_DECREASE_FACTOR newSleepDuration sleepDuration reductionFactor newSleepDuration sleepDuration consecutiveNoErrorCount additionalDelayNeeded analysisPeriodMs bytesSuccessful additionalDelayNeeded bytesSuccessful bytesFailed periodMs bytesSuccessful periodMs newSleepDuration additionalDelayNeeded operationsFailed operationsSuccessful maxSleepDuration analysisPeriodMs minSleepDuration sleepDuration SLEEP_INCREASE_FACTOR newSleepDuration Math max newSleepDuration minSleepDuration newSleepDuration Math min newSleepDuration maxSleepDuration
b IllegalArgumentException offset b length IllegalArgumentException length IllegalArgumentException length b length offset IllegalArgumentException AbfsRestOperation op AbfsPerfTracker tracker client getAbfsPerfTracker tracker LOG trace path position offset length op client read path position b offset length tolerateOobAppends eTag cachedSasToken get cachedSasToken update op getSasToken
LOG debug n IOException FSExceptionMessages STREAM_IS_CLOSED n EOFException FSExceptionMessages NEGATIVE_SEEK n EOFException FSExceptionMessages CANNOT_SEEK_PAST_EOF streamStatistics streamStatistics seek n fCursor n fCursor limit n fCursor bCursor n fCursor limit streamStatistics streamStatistics seekInBuffer fCursor n
Instant trackerStart latencyDetails queue offer latencyDetails Instant trackerStop Instant now elapsed Duration between trackerStart trackerStop toMillis
AbfsIoUtils dumpHeadersToDebugLog httpOperation getConnection getRequestProperties AbfsClientThrottlingIntercept sendingRequest operationType abfsCounters httpOperation sendRequest buffer bufferOffset bufferLength incrementCounter AbfsStatistic SEND_REQUESTS incrementCounter AbfsStatistic BYTES_SENT bufferLength httpOperation processResponse buffer bufferOffset bufferLength incrementCounter AbfsStatistic GET_RESPONSES incrementCounter AbfsStatistic BYTES_RECEIVED httpOperation getBytesReceived LOG warn String format httpOperation getUrl getHost LOG httpOperation
AbfsIoUtils dumpHeadersToDebugLog httpOperation getConnection getRequestProperties AbfsClientThrottlingIntercept sendingRequest operationType abfsCounters httpOperation sendRequest buffer bufferOffset bufferLength incrementCounter AbfsStatistic SEND_REQUESTS incrementCounter AbfsStatistic BYTES_SENT bufferLength httpOperation processResponse buffer bufferOffset bufferLength incrementCounter AbfsStatistic GET_RESPONSES incrementCounter AbfsStatistic BYTES_RECEIVED httpOperation getBytesReceived ex ex LOG warn String format httpOperation getUrl getHost LOG httpOperation LOG debug httpOperation toString ex
incrementCounter AbfsStatistic BYTES_RECEIVED httpOperation getBytesReceived ex ex LOG warn String format httpOperation getUrl getHost LOG httpOperation LOG debug httpOperation toString ex LOG debug method url ex InvalidAbfsRestOperationException ex ex HttpException AbfsRestOperationException HttpException ex
connection contentLength String gmtTime getGMTTime connection setRequestProperty HttpHeaderConfigurations X_MS_DATE gmtTime String stringToSign canonicalize connection accountName contentLength String computedBase64Signature computeHmac256 stringToSign String signature String format accountName computedBase64Signature connection setRequestProperty HttpHeaderConfigurations AUTHORIZATION signature
signedExpiryLen start token indexOf signedExpiry start OffsetDateTime MIN start signedExpiryLen end token indexOf start String seValue end token substring start token substring start end seValue URLDecoder decode seValue ex LOG error seValue ex OffsetDateTime MIN OffsetDateTime seDate OffsetDateTime MIN seDate OffsetDateTime parse seValue DateTimeFormatter ISO_DATE_TIME
LOG error seValue ex OffsetDateTime MIN OffsetDateTime seDate OffsetDateTime MIN seDate OffsetDateTime parse seValue DateTimeFormatter ISO_DATE_TIME ex LOG error seValue ex String signedKeyExpiry signedKeyExpiryLen start token indexOf signedKeyExpiry start seDate start signedKeyExpiryLen end token indexOf start String skeValue end token substring start token substring start end
ex LOG error seValue ex String signedKeyExpiry signedKeyExpiryLen start token indexOf signedKeyExpiry start seDate start signedKeyExpiryLen end token indexOf start String skeValue end token substring start token substring start end skeValue URLDecoder decode skeValue ex LOG error skeValue ex OffsetDateTime MIN
LOG debug fileLocation errorRecord File file File fileLocation LineIterator it it FileUtils lineIterator file it String line it nextLine line line line split COLON errorRecord cache put line split COLON keyIndex line LOG debug fileLocation cache size errorRecord
FileSystem fs accountUsingInputStreamV1 getFileSystem fs TEST_FILE_PATH testFileStatus fs getFileStatus TEST_FILE_PATH testFileLength testFileStatus getLen
assumeHugeFileExists maxAttempts maxAcceptableRatio v1ElapsedMs v2ElapsedMs ratio Double MAX_VALUE maxAttempts ratio maxAcceptableRatio v1ElapsedMs sequentialRead accountUsingInputStreamV1 getFileSystem v2ElapsedMs sequentialRead accountUsingInputStreamV2 getFileSystem ratio v2ElapsedMs v1ElapsedMs
assumeHugeFileExists maxAttempts maxAcceptableRatio beforeSeekElapsedMs afterSeekElapsedMs ratio Double MAX_VALUE maxAttempts ratio maxAcceptableRatio beforeSeekElapsedMs sequentialRead accountUsingInputStreamV2 getFileSystem afterSeekElapsedMs sequentialRead accountUsingInputStreamV2 getFileSystem ratio afterSeekElapsedMs beforeSeekElapsedMs
buffer KILOBYTE totalBytesRead bytesRead inputStream bytesRead totalBytesRead bytesRead inputStream read buffer totalBytesRead bytesRead totalBytesRead inputStream seek NanoTimer timer NanoTimer bytesRead inputStream read buffer totalBytesRead bytesRead elapsedTimeMs timer elapsedTimeMs
assumeHugeFileExists maxAttempts maxAcceptableRatio v1ElapsedMs v2ElapsedMs ratio Double MAX_VALUE maxAttempts ratio maxAcceptableRatio v1ElapsedMs randomRead accountUsingInputStreamV1 getFileSystem v2ElapsedMs randomRead accountUsingInputStreamV2 getFileSystem ratio v2ElapsedMs v1ElapsedMs
assumeHugeFileExists minBytesToRead MEGABYTE Random random Random buffer KILOBYTE totalBytesRead bytesRead inputStream NanoTimer timer NanoTimer bytesRead inputStream read buffer totalBytesRead bytesRead inputStream seek random nextInt testFileLength buffer length bytesRead totalBytesRead minBytesToRead elapsedTimeMs timer elapsedTimeMs inputStream close
String content String term assertTrue content isEmpty content term String message term
String content String term assertTrue content isEmpty content term String message term
setUp setUp Configuration conf getConfiguration threads AzureTestUtils getTestPropertyInt conf NUMBER_OF_THREADS filesPerThread AzureTestUtils getTestPropertyInt conf NUMBER_OF_FILES_PER_THREAD expectedFileCount threads filesPerThread
String basePath fs getWorkingDirectory toUri getPath TEST_DIR_PATH substring ArrayList Callable Integer tasks ArrayList threads fs mkdirs TEST_DIR_PATH ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer threads tasks Callable Integer Integer written String blobName basePath UUID randomUUID toString CloudBlockBlob blob container getBlockBlobReference blobName blob uploadText written
written String blobName basePath UUID randomUUID toString CloudBlockBlob blob container getBlockBlobReference blobName blob uploadText written e LOG error blobName e LOG info written written List Future Integer futures executorService invokeAll tasks getTestTimeoutMillis TimeUnit MILLISECONDS elapsedMs timer elapsedTimeMs
ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer FileStatus fileList fs listStatus TEST_DIR_PATH elapsedMs timer elapsedTimeMs
ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer FileStatus fileList fs listStatus TEST_DIR_PATH elapsedMs timer elapsedTimeMs LOG info String format fileList length elapsedMs Map Path FileStatus foundInList HashMap expectedFileCount FileStatus fileStatus fileList foundInList put fileStatus getPath fileStatus
Map Path FileStatus foundInList HashMap expectedFileCount FileStatus fileStatus fileList foundInList put fileStatus getPath fileStatus LOG info fileStatus getPath fileStatus isDirectory assertEquals expectedFileCount fileList length ContractTestUtils NanoTimer initialStatusCallTimer ContractTestUtils NanoTimer RemoteIterator LocatedFileStatus listing fs listFiles TEST_DIR_PATH initialListTime initialStatusCallTimer elapsedTimeMs timer ContractTestUtils NanoTimer listing FileStatus fileStatus listing next Path path fileStatus getPath FileStatus removed foundInList remove path assertNotNull path removed elapsedMs timer elapsedTimeMs
ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer fs delete TEST_DIR_PATH elapsedMs timer elapsedTimeMs
AtomicInteger successfulRenameCount AtomicInteger AtomicReference IOException unexpectedError AtomicReference IOException Path dest path List Thread threads ArrayList i i i threadNumber i Path src path threadNumber threads Thread latch await Long MAX_VALUE TimeUnit SECONDS output src output write threadNumber getBytes src dest
LOG info Path path methodPath fs create path assertPathExists path NativeAzureFileSystem nfs fs String fullKey nfs pathToKey nfs makeAbsolute path AzureNativeFileSystemStore store nfs getStore CountDownLatch leaseAttemptComplete CountDownLatch CountDownLatch beginningDeleteAttempt CountDownLatch SelfRenewingLease lease lease store acquireLease fullKey
fs TEST_FILE_PATH testFileStatus fs getFileStatus TEST_FILE_PATH testFileLength testFileStatus getLen
describe count CloudStorageAccount storageAccount getTestAccount getRealAccount CloudBlobClient blobClient storageAccount createCloudBlobClient Iterable CloudBlobContainer containers blobClient listContainers CONTAINER_PREFIX CloudBlobContainer containers count
describe count CloudStorageAccount storageAccount getTestAccount getRealAccount CloudBlobClient blobClient storageAccount createCloudBlobClient Iterable CloudBlobContainer containers blobClient listContainers CONTAINER_PREFIX CloudBlobContainer containers
StorageStatistics statistics getFileSystem getStorageStatistics Iterator StorageStatistics LongStatistic longStatistics statistics getLongStatistics longStatistics StorageStatistics LongStatistic next longStatistics next
data SOURCE_DATA blocks filesize UPLOAD_BLOCKSIZE blocksPerMB S_1M UPLOAD_BLOCKSIZE NativeAzureFileSystem fs getFileSystem ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer blocksPer10MB blocksPerMB fs mkdirs hugefile getParent out fs hugefile UPLOAD_BLOCKSIZE block block blocks block out write data written block UPLOAD_BLOCKSIZE block blocksPer10MB written filesize percentage written filesize elapsedTime timer elapsedTime NANOSEC writtenMB written S_1M
ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer ContractTestUtils NanoTimer readAtByte0 readAtByte0Again readAtEOF in readAtByte0 ContractTestUtils NanoTimer in readFully buffer readAtByte0 end ops readAtEOF ContractTestUtils NanoTimer in readFully eof bufferSize buffer readAtEOF end ops readAtByte0Again ContractTestUtils NanoTimer in readFully buffer readAtByte0Again end ops
in readFully buffer readAtByte0 end ops readAtEOF ContractTestUtils NanoTimer in readFully eof bufferSize buffer readAtEOF end ops readAtByte0Again ContractTestUtils NanoTimer in readFully buffer readAtByte0Again end ops LOG info in mb Math max filesize S_1M logFSState timer end mb
assumeHugeFileExists describe hugefile NativeAzureFileSystem fs getFileSystem FileStatus status fs getFileStatus hugefile filesize status getLen blocks filesize UPLOAD_BLOCKSIZE data UPLOAD_BLOCKSIZE ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer in blocks in readFully data LOG info in mb Math max filesize S_1M timer end mb
remaining blockSize blockId i NanoTimer blockTimer NanoTimer reads remaining NanoTimer readTimer NanoTimer bytesRead in read block offset remaining reads bytesRead remaining bytesRead offset bytesRead count bytesRead readTimer end bytesRead
NanoTimer readTimer NanoTimer bytesRead in read block offset remaining reads bytesRead remaining bytesRead offset bytesRead count bytesRead readTimer end bytesRead LOG debug reads bytesRead blockSize remaining remaining readTimer duration readTimer nanosPerOperation bytesRead readTimer bandwidthDescription bytesRead LOG warn reads blockTimer end blockId reads String bw blockTimer bandwidthDescription blockSize
count bytesRead readTimer end bytesRead LOG debug reads bytesRead blockSize remaining remaining readTimer duration readTimer nanosPerOperation bytesRead readTimer bandwidthDescription bytesRead LOG warn reads blockTimer end blockId reads String bw blockTimer bandwidthDescription blockSize LOG info blockId bw blockTimer blockSize LOG warn bw blockId Assert assertTrue bw resetCount resetCount maxResetCount resetCount IOUtils closeStream in
assumeHugeFileExists describe hugefile hugefileRenamed NativeAzureFileSystem fs getFileSystem FileStatus status fs getFileStatus hugefile filesize status getLen fs delete hugefileRenamed ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer fs rename hugefile hugefileRenamed mb Math max filesize S_1M timer end mb
FileStatus status fs getFileStatus hugefile filesize status getLen fs delete hugefileRenamed ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer fs rename hugefile hugefileRenamed mb Math max filesize S_1M timer end mb LOG info toHuman timer nanosPerOperation mb bandwidth timer filesize logFSState FileStatus destFileStatus fs getFileStatus hugefileRenamed assertEquals filesize destFileStatus getLen ContractTestUtils NanoTimer timer2 ContractTestUtils NanoTimer fs rename hugefileRenamed hugefile timer2 end
FILE_SIZE getBandwidthGaugeUpdater suppressAutoUpdate Date start Date OutputStream outputStream getFileSystem create filePath outputStream write nonZeroByteArray FILE_SIZE outputStream close uploadDurationMs Date getTime start getTime logOpResponseCount base base assertWebResponsesInRange base getBandwidthGaugeUpdater triggerUpdate bytesWritten AzureMetricsTestUtil getCurrentBytesWritten getInstrumentation assertTrue bytesWritten FILE_SIZE bytesWritten FILE_SIZE bytesWritten FILE_SIZE totalBytesWritten AzureMetricsTestUtil getCurrentTotalBytesWritten getInstrumentation assertTrue totalBytesWritten FILE_SIZE totalBytesWritten FILE_SIZE totalBytesWritten FILE_SIZE uploadRate AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_UPLOAD_RATE
outputStream write nonZeroByteArray FILE_SIZE outputStream close uploadDurationMs Date getTime start getTime logOpResponseCount base base assertWebResponsesInRange base getBandwidthGaugeUpdater triggerUpdate bytesWritten AzureMetricsTestUtil getCurrentBytesWritten getInstrumentation assertTrue bytesWritten FILE_SIZE bytesWritten FILE_SIZE bytesWritten FILE_SIZE totalBytesWritten AzureMetricsTestUtil getCurrentTotalBytesWritten getInstrumentation assertTrue totalBytesWritten FILE_SIZE totalBytesWritten FILE_SIZE totalBytesWritten FILE_SIZE uploadRate AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_UPLOAD_RATE LOG info uploadRate expectedRate FILE_SIZE uploadDurationMs assertTrue uploadRate expectedRate uploadRate expectedRate uploadLatency AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_UPLOAD_LATENCY
InputStream inputStream getFileSystem open filePath count inputStream count inputStream close downloadDurationMs Date getTime start getTime assertEquals FILE_SIZE count logOpResponseCount base base assertWebResponsesInRange base getBandwidthGaugeUpdater triggerUpdate totalBytesRead AzureMetricsTestUtil getCurrentTotalBytesRead getInstrumentation assertEquals FILE_SIZE totalBytesRead bytesRead AzureMetricsTestUtil getCurrentBytesRead getInstrumentation assertTrue bytesRead FILE_SIZE bytesRead FILE_SIZE bytesRead FILE_SIZE downloadRate AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_DOWNLOAD_RATE
inputStream close downloadDurationMs Date getTime start getTime assertEquals FILE_SIZE count logOpResponseCount base base assertWebResponsesInRange base getBandwidthGaugeUpdater triggerUpdate totalBytesRead AzureMetricsTestUtil getCurrentTotalBytesRead getInstrumentation assertEquals FILE_SIZE totalBytesRead bytesRead AzureMetricsTestUtil getCurrentBytesRead getInstrumentation assertTrue bytesRead FILE_SIZE bytesRead FILE_SIZE bytesRead FILE_SIZE downloadRate AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_DOWNLOAD_RATE LOG info downloadRate expectedRate FILE_SIZE downloadDurationMs assertTrue downloadRate expectedRate downloadRate expectedRate downloadLatency AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_DOWNLOAD_LATENCY
base getBaseWebResponses assertEquals AzureMetricsTestUtil getCurrentBytesWritten getInstrumentation Path filePath Path FILE_SIZE getBandwidthGaugeUpdater suppressAutoUpdate OutputStream outputStream getFileSystem create filePath outputStream write FILE_SIZE outputStream close logOpResponseCount base base assertWebResponsesInRange base getBandwidthGaugeUpdater triggerUpdate totalBytesWritten AzureMetricsTestUtil getCurrentTotalBytesWritten getInstrumentation assertTrue totalBytesWritten FILE_SIZE totalBytesWritten FILE_SIZE totalBytesWritten FILE_SIZE uploadRate AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_UPLOAD_RATE
assertEquals AzureMetricsTestUtil getCurrentBytesWritten getInstrumentation Path filePath Path FILE_SIZE getBandwidthGaugeUpdater suppressAutoUpdate OutputStream outputStream getFileSystem create filePath outputStream write FILE_SIZE outputStream close logOpResponseCount base base assertWebResponsesInRange base getBandwidthGaugeUpdater triggerUpdate totalBytesWritten AzureMetricsTestUtil getCurrentTotalBytesWritten getInstrumentation assertTrue totalBytesWritten FILE_SIZE totalBytesWritten FILE_SIZE totalBytesWritten FILE_SIZE uploadRate AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_UPLOAD_RATE LOG info uploadRate uploadLatency AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_UPLOAD_LATENCY
uploadLatency AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_UPLOAD_LATENCY LOG info uploadLatency assertTrue uploadLatency uploadLatency InputStream inputStream getFileSystem open filePath count inputStream count inputStream close assertEquals FILE_SIZE count logOpResponseCount base base assertWebResponsesInRange base getBandwidthGaugeUpdater triggerUpdate totalBytesRead AzureMetricsTestUtil getCurrentTotalBytesRead getInstrumentation assertEquals FILE_SIZE totalBytesRead downloadRate AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_DOWNLOAD_RATE
assertTrue uploadLatency uploadLatency InputStream inputStream getFileSystem open filePath count inputStream count inputStream close assertEquals FILE_SIZE count logOpResponseCount base base assertWebResponsesInRange base getBandwidthGaugeUpdater triggerUpdate totalBytesRead AzureMetricsTestUtil getCurrentTotalBytesRead getInstrumentation assertEquals FILE_SIZE totalBytesRead downloadRate AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_DOWNLOAD_RATE LOG info downloadRate downloadLatency AzureMetricsTestUtil getLongGaugeValue getInstrumentation WASB_DOWNLOAD_LATENCY
describe AzureBlobFileSystem fs getFileSystem AzureBlobFileSystemStore abfss fs getAbfsStore Path seekStatPath path getMethodName AbfsOutputStream out AbfsInputStream in out createAbfsOutputStreamWithFlushEnabled fs seekStatPath out write defBuffer out hflush in abfss openFileForRead seekStatPath fs getFsStatistics result in read defBuffer ONE_MB
AzureBlobFileSystemStore abfss fs getAbfsStore Path seekStatPath path getMethodName AbfsOutputStream out AbfsInputStream in out createAbfsOutputStreamWithFlushEnabled fs seekStatPath out write defBuffer out hflush in abfss openFileForRead seekStatPath fs getFsStatistics result in read defBuffer ONE_MB LOG info result in seek in seek ONE_MB AbfsInputStreamStatisticsImpl stats AbfsInputStreamStatisticsImpl in getStreamStatistics
in abfss openFileForRead seekStatPath fs getFsStatistics result in read defBuffer ONE_MB LOG info result OPERATIONS in seek in seek ONE_MB AbfsInputStreamStatisticsImpl stats AbfsInputStreamStatisticsImpl in getStreamStatistics LOG info stats toString assertEquals OPERATIONS stats getSeekOperations assertEquals OPERATIONS stats getBackwardSeekOperations assertEquals OPERATIONS stats getForwardSeekOperations assertEquals OPERATIONS ONE_MB stats getBytesBackwardsOnSeek assertEquals stats getBytesSkippedOnSeek assertEquals OPERATIONS stats getSeekInBuffer in close
describe AzureBlobFileSystem fs getFileSystem AzureBlobFileSystemStore abfss fs getAbfsStore Path readStatPath path getMethodName AbfsOutputStream out AbfsInputStream in out createAbfsOutputStreamWithFlushEnabled fs readStatPath out write defBuffer out hflush in abfss openFileForRead readStatPath fs getFsStatistics in read AbfsInputStreamStatisticsImpl stats AbfsInputStreamStatisticsImpl in getStreamStatistics
AbfsOutputStream out AbfsInputStream in out createAbfsOutputStreamWithFlushEnabled fs readStatPath out write defBuffer out hflush in abfss openFileForRead readStatPath fs getFsStatistics OPERATIONS in read AbfsInputStreamStatisticsImpl stats AbfsInputStreamStatisticsImpl in getStreamStatistics LOG info stats toString assertEquals OPERATIONS stats getBytesRead assertEquals OPERATIONS stats getReadOperations assertEquals stats getRemoteReadOperations in close
describe AzureBlobFileSystem fs getFileSystem Path nullStatFilePath path getMethodName oneKbBuff ONE_KB AbfsInputStreamContext abfsInputStreamContext AbfsInputStreamContext getConfiguration getSasTokenRenewPeriodForStreamsInSeconds withReadBufferSize getConfiguration getReadBufferSize withReadAheadQueueDepth getConfiguration getReadAheadQueueDepth withStreamStatistics build AbfsOutputStream out AbfsInputStream in out createAbfsOutputStreamWithFlushEnabled fs nullStatFilePath out write oneKbBuff out hflush AbfsRestOperation abfsRestOperation fs getAbfsClient getPathStatus nullStatFilePath toUri getPath in AbfsInputStream fs getAbfsClient nullStatFilePath toUri getPath ONE_KB abfsInputStreamContext abfsRestOperation getResult getResponseHeader assertNotEquals in read in seek ONE_KB
AzureBlobFileSystem fs getFileSystem Path getResponsePath path getMethodName Map String Long metricMap String testResponseString getResponses bytesReceived FSDataOutputStream out FSDataInputStream in out fs create getResponsePath out write testResponseString getBytes out hflush metricMap fs getInstrumentationMap getResponsesBeforeTest metricMap get CONNECTIONS_MADE getStatName in fs open getResponsePath result in read
String testReadWriteOps statistics reset assertReadWriteOps statistics getWriteOps assertReadWriteOps statistics getReadOps FSDataOutputStream outForOneOperation FSDataInputStream inForOneOperation outForOneOperation fs create smallOperationsFile statistics reset outForOneOperation write testReadWriteOps getBytes assertReadWriteOps statistics getWriteOps outForOneOperation hflush inForOneOperation fs open smallOperationsFile statistics reset result inForOneOperation read testReadWriteOps getBytes testReadWriteOps getBytes length
Assume assumeFalse getFileSystem getIsNamespaceEnabled createTestFile assumeHugeFileExists AzureBlobFileSystem abFs getFileSystem NativeAzureFileSystem wasbFs getWasbFileSystem maxAttempts maxAcceptableRatio v1ElapsedMs v2ElapsedMs ratio Double MAX_VALUE maxAttempts ratio maxAcceptableRatio v1ElapsedMs randomRead wasbFs v2ElapsedMs randomRead abFs ratio v2ElapsedMs v1ElapsedMs
buffer SEQUENTIAL_READ_BUFFER_SIZE totalBytesRead bytesRead inputStream bytesRead totalBytesRead bytesRead inputStream read buffer totalBytesRead bytesRead totalBytesRead inputStream seek ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer bytesRead inputStream read buffer totalBytesRead bytesRead elapsedTimeMs timer elapsedTimeMs
assumeHugeFileExists minBytesToRead MEGABYTE Random random Random buffer KILOBYTE totalBytesRead bytesRead inputStream ContractTestUtils NanoTimer timer ContractTestUtils NanoTimer bytesRead inputStream read buffer totalBytesRead bytesRead inputStream seek random nextInt TEST_FILE_SIZE buffer length bytesRead totalBytesRead minBytesToRead elapsedTimeMs timer elapsedTimeMs inputStream close
initialized owner UserGroupInformation getCurrentUser
uri Preconditions checkState initialized Preconditions checkState fsURI fsURI uri canonicalServiceName uri toString
StubAbfsTokenIdentifier credentials serviceName tokenService Token TokenIdentifier token credentials getToken Text serviceName assertEquals token StubAbfsTokenIdentifier TOKEN_KIND token getKind assertEquals token tokenService token getService toString StubAbfsTokenIdentifier abfsId StubAbfsTokenIdentifier token decodeIdentifier
String conf String args ByteArrayOutputStream dtUtilContent ByteArrayOutputStream DtUtilShell dt DtUtilShell dt setOut PrintStream dtUtilContent dtUtilContent reset r doAs aliceUser ToolRunner run conf dt args String s dtUtilContent toString
maxLatencyWhenDisabledMs minLatencyWhenDisabledMs numTasks aggregateLatency AbfsPerfTracker abfsPerfTracker AbfsPerfTracker accountName filesystemName List Callable Long tasks ArrayList numTasks tasks Instant startGet Instant now abfsPerfTracker getClientLatency latencyGet Duration between startGet Instant now toMillis
maxLatencyWhenDisabledMs minLatencyWhenDisabledMs numTasks aggregateLatency AbfsPerfTracker abfsPerfTracker AbfsPerfTracker accountName filesystemName List Callable Long tasks ArrayList numTasks tasks Instant startRecord Instant now abfsPerfTracker getClientLatency latencyRecord Duration between startRecord Instant now toMillis
Assume assumeTrue getAuthType AuthType SharedKey count CloudStorageAccount storageAccount AzureBlobStorageTestAccount createTestAccount CloudBlobClient blobClient storageAccount createCloudBlobClient Iterable CloudBlobContainer containers blobClient listContainers TEST_CONTAINER_PREFIX CloudBlobContainer containers count
Assume assumeTrue getAuthType AuthType SharedKey count CloudStorageAccount storageAccount AzureBlobStorageTestAccount createTestAccount CloudBlobClient blobClient storageAccount createCloudBlobClient Iterable CloudBlobContainer containers blobClient listContainers TEST_CONTAINER_PREFIX CloudBlobContainer containers
sb append path sb append sb append sb append sb append sb append sv sb append sb append sr sb append sb append sb append sb append sb append sb append String stringToSign sb toString
arg1 numOfValues numOfValues reporter setStatus key toString numOfValues numOfValues aRecord TaggedMapOutput arg1 next clone job Text tag aRecord getTag ResetableIterator data retv get tag data data createResetableIterator retv put tag data data add aRecord numOfValues largestNumOfValues largestNumOfValues numOfValues
OptionsParser usage DistCpConstants INVALID_ARGUMENT context DistCpContext OptionsParser parse argv checkSplitLargeFile setTargetPathExists LOG info context e LOG error e System err println e getMessage OptionsParser usage DistCpConstants INVALID_ARGUMENT execute e
context DistCpContext OptionsParser parse argv checkSplitLargeFile setTargetPathExists LOG info context e LOG error e System err println e getMessage OptionsParser usage DistCpConstants INVALID_ARGUMENT execute e LOG error e DistCpConstants INVALID_ARGUMENT
setTargetPathExists LOG info context e LOG error e System err println e getMessage OptionsParser usage DistCpConstants INVALID_ARGUMENT execute e LOG error e DistCpConstants INVALID_ARGUMENT e LOG error e DistCpConstants DUPLICATE_INPUT
e LOG error e System err println e getMessage OptionsParser usage DistCpConstants INVALID_ARGUMENT execute e LOG error e DistCpConstants INVALID_ARGUMENT e LOG error e DistCpConstants DUPLICATE_INPUT e LOG error e
OptionsParser usage DistCpConstants INVALID_ARGUMENT execute e LOG error e DistCpConstants INVALID_ARGUMENT e LOG error e DistCpConstants DUPLICATE_INPUT e LOG error e DistCpConstants ACLS_NOT_SUPPORTED e LOG error e
context Path workDir context getAtomicWorkPath workDir workDir targetPath getParent workDir Path workDir WIP_PREFIX targetPath getName rand nextInt FileSystem workFS workDir getFileSystem configuration workFS IllegalArgumentException workDir targetPath CopyOutputFormat setWorkingDirectory job workDir CopyOutputFormat setWorkingDirectory job targetPath CopyOutputFormat setCommitDirectory job targetPath Path logPath context getLogPath logPath logPath Path metaFolder
fileListWriter context ArrayList DiffInfo diffList distCpSync prepareDiffListForCopyListing Path sourceRoot context getSourcePaths get FileSystem sourceFS sourceRoot getFileSystem getConf List FileStatusInfo fileStatuses Lists newArrayList DiffInfo diff diffList diff setTarget Path context getSourcePaths get diff getTarget diff addToFileListing fileListWriter sourceRoot diff getTarget context diff addToFileListing fileListWriter sourceRoot diff getTarget context FileStatus sourceStatus sourceFS getFileStatus diff getTarget sourceStatus
FileSystem sourceFS path getFileSystem getConf preserveAcls context shouldPreserve FileAttribute ACL preserveXAttrs context shouldPreserve FileAttribute XATTR preserveRawXAttrs context shouldPreserveRawXattrs path makeQualified path FileStatus rootStatus sourceFS getFileStatus path Path sourcePathRoot computeSourceRootPath rootStatus context FileStatus sourceFiles sourceFS listStatus path explore sourceFiles sourceFiles length explore rootStatus LinkedList CopyListingFileStatus rootCopyListingStatus DistCpUtils toCopyListingFileStatus sourceFS rootStatus preserveAcls preserveXAttrs preserveRawXAttrs context getBlocksPerChunk writeToFileListingRoot fileListWriter rootCopyListingStatus sourcePathRoot context explore ArrayList FileStatus sourceDirs ArrayList FileStatus FileStatus sourceFiles
rootStatus isDirectory LinkedList CopyListingFileStatus rootCopyListingStatus DistCpUtils toCopyListingFileStatus sourceFS rootStatus preserveAcls preserveXAttrs preserveRawXAttrs context getBlocksPerChunk writeToFileListingRoot fileListWriter rootCopyListingStatus sourcePathRoot context ArrayList FileStatus sourceDirs ArrayList FileStatus FileStatus sourceStatus LOG LOG debug sourceStatus getPath LinkedList CopyListingFileStatus sourceCopyListingStatus DistCpUtils toCopyListingFileStatus sourceFS sourceStatus preserveAcls sourceStatus isDirectory preserveXAttrs sourceStatus isDirectory preserveRawXAttrs sourceStatus isDirectory context getBlocksPerChunk CopyListingFileStatus fs sourceCopyListingStatus addToFileListing statusList FileStatusInfo fs sourcePathRoot fileListWriter writeToFileListing fileListWriter fs sourcePathRoot sourceStatus isDirectory
context syncOrOverwrite context shouldSyncFolder context shouldOverwrite syncOrOverwrite
conf Path metaFolder Path conf get DistCpConstants CONF_LABEL_META_FOLDER FileSystem fs metaFolder getFileSystem conf
Path sourceListing Path spath SequenceFile Reader sourceReader SequenceFile Reader conf SequenceFile Reader file sourceListing Path targetRoot Path conf get DistCpConstants CONF_LABEL_TARGET_WORK_PATH CopyListingFileStatus srcFileStatus CopyListingFileStatus Text srcRelPath Text CopyListingFileStatus lastFileStatus LinkedList Path allChunkPaths LinkedList Path sourceReader srcRelPath srcFileStatus srcFileStatus Path targetFile Path targetRoot toString srcRelPath Path targetFileChunkPath DistCpUtils getSplitChunkPath targetFile srcFileStatus
conf String attrSymbols conf get DistCpConstants CONF_LABEL_PRESERVE_STATUS syncOrOverwrite syncFolder overwrite
conf Path trackDir Path conf get DistCpConstants CONF_LABEL_TRACK_MISSING Path sourceListing Path conf get DistCpConstants CONF_LABEL_LISTING_FILE_PATH
conf Path trackDir Path conf get DistCpConstants CONF_LABEL_TRACK_MISSING Path sourceListing Path conf get DistCpConstants CONF_LABEL_LISTING_FILE_PATH LOG info trackDir Path sourceSortedListing Path trackDir DistCpConstants SOURCE_SORTED_FILE
conf Path trackDir Path conf get DistCpConstants CONF_LABEL_TRACK_MISSING Path sourceListing Path conf get DistCpConstants CONF_LABEL_LISTING_FILE_PATH LOG info trackDir Path sourceSortedListing Path trackDir DistCpConstants SOURCE_SORTED_FILE LOG info sourceSortedListing DistCpUtils sortListing conf sourceListing sourceSortedListing Path targetListing Path trackDir TARGET_LISTING_FILE Path sortedTargetListing Path trackDir TARGET_SORTED_FILE listTargetFiles conf targetListing sortedTargetListing
conf LOG info listingStart System currentTimeMillis Path sourceListing Path conf get DistCpConstants CONF_LABEL_LISTING_FILE_PATH FileSystem clusterFS sourceListing getFileSystem conf Path sortedSourceListing DistCpUtils sortListing conf sourceListing sourceListingCompleted System currentTimeMillis
conf LOG info listingStart System currentTimeMillis Path sourceListing Path conf get DistCpConstants CONF_LABEL_LISTING_FILE_PATH FileSystem clusterFS sourceListing getFileSystem conf Path sortedSourceListing DistCpUtils sortListing conf sourceListing sourceListingCompleted System currentTimeMillis LOG info formatDuration sourceListingCompleted listingStart Path targetListing Path sourceListing getParent Path sortedTargetListing Path targetListing toString Path targetFinalPath listTargetFiles conf targetListing sortedTargetListing totalLen clusterFS getFileStatus sortedTargetListing getLen SequenceFile Reader sourceReader SequenceFile Reader conf SequenceFile Reader file sortedSourceListing SequenceFile Reader targetReader SequenceFile Reader conf SequenceFile Reader file sortedTargetListing deletionStart System currentTimeMillis
skippedDeletes deletedDirectories DeletedDirTracker tracker DeletedDirTracker CopyListingFileStatus srcFileStatus CopyListingFileStatus Text srcRelPath Text CopyListingFileStatus trgtFileStatus CopyListingFileStatus Text trgtRelPath Text FileSystem targetFS targetFinalPath getFileSystem conf showProgress srcAvailable sourceReader next srcRelPath srcFileStatus next trgtRelPath trgtFileStatus srcAvailable trgtRelPath srcRelPath srcAvailable sourceReader next srcRelPath srcFileStatus Path targetEntry trgtFileStatus getPath
CopyListingFileStatus trgtFileStatus CopyListingFileStatus Text trgtRelPath Text FileSystem targetFS targetFinalPath getFileSystem conf showProgress srcAvailable sourceReader next srcRelPath srcFileStatus next trgtRelPath trgtFileStatus srcAvailable trgtRelPath srcRelPath srcAvailable sourceReader next srcRelPath srcFileStatus Path targetEntry trgtFileStatus getPath LOG debug srcFileStatus getPath targetEntry srcAvailable trgtRelPath equals srcRelPath trgtFileStatus showProgress targetFS targetEntry
srcAvailable sourceReader next srcRelPath srcFileStatus Path targetEntry trgtFileStatus getPath LOG debug srcFileStatus getPath targetEntry srcAvailable trgtRelPath equals srcRelPath trgtFileStatus showProgress targetEntry LOG info targetEntry deletedEntries trgtFileStatus deletedDirectories filesDeleted
showProgress targetEntry LOG info targetEntry deletedEntries trgtFileStatus deletedDirectories filesDeleted LOG info targetEntry trgtFileStatus missingDeletes e e
targetEntry LOG info targetEntry deletedEntries trgtFileStatus deletedDirectories filesDeleted LOG info targetEntry trgtFileStatus missingDeletes e e
deletedEntries trgtFileStatus deletedDirectories filesDeleted LOG info targetEntry trgtFileStatus missingDeletes e e LOG info targetEntry e toString LOG debug targetEntry e failedDeletes
e e LOG info targetEntry e toString LOG debug targetEntry e failedDeletes LOG debug targetEntry skippedDeletes showProgress showProgress taskAttemptContext progress taskAttemptContext setStatus targetReader getPosition totalLen LOG info targetFS
Path Configuration conf Path Path CopyListing target GlobbedCopyListing Configuration conf Path targetFinalPath Path conf get DistCpConstants CONF_LABEL_TARGET_FINAL_PATH List Path targets ArrayList targets add targetFinalPath Path resultNonePath Path getPathWithoutSchemeAndAuthority targetFinalPath toString startsWith DistCpConstants HDFS_RESERVED_RAW_DIRECTORY_NAME DistCpConstants RAW_NONE_PATH DistCpConstants NONE_PATH threads conf getInt DistCpConstants CONF_LABEL_LISTSTATUS_THREADS DistCpConstants DEFAULT_LISTSTATUS_THREADS
conf Path workDir Path conf get DistCpConstants CONF_LABEL_TARGET_WORK_PATH Path finalDir Path conf get DistCpConstants CONF_LABEL_TARGET_FINAL_PATH FileSystem targetFS workDir getFileSystem conf
conf Path workDir Path conf get DistCpConstants CONF_LABEL_TARGET_WORK_PATH Path finalDir Path conf get DistCpConstants CONF_LABEL_TARGET_FINAL_PATH FileSystem targetFS workDir getFileSystem conf LOG info workDir finalDir targetFS finalDir targetFS workDir
Path workDir Path conf get DistCpConstants CONF_LABEL_TARGET_WORK_PATH Path finalDir Path conf get DistCpConstants CONF_LABEL_TARGET_FINAL_PATH FileSystem targetFS workDir getFileSystem conf LOG info workDir finalDir targetFS exists finalDir targetFS exists workDir LOG error finalDir IOException finalDir workDir result targetFS rename workDir finalDir result LOG warn result targetFS exists finalDir targetFS exists workDir result LOG info finalDir taskAttemptContext setStatus finalDir
LOG LOG debug targetFile allChunkPaths size FileSystem dstfs targetFile getFileSystem conf FileSystem srcfs sourceFile getFileSystem conf Path firstChunkFile allChunkPaths removeFirst Path restChunkFiles Path allChunkPaths size allChunkPaths toArray restChunkFiles LOG LOG debug dstfs getFileStatus firstChunkFile i Path f restChunkFiles LOG debug i dstfs getFileStatus f i dstfs concat firstChunkFile restChunkFiles LOG
relPath sourceFileStatus context Path sourcePath sourceFileStatus getPath LOG isDebugEnabled LOG debug sourcePath relPath Path target Path targetWorkPath makeQualified targetFS getUri targetFS getWorkingDirectory relPath toString EnumSet DistCpOptions FileAttribute fileAttributes getFileAttributeSettings context preserveRawXattrs context getConfiguration getBoolean DistCpConstants CONF_LABEL_PRESERVE_RAWXATTRS String description sourcePath target context setStatus description
e IOException RetriableFileCopyCommand CopyReadException e FileStatus targetStatus targetStatus targetFS getFileStatus target ignore LOG isDebugEnabled LOG debug target ignore targetStatus targetStatus sourceCurrStatus IOException target getFileType targetStatus getFileType sourceCurrStatus sourceCurrStatus createTargetDirsWithRetry description target context sourceStatus FileAction action checkUpdate sourceFS sourceCurrStatus target targetStatus Path tmpTarget target action FileAction
LOG isDebugEnabled LOG debug target ignore targetStatus targetStatus sourceCurrStatus IOException target getFileType targetStatus getFileType sourceCurrStatus sourceCurrStatus createTargetDirsWithRetry description target context sourceStatus FileAction action checkUpdate sourceFS sourceCurrStatus target targetStatus Path tmpTarget target action FileAction LOG info sourceCurrStatus getPath target updateSkipCounters context sourceCurrStatus context write Text sourceCurrStatus getPath context write Text sourceFileStatus getPath sourceFileStatus getLen target targetStatus targetStatus getLen
source Path target context LOG info source getPath target toAppend action FileAction APPEND useTempTarget toAppend directWrite Path targetPath useTempTarget getTempFile target context target
toAppend action FileAction APPEND useTempTarget toAppend directWrite Path targetPath useTempTarget getTempFile target context target LOG info useTempTarget targetPath Configuration configuration context getConfiguration FileSystem targetFS target getFileSystem configuration Path sourcePath source getPath FileSystem sourceFS sourcePath getFileSystem configuration FileChecksum sourceChecksum fileAttributes contains FileAttribute CHECKSUMTYPE sourceFS getFileChecksum sourcePath offset action FileAction APPEND targetFS getFileStatus target getLen source getChunkOffset bytesRead copyToFile targetPath targetFS source offset context fileAttributes sourceChecksum sourceStatus source DistCpUtils compareFileLengthsAndChecksums source getLen sourceFS sourcePath sourceChecksum targetFS targetPath skipCrc source getLen useTempTarget
Path Path target context Path targetWorkPath Path context getConfiguration get DistCpConstants CONF_LABEL_TARGET_WORK_PATH Path root target equals targetWorkPath targetWorkPath getParent targetWorkPath Path tempFile Path root context getTaskAttemptID toString String valueOf System currentTimeMillis
List InputSplit configuration numSplits totalSizeBytes List InputSplit splits ArrayList InputSplit numSplits nBytesPerSplit Math ceil totalSizeBytes numSplits CopyListingFileStatus srcFileStatus CopyListingFileStatus Text srcRelPath Text currentSplitSize lastSplitStart lastPosition Path listingFilePath getListingFilePath configuration
CopyListingFileStatus srcFileStatus CopyListingFileStatus Text srcRelPath Text currentSplitSize lastSplitStart lastPosition Path listingFilePath getListingFilePath configuration LOG LOG debug nBytesPerSplit numSplits totalSizeBytes SequenceFile Reader reader reader getListingFileReader configuration reader srcRelPath srcFileStatus currentSplitSize srcFileStatus nBytesPerSplit lastPosition FileSplit split FileSplit listingFilePath lastSplitStart lastPosition lastSplitStart LOG
SequenceFile Reader reader reader getListingFileReader configuration reader srcFileStatus currentSplitSize srcFileStatus getChunkLength lastPosition FileSplit split FileSplit listingFilePath lastSplitStart lastPosition lastSplitStart LOG LOG debug split currentSplitSize splits add split lastSplitStart lastPosition currentSplitSize currentSplitSize srcFileStatus getChunkLength lastPosition reader getPosition lastPosition lastSplitStart FileSplit split FileSplit listingFilePath lastSplitStart lastPosition lastSplitStart
close
taskAttemptContext String taskId taskAttemptContext getTaskAttemptID getTaskID toString Path acquiredFilePath Path getChunkRootPath taskId acquiredFilePath
LinkedList CopyListingFileStatus fileSystem fileStatus preserveAcls preserveXAttrs preserveRawXAttrs LinkedList CopyListingFileStatus copyListingFileStatus LinkedList CopyListingFileStatus CopyListingFileStatus clfs toCopyListingFileStatusHelper fileSystem fileStatus preserveAcls preserveXAttrs preserveRawXAttrs fileStatus getLen blockSize fileStatus getBlockSize
curPos LOG LOG debug clfs copyListingFileStatus add clfs i i curLength i i curLength blockLocations i getLength curLength CopyListingFileStatus clfs1 CopyListingFileStatus clfs clfs1 setChunkOffset curPos clfs1 setChunkLength curLength
copyListingFileStatus add clfs i i curLength i i curLength blockLocations i getLength curLength CopyListingFileStatus clfs1 CopyListingFileStatus clfs clfs1 setChunkOffset curPos clfs1 setChunkLength curLength LOG LOG debug clfs1 copyListingFileStatus add clfs1 curPos curLength
validatePaths DistCpContext options Assert fail TestDistCpUtils delete fs srcPaths clear srcPaths add Path fs mkdirs Path fs create target close validatePaths DistCpContext options Assert fail TestDistCpUtils delete fs
fs FileSystem get getConf List Path srcPaths ArrayList Path srcPaths add Path TestDistCpUtils createFile fs TestDistCpUtils createFile fs Path target Path Path listingFile Path DistCpOptions options DistCpOptions Builder srcPaths target build DistCpContext context DistCpContext options CopyListing listing CopyListing getCopyListing getConf CREDENTIALS context listing buildListing listingFile context Assert fail
DistCpOptions options DistCpOptions Builder srcPaths target withSyncFolder build CopyListing listing SimpleCopyListing getConf CREDENTIALS listing buildListing listingFile DistCpContext options Assert fail assertThat listing getBytesToCopy isEqualTo assertThat listing getNumberOfPaths isEqualTo TestDistCpUtils delete fs listing buildListing listingFile DistCpContext options Assert fail TestDistCpUtils delete fs
pathToListFile srcFiles FileSystem fs pathToListFile getFileSystem config reader config pathToListFile CopyListingFileStatus currentVal CopyListingFileStatus Text currentKey Text idx reader currentKey reader getCurrentValue currentVal Assert assertEquals srcFiles size idx fs makeQualified srcFiles get idx currentVal getPath
TestDistCpUtils createFile fs decoyFile toString TestDistCpUtils createFile fs targetFile toString List Path srcPaths ArrayList Path srcPaths add sourceFile DistCpOptions options DistCpOptions Builder srcPaths targetFile build CopyListing listing SimpleCopyListing getConf CREDENTIALS Path listFile Path testRoot listing buildListing listFile DistCpContext options reader SequenceFile Reader getConf SequenceFile Reader file listFile CopyListingFileStatus fileStatus CopyListingFileStatus Text relativePath Text Assert assertTrue reader next relativePath fileStatus Assert assertTrue relativePath toString equals Assert fail
FSDataInputStream srcIn fs open srcStat getPath FSDataInputStream dstIn fs open dstStat getPath readSrc HdfsClientConfigKeys DFS_BLOCK_SIZE_DEFAULT readDst HdfsClientConfigKeys DFS_BLOCK_SIZE_DEFAULT srcBytesRead tgtBytesRead srcIdx tgtIdx totalComparedBytes srcBytesRead srcBytesRead srcIn read readSrc srcIdx tgtBytesRead tgtBytesRead dstIn read readDst tgtIdx
tgtBytesRead tgtBytesRead dstIn read readDst tgtIdx tgtBytesRead LOG info totalComparedBytes tgtBytesRead Assert fail totalComparedBytes srcStat dstStat totalComparedBytes srcStat Assert fail totalComparedBytes srcStat dstStat tgtIdx tgtBytesRead tgtIdx readDst tgtIdx Assert fail totalComparedBytes srcStat dstStat totalComparedBytes
tgtBytesRead tgtBytesRead dstIn read readDst tgtIdx tgtBytesRead LOG info totalComparedBytes tgtBytesRead Assert fail totalComparedBytes srcStat dstStat totalComparedBytes srcStat Assert fail totalComparedBytes srcStat dstStat tgtIdx tgtBytesRead tgtIdx readDst tgtIdx Assert fail totalComparedBytes srcStat dstStat totalComparedBytes
fs String String String testRoot FsShell shell FsShell fs getConf LOG info
fs String String args String testRoot FsShell shell FsShell fs getConf LOG info LOG info execCmd shell testRoot LOG info args args ToolRunner run conf DistCp args LOG info
contents2 getBytes Assert assertEquals contents1 length contents2 length addEntries listFile createWithContents contents1 createWithContents contents2 Path target Path root runTest listFile target checkResult target FSDataInputStream is fs open Path root dstContents contents1 length is readFully dstContents is close Assert assertArrayEquals contents1 dstContents
Path describe Path srcDir inputDir
ContractTestUtils assertIsFile remoteFS outputFileNew1 ContractTestUtils assertPathExists localFS trackDir Path sortedSourceListing Path trackDir DistCpConstants SOURCE_SORTED_FILE ContractTestUtils assertIsFile localFS sortedSourceListing Path sortedTargetListing Path trackDir DistCpConstants TARGET_SORTED_FILE ContractTestUtils assertIsFile localFS sortedTargetListing ContractTestUtils assertPathsExist remoteFS outputFile2 outputFile3 outputFile4 outputSubDir4 Map String Path sourceFiles HashMap Map String Path targetFiles HashMap sortedSourceListing sortedTargetListing CopyListingFileStatus copyStatus CopyListingFileStatus Text name Text name copyStatus String key name toString Path path copyStatus getPath
ContractTestUtils assertIsFile localFS sortedTargetListing ContractTestUtils assertPathsExist remoteFS outputFile2 outputFile3 outputFile4 outputSubDir4 Map String Path sourceFiles HashMap Map String Path targetFiles HashMap sortedTargetListing CopyListingFileStatus copyStatus CopyListingFileStatus Text name Text name copyStatus String key name toString Path path copyStatus getPath LOG info key path sourceFiles put key path name copyStatus String key name toString Path path copyStatus getPath
fs dir RemoteIterator LocatedFileStatus files fs listFiles dir
CopyListing listing GlobbedCopyListing conf CREDENTIALS Path listingFile Path String valueOf rand nextLong listing buildListing listingFile context conf set CONF_LABEL_TARGET_WORK_PATH targetBase conf set CONF_LABEL_TARGET_FINAL_PATH targetBase OutputCommitter committer CopyCommitter taskAttemptContext committer commitJob jobContext Assert fail Path sourcePath Path sourceBase srcFilename CopyListingFileStatus sourceCurrStatus CopyListingFileStatus fs getFileStatus sourcePath Assert assertFalse DistCpUtils checksumsAreEqual fs Path sourceBase srcFilename fs Path targetBase srcFilename sourceCurrStatus getLen
Configuration Configuration configuration Configuration System setProperty configuration set configuration set
Configuration Configuration configuration Configuration System setProperty configuration set configuration set LOG debug configuration get
copyMapper setup context Path path Path SOURCE_PATH manyBytes appendFile path manyBytes ScheduledExecutorService scheduledExecutorService Executors newSingleThreadScheduledExecutor maxAppendAttempts appendCount appendCount maxAppendAttempts appendFile path Thread sleep appendCount
maxAppendAttempts appendCount appendCount maxAppendAttempts appendFile path Thread sleep appendCount e LOG error e Assert fail e getMessage scheduledExecutorService schedule task TimeUnit MILLISECONDS copyMapper map Text DistCpUtils getRelativePath Path SOURCE_PATH path CopyListingFileStatus cluster getFileSystem getFileStatus path context
deleteState createSourceData FileSystem fs cluster getFileSystem CopyMapper copyMapper CopyMapper StubContext stubContext StubContext getConfiguration Mapper Text CopyListingFileStatus Text Text Context context stubContext getContext mkdirs SOURCE_PATH touchFile TARGET_PATH copyMapper setup context copyMapper map Text CopyListingFileStatus fs getFileStatus Path SOURCE_PATH context e Assert assertTrue e getMessage startsWith e
e LOG error e RuntimeException e EnumSet DistCpOptions FileAttribute preserveStatus EnumSet allOf DistCpOptions FileAttribute preserveStatus remove DistCpOptions FileAttribute ACL preserveStatus remove DistCpOptions FileAttribute XATTR context getConfiguration set DistCpConstants CONF_LABEL_PRESERVE_STATUS DistCpUtils packAttributes preserveStatus touchFile SOURCE_PATH mkdirs TARGET_PATH cluster getFileSystem setPermission Path TARGET_PATH FsPermission FileSystem FileSystem FileSystem FileSystem get cluster getConfiguration
FileSystem get cluster getConfiguration e LOG error e Assert fail e getMessage RuntimeException copyMapper setup context copyMapper map Text CopyListingFileStatus tmpFS getFileStatus Path SOURCE_PATH context Assert fail e Assert assertTrue e getMessage e
StubContext stubContext StubContext getConfiguration stubContext getContext e LOG error e RuntimeException e touchFile SOURCE_PATH mkdirs TARGET_PATH cluster getFileSystem setPermission Path SOURCE_PATH FsPermission FsAction READ FsAction READ FsAction READ cluster getFileSystem setPermission Path TARGET_PATH FsPermission FileSystem FileSystem FileSystem FileSystem get cluster getConfiguration e
FileSystem tmpFS FileSystem FileSystem FileSystem get cluster getConfiguration e LOG error e Assert fail e getMessage RuntimeException copyMapper setup context copyMapper map Text CopyListingFileStatus tmpFS getFileStatus Path SOURCE_PATH context e
FileSystem get cluster getConfiguration e LOG error e Assert fail e getMessage RuntimeException copyMapper setup context copyMapper map Text CopyListingFileStatus tmpFS getFileStatus Path SOURCE_PATH context assertThat stubContext getWriter values size isEqualTo Assert assertTrue stubContext getWriter values get toString startsWith Assert assertTrue stubContext getWriter values get toString contains SOURCE_PATH e
FileSystem get cluster getConfiguration e LOG error e Assert fail e getMessage RuntimeException copyMapper setup context copyMapper map Text CopyListingFileStatus tmpFS getFileStatus Path SOURCE_PATH context Assert fail e e e e
deleteState createSourceData FileSystem fs cluster getFileSystem CopyMapper copyMapper CopyMapper StubContext stubContext StubContext getConfiguration Mapper Text CopyListingFileStatus Text Text Context context stubContext getContext touchFile SOURCE_PATH mkdirs TARGET_PATH copyMapper setup context copyMapper map Text CopyListingFileStatus fs getFileStatus Path SOURCE_PATH context e Assert assertTrue e getMessage startsWith e
stubContext getContext e LOG error e RuntimeException e touchFile SOURCE_PATH mkdirs TARGET_PATH cluster getFileSystem setPermission Path SOURCE_PATH FsPermission FsAction NONE FsAction NONE FsAction NONE cluster getFileSystem setPermission Path TARGET_PATH FsPermission context getConfiguration setBoolean DistCpOptionSwitch IGNORE_FAILURES getConfigLabel ignoreFailures FileSystem FileSystem FileSystem FileSystem get cluster getConfiguration e
mkdirs TARGET_PATH cluster getFileSystem setPermission Path SOURCE_PATH FsPermission FsAction NONE FsAction NONE FsAction NONE cluster getFileSystem setPermission Path TARGET_PATH FsPermission context getConfiguration setBoolean DistCpOptionSwitch IGNORE_FAILURES getConfigLabel ignoreFailures FileSystem FileSystem FileSystem FileSystem get cluster getConfiguration e LOG error e RuntimeException e
context getConfiguration setBoolean DistCpOptionSwitch IGNORE_FAILURES getConfigLabel ignoreFailures FileSystem tmpFS FileSystem FileSystem FileSystem get cluster getConfiguration e LOG error e RuntimeException e copyMapper setup context copyMapper map Text CopyListingFileStatus tmpFS getFileStatus Path SOURCE_PATH context Assert assertTrue ignoreFailures
e LOG error e RuntimeException e copyMapper setup context copyMapper map Text CopyListingFileStatus tmpFS getFileStatus Path SOURCE_PATH context Assert assertTrue ignoreFailures e LOG error e Assert assertFalse ignoreFailures e LOG error e
job getConfiguration set DistCpConstants CONF_LABEL_TARGET_WORK_PATH CopyOutputFormat setCommitDirectory job Path JobContext context JobContextImpl job getConfiguration jobID outputFormat checkOutputSpecs context Assert fail CopyOutputFormat setWorkingDirectory job Path CopyOutputFormat setCommitDirectory job Path JobContext context JobContextImpl job getConfiguration jobID outputFormat checkOutputSpecs context Assert fail
AtomicInteger deletedFiles AtomicInteger deletedDirs status status AtomicInteger r status isDirectory deletedDirs deletedFiles r incrementAndGet
Configuration Configuration configuration Configuration System setProperty configuration set
Configuration Configuration configuration Configuration System setProperty configuration set LOG debug configuration get
allTokens ByteBuffer wrap dob getData dob getLength AMRMClientAsync AbstractCallbackHandler allocListener RMCallbackHandler amRMClient AMRMClientAsync createAMRMClientAsync allocListener amRMClient init conf amRMClient start containerListener createNMCallbackHandler nmClientAsync NMClientAsyncImpl containerListener nmClientAsync init conf nmClientAsync start String appMasterHostname NetUtils getHostname amRMClient registerApplicationMaster appMasterHostname Supplier Boolean exitCritera isComplete Optional Properties namenodeProperties Optional empty ContainerRequest nnContainerRequest setupContainerAskForRM amOptions getNameNodeMemoryMB amOptions getNameNodeVirtualCores amOptions getNameNodeNodeLabelExpression
amRMClient init conf amRMClient start containerListener createNMCallbackHandler nmClientAsync NMClientAsyncImpl containerListener nmClientAsync init conf nmClientAsync start String appMasterHostname NetUtils getHostname amRMClient registerApplicationMaster appMasterHostname Supplier Boolean exitCritera isComplete Optional Properties namenodeProperties Optional empty ContainerRequest nnContainerRequest setupContainerAskForRM amOptions getNameNodeMemoryMB amOptions getNameNodeVirtualCores amOptions getNameNodeNodeLabelExpression LOG info nnContainerRequest toString amRMClient addContainerRequest nnContainerRequest Path namenodeInfoPath Path remoteStoragePath DynoConstants NN_INFO_FILE_NAME
String appMasterHostname NetUtils getHostname amRMClient registerApplicationMaster appMasterHostname Supplier Boolean exitCritera isComplete Optional Properties namenodeProperties Optional empty ContainerRequest nnContainerRequest setupContainerAskForRM amOptions getNameNodeMemoryMB amOptions getNameNodeVirtualCores amOptions getNameNodeNodeLabelExpression LOG info nnContainerRequest toString amRMClient addContainerRequest nnContainerRequest Path namenodeInfoPath Path remoteStoragePath DynoConstants NN_INFO_FILE_NAME LOG info namenodeInfoPath namenodeProperties DynoInfraUtils waitForAndGetNameNodeProperties exitCritera conf namenodeInfoPath LOG namenodeProperties cleanup namenodeServiceRpcAddress DynoInfraUtils getNameNodeServiceRpcAddr namenodeProperties get toString
ContainerRequest nnContainerRequest setupContainerAskForRM amOptions getNameNodeMemoryMB amOptions getNameNodeVirtualCores amOptions getNameNodeNodeLabelExpression LOG info nnContainerRequest toString amRMClient addContainerRequest nnContainerRequest Path namenodeInfoPath Path remoteStoragePath DynoConstants NN_INFO_FILE_NAME LOG info namenodeInfoPath namenodeProperties DynoInfraUtils waitForAndGetNameNodeProperties exitCritera conf namenodeInfoPath LOG namenodeProperties cleanup namenodeServiceRpcAddress DynoInfraUtils getNameNodeServiceRpcAddr namenodeProperties get toString LOG info namenodeProperties get LOG info DynoInfraUtils getNameNodeHdfsUri namenodeProperties get toString DynoInfraUtils waitForNameNodeStartup namenodeProperties get exitCritera LOG
cleanup namenodeServiceRpcAddress DynoInfraUtils getNameNodeServiceRpcAddr namenodeProperties get toString LOG info namenodeProperties get LOG info DynoInfraUtils getNameNodeHdfsUri namenodeProperties get toString DynoInfraUtils waitForNameNodeStartup namenodeProperties get exitCritera LOG LOG info namenodeServiceRpcAddress blockListFiles Collections synchronizedList getDataNodeBlockListingFiles numTotalDataNodes blockListFiles size numTotalDataNodes LOG error markCompleted numTotalDataNodeContainers Math ceil numTotalDataNodes Math max amOptions getDataNodesPerCluster
LOG info namenodeProperties get LOG info DynoInfraUtils getNameNodeHdfsUri namenodeProperties get toString DynoInfraUtils waitForNameNodeStartup namenodeProperties get exitCritera LOG LOG info namenodeServiceRpcAddress blockListFiles Collections synchronizedList getDataNodeBlockListingFiles numTotalDataNodes blockListFiles size numTotalDataNodes LOG error markCompleted numTotalDataNodeContainers Math ceil numTotalDataNodes Math max amOptions getDataNodesPerCluster LOG info numTotalDataNodeContainers amOptions getDataNodeMemoryMB amOptions getDataNodeVirtualCores numTotalDataNodeContainers ContainerRequest datanodeAsk setupContainerAskForRM amOptions getDataNodeMemoryMB amOptions getDataNodeVirtualCores amOptions getDataNodeNodeLabelExpression
Path blockListDirPath Path System getenv get DynoConstants BLOCK_LIST_PATH_ENV
LOG info yarnClient start YarnClusterMetrics clusterMetrics yarnClient getYarnClusterMetrics
LOG info yarnClient start YarnClusterMetrics clusterMetrics yarnClient getYarnClusterMetrics LOG info clusterMetrics getNumNodeManagers QueueInfo queueInfo yarnClient getQueueInfo amQueue
LOG info yarnClient start YarnClusterMetrics clusterMetrics yarnClient getYarnClusterMetrics LOG info clusterMetrics getNumNodeManagers QueueInfo queueInfo yarnClient getQueueInfo amQueue LOG info queueInfo getQueueName queueInfo getCurrentCapacity queueInfo getMaximumCapacity queueInfo getApplications size queueInfo getChildQueues size YarnClientApplication app yarnClient createApplication GetNewApplicationResponse appResponse app getNewApplicationResponse maxMem appResponse getMaximumResourceCapability getMemorySize
LOG info yarnClient start YarnClusterMetrics clusterMetrics yarnClient getYarnClusterMetrics LOG info clusterMetrics getNumNodeManagers QueueInfo queueInfo yarnClient getQueueInfo amQueue LOG info queueInfo getQueueName queueInfo getCurrentCapacity queueInfo getMaximumCapacity queueInfo getApplications size queueInfo getChildQueues size YarnClientApplication app yarnClient createApplication GetNewApplicationResponse appResponse app getNewApplicationResponse maxMem appResponse getMaximumResourceCapability getMemorySize LOG info maxMem maxVCores appResponse getMaximumResourceCapability getVirtualCores
Resource capability Records newRecord Resource capability setMemorySize amMemory capability setVirtualCores amVCores appContext setResource capability ByteBuffer fsTokens tokenFileLocation fsTokens ByteBuffer wrap Files readAllBytes Paths get tokenFileLocation Credentials credentials Credentials String tokenRenewer getConf get YarnConfiguration RM_PRINCIPAL tokenRenewer tokenRenewer IOException Token tokens fs addDelegationTokens tokenRenewer credentials tokens
List String List String vargs ArrayList vargs add Environment JAVA_HOME $ appMasterHeapSize Math round amMemory vargs add appMasterHeapSize vargs add ApplicationMaster getCanonicalName amOptions addToVargs vargs vargs add ApplicationConstants LOG_DIR_EXPANSION_VAR vargs add ApplicationConstants LOG_DIR_EXPANSION_VAR
String srcScheme srcSchemes iterator next String srcPathString Joiner on join srcPaths srcScheme srcScheme FileSystem getConf srcScheme List File srcFiles srcURIs stream map URI getSchemeSpecificPart map File collect Collectors toList Path dstPathBase getRemoteStoragePath getConf appId shouldArchive srcFiles size srcFiles get isDirectory resource getType LocalResourceType ARCHIVE Arrays stream ARCHIVE_FILE_TYPES noneMatch suffix srcFiles get getName endsWith suffix shouldArchive srcScheme IllegalArgumentException String format resource getResourcePath srcPathString resource getType LocalResourceType ARCHIVE IllegalArgumentException String format resource getType srcPathString dstPath Path dstPathBase resource getResourcePath suffix dstPath Path dstPathBase srcFiles get getName FileSystem remoteFS dstPath getFileSystem getConf
List File filesToZip srcFiles srcFiles get File childFiles srcFiles get listFiles childFiles childFiles IllegalArgumentException filesToZip Lists newArrayList childFiles filesToZip srcFiles ZipOutputStream zout ZipOutputStream outputStream File fileToZip filesToZip addFileToZipRecursively fileToZip getParentFile fileToZip zout zout close srcFiles get
loggedApplicationInfo success Supplier Boolean exitCritera Apps isApplicationFinalState infraAppState Optional Properties namenodeProperties Optional empty exitCritera get namenodeProperties namenodeProperties DynoInfraUtils waitForAndGetNameNodeProperties exitCritera getConf getNameNodeInfoPath LOG namenodeProperties Properties props namenodeProperties get
loggedApplicationInfo success Supplier Boolean exitCritera Apps isApplicationFinalState infraAppState Optional Properties namenodeProperties Optional empty exitCritera get namenodeProperties namenodeProperties DynoInfraUtils waitForAndGetNameNodeProperties exitCritera getConf getNameNodeInfoPath LOG namenodeProperties Properties props namenodeProperties get LOG info DynoInfraUtils getNameNodeHdfsUri props
loggedApplicationInfo success Supplier Boolean exitCritera Apps isApplicationFinalState infraAppState Optional Properties namenodeProperties Optional empty exitCritera get namenodeProperties namenodeProperties DynoInfraUtils waitForAndGetNameNodeProperties exitCritera getConf getNameNodeInfoPath LOG namenodeProperties Properties props namenodeProperties get LOG info DynoInfraUtils getNameNodeHdfsUri props LOG info DynoInfraUtils getNameNodeWebUri props
exitCritera get namenodeProperties namenodeProperties DynoInfraUtils waitForAndGetNameNodeProperties exitCritera getConf getNameNodeInfoPath LOG namenodeProperties Properties props namenodeProperties get LOG info DynoInfraUtils getNameNodeHdfsUri props LOG info DynoInfraUtils getNameNodeWebUri props LOG info DynoInfraUtils getNameNodeTrackingUri props DynoInfraUtils waitForNameNodeStartup namenodeProperties get exitCritera LOG DynoInfraUtils waitForNameNodeReadiness namenodeProperties get numTotalDataNodes exitCritera getConf LOG
ioe LOG error ioe launchAndMonitorWorkloadDriver namenodeProperties get namenodeMonitoringThread start Thread sleep LOG debug ApplicationReport report yarnClient getApplicationReport infraAppId
LOG error ioe launchAndMonitorWorkloadDriver namenodeProperties get namenodeMonitoringThread start Thread sleep LOG debug ApplicationReport report yarnClient getApplicationReport infraAppId report
Thread sleep LOG debug ApplicationReport report yarnClient getApplicationReport infraAppId report getTrackingUrl loggedApplicationInfo loggedApplicationInfo LOG info report getTrackingUrl LOG info report getApplicationId LOG debug infraAppId getId report getClientToAMToken report getDiagnostics report getHost report getQueue report getRpcPort report getStartTime report getYarnApplicationState report getFinalApplicationStatus report getTrackingUrl report getUser infraAppState report getYarnApplicationState infraAppState success
workloadConf setInt AuditReplayMapper NUM_THREADS_KEY workloadThreadsPerMapper workloadConf setDouble AuditReplayMapper RATE_FACTOR_KEY workloadRateFactor configPair workloadConf set configPair getKey configPair getValue workloadJob WorkloadDriver getJobForSubmission workloadConf nameNodeURI toString workloadStartTime AuditReplayMapper workloadJob submit workloadAppState workloadJob monitorAndPrintJob Thread sleep workloadAppState workloadJob getJobState workloadAppState LOG info LOG warn
LOG info workloadJob workloadAppState workloadJob getJobState ioe LOG warn ioe Thread currentThread interrupt workloadAppState LOG info workloadJob getJobID workloadJob killJob LOG info ioe
workloadAppState workloadJob getJobState ioe LOG warn ioe Thread currentThread interrupt workloadAppState LOG info workloadJob getJobID workloadJob killJob LOG info ioe LOG error workloadJob getJobID ioe
Thread currentThread interrupt LOG info workloadJob getJobID workloadJob killJob LOG info ioe LOG error workloadJob getJobID ioe infraAppId LOG info infraAppId forceKillApplication infraAppId LOG info
File File destinationDir String version log log info version File destinationFile File destinationDir String format HADOOP_TAR_FILENAME_FORMAT version destinationFile
lastUnderRepBlocks Long MAX_VALUE Thread sleep TimeUnit MINUTES toMillis underRepBlocks Long parseLong fetchNameNodeJMXValue nameNodeProperties FSNAMESYSTEM_JMX_QUERY JMX_MISSING_BLOCKS Long parseLong fetchNameNodeJMXValue nameNodeProperties FSNAMESYSTEM_STATE_JMX_QUERY JMX_UNDER_REPLICATED_BLOCKS blockDecrease lastUnderRepBlocks underRepBlocks lastUnderRepBlocks underRepBlocks blockDecrease blockDecrease String liveNodeListString fetchNameNodeJMXValue nameNodeProperties NAMENODE_INFO_JMX_QUERY JMX_LIVE_NODES_LIST Set String datanodesToReport parseStaleDataNodeList liveNodeListString blockThreshold log datanodesToReport log info
jmxBeanQuery jmxProperty decreasing nameNodeProperties lastPrintedValue decreasing Double MAX_VALUE Double MIN_VALUE value retryCount startTime Time monotonicNow value Double parseDouble fetchNameNodeJMXValue nameNodeProperties jmxBeanQuery jmxProperty decreasing value decreasing value
JsonToken parser nextToken parser nextToken JsonToken objectDepth JsonToken objectDepth JsonToken objectDepth currentNodeAddr parser getCurrentName objectDepth parser getCurrentName JsonToken valueToken parser nextToken valueToken JsonToken currentNodeAddr IOException String format valueToken currentNodeAddr liveNodeJsonString numBlocks parser getIntValue numBlocks
JsonToken objectDepth JsonToken objectDepth currentNodeAddr parser getCurrentName objectDepth parser getCurrentName JsonToken valueToken parser nextToken valueToken JsonToken currentNodeAddr IOException String format valueToken currentNodeAddr liveNodeJsonString numBlocks parser getIntValue numBlocks log debug String format currentNodeAddr numBlocks dataNodesToReport add currentNodeAddr
Configuration baseConf String nnURI startTimestampMs Configuration conf Configuration baseConf conf set NN_URI nnURI conf setBoolean MRJobConfig MAP_SPECULATIVE String startTimeString SimpleDateFormat format Date startTimestampMs
t addToQueue AuditReplayCommand getPoisonPill highestTimestamp Optional Exception threadException Optional empty t t join t drainCounters context t drainCommandLatencies context t getException threadException Optional of t getException progressExecutor shutdown threadException RuntimeException threadException get LOG info System currentTimeMillis startTimestampMs totalCommands context getCounter REPLAYCOUNTERS TOTALCOMMANDS getValue totalCommands percentageOfInvalidOps context getCounter REPLAYCOUNTERS TOTALINVALIDCOMMANDS getValue totalCommands
currentEpoch System currentTimeMillis delay startTimestampMs currentEpoch delay
LOG info delay Thread sleep delay LOG warn delay AuditReplayCommand cmd commandQueue take cmd replayCountersMap get REPLAYCOUNTERS TOTALCOMMANDS increment delay cmd getDelay TimeUnit MILLISECONDS delay replayCountersMap get REPLAYCOUNTERS LATECOMMANDS increment replayCountersMap get REPLAYCOUNTERS LATECOMMANDSTOTALTIME increment delay cmd replayCountersMap get REPLAYCOUNTERS TOTALINVALIDCOMMANDS increment cmd commandQueue take
LOG warn delay AuditReplayCommand cmd commandQueue take cmd replayCountersMap get REPLAYCOUNTERS TOTALCOMMANDS increment delay cmd getDelay TimeUnit MILLISECONDS delay replayCountersMap get REPLAYCOUNTERS LATECOMMANDS increment replayCountersMap get REPLAYCOUNTERS LATECOMMANDSTOTALTIME increment delay cmd replayCountersMap get REPLAYCOUNTERS TOTALINVALIDCOMMANDS increment cmd commandQueue take e LOG error e e
String auditOutputPath workloadStartTime System currentTimeMillis Job workloadJob WorkloadDriver getJobForSubmission conf dfs getUri toString workloadStartTime AuditReplayMapper success workloadJob waitForCompletion assertTrue success Counters counters workloadJob getCounters assertEquals counters findCounter AuditReplayMapper REPLAYCOUNTERS TOTALCOMMANDS getValue assertEquals counters findCounter AuditReplayMapper REPLAYCOUNTERS TOTALINVALIDCOMMANDS getValue assertTrue dfs getFileStatus Path isFile assertTrue dfs getFileStatus Path isDirectory assertFalse dfs exists Path assertTrue dfs exists Path auditOutputPath auditOutputFile dfs Path auditOutputPath String auditOutput IOUtils toString auditOutputFile StandardCharsets UTF_8
isIgnoreFailures args idx idx args System out println System out println USAGE logpath Path args idx args idx System out println args idx System out println USAGE ToolRunner printGenericCommandUsage System out ops add FileOperation args idx ops
isIgnoreFailures args idx idx args System out println System out println USAGE logpath Path args idx args idx System out println args idx System out println USAGE ToolRunner printGenericCommandUsage System out ops add FileOperation args idx ops
Path log IOException String randomId getRandomId JobClient jClient JobClient jobconf Path stagingArea stagingArea JobSubmissionFiles getStagingDir jClient getClusterHandle jobconf ie IOException ie Path jobdir Path stagingArea NAME randomId FsPermission mapredSysPerms FsPermission JobSubmissionFiles JOB_DIR_PERMISSION FileSystem mkdirs jClient getFs jobdir mapredSysPerms LOG info JOB_DIR_LABEL jobdir log log Path jobdir FileOutputFormat setOutputPath jobconf log
FileStatus srcstat fs getFileStatus op src srcstat op srcstat opCount opWriter append Text op src toString op Stack Path pathstack Stack Path pathstack push op src pathstack FileStatus stat fs pathstack stat pathstack push stat getPath op stat opCount synCount opWriter sync synCount Path f stat getPath
RunningJobStatus job getCurrentJob job job jobId job
value String oldStage stage stage name String newStage value value name
command add command add LAST_SNAPSHOT_NAME command add CURRENT_SNAPSHOT_NAME command add command add mapNum command add command add bandWidth command add srcParam command add dstParam Configuration config Configuration conf DistCp distCp distCp DistCp config OptionsParser parse command toArray String Job job distCp createAndSubmitJob
BalanceProcedureScheduler scheduler BalanceProcedureScheduler getConf scheduler init Collection BalanceJob jobs scheduler getAllJobs unfinished BalanceJob job jobs job unfinished LOG info job toString unfinished Thread sleep TimeUnit SECONDS toMillis
job FSDataInputStream in Path logPath getLatestStateJobPath job FileSystem fs FileSystem get workUri conf in fs open logPath job readFields in
LOG debug workPath fs mkdirs workPath BalanceJob BalanceJob jobs BalanceJob statuses length StringBuilder builder StringBuilder builder append i i statuses length i statuses i jobs i BalanceJob Builder build jobs i setId statuses i getPath getName builder append jobs i i statuses length builder append builder append
job delayInMilliseconds delayQueue add DelayWrapper job delayInMilliseconds
seed r nextLong r setSeed seed System out println name getMethodName seed conf HdfsConfiguration conf set SingleUGIResolver USER singleUser conf set SingleUGIResolver GROUP singleGroup conf set DFSConfigKeys DFS_PROVIDER_STORAGEUUID DFSConfigKeys DFS_PROVIDER_STORAGEUUID_DEFAULT conf setBoolean DFSConfigKeys DFS_NAMENODE_PROVIDED_ENABLED conf setClass DFSConfigKeys DFS_PROVIDED_ALIASMAP_CLASS TextFileRegionAliasMap BlockAliasMap conf set DFSConfigKeys DFS_PROVIDED_ALIASMAP_TEXT_WRITE_DIR nnDirPath toString conf set DFSConfigKeys DFS_PROVIDED_ALIASMAP_TEXT_READ_FILE Path nnDirPath fileNameFromBlockPoolID bpid toString conf set DFSConfigKeys DFS_PROVIDED_ALIASMAP_TEXT_DELIMITER conf set MiniDFSCluster HDFS_MINIDFS_BASEDIR_PROVIDED File providedPath toUri toString File imageDir File providedPath toUri imageDir
conf setClass DFSConfigKeys DFS_PROVIDED_ALIASMAP_CLASS TextFileRegionAliasMap BlockAliasMap conf set DFSConfigKeys DFS_PROVIDED_ALIASMAP_TEXT_WRITE_DIR nnDirPath toString conf set DFSConfigKeys DFS_PROVIDED_ALIASMAP_TEXT_READ_FILE Path nnDirPath fileNameFromBlockPoolID bpid toString conf set DFSConfigKeys DFS_PROVIDED_ALIASMAP_TEXT_DELIMITER conf set MiniDFSCluster HDFS_MINIDFS_BASEDIR_PROVIDED File providedPath toUri toString File imageDir File providedPath toUri imageDir LOG info imageDir imageDir mkdirs File nnDir File nnDirPath toUri nnDir nnDir mkdirs i i i File newFile File Path providedPath filePrefix i fileSuffix toUri newFile
filename Path file Path filename FileSystem fs cluster getFileSystem newReplication
filename Path file Path filename FileSystem fs cluster getFileSystem newReplication LOG info filename newReplication fs setReplication file newReplication DFSTestUtil waitForReplication DistributedFileSystem fs file newReplication DFSClient client DFSClient InetSocketAddress cluster getNameNodePort cluster getConfiguration getAndCheckBlockLocations client filename baseFileLen newReplication newReplication
providedNameservice List Integer nnIndexes cluster getNNIndexes providedNameservice nn1 nnIndexes get nn2 nnIndexes get verifyFileSystemContents nn1 fail e LOG info e cluster transitionToActive nn1 LOG info nn1 verifyFileSystemContents nn1 cluster transitionToStandby nn1 cluster transitionToActive nn2
fail e LOG info e cluster transitionToActive nn1 LOG info nn1 verifyFileSystemContents nn1 cluster transitionToStandby nn1 cluster transitionToActive nn2 LOG info nn2 verifyFileSystemContents nn2 cluster shutdownNameNodes verifyFileSystemContents nn2 fail e
MiniDFSNNTopology topologies MiniDFSNNTopology MiniDFSNNTopology simpleHATopology MiniDFSNNTopology simpleFederatedTopology MiniDFSNNTopology simpleHAFederatedTopology MiniDFSNNTopology topologies
conf setClass ImageWriter Options UGI_CLASS FsUGIResolver UGIResolver String packageName String policies String createImage FSTreeWalk providedPath conf nnDirPath FixedBlockResolver String racks String policies
conf compress isCompressionEmulationEnabled conf compress ratio getMapInputCompressionEmulationRatio conf
numCompressedFiles FileStatus outFileStatuses fs listStatus inputDir Utils OutputFileUtils OutputFilesFilter FileStatus status outFileStatuses compressionCodecs CompressionCodec codec compressionCodecs getCodec status getPath codec numCompressedFiles compressedDataSize status getLen LOG info LOG info StringUtils humanReadableInt compressedDataSize LOG info numCompressedFiles numCompressedFiles RuntimeException inputDir toString COMPRESSION_EMULATION_ENABLE uncompressedDataSize ratio compressedDataSize uncompressedDataSize
byteCount bytesSync it it Map Entry entry Map Entry it next LongWritable fileSize LongWritable Long parseLong entry getValue toString BytesWritable filePath BytesWritable entry getKey toString getBytes charsetUTF8 byteCount fileSize get bytesSync fileSize get bytesSync src_writer sync bytesSync fileSize get src_writer append fileSize filePath src_writer src_writer close fs deleteOnExit distCacheFilesList
it it Map Entry entry Map Entry it next LongWritable fileSize LongWritable Long parseLong entry getValue toString BytesWritable filePath BytesWritable entry getKey toString getBytes charsetUTF8 byteCount fileSize get bytesSync fileSize get bytesSync src_writer sync bytesSync fileSize get src_writer append fileSize filePath src_writer src_writer close fs deleteOnExit distCacheFilesList conf setInt GenerateDistCacheData GRIDMIX_DISTCACHE_FILE_COUNT fileCount conf setLong GenerateDistCacheData GRIDMIX_DISTCACHE_BYTE_COUNT byteCount
configureRandomBytesDataGenerator job submit job configureRandomBytesDataGenerator job setMapperClass GenDataMapper job setNumReduceTasks job setMapOutputKeyClass NullWritable job setMapOutputValueClass BytesWritable job setInputFormatClass GenDataFormat job setOutputFormatClass RawBytesOutputFormat job setJarByClass GenerateData FileInputFormat addInputPath job Path
Configuration conf getConf conf
genbytes inputDir genbytes Configuration conf getConf inputDir conf inputDir LOG error inputDir STARTUP_FAILED_ERROR CompressionEmulationUtil setupDataGeneratorConfig conf GenerateData genData GenerateData conf inputDir genbytes LOG info StringUtils TraditionalBinaryPrefix long2String genbytes launchGridmixJob genData FsShell shell FsShell conf LOG info inputDir shell run String inputDir toString
conf Path ioPath Path Path inputDir getGridmixInputDataPath ioPath GridmixJobSubmissionPolicy policy getJobSubmissionPolicy conf
numThreads conf getInt GRIDMIX_SUB_THR noOfSubmitterThreads queueDep conf getInt GRIDMIX_QUE_DEP submitter createJobSubmitter monitor numThreads queueDep FilePool conf inputDir userResolver statistics distCacheEmulator DistributedCacheEmulator conf ioPath factory createJobFactory submitter traceIn scratchDir conf startFlag userResolver factory jobCreator setDistCacheEmulator distCacheEmulator statistics addJobStatsListeners factory statistics addClusterStatsObservers factory statistics addJobStatsListeners summarizer getExecutionSummarizer statistics addClusterStatsObservers summarizer getClusterSummarizer monitor start submitter start
argv i genbytes StringUtils TraditionalBinaryPrefix string2long argv i genbytes LOG error ARGS_ERROR argv i userRsrc URI argv i LOG error argv i printUsage System err ARGS_ERROR userRsrc userRsrc LOG warn userRsrc
LOG error userResolver getClass printUsage System err ARGS_ERROR userRsrc LOG warn userRsrc ioPath Path argv argv length traceIn argv argv length e LOG error e toString LOG e printStackTrace printUsage System err ARGS_ERROR FileSystem inputFs ioPath getFileSystem conf
startThreads conf traceIn ioPath scratchDir startFlag userResolver Path inputDir getGridmixInputDataPath ioPath exitCode writeInputData genbytes inputDir exitCode exitCode stats GenerateData publishDataStatistics inputDir genbytes conf submitter refreshFilePool shouldGenerate genbytes exitCode setupEmulation conf traceIn scratchDir ioPath shouldGenerate exitCode exitCode summarizer start conf factory start statistics start
Path inputDir getGridmixInputDataPath ioPath exitCode writeInputData genbytes inputDir exitCode exitCode stats GenerateData publishDataStatistics inputDir genbytes conf submitter refreshFilePool shouldGenerate genbytes exitCode setupEmulation conf traceIn scratchDir ioPath shouldGenerate exitCode exitCode summarizer start conf factory start statistics start e LOG error e toString
exitCode exitCode summarizer start conf factory start statistics start Throwable e LOG error e toString LOG debug e factory factory abort exitCode STARTUP_FAILED_ERROR startFlag countDown factory factory join Long MAX_VALUE Throwable badTraceException factory error
sourceConf destConf clusterValueKey jobValueKey defaultValue simulatedClusterDefaultValue destConf getLong clusterValueKey defaultValue originalClusterDefaultValue sourceConf getLong clusterValueKey defaultValue originalJobValue sourceConf getLong jobValueKey defaultValue scaleFactor originalJobValue originalClusterDefaultValue simulatedJobValue scaleFactor simulatedClusterDefaultValue
job String jobID job getJob getConfiguration get Gridmix ORIGINAL_JOB_ID
i i reds i TaskInfo info jobdesc getTaskInfo TaskType REDUCE i reduceByteRatio i info getInputBytes mapOutputBytesTotal reduceRecordRatio i info getInputRecords mapOutputRecordsTotal InputStriper striper InputStriper inputDir mapInputBytesTotal List InputSplit splits ArrayList InputSplit i i maps i nSpec reds maps reds maps i specBytes nSpec specRecords nSpec ResourceUsageMetrics metrics ResourceUsageMetrics nSpec j j nSpec j TaskInfo info jobdesc getTaskInfo TaskType REDUCE i j maps specBytes j info getOutputBytes specRecords j info getOutputRecords
List InputSplit splits ArrayList InputSplit reds mapTasksOnly jobdesc getNumberReduces maps jobdesc getNumberMaps i i maps i nSpec reds maps reds maps i redDurations nSpec j j nSpec j ReduceTaskAttemptInfo info ReduceTaskAttemptInfo getSuccessfulAttemptInfo TaskType REDUCE i j maps redDurations j Math min reduceMaxSleepTime info getMergeRuntime info getReduceRuntime
stats seq GridmixJob getJobSeqId stats getJob seq
loadStatus getJobLoad LOG LOG debug System currentTimeMillis Boolean TRUE toString loadStatus getJobLoad mapCapacity loadStatus getMapCapacity reduceCapacity loadStatus getReduceCapacity mapCapacity reduceCapacity maxMapLoad overloadMapTaskMapSlotRatio mapCapacity maxReduceLoad overloadReduceTaskReduceSlotRatio reduceCapacity totalMapTasks ClusterStats getSubmittedMapTasks totalReduceTasks ClusterStats getSubmittedReduceTasks LOG LOG debug totalMapTasks
loadStatus getJobLoad LOG LOG debug System currentTimeMillis Boolean TRUE toString loadStatus getJobLoad mapCapacity loadStatus getMapCapacity reduceCapacity loadStatus getReduceCapacity mapCapacity reduceCapacity maxMapLoad overloadMapTaskMapSlotRatio mapCapacity maxReduceLoad overloadReduceTaskReduceSlotRatio reduceCapacity totalMapTasks ClusterStats getSubmittedMapTasks totalReduceTasks ClusterStats getSubmittedReduceTasks LOG LOG debug totalMapTasks LOG debug totalReduceTasks
LOG LOG debug System currentTimeMillis Boolean TRUE toString loadStatus getJobLoad mapCapacity loadStatus getMapCapacity reduceCapacity loadStatus getReduceCapacity mapCapacity reduceCapacity maxMapLoad overloadMapTaskMapSlotRatio mapCapacity maxReduceLoad overloadReduceTaskReduceSlotRatio reduceCapacity totalMapTasks ClusterStats getSubmittedMapTasks totalReduceTasks ClusterStats getSubmittedReduceTasks LOG LOG debug totalMapTasks LOG debug totalReduceTasks LOG debug maxMapLoad
currentReduceSlotsBackFill maxReduceLoad incompleteReduceTasks currentReduceSlotsBackFill incompleteMapTasks totalMapTasks LOG LOG debug LOG warn id blacklistedJobs add id mapSlotsBackFill maxMapLoad incompleteMapTasks reduceSlotsBackFill maxReduceLoad incompleteReduceTasks blacklistedJobs retainAll seenJobIDs LOG blacklistedJobs size LOG debug blacklistedJobs size loadStatus updateMapLoad mapSlotsBackFill
String user FileSystem fs dfsCluster getFileSystem String path user Path homeDirectory Path path fs homeDirectory
Configuration conf Configuration FileSystem fs FileSystem getLocal conf getRaw fs delete base Random r Random seed r nextLong r setSeed seed
SleepJob SleepMapper test SleepJob SleepMapper Configuration conf Configuration conf setInt JobContext NUM_REDUCES CompressionEmulationUtil setCompressionEmulationEnabled conf conf setBoolean MRJobConfig MAP_OUTPUT_COMPRESS TaskAttemptID taskId TaskAttemptID FakeRecordLLReader reader FakeRecordLLReader LoadRecordGkNullWriter writer LoadRecordGkNullWriter OutputCommitter committer CustomOutputCommitter StatusReporter reporter TaskAttemptContextImpl DummyReporter SleepSplit split getSleepSplit MapContext LongWritable LongWritable GridmixKey NullWritable mapcontext MapContextImpl LongWritable LongWritable GridmixKey NullWritable conf taskId reader writer committer reporter split Context context WrappedMapper LongWritable LongWritable GridmixKey NullWritable getMapContext mapcontext start System currentTimeMillis
CompressionEmulationUtil setCompressionEmulationEnabled conf conf setBoolean MRJobConfig MAP_OUTPUT_COMPRESS TaskAttemptID taskId TaskAttemptID FakeRecordLLReader reader FakeRecordLLReader LoadRecordGkNullWriter writer LoadRecordGkNullWriter OutputCommitter committer CustomOutputCommitter StatusReporter reporter TaskAttemptContextImpl DummyReporter SleepSplit split getSleepSplit MapContext LongWritable LongWritable GridmixKey NullWritable mapcontext MapContextImpl LongWritable LongWritable GridmixKey NullWritable conf taskId reader writer committer reporter split Context context WrappedMapper LongWritable LongWritable GridmixKey NullWritable getMapContext mapcontext start System currentTimeMillis LOG info start LongWritable key LongWritable start LongWritable value LongWritable start test map key value context
Random r Random seed r nextLong r setSeed seed
Random r Random seed r nextLong r setSeed seed
Random r Random s r nextLong r setSeed s
Random r Random s r nextLong r setSeed s
Random r Random s r nextLong r setSeed s
policy GridmixJobSubmissionPolicy REPLAY LOG info System currentTimeMillis doSubmission
policy GridmixJobSubmissionPolicy STRESS LOG info System currentTimeMillis doSubmission
policy GridmixJobSubmissionPolicy SERIAL LOG info System currentTimeMillis doSubmission JobCreator LOADJOB name
policy GridmixJobSubmissionPolicy REPLAY LOG info System currentTimeMillis doSubmission JobCreator LOADJOB name
Configuration conf Configuration GridmixKey key GridmixKey GridmixRecord val GridmixRecord
policy GridmixJobSubmissionPolicy SERIAL LOG info System currentTimeMillis doSubmission JobCreator SLEEPJOB name
policy GridmixJobSubmissionPolicy REPLAY LOG info System currentTimeMillis doSubmission JobCreator SLEEPJOB name
policy GridmixJobSubmissionPolicy STRESS LOG info System currentTimeMillis doSubmission JobCreator SLEEPJOB name
conf Properties props Properties brokerList conf getString BROKER_LIST
Instant instant Instant ofEpochMilli timestamp LocalDateTime ldt LocalDateTime ofInstant instant zoneId String date ldt format dateFormat String time ldt format timeFormat jsonLines append hostname jsonLines append timestamp jsonLines append date jsonLines append time jsonLines append record name tag record jsonLines append tag name toString replaceAll jsonLines append tag value toString metric record jsonLines append metric name toString replaceAll jsonLines append metric value toString
Iterable AbstractMetric metrics Lists newArrayList metric when record name thenReturn when record metrics thenReturn metrics SubsetConfiguration conf mock SubsetConfiguration when conf getString KafkaSink BROKER_LIST thenReturn String topic when conf getString KafkaSink TOPIC thenReturn topic kafkaSink KafkaSink kafkaSink init conf Producer Integer mockProducer mock KafkaProducer kafkaSink setProducer mockProducer StringBuilder jsonLines recordToJson record
reason reasonClosed reason
authenticationRequest String data JSONUtil toJSON AuthenticationRequestWrapper authenticationRequest
IOException uri req resp statusCode IOException fault String errorMessage String format req getMethod uri statusCode resp getStatusLine
HttpResponse client req HttpResponse resp execWithDebugOutput req client statusCode resp getStatusLine getStatusCode statusCode statusCode req
dir workingDir makeAbsolute dir
IllegalArgumentException file BlockLocation FileStatus listOfFileBlocks store listSubPaths file getPath List URI locations ArrayList URI listOfFileBlocks FileStatus fileStatus listOfFileBlocks fileStatus getPath file getPath locations addAll store getObjectLocation fileStatus getPath locations store getObjectLocation file getPath locations
SwiftOperationFailedException SwiftFileStatus srcMetadata srcMetadata getObjectMetadata src SwiftFileStatus dstMetadata dstMetadata getObjectMetadata dst LOG debug dstMetadata Path srcParent src getParent Path dstParent dst getParent dstParent dstParent srcParent SwiftFileStatus fileStatus fileStatus getObjectMetadata dstParent
destPath toObjectPath dst childCount childStats size childCount copyThenDeleteObject srcObject destPath SwiftUtils debug LOG copyObject srcObject destPath stat childStats SwiftUtils debug LOG stat deleteObject stat getPath swiftRestClient delete srcObject
reason reasonClosed reason
EOFException FSExceptionMessages NEGATIVE_SEEK offset targetPos pos LOG LOG debug targetPos pos offset offset LOG debug offset LOG debug rangeOffset offset SwiftUtils debug LOG pos targetPos offset rangeOffset LOG debug chompBytes offset
LOG debug offset LOG debug rangeOffset offset SwiftUtils debug LOG pos targetPos offset rangeOffset LOG debug chompBytes offset e LOG debug e targetPos pos LOG trace LOG trace
backupStream backupStream close partUpload backupFile SwiftUtils debug LOG delete backupFile partUpload uploadSuccess attempt uploadSuccess attempt bytesUploaded uploadFilePartAttempt attempt uploadSuccess
lastFs List DurationStats statistics lastFs getOperationStatistics DurationStats statistics
printf String format args String msg String format format args System out printf msg
describe createFile path FileStatus status fs getFileStatus path
firstWriteLen out write src firstWriteLen expected getExpectedPartitionsWritten firstWriteLen PART_SIZE_BYTES SwiftUtils debug LOG expected assertPartitionsWritten out expected remainder len firstWriteLen SwiftUtils debug LOG remainder out write src firstWriteLen remainder expected getExpectedPartitionsWritten len PART_SIZE_BYTES assertPartitionsWritten out expected out close expected getExpectedPartitionsWritten len PART_SIZE_BYTES assertPartitionsWritten out expected Header headers fs getStore getObjectHeaders path Header headers
expected getExpectedPartitionsWritten firstWriteLen PART_SIZE_BYTES SwiftUtils debug LOG expected assertPartitionsWritten out expected remainder len firstWriteLen SwiftUtils debug LOG remainder out write src firstWriteLen remainder expected getExpectedPartitionsWritten len PART_SIZE_BYTES assertPartitionsWritten out expected out close expected getExpectedPartitionsWritten len PART_SIZE_BYTES assertPartitionsWritten out expected Header headers fs getStore getObjectHeaders path Header header headers LOG info header toString dest readDataset fs path len
firstWriteLen out write src firstWriteLen expected getExpectedPartitionsWritten firstWriteLen PART_SIZE_BYTES SwiftUtils debug LOG expected assertPartitionsWritten out expected remainder len firstWriteLen SwiftUtils debug LOG remainder out write src firstWriteLen remainder expected getExpectedPartitionsWritten len PART_SIZE_BYTES assertPartitionsWritten out expected out close expected getExpectedPartitionsWritten len PART_SIZE_BYTES assertPartitionsWritten out expected Header headers fs getStore getObjectHeaders path Header headers
expected getExpectedPartitionsWritten firstWriteLen PART_SIZE_BYTES SwiftUtils debug LOG expected assertPartitionsWritten out expected remainder len firstWriteLen SwiftUtils debug LOG remainder out write src firstWriteLen remainder expected getExpectedPartitionsWritten len PART_SIZE_BYTES assertPartitionsWritten out expected out close expected getExpectedPartitionsWritten len PART_SIZE_BYTES assertPartitionsWritten out expected Header headers fs getStore getObjectHeaders path Header header headers LOG info header toString dest readDataset fs path len
String initialpath Path ipath Path initialpath SwiftObjectPath objectPath SwiftObjectPath fromPath URI initialpath ipath URI endpoint URI ENDPOINT URI uri SwiftRestClient pathToURI objectPath endpoint
String initialpath Path ipath Path initialpath SwiftObjectPath objectPath SwiftObjectPath fromPath URI initialpath ipath URI endpoint URI ENDPOINT URI uri SwiftRestClient pathToURI objectPath endpoint LOG info initialpath
assumeEnabled SwiftRestClient client createClient client authenticate Path path Path SwiftObjectPath sobject SwiftObjectPath fromPath serviceURI path stuff stuff client upload sobject ByteArrayInputStream stuff stuff length Duration head Duration Header responseHeaders client headRequest sobject SwiftRestClient NEWEST head finished
assumeEnabled SwiftRestClient client createClient client authenticate Path path Path SwiftObjectPath sobject SwiftObjectPath fromPath serviceURI path stuff stuff client upload sobject ByteArrayInputStream stuff stuff length Duration head Duration Header responseHeaders client headRequest sobject SwiftRestClient NEWEST head finished LOG info head Header responseHeaders
stuff stuff client upload sobject ByteArrayInputStream stuff stuff length Duration head Duration Header responseHeaders client headRequest sobject SwiftRestClient NEWEST head finished LOG info head Header header responseHeaders LOG info header toString client delete sobject Header headers client headRequest sobject SwiftRestClient NEWEST Assert fail sobject client
FileStatus status2 FileStatus fs listStatus dir ls2 finished assertEquals count status2 length SwiftTestUtils noteAction l l count l String name String format format l Path p Path dir name Duration d Duration String result SwiftTestUtils readBytesToString fs p name length assertEquals name result d finished readStats add d SwiftTestUtils noteAction Duration rm2 Duration fs delete dir
assertEquals count status2 length SwiftTestUtils noteAction l l count l String name String format format l Path p Path dir name Duration d Duration String result SwiftTestUtils readBytesToString fs p name length assertEquals name result d finished readStats add d SwiftTestUtils noteAction Duration rm2 Duration fs delete dir rm2 finished LOG info String format fs getUri
l l l String name String format format l Path p Path dir name Duration d Duration String result SwiftTestUtils readBytesToString fs p name length assertEquals name result d finished readStats add d SwiftTestUtils noteAction Duration rm2 Duration fs delete dir rm2 finished LOG info String format fs getUri LOG info writeStats toString LOG info readStats toString
logFile logParserUtil parseLog logFile
String String pipelineId String runId RecurrenceId recurrenceId RecurrenceId pipelineId runId Map RecurrenceId List ResourceSkyline jobHistory skylineStore getHistory recurrenceId String skyline gson toJson jobHistory skylineStoreType
String String pipelineId RLESparseResourceAllocation result skylineStore getEstimation pipelineId String skyline gson toJson result rleType
pipelineId runId RecurrenceId recurrenceId RecurrenceId pipelineId runId skylineStore deleteHistory recurrenceId
inputValidator validate recurrenceId resourceSkylines writeLock lock List ResourceSkyline filteredInput eliminateNull resourceSkylines filteredInput skylineStore recurrenceId List ResourceSkyline jobHistory skylineStore get recurrenceId List String oldJobIds ArrayList ResourceSkyline resourceSkyline jobHistory oldJobIds add resourceSkyline getJobId oldJobIds ResourceSkyline filteredInput oldJobIds getJobId StringBuilder errMsg StringBuilder errMsg append recurrenceId
List ResourceSkyline filteredInput eliminateNull resourceSkylines filteredInput skylineStore recurrenceId List ResourceSkyline jobHistory skylineStore get recurrenceId List String oldJobIds ArrayList ResourceSkyline resourceSkyline jobHistory oldJobIds add resourceSkyline getJobId oldJobIds ResourceSkyline filteredInput oldJobIds getJobId StringBuilder errMsg StringBuilder errMsg append recurrenceId LOGGER error errMsg toString DuplicateRecurrenceIdException errMsg toString skylineStore get recurrenceId addAll filteredInput
List ResourceSkyline jobHistory skylineStore get recurrenceId List String oldJobIds ArrayList ResourceSkyline resourceSkyline jobHistory oldJobIds add resourceSkyline getJobId oldJobIds ResourceSkyline filteredInput oldJobIds getJobId StringBuilder errMsg StringBuilder errMsg append recurrenceId LOGGER error errMsg toString DuplicateRecurrenceIdException errMsg toString skylineStore get recurrenceId addAll filteredInput LOGGER info recurrenceId skylineStore put recurrenceId filteredInput
pipelineId resourceSkyline inputValidator validate pipelineId resourceSkyline writeLock lock estimationStore put pipelineId resourceSkyline
recurrenceId List ResourceSkyline resourceSkylines inputValidator validate recurrenceId resourceSkylines writeLock lock skylineStore recurrenceId List ResourceSkyline filteredInput eliminateNull resourceSkylines filteredInput skylineStore put recurrenceId filteredInput
writeLock lock skylineStore recurrenceId List ResourceSkyline filteredInput eliminateNull resourceSkylines filteredInput skylineStore put recurrenceId filteredInput LOGGER info recurrenceId StringBuilder errMsg StringBuilder errMsg append recurrenceId LOGGER error errMsg toString EmptyResourceSkylineException errMsg toString StringBuilder errMsg StringBuilder errMsg append recurrenceId
recurrenceId inputValidator validate recurrenceId readLock lock String pipelineId recurrenceId getPipelineId pipelineId
inputValidator validate recurrenceId readLock lock String pipelineId recurrenceId getPipelineId pipelineId LOGGER info recurrenceId Collections unmodifiableMap skylineStore String runId recurrenceId getRunId Map RecurrenceId List ResourceSkyline result HashMap RecurrenceId List ResourceSkyline runId Map RecurrenceId List ResourceSkyline entry skylineStore RecurrenceId index entry getKey index getPipelineId pipelineId result put index entry getValue result
RecurrenceId entry skylineStore RecurrenceId index entry getKey index result put index entry getValue result LOGGER info recurrenceId Collections unmodifiableMap result LOGGER warn recurrenceId skylineStore recurrenceId result put recurrenceId skylineStore get recurrenceId LOGGER warn recurrenceId
StringBuilder sb StringBuilder sb append
StringBuilder sb StringBuilder sb append
validate recurrenceId validate recurrenceId StringBuilder sb StringBuilder sb append recurrenceId
validate pipelineId validate pipelineId StringBuilder sb StringBuilder sb append pipelineId
indexJobITimeK indexJobI jobLen timeK cJobITimeK containerNums timeK regularizationConstraint set uaPredict indexJobITimeK cJobI generateOverAllocationConstraints lpModel cJobITimeK oa x indexJobITimeK timeK generateUnderAllocationConstraints lpModel cJobITimeK uaPredict ua x indexJobITimeK timeK Expression objective lpModel addExpression generateObjective objective numJobs jobLen oa ua eps Result lpResult lpModel minimise TreeMap Long Resource treeMap TreeMap RLESparseResourceAllocation result RLESparseResourceAllocation treeMap DefaultResourceCalculator ReservationInterval riAdd Resource containerSpec resourceSkylines get getContainerSpec String pipelineId RecurrenceId jobHistory keySet toArray getPipelineId Resource resource jobLen
Queue Pair LoggedJob JobTraceReader heap PriorityQueue Pair LoggedJob JobTraceReader LoggedJob job reader nextJob job LOG error EMPTY_JOB_TRACE startsAfter LOG info job getSubmitTime approximateTime job getSubmitTime startsAfter job reader nextJob skippedCount job job getSubmitTime approximateTime job reader nextJob skippedCount LOG debug startsAfter skippedCount
LoggedJob job reader nextJob job LOG error EMPTY_JOB_TRACE startsAfter LOG info job getSubmitTime approximateTime job getSubmitTime startsAfter job reader nextJob skippedCount job job getSubmitTime approximateTime job reader nextJob skippedCount LOG debug startsAfter skippedCount job LOG error startsAfter
approximateTime job getSubmitTime startsAfter job reader nextJob skippedCount job job getSubmitTime approximateTime job reader nextJob skippedCount LOG debug startsAfter skippedCount job LOG error startsAfter EMPTY_JOB_TRACE LOG info job getSubmitTime firstJobSubmitTime job getSubmitTime lastJobSubmitTime firstJobSubmitTime numberJobs currentIntervalEnd Long MIN_VALUE
lastJobSubmitTime firstJobSubmitTime numberJobs currentIntervalEnd Long MIN_VALUE Path nextSegment Outputter LoggedJob tempGen debug LOG debug firstJobSubmitTime Configuration conf getConf job Random tempNameGenerator Random lastJobSubmitTime job getSubmitTime numberJobs job getSubmitTime currentIntervalEnd tempGen
Random tempNameGenerator Random lastJobSubmitTime job getSubmitTime numberJobs job getSubmitTime tempGen tempGen close nextSegment nextSegment nextSegment Path tempDir tempNameGenerator nextLong debug LOG debug nextSegment FileSystem fs nextSegment getFileSystem conf fs nextSegment
input input close LOG info currentFileName input inputCodec CodecPool returnDecompressor inputDecompressor inputDecompressor inputCodec inputDirectoryCursor inputDirectoryCursor inputDirectoryFiles fileFirstLine currentFileName inputDirectoryFiles inputDirectoryCursor LOG info currentFileName
task setPreferredLocations locations task setTaskID taskID startTime task setStartTime Long parseLong startTime finishTime task setFinishTime Long parseLong finishTime Pre21JobHistoryConstants Values typ Pre21JobHistoryConstants Values stat stat status Pre21JobHistoryConstants Values valueOf status e LOG error status e stat task setTaskStatus stat
jobBeingTraced getMapTasks add task tasksInCurrentJob put taskID task task setTaskID taskID LoggedTaskAttempt attempt attemptsInCurrentJob get attemptID attemptAlreadyExists attempt attempt attempt LoggedTaskAttempt attempt setAttemptID attemptID attemptAlreadyExists attemptsInCurrentJob put attemptID attempt task getAttempts add attempt Pre21JobHistoryConstants Values stat stat status Pre21JobHistoryConstants Values valueOf status
Pair String String line readBalancedLine line
HadoopLogsAnalyzer analyzer HadoopLogsAnalyzer result ToolRunner run analyzer args result System exit result e LOG error e e printStackTrace staticDebugOutput System exit e LOG error e e printStackTrace staticDebugOutput System exit e
LOG info obtainCounters obtainFailedDueToAttemptId List LoggedLocation loc getPreferredLocations LoggedLocation loc
LOG info LOG info numNMs numRacks nodeManagerResource LOG info LOG info numAMs numTasks Math ceil numTasks numAMs LOG info AMSimulator entry AMSimulator am entry getValue
reservationRequest UserGroupInformation ugi UserGroupInformation createRemoteUser user ugi rm getClientRMService submitReservation reservationRequest
init heartbeatInterval containerList resourceManager slsRunnner startTime finishTime simUser simQueue tracked oldApp baseTimeMS amResource nodeLabelExpr params appIdAMSim init heartbeatInterval containerList resourceManager slsRunnner startTime finishTime simUser simQueue tracked oldApp baseTimeMS amResource nodeLabelExpr params appIdAMSim amtype allContainers addAll containerList pendingContainers addAll containerList totalContainers allContainers size
responseQueue AllocateResponse response responseQueue take response cs response ContainerId containerId cs getContainerId cs containerId
cs ContainerId containerId cs getContainerId cs assignedContainers containerId LOG debug appId containerId ContainerSimulator containerSimulator assignedContainers remove containerId finishedContainers completedContainers add containerSimulator containerId isFinished LOG info appId finishedContainers lastStep assignedContainers containerId
assignedContainers containerId LOG debug appId containerId ContainerSimulator containerSimulator assignedContainers remove containerId finishedContainers completedContainers add containerSimulator containerId isFinished LOG info appId finishedContainers lastStep assignedContainers containerId LOG error appId containerId pendingContainers add assignedContainers remove containerId containerId
finishedContainers completedContainers add containerSimulator containerId isFinished LOG info appId finishedContainers lastStep assignedContainers containerId LOG error appId containerId pendingContainers add assignedContainers remove containerId containerId LOG error appId isAMContainerRunning finishedContainers isAMContainerRunning
lastStep assignedContainers containerId LOG error appId containerId pendingContainers add assignedContainers remove containerId containerId LOG error appId isAMContainerRunning isAMContainerRunning LOG info appId isFinished
responseQueue AllocateResponse response responseQueue take response cs response ContainerId containerId cs getContainerId cs containerId
cs ContainerId containerId cs getContainerId cs assignedMaps containerId LOG debug appId containerId assignedMaps remove containerId mapFinished finishedContainers assignedReduces containerId LOG debug appId containerId assignedReduces remove containerId reduceFinished finishedContainers containerId isFinished
assignedMaps remove containerId mapFinished finishedContainers assignedReduces containerId LOG debug appId containerId assignedReduces remove containerId reduceFinished finishedContainers containerId isFinished LOG info appId mapFinished reduceFinished lastStep assignedMaps containerId
assignedReduces containerId LOG debug appId containerId assignedReduces remove containerId reduceFinished finishedContainers containerId isFinished LOG info appId reduceFinished lastStep assignedMaps containerId LOG debug appId containerId pendingFailedMaps add assignedMaps remove containerId assignedReduces containerId
assignedReduces remove containerId reduceFinished finishedContainers containerId isFinished LOG info appId reduceFinished lastStep assignedMaps containerId LOG debug appId containerId pendingFailedMaps add assignedMaps remove containerId assignedReduces containerId LOG debug appId containerId pendingFailedReduces add assignedReduces remove containerId
containerId isFinished LOG info appId lastStep assignedMaps containerId LOG debug appId containerId pendingFailedMaps add assignedMaps remove containerId assignedReduces containerId LOG debug appId containerId pendingFailedReduces add assignedReduces remove containerId containerId LOG info appId
lastStep assignedMaps containerId LOG debug appId containerId pendingFailedMaps add assignedMaps remove containerId assignedReduces containerId LOG debug appId containerId pendingFailedReduces add assignedReduces remove containerId containerId LOG info appId isAMContainerRunning isAMContainerRunning LOG debug appId isFinished
LOG debug appId containerId pendingFailedMaps add assignedMaps remove containerId assignedReduces containerId LOG debug appId containerId pendingFailedReduces add assignedReduces remove containerId containerId LOG info appId isAMContainerRunning isAMContainerRunning LOG debug appId isFinished scheduledMaps ContainerSimulator cs scheduledMaps remove
List ResourceRequest ask pendingMaps ask packageRequests mergeLists pendingMaps scheduledMaps PRIORITY_MAP LOG debug appId pendingMaps size scheduledMaps addAll pendingMaps pendingMaps clear pendingFailedMaps ask packageRequests mergeLists pendingFailedMaps scheduledMaps PRIORITY_MAP LOG debug appId pendingFailedMaps size scheduledMaps addAll pendingFailedMaps pendingFailedMaps clear pendingReduces ask packageRequests mergeLists pendingReduces scheduledReduces PRIORITY_REDUCE
LOG debug appId pendingMaps size scheduledMaps addAll pendingMaps pendingMaps clear pendingFailedMaps ask packageRequests mergeLists pendingFailedMaps scheduledMaps PRIORITY_MAP LOG debug appId pendingFailedMaps size scheduledMaps addAll pendingFailedMaps pendingFailedMaps clear pendingReduces ask packageRequests mergeLists pendingReduces scheduledReduces PRIORITY_REDUCE LOG debug appId pendingReduces size scheduledReduces addAll pendingReduces pendingReduces clear
init heartbeatInterval containerList rm se traceStartTime traceFinishTime user queue isTracked oldAppId baselineStartTimeMS amContainerResource nodeLabelExpr params appIdAMSim init heartbeatInterval containerList rm se traceStartTime traceFinishTime user queue isTracked oldAppId baselineStartTimeMS amContainerResource nodeLabelExpr params appIdAMSim amtype allStreams addAll containerList duration traceFinishTime traceStartTime
responseQueue AllocateResponse response responseQueue take response cs response ContainerId containerId cs getContainerId containerId
responseQueue AllocateResponse response responseQueue take response cs response ContainerId containerId cs getContainerId assignedStreams containerId LOG debug appId containerId pendingStreams add assignedStreams remove containerId containerId cs isAMContainerRunning isFinished LOG info appId
cs ContainerId containerId cs getContainerId assignedStreams containerId LOG debug appId containerId pendingStreams add assignedStreams remove containerId containerId cs isAMContainerRunning isFinished LOG info appId LOG info appId isAMContainerRunning isAMContainerRunning
isAMContainerRunning isFinished LOG info appId LOG info appId isAMContainerRunning isAMContainerRunning LOG debug appId isAMContainerRunning isFinished
List ResourceRequest ask ArrayList List ContainerId release ArrayList pendingStreams ask packageRequests mergeLists pendingStreams scheduledStreams PRIORITY_MAP
ContainerSimulator cs completedContainerList cs runningContainers remove cs getId completedContainerList add cs getId
ns setResponseId responseId ns setNodeHealthStatus NodeHealthStatus newInstance resourceUtilizationRatio resourceUtilizationRatio pMemUsed Math round node getTotalCapability getMemorySize resourceUtilizationRatio cpuUsed node getTotalCapability getVirtualCores resourceUtilizationRatio ResourceUtilization resourceUtilization ResourceUtilization newInstance pMemUsed pMemUsed cpuUsed ns setContainersUtilization resourceUtilization ns setNodeUtilization resourceUtilization beatRequest setNodeStatus ns NodeHeartbeatResponse beatResponse rm getResourceTrackerService nodeHeartbeat beatRequest beatResponse beatResponse
cpuUsed node getTotalCapability getVirtualCores resourceUtilizationRatio ResourceUtilization resourceUtilization ResourceUtilization newInstance pMemUsed pMemUsed cpuUsed ns setContainersUtilization resourceUtilization ns setNodeUtilization resourceUtilization beatRequest setNodeStatus ns NodeHeartbeatResponse beatResponse rm getResourceTrackerService nodeHeartbeat beatRequest beatResponse containerId beatResponse amContainerList containerId amContainerList amContainerList remove containerId LOG debug node getNodeID containerId cs runningContainers remove containerId
timeIntervalMS conf getInt SLSConfiguration METRICS_RECORD_INTERVAL_MS SLSConfiguration METRICS_RECORD_INTERVAL_MS_DEFAULT File dir File metricsOutputDir dir dir
String workloadJson ObjectMapper mapper ObjectMapper mapper configure INTERN_FIELD_NAMES mapper configure FAIL_ON_UNKNOWN_PROPERTIES SynthTraceJobProducer Workload wl mapper readValue workloadJson SynthTraceJobProducer Workload JDKRandomGenerator rand JDKRandomGenerator rand setSeed wl init rand bucket0 bucket1 bucket2 bucket3 time wl generateSubmissionTime
LOG info time time bucket0 time bucket1 time bucket2 bucket3 Assert assertTrue bucket0 Assert assertTrue bucket1 Assert assertTrue bucket2 Assert assertTrue bucket3 Assert assertTrue bucket2 bucket0 Assert assertTrue bucket2 bucket3
Configuration conf Configuration conf set SynthTraceJobProducer SLS_SYNTHETIC_TRACE_FILE SynthTraceJobProducer stjp SynthTraceJobProducer conf
Configuration conf Configuration conf set SynthTraceJobProducer SLS_SYNTHETIC_TRACE_FILE SynthTraceJobProducer stjp SynthTraceJobProducer conf LOG info stjp toString SynthJob js SynthJob stjp getNextJob jobCount js
Configuration conf Configuration conf set SynthTraceJobProducer SLS_SYNTHETIC_TRACE_FILE SynthTraceJobProducer stjp SynthTraceJobProducer conf
Configuration conf Configuration conf set SynthTraceJobProducer SLS_SYNTHETIC_TRACE_FILE SynthTraceJobProducer stjp SynthTraceJobProducer conf LOG info stjp toString SynthJob js SynthJob stjp getNextJob jobCount js
Configuration conf Configuration conf set SynthTraceJobProducer SLS_SYNTHETIC_TRACE_FILE SynthTraceJobProducer stjp SynthTraceJobProducer conf
Configuration conf Configuration conf set SynthTraceJobProducer SLS_SYNTHETIC_TRACE_FILE SynthTraceJobProducer stjp SynthTraceJobProducer conf LOG info stjp toString SynthJob js SynthJob stjp getNextJob jobCount js
f LOG info Arrays asList argvSplit Environment childEnv Environment StreamUtil env clone addJobConfToEnvironment job_ childEnv addEnvironment childEnv job_ get envPut childEnv System getProperty ProcessBuilder builder ProcessBuilder argvSplit builder environment putAll childEnv toMap sim builder start clientOut_ DataOutputStream BufferedOutputStream sim getOutputStream BUFFER_SIZE clientIn_ DataInputStream BufferedInputStream sim getInputStream BUFFER_SIZE clientErr_ DataInputStream BufferedInputStream sim getErrorStream startTime_ System currentTimeMillis e LOG error e
job String s job get s minRecWrittenToEnableSkip_ Long parseLong s
LOG info clientOut_ clientOut_ flush clientOut_ close io LOG warn io waitOutputThreads io LOG warn io sim sim destroy LOG info
String info numRecInfo
IOException outerrThreadsThrowable numRecRead_ maybeLogRecord numExceptions_ inWriter_ writeKey key inWriter_ writeValue value clientOut_ flush numRecSkipped_ IOException numExceptions_ numExceptions_
record start len numRec_ numRec_ nextStatusRec_ String recordStr String record start Math min len statusMaxRecordChars_ nextStatusRec_ String status getStatus recordStr
jar_ File wd File getAbsoluteFile RunJar unJar File jar_ wd MATCH_ANY jc_ JobClient jobConf_ running_ running_ jc_ submitJob jobConf_ jobId_ running_ getID LOG info jc_ jobConf_ running_ LOG error LOG info output_
jc_ JobClient jobConf_ running_ running_ jc_ submitJob jobConf_ jobId_ running_ getID LOG info jc_ jobConf_ running_ LOG error LOG info output_ fe LOG error fe getMessage
record start len numRec_ numRec_ nextStatusRec_ String recordStr String record start Math min len statusMaxRecordChars_ nextStatusRec_ String status getStatus recordStr
ResourceInformation ResourceInformation ri
conf resourceTypesKey value conf getLong resourceTypesKey value
Map String ResourceInformation conf Map String ResourceInformation resourceInformationMap HashMap String resourceNames conf getStrings YarnConfiguration RESOURCE_TYPES resourceNames resourceNames String resourceName resourceNames String resourceUnits conf get YarnConfiguration RESOURCE_TYPES resourceName UNITS String resourceTypeName conf get YarnConfiguration RESOURCE_TYPES resourceName TYPE ResourceTypes COUNTABLE toString Long minimumAllocation conf getLong YarnConfiguration RESOURCE_TYPES resourceName MINIMUM_ALLOCATION Long maximumAllocation conf getLong YarnConfiguration RESOURCE_TYPES resourceName MAXIMUM_ALLOCATION Long MAX_VALUE resourceName resourceName resourceUnits resourceTypeName YarnRuntimeException resourceName ResourceTypes resourceType ResourceTypes valueOf resourceTypeName String resourceTags conf getTrimmedStrings YarnConfiguration RESOURCE_TYPES resourceName TAGS Set String resourceTagSet HashSet Collections addAll resourceTagSet resourceTags
resourceFile conf InputStream ris getConfInputStream resourceFile conf
List ResourceInformation configuration String prefix List ResourceInformation result ArrayList Map String String customResourcesMap configuration getValByRegex Pattern quote prefix YARN_IO_OPTIONAL String String resource customResourcesMap String resourceName resource getKey substring prefix length Matcher matcher RESOURCE_REQUEST_VALUE_PATTERN matcher resource getValue matcher String errorMsg resource getKey resource getValue
response solr query query Iterator SolrDocument list response getResults listIterator list SolrDocument d list next AppStoreEntry entry AppStoreEntry entry setId d get toString entry setOrg d get toString entry setName d get toString entry setDesc d get toString d get entry setIcon d get toString entry setLike Integer parseInt d get toString entry setDownload Integer parseInt d get toString apps add entry
query setFilterQueries query setRows QueryResponse response response solr query query Iterator SolrDocument appList response getResults listIterator appList SolrDocument d appList next AppEntry entry AppEntry entry setId d get toString entry setName d get toString entry setApp d get toString entry setYarnfile mapper readValue d get toString Service list add entry
entry setDownload Integer parseInt d get toString Service yarnApp mapper readValue d get toString Service String name Random r Random low high seed r nextInt high low low seed2 r nextInt high low low name RandomWord getNewWord seed toLowerCase RandomWord getNewWord seed2 toLowerCase name java util UUID randomUUID toString substring yarnApp setName name entry setApp yarnApp
SolrQuery query SolrQuery query setQuery id query setFilterQueries query setRows QueryResponse response response solr query query Iterator SolrDocument appList response getResults listIterator appList SolrDocument d appList next entry setId d get toString entry setApp d get toString entry setName d get toString entry setYarnfile mapper readValue d get toString Service
SolrClient solr getSolrClient ObjectMapper mapper ObjectMapper mapper configure DeserializationFeature FAIL_ON_UNKNOWN_PROPERTIES SolrInputDocument buffer SolrInputDocument buffer setField java util UUID randomUUID toString substring buffer setField app getOrganization buffer setField app getName buffer setField app getDescription app getIcon buffer setField app getIcon buffer setField buffer setField buffer setField String yarnFile mapper writeValueAsString app
SolrClient solr getSolrClient ObjectMapper mapper ObjectMapper mapper configure DeserializationFeature FAIL_ON_UNKNOWN_PROPERTIES SolrInputDocument buffer SolrInputDocument buffer setField java util UUID randomUUID toString substring buffer setField app getOrg buffer setField app getName buffer setField app getDesc app getIcon buffer setField app getIcon buffer setField buffer setField app getLike buffer setField app getDownload String yarnFile mapper writeValueAsString app
service String name service getName String app SolrQuery query SolrQuery query setQuery name query setFilterQueries query setRows QueryResponse response response solr query query Iterator SolrDocument appList response getResults listIterator appList SolrDocument d appList next app d get toString
sb append sb append sb append sb append temp String keytab System getenv keytab keytab keytab kerberos setPrincipalName sb toString kerberos setKeytab keytab app setKerberosPrincipal kerberos response asc getApiClient post ClientResponse mapper writeValueAsString app response getStatus String message response getEntity String RuntimeException response getStatus message
LOG info Map String String envs System getenv Map String String envs
log4jPath Log4jPropertyHelper updateLog4jConfiguration ApplicationMaster log4jPath e LOG warn e appName cliParser getOptionValue cliParser hasOption printUsage opts cliParser hasOption dumpOutDebugInfo homeDirectory cliParser hasOption Path cliParser getOptionValue Path System getenv ApplicationConstants Environment USER name cliParser hasOption String placementSpec cliParser getOptionValue String decodedSpec getDecodedPlacementSpec placementSpec
e LOG warn e appName cliParser getOptionValue cliParser hasOption printUsage opts cliParser hasOption dumpOutDebugInfo homeDirectory cliParser hasOption Path cliParser getOptionValue Path System getenv ApplicationConstants Environment USER name cliParser hasOption String placementSpec cliParser getOptionValue String decodedSpec getDecodedPlacementSpec placementSpec LOG info decodedSpec numTotalContainers globalNumOfContainers Integer parseInt cliParser getOptionValue
String String placementSpecifications Base64 Decoder decoder Base64 getDecoder decodedBytes decoder decode placementSpecifications getBytes StandardCharsets UTF_8 String decodedSpec String decodedBytes StandardCharsets UTF_8
LOG info Credentials credentials UserGroupInformation getCurrentUser getCredentials DataOutputBuffer dob DataOutputBuffer credentials writeTokenStorageToStream dob Iterator Token iter credentials getAllTokens iterator LOG info iter Token token iter next
publishApplicationAttemptEvent timelineClient appAttemptID toString DSEvent DS_APP_ATTEMPT_START domainId appSubmitterUgi appMasterHostname NetUtils getHostname Map Set String PlacementConstraint placementConstraintMap placementConstraintMap HashMap spec spec constraint Set String allocationTags Strings isNullOrEmpty spec sourceTag Collections emptySet Collections singleton spec sourceTag placementConstraintMap put allocationTags spec constraint RegisterApplicationMasterResponse response amRMClient registerApplicationMaster appMasterHostname appMasterRpcPort appMasterTrackingUrl placementConstraintMap resourceProfiles response getResourceProfiles ResourceUtils reinitializeResources response getResourceTypes maxMem response getMaximumResourceCapability getMemorySize LOG info maxMem
appMasterHostname NetUtils getHostname Map Set String PlacementConstraint placementConstraintMap placementConstraintMap HashMap spec spec constraint Set String allocationTags Strings isNullOrEmpty spec sourceTag Collections emptySet Collections singleton spec sourceTag placementConstraintMap put allocationTags spec constraint RegisterApplicationMasterResponse response amRMClient registerApplicationMaster appMasterHostname appMasterRpcPort appMasterTrackingUrl placementConstraintMap resourceProfiles response getResourceProfiles ResourceUtils reinitializeResources response getResourceTypes maxMem response getMaximumResourceCapability getMemorySize LOG info maxMem maxVCores response getMaximumResourceCapability getVirtualCores LOG info maxVCores
ContainerRequest Priority pri Priority newInstance requestPriority ContainerRequest request ContainerRequest getTaskResourceCapability pri ExecutionTypeRequest newInstance containerType enforceExecType containerResourceProfile
SchedulingRequest spec allocId allocIdCounter incrementAndGet SchedulingRequest sReq SchedulingRequest newInstance allocId Priority newInstance requestPriority ExecutionTypeRequest newInstance Collections singleton spec sourceTag ResourceSizing newInstance getTaskResourceCapability sReq setPlacementConstraint spec constraint
TimelineEntity entity TimelineEntity entity setEntityId container getId toString entity setEntityType DSEntity DS_CONTAINER toString entity setDomainId domainId entity addPrimaryFilter USER_TIMELINE_FILTER_NAME ugi getShortUserName entity addPrimaryFilter APPID_TIMELINE_FILTER_NAME container getId getApplicationAttemptId getApplicationId toString TimelineEvent event TimelineEvent event setTimestamp System currentTimeMillis event setEventType DSEvent DS_CONTAINER_START toString event addEventInfo container getNodeId toString event addEventInfo container getResource toString entity addEvent event processTimelineResponseErrors putContainerEntity timelineClient container getId getApplicationAttemptId entity
entity setEntityId container getContainerId toString entity setEntityType DSEntity DS_CONTAINER toString entity setDomainId domainId entity addPrimaryFilter USER_TIMELINE_FILTER_NAME ugi getShortUserName entity addPrimaryFilter APPID_TIMELINE_FILTER_NAME container getContainerId getApplicationAttemptId getApplicationId toString TimelineEvent event TimelineEvent event setTimestamp System currentTimeMillis event setEventType DSEvent DS_CONTAINER_END toString event addEventInfo container getState name event addEventInfo container getExitStatus event addEventInfo DIAGNOSTICS container getDiagnostics entity addEvent event processTimelineResponseErrors putContainerEntity timelineClient container getContainerId getApplicationAttemptId entity
org apache hadoop yarn api records timelineservice TimelineEntity entity org apache hadoop yarn api records timelineservice TimelineEntity entity setId containerId toString entity setType DSEntity DS_CONTAINER toString entity addInfo appSubmitterUgi getShortUserName org apache hadoop yarn api records timelineservice TimelineEvent event org apache hadoop yarn api records timelineservice TimelineEvent event setTimestamp System currentTimeMillis event setId DSEvent DS_CONTAINER_END toString event addInfo DIAGNOSTICS diagnostics entity addEvent event appSubmitterUgi timelineV2Client putEntitiesAsync entity
containerId diagnostics TimelineEntity entityV1 TimelineEntity entityV1 setEntityId containerId toString entityV1 setEntityType DSEntity DS_CONTAINER toString entityV1 setDomainId domainId entityV1 addPrimaryFilter USER_TIMELINE_FILTER_NAME appSubmitterUgi getShortUserName entityV1 addPrimaryFilter APPID_TIMELINE_FILTER_NAME containerId getApplicationAttemptId getApplicationId toString TimelineEvent eventV1 TimelineEvent eventV1 setTimestamp System currentTimeMillis eventV1 setEventType DSEvent DS_CONTAINER_END toString eventV1 addEventInfo DIAGNOSTICS diagnostics entityV1 addEvent eventV1 processTimelineResponseErrors putContainerEntity timelineClient containerId getApplicationAttemptId entityV1
appEvent entity setCreatedTime ts entity addInfo appSubmitterUgi getShortUserName org apache hadoop yarn api records timelineservice TimelineEvent event org apache hadoop yarn api records timelineservice TimelineEvent event setId appEvent toString event setTimestamp ts entity addEvent event entity setIdPrefix TimelineServiceHelper invertLong appAttemptID getAttemptId appSubmitterUgi timelineV2Client putEntitiesAsync entity
args result Client client Client LOG info doRun client init args doRun System exit e System err println e getLocalizedMessage client printUsage System exit result client run
LOG info yarnClient start YarnClusterMetrics clusterMetrics yarnClient getYarnClusterMetrics
LOG info yarnClient start YarnClusterMetrics clusterMetrics yarnClient getYarnClusterMetrics LOG info clusterMetrics getNumNodeManagers List NodeReport clusterNodeReports yarnClient getNodeReports NodeState RUNNING LOG info NodeReport clusterNodeReports
LOG info yarnClient start YarnClusterMetrics clusterMetrics yarnClient getYarnClusterMetrics LOG info clusterMetrics getNumNodeManagers List NodeReport clusterNodeReports yarnClient getNodeReports NodeState RUNNING LOG info NodeReport node clusterNodeReports LOG info node getNodeId node getHttpAddress node getRackName node getNumContainers QueueInfo queueInfo yarnClient getQueueInfo amQueue queueInfo IllegalArgumentException String format amQueue LOG info queueInfo getQueueName queueInfo getCurrentCapacity queueInfo getMaximumCapacity queueInfo getApplications size queueInfo getChildQueues size List QueueUserACLInfo listAclInfo yarnClient getQueueAclsInfo QueueUserACLInfo listAclInfo
prepareTimelineDomain Map String Resource profiles profiles yarnClient getResourceProfiles profiles List String appProfiles ArrayList appProfiles add amResourceProfile appProfiles add containerResourceProfile String appProfiles profiles String message LOG error message
appId Thread sleep LOG debug ApplicationReport report yarnClient getApplicationReport appId LOG info appId getId report getClientToAMToken report getDiagnostics report getHost report getQueue report getRpcPort report getStartTime report getYarnApplicationState toString report getFinalApplicationStatus toString report getTrackingUrl report getUser YarnApplicationState state report getYarnApplicationState FinalApplicationStatus dsStatus report getFinalApplicationStatus YarnApplicationState state FinalApplicationStatus dsStatus LOG info
Thread sleep LOG debug ApplicationReport report yarnClient getApplicationReport appId LOG info appId getId report getClientToAMToken report getDiagnostics report getHost report getQueue report getRpcPort report getStartTime report getYarnApplicationState toString report getFinalApplicationStatus toString report getTrackingUrl report getUser YarnApplicationState state report getYarnApplicationState FinalApplicationStatus dsStatus report getFinalApplicationStatus YarnApplicationState state FinalApplicationStatus dsStatus LOG info LOG info state toString dsStatus toString YarnApplicationState state YarnApplicationState state
fs String String fileDstPath String appId String relativePath ApplicationMaster getRelativePath appName appId fileDstPath Path dst Path fs getHomeDirectory relativePath
TimelineClient timelineClient conf timelineClient TimelineClient createTimelineClient timelineClient init conf timelineClient start LOG warn domainId TimelineDomain domain TimelineDomain domain setId domainId domain setReaders viewACLs viewACLs length viewACLs domain setWriters modifyACLs modifyACLs length modifyACLs timelineClient putDomain domain
conf timelineClient TimelineClient createTimelineClient timelineClient init conf timelineClient start LOG warn domainId TimelineDomain domain TimelineDomain domain setId domainId domain setReaders viewACLs viewACLs length viewACLs domain setWriters modifyACLs modifyACLs length modifyACLs timelineClient putDomain domain LOG info TimelineUtils dumpTimelineRecordtoJSON domain
run run
initializeNodeLabels NMContainerMonitor mon NMContainerMonitor Thread t Thread mon t start String args TestDistributedShell APPMASTER_JAR LOG info Client client Client Configuration distShellTest yarnCluster getConfig initSuccess client init args Assert assertTrue initSuccess LOG info result client run
NMContainerMonitor mon NMContainerMonitor Thread t Thread mon t start String args distShellTest APPMASTER_JAR distShellTest getSleepCommand LOG info Client client Client Configuration distShellTest yarnCluster getConfig initSuccess client init args Assert assertTrue initSuccess LOG info result client run
appId defaultFlow appReport LOG info String tmpRoot timelineV2StorageDir File separator File separator File tmpRootFolder File tmpRoot Assert assertTrue tmpRootFolder isDirectory String basePath tmpRoot YarnConfiguration DEFAULT_RM_CLUSTER_ID File separator UserGroupInformation getCurrentUser getShortUserName defaultFlow File separator appReport getName File separator TimelineUtils DEFAULT_FLOW_VERSION File separator appReport getStartTime File separator File separator File separator File separator File separator appId toString
File String basePath String entityType String String outputDirPathForEntity basePath File separator entityType File separator
String args APPMASTER_JAR getSleepCommand LOG info Client client Client TestDSFailedAppMaster getName Configuration yarnCluster getConfig client init args LOG info result client run
String args APPMASTER_JAR getSleepCommand LOG info Configuration conf yarnCluster getConfig conf setInt YarnConfiguration RM_AM_MAX_ATTEMPTS Client client Client TestDSSleepingAppMaster getName Configuration conf client init args LOG info result client run
String args APPMASTER_JAR getSleepCommand LOG info Configuration conf yarnCluster getConfig conf setInt YarnConfiguration RM_AM_MAX_ATTEMPTS Client client Client TestDSSleepingAppMaster getName Configuration conf client init args LOG info result client run
String args APPMASTER_JAR LOG info Client client Client Configuration yarnCluster getConfig initSuccess client init args Assert assertTrue initSuccess LOG info result client run
String args APPMASTER_JAR LOG info Client client Client Configuration yarnCluster getConfig initSuccess client init args Assert assertTrue initSuccess LOG info result client run
customShellScript customShellScript delete customShellScript Assert fail PrintWriter fileWriter PrintWriter customShellScript fileWriter write fileWriter close System out println customShellScript getAbsolutePath String args APPMASTER_JAR customShellScript getAbsolutePath LOG info Client client Client Configuration yarnCluster getConfig initSuccess client init args Assert assertTrue initSuccess LOG info result client run
String args APPMASTER_JAR Shell WINDOWS LOG info Client client Client ContainerLaunchFailAppMaster getName Configuration yarnCluster getConfig initSuccess client init args Assert assertTrue initSuccess LOG info result client run
appContext setApplicationName appName Priority pri Records newRecord Priority pri setPriority amPriority appContext setPriority pri appContext setQueue amQueue ContainerLaunchContext amContainer Records newRecord ContainerLaunchContext appContext setAMContainerSpec amContainer appContext setUnmanagedAM LOG info LOG info rmClient submitApplication appContext ApplicationReport appReport monitorApplication appId EnumSet of YarnApplicationState ACCEPTED YarnApplicationState KILLED YarnApplicationState FAILED YarnApplicationState FINISHED appReport YarnApplicationState ACCEPTED ApplicationAttemptReport attemptReport monitorCurrentAppAttempt appId YarnApplicationAttemptState LAUNCHED ApplicationAttemptId attemptId attemptReport getApplicationAttemptId
ContainerLaunchContext amContainer Records newRecord ContainerLaunchContext appContext setAMContainerSpec amContainer appContext setUnmanagedAM LOG info LOG info rmClient submitApplication appContext ApplicationReport appReport monitorApplication appId EnumSet of YarnApplicationState ACCEPTED YarnApplicationState KILLED YarnApplicationState FAILED YarnApplicationState FINISHED appReport getYarnApplicationState YarnApplicationState ACCEPTED ApplicationAttemptReport attemptReport monitorCurrentAppAttempt appId YarnApplicationAttemptState LAUNCHED ApplicationAttemptId attemptId attemptReport getApplicationAttemptId LOG info attemptId launchAM attemptId appReport monitorApplication appId EnumSet of YarnApplicationState KILLED YarnApplicationState FAILED YarnApplicationState FINISHED YarnApplicationState appState appReport getYarnApplicationState FinalApplicationStatus appStatus appReport getFinalApplicationStatus
ApplicationReport appReport monitorApplication appId EnumSet of YarnApplicationState ACCEPTED YarnApplicationState KILLED YarnApplicationState FAILED YarnApplicationState FINISHED appReport getYarnApplicationState YarnApplicationState ACCEPTED ApplicationAttemptReport attemptReport monitorCurrentAppAttempt appId YarnApplicationAttemptState LAUNCHED ApplicationAttemptId attemptId attemptReport getApplicationAttemptId LOG info attemptId launchAM attemptId appReport monitorApplication appId EnumSet of YarnApplicationState KILLED YarnApplicationState FAILED YarnApplicationState FINISHED YarnApplicationState appState appReport getYarnApplicationState FinalApplicationStatus appStatus appReport getFinalApplicationStatus LOG info appReport getYarnApplicationState appStatus success YarnApplicationState FINISHED appState FinalApplicationStatus appStatus LOG info success
attemptId attemptId rmClient getApplicationReport appId getCurrentApplicationAttemptId ApplicationAttemptReport attemptReport attemptId attemptReport rmClient getApplicationAttemptReport attemptId attemptState attemptReport getYarnApplicationAttemptState attemptReport LOG info appId attemptReport attemptReport getYarnApplicationAttemptState attemptState Thread sleep LOG warn appId attemptState String errmsg appId attemptState
foundAMCompletedTime StringBuilder expectedFinalState StringBuilder first state first first expectedFinalState append state name expectedFinalState append state name Thread sleep LOG debug ApplicationReport report rmClient getApplicationReport appId
LOG info conf setInt YarnConfiguration RM_SCHEDULER_MINIMUM_ALLOCATION_MB yarnCluster yarnCluster MiniYARNCluster TestUnmanagedAMLauncher getSimpleName yarnCluster init conf yarnCluster start Configuration yarnClusterConfig yarnCluster getConfig
LOG info conf setInt YarnConfiguration RM_SCHEDULER_MINIMUM_ALLOCATION_MB yarnCluster yarnCluster MiniYARNCluster TestUnmanagedAMLauncher getSimpleName yarnCluster init conf yarnCluster start Configuration yarnClusterConfig yarnCluster getConfig LOG info yarnClusterConfig get YarnConfiguration RM_ADDRESS
LOG info conf setInt YarnConfiguration RM_SCHEDULER_MINIMUM_ALLOCATION_MB yarnCluster yarnCluster MiniYARNCluster TestUnmanagedAMLauncher getSimpleName yarnCluster init conf yarnCluster start Configuration yarnClusterConfig yarnCluster getConfig LOG info yarnClusterConfig get YarnConfiguration RM_ADDRESS LOG info yarnClusterConfig get YarnConfiguration RM_WEBAPP_ADDRESS String webapp yarnClusterConfig get YarnConfiguration RM_WEBAPP_ADDRESS assertTrue webapp webapp startsWith
String webapp yarnClusterConfig get YarnConfiguration RM_WEBAPP_ADDRESS assertTrue webapp webapp startsWith LOG info webapp URL url Thread currentThread getContextClassLoader getResource url RuntimeException ByteArrayOutputStream bytesOut ByteArrayOutputStream yarnClusterConfig writeXml bytesOut bytesOut close OutputStream os FileOutputStream File url getPath os write bytesOut toByteArray os close Thread sleep
javaHome LOG error String args classpath javaHome TestUnmanagedAMLauncher getCanonicalName LOG info launcher launchAM attemptId YarnApplicationAttemptState attemptState rmClient getApplicationAttemptReport attemptId getYarnApplicationAttemptState Assert assertTrue attemptState equals YarnApplicationAttemptState LAUNCHED launchAM attemptId initSuccess launcher init args Assert assertTrue initSuccess LOG info result launcher run
conf useKerberos UserGroupInformation isSecurityEnabled List String rmServers getRMHAWebAddresses conf StringBuilder diagnosticsMsg StringBuilder String host rmServers Client client Client create client setFollowRedirects StringBuilder sb StringBuilder sb append scheme append host append path useKerberos String username UserGroupInformation getCurrentUser getShortUserName sb append append username
Client client Client create client setFollowRedirects StringBuilder sb StringBuilder sb append scheme append host append path String username UserGroupInformation getCurrentUser getShortUserName sb append append username e LOG debug e Builder builder client resource sb toString type MediaType APPLICATION_JSON String server host split String challenge YarnClientUtils generateToken server
String username UserGroupInformation getCurrentUser getShortUserName sb append append username e LOG debug e Builder builder client resource sb toString type MediaType APPLICATION_JSON String server host split String challenge YarnClientUtils generateToken server builder header HttpHeaders AUTHORIZATION challenge LOG debug challenge ClientResponse test builder get ClientResponse test scheme host
String username UserGroupInformation getCurrentUser getShortUserName sb append append username e LOG debug e Builder builder client resource sb toString type MediaType APPLICATION_JSON String server host split String challenge YarnClientUtils generateToken server builder header HttpHeaders AUTHORIZATION challenge LOG debug challenge ClientResponse test builder get ClientResponse test scheme host e
String output response LOG error EXIT_EXCEPTION_THROWN response LOG error EXIT_EXCEPTION_THROWN ServiceStatus ss response getEntity ServiceStatus output ss getDiagnostics output response getEntity String output output response getEntity String response
EXIT_EXCEPTION_THROWN response LOG error EXIT_EXCEPTION_THROWN ServiceStatus ss response getEntity ServiceStatus output ss getDiagnostics output response getEntity String output output response getEntity String response LOG info output EXIT_SUCCESS
examplesDirStr String yarnHome System getenv ApplicationConstants Environment HADOOP_YARN_HOME key examplesDirs String yarnHome yarnHome examplesDirs StringUtils split examplesDirStr String dir examplesDirs file File MessageFormat format dir fileName fileName file file File MessageFormat format dir fileName file file YarnException fileName Path filePath Path file getAbsolutePath
result EXIT_SUCCESS Service service Service service setName appName service setState ServiceState FLEX String String entry Component component Component component setName entry getKey Long numberOfContainers Long parseLong entry getValue component setNumberOfContainers numberOfContainers service addComponent component String buffer jsonSerDeser toJson service ClientResponse response getApiClient getServicePath appName put ClientResponse buffer result processResponse response
appName appIdOrName ServiceApiUtil validateNameFormat appName getConfig ClientResponse response getApiClient getServicePath appName get ClientResponse response getStatus StringBuilder sb StringBuilder sb append append appName append sb toString response getStatus StringBuilder sb StringBuilder sb append appName append append response getStatus sb toString output response getEntity String
Service service Service service setName appName String instance String componentName ServiceApiUtil parseComponentName instance Component component service getComponent componentName component component Component component setName componentName service addComponent component component addDecommissionedInstance instance String buffer jsonSerDeser toJson service ClientResponse response getApiClient getServicePath appName put ClientResponse buffer result processResponse response
conf String dirPath conf get YarnServiceConf YARN_SERVICES_SYSTEM_SERVICE_DIRECTORY dirPath systemServiceDir Path dirPath
conf String dirPath conf get YarnServiceConf YARN_SERVICES_SYSTEM_SERVICE_DIRECTORY dirPath systemServiceDir Path dirPath LOG info systemServiceDir fs systemServiceDir getFileSystem conf loginUGI UserGroupInformation isSecurityEnabled UserGroupInformation getLoginUser UserGroupInformation getCurrentUser
ServiceClient serviceClient UserGroupInformation userUgi getProxyUser user serviceClient createServiceClient userUgi service LOG info service userUgi launchServices userUgi serviceClient service e e getCause LOG warn e getCause getMessage String message service getName
UserGroupInformation userUgi getProxyUser user serviceClient createServiceClient userUgi service LOG info service userUgi launchServices userUgi serviceClient service e e getCause LOG warn e getCause getMessage String message service getName LOG error message e e LOG warn e
service serviceClient actionBuild service LOG info service getName service getVersion tryStart serviceClient actionBuild service
serviceClient actionBuild service LOG info service getName service getVersion tryStart serviceClient actionBuild service LOG info service getName tryStart
tryStart serviceClient actionBuild service e e e LOG info service getName tryStart LOG info service getName e tryStart serviceClient actionStartAndGetId service getName
LOG info systemServiceDir RemoteIterator FileStatus iterLaunchType list systemServiceDir iterLaunchType FileStatus launchType iterLaunchType next launchType LOG debug launchType getPath launchType getPath scanForUserServiceDefinition launchType getPath syncUserServices launchType getPath scanForUserServiceDefinition launchType getPath asyncUserServices badDirSkipCounter
userDirPath String LOG info userDirPath RemoteIterator FileStatus iterUsers list userDirPath iterUsers FileStatus userDir iterUsers next userDir LOG info userDir getPath getName String userName userDir getPath getName LOG info userName RemoteIterator FileStatus iterServices list userDir getPath iterServices FileStatus serviceCache iterServices next String filename serviceCache getPath getName serviceCache
iterUsers FileStatus userDir iterUsers next userDir LOG info userDir getPath getName String userName userDir getPath getName LOG info userName RemoteIterator FileStatus iterServices list userDir getPath iterServices FileStatus serviceCache iterServices next String filename serviceCache getPath getName serviceCache LOG info filename filename
filename LOG info filename badFileNameExtensionSkipCounter Service service getServiceDefinition serviceCache getPath service Set Service services userServices get userName services services HashSet userServices put userName services services service count ignoredUserServices containsKey userName ignoredUserServices get userName ignoredUserServices put userName count LOG warn service getName userName filename
Service Service service
String version VersionInfo getBuildVersion
request ServiceStatus serviceStatus ServiceStatus UserGroupInformation ugi getProxyUser request
ServiceClient sc getServiceClient sc init YARN_CONFIG sc start ApplicationId applicationId sc actionCreate service applicationId sc close serviceStatus setDiagnostics applicationId serviceStatus setState ACCEPTED serviceStatus setUri CONTEXT_ROOT SERVICE_ROOT_PATH service getName formatResponse Status ACCEPTED serviceStatus e serviceStatus setDiagnostics e getMessage
ApplicationId applicationId sc actionCreate service applicationId sc close serviceStatus setDiagnostics applicationId serviceStatus setState ACCEPTED serviceStatus setUri CONTEXT_ROOT SERVICE_ROOT_PATH service getName formatResponse Status ACCEPTED serviceStatus e serviceStatus setDiagnostics e getMessage formatResponse Status FORBIDDEN e getCause getMessage e formatResponse Status BAD_REQUEST e getMessage e
UserGroupInformation ugi getProxyUser request LOG info appName ugi Service app getServiceFromClient ugi appName Response ok app build e formatResponse Status FORBIDDEN e getMessage e serviceStatus setDiagnostics e getMessage serviceStatus setCode ERROR_CODE_APP_NAME_INVALID Response status Status NOT_FOUND entity serviceStatus build e serviceStatus setDiagnostics appName serviceStatus setCode ERROR_CODE_APP_NAME_INVALID Response status Status NOT_FOUND entity serviceStatus build e
Service app getServiceFromClient ugi appName Response ok app build e formatResponse Status FORBIDDEN e getMessage e serviceStatus setDiagnostics e getMessage serviceStatus setCode ERROR_CODE_APP_NAME_INVALID Response status Status NOT_FOUND entity serviceStatus build e serviceStatus setDiagnostics appName serviceStatus setCode ERROR_CODE_APP_NAME_INVALID Response status Status NOT_FOUND entity serviceStatus build e LOG error e formatResponse Status INTERNAL_SERVER_ERROR e getMessage
appName IllegalArgumentException UserGroupInformation ugi getProxyUser request LOG info appName ugi stopService appName ugi e formatResponse Status FORBIDDEN e getMessage IllegalArgumentException e formatResponse Status BAD_REQUEST e getMessage e LOG error e formatResponse Status BAD_REQUEST e getCause getMessage e formatResponse Status NOT_FOUND e getMessage e
appName destroy Exception result Exception result ServiceClient sc getServiceClient sc init YARN_CONFIG sc start Exception stopException result sc actionStop appName destroy result
ServiceClient sc getServiceClient sc init YARN_CONFIG sc start Exception stopException result sc actionStop appName destroy result LOG info appName Exception e LOG info e stopException e destroy result sc actionDestroy appName result
request UserGroupInformation ugi getProxyUser request
updateServiceData updateServiceData startService appName ugi updateServiceData updateServiceData updateServiceData updateServiceData upgradeService updateServiceData ugi updateServiceData updateServiceData cancelUpgradeService appName ugi updateServiceData updateServiceData updateLifetime appName updateServiceData ugi updateServiceData decommissionInstances updateServiceData ugi e formatResponse Status BAD_REQUEST e getCause getMessage e formatResponse Status FORBIDDEN e getMessage
updateServiceData updateServiceData updateServiceData updateServiceData upgradeService updateServiceData ugi updateServiceData updateServiceData cancelUpgradeService appName ugi updateServiceData updateServiceData updateLifetime appName updateServiceData ugi updateServiceData decommissionInstances updateServiceData ugi e formatResponse Status BAD_REQUEST e getCause getMessage e formatResponse Status FORBIDDEN e getMessage e String message appName
cancelUpgradeService appName ugi updateServiceData updateServiceData updateLifetime appName updateServiceData ugi updateServiceData decommissionInstances updateServiceData ugi e formatResponse Status BAD_REQUEST e getCause getMessage e formatResponse Status FORBIDDEN e getMessage e String message appName LOG error message e formatResponse Status NOT_FOUND e getMessage e
request UserGroupInformation ugi getProxyUser request
request UserGroupInformation ugi getProxyUser request
componentCountStrings put c getName c getNumberOfContainers toString Integer result Integer Integer result ServiceClient sc ServiceClient sc init YARN_CONFIG sc start result sc actionFlex appName componentCountStrings Integer valueOf result sc close result String message appName
service ServiceStatus status ServiceStatus ServiceClient sc getServiceClient sc init YARN_CONFIG sc start service sc actionUpgradeExpress service sc initiateUpgrade service sc close
instances addAll c getDecommissionedInstances Integer result Integer Integer result ServiceClient sc ServiceClient sc init YARN_CONFIG sc start result sc actionDecommissionInstances appName instances Integer valueOf result sc close result String message appName
bindAddress getConfig getSocketAddr API_SERVER_ADDRESS DEFAULT_API_SERVER_ADDRESS DEFAULT_API_SERVER_PORT
URI uri URI create NetUtils getHostPortString bindAddress apiServer HttpServer2 Builder setName setConf getConfig setSecurityEnabled UserGroupInformation isSecurityEnabled setUsernameConfKey RM_WEBAPP_SPNEGO_USER_NAME_KEY setKeytabConfKey RM_WEBAPP_SPNEGO_KEYTAB_FILE_KEY addEndpoint uri build String apiPackages ApiServer getPackage getName SEP GenericExceptionHandler getPackage getName SEP YarnJacksonJaxbJsonProvider getPackage getName apiServer addJerseyResourcePackage apiPackages logger info apiServer start
URI uri URI create NetUtils getHostPortString bindAddress apiServer HttpServer2 Builder setName setConf getConfig setSecurityEnabled UserGroupInformation isSecurityEnabled setUsernameConfKey RM_WEBAPP_SPNEGO_USER_NAME_KEY setKeytabConfKey RM_WEBAPP_SPNEGO_KEYTAB_FILE_KEY addEndpoint uri build String apiPackages ApiServer getPackage getName SEP GenericExceptionHandler getPackage getName SEP YarnJacksonJaxbJsonProvider getPackage getName apiServer addJerseyResourcePackage apiPackages logger info apiServer start logger info apiServer toString apiServer
URI uri URI create NetUtils getHostPortString bindAddress apiServer HttpServer2 Builder setName setConf getConfig setSecurityEnabled UserGroupInformation isSecurityEnabled setUsernameConfKey RM_WEBAPP_SPNEGO_USER_NAME_KEY setKeytabConfKey RM_WEBAPP_SPNEGO_KEYTAB_FILE_KEY addEndpoint uri build String apiPackages ApiServer getPackage getName SEP GenericExceptionHandler getPackage getName SEP YarnJacksonJaxbJsonProvider getPackage getName apiServer addJerseyResourcePackage apiPackages logger info apiServer start logger info apiServer toString conf apiServer getWebAppContext logger info conf logger info Collections singletonList apiServer getWebAppContext getContextPath logger info Collections singletonList apiServer getWebAppContext getResourceBase logger info Collections singletonList apiServer getWebAppContext getWar
component ComponentEvent event ComponentEvent component getName FLEX setDesired component getNumberOfContainers context scheduler getDispatcher getEventHandler handle event
containerId ComponentInstanceEvent event ComponentInstanceEvent ContainerId fromString containerId ComponentInstanceEventType UPGRADE
String instance String componentName ServiceApiUtil parseComponentName instance ComponentEvent event ComponentEvent componentName DECOMMISSION_INSTANCE setInstanceName instance context scheduler getDispatcher getEventHandler handle event
failureCountPerNode clear context scheduler getAmRMClient updateBlacklist ArrayList blackListedNodes
cancelUpgrade componentsToUpgrade org apache hadoop yarn service api records Component component componentsToUpgrade get component container ComponentInstanceEvent upgradeEvent ComponentInstanceEvent ContainerId fromString container getId cancelUpgrade ComponentInstanceEventType UPGRADE ComponentInstanceEventType CANCEL_UPGRADE
cancelUpgrade component ComponentEvent needUpgradeEvent ComponentEvent component getName cancelUpgrade ComponentEventType UPGRADE ComponentEventType CANCEL_UPGRADE setTargetSpec component setUpgradeVersion upgradeVersion
Service targetSpec ServiceApiUtil loadServiceUpgrade fs getName upgradeVersion targetSpec setId serviceSpec getId targetSpec setState ServiceState STABLE Map String Component allComps scheduler getAllComponents targetSpec compSpec Component comp allComps get compSpec getName compSpec setState comp getComponentSpec getState jsonSerDeser save fs getFileSystem ServiceApiUtil getServiceJsonPath fs getName targetSpec e LOG error e String upgradeVersionToDel cancelUpgrade cancelledVersion upgradeVersion
Map String Component allComps scheduler getAllComponents targetSpec compSpec Component comp allComps get compSpec getName compSpec setState comp getComponentSpec getState jsonSerDeser save fs getFileSystem ServiceApiUtil getServiceJsonPath fs getName targetSpec e LOG error e String upgradeVersionToDel cancelUpgrade cancelledVersion upgradeVersion LOG info upgradeVersionToDel fs deleteClusterUpgradeDir getName upgradeVersionToDel String comp String compDirVersionToDel cancelUpgrade cancelledVersion serviceSpec getVersion
List org apache hadoop yarn service api records Component sourceSpec targetSpec List org apache hadoop yarn service api records Component compsNeedUpgradeList componentsFinder findTargetComponentSpecs sourceSpec targetSpec compsNeedUpgradeList compsNeedUpgradeList component org apache hadoop yarn service api records Component RestartPolicyEnum restartPolicy component getRestartPolicy ComponentRestartPolicy restartPolicyHandler Component getRestartPolicyHandler restartPolicy restartPolicyHandler
org apache hadoop yarn service api records ServiceState state org apache hadoop yarn service api records ServiceState curState serviceSpec getState curState state serviceSpec setState state
UserGroupInformation credentials UserGroupInformation getCurrentUser getCredentials doSecureLogin SliderFileSystem fs SliderFileSystem conf fs setAppDir appDir context fs fs loadApplicationJson context fs UserGroupInformation credentials UserGroupInformation getCurrentUser addCredentials credentials removeHdfsDelegationToken UserGroupInformation getLoginUser entry context conf set entry getKey entry getValue ContainerId amContainerId getAMContainerId ApplicationAttemptId attemptId amContainerId getApplicationAttemptId
Credentials copy Credentials UserGroupInformation getCurrentUser getCredentials Iterator Token iter copy getAllTokens iterator iter Token token iter next
File keytab File String format KEYTAB_LOCATION getServiceName keytab
File keytab File String format KEYTAB_LOCATION getServiceName keytab LOG info keytab String preInstalledKeytab context service serviceKeytab context service getKerberosPrincipal getKeytab preInstalledKeytab URI uri URI preInstalledKeytab uri keytab File uri
File keytab File String format KEYTAB_LOCATION getServiceName keytab LOG info keytab String preInstalledKeytab context service serviceKeytab context service getKerberosPrincipal getKeytab preInstalledKeytab URI uri URI preInstalledKeytab uri keytab File uri LOG info preInstalledKeytab keytab LOG info keytab String principal context service servicePrincipalName context service getKerberosPrincipal getPrincipalName principal principal UserGroupInformation getLoginUser getShortUserName
preInstalledKeytab URI uri URI preInstalledKeytab uri keytab File uri LOG info preInstalledKeytab keytab LOG info keytab String principal context service servicePrincipalName context service getKerberosPrincipal getPrincipalName principal principal UserGroupInformation getLoginUser getShortUserName LOG info principal LOG info UserGroupInformation getCurrentUser String principalName SecurityUtil getServerPrincipal principal ServiceUtils getLocalHostName getConfig UserGroupInformation loginUserFromKeytab principalName keytab getAbsolutePath
opts addOption YARNFILE_OPTION opts getOption YARNFILE_OPTION setRequired opts addOption SERVICE_NAME_OPTION opts getOption SERVICE_NAME_OPTION setRequired opts addOption KEYTAB_OPTION opts addOption PRINCIPAL_NAME_OPTION GenericOptionsParser parser GenericOptionsParser conf opts args CommandLine cmdLine parser getCommandLine serviceMaster serviceDefPath cmdLine getOptionValue YARNFILE_OPTION serviceMaster serviceName cmdLine getOptionValue SERVICE_NAME_OPTION serviceMaster serviceKeytab cmdLine getOptionValue KEYTAB_OPTION serviceMaster servicePrincipalName cmdLine getOptionValue PRINCIPAL_NAME_OPTION serviceMaster init conf serviceMaster start
context Configuration app context service executorService Executors newScheduledThreadPool RegistryOperations registryClient context principal context Configuration conf getConfig String username HadoopKerberosName context principal trim getServiceName
LOG info executorService executorService shutdownNow DefaultMetricsSystem shutdown Map ContainerId ComponentInstance liveInst getLiveInstances Map ContainerId ComponentInstance instance liveInst ComponentInstance instance getValue getContainerSpec getState LOG info instance getValue getCompInstanceName instance getValue getContainerSpec getState ContainerState STOPPED serviceTimelinePublisher componentInstanceFinished instance getKey KILLED_AFTER_APP_COMPLETION ContainerState STOPPED getDiagnostics toString LOG info finalApplicationStatus serviceTimelinePublisher serviceAttemptUnregistered context finalApplicationStatus diagnostics toString amRMClient unregisterApplicationMaster finalApplicationStatus diagnostics toString
response List Container containersFromPrevAttempt response getContainersFromPreviousAttempts
response List Container containersFromPrevAttempt response getContainersFromPreviousAttempts LOG info containersFromPrevAttempt size Map String ServiceRecord existingRecords HashMap List String existingComps existingComps yarnRegistryOperations listComponents
Map String ServiceRecord existingRecords HashMap List String existingComps existingComps yarnRegistryOperations listComponents LOG info existingComps size existingComps e LOG info e getMessage existingComps String existingComp existingComps ServiceRecord record yarnRegistryOperations getComponent existingComp existingRecords put existingComp record e LOG warn existingComp e
LOG info e getMessage existingComp ServiceRecord record yarnRegistryOperations getComponent existingComp existingRecords put existingComp record e LOG warn existingComp e container LOG info container getId ServiceRecord record existingRecords remove RegistryPathUtils encodeYarnID container getId toString record Component comp componentsById get container getAllocationRequestId ComponentEvent event ComponentEvent comp getName CONTAINER_RECOVERED setContainer container setInstance comp getComponentInstance record description comp handle event
ComponentEvent event ComponentEvent comp getName CONTAINER_RECOVERED setContainer container setInstance comp getComponentInstance record description comp handle event LOG info container getId amRMClient releaseAssignedContainer container getId ApplicationId appId ApplicationId fromString app getId record String componentName record get YarnRegistryAttributes YARN_COMPONENT componentName Component component componentsByName get componentName component ComponentInstance compInstance component getComponentInstance record description ContainerId containerId ContainerId fromString record get YarnRegistryAttributes YARN_ID containerId appId unRecoveredInstances put containerId compInstance
attemptId service LOG info attemptId service getName ServiceRecord serviceRecord ServiceRecord serviceRecord set YarnRegistryAttributes YARN_ID attemptId getApplicationId toString serviceRecord set YarnRegistryAttributes YARN_PERSISTENCE PersistencePolicies APPLICATION serviceRecord description yarnRegistryOperations registerSelf serviceRecord
attemptId service LOG info attemptId service getName ServiceRecord serviceRecord ServiceRecord serviceRecord set YarnRegistryAttributes YARN_ID attemptId getApplicationId toString serviceRecord set YarnRegistryAttributes YARN_PERSISTENCE PersistencePolicies APPLICATION serviceRecord description yarnRegistryOperations registerSelf serviceRecord LOG info yarnRegistryOperations getSelfRegistrationPath yarnRegistryOperations getAbsoluteSelfRegistrationPath isFirstAttempt attemptId getAttemptId isFirstAttempt yarnRegistryOperations deleteChildren yarnRegistryOperations getSelfRegistrationPath
component shouldTerminate componentIsDominant component getComponentSpec getConfiguration getPropertyBool CONTAINER_STATE_REPORT_AS_SERVICE_STATE componentIsDominant ComponentRestartPolicy restartPolicy component getRestartPolicyHandler restartPolicy shouldTerminate component shouldTerminate isSucceeded restartPolicy hasCompletedSuccessfully component org apache hadoop yarn service api records ComponentState state isSucceeded org apache hadoop yarn service api records ComponentState SUCCEEDED org apache hadoop yarn service api records ComponentState FAILED
component shouldTerminate componentIsDominant component getComponentSpec getConfiguration getPropertyBool CONTAINER_STATE_REPORT_AS_SERVICE_STATE componentIsDominant ComponentRestartPolicy restartPolicy component getRestartPolicyHandler restartPolicy shouldTerminate component shouldTerminate isSucceeded restartPolicy hasCompletedSuccessfully component org apache hadoop yarn service api records ComponentState state isSucceeded org apache hadoop yarn service api records ComponentState SUCCEEDED org apache hadoop yarn service api records ComponentState FAILED LOG info component getName component getComponentSpec getState state component getComponentSpec setState state
shouldTerminate Set String succeededComponents HashSet Set String failedComponents HashSet comp ComponentRestartPolicy restartPolicy comp getRestartPolicyHandler restartPolicy shouldTerminate comp restartPolicy comp
comp getComponentSpec setState org apache hadoop yarn service api records ComponentState SUCCEEDED LOG info comp getName comp getComponentSpec getState org apache hadoop yarn service api records ComponentState FAILED comp getComponentSpec setState org apache hadoop yarn service api records ComponentState FAILED serviceTimelinePublisher componentFinished comp getComponentSpec comp getComponentSpec getState systemClock getTime shouldTerminate nFailed comp getNumFailedInstances nFailed failedComponents add comp getName succeededComponents add comp getName shouldTerminate
examplesDirStr String yarnHome System getenv ApplicationConstants Environment HADOOP_YARN_HOME key examplesDirs String yarnHome yarnHome examplesDirs StringUtils split examplesDirStr String dir examplesDirs file File MessageFormat format dir fileName fileName file file File MessageFormat format dir fileName file file YarnException fileName Path filePath Path file getAbsolutePath
YarnException ErrorStrings SERVICE_UPGRADE_DISABLED Service persistedService ServiceApiUtil loadService fs service getName persistedService getId cachedAppInfo put persistedService getName AppInfo ApplicationId fromString persistedService getId persistedService getKerberosPrincipal getPrincipalName persistedService getVersion service getVersion String message service getName service getVersion LOG error message YarnException message foundNotNeverComp Component persistedService Component RestartPolicyEnum NEVER foundNotNeverComp foundNotNeverComp String message service getName Component RestartPolicyEnum NEVER
getVersion service getVersion String message service getName service getVersion LOG error message YarnException message foundNotNeverComp Component Component RestartPolicyEnum NEVER foundNotNeverComp foundNotNeverComp String message service getName Component RestartPolicyEnum NEVER LOG error message YarnException message Service liveService getStatus service getName liveService
persistedService getId YarnException persistedService getName cachedAppInfo put persistedService getName AppInfo ApplicationId fromString persistedService getId persistedService getKerberosPrincipal getPrincipalName String instance String componentName ServiceApiUtil parseComponentName ServiceApiUtil parseAndValidateComponentInstanceName instance appName getConfig Component component persistedService getComponent componentName component IllegalArgumentException instance component instance component addDecommissionedInstance instance component setNumberOfContainers Math max component getNumberOfContainers ServiceApiUtil writeAppDefinition fs persistedService ApplicationReport appReport yarnClient getApplicationReport ApplicationId fromString persistedService getId appReport getYarnApplicationState String message persistedService getName appReport getYarnApplicationState
service ApplicationReport appReport yarnClient getApplicationReport getAppId service getName appReport getYarnApplicationState String message service getName appReport getYarnApplicationState
FlexComponentsRequestProto Builder requestBuilder FlexComponentsRequestProto newBuilder persistedComp persistedService String name persistedComp getName componentCounts persistedComp getName original put name persistedComp getNumberOfContainers persistedComp setNumberOfContainers componentCounts get name countBuilder setName persistedComp getName setNumberOfContainers persistedComp getNumberOfContainers requestBuilder addComponents countBuilder build original componentCounts componentCounts keySet removeAll original keySet YarnException componentCounts keySet ServiceApiUtil writeAppDefinition fs persistedService ApplicationId appId getAppId serviceName appId String message serviceName
persistedComp setNumberOfContainers componentCounts get name countBuilder setName persistedComp getName setNumberOfContainers persistedComp getNumberOfContainers requestBuilder addComponents countBuilder build original componentCounts componentCounts keySet removeAll original keySet YarnException componentCounts keySet ServiceApiUtil writeAppDefinition fs persistedService ApplicationId appId getAppId serviceName appId String message serviceName LOG error message YarnException message ApplicationReport appReport yarnClient getApplicationReport appId appReport getYarnApplicationState String message serviceName appReport getYarnApplicationState
original componentCounts componentCounts keySet removeAll original keySet YarnException componentCounts keySet ServiceApiUtil writeAppDefinition fs persistedService ApplicationId appId getAppId serviceName appId String message serviceName LOG error message YarnException message ApplicationReport appReport yarnClient getApplicationReport appId appReport getYarnApplicationState String message serviceName appReport getYarnApplicationState LOG error message YarnException message Service liveService getStatus serviceName
serviceName ServiceApiUtil validateNameFormat serviceName getConfig ApplicationId currentAppId getAppId serviceName currentAppId
String serviceName ServiceApiUtil validateNameFormat serviceName getConfig ApplicationId currentAppId getAppId serviceName currentAppId LOG info serviceName cleanUpRegistry serviceName EXIT_COMMAND_ARGUMENT_ERROR ApplicationReport report yarnClient getApplicationReport currentAppId report getYarnApplicationState LOG info serviceName report getYarnApplicationState cleanUpRegistry serviceName EXIT_COMMAND_ARGUMENT_ERROR report getYarnApplicationState String msg serviceName report getYarnApplicationState yarnClient killApplication currentAppId msg
EXIT_COMMAND_ARGUMENT_ERROR report getYarnApplicationState String msg serviceName report getYarnApplicationState yarnClient killApplication currentAppId msg LOG info msg cleanUpRegistry serviceName EXIT_SUCCESS report YarnException serviceName LOG info serviceName currentAppId ClientAMProtocol proxy createAMProxy serviceName report cachedAppInfo remove serviceName proxy StopRequestProto request StopRequestProto newBuilder build
String msg serviceName report getYarnApplicationState yarnClient killApplication currentAppId msg LOG info msg cleanUpRegistry serviceName EXIT_SUCCESS report YarnException serviceName LOG info serviceName currentAppId ClientAMProtocol proxy createAMProxy serviceName report cachedAppInfo remove serviceName proxy StopRequestProto request StopRequestProto newBuilder build proxy stop request LOG info serviceName
cachedAppInfo remove serviceName proxy StopRequestProto request StopRequestProto newBuilder build proxy stop request LOG info serviceName yarnClient killApplication currentAppId serviceName LOG info serviceName cleanUpRegistry serviceName EXIT_SUCCESS cleanUpRegistry serviceName EXIT_SUCCESS startTime System currentTimeMillis pollCount
proxy stop request LOG info serviceName yarnClient killApplication currentAppId serviceName LOG info serviceName cleanUpRegistry serviceName EXIT_SUCCESS cleanUpRegistry serviceName EXIT_SUCCESS startTime System currentTimeMillis pollCount Thread sleep report yarnClient getApplicationReport currentAppId
yarnClient killApplication currentAppId serviceName LOG info serviceName cleanUpRegistry serviceName EXIT_SUCCESS cleanUpRegistry serviceName EXIT_SUCCESS startTime System currentTimeMillis pollCount Thread sleep report yarnClient getApplicationReport currentAppId report LOG info serviceName
cleanUpRegistry serviceName EXIT_SUCCESS cleanUpRegistry serviceName EXIT_SUCCESS startTime System currentTimeMillis pollCount Thread sleep report yarnClient getApplicationReport currentAppId report LOG info serviceName System currentTimeMillis startTime LOG info serviceName
serviceName ServiceApiUtil validateNameFormat serviceName getConfig verifyNoLiveAppInRM serviceName Path appDir fs buildClusterDirPath serviceName FileSystem fileSystem fs getFileSystem cachedAppInfo remove serviceName ret EXIT_SUCCESS fileSystem appDir fileSystem appDir
String serviceName YarnException ServiceApiUtil validateNameFormat serviceName getConfig verifyNoLiveAppInRM serviceName Path appDir fs buildClusterDirPath serviceName FileSystem fileSystem fs getFileSystem cachedAppInfo remove serviceName ret EXIT_SUCCESS fileSystem appDir fileSystem appDir LOG info serviceName appDir String message serviceName appDir LOG info message YarnException message
cachedAppInfo remove serviceName ret EXIT_SUCCESS appDir appDir LOG info serviceName appDir String message serviceName appDir LOG info message YarnException message LOG info serviceName appDir ret EXIT_NOT_FOUND Path publicResourceDir Path fs getBasePath serviceName publicResourceDir publicResourceDir
appDir LOG info serviceName appDir String message serviceName appDir LOG info message YarnException message LOG info serviceName appDir ret EXIT_NOT_FOUND Path publicResourceDir Path fs getBasePath serviceName publicResourceDir publicResourceDir LOG info serviceName publicResourceDir String message serviceName publicResourceDir
LOG info serviceName appDir ret EXIT_NOT_FOUND Path publicResourceDir Path fs getBasePath serviceName publicResourceDir publicResourceDir LOG info serviceName publicResourceDir String message serviceName publicResourceDir LOG info message YarnException message deleteZKNode serviceName e IOException serviceName e serviceName
Path publicResourceDir Path fs getBasePath serviceName publicResourceDir publicResourceDir LOG info serviceName publicResourceDir String message serviceName publicResourceDir LOG info message YarnException message deleteZKNode serviceName e IOException serviceName e serviceName ret ret EXIT_OTHER_FAILURE
LOG info serviceName publicResourceDir String message serviceName publicResourceDir LOG info message YarnException message deleteZKNode serviceName e IOException serviceName e serviceName ret ret EXIT_OTHER_FAILURE ret LOG info serviceName ret
String serviceName CuratorFramework curatorFramework getCuratorClient String user RegistryUtils currentUser String zkPath ServiceRegistryUtils mkServiceHomePath user serviceName curatorFramework forPath zkPath curatorFramework delete deletingChildrenIfNeeded forPath zkPath
Path serviceName localResources Path libPath fs buildClusterDirPath serviceName ProviderUtils addProviderJar localResources ServiceMaster SERVICE_CORE_JAR fs libPath Path dependencyLibTarGzip fs getDependencyTarGzip
ApplicationId serviceName ServiceApiUtil validateNameFormat serviceName getConfig Service liveService getStatus serviceName liveService liveService Path appDir checkAppExistOnHdfs serviceName Service service ServiceApiUtil loadService fs serviceName ServiceApiUtil validateAndResolveService service fs getConfig verifyNoLiveAppInRM serviceName ApplicationId appId submitApp service cachedAppInfo put serviceName AppInfo appId service getKerberosPrincipal getPrincipalName service setId appId toString Path appJson ServiceApiUtil writeAppDefinition fs appDir service
ApplicationId serviceName ServiceApiUtil validateNameFormat serviceName getConfig Service liveService getStatus serviceName liveService liveService Path appDir checkAppExistOnHdfs serviceName Service service ServiceApiUtil loadService fs serviceName ServiceApiUtil validateAndResolveService service fs getConfig verifyNoLiveAppInRM serviceName ApplicationId appId submitApp service cachedAppInfo put serviceName AppInfo appId service getKerberosPrincipal getPrincipalName service setId appId toString Path appJson ServiceApiUtil writeAppDefinition fs appDir service LOG info service getName appJson appId
String principalName service getKerberosPrincipal getPrincipalName principalName LOG warn service getName service getKerberosPrincipal getKeytab LOG warn service getName URI keytabURI keytabURI URI service getKerberosPrincipal getKeytab e YarnException e keytabURI
service getKerberosPrincipal getKeytab LOG warn service getName URI keytabURI keytabURI URI service getKerberosPrincipal getKeytab e YarnException e keytabURI LOG info keytabURI Path keytabPath Path keytabURI keytabPath LOG warn service getName principalName keytabPath
Service serviceName ServiceApiUtil validateNameFormat serviceName getConfig Service appSpec Service appSpec setName serviceName appSpec setState ServiceState STOPPED ApplicationId currentAppId getAppId serviceName currentAppId
appSpec setId currentAppId toString ApplicationReport appReport appReport yarnClient getApplicationReport currentAppId LOG info currentAppId appSpec appReport LOG warn currentAppId appSpec appSpec setState convertState appReport getYarnApplicationState ApplicationTimeout lifetime appReport getApplicationTimeouts get ApplicationTimeoutType LIFETIME lifetime appSpec setLifetime lifetime getRemainingTime appReport getYarnApplicationState
String String currentUser RegistryUtils currentUser
dependencyLibTarGzip fs getDependencyTarGzip dependencyLibTarGzip Path destinationFolder YarnServiceConstants DEPENDENCY_TAR_GZ_FILE_NAME YarnServiceConstants DEPENDENCY_TAR_GZ_FILE_EXT fs dependencyLibTarGzip System out println String format dependencyLibTarGzip toUri EXIT_SUCCESS String libDirs ServiceUtils getLibDirs libDirs File tempLibTarGzipFile dependencyLibTarGzip EXIT_UNAUTHORIZED tempLibTarGzipFile File createTempFile YarnServiceConstants DEPENDENCY_TAR_GZ_FILE_NAME YarnServiceConstants DEPENDENCY_TAR_GZ_FILE_EXT tarGzipFolder libDirs tempLibTarGzipFile createJarFilter fs copyLocalFileToHdfs tempLibTarGzipFile dependencyLibTarGzip FsPermission YarnServiceConstants DEPENDENCY_DIR_PERMISSIONS
AccessControlList yarnAdminAcl AccessControlList getConfig get YarnConfiguration YARN_ADMIN_ACL YarnConfiguration DEFAULT_YARN_ADMIN_ACL AccessControlList dfsAdminAcl AccessControlList getConfig get DFSConfigKeys DFS_ADMIN UserGroupInformation ugi UserGroupInformation getCurrentUser yarnAdminAcl ugi dfsAdminAcl ugi
healthThresholdPercent YarnServiceConf getInt CONTAINER_HEALTH_THRESHOLD_PERCENT DEFAULT_CONTAINER_HEALTH_THRESHOLD_PERCENT componentSpec getConfiguration scheduler getConfig healthThresholdPercent
healthThresholdPercent YarnServiceConf getInt CONTAINER_HEALTH_THRESHOLD_PERCENT DEFAULT_CONTAINER_HEALTH_THRESHOLD_PERCENT componentSpec getConfiguration scheduler getConfig healthThresholdPercent LOG info componentSpec getName healthThresholdPercent healthThresholdPercent LOG error healthThresholdPercent componentSpec getName window YarnServiceConf getLong CONTAINER_HEALTH_THRESHOLD_WINDOW_SEC DEFAULT_CONTAINER_HEALTH_THRESHOLD_WINDOW_SEC componentSpec getConfiguration scheduler getConfig initDelay YarnServiceConf getLong CONTAINER_HEALTH_THRESHOLD_INIT_DELAY_SEC DEFAULT_CONTAINER_HEALTH_THRESHOLD_INIT_DELAY_SEC componentSpec getConfiguration scheduler getConfig pollFrequency YarnServiceConf getLong CONTAINER_HEALTH_THRESHOLD_POLL_FREQUENCY_SEC DEFAULT_CONTAINER_HEALTH_THRESHOLD_POLL_FREQUENCY_SEC componentSpec getConfiguration scheduler getConfig window LOG error window componentSpec getName initDelay
LOG info componentSpec getName healthThresholdPercent healthThresholdPercent LOG error healthThresholdPercent componentSpec getName window YarnServiceConf getLong CONTAINER_HEALTH_THRESHOLD_WINDOW_SEC DEFAULT_CONTAINER_HEALTH_THRESHOLD_WINDOW_SEC componentSpec getConfiguration scheduler getConfig initDelay YarnServiceConf getLong CONTAINER_HEALTH_THRESHOLD_INIT_DELAY_SEC DEFAULT_CONTAINER_HEALTH_THRESHOLD_INIT_DELAY_SEC componentSpec getConfiguration scheduler getConfig pollFrequency YarnServiceConf getLong CONTAINER_HEALTH_THRESHOLD_POLL_FREQUENCY_SEC DEFAULT_CONTAINER_HEALTH_THRESHOLD_POLL_FREQUENCY_SEC componentSpec getConfiguration scheduler getConfig window LOG error window componentSpec getName initDelay LOG error initDelay componentSpec getName pollFrequency
healthThresholdPercent healthThresholdPercent LOG error healthThresholdPercent componentSpec getName window YarnServiceConf getLong CONTAINER_HEALTH_THRESHOLD_WINDOW_SEC DEFAULT_CONTAINER_HEALTH_THRESHOLD_WINDOW_SEC componentSpec getConfiguration scheduler getConfig initDelay YarnServiceConf getLong CONTAINER_HEALTH_THRESHOLD_INIT_DELAY_SEC DEFAULT_CONTAINER_HEALTH_THRESHOLD_INIT_DELAY_SEC componentSpec getConfiguration scheduler getConfig pollFrequency YarnServiceConf getLong CONTAINER_HEALTH_THRESHOLD_POLL_FREQUENCY_SEC DEFAULT_CONTAINER_HEALTH_THRESHOLD_POLL_FREQUENCY_SEC componentSpec getConfiguration scheduler getConfig window LOG error window componentSpec getName initDelay LOG error initDelay componentSpec getName pollFrequency LOG error pollFrequency componentSpec getName
LOG info componentSpec getName count org apache hadoop yarn service api records Resource componentResource componentSpec getResource Resource resource Resource newInstance componentResource calcMemoryMB componentResource getCpus componentResource String ResourceInformation entry componentResource String resourceName entry getKey resourceName org apache hadoop yarn api records ResourceInformation resourceName org apache hadoop yarn api records ResourceInformation LOG warn resourceName ResourceInformation specInfo entry getValue org apache hadoop yarn api records ResourceInformation ri org apache hadoop yarn api records ResourceInformation newInstance entry getKey specInfo getUnit specInfo getValue specInfo getTags specInfo getAttributes resource setResourceInformation resourceName ri count ContainerRequest request ContainerRequest newBuilder capability resource priority priority allocationRequestId allocateId relaxLocality build
org apache hadoop yarn service api records ComponentState state org apache hadoop yarn service api records ComponentState curState componentSpec getState curState state componentSpec setState state
compInstance event failureBeforeLaunch Component comp compInstance getComponent hasContainerFailed failureBeforeLaunch hasContainerFailed event getStatus ComponentRestartPolicy restartPolicy comp getRestartPolicyHandler ContainerState containerState hasContainerFailed ContainerState FAILED ContainerState SUCCEEDED compInstance getContainerSpec compInstance getContainerSpec setState containerState restartPolicy compInstance event getStatus comp requestContainers comp reInsertPendingInstance compInstance StringBuilder builder StringBuilder builder append compInstance getCompInstanceId append append event getContainerId append append append System lineSeparator append append failureBeforeLaunch event getStatus event getStatus getExitStatus append append failureBeforeLaunch FAILED_BEFORE_LAUNCH_DIAG event getStatus event getStatus getDiagnostics UPGRADE_FAILED event getStatus event getStatus getExitStatus LOG error builder toString
hasContainerFailed failureBeforeLaunch hasContainerFailed event getStatus ComponentRestartPolicy restartPolicy comp getRestartPolicyHandler ContainerState containerState hasContainerFailed ContainerState FAILED ContainerState SUCCEEDED compInstance getContainerSpec compInstance getContainerSpec setState containerState restartPolicy compInstance event getStatus comp requestContainers comp reInsertPendingInstance compInstance StringBuilder builder StringBuilder builder append compInstance getCompInstanceId append append event getContainerId append append append System lineSeparator append append failureBeforeLaunch event getStatus event getStatus getExitStatus append append failureBeforeLaunch FAILED_BEFORE_LAUNCH_DIAG event getStatus event getStatus getDiagnostics UPGRADE_FAILED event getStatus event getStatus getExitStatus LOG error builder toString LOG info builder toString compInstance
LOG error builder toString LOG info builder toString compInstance LOG info event getContainerId containerState exitStatus failureBeforeLaunch event getStatus ContainerExitStatus INVALID event getStatus getExitStatus compInstance serviceTimelinePublisher componentInstanceFinished event getContainerId exitStatus containerState containerDiag comp markAsFailed compInstance comp markAsSucceeded compInstance compInstance exitStatus failureBeforeLaunch event getStatus ContainerExitStatus INVALID event getStatus getExitStatus compInstance serviceTimelinePublisher componentInstanceFinished event getContainerId exitStatus containerState containerDiag
ContainerState state writeLock lock ContainerState curState containerSpec getState curState state containerSpec setState state
doRegistryUpdate ObjectMapper mapper ObjectMapper Map String List Map String String ports ports mapper status Map String List Map String String container setExposedPorts ports e LOG warn e setContainerStatus status getContainerId status containerRec doRegistryUpdate serviceTimelinePublisher componentInstanceIPHostUpdated containerRec doRegistryUpdate cleanupRegistry status getContainerId
containerId cleanupRegistry containerId compInstanceDir fs compInstanceDir deleted fs delete compInstanceDir deleted
String cmdStr ServiceUtils join commands
String cmdStr ServiceUtils join commands log debug cmdStr containerLaunchContext setCommands commands log log debug String String
log log debug localResources size String LocalResource entry localResources String key entry getKey LocalResource val entry getValue
desiredContainerCount readyContainerCount component getNumReadyInstances thresholdFraction healthThresholdPercent readyContainerFraction readyContainerCount desiredContainerCount healthChanged readyContainerFraction prevReadyContainerFraction prevReadyContainerFraction readyContainerFraction healthChanged String readyContainerPercentStr String format readyContainerFraction readyContainerFraction thresholdFraction currentTimestamp System nanoTime firstOccurrenceTimestamp firstOccurrenceTimestamp currentTimestamp Date date Date
LOG info component getName date getTime date elapsedTime currentTimestamp firstOccurrenceTimestamp elapsedTimeSecs TimeUnit SECONDS convert elapsedTime TimeUnit NANOSECONDS LOG warn component getName readyContainerPercentStr healthThresholdPercent elapsedTimeSecs healthThresholdWindowSecs elapsedTime LOG warn component getName readyContainerPercentStr healthThresholdPercent elapsedTimeSecs healthThresholdWindowSecs String exitDiag String format component getName readyContainerPercentStr healthThresholdPercent elapsedTimeSecs healthThresholdWindowSecs component getScheduler getDiagnostics append exitDiag LOG warn exitDiag Thread sleep e LOG error e ExitUtil terminate
elapsedTime currentTimestamp firstOccurrenceTimestamp elapsedTimeSecs TimeUnit SECONDS convert elapsedTime TimeUnit NANOSECONDS LOG warn component getName readyContainerPercentStr healthThresholdPercent elapsedTimeSecs healthThresholdWindowSecs elapsedTime LOG warn component getName readyContainerPercentStr healthThresholdPercent elapsedTimeSecs healthThresholdWindowSecs String exitDiag String format component getName readyContainerPercentStr healthThresholdPercent elapsedTimeSecs healthThresholdWindowSecs component getScheduler getDiagnostics append exitDiag LOG warn exitDiag Thread sleep e LOG error e ExitUtil terminate String logMsg
LOG warn component getName readyContainerPercentStr healthThresholdPercent elapsedTimeSecs healthThresholdWindowSecs String exitDiag String format component getName readyContainerPercentStr healthThresholdPercent elapsedTimeSecs healthThresholdWindowSecs component getScheduler getDiagnostics append exitDiag LOG warn exitDiag Thread sleep e LOG error e ExitUtil terminate String logMsg LOG info logMsg component getName healthThresholdPercent readyContainerPercentStr readyContainerCount desiredContainerCount
status String ip instance getContainerStatus getIPs get HttpURLConnection connection URL url URL urlString replace HOST_TOKEN ip connection getConnection url timeout rc connection getResponseCode rc rc String error url rc log info error status fail IOException error status succeed e String error urlString ip e
fs compLaunchContext instance Path compInstanceDir initCompInstanceDir fs compLaunchContext instance fs compInstanceDir
log info compPublicResourceDir log debug instance getCompInstanceName System lineSeparator tokensForSubstitution ConfigFile originalFile originalFile ConfigFile configFile originalFile copy String fileName Path configFile getDestFile getName String String token tokensForSubstitution configFile setDestFile configFile getDestFile replaceAll Pattern quote token getKey token getValue Path remoteFile LocalResourceVisibility visibility configFile getVisibility visibility visibility LocalResourceVisibility remoteFile Path compPublicResourceDir fileName
addLocalResource launcher symlink localResource destFile destFile launcher addLocalResource symlink localResource destFile toString
e log info configFile e org apache hadoop conf Configuration confCopy org apache hadoop conf Configuration String String entry conf confCopy set entry getKey entry getValue String String entry configFile confCopy set entry getKey entry getValue String String entry confCopy String val entry getValue val String String token val val replaceAll Pattern quote token getKey token getValue confCopy set entry getKey val
String componentName String path RegistryUtils componentPath user serviceClass instanceName componentName
String containerId String path RegistryUtils componentPath user serviceClass instanceName containerId
log warn isServiceMetrics isComponentMetrics String appId tag tag tag value isServiceMetrics tag tag value isComponentMetrics tag appId tag value isServiceMetrics appId
isServiceMetrics isComponentMetrics String appId tag record tag tag value isServiceMetrics tag tag value isComponentMetrics tag appId tag value isServiceMetrics appId log debug record serviceTimelinePublisher publishMetrics record metrics appId ServiceTimelineEntityType SERVICE_ATTEMPT toString record timestamp isComponentMetrics
Configuration resource Configuration conf Configuration URL resURL getResourceUrl resource resURL
localFile Path tempPath subdir destFileName Path src Path localFile toString Path subdirPath Path tempPath subdir fileSystem mkdirs subdirPath Path destPath Path subdirPath destFileName
UserGroupInformation currentUser UserGroupInformation getCurrentUser
server UserGroupInformation currentUser UserGroupInformation getCurrentUser LOG debug currentUser currentUser Oid mechOid KerberosUtil getOidInstance GSSManager manager GSSManager getInstance GSSName serverName manager createName server GSSName NT_HOSTBASED_SERVICE GSSContext gssContext manager createContext serverName canonicalize mechOid mechOid GSSContext DEFAULT_LIFETIME gssContext requestMutualAuth gssContext requestCredDeleg inToken outToken gssContext initSecContext inToken inToken length gssContext dispose
String String String Oid mechOid KerberosUtil getOidInstance GSSManager manager GSSManager getInstance GSSName serverName manager createName server GSSName NT_HOSTBASED_SERVICE GSSContext gssContext manager createContext serverName canonicalize mechOid mechOid GSSContext DEFAULT_LIFETIME gssContext requestMutualAuth gssContext requestCredDeleg inToken outToken gssContext initSecContext inToken inToken length gssContext dispose LOG debug serverName String BASE_64_CODEC encode outToken StandardCharsets US_ASCII
Builder String url useKerberos UserGroupInformation isSecurityEnabled URI resource URI url Client client Client create Builder builder client resource url type MediaType APPLICATION_JSON useKerberos String challenge generateToken resource getHost builder header HttpHeaders AUTHORIZATION challenge
validateDockerClientConfiguration service conf e IllegalArgumentException e Configuration globalConf service getConfiguration Set String componentNames HashSet List Component componentsToRemove ArrayList List Component componentsToAdd ArrayList Component comp service maxCompLength RegistryConstants MAX_FQDN_LABEL_LENGTH maxCompLength maxCompLength Long toString Long MAX_VALUE length comp getName length maxCompLength IllegalArgumentException String format RestApiErrorMessages ERROR_COMPONENT_NAME_INVALID maxCompLength comp getName service getName comp getName IllegalArgumentException String format RestApiErrorMessages ERROR_COMPONENT_NAME_CONFLICTS_WITH_SERVICE_NAME comp getName service getName
Configuration globalConf service getConfiguration Set String componentNames HashSet List Component componentsToRemove ArrayList List Component componentsToAdd ArrayList Component comp service maxCompLength RegistryConstants MAX_FQDN_LABEL_LENGTH maxCompLength maxCompLength Long toString Long MAX_VALUE length comp getName length maxCompLength IllegalArgumentException String format RestApiErrorMessages ERROR_COMPONENT_NAME_INVALID maxCompLength comp getName service getName comp getName IllegalArgumentException String format RestApiErrorMessages ERROR_COMPONENT_NAME_CONFLICTS_WITH_SERVICE_NAME comp getName service getName componentNames comp getName IllegalArgumentException comp getName comp comp comp
maxCompLength maxCompLength Long toString Long MAX_VALUE length comp getName length maxCompLength IllegalArgumentException String format RestApiErrorMessages ERROR_COMPONENT_NAME_INVALID maxCompLength comp getName service getName comp getName IllegalArgumentException String format RestApiErrorMessages ERROR_COMPONENT_NAME_CONFLICTS_WITH_SERVICE_NAME comp getName service getName comp getName IllegalArgumentException comp getName comp getArtifact comp getArtifact comp getArtifact getId IllegalArgumentException RestApiErrorMessages ERROR_ARTIFACT_ID_INVALID LOG info comp getName componentsToRemove add comp List Component externalComponents getComponents fs comp getArtifact getId Component c externalComponents Component override service getComponent c getName
service conf conf String dockerClientConfig service getDockerClientConfig dockerClientConfig Path dockerClientConfigPath Path dockerClientConfig FileSystem fs dockerClientConfigPath getFileSystem conf
fs serviceName Path serviceJson getServiceJsonPath fs serviceName
fs serviceName version Path versionPath fs buildClusterUpgradeDirPath serviceName version Path versionedDef Path versionPath serviceName
fs Path appDir service FsPermission appDirPermission FsPermission fs createWithPermissions appDir appDirPermission Path appJson writeAppDefinition fs appDir service
Service service result List String dependencies service getDependencies org apache hadoop conf Configuration conf org apache hadoop conf Configuration dependencies dependencies ServiceClient sc ServiceClient sc init conf sc start String dependent dependencies Service dependentService sc getStatus dependent dependentService dependentService result
InetAddress getByName name String dnsURI String format addr Hashtable String Object env Hashtable env put Context INITIAL_CONTEXT_FACTORY env put Context PROVIDER_URL dnsURI DirContext ictx InitialDirContext env Attributes attrs ictx getAttributes name String attrs
loader IOException my_class String class_file my_class getName replaceAll Enumeration URL urlEnumeration loader getResources class_file urlEnumeration URL url urlEnumeration nextElement url String toReturn url getPath toReturn toReturn toReturn substring length toReturn toReturn replaceAll toReturn URLDecoder decode toReturn String jarFilePath toReturn replaceAll File jarFilePath
serviceVersion compName Path path getComponentDir serviceVersion compName fileSystem path fileSystem delete path
serviceVersion Path path Path Path getAppDir serviceVersion fileSystem path fileSystem path fileSystem delete path
Path Path path Path Path service getName
RuntimeException e yarnRegistryView AllocateResponse AllocateResponse AllocateResponseBuilder builder AllocateResponse newBuilder feedContainers feedContainers LOG info List Container allocatedContainers LinkedList Iterator Container itor feedContainers iterator itor Container c itor next org apache hadoop yarn service component Component component componentsById get c getAllocationRequestId
conf set YarnConfiguration NM_VMEM_PMEM_RATIO conf set YarnConfiguration NM_CONTAINER_MON_RESOURCE_CALCULATOR LinuxResourceCalculatorPlugin getName conf set YarnConfiguration NM_CONTAINER_MON_PROCESS_TREE ProcfsBasedProcessTree getName conf setBoolean YarnConfiguration YARN_MINICLUSTER_CONTROL_RESOURCE_MONITORING conf setBoolean TIMELINE_SERVICE_ENABLED conf setInt YarnConfiguration NM_MAX_PER_DISK_UTILIZATION_PERCENTAGE conf setLong DEBUG_NM_DELETE_DELAY_SEC conf setLong AM_RESOURCE_MEM conf setLong YarnServiceConf READINESS_CHECK_INTERVAL conf setBoolean NM_VMEM_CHECK_ENABLED conf setBoolean NM_PMEM_CHECK_ENABLED conf set HttpServer2 FILTER_INITIALIZER_PROPERTY zkCluster TestingCluster zkCluster start conf set YarnConfiguration RM_ZK_ADDRESS zkCluster getConnectString
conf set YARN_SERVICE_BASE_PATH basedir getAbsolutePath yarnCluster yarnCluster MiniYARNCluster getClass getSimpleName numNodeManager yarnCluster init conf yarnCluster start waitForNMsToRegister URL url Thread currentThread getContextClassLoader getResource url RuntimeException Configuration yarnClusterConfig yarnCluster getConfig yarnClusterConfig set YarnConfiguration YARN_APPLICATION_CLASSPATH File url getPath getParent ByteArrayOutputStream bytesOut ByteArrayOutputStream yarnClusterConfig writeXml bytesOut bytesOut close OutputStream os FileOutputStream File url getPath
Multimap String String client Service exampleApp expectedTotalContainers countTotalContainers exampleApp Multimap String String allContainers HashMultimap create Service retrievedApp client getStatus exampleApp getName totalReadyContainers allContainers clear LOG info retrievedApp getComponents size retrievedApp getComponents
Multimap String String client Service exampleApp expectedTotalContainers countTotalContainers exampleApp Multimap String String allContainers HashMultimap create Service retrievedApp client getStatus exampleApp getName totalReadyContainers allContainers clear LOG info retrievedApp getComponents size component retrievedApp getComponents LOG info component getName
Multimap String String client Service exampleApp expectedTotalContainers countTotalContainers exampleApp Multimap String String allContainers HashMultimap create Service retrievedApp client getStatus exampleApp getName totalReadyContainers allContainers clear LOG info retrievedApp getComponents size component retrievedApp getComponents LOG info component getName LOG info component toString component component size exampleApp component getName component
Service retrievedApp client getStatus exampleApp getName totalReadyContainers allContainers clear LOG info retrievedApp getComponents size component retrievedApp getComponents LOG info component getName LOG info component toString component component size exampleApp component getName container component LOG info container getState component getName container getState totalReadyContainers allContainers put component getName container getId
totalReadyContainers allContainers clear LOG info retrievedApp getComponents size component retrievedApp getComponents LOG info component getName LOG info component toString component component size component getName container component LOG info container getState component getName container getState totalReadyContainers allContainers put component getName container getId LOG info container getId
compA getConfiguration getEnv put Artifact artifact Artifact artifact setType Artifact TypeEnum TARBALL compA artifact artifact exampleApp addComponent compA MockServiceAM am MockServiceAM exampleApp am init conf am start ServiceScheduler scheduler am context scheduler scheduler syncSysFs exampleApp scheduler close am stop am close
conf setBoolean YarnConfiguration YARN_MINICLUSTER_FIXED_PORTS conf setBoolean YarnConfiguration YARN_MINICLUSTER_USE_RPC conf setInt YarnConfiguration RM_MAX_COMPLETED_APPLICATIONS YarnConfiguration DEFAULT_RM_MAX_COMPLETED_APPLICATIONS setConf conf setupInternal NUM_NMS ServiceClient client createClient getConf Service exampleApp createExampleApplication client actionCreate exampleApp Multimap String String containersBeforeFailure waitForAllCompToBeReady client exampleApp LOG info getYarnCluster restartResourceManager getYarnCluster getActiveRMIndex GenericTestUtils waitFor getYarnCluster getResourceManager getServiceState org apache hadoop service Service STATE STARTED Assert assertTrue getYarnCluster waitForNodeManagersToConnect ApplicationId exampleAppId ApplicationId fromString exampleApp getId ApplicationAttemptId applicationAttemptId client getYarnClient getApplicationReport exampleAppId getCurrentApplicationAttemptId
ApplicationId exampleAppId ApplicationId fromString exampleApp getId ApplicationAttemptId applicationAttemptId client getYarnClient getApplicationReport exampleAppId getCurrentApplicationAttemptId LOG info applicationAttemptId client getYarnClient failApplicationAttempt applicationAttemptId ApplicationReport ar client getYarnClient getApplicationReport exampleAppId ar getCurrentApplicationAttemptId getAttemptId ar getYarnApplicationState YarnApplicationState RUNNING e RuntimeException e Multimap String String containersAfterFailure waitForAllCompToBeReady client exampleApp containersBeforeFailure compName Assert assertEquals compName containersBeforeFailure get compName size containersAfterFailure get compName containersAfterFailure get compName size
component getConfiguration getEnv put client initiateUpgrade service waitForServiceToBeInState client service ServiceState UPGRADING SliderFileSystem fs SliderFileSystem getConf Service fromFs ServiceApiUtil loadServiceUpgrade fs service getName service getVersion Assert assertEquals service getName fromFs getName Assert assertEquals service getVersion fromFs getVersion Service liveService client getStatus service getName client actionUpgrade service liveService getComponent component getName getContainers waitForAllCompToBeReady client service client actionStart service getName waitForServiceToBeStable client service Service active client getStatus service getName Assert assertEquals ComponentState STABLE active getComponent component getName getState Assert assertEquals active getComponent component getName getConfiguration getEnv
waitForServiceToBeStable client service Component component service getComponents iterator next service setState ServiceState EXPRESS_UPGRADING service setVersion component getConfiguration getEnv put Component component2 service getComponent component2 getConfiguration getEnv put client actionUpgradeExpress service waitForServiceToBeExpressUpgrading client service waitForServiceToBeStable client service Service active client getStatus service getName Assert assertEquals service getVersion active getVersion Assert assertEquals ComponentState STABLE active getComponent component getName getState Assert assertEquals active getComponent component getName getConfiguration getEnv Assert assertEquals active getComponent component2 getName getConfiguration getEnv
waitForServiceToBeStable client service service setState ServiceState UPGRADING service setVersion component getConfiguration getEnv put client initiateUpgrade service waitForServiceToBeInState client service ServiceState UPGRADING Service liveService client getStatus service getName Container container liveService getComponent component getName getContainers iterator next client actionUpgrade service Lists newArrayList container Thread sleep client actionCancelUpgrade service getName waitForServiceToBeStable client service Service active client getStatus service getName Assert assertEquals ComponentState STABLE active getComponent component getName getState Assert assertEquals active getComponent component getName getConfiguration getEnv
Assert assertNotEquals ServiceState STABLE service getState Assert assertEquals ComponentState FLEXING component getState Assert assertEquals component getContainers size compCounts HashMap compCounts put exampleApp getComponent setNumberOfContainers client flexByRestService exampleApp getName compCounts waitForServiceToBeStable client exampleApp Assert fail service client getStatus exampleApp getName component service getComponent Assert assertNotEquals ServiceState STABLE service getState Assert assertEquals ComponentState FLEXING component getState
Service orig ExampleAppJson loadResource OVERRIDE_JSON Configuration global orig getConfiguration assertEquals global getProperty assertEquals global getProperty assertEquals global getFiles size Configuration simple orig getComponent getConfiguration assertEquals simple getProperties size assertEquals simple getFiles size Configuration master orig getComponent getConfiguration assertEquals master getProperty assertEquals master getProperty assertEquals master getFiles size Configuration worker orig getComponent getConfiguration
Configuration master orig getComponent getConfiguration assertEquals master getProperty assertEquals master getProperty assertEquals master getFiles size Configuration worker orig getComponent getConfiguration LOG info worker assertEquals worker getProperties size assertEquals worker getFiles size assertEquals worker getProperty assertEquals worker getProperty assertNull worker getProperty assertEquals worker getProperty SliderFileSystem sfs ServiceTestUtils initMockFs ServiceApiUtil validateAndResolveService orig sfs YarnConfiguration global orig getConfiguration
assertEquals global getFiles size simple orig getComponent getConfiguration assertEquals simple getProperties size assertEquals simple getProperty assertEquals simple getProperty assertEquals simple getFiles size Set ConfigFile files HashSet Map String String props HashMap props put props put files add ConfigFile destFile type ConfigFile TypeEnum PROPERTIES properties props files add ConfigFile destFile type ConfigFile TypeEnum XML properties Collections singletonMap assertTrue files contains simple getFiles get assertTrue files contains simple getFiles get master orig getComponent getConfiguration
assertTrue files contains simple getFiles get master orig getComponent getConfiguration LOG info master assertEquals master getProperties size assertEquals master getProperty assertEquals master getProperty assertEquals master getProperty assertEquals master getFiles size props put files clear files add ConfigFile destFile type ConfigFile TypeEnum PROPERTIES properties props files add ConfigFile destFile type ConfigFile TypeEnum XML properties Collections singletonMap assertTrue files contains master getFiles get assertTrue files contains master getFiles get worker orig getComponent getConfiguration
assertEquals global getProperties size assertEquals orig getComponents size simple orig getComponent getConfiguration assertEquals simple getProperties size assertEquals simple getProperty assertEquals simple getProperty assertEquals simple getProperty master orig getComponent getConfiguration assertEquals master getProperties size assertEquals master getProperty assertEquals master getProperty assertEquals master getProperty assertEquals master getProperty assertEquals simple getProperty Configuration worker orig getComponent getConfiguration
artifact setType Artifact TypeEnum SERVICE ServiceApiUtil validateAndResolveService app sfs CONF_DNS_ENABLED Assert fail EXCEPTION_PREFIX e assertEquals ERROR_ARTIFACT_ID_INVALID e getMessage artifact setType Artifact TypeEnum TARBALL ServiceApiUtil validateAndResolveService app sfs CONF_DNS_ENABLED Assert fail EXCEPTION_PREFIX e assertEquals String format ERROR_ARTIFACT_ID_FOR_COMP_INVALID compName e getMessage artifact setType Artifact TypeEnum DOCKER artifact setId
mySession mySession getRemote flush consoleReader String message consoleReader read mySession getRemote sendString message mySession getRemote sendString String message mySession getRemote sendString message Thread sleep mySession getRemote flush inputThread join mySession disconnect
conf maxThreadPoolSize conf getInt YarnConfiguration NM_CLIENT_ASYNC_THREAD_POOL_MAX_SIZE YarnConfiguration DEFAULT_NM_CLIENT_ASYNC_THREAD_POOL_MAX_SIZE
Set String allNodes HashSet String event events take e LOG error e allNodes add event getNodeId toString threadPoolSize threadPool getCorePoolSize threadPoolSize maxThreadPoolSize nodeNum allNodes size idealThreadPoolSize Math min maxThreadPoolSize nodeNum threadPoolSize idealThreadPoolSize newThreadPoolSize Math min maxThreadPoolSize idealThreadPoolSize INITIAL_THREAD_POOL_SIZE
token String nodeId token getNodeId toString nodeId
container updateContainerRequest Preconditions checkNotNull container Preconditions checkNotNull updateContainerRequest
ContainerManagementProtocolProxyData containerManagerBindAddr ContainerManagementProtocolProxyData proxy cmProxy get containerManagerBindAddr proxy proxy containerManagerBindAddr
proxy proxy activeCallers proxy proxy activeCallers
put priority String ExecutionType Resource ResourceRequestInfo Map String Map ExecutionType TreeMap Resource ResourceRequestInfo locationMap remoteRequestsTable get priority locationMap locationMap HashMap remoteRequestsTable put priority locationMap
put priority String resourceName ExecutionType execType Resource ResourceRequestInfo Map String Map ExecutionType TreeMap Resource ResourceRequestInfo locationMap remoteRequestsTable get priority locationMap locationMap HashMap remoteRequestsTable put priority locationMap LOG debug priority Map ExecutionType TreeMap Resource ResourceRequestInfo execTypeMap locationMap get resourceName execTypeMap execTypeMap HashMap locationMap put resourceName execTypeMap LOG debug resourceName TreeMap Resource ResourceRequestInfo capabilityMap execTypeMap get execType capabilityMap capabilityMap TreeMap AMRMClientImpl ResourceReverseComparator execTypeMap put execType capabilityMap
ResourceRequestInfo priority String ExecutionType Resource ResourceRequestInfo retVal Map String Map ExecutionType TreeMap Resource ResourceRequestInfo locationMap remoteRequestsTable get priority locationMap
ResourceRequestInfo priority resourceName execTypeReq capability ResourceRequestInfo resourceRequestInfo get priority resourceName execTypeReq getExecutionType capability resourceRequestInfo
addLogAggregationDelegationToken appContext getAMContainerSpec e LOG warn e rmClient submitApplication request pollCount startTime System currentTimeMillis EnumSet YarnApplicationState waitingStates EnumSet of YarnApplicationState NEW YarnApplicationState NEW_SAVING YarnApplicationState SUBMITTED EnumSet YarnApplicationState failToSubmitStates EnumSet of YarnApplicationState FAILED YarnApplicationState KILLED ApplicationReport appReport getApplicationReport applicationId YarnApplicationState state appReport getYarnApplicationState waitingStates state failToSubmitStates state
LOG warn e rmClient submitApplication request pollCount startTime System currentTimeMillis EnumSet YarnApplicationState waitingStates EnumSet of YarnApplicationState NEW YarnApplicationState NEW_SAVING YarnApplicationState SUBMITTED EnumSet YarnApplicationState failToSubmitStates EnumSet of YarnApplicationState FAILED YarnApplicationState KILLED ApplicationReport appReport getApplicationReport applicationId YarnApplicationState state appReport getYarnApplicationState waitingStates state failToSubmitStates state YarnException applicationId appReport getDiagnostics LOG info applicationId
ApplicationReport appReport getApplicationReport applicationId YarnApplicationState state appReport getYarnApplicationState state state YarnException applicationId appReport getDiagnostics LOG info applicationId elapsedMillis System currentTimeMillis startTime elapsedMillis YarnException applicationId LOG info applicationId state Thread sleep submitPollIntervalMillis
dibb reset tokens credentials readTokenStorageStream dibb tokens rewind Configuration conf getConfig String masterPrincipal YarnClientUtils getRmPrincipal conf masterPrincipal IOException LOG debug masterPrincipal LogAggregationFileControllerFactory factory LogAggregationFileControllerFactory conf LogAggregationFileController fileController factory getFileControllerForWrite Path remoteRootLogDir fileController getRemoteRootLogDir FileSystem fs remoteRootLogDir getFileSystem conf org apache hadoop security token Token finalTokens fs addDelegationTokens masterPrincipal credentials finalTokens org apache hadoop security token Token token finalTokens
clc Credentials credentials Credentials DataInputByteBuffer dibb DataInputByteBuffer ByteBuffer tokens clc getTokens tokens dibb reset tokens credentials readTokenStorageStream dibb tokens rewind org apache hadoop security token Token token credentials token TimelineDelegationTokenIdentifier org apache hadoop security token Token TimelineDelegationTokenIdentifier timelineDelegationToken getTimelineDelegationToken timelineDelegationToken credentials addToken timelineService timelineDelegationToken
request setApplicationId applicationId diagnostics request setDiagnostics diagnostics pollCount startTime System currentTimeMillis KillApplicationResponse response rmClient forceKillApplication request response LOG info applicationId elapsedMillis System currentTimeMillis startTime elapsedMillis YarnException applicationId pollCount
QueueMetrics queueMetrics QueueMetrics List QueueInfo queuesInfo queuesInfo client getRootQueueInfos ie LOG error ie queueMetrics queuesInfo ArrayList queueName QueueInfo qInfo client getQueueInfo queueName queuesInfo add qInfo ie
UserGroupInformation currentUser UserGroupInformation getCurrentUser
server UserGroupInformation currentUser UserGroupInformation getCurrentUser LOG debug currentUser currentUser Oid mechOid KerberosUtil getOidInstance GSSManager manager GSSManager getInstance GSSName serverName manager createName server GSSName NT_HOSTBASED_SERVICE GSSContext gssContext manager createContext serverName canonicalize mechOid mechOid GSSContext DEFAULT_LIFETIME gssContext requestMutualAuth gssContext requestCredDeleg inToken outToken gssContext initSecContext inToken inToken length gssContext dispose
String String String Oid mechOid KerberosUtil getOidInstance GSSManager manager GSSManager getInstance GSSName serverName manager createName server GSSName NT_HOSTBASED_SERVICE GSSContext gssContext manager createContext serverName canonicalize mechOid mechOid GSSContext DEFAULT_LIFETIME gssContext requestMutualAuth gssContext requestCredDeleg inToken outToken gssContext initSecContext inToken inToken length gssContext dispose LOG debug serverName String BASE_64_CODEC encode outToken StandardCharsets US_ASCII
ContainerReport String ContainerReport mockReport mock ContainerReport doReturn nodeId when mockReport getAssignedNode doReturn when mockReport getNodeHttpAddress mockReport cli setConf conf exitCode cli run String appId toString LOG info sysOutStream toString assertTrue exitCode assertTrue sysOutStream toString contains logMessage containerId1 assertTrue sysOutStream toString contains logMessage containerId2 assertTrue sysOutStream toString contains logMessage containerId3 assertTrue sysOutStream toString contains logMessage containerId3 assertTrue sysOutStream toString contains logMessage containerId3
LOG info sysOutStream toString assertTrue exitCode assertTrue sysOutStream toString contains logMessage containerId1 assertTrue sysOutStream toString contains logMessage containerId2 assertTrue sysOutStream toString contains logMessage containerId3 assertTrue sysOutStream toString contains logMessage containerId3 assertTrue sysOutStream toString contains logMessage containerId3 assertTrue sysOutStream toString contains createEmptyLog sysOutStream reset exitCode cli run String appId toString appAttemptId1 toString LOG info sysOutStream toString assertTrue exitCode assertTrue sysOutStream toString contains logMessage containerId1 assertTrue sysOutStream toString contains logMessage containerId2 assertTrue sysOutStream toString contains logMessage containerId3
String args errOutBytes reset sysOutBytes reset LOG info Joiner on join args ret nodeAttributesCLI run args errOutput String errOutBytes toByteArray Charsets UTF_8 sysOutput String sysOutBytes toByteArray Charsets UTF_8
String args errOutBytes reset sysOutBytes reset LOG info Joiner on join args ret nodeAttributesCLI run args errOutput String errOutBytes toByteArray Charsets UTF_8 sysOutput String sysOutBytes toByteArray Charsets UTF_8 LOG info errOutput
t e LOG error t e e LOG error FATAL t e err e System err println err ExitUtil halt ExitUtil terminate
configuration String rmClusterId configuration get YarnConfiguration RM_CLUSTER_ID YarnConfiguration DEFAULT_RM_CLUSTER_ID
conf proxy protocol protocol protocol YarnConfiguration yarnConf YarnConfiguration conf InetSocketAddress rmAddress proxy getRMAddress yarnConf protocol
putEntities entities List TimelineEntity entitiesToDBStore ArrayList TimelineEntity List TimelineEntity entitiesToSummaryCache ArrayList TimelineEntity List TimelineEntity entitiesToEntityCache ArrayList TimelineEntity Path attemptDir attemptDirCache getAppAttemptDir appAttemptId TimelineEntity entity entities entity entitiesToSummaryCache add entity entitiesToEntityCache add entity entitiesToDBStore add entity entitiesToSummaryCache Path summaryLogPath Path attemptDir SUMMARY_LOG_PREFIX appAttemptId toString
List TimelineEntity entitiesToEntityCache ArrayList TimelineEntity Path attemptDir attemptDirCache getAppAttemptDir appAttemptId TimelineEntity entity entity entitiesToSummaryCache add entity entitiesToEntityCache add entity entitiesToDBStore add entity entitiesToSummaryCache Path summaryLogPath Path attemptDir SUMMARY_LOG_PREFIX appAttemptId toString LOG debug appAttemptId summaryLogPath logFDsCache writeSummaryEntityLogs fs summaryLogPath objMapper appAttemptId entitiesToSummaryCache isAppendSupported entitiesToEntityCache
appAttemptId Path domainLogPath Path attemptDirCache getAppAttemptDir appAttemptId DOMAIN_LOG_PREFIX appAttemptId toString
path File jsonFile File path jsonFile
e LOG error e getMessage e printStackTrace System err Configuration conf YarnConfiguration TimelineClient client TimelineClient createTimelineClient client init conf client start UserGroupInformation conf YarnConfiguration conf YarnConfiguration Token TimelineDelegationTokenIdentifier token client getDelegationToken UserGroupInformation getCurrentUser getUserName UserGroupInformation getCurrentUser addToken token TimelinePutResponse response client putEntities entities getEntities toArray TimelineEntity entities getEntities size response size
Token TimelineDelegationTokenIdentifier token client getDelegationToken UserGroupInformation getCurrentUser getUserName UserGroupInformation getCurrentUser addToken token TimelinePutResponse response client putEntities entities getEntities toArray TimelineEntity entities getEntities size response size LOG info TimelinePutResponse error response LOG error error getEntityType error getEntityId error getErrorCode hasError domain client putDomain domain
TimelinePutResponse response client putEntities entities getEntities toArray TimelineEntity entities getEntities size response size LOG info TimelinePutResponse error response LOG error error getEntityType error getEntityId error getErrorCode hasError domain client putDomain domain e LOG error domain getId e hasError
UserGroupInformation ugi UserGroupInformation getCurrentUser UserGroupInformation realUgi ugi getRealUser String doAsUser UserGroupInformation authUgi realUgi authUgi realUgi doAsUser ugi getShortUserName authUgi ugi doAsUser DelegationTokenAuthenticatedURL Token token DelegationTokenAuthenticatedURL Token connector TimelineConnector authUgi doAsUser token addIfService connector String timelineReaderWebAppAddress WebAppUtils getTimelineReaderWebAppURLWithoutScheme conf baseUri TimelineConnector constructResURI conf timelineReaderWebAppAddress RESOURCE_URI_STR_V2
ClientResponse base String path String String params ClientResponse resp connector getClient resource base path path queryParams params accept MediaType APPLICATION_JSON get ClientResponse resp resp ClientResponse String msg resp resp getStatus resp getEntity String
LOG warn TimelineDelegationTokenIdentifier KIND_NAME collectorAddr collectorAddr isEmpty collectorAddr timelineServiceAddress String service delegationToken getService service service isEmpty collectorAddr collectorAddr isEmpty LOG warn currentTimelineToken currentTimelineToken delegationToken currentTimelineToken delegationToken org apache hadoop security token Token TimelineDelegationTokenIdentifier timelineToken org apache hadoop security token Token TimelineDelegationTokenIdentifier delegationToken getIdentifier array delegationToken getPassword array Text delegationToken getKind service Text Text service InetSocketAddress serviceAddr collectorAddr collectorAddr isEmpty NetUtils createSocketAddr collectorAddr SecurityUtil getTokenServiceAddr timelineToken SecurityUtil setTokenService timelineToken serviceAddr authUgi addToken timelineToken
doPutObjects base path params obj ue Throwable cause ue getCause cause IOException IOException cause IOException cause ie IOException InterruptedIOException initCause ie String msg
IOException InterruptedIOException initCause ie resp String msg LOG error msg YarnException msg resp resp close che LOG warn che String msg String stringType resp getEntity String msg stringType
retries pollTimelineServiceAddress maxServiceRetries String errMessage maxServiceRetries
doPostingObject obj path e Throwable cause e getCause cause IOException IOException cause IOException cause ie IOException InterruptedIOException initCause ie String msg
doPostingObject obj path e Throwable cause e getCause cause IOException IOException cause IOException cause ie IOException InterruptedIOException initCause ie resp resp String msg LOG error msg resp msg resp getStatus
WebResource webResource client resource resURI
drained eventQueue isEmpty waitForDrained drained waitForDrained notify Event event event eventQueue take ie LOG warn ie event dispatch event
blockNewEvents LOG info endTime System currentTimeMillis getConfig getLong YarnConfiguration DISPATCHER_DRAIN_EVENTS_TIMEOUT YarnConfiguration DEFAULT_DISPATCHER_DRAIN_EVENTS_TIMEOUT waitForDrained System currentTimeMillis endTime waitForDrained wait
eventType EventHandler EventHandler Event registeredHandler EventHandler Event eventDispatchers get eventType
qSize eventQueue size qSize qSize
Server pbProtocol addr conf secretManager numHandlers blockingService portRangeConfig RPC setProtocolEngine conf pbProtocol ProtobufRpcEngine2 RPC Server server RPC Builder conf setProtocol pbProtocol setInstance blockingService setBindAddress addr getHostName setPort addr getPort setNumHandlers numHandlers setVerbose setSecretManager secretManager setPortRangeConfig portRangeConfig build
Path remoteRootLogDir getRemoteRootLogDir FsPermission perms remoteFS getFileStatus remoteRootLogDir getPermission perms TLDIR_PERMISSIONS LOG warn remoteRootLogDir TLDIR_PERMISSIONS perms e remoteExists e YarnRuntimeException remoteRootLogDir e Path qualified remoteRootLogDir makeQualified remoteFS getUri remoteFS getWorkingDirectory remoteExists LOG warn remoteRootLogDir remoteFS mkdirs qualified FsPermission TLDIR_PERMISSIONS
YarnRuntimeException remoteRootLogDir e Path qualified remoteRootLogDir makeQualified remoteFS getUri remoteFS getWorkingDirectory LOG warn remoteRootLogDir remoteFS mkdirs qualified FsPermission TLDIR_PERMISSIONS remoteFS setPermission qualified FsPermission TLDIR_PERMISSIONS LOG info remoteFS getScheme fsSupportsChmod UserGroupInformation loginUser UserGroupInformation getLoginUser String primaryGroupName conf get YarnConfiguration NM_REMOTE_APP_LOG_DIR_GROUPNAME primaryGroupName primaryGroupName
remoteFS mkdirs qualified FsPermission TLDIR_PERMISSIONS remoteFS setPermission qualified FsPermission TLDIR_PERMISSIONS LOG info remoteFS getScheme fsSupportsChmod UserGroupInformation loginUser UserGroupInformation getLoginUser String primaryGroupName conf get YarnConfiguration NM_REMOTE_APP_LOG_DIR_GROUPNAME primaryGroupName primaryGroupName primaryGroupName loginUser getPrimaryGroupName LOG warn
fsSupportsChmod UserGroupInformation loginUser UserGroupInformation getLoginUser String primaryGroupName conf get YarnConfiguration NM_REMOTE_APP_LOG_DIR_GROUPNAME primaryGroupName primaryGroupName primaryGroupName loginUser getPrimaryGroupName LOG warn LOG LOG debug primaryGroupName primaryGroupName remoteFS setOwner qualified loginUser getShortUserName primaryGroupName
FileSystem remoteFS getFileSystem conf Path appDir LogAggregationUtils getRemoteAppLogDir remoteRootLogDir appId user remoteRootLogDirSuffix Path curDir appDir makeQualified remoteFS getUri remoteFS getWorkingDirectory Path rootLogDir remoteRootLogDir makeQualified remoteFS getUri remoteFS getWorkingDirectory LinkedList Path pathsToCreate LinkedList curDir rootLogDir remoteFS curDir APP_DIR_PERMISSIONS pathsToCreate addFirst curDir curDir curDir getParent Path path pathsToCreate createDir remoteFS path APP_DIR_PERMISSIONS
status List FileStatus statusList ArrayList FileStatus status statusList FileStatus FileStatus s1 FileStatus s2 s1 getModificationTime s2 getModificationTime s1 getModificationTime s2 getModificationTime i i statusList i FileStatus remove statusList get i remoteFS delete remove getPath
statusList FileStatus FileStatus s1 FileStatus s2 s1 getModificationTime s2 getModificationTime s1 getModificationTime s2 getModificationTime i i statusList i FileStatus remove statusList get i remoteFS delete remove getPath e LOG error remove getPath e e
ApplicationId appId params getAppId ContainerId containerId params getContainerId NodeId nodeId params getNodeId String appOwner params getAppOwner String logEntity params getLogEntity start params getStartIndex end params getEndIndex startTime params getStartTime endTime params getEndTime List FileStatus nodeFiles nodeFiles LogAggregationUtils getRemoteNodeFileList conf appId appOwner fileController getRemoteRootLogDir fileController getRemoteRootLogDirSuffix html h1 containerId toString
String logEntity params getLogEntity start params getStartIndex end params getEndIndex startTime params getStartTime endTime params getEndTime List FileStatus nodeFiles nodeFiles LogAggregationUtils getRemoteNodeFileList conf appId appOwner fileController getRemoteRootLogDir fileController getRemoteRootLogDirSuffix ex html h1 containerId toString LOG error ex getMessage Map String Long checkSumFiles checkSumFiles fileController parseCheckSumFiles nodeFiles
nodeFiles LogAggregationUtils getRemoteNodeFileList conf appId appOwner fileController getRemoteRootLogDir fileController getRemoteRootLogDirSuffix ex html h1 containerId toString LOG error ex getMessage Map String Long checkSumFiles checkSumFiles fileController parseCheckSumFiles nodeFiles ex LOG error logEntity ex html h1 logEntity List FileStatus fileToRead fileToRead fileController getNodeLogFileToRead nodeFiles nodeId toString appId
remoteUser html h1 __ remoteUser logEntity thisNodeFile getPath getName __ LOG error remoteUser logEntity String compressAlgo indexedLogsMeta getCompressName List IndexedFileLogMeta candidates ArrayList indexedLogsMeta String List IndexedFileLogMeta IndexedFileLogMeta log log log candidates add log candidates
candidate getLastModifiedTime startTime candidate getLastModifiedTime endTime cbuf bufferSize InputStream in in compressName createDecompressionStream BoundedRangeFileInputStream fsin candidate getStartIndex candidate getFileCompressedSize decompressor LogAggregationIndexedFileController getFSInputBufferSize conf logLength candidate getFileSize html pre __ __ html p __ candidate getFileName __ html p __ Times format candidate getLastModifiedTime __ html p __ Long toString logLength __ range checkParseRange html start end startTime endTime logLength candidate getFileName processContainerLog html range in bufferSize cbuf foundLog
fsDataIStream fileContext open remoteLogPath end fileLength end fileContext getFileStatus remoteLogPath getLen end fsDataIStream seek fileLength Integer SIZE Byte SIZE UUID_LENGTH offset fsDataIStream readInt offset LOG warn remoteLogPath offset uuidRead UUID_LENGTH uuidReadLen fsDataIStream read uuidRead uuid uuid createUUID appId uuidReadLen UUID_LENGTH uuid uuidRead LOG
String logFile e String message logFile getAbsolutePath e getMessage
record increcleanupOldLogTimes closeWriter Path renamedPath record getRollingMonitorInterval record getRemoteNodeLogFileForApp Path record getRemoteNodeLogFileForApp getParent record getRemoteNodeLogFileForApp getName record getLogUploadTimeStamp rename record isUploadedLogsInThisCycle record FileSystem remoteFS record getRemoteNodeLogFileForApp getFileSystem conf rename remoteFS rename record getRemoteNodeTmpLogFileForApp renamedPath remoteFS delete record getRemoteNodeTmpLogFileForApp
nodeFiles HarFs get p toUri conf listStatusIterator p thisNodeFile getPath thisNodeFile getPath logUploadedTime thisNodeFile getModificationTime logUploadedTime logUploadedTime reader AggregatedLogFormat LogReader conf thisNodeFile getPath String owner Map ApplicationAccessType String appAcls owner reader getApplicationOwner appAcls reader getApplicationAcls e LOG error logEntity e
reader AggregatedLogFormat LogReader conf thisNodeFile getPath String owner Map ApplicationAccessType String appAcls owner reader getApplicationOwner appAcls reader getApplicationAcls e LOG error logEntity e String remoteUser request getRemoteUser conf owner appAcls remoteUser html h1 __ remoteUser logEntity thisNodeFile getPath getName __ LOG error remoteUser logEntity
String remoteUser request getRemoteUser remoteUser html h1 __ remoteUser logEntity thisNodeFile getPath getName __ LOG error remoteUser logEntity AggregatedLogFormat ContainerLogsReader logReader reader getContainerLogsReader containerId logReader foundLog readContainerLogs html logReader start end desiredLogType logUploadedTime startTime endTime ex LOG error logEntity ex reader
Set String knownLabels labelCollections keySet NodeId Set String entry NodeId nodeId entry getKey Set String labels entry getValue knownLabels labels String msg StringUtils join labels LOG error msg IOException msg labels Set String newLabels HashSet String getLabelsByNode nodeId newLabels addAll labels newLabels size String msg String format newLabels size nodeId getHost
NodeId Set String Set String knownLabels labelCollections keySet NodeId Set String entry NodeId nodeId entry getKey Set String labels entry getValue knownLabels labels String msg StringUtils join labels
IOException msg Set String originalLabels nodeExisted nodeId Node nm getNMInNodeSet nodeId nm originalLabels nm labels nodeExisted Host host nodeCollections get nodeId getHost host originalLabels host labels nodeExisted nodeExisted String msg nodeId
nm originalLabels nm labels nodeExisted Host host nodeCollections get nodeId getHost host originalLabels host labels nodeExisted nodeExisted String msg nodeId LOG error msg IOException msg labels originalLabels originalLabels labels
conf fsStorePath schma mgr schema schma fsWorkingPath fsStorePath manager mgr initFileSystem conf fs mkdirs fsWorkingPath
loadFromMirror mirrorPath oldMirrorPath editLogPath Path fsWorkingPath schema editLogName loadManagerFromEditLog editLogPath Path writingMirrorPath Path fsWorkingPath schema mirrorName os fs create writingMirrorPath StoreOp op FSStoreOpHandler getMirrorOp storeType op write os manager fs mirrorPath fs delete oldMirrorPath fs rename mirrorPath oldMirrorPath fs rename writingMirrorPath mirrorPath fs delete writingMirrorPath fs delete oldMirrorPath editlogOs fs create editLogPath editlogOs close
editLogPath Path fsWorkingPath schema editLogName loadManagerFromEditLog editLogPath Path writingMirrorPath Path fsWorkingPath schema mirrorName os fs create writingMirrorPath StoreOp op FSStoreOpHandler getMirrorOp storeType op write os manager fs mirrorPath fs delete oldMirrorPath fs rename mirrorPath oldMirrorPath fs rename writingMirrorPath mirrorPath fs delete writingMirrorPath fs delete oldMirrorPath editlogOs fs create editLogPath editlogOs close LOG info mirrorPath toString
YarnAuthorizationProvider conf YarnAuthorizationProvider authorizer Class authorizerClass conf getClass YarnConfiguration YARN_AUTHORIZATION_PROVIDER ConfiguredYarnAuthorizer authorizer YarnAuthorizationProvider ReflectionUtils newInstance authorizerClass conf authorizer init conf
FileAppender fApp File file File System getProperty targetFilename fApp FileAppender layout file getAbsolutePath ie LOG warn file getAbsolutePath ie ie fApp setName AdHocLogDumper AD_HOC_DUMPER_APPENDER fApp setThreshold targetLevel appenders appenders Object obj appenders nextElement obj AppenderSkeleton AppenderSkeleton appender AppenderSkeleton obj appenderLevels put appender getName appender getThreshold appender setThreshold currentEffectiveLevel
contents IOException configFile ObjectMapper mapper ObjectMapper JsonFactory factory mapper getJsonFactory JsonParser parser factory createJsonParser contents JsonNode rootNode mapper readTree parser Credentials credentials Credentials rootNode CONFIG_AUTHS_KEY Iterator String iter rootNode get CONFIG_AUTHS_KEY getFieldNames iter String registryUrl iter next String registryCred rootNode get CONFIG_AUTHS_KEY get registryUrl get CONFIG_AUTH_KEY asText TokenIdentifier tokenId DockerCredentialTokenIdentifier registryUrl applicationId Token DockerCredentialTokenIdentifier token Token tokenId getBytes registryCred getBytes Charset forName tokenId getKind Text registryUrl credentials addToken Text registryUrl applicationId token
Credentials tokens Credentials credentials Credentials DataInputByteBuffer dibb DataInputByteBuffer tokens rewind dibb reset tokens credentials readTokenStorageStream dibb tokens rewind credentials
foundDockerCred ObjectMapper mapper ObjectMapper ObjectNode rootNode mapper createObjectNode ObjectNode registryUrlNode mapper createObjectNode tk tk DockerCredentialTokenIdentifier foundDockerCred DockerCredentialTokenIdentifier ti DockerCredentialTokenIdentifier tk decodeIdentifier ObjectNode registryCredNode mapper createObjectNode registryUrlNode put ti getRegistryUrl registryCredNode registryCredNode put CONFIG_AUTH_KEY String tk getPassword Charset forName
IOException e LOG debug sCopy resource getType resource getPattern Path destinationTmp Path destDirPath createDir destinationTmp cachePerms Path dFinal files makeQualified Path destinationTmp sCopy getName verifyAndCopy dFinal verifyAndCopy dFinal changePermissions dFinal getFileSystem conf dFinal
BigInteger processTotalJiffies getTotalProcessJiffies
in BufferedReader fReader ProcessSmapMemoryInfo memoryMappingInfo List String lines IOUtils readLines in String line lines line line trim Matcher address ADDRESS_PATTERN matcher line address memoryMappingInfo ProcessSmapMemoryInfo line memoryMappingInfo setPermission address group pInfo getMemoryInfoList add memoryMappingInfo Matcher memInfo MEM_INFO_PATTERN matcher line memInfo String key memInfo group trim
pInfo getMemoryInfoList add memoryMappingInfo Matcher memInfo MEM_INFO_PATTERN matcher line memInfo String key memInfo group trim String value memInfo group replace KB trim LOG debug key value memoryMappingInfo memoryMappingInfo setMemInfo key value t LOG warn line t getMessage f LOG error f toString e LOG error e toString
String processesStr processesInfoStr split Map String ProcessInfo allProcs HashMap String ProcessInfo procInfoSplitCount String processStr processesStr processStr String procInfo processStr split procInfo procInfoSplitCount ProcessInfo pInfo ProcessInfo pInfo pid procInfo pInfo vmem Long parseLong procInfo pInfo workingSet Long parseLong procInfo pInfo cpuTimeMs Long parseLong procInfo allProcs put pInfo pid pInfo
procInfoSplitCount String processStr processStr String procInfo processStr split procInfo procInfoSplitCount ProcessInfo pInfo ProcessInfo pInfo pid procInfo pInfo vmem Long parseLong procInfo pInfo workingSet Long parseLong procInfo pInfo cpuTimeMs Long parseLong procInfo allProcs put pInfo pid pInfo nfe LOG debug nfe
rhsShares maxLength diff max calculateShares clusterRes lhs rhs lhsShares rhsShares max diff max max maxLength diff calculateSharesForTwoMandatoryResources clusterRes lhs rhs lhsShares rhsShares calculateShares clusterRes lhs rhs lhsShares rhsShares Arrays sort lhsShares Arrays sort rhsShares diff compareShares lhsShares rhsShares
rc prefix webApp name Router Dest dest dest router resolve method pathInfo e rc error e e rc setStatus res SC_INTERNAL_SERVER_ERROR render ErrorPage dest rc setStatus res SC_NOT_FOUND render ErrorPage rc devMode devMode
Dest String path String key path Dest dest routes get key dest dest key path
dest method dest key path LOG debug key dest action dest dest path LOG debug key dest action dest resolveAction method dest path Map Entry String Dest lower routes lowerEntry key lower dest lower getValue dest path method dest dest path
Class Class className LOG debug className Class found Class forName className found
LOG info Object outputName specClass implClass out PrintWriter outputName hamlet basename outputName String pkg pkgName outputPkg implClass getPackage getName puts pkg implClass getName String implClassName implClass getSimpleName implClass getPackage getName pkg puts implClass getName puts hamlet implClassName specClass getSimpleName hamlet initLut specClass genImpl specClass implClassName LOG info hamlet genMethods hamlet top puts out close
LOG info Object outputName specClass implClass out PrintWriter outputName hamlet basename outputName String pkg pkgName outputPkg implClass getPackage getName puts pkg implClass getName String implClassName implClass getSimpleName implClass getPackage getName pkg puts implClass getName puts hamlet implClassName specClass getSimpleName hamlet initLut specClass genImpl specClass implClassName LOG info hamlet genMethods hamlet top puts out close
nestLevel context nestLevel
ContainerLaunchContext containerLaunchContext recordFactory newRecordInstance ContainerLaunchContext ApplicationId applicationId ApplicationId newInstance ApplicationAttemptId applicationAttemptId ApplicationAttemptId newInstance applicationId ContainerId containerId ContainerId newContainerId applicationAttemptId NodeId nodeId NodeId newInstance Resource resource Resource newInstance ContainerTokenIdentifier containerTokenIdentifier ContainerTokenIdentifier containerId resource System currentTimeMillis Priority newInstance Token containerToken newContainerToken nodeId getBytes containerTokenIdentifier StartContainerRequest scRequest StartContainerRequest newInstance containerLaunchContext containerToken List StartContainerRequest list ArrayList StartContainerRequest list add scRequest StartContainersRequest allRequests StartContainersRequest newInstance list proxy startContainers allRequests
ContainerManagementProtocol proxy ContainerManagementProtocol rpc getProxy ContainerManagementProtocol server getListenerAddress conf ApplicationId applicationId ApplicationId newInstance ApplicationAttemptId applicationAttemptId ApplicationAttemptId newInstance applicationId ContainerId containerId ContainerId newContainerId applicationAttemptId NodeId nodeId NodeId newInstance Resource resource Resource newInstance ContainerTokenIdentifier containerTokenIdentifier ContainerTokenIdentifier containerId resource System currentTimeMillis Priority newInstance Token containerToken newContainerToken nodeId getBytes containerTokenIdentifier List Token increaseTokens ArrayList increaseTokens add containerToken ContainerUpdateRequest request ContainerUpdateRequest newInstance increaseTokens proxy updateContainer request
i i methods i Method m methods i mod m getModifiers m mod mod String name m getName name m String propertyName name substring Type valueType m getGenericParameterTypes GetSetPair p ret get propertyName p p valueType p setMethod m Iterator Map Entry String GetSetPair itr ret entrySet iterator itr Map Entry String GetSetPair cur itr next GetSetPair gsp cur getValue
i i methods i Method m methods i mod m getModifiers m mod mod String name m getName name m String propertyName name substring Type valueType m getGenericParameterTypes GetSetPair p ret get propertyName p p valueType p setMethod m Iterator Map Entry String GetSetPair itr ret entrySet iterator itr Map Entry String GetSetPair cur itr next GetSetPair gsp cur getValue
mod m getModifiers m mod mod String name m getName name m String propertyName name substring Type valueType m getGenericParameterTypes GetSetPair p ret get propertyName p p valueType p setMethod m Iterator Map Entry String GetSetPair itr ret entrySet iterator itr Map Entry String GetSetPair cur itr next GetSetPair gsp cur getValue gsp gsp setMethod LOG info String format gsp propertyName
TimelineEvent event TimelineEvent event setTimestamp System currentTimeMillis event setEventType i event addEventInfo event addEventInfo entity addEvent event entity addRelatedEntity entity addRelatedEntity entity addPrimaryFilter entity addPrimaryFilter entity addOtherInfo entity addOtherInfo entity setDomainId j entities addEntity entity LOG info
TimelineEvents events TimelineEvents j j j TimelineEvents EventsOfOneEntity partEvents TimelineEvents EventsOfOneEntity partEvents setEntityId j partEvents setEntityType j i i i TimelineEvent event TimelineEvent event setTimestamp System currentTimeMillis event setEventType i event addEventInfo event addEventInfo partEvents addEvent event events addEvent partEvents LOG info
TimelinePutResponse TimelinePutErrors TimelinePutResponse TimelinePutError error1 TimelinePutError error1 setEntityId error1 setEntityId error1 setErrorCode TimelinePutError NO_START_TIME TimelinePutErrors addError error1 List TimelinePutError response ArrayList TimelinePutError response add error1 TimelinePutError error2 TimelinePutError error2 setEntityId error2 setEntityId error2 setErrorCode TimelinePutError IO_EXCEPTION response add error2 TimelinePutErrors addErrors response LOG info
TimelineEvent event2 TimelineEvent event2 setId event2 addInfo event2 addInfo Arrays asList event2 addInfo Assert assertTrue event2 getInfo get Boolean event2 setTimestamp entity addEvent event2 Assert assertFalse event1 equals event2 TimelineEvent event3 TimelineEvent event3 setId event3 setTimestamp Assert assertEquals event3 event1 Assert assertNotEquals event1 event2 entity setCreatedTime
event2 setTimestamp entity addEvent event2 Assert assertFalse event1 equals event2 TimelineEvent event3 TimelineEvent event3 setId event3 setTimestamp Assert assertEquals event3 event1 Assert assertNotEquals event1 event2 entity setCreatedTime entity addRelatesToEntity entity addRelatesToEntity entity addIsRelatedToEntity entity addIsRelatedToEntity LOG info TimelineUtils dumpTimelineRecordtoJSON entity TimelineEntities entities TimelineEntities
appAttempt setId ApplicationAttemptId newInstance ApplicationId newInstance toString ContainerEntity container ContainerEntity container setId ContainerId newContainerId ApplicationAttemptId newInstance ApplicationId newInstance toString cluster addChild TimelineEntityType YARN_FLOW_RUN toString flow1 getId flow1 setParent TimelineEntityType YARN_CLUSTER toString cluster getId flow1 addChild TimelineEntityType YARN_FLOW_RUN toString flow2 getId flow2 setParent TimelineEntityType YARN_FLOW_RUN toString flow1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app2 getId app1 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId app1 addChild TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId appAttempt setParent TimelineEntityType YARN_APPLICATION toString app1 getId app2 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId appAttempt addChild TimelineEntityType YARN_CONTAINER toString container getId container setParent TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId
ContainerEntity container ContainerEntity container setId ContainerId newContainerId ApplicationAttemptId newInstance ApplicationId newInstance toString cluster addChild TimelineEntityType YARN_FLOW_RUN toString flow1 getId flow1 setParent TimelineEntityType YARN_CLUSTER toString cluster getId flow1 addChild TimelineEntityType YARN_FLOW_RUN toString flow2 getId flow2 setParent TimelineEntityType YARN_FLOW_RUN toString flow1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app2 getId app1 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId app1 addChild TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId appAttempt setParent TimelineEntityType YARN_APPLICATION toString app1 getId app2 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId appAttempt addChild TimelineEntityType YARN_CONTAINER toString container getId container setParent TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId LOG info TimelineUtils dumpTimelineRecordtoJSON cluster
container setId ContainerId newContainerId ApplicationAttemptId newInstance ApplicationId newInstance toString cluster addChild TimelineEntityType YARN_FLOW_RUN toString flow1 getId flow1 setParent TimelineEntityType YARN_CLUSTER toString cluster getId flow1 addChild TimelineEntityType YARN_FLOW_RUN toString flow2 getId flow2 setParent TimelineEntityType YARN_FLOW_RUN toString flow1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app2 getId app1 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId app1 addChild TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId appAttempt setParent TimelineEntityType YARN_APPLICATION toString app1 getId app2 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId appAttempt addChild TimelineEntityType YARN_CONTAINER toString container getId container setParent TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId LOG info TimelineUtils dumpTimelineRecordtoJSON cluster LOG info TimelineUtils dumpTimelineRecordtoJSON flow1
cluster addChild TimelineEntityType YARN_FLOW_RUN toString flow1 getId flow1 setParent TimelineEntityType YARN_CLUSTER toString cluster getId flow1 addChild TimelineEntityType YARN_FLOW_RUN toString flow2 getId flow2 setParent TimelineEntityType YARN_FLOW_RUN toString flow1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app2 getId app1 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId app1 addChild TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId appAttempt setParent TimelineEntityType YARN_APPLICATION toString app1 getId app2 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId appAttempt addChild TimelineEntityType YARN_CONTAINER toString container getId container setParent TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId LOG info TimelineUtils dumpTimelineRecordtoJSON cluster LOG info TimelineUtils dumpTimelineRecordtoJSON flow1 LOG info TimelineUtils dumpTimelineRecordtoJSON flow2
flow1 setParent TimelineEntityType YARN_CLUSTER toString cluster getId flow1 addChild TimelineEntityType YARN_FLOW_RUN toString flow2 getId flow2 setParent TimelineEntityType YARN_FLOW_RUN toString flow1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app2 getId app1 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId app1 addChild TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId appAttempt setParent TimelineEntityType YARN_APPLICATION toString app1 getId app2 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId appAttempt addChild TimelineEntityType YARN_CONTAINER toString container getId container setParent TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId LOG info TimelineUtils dumpTimelineRecordtoJSON cluster LOG info TimelineUtils dumpTimelineRecordtoJSON flow1 LOG info TimelineUtils dumpTimelineRecordtoJSON flow2 LOG info TimelineUtils dumpTimelineRecordtoJSON app1
flow1 addChild TimelineEntityType YARN_FLOW_RUN toString flow2 getId flow2 setParent TimelineEntityType YARN_FLOW_RUN toString flow1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app2 getId app1 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId app1 addChild TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId appAttempt setParent TimelineEntityType YARN_APPLICATION toString app1 getId app2 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId appAttempt addChild TimelineEntityType YARN_CONTAINER toString container getId container setParent TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId LOG info TimelineUtils dumpTimelineRecordtoJSON cluster LOG info TimelineUtils dumpTimelineRecordtoJSON flow1 LOG info TimelineUtils dumpTimelineRecordtoJSON flow2 LOG info TimelineUtils dumpTimelineRecordtoJSON app1 LOG info TimelineUtils dumpTimelineRecordtoJSON app2
flow2 setParent TimelineEntityType YARN_FLOW_RUN toString flow1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app1 getId flow2 addChild TimelineEntityType YARN_APPLICATION toString app2 getId app1 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId app1 addChild TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId appAttempt setParent TimelineEntityType YARN_APPLICATION toString app1 getId app2 setParent TimelineEntityType YARN_FLOW_RUN toString flow2 getId appAttempt addChild TimelineEntityType YARN_CONTAINER toString container getId container setParent TimelineEntityType YARN_APPLICATION_ATTEMPT toString appAttempt getId LOG info TimelineUtils dumpTimelineRecordtoJSON cluster LOG info TimelineUtils dumpTimelineRecordtoJSON flow1 LOG info TimelineUtils dumpTimelineRecordtoJSON flow2 LOG info TimelineUtils dumpTimelineRecordtoJSON app1 LOG info TimelineUtils dumpTimelineRecordtoJSON app2 LOG info TimelineUtils dumpTimelineRecordtoJSON appAttempt
UserEntity user UserEntity user setId user addInfo user addInfo
QueueEntity queue QueueEntity queue setId queue addInfo queue addInfo queue setParent TimelineEntityType YARN_QUEUE toString queue addChild TimelineEntityType YARN_QUEUE toString queue addChild TimelineEntityType YARN_QUEUE toString
localFS FileContext getLocalFSFileContext localActiveDir File getClass getSimpleName getAbsoluteFile localFS delete Path localActiveDir getAbsolutePath localActiveDir mkdir
Path workDirPath Path testWorkDir getAbsolutePath
String stderr writeSrcFile srcFilePath1 stdout data testContainerId1 toString stdout writeSrcFile srcFilePath1 stderr data testContainerId1 toString stderr UserGroupInformation ugi UserGroupInformation getCurrentUser logWriter logWriter initialize conf remoteAppLogFile ugi LogKey logKey LogKey testContainerId1 String randomUser LogValue logValue spy LogValue Collections singletonList srcFileRoot toString testContainerId1 randomUser when logValue getUser thenReturn randomUser thenReturn ugi getShortUserName logWriter append logKey logValue BufferedReader in BufferedReader FileReader File remoteAppLogFile toUri getRawPath String line StringBuffer sb StringBuffer line in
factory LogAggregationFileController List LogAggregationFileController fileControllers factory getConfiguredLogAggregationFileControllerList FileSystem fs FileSystem get getConf Path logPath fileControllers get getRemoteAppLogDir appId APP_OWNER
lostDescendant TEST_ROOT_DIR File separator File file File shellScript FileUtils writeStringToFile file shellScript lowestDescendant lostDescendant StandardCharsets UTF_8 Thread t RogueTaskThread t start String pid getRogueTaskPID LOG info pid ProcfsBasedProcessTree p createProcessTree pid p updateProcessTree LOG info p File leaf File lowestDescendant leaf Thread sleep
p updateProcessTree LOG info p String lostpid getPidFromPidFile lostDescendant LOG info lostpid Assert assertTrue p contains lostpid String processTreeDump p getProcessTreeDump destroyProcessTree pid isAlive isAlive isAnyProcessInTreeAlive p isAlive isAlive pid isAlive
memInfos ProcessTreeSmapMemInfo memInfos ProcessTreeSmapMemInfo String cmdLines String numProcesses cmdLines cmdLines cmdLines cmdLines cmdLines cmdLines createMemoryMappingInfo memInfos writeStatFiles procfsRootDir pids procInfos memInfos writeCmdLineFiles procfsRootDir pids cmdLines ProcfsBasedProcessTree processTree createProcessTree procfsRootDir getAbsolutePath SystemClock getInstance processTree updateProcessTree String processTreeDump processTree getProcessTreeDump
File procfsRootDir pid File pidDir File procfsRootDir pid FileUtils forceMkdir pidDir
req LOG info req
req res LOG info req LOG info res
conf String names CsiConfigUtils getCsiDriverNames conf names names String names
String driverName conf String driverEndpoint CsiConfigUtils getCsiDriverEndpoint driverName conf
NodePublishVolumeRequest request LOG debug request Csi NodePublishVolumeRequest req ProtoTranslatorFactory getTranslator NodePublishVolumeRequest Csi NodePublishVolumeRequest convertTo request
NodeUnpublishVolumeRequest request LOG debug request Csi NodeUnpublishVolumeRequest req ProtoTranslatorFactory getTranslator NodeUnpublishVolumeRequest Csi NodeUnpublishVolumeRequest convertTo request
start EpollEventLoopGroup group EpollEventLoopGroup server NettyServerBuilder forAddress GrpcHelper getSocketAddress socketAddress channelType EpollServerDomainSocketChannel workerEventLoopGroup group bossEventLoopGroup group addService FakeCsiIdentityService build server start
ApplicationReportExt app convertToApplicationReport entity field field app checkAccess app app appReport getCurrentApplicationAttemptId ApplicationAttemptReport appAttempt getApplicationAttempt app appReport getCurrentApplicationAttemptId app appReport setHost appAttempt getHost app appReport setRpcPort appAttempt getRpcPort app appReport setTrackingUrl appAttempt getTrackingUrl app appReport setOriginalTrackingUrl appAttempt getOriginalTrackingUrl e e LOG warn app appReport getApplicationId e
webApp WebApps $for ApplicationHistoryClientService ahsClientService with conf withAttribute YarnConfiguration TIMELINE_SERVICE_WEBAPP_ADDRESS conf get YarnConfiguration TIMELINE_SERVICE_WEBAPP_ADDRESS withCSRFProtection YarnConfiguration TIMELINE_CSRF_PREFIX withXFSProtection YarnConfiguration TIMELINE_XFS_PREFIX at bindAddress build ahsWebApp HttpServer2 httpServer webApp httpServer String names conf getTrimmedStrings YarnConfiguration TIMELINE_SERVICE_UI_NAMES WebAppContext webAppContext httpServer getWebAppContext String name names String webPath conf get YarnConfiguration TIMELINE_SERVICE_UI_WEB_PATH_PREFIX name String onDiskPath conf get YarnConfiguration TIMELINE_SERVICE_UI_ON_DISK_PATH_PREFIX name WebAppContext uiWebAppContext WebAppContext uiWebAppContext setContextPath webPath onDiskPath uiWebAppContext setWar onDiskPath uiWebAppContext setResourceBase onDiskPath String ALL_URLS FilterHolder filterHolders webAppContext getServletHandler getFilters
mergeApplicationHistoryData historyData startData readStartData entry ApplicationFinishData finishData parseApplicationFinishData entry value mergeApplicationHistoryData historyData finishData readFinishData readStartData readFinishData readStartData LOG warn appId readFinishData LOG warn appId LOG info appId historyData
hfReader HistoryFileReader Entry entry hfReader next entry key id ApplicationAttemptId appAttemptId ApplicationAttemptId fromString entry key id appAttemptId appId ApplicationAttemptHistoryData historyData historyDataMap get appAttemptId historyData historyData ApplicationAttemptHistoryData newInstance appAttemptId FinalApplicationStatus UNDEFINED historyDataMap put appAttemptId historyData entry key mergeApplicationAttemptHistoryData historyData parseApplicationAttemptStartData entry value entry key mergeApplicationAttemptHistoryData historyData parseApplicationAttemptFinishData entry value LOG info appId
mergeApplicationAttemptHistoryData historyData startData readStartData entry ApplicationAttemptFinishData finishData parseApplicationAttemptFinishData entry value mergeApplicationAttemptHistoryData historyData finishData readFinishData readStartData readFinishData readStartData LOG warn appAttemptId readFinishData LOG warn appAttemptId LOG info appAttemptId historyData
mergeContainerHistoryData historyData startData readStartData entry ContainerFinishData finishData parseContainerFinishData entry value mergeContainerHistoryData historyData finishData readFinishData readStartData readFinishData readStartData LOG warn containerId readFinishData LOG warn containerId LOG info containerId historyData
hfReader HistoryFileReader Entry entry hfReader next entry key id ContainerId containerId ContainerId fromString entry key id containerId appAttemptId ContainerHistoryData historyData historyDataMap get containerId historyData historyData ContainerHistoryData newInstance containerId Long MIN_VALUE Long MAX_VALUE Integer MAX_VALUE historyDataMap put containerId historyData entry key mergeContainerHistoryData historyData parseContainerStartData entry value entry key mergeContainerHistoryData historyData parseContainerFinishData entry value LOG info appAttemptId
primaryFilters primaryFilters String Object primaryFilter primaryFilters Object primaryFilterValue primaryFilter getValue key createPrimaryFilterKey entity getEntityId entity getEntityType revStartTime primaryFilter getKey primaryFilterValue writeBatch put key EMPTY_BYTES writePrimaryFilterEntries writeBatch primaryFilters key EMPTY_BYTES Map String Object otherInfo entity getOtherInfo otherInfo otherInfo String Object i otherInfo key createOtherInfoKey entity getEntityId entity getEntityType revStartTime i getKey value GenericObjectMapper write i getValue writeBatch put key value writePrimaryFilterEntries writeBatch primaryFilters key value key createDomainIdKey entity getEntityId entity getEntityType revStartTime entity entity
primaryFilters primaryFilters String Object primaryFilter primaryFilters Object primaryFilterValue primaryFilter getValue key createPrimaryFilterKey entity getEntityId entity getEntityType revStartTime primaryFilter getKey primaryFilterValue writeBatch put key EMPTY_BYTES writePrimaryFilterEntries writeBatch primaryFilters key EMPTY_BYTES Map String Object otherInfo entity getOtherInfo otherInfo otherInfo String Object i otherInfo key createOtherInfoKey entity getEntityId entity getEntityType revStartTime i getKey value GenericObjectMapper write i getValue writeBatch put key value writePrimaryFilterEntries writeBatch primaryFilters key value key createDomainIdKey entity getEntityId entity getEntityType revStartTime entity entity
entity getDomainId entity getDomainId handleError entity response TimelinePutError NO_DOMAIN writeBatch put key entity getDomainId getBytes Charset forName writePrimaryFilterEntries writeBatch primaryFilters key entity getDomainId getBytes Charset forName db write writeBatch de LOG error entity getEntityId entity getEntityType de handleError entity response TimelinePutError IO_EXCEPTION e LOG error entity getEntityId entity getEntityType e handleError entity response TimelinePutError IO_EXCEPTION
writeBatch put key entity getDomainId getBytes Charset forName writePrimaryFilterEntries writeBatch primaryFilters key entity getDomainId getBytes Charset forName db write writeBatch de LOG error entity getEntityId entity getEntityType de handleError entity response TimelinePutError IO_EXCEPTION e LOG error entity getEntityId entity getEntityType e handleError entity response TimelinePutError IO_EXCEPTION lock unlock writeLocks returnLock lock IOUtils cleanupWithLogger LOG writeBatch
typePrefix kb getBytesForLookup kb add reverseTimestamp iterator seek kb getBytesForLookup iterator entityKey iterator peekNext getKey typePrefix typePrefix length entityKey KeyParser kp KeyParser entityKey typePrefix length String entityId kp getNextString prefixlen kp getOffset deletePrefix prefixlen System arraycopy entityKey deletePrefix prefixlen writeBatch db createWriteBatch
writeBatch db createWriteBatch LOG debug entityType entityId writeBatch delete createStartTimeLookupKey entityId entityType EntityIdentifier entityIdentifier EntityIdentifier entityId entityType startTimeReadCache remove entityIdentifier startTimeWriteCache remove entityIdentifier iterator iterator key iterator peekNext getKey prefixlen key writeBatch delete key key length prefixlen key prefixlen PRIMARY_FILTERS_COLUMN kp KeyParser key prefixlen PRIMARY_FILTERS_COLUMN length
writeBatch delete key key length prefixlen key prefixlen PRIMARY_FILTERS_COLUMN kp KeyParser key prefixlen PRIMARY_FILTERS_COLUMN length String name kp getNextString Object value GenericObjectMapper read key kp getOffset deleteKeysWithPrefix writeBatch addPrimaryFilterToKey name value deletePrefix pfIterator LOG debug entityType entityId name value key prefixlen RELATED_ENTITIES_COLUMN kp KeyParser key prefixlen RELATED_ENTITIES_COLUMN length String type kp getNextString String id kp getNextString relatedEntityStartTime getStartTime id type relatedEntityStartTime
LOG debug entityType entityId name value key prefixlen RELATED_ENTITIES_COLUMN kp KeyParser key prefixlen RELATED_ENTITIES_COLUMN length String type kp getNextString String id kp getNextString relatedEntityStartTime getStartTime id type relatedEntityStartTime LOG warn id type entityId entityType writeBatch delete createReverseRelatedEntityKey id type relatedEntityStartTime entityId entityType LOG debug entityType entityId type id key prefixlen INVISIBLE_REVERSE_RELATED_ENTITIES_COLUMN kp KeyParser key prefixlen INVISIBLE_REVERSE_RELATED_ENTITIES_COLUMN length String type kp getNextString String id kp getNextString
typeCount deleteLock writeLock lock iterator getDbIterator pfIterator getDbIterator InterruptedException seeked iterator pfIterator seeked typeCount totalCount seeked InterruptedException
InterruptedException seeked entityType iterator pfIterator seeked typeCount totalCount seeked InterruptedException e LOG error entityType e IOUtils cleanupWithLogger LOG iterator pfIterator deleteLock writeLock unlock typeCount
Version loadedVersion loadVersion
timestamp nextRollingCheckMillis timestamp
evictionThreshold computeCurrentCheckMillis currentTimeMillis getTimeToLive
evictionThreshold computeCurrentCheckMillis currentTimeMillis getTimeToLive LOG info getName fdf format evictionThreshold Iterator Entry Long DB iterator rollingdbs entrySet iterator iterator Entry Long DB entry iterator next entry evictionThreshold
LOG info getName Iterator Entry Long DB iterator rollingdbsToEvict entrySet iterator iterator Entry Long DB entry iterator next IOUtils cleanupWithLogger LOG entry getValue String dbName fdf format entry getKey Path path Path rollingDBPath getName dbName
localFS setPermission dbPath LEVELDB_DIR_UMASK localFS domainDBPath localFS domainDBPath IOException domainDBPath localFS setPermission domainDBPath LEVELDB_DIR_UMASK localFS starttimeDBPath localFS starttimeDBPath IOException starttimeDBPath localFS setPermission starttimeDBPath LEVELDB_DIR_UMASK localFS ownerDBPath localFS ownerDBPath IOException ownerDBPath localFS setPermission ownerDBPath LEVELDB_DIR_UMASK options maxOpenFiles conf getInt TIMELINE_SERVICE_LEVELDB_MAX_OPEN_FILES DEFAULT_TIMELINE_SERVICE_LEVELDB_MAX_OPEN_FILES options writeBufferSize conf getInt TIMELINE_SERVICE_LEVELDB_WRITE_BUFFER_SIZE DEFAULT_TIMELINE_SERVICE_LEVELDB_WRITE_BUFFER_SIZE
entityId entityType Long revStartTime getStartTimeLong entityId entityType revStartTime
domainId TimelineDataManager DEFAULT_DOMAIN_ID domainId String relatedDomainIdBytes UTF_8 domainId entity TimelinePutError error TimelinePutError error setEntityId entity getEntityId error setEntityType entity getEntityType error setErrorCode TimelinePutError FORBIDDEN_RELATION response addError error key createRelatedEntityKey relatedEntityId relatedEntityType relatedEntityStartTime entity getEntityId entity getEntityType WriteBatch relatedWriteBatch relatedRollingWriteBatch getWriteBatch relatedWriteBatch put key EMPTY_BYTES putCount RollingWriteBatch indexRollingWriteBatch indexUpdates get roundedStartTime
WriteBatch indexWriteBatch indexRollingWriteBatch getWriteBatch putCount writePrimaryFilterEntries indexWriteBatch primaryFilters markerKey EMPTY_BYTES IOException e LOG error entity getEntityId entity getEntityType e TimelinePutError error TimelinePutError error setEntityId entity getEntityId error setEntityType entity getEntityType error setErrorCode TimelinePutError IO_EXCEPTION response addError error relatedEntity Long relatedEntityStartAndInsertTime getAndSetStartTime relatedEntity getId relatedEntity getType readReverseOrderedLong revStartTime relatedEntityStartAndInsertTime IOException relatedStartTimeLong relatedEntityStartAndInsertTime
ReadOptions readOptions ReadOptions readOptions fillCache iterator starttimedb iterator readOptions iterator seekToFirst writeBatch starttimedb createWriteBatch iterator Map Entry current iterator next entityKey current getKey entityValue current getValue startTime readReverseOrderedLong entityValue startTime batchSize startTimesCount writeBatch delete entityKey batchSize
iterator starttimedb iterator iterator seekToFirst writeBatch starttimedb createWriteBatch iterator Map Entry current iterator next entityKey current getKey entityValue current getValue startTime readReverseOrderedLong entityValue startTime batchSize startTimesCount writeBatch delete entityKey batchSize LOG debug batchSize starttimedb write writeBatch
startTime readReverseOrderedLong entityValue startTime batchSize startTimesCount writeBatch delete entityKey batchSize LOG debug batchSize starttimedb write writeBatch LOG debug batchSize startTimesCount IOUtils cleanupWithLogger LOG writeBatch writeBatch starttimedb createWriteBatch batchSize totalCount LOG debug batchSize starttimedb write writeBatch
batchSize startTimesCount writeBatch delete entityKey batchSize LOG debug batchSize starttimedb write writeBatch LOG debug batchSize startTimesCount IOUtils cleanupWithLogger LOG writeBatch writeBatch starttimedb createWriteBatch batchSize totalCount LOG debug batchSize starttimedb write writeBatch LOG debug batchSize startTimesCount
Version loadedVersion loadVersion
Options options Options Path dbPath Path getConfig get YarnConfiguration TIMELINE_SERVICE_LEVELDB_STATE_STORE_PATH DB_NAME FileSystem localFS localFS FileSystem getLocal getConfig localFS dbPath localFS dbPath IOException dbPath localFS setPermission dbPath LEVELDB_DIR_UMASK IOUtils cleanupWithLogger LOG localFS JniDBFactory factory JniDBFactory options createIfMissing db factory open File dbPath toString options
IOException dbPath localFS setPermission dbPath LEVELDB_DIR_UMASK IOUtils cleanupWithLogger LOG localFS JniDBFactory factory JniDBFactory options createIfMissing db factory open File dbPath toString options LOG info dbPath toString checkVersion options createIfMissing db factory open File dbPath toString options
TimelineServiceState LOG info TimelineServiceState state TimelineServiceState numKeys loadTokenMasterKeys state numTokens loadTokens state loadLatestSequenceNumber state
Version loadedVersion loadVersion
req res init res UserGroupInformation callerUGI getUser req callerUGI String msg
req res init res UserGroupInformation callerUGI getUser req callerUGI String msg
UserGroupInformation callerUGI getUser req callerUGI String msg LOG error msg ForbiddenException msg domain setOwner callerUGI getShortUserName timelineDataManager putDomain domain callerUGI e LOG error e getMessage e ForbiddenException e e LOG error e WebApplicationException e Response Status INTERNAL_SERVER_ERROR e
metrics incrRMMasterSlaveSwitch rmId rr addResourceRequestToAsk rr release addAll remotePendingRelease blacklistAdditions addAll remoteBlacklistedNodes change putAll remotePendingChange reqs schedulingRequest addAll reqs reRegisterApplicationMaster amRegistrationRequest allocateRequest setResponseId allocateResponse allocate allocateRequest allocateResponse
T isFailover SubClusterInfo subClusterInfo T proxy current LOG info subClusterId subClusterInfo facade getSubCluster subClusterId flushFacadeCacheForYarnRMAddr isFailover updateRMAddress subClusterInfo InetSocketAddress rmAddress rmProxy getRMAddress conf protocol
T isFailover SubClusterInfo subClusterInfo T proxy current LOG info subClusterId subClusterInfo facade getSubCluster subClusterId flushFacadeCacheForYarnRMAddr isFailover updateRMAddress subClusterInfo InetSocketAddress rmAddress rmProxy getRMAddress conf protocol LOG info rmAddress subClusterId protocol getSimpleName proxy createRMProxy rmAddress proxy T T InetSocketAddress rmAddress rmProxy getRMAddress conf protocol
LOG info subClusterId subClusterInfo facade getSubCluster subClusterId flushFacadeCacheForYarnRMAddr isFailover updateRMAddress subClusterInfo originalUser InetSocketAddress rmAddress rmProxy getRMAddress conf protocol LOG info rmAddress subClusterId protocol getSimpleName proxy createRMProxy rmAddress proxy originalUser InetSocketAddress rmAddress rmProxy getRMAddress conf protocol LOG info rmAddress subClusterId protocol getSimpleName originalUser createRMProxy rmAddress
SubClusterPolicyConfiguration queue federationFacade SubClusterPolicyConfiguration configuration queue configuration federationFacade getPolicyConfiguration queue e LOG warn queue e getMessage configuration LOG info queue queue YarnConfiguration DEFAULT_FEDERATION_POLICY_KEY configuration federationFacade getPolicyConfiguration queue e LOG warn configuration
queue conf federationFacade homeSubClusterId SubClusterPolicyConfiguration configuration loadPolicyConfiguration queue conf federationFacade FederationPolicyInitializationContext context FederationPolicyInitializationContext configuration federationFacade getSubClusterResolver federationFacade homeSubClusterId
subClusterId response response getAvailableResources headroom put subClusterId response getAvailableResources
bookkeeper targetId bookkeeper addLocalizedNodeRR targetId rr targetIds resolver getSubClustersForRack rr getResourceName targetIds targetIds hasActive tid targetIds bookkeeper tid bookkeeper addRackRR tid rr hasActive hasActive
blackListSubClusters validSubClusters removeAll blackListSubClusters SubClusterId targetId ResourceRequest nodeRequest ResourceRequest rackRequest ResourceRequest anyRequest ResourceRequest rr targetId resolver getSubClusterForNode rr getResourceName nodeRequest rr e LOG error e getLocalizedMessage resolver getSubClustersForRack rr getResourceName
nodeRequest rr YarnException e LOG error e getLocalizedMessage resolver getSubClustersForRack rr getResourceName rackRequest rr YarnException e LOG error e getLocalizedMessage rr getResourceName anyRequest rr nodeRequest YarnException rackRequest YarnException
YarnException e LOG error e getLocalizedMessage resolver getSubClustersForRack rr getResourceName rackRequest rr YarnException e LOG error e getLocalizedMessage rr getResourceName anyRequest rr YarnException rackRequest YarnException anyRequest
resolver getSubClustersForRack rr getResourceName rackRequest rr YarnException e LOG error e getLocalizedMessage rr getResourceName anyRequest rr nodeRequest YarnException rackRequest YarnException anyRequest YarnException LOG info nodeRequest getResourceName rackRequest getResourceName anyRequest getResourceName
BufferedReader reader file Paths get fileName LOG info fileName reader Files newBufferedReader file Charset defaultCharset String line line reader String tokens line split tokens String nodeName tokens NODE_NAME_INDEX trim toUpperCase SubClusterId subClusterId SubClusterId newInstance tokens SUBCLUSTER_ID_INDEX trim String rackName tokens RACK_NAME_INDEX trim toUpperCase
file Paths get fileName LOG info fileName reader Files newBufferedReader file Charset defaultCharset String line line reader String tokens line split tokens String nodeName tokens NODE_NAME_INDEX trim toUpperCase SubClusterId subClusterId SubClusterId newInstance tokens SUBCLUSTER_ID_INDEX trim String rackName tokens RACK_NAME_INDEX trim toUpperCase LOG
driverClass conf get YarnConfiguration FEDERATION_STATESTORE_SQL_JDBC_CLASS YarnConfiguration DEFAULT_FEDERATION_STATESTORE_SQL_JDBC_CLASS maximumPoolSize conf getInt YarnConfiguration FEDERATION_STATESTORE_SQL_MAXCONNECTIONS YarnConfiguration DEFAULT_FEDERATION_STATESTORE_SQL_MAXCONNECTIONS userName conf get YarnConfiguration FEDERATION_STATESTORE_SQL_USERNAME password conf get YarnConfiguration FEDERATION_STATESTORE_SQL_PASSWORD url conf get YarnConfiguration FEDERATION_STATESTORE_SQL_URL Class forName driverClass e FederationStateStoreUtils logAndThrowException LOG e dataSource HikariDataSource dataSource setDataSourceClassName driverClass FederationStateStoreUtils setUsername dataSource userName FederationStateStoreUtils setPassword dataSource password FederationStateStoreUtils setProperty dataSource FederationStateStoreUtils FEDERATION_STORE_URL url dataSource setMaximumPoolSize maximumPoolSize
SubClusterId subClusterId request getApplicationHomeSubCluster getHomeSubCluster cstmt getCallableStatement CALL_SP_ADD_APPLICATION_HOME_SUBCLUSTER cstmt setString appId toString cstmt setString subClusterId getId cstmt registerOutParameter java sql Types VARCHAR cstmt registerOutParameter java sql Types INTEGER startTime clock getTime cstmt executeUpdate stopTime clock getTime subClusterHome cstmt getString SubClusterId subClusterIdHome SubClusterId newInstance subClusterHome FederationStateStoreClientMetrics succeededStateStoreCall stopTime startTime subClusterId subClusterIdHome cstmt
request FederationPolicyStoreInputValidator validate request CallableStatement cstmt SubClusterPolicyConfiguration subClusterPolicyConfiguration cstmt getCallableStatement CALL_SP_GET_POLICY_CONFIGURATION cstmt setString request getQueue cstmt registerOutParameter java sql Types VARCHAR cstmt registerOutParameter java sql Types VARBINARY startTime clock getTime cstmt executeUpdate stopTime clock getTime cstmt getString cstmt getBytes subClusterPolicyConfiguration SubClusterPolicyConfiguration newInstance request getQueue cstmt getString ByteBuffer wrap cstmt getBytes
String methodName Thread currentThread getStackTrace getMethodName MutableCounterLong methodMetric API_TO_FAILED_CALLS get methodName methodMetric
String methodName Thread currentThread getStackTrace getMethodName MutableRate methodMetric API_TO_SUCCESSFUL_CALLS get methodName MutableQuantiles methodQuantileMetric API_TO_QUANTILE_METRICS get methodName methodMetric methodQuantileMetric
LOG warn e LOG info appId retMap String scId LOG info scId appId String key getRegistryKey appId scId String tokenString readRegistry registry user key tokenString YarnException key Token AMRMTokenIdentifier amrmToken Token amrmToken decodeFromUrlString tokenString amrmToken setService Text retMap put scId amrmToken
appId Map String Token AMRMTokenIdentifier subClusterTokenMap appSubClusterTokenMap get appId
updateBlacklist blackList opportContext opportContext addToOutstandingReqs oppResourceReqs Set String nodeBlackList HashSet opportContext getBlacklist Set String allocatedNodes HashSet List Container allocatedContainers ArrayList continueLoop continueLoop continueLoop List Map Resource List Allocation allocations ArrayList opportContext remAllocs maxAllocationsPerAMHeartbeat getMaxAllocationsPerAMHeartbeat maxAllocationsPerAMHeartbeat remAllocs maxAllocationsPerAMHeartbeat allocatedContainers size getTotalAllocations allocations remAllocs
Map Resource List Allocation rmIdentifier appContext appAttId userName blackList allocatedNodes maxAllocations Map Resource List Allocation containers HashMap enrichedAsk appContext remainingAllocs maxAllocations totalAllocated List Allocation allocs containers totalAllocated allocs size remainingAllocs maxAllocations totalAllocated remainingAllocs LOG info getMaxAllocationsPerAMHeartbeat allocateContainersInternal rmIdentifier appContext getAppParams appContext getContainerIdGenerator blackList allocatedNodes appAttId appContext getNodeMap userName containers enrichedAsk remainingAllocs ResourceRequest anyAsk enrichedAsk getRequest containers
ResourceRequest anyAsk enrichedAsk getRequest toAllocate anyAsk getNumContainers allocations isEmpty allocations get anyAsk getCapability size toAllocate Math min toAllocate appParams getMaxAllocationsPerSchedulerKeyPerRound maxAllocations toAllocate Math min maxAllocations toAllocate numAllocated loopIndex OFF_SWITCH_LOOP enrichedAsk size loopIndex NODE_LOCAL_LOOP numAllocated toAllocate Collection RemoteNode nodeCandidates findNodeCandidates loopIndex allNodes blacklist allocatedNodes enrichedAsk RemoteNode rNode nodeCandidates String rNodeHost rNode getNodeId getHost blacklist rNodeHost
loopIndex OFF_SWITCH_LOOP enrichedAsk loopIndex NODE_LOCAL_LOOP Collection RemoteNode nodeCandidates findNodeCandidates loopIndex allNodes blacklist allocatedNodes enrichedAsk RemoteNode rNode nodeCandidates String rNodeHost rNode getNodeId getHost blacklist rNodeHost LOG info rNodeHost String location ResourceRequest ANY loopIndex NODE_LOCAL_LOOP enrichedAsk rNodeHost location rNodeHost
String location ResourceRequest ANY rNodeHost location rNodeHost rNodeHost LOG info rNodeHost rNode getRackName location rNode getRackName Container container createContainer rmIdentifier appParams idCounter id userName allocations location anyAsk rNode
SchedulerRequestKey schedulerKey SchedulerRequestKey create request Map Resource EnrichedResourceRequest reqMap outstandingOpReqs get schedulerKey reqMap reqMap HashMap outstandingOpReqs put schedulerKey reqMap EnrichedResourceRequest eReq reqMap get request getCapability eReq eReq EnrichedResourceRequest request reqMap put request getCapability eReq ResourceRequest request getResourceName eReq getRequest setResourceName ResourceRequest ANY eReq getRequest setNumContainers request getNumContainers eReq addLocation request getResourceName request getNumContainers ResourceRequest request getResourceName
LOG warn addressList size uamId addressList completionService KillApplicationResponse KillApplicationResponse LOG info uamId appIdMap get uamId unmanagedAppMasterMap remove uamId forceKillApplication e LOG error e addressList size Future KillApplicationResponse future completionService take future get
RegisterApplicationMasterResponse registerApplicationMaster request registerRequest request LOG info applicationId RegisterApplicationMasterResponse response rmProxyRelayer registerApplicationMaster registerRequest heartbeatHandler resetLastResponseId response
SubmitApplicationRequest submitRequest recordFactory newRecordInstance SubmitApplicationRequest ApplicationSubmissionContext context recordFactory newRecordInstance ApplicationSubmissionContext context setApplicationId appId context setApplicationName APP_NAME appNameSuffix queueName context setQueue conf get DEFAULT_QUEUE_CONFIG YarnConfiguration DEFAULT_QUEUE_NAME context setQueue queueName ContainerLaunchContext amContainer recordFactory newRecordInstance ContainerLaunchContext Resource resource BuilderUtils newResource context setResource resource context setAMContainerSpec amContainer submitRequest setApplicationSubmissionContext context context setUnmanagedAM context setKeepContainersAcrossApplicationAttempts keepContainersAcrossApplicationAttempts
Credentials launchContext Credentials credentials Credentials ByteBuffer tokens launchContext getTokens tokens DataInputByteBuffer buf DataInputByteBuffer tokens rewind buf reset tokens credentials readTokenStorageStream buf credentials
puts attemptid UserGroupInformation callerUGI getCallerUGI ApplicationAttemptReport appAttemptReport GetApplicationAttemptReportRequest request GetApplicationAttemptReportRequest newInstance appAttemptId callerUGI appAttemptReport getApplicationAttemptReport request appAttemptReport callerUGI ApplicationAttemptReport ApplicationAttemptReport getApplicationAttemptReport request
puts aid UserGroupInformation callerUGI getCallerUGI ApplicationReport appReport GetApplicationReportRequest request GetApplicationReportRequest newInstance appID callerUGI appReport getApplicationReport request appReport callerUGI ApplicationReport ApplicationReport getApplicationReport request
e String message appID LOG error message e html p __ message __ appReport puts aid AppInfo app AppInfo appReport setTitle join aid Collection ApplicationAttemptReport attempts GetApplicationAttemptsRequest request GetApplicationAttemptsRequest newInstance appID attempts getApplicationAttemptsReport request
containerReport getContainerReport request containerReport ContainerReport ContainerReport ContainerReport report request report getContainerReport request ex LOG warn ex getMessage report String message appAttemptReport getApplicationAttemptId
puts containerid UserGroupInformation callerUGI getCallerUGI ContainerReport containerReport GetContainerReportRequest request GetContainerReportRequest newInstance containerId callerUGI containerReport getContainerReport request containerReport callerUGI ContainerReport ContainerReport getContainerReport request
appInfo appInfoProvider getApp req builder getAppId clusterId ex LOG warn ex getContainerLogMeta builder build appInfo getContainerLogMeta builder build appInfo String appOwner appInfo getUser builder setAppOwner appOwner WrappedLogMetaRequest request builder build String nodeHttpAddress nmId nmId nodeHttpAddress getNMWebAddressFromRM nmId ex
length LogWebServiceUtils parseLongParam size ApplicationId appId containerId getApplicationAttemptId getApplicationId BasicAppInfo appInfo appInfo appInfoProvider getApp req appId toString clusterId ex LOG warn ex LogWebServiceUtils sendStreamOutputResponse factory appId containerIdStr filename format length String appOwner appInfo getUser appInfo LogWebServiceUtils sendStreamOutputResponse factory appId appOwner containerIdStr filename format length LogWebServiceUtils appInfo String nodeHttpAddress
factory LogAggregationFileControllerFactory yarnConf base JOINER join WebAppUtils getHttpSchemePrefix yarnConf WebAppUtils getTimelineReaderWebAppURLWithoutScheme yarnConf RESOURCE_URI_STR_V2 defaultClusterid yarnConf get YarnConfiguration RM_CLUSTER_ID YarnConfiguration DEFAULT_RM_CLUSTER_ID
getEntity String path String String params ClientResponse resp getClient resource base path path queryParams params accept MediaType APPLICATION_JSON type MediaType APPLICATION_JSON get ClientResponse resp resp ClientResponse String msg resp resp getStatus resp getEntity String
validateRunning ApplicationAttemptId attemptId getAppIdentifier
ContainerId containerId applicationContainerIdMap appId containersFromPreviousAttempt add Container newInstance containerId shouldReRegisterNext InvalidApplicationMasterRequestException AMRMClientUtils APP_ALREADY_REGISTERED_MESSAGE applicationContainerIdMap put appId ArrayList ContainerId shouldReRegisterNext registerSyncObj registerSyncObj notifyAll LOG info registerSyncObj wait LOG info
validateRunning ApplicationAttemptId attemptId getAppIdentifier
validateRunning ApplicationAttemptId attemptId getAppIdentifier
ApplicationAttemptId attemptId getAppIdentifier LOG info attemptId ApplicationId appId attemptId getApplicationId String message LOG warn message ApplicationMasterNotRegisteredException message allocateSyncObj shouldWaitForSyncNextAllocate shouldWaitForSyncNextAllocate LOG info allocateSyncObj wait LOG info
e Assert fail e getMessage SubClusterRegisterRequest request FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e
e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterIdNull amRMServiceAddress clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request
FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterIdNull amRMServiceAddress clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterIdInvalid amRMServiceAddress clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability
SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterIdInvalid amRMServiceAddress clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith
SubClusterInfo subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeatNegative stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNew lastStartTimeNegative capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e
SubClusterInfo subClusterInfo SubClusterInfo newInstance subClusterId addressNull clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterId addressEmpty clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e
LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterId addressEmpty clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress addressNull rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail
e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress addressNull rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress addressEmpty rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request
FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress addressEmpty rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress addressNull rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability
SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress addressNull rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith
subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress addressNull rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress addressEmpty rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage
LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress addressEmpty rmWebServiceAddress lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress rmAdminServiceAddress addressNull lastHeartBeat stateNew lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail
SubClusterInfo subClusterInfo SubClusterInfo newInstance subClusterId addressWrong clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNull lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage contains subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress addressWrong rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNull lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e
LOG info e getMessage Assert assertTrue e getMessage contains subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress addressWrong rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNull lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage contains subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress addressWrong rmWebServiceAddress lastHeartBeat stateNull lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail
e LOG info e getMessage Assert assertTrue e getMessage contains subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress addressWrong rmWebServiceAddress lastHeartBeat stateNull lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage contains subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress rmAdminServiceAddress addressWrong lastHeartBeat stateNull lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request
FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage contains subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress rmAdminServiceAddress addressWrong lastHeartBeat stateNull lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage contains subClusterInfo SubClusterInfo newInstance subClusterId addressWrongPort clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNull lastStartTime capability
SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage contains subClusterInfo SubClusterInfo newInstance subClusterId addressWrongPort clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNull lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage contains
subClusterInfo SubClusterInfo newInstance subClusterId addressWrongPort clientRMServiceAddress rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNull lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage contains subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress addressWrongPort rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNull lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage
LOG info e getMessage Assert assertTrue e getMessage contains subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress addressWrongPort rmAdminServiceAddress rmWebServiceAddress lastHeartBeat stateNull lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage contains subClusterInfo SubClusterInfo newInstance subClusterId amRMServiceAddress clientRMServiceAddress addressWrongPort rmWebServiceAddress lastHeartBeat stateNull lastStartTime capability SubClusterRegisterRequest request SubClusterRegisterRequest newInstance subClusterInfo FederationMembershipStateStoreInputValidator validate request Assert fail
FederationMembershipStateStoreInputValidator validate request e Assert fail e getMessage SubClusterDeregisterRequest request FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterDeregisterRequest request SubClusterDeregisterRequest newInstance subClusterIdNull stateLost FederationMembershipStateStoreInputValidator validate request Assert fail e
FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterDeregisterRequest request SubClusterDeregisterRequest newInstance subClusterIdNull stateLost FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterDeregisterRequest request SubClusterDeregisterRequest newInstance subClusterIdInvalid stateLost FederationMembershipStateStoreInputValidator validate request
SubClusterDeregisterRequest request SubClusterDeregisterRequest newInstance subClusterIdNull stateLost FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterDeregisterRequest request SubClusterDeregisterRequest newInstance subClusterIdInvalid stateLost FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith
Assert assertTrue e getMessage startsWith SubClusterDeregisterRequest request SubClusterDeregisterRequest newInstance subClusterIdInvalid stateLost FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterDeregisterRequest request SubClusterDeregisterRequest newInstance subClusterId stateNull FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith
FederationMembershipStateStoreInputValidator validate request e Assert fail e getMessage SubClusterHeartbeatRequest request FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterHeartbeatRequest request SubClusterHeartbeatRequest newInstance subClusterIdNull lastHeartBeat stateLost capability FederationMembershipStateStoreInputValidator validate request Assert fail e
FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterHeartbeatRequest request SubClusterHeartbeatRequest newInstance subClusterIdNull lastHeartBeat stateLost capability FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterHeartbeatRequest request SubClusterHeartbeatRequest newInstance subClusterIdInvalid lastHeartBeat stateLost capability FederationMembershipStateStoreInputValidator validate request
SubClusterHeartbeatRequest request SubClusterHeartbeatRequest newInstance subClusterIdNull lastHeartBeat stateLost capability FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterHeartbeatRequest request SubClusterHeartbeatRequest newInstance subClusterIdInvalid lastHeartBeat stateLost capability FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith
Assert assertTrue e getMessage startsWith SubClusterHeartbeatRequest request SubClusterHeartbeatRequest newInstance subClusterIdInvalid lastHeartBeat stateLost capability FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterHeartbeatRequest request SubClusterHeartbeatRequest newInstance subClusterId lastHeartBeat stateNull capability FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith
e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterHeartbeatRequest request SubClusterHeartbeatRequest newInstance subClusterId lastHeartBeat stateNull capability FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterHeartbeatRequest request SubClusterHeartbeatRequest newInstance subClusterId lastHeartBeatNegative stateLost capability FederationMembershipStateStoreInputValidator validate request Assert fail e
Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterHeartbeatRequest request SubClusterHeartbeatRequest newInstance subClusterId lastHeartBeatNegative stateLost capability FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith SubClusterHeartbeatRequest request SubClusterHeartbeatRequest newInstance subClusterId lastHeartBeat stateLost capabilityNull FederationMembershipStateStoreInputValidator validate request Assert fail
FederationMembershipStateStoreInputValidator validate request e Assert fail e getMessage GetSubClusterInfoRequest request FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith GetSubClusterInfoRequest request GetSubClusterInfoRequest newInstance subClusterIdNull FederationMembershipStateStoreInputValidator validate request Assert fail e
FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith GetSubClusterInfoRequest request GetSubClusterInfoRequest newInstance subClusterIdNull FederationMembershipStateStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith GetSubClusterInfoRequest request GetSubClusterInfoRequest newInstance subClusterIdInvalid FederationMembershipStateStoreInputValidator validate request
FederationApplicationHomeSubClusterStoreInputValidator validate request Assert fail e Assert assertTrue e getMessage startsWith applicationHomeSubCluster AddApplicationHomeSubClusterRequest request AddApplicationHomeSubClusterRequest newInstance applicationHomeSubCluster FederationApplicationHomeSubClusterStoreInputValidator validate request Assert fail e Assert assertTrue e getMessage startsWith applicationHomeSubCluster ApplicationHomeSubCluster newInstance appId subClusterIdNull AddApplicationHomeSubClusterRequest request AddApplicationHomeSubClusterRequest newInstance applicationHomeSubCluster FederationApplicationHomeSubClusterStoreInputValidator validate request
AddApplicationHomeSubClusterRequest request AddApplicationHomeSubClusterRequest newInstance applicationHomeSubCluster FederationApplicationHomeSubClusterStoreInputValidator validate request Assert fail e Assert assertTrue e getMessage startsWith applicationHomeSubCluster ApplicationHomeSubCluster newInstance appId subClusterIdNull AddApplicationHomeSubClusterRequest request AddApplicationHomeSubClusterRequest newInstance applicationHomeSubCluster FederationApplicationHomeSubClusterStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith applicationHomeSubCluster ApplicationHomeSubCluster newInstance appId subClusterIdInvalid
FederationApplicationHomeSubClusterStoreInputValidator validate request Assert fail e Assert assertTrue e getMessage startsWith applicationHomeSubCluster UpdateApplicationHomeSubClusterRequest request UpdateApplicationHomeSubClusterRequest newInstance applicationHomeSubCluster FederationApplicationHomeSubClusterStoreInputValidator validate request Assert fail e Assert assertTrue e getMessage startsWith applicationHomeSubCluster ApplicationHomeSubCluster newInstance appId subClusterIdNull UpdateApplicationHomeSubClusterRequest request UpdateApplicationHomeSubClusterRequest newInstance applicationHomeSubCluster FederationApplicationHomeSubClusterStoreInputValidator validate request
UpdateApplicationHomeSubClusterRequest request UpdateApplicationHomeSubClusterRequest newInstance applicationHomeSubCluster FederationApplicationHomeSubClusterStoreInputValidator validate request Assert fail e Assert assertTrue e getMessage startsWith applicationHomeSubCluster ApplicationHomeSubCluster newInstance appId subClusterIdNull UpdateApplicationHomeSubClusterRequest request UpdateApplicationHomeSubClusterRequest newInstance applicationHomeSubCluster FederationApplicationHomeSubClusterStoreInputValidator validate request Assert fail e LOG info e getMessage Assert assertTrue e getMessage startsWith applicationHomeSubCluster ApplicationHomeSubCluster newInstance appId subClusterIdInvalid
ResourceBlacklistRequest blacklistRequest ResourceBlacklistRequest newInstance ArrayList ArrayList List ResourceRequest reqs Arrays asList ResourceRequest newBuilder allocationRequestId priority PRIORITY_NORMAL resourceName ResourceRequest ANY capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ResourceRequest newBuilder allocationRequestId priority PRIORITY_NORMAL resourceName ResourceRequest ANY capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ResourceRequest newBuilder allocationRequestId priority PRIORITY_NORMAL resourceName ResourceRequest ANY capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance oppCntxt updateNodeList Arrays asList RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance List Container containers allocator allocateContainers blacklistRequest reqs appAttId oppCntxt
ResourceBlacklistRequest blacklistRequest ResourceBlacklistRequest newInstance ArrayList ArrayList List ResourceRequest reqs Arrays asList ResourceRequest newBuilder allocationRequestId priority PRIORITY_NORMAL resourceName ResourceRequest ANY capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ResourceRequest newBuilder allocationRequestId priority PRIORITY_NORMAL resourceName capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ResourceRequest newBuilder allocationRequestId priority PRIORITY_NORMAL resourceName capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ResourceRequest newBuilder allocationRequestId priority PRIORITY_NORMAL resourceName ResourceRequest ANY capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ResourceRequest newBuilder allocationRequestId priority PRIORITY_NORMAL resourceName capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ResourceRequest newBuilder allocationRequestId priority PRIORITY_NORMAL resourceName capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ResourceRequest newBuilder allocationRequestId priority PRIORITY_NORMAL resourceName ResourceRequest ANY capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance oppCntxt updateNodeList Arrays asList RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance List Container containers allocator allocateContainers blacklistRequest reqs appAttId oppCntxt
ResourceBlacklistRequest blacklistRequest ResourceBlacklistRequest newInstance ArrayList ArrayList List ResourceRequest reqs Arrays asList ResourceRequest newBuilder allocationRequestId numContainers priority PRIORITY_NORMAL resourceName capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ResourceRequest newBuilder allocationRequestId numContainers priority PRIORITY_NORMAL resourceName capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ResourceRequest newBuilder allocationRequestId numContainers priority PRIORITY_NORMAL resourceName ResourceRequest ANY capability CAPABILITY_1GB relaxLocality executionType ExecutionType OPPORTUNISTIC build ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance oppCntxt updateNodeList Arrays asList RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance List Container containers allocator allocateContainers blacklistRequest reqs appAttId oppCntxt
ResourceBlacklistRequest blacklistRequest ResourceBlacklistRequest newInstance ArrayList ArrayList List ResourceRequest reqs Arrays asList ResourceRequest newInstance PRIORITY_NORMAL CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance PRIORITY_NORMAL CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance PRIORITY_NORMAL CAPABILITY_1GB OPPORTUNISTIC_REQ ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance oppCntxt updateNodeList Arrays asList RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance List Container containers allocator allocateContainers blacklistRequest reqs appAttId oppCntxt
ResourceBlacklistRequest blacklistRequest ResourceBlacklistRequest newInstance ArrayList ArrayList allocator setMaxAllocationsPerAMHeartbeat List ResourceRequest reqs Arrays asList ResourceRequest newInstance PRIORITY_NORMAL CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance PRIORITY_NORMAL CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance PRIORITY_NORMAL CAPABILITY_1GB OPPORTUNISTIC_REQ ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance oppCntxt updateNodeList Arrays asList RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance List Container containers allocator allocateContainers blacklistRequest reqs appAttId oppCntxt
ResourceBlacklistRequest blacklistRequest ResourceBlacklistRequest newInstance ArrayList ArrayList allocator setMaxAllocationsPerAMHeartbeat List ResourceRequest reqs Arrays asList ResourceRequest newInstance PRIORITY_NORMAL CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance PRIORITY_NORMAL CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance PRIORITY_NORMAL CAPABILITY_1GB OPPORTUNISTIC_REQ ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance oppCntxt updateNodeList Arrays asList RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance List Container containers allocator allocateContainers blacklistRequest reqs appAttId oppCntxt LOG info containers Assert assertEquals containers size containers allocator allocateContainers blacklistRequest ArrayList appAttId oppCntxt
ResourceBlacklistRequest blacklistRequest ResourceBlacklistRequest newInstance ArrayList ArrayList allocator setMaxAllocationsPerAMHeartbeat ExecutionTypeRequest oppRequest ExecutionTypeRequest newInstance ExecutionType OPPORTUNISTIC List ResourceRequest reqs Arrays asList ResourceRequest newInstance Priority newInstance CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance Priority newInstance CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance Priority newInstance CAPABILITY_1GB OPPORTUNISTIC_REQ ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance oppCntxt updateNodeList Arrays asList RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance List Container containers allocator allocateContainers blacklistRequest reqs appAttId oppCntxt
ResourceBlacklistRequest blacklistRequest ResourceBlacklistRequest newInstance ArrayList ArrayList allocator setMaxAllocationsPerAMHeartbeat ExecutionTypeRequest oppRequest ExecutionTypeRequest newInstance ExecutionType OPPORTUNISTIC List ResourceRequest reqs Arrays asList ResourceRequest newInstance Priority newInstance CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance Priority newInstance CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance Priority newInstance CAPABILITY_1GB OPPORTUNISTIC_REQ ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance oppCntxt updateNodeList Arrays asList RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance List Container containers allocator allocateContainers blacklistRequest reqs appAttId oppCntxt LOG info containers Assert assertEquals containers size containers allocator allocateContainers blacklistRequest ArrayList appAttId oppCntxt
ResourceBlacklistRequest blacklistRequest ResourceBlacklistRequest newInstance ArrayList ArrayList allocator setMaxAllocationsPerAMHeartbeat ExecutionTypeRequest oppRequest ExecutionTypeRequest newInstance ExecutionType OPPORTUNISTIC List ResourceRequest reqs Arrays asList ResourceRequest newInstance Priority newInstance CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance Priority newInstance CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance Priority newInstance CAPABILITY_1GB OPPORTUNISTIC_REQ ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance oppCntxt updateNodeList Arrays asList RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance List Container containers allocator allocateContainers blacklistRequest reqs appAttId oppCntxt LOG info containers Assert assertEquals containers size containers allocator allocateContainers blacklistRequest ArrayList appAttId oppCntxt LOG info containers Assert assertEquals containers size containers allocator allocateContainers blacklistRequest ArrayList appAttId oppCntxt
oppCntxt spy oppCntxt OpportunisticSchedulerMetrics metrics mock OpportunisticSchedulerMetrics when oppCntxt getOppSchedulerMetrics thenReturn metrics ResourceBlacklistRequest blacklistRequest ResourceBlacklistRequest newInstance Collections emptyList Collections emptyList List ResourceRequest reqs Arrays asList ResourceRequest newInstance PRIORITY_NORMAL CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance PRIORITY_NORMAL CAPABILITY_1GB OPPORTUNISTIC_REQ ResourceRequest newInstance PRIORITY_NORMAL CAPABILITY_1GB OPPORTUNISTIC_REQ ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance oppCntxt updateNodeList Arrays asList RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance RemoteNode newInstance NodeId newInstance List Container containers allocator allocateContainers blacklistRequest reqs appAttId oppCntxt
launchUAM attemptId registerApplicationMaster RegisterApplicationMasterRequest newInstance attemptId e LOG info e Object syncObj MockResourceManagerFacade getRegisterSyncObj syncObj LOG info registerAMThread start LOG info syncObj wait LOG info e
LOG warn containerId ExitCode TERMINATED getExitCode String pid ProcessIdFileReader getProcessId pidPath pid IOException containerId LOG info containerId pid ContainerLivenessContext livenessContext ContainerLivenessContext Builder setContainer container setUser user setPid pid build livenessContext Thread sleep sleepMsec msecLeft exitCodeFileTimeout String exitCodeFile ContainerLaunch getExitCodeFile pidPath toString File file File exitCodeFile file msecLeft containerId
String output String shExecOutput output shExecOutput String shExecOutput
container container getLocalizedResources Map Path Path symLinks resolveSymLinks container getLocalizedResources container getUser Map Path Path symLinks
InetSocketAddress nmAddr ctx getNmAddr String user ctx getUser String appId ctx getAppId String locId ctx getLocId LocalDirsHandlerService dirsHandler ctx getDirsHandler List String localDirs dirsHandler getLocalDirs List String logDirs dirsHandler getLogDirs createUserLocalDirs localDirs user createUserCacheDirs localDirs user createAppDirs localDirs user appId createAppLogDirs appId logDirs user Path appStorageDir getWorkingDir localDirs user appId String tokenFn String format TOKEN_FILE_NAME_FMT locId Path tokenDst Path appStorageDir tokenFn copyFile nmPrivateContainerTokensPath tokenDst user
LocalDirsHandlerService dirsHandler ctx getDirsHandler List String localDirs dirsHandler getLocalDirs List String logDirs dirsHandler getLogDirs createUserLocalDirs localDirs user createUserCacheDirs localDirs user createAppDirs localDirs user appId createAppLogDirs appId logDirs user Path appStorageDir getWorkingDir localDirs user appId String tokenFn String format TOKEN_FILE_NAME_FMT locId Path tokenDst Path appStorageDir tokenFn copyFile nmPrivateContainerTokensPath tokenDst user LOG info nmPrivateContainerTokensPath tokenDst FileContext localizerFc FileContext getFileContext lfs getDefaultFileSystem getConf localizerFc setUMask lfs getUMask localizerFc setWorkingDirectory appStorageDir
copyFile nmPrivateTokensPath tokenDst user nmPrivateKeystorePath Path keystoreDst Path containerWorkDir ContainerLaunch KEYSTORE_FILE copyFile nmPrivateKeystorePath keystoreDst user nmPrivateTruststorePath Path truststoreDst Path containerWorkDir ContainerLaunch TRUSTSTORE_FILE copyFile nmPrivateTruststorePath truststoreDst user Path launchDst Path containerWorkDir ContainerLaunch CONTAINER_SCRIPT copyFile nmPrivateContainerScriptPath launchDst user LocalWrapperScriptBuilder sb getLocalWrapperScriptBuilder containerIdStr containerWorkDir sb getWrapperScriptPath WIN_MAX_PATH IOException String format sb getWrapperScriptPath WIN_MAX_PATH YarnConfiguration NM_LOCAL_DIRS Path pidFile getPidFilePath containerId pidFile sb writeLocalWrapperScript launchDst pidFile
copyFile nmPrivateContainerScriptPath launchDst user LocalWrapperScriptBuilder sb getLocalWrapperScriptBuilder containerIdStr containerWorkDir Shell sb getWrapperScriptPath toString WIN_MAX_PATH IOException String format sb getWrapperScriptPath WIN_MAX_PATH YarnConfiguration NM_LOCAL_DIRS Path pidFile getPidFilePath containerId pidFile sb writeLocalWrapperScript launchDst pidFile LOG info containerIdStr ExitCode TERMINATED getExitCode Shell CommandExecutor shExec setScriptExecutable launchDst user setScriptExecutable sb getWrapperScriptPath user shExec buildCommandExecutor sb getWrapperScriptPath toString containerIdStr user pidFile container getResource File containerWorkDir toUri getPath container getLaunchContext getEnvironment
String wrapperScriptPath String containerIdStr String user pidFile resource String String String command getRunCommand wrapperScriptPath containerIdStr user pidFile getConf resource
ctx String user ctx getUser String pid ctx getPid Signal signal ctx getSignal
ctx Path subDir ctx getSubDir List Path baseDirs ctx getBasedirs baseDirs baseDirs
entry add entry getKey add entry getKey LOG warn entry directoryErrorInfo put entry getKey errorInformation dir LOG warn dir errorInformation message setChanged numFailures dir dir localDirs add dir
context IOException Configuration conf getConf nmContext context PrivilegedOperation checkSetupOp PrivilegedOperation PrivilegedOperation OperationType CHECK_SETUP PrivilegedOperationExecutor privilegedOperationExecutor getPrivilegedOperationExecutor privilegedOperationExecutor executePrivilegedOperation checkSetupOp e exitCode e getExitCode LOG warn exitCode e IOException exitCode e resourceHandlerChain ResourceHandlerModule getConfiguredResourceHandlerChain conf nmContext LOG debug resourceHandlerChain resourceHandlerChain
PrivilegedOperation checkSetupOp PrivilegedOperation PrivilegedOperation OperationType CHECK_SETUP PrivilegedOperationExecutor privilegedOperationExecutor getPrivilegedOperationExecutor privilegedOperationExecutor executePrivilegedOperation checkSetupOp e exitCode e getExitCode LOG warn exitCode e IOException exitCode e resourceHandlerChain ResourceHandlerModule getConfiguredResourceHandlerChain conf nmContext LOG debug resourceHandlerChain resourceHandlerChain LOG debug resourceHandlerChain resourceHandlerChain bootstrap conf e
IOException exitCode e resourceHandlerChain ResourceHandlerModule getConfiguredResourceHandlerChain conf nmContext LOG debug resourceHandlerChain resourceHandlerChain LOG debug resourceHandlerChain resourceHandlerChain bootstrap conf e LOG error e IOException linuxContainerRuntime LinuxContainerRuntime runtime DelegatingLinuxContainerRuntime runtime initialize conf nmContext linuxContainerRuntime runtime
resourceOps add PrivilegedOperation PrivilegedOperation OperationType ADD_PID_TO_CGROUP resourcesOptions PrivilegedOperation ADD_PID_TO_CGROUP resourceOps add getArguments get getArguments resourceOps PrivilegedOperation operation PrivilegedOperationExecutor squashCGroupOperations resourceOps resourcesOptions operation getArguments get
resourceOps getArguments get getArguments LOG resourceOps PrivilegedOperation operation PrivilegedOperationExecutor squashCGroupOperations resourceOps resourcesOptions operation getArguments get e LOG error e ResourceHandlerException ResourceHandlerException e
ctx String user ctx getUser Path dir ctx getSubDir List Path baseDirs ctx getBasedirs verifyUsernamePattern user String runAsUser getRunAsUser user String dirString dir dir toUri getPath PrivilegedOperation deleteAsUserOp PrivilegedOperation PrivilegedOperation OperationType DELETE_AS_USER String deleteAsUserOp appendArgs runAsUser user Integer toString PrivilegedOperation RunAsUserCommand DELETE_AS_USER getValue dirString List String pathsToDelete ArrayList String baseDirs baseDirs
String user ctx getUser Path dir ctx getSubDir List Path baseDirs ctx getBasedirs verifyUsernamePattern user String runAsUser getRunAsUser user String dirString dir dir toUri getPath PrivilegedOperation deleteAsUserOp PrivilegedOperation PrivilegedOperation OperationType DELETE_AS_USER String deleteAsUserOp appendArgs runAsUser user Integer toString PrivilegedOperation RunAsUserCommand DELETE_AS_USER getValue dirString List String pathsToDelete ArrayList String baseDirs baseDirs LOG info dir pathsToDelete add dirString Path baseDir baseDirs Path del dir baseDir Path baseDir dir
LOG info dir pathsToDelete add dirString Path baseDir Path del dir baseDir Path baseDir dir LOG info del pathsToDelete add del toString deleteAsUserOp appendArgs baseDir toUri getPath Configuration conf getConf PrivilegedOperationExecutor privilegedOperationExecutor getPrivilegedOperationExecutor privilegedOperationExecutor executePrivilegedOperation deleteAsUserOp e exitCode e getExitCode
File String user dir List File files ArrayList PrivilegedOperation listAsUserOp PrivilegedOperation PrivilegedOperation OperationType LIST_AS_USER String String runAsUser getRunAsUser user String dirString dir dirString dir toUri getPath listAsUserOp appendArgs runAsUser user Integer toString PrivilegedOperation RunAsUserCommand LIST_AS_USER getValue dirString PrivilegedOperationExecutor privOpExecutor getPrivilegedOperationExecutor String results privOpExecutor executePrivilegedOperation listAsUserOp String file results file files add File File dirString file
PrivilegedOperationExecutor privOpExecutor PrivilegedOperationExecutor getInstance getConf privOpExecutor
String report getDisksHealthReport
nmStore nmStore stop nmStore LOG info Configuration conf getConfig Path recoveryRoot Path conf get YarnConfiguration NM_RECOVERY_DIR
LOG info containerManager cleanupContainersOnNMResync context getKnownCollectors context getKnownCollectors clear LOG info reregisterCollectors NodeStatusUpdaterImpl nodeStatusUpdater rebootNodeStatusUpdaterAndRegisterWithRM
String message
conf String message LOG error message YarnRuntimeException message nodeManagerShutdownHook ShutdownHookManager get removeShutdownHook nodeManagerShutdownHook nodeManagerShutdownHook CompositeServiceShutdownHook ShutdownHookManager get addShutdownHook nodeManagerShutdownHook SHUTDOWN_HOOK_PRIORITY shouldExitOnShutdownEvent init conf start
conf totalResource NodeManagerHardwareUtils getNodeResources conf memoryMb totalResource getMemorySize vMemToPMem conf getFloat YarnConfiguration NM_VMEM_PMEM_RATIO YarnConfiguration DEFAULT_NM_VMEM_PMEM_RATIO virtualMemoryMb Math ceil memoryMb vMemToPMem virtualCores totalResource getVirtualCores updateConfiguredResourcesViaPlugins totalResource
physicalMemoryMb memoryMb physicalCores virtualCores ResourceCalculatorPlugin rcp ResourceCalculatorPlugin getNodeResourceMonitorPlugin conf rcp physicalMemoryMb rcp getPhysicalMemorySize physicalCores rcp getNumProcessors physicalResource Resource newInstance physicalMemoryMb physicalCores tokenKeepAliveEnabled isTokenKeepAliveEnabled conf tokenRemovalDelayMs conf getInt YarnConfiguration RM_NM_EXPIRY_INTERVAL_MS YarnConfiguration DEFAULT_RM_NM_EXPIRY_INTERVAL_MS minimumResourceManagerVersion conf get YarnConfiguration NM_RESOURCEMANAGER_MINIMUM_VERSION YarnConfiguration DEFAULT_NM_RESOURCEMANAGER_MINIMUM_VERSION nodeLabelsHandler createNMNodeLabelsHandler nodeLabelsProvider nodeAttributesHandler createNMNodeAttributesHandler nodeAttributesProvider durationToTrackStoppedContainers conf getLong YARN_NODEMANAGER_DURATION_TO_TRACK_STOPPED_CONTAINERS durationToTrackStoppedContainers String message YARN_NODEMANAGER_DURATION_TO_TRACK_STOPPED_CONTAINERS
isStopped LOG info isStopped sendOutofBandHeartBeat statusUpdater join registerWithRM statusUpdater Thread statusUpdaterRunnable isStopped statusUpdater start LOG info String errorMessage
RegisterNodeManagerResponse regNMResponse Set NodeLabel nodeLabels nodeLabelsHandler getNodeLabelsForRegistration Set NodeAttribute nodeAttributes nodeAttributesHandler getNodeAttributesForRegistration List NMContainerStatus containerReports getNMContainerStatuses NodeStatus nodeStatus getNodeStatus RegisterNodeManagerRequest request RegisterNodeManagerRequest newInstance nodeId httpPort totalResource nodeManagerVersionId containerReports getRunningApplications nodeLabels physicalResource nodeAttributes nodeStatus containerReports containerReports
YarnRuntimeException message rmVersion minimumResourceManagerVersion String message rmVersion minimumResourceManagerVersion YarnRuntimeException message registeredWithRM MasterKey masterKey regNMResponse getContainerTokenMasterKey masterKey context getContainerTokenSecretManager setMasterKey masterKey masterKey regNMResponse getNMTokenMasterKey masterKey context getNMTokenSecretManager setMasterKey masterKey StringBuilder successfullRegistrationMsg StringBuilder successfullRegistrationMsg append append nodeId Resource newResource regNMResponse getResource newResource
NodeHealthStatus nodeHealthStatus context getNodeHealthStatus nodeHealthStatus setHealthReport healthChecker getHealthReport nodeHealthStatus setIsNodeHealthy healthChecker isHealthy nodeHealthStatus setLastHealthReportTime healthChecker getLastHealthReportTime
List ContainerStatus List ContainerStatus containerStatuses ArrayList ContainerStatus container ContainerId containerId container getContainerId ApplicationId applicationId containerId getApplicationAttemptId getApplicationId org apache hadoop yarn api records ContainerStatus containerStatus container cloneAndGetContainerStatus containerStatus applicationId
ContainerId containerId container getContainerId ApplicationId applicationId containerId getApplicationAttemptId getApplicationId org apache hadoop yarn api records ContainerStatus containerStatus container cloneAndGetContainerStatus containerStatus applicationId LOG debug applicationId containerId context getContainers remove containerId pendingCompletedContainers put containerId containerStatus containerId pendingCompletedContainers put containerId containerStatus addCompletedContainer containerId containerStatuses add containerStatus containerStatuses addAll pendingCompletedContainers values
recentlyStoppedContainers currentTime System currentTimeMillis Iterator Entry ContainerId Long i recentlyStoppedContainers entrySet iterator i Entry ContainerId Long mapEntry i next ContainerId cid mapEntry getKey mapEntry currentTime context cid ApplicationId appId cid getApplicationAttemptId getApplicationId appId i remove context getNMStateStore removeContainer cid
command File f File command
FsPermission perms perms FsPermission DIR_PERM
String appId ctx getAppId String locId ctx getLocId LocalDirsHandlerService dirsHandler ctx getDirsHandler List String localDirs dirsHandler getLocalDirs List String logDirs dirsHandler getLogDirs Path classpathJarPrivateDir dirsHandler getLocalPathForWrite ResourceLocalizationService NM_PRIVATE_DIR createUserLocalDirs localDirs user createUserCacheDirs localDirs user createAppDirs localDirs user appId createAppLogDirs appId logDirs user Path appStorageDir getWorkingDir localDirs user appId String tokenFn String format ContainerExecutor TOKEN_FILE_NAME_FMT locId Path tokenDst Path appStorageDir tokenFn copyFile nmPrivateContainerTokensPath tokenDst user File cwdApp File appStorageDir toString
recover LOG info RecoveredAMRMProxyState state nmContext getNMStateStore loadAMRMProxyState secretManager recover state LOG info state getAppContexts size ApplicationAttemptId entry state getAppContexts ApplicationAttemptId attemptId entry getKey
Token AMRMTokenIdentifier amrmToken String contextEntry getValue contextEntry user String contextEntry getValue contextEntry amrmToken Token amrmToken decodeFromUrlString String contextEntry getValue amrmToken setService Text amrmToken IOException attemptId user IOException attemptId Token AMRMTokenIdentifier localToken secretManager createAndGetAMRMToken attemptId Credentials amCred
contextEntry amrmToken Token amrmToken decodeFromUrlString String contextEntry getValue amrmToken setService Text amrmToken IOException attemptId IOException attemptId Token AMRMTokenIdentifier localToken secretManager createAndGetAMRMToken attemptId Credentials amCred container LOG debug container getContainerId container getContainerId attemptId container getContainerTokenIdentifier LOG debug container getContainerTokenIdentifier getContainerType container getContainerTokenIdentifier getContainerType
amrmToken decodeFromUrlString String contextEntry getValue amrmToken setService Text amrmToken IOException attemptId IOException attemptId Token AMRMTokenIdentifier localToken secretManager createAndGetAMRMToken attemptId Credentials amCred container LOG debug container getContainerId container getContainerId attemptId container getContainerTokenIdentifier LOG debug container getContainerTokenIdentifier getContainerType container getContainerTokenIdentifier getContainerType LOG info container getContainerId container getCredentials amCred container getCredentials
IOException attemptId IOException attemptId Token AMRMTokenIdentifier localToken secretManager createAndGetAMRMToken attemptId Credentials amCred container LOG debug container getContainerId container getContainerId attemptId container getContainerTokenIdentifier LOG debug container getContainerTokenIdentifier getContainerType container getContainerTokenIdentifier getContainerType LOG info container getContainerId container getCredentials amCred container getCredentials amCred LOG error attemptId
startTime clock getTime RequestInterceptorChainWrapper pipeline authorizeAndGetInterceptorChain
RegisterApplicationMasterResponse registerApplicationMaster request startTime clock getTime RequestInterceptorChainWrapper pipeline authorizeAndGetInterceptorChain LOG info request getHost request getRpcPort request getTrackingUrl pipeline getApplicationAttemptId RegisterApplicationMasterResponse response pipeline getRootInterceptor registerApplicationMaster request endTime clock getTime metrics succeededRegisterAMRequests endTime startTime
startTime clock getTime RequestInterceptorChainWrapper pipeline authorizeAndGetInterceptorChain
FinishApplicationMasterResponse finishApplicationMaster request startTime clock getTime RequestInterceptorChainWrapper pipeline authorizeAndGetInterceptorChain LOG info pipeline getApplicationAttemptId request getTrackingUrl FinishApplicationMasterResponse response pipeline getRootInterceptor finishApplicationMaster request endTime clock getTime metrics succeededFinishAMRequests endTime startTime
AllocateResponse allocate request startTime clock getTime AMRMTokenIdentifier amrmTokenIdentifier YarnServerSecurityUtils authorizeRequest RequestInterceptorChainWrapper pipeline getInterceptorChain amrmTokenIdentifier AllocateResponse allocateResponse pipeline getRootInterceptor allocate request updateAMRMTokens amrmTokenIdentifier pipeline allocateResponse endTime clock getTime metrics succeededAllocateRequests endTime startTime
applicationAttemptId RequestInterceptorChainWrapper chainWrapper applPipelineMap applPipelineMap applicationAttemptId getApplicationId LOG warn applicationAttemptId toString RequestInterceptorChainWrapper chainWrapperBackup applPipelineMap get applicationAttemptId getApplicationId chainWrapperBackup chainWrapperBackup chainWrapperBackup applicationAttemptId
LOG warn applicationAttemptId getApplicationId ex chainWrapper RequestInterceptorChainWrapper applPipelineMap put applicationAttemptId getApplicationId chainWrapper LOG info applicationAttemptId user RequestInterceptor interceptorChain createRequestInterceptorChain interceptorChain init createApplicationMasterContext nmContext applicationAttemptId user amrmToken localToken credentials registry recoveredDataMap YarnRuntimeException interceptorChain recover recoveredDataMap chainWrapper init interceptorChain applicationAttemptId nmContext
applicationId Preconditions checkArgument applicationId RequestInterceptorChainWrapper pipeline applPipelineMap remove applicationId pipeline
Preconditions checkArgument applicationId RequestInterceptorChainWrapper pipeline applPipelineMap remove applicationId pipeline LOG info applicationId secretManager applicationMasterFinished pipeline getApplicationAttemptId LOG info applicationId pipeline getRootInterceptor shutdown ex LOG warn applicationId ex nmContext getNMStateStore nmContext getNMStateStore removeAMRMProxyAppContext pipeline getApplicationAttemptId
AMRMProxyApplicationContextImpl context AMRMProxyApplicationContextImpl pipeline getRootInterceptor getApplicationContext allocateResponse getAMRMToken LOG info org apache hadoop yarn api records Token token allocateResponse getAMRMToken allocateResponse setAMRMToken org apache hadoop security token Token AMRMTokenIdentifier newToken ConverterUtils convertFromYarn token Text context setAMRMToken newToken nmContext getNMStateStore nmContext getNMStateStore storeAMRMProxyAppContextEntry context getApplicationAttemptId NMSS_AMRMTOKEN_KEY newToken encodeToUrlString getBytes e LOG error context getApplicationAttemptId e MasterKeyData nextMasterKey secretManager getNextMasterKeyData nextMasterKey nextMasterKey Token AMRMTokenIdentifier localToken context getLocalAMRMToken nextMasterKey context
writeLock lock
writeLock lock
identifier readLock lock ApplicationAttemptId applicationAttemptId identifier getApplicationAttemptId
identifier readLock lock ApplicationAttemptId applicationAttemptId identifier getApplicationAttemptId
appOwner addCredentials appContext getCredentials attemptId appContext getApplicationAttemptId ApplicationId appId attemptId getApplicationId homeSubClusterId SubClusterId newInstance YarnConfiguration getClusterId conf homeRMRelayer AMRMClientRelayer createHomeRMProxy appContext ApplicationMasterProtocol appOwner appId homeSubClusterId toString homeHeartbeartHandler createHomeHeartbeartHandler conf appId homeRMRelayer homeHeartbeartHandler setUGI appOwner homeHeartbeartHandler setDaemon homeHeartbeartHandler start lastAllocateResponse RECORD_FACTORY newRecordInstance AllocateResponse lastAllocateResponse setResponseId AMRMClientUtils PRE_REGISTER_RESPONSE_ID federationFacade FederationStateStoreFacade getInstance subClusterResolver federationFacade getSubClusterResolver policyInterpreter uamPool init conf
recoveredDataMap recoveredDataMap NMSS_REG_REQUEST_KEY RegisterApplicationMasterRequestProto pb RegisterApplicationMasterRequestProto parseFrom recoveredDataMap get NMSS_REG_REQUEST_KEY amRegistrationRequest RegisterApplicationMasterRequestPBImpl pb LOG info attemptId homeRMRelayer setAMRegistrationRequest amRegistrationRequest recoveredDataMap NMSS_REG_RESPONSE_KEY RegisterApplicationMasterResponseProto pb RegisterApplicationMasterResponseProto parseFrom recoveredDataMap get NMSS_REG_RESPONSE_KEY amRegistrationResponse RegisterApplicationMasterResponsePBImpl pb LOG info attemptId Map String Token AMRMTokenIdentifier uamMap registryClient uamMap registryClient loadStateFromRegistry attemptId getApplicationId
recoveredDataMap NMSS_REG_RESPONSE_KEY RegisterApplicationMasterResponseProto pb RegisterApplicationMasterResponseProto parseFrom recoveredDataMap get NMSS_REG_RESPONSE_KEY amRegistrationResponse RegisterApplicationMasterResponsePBImpl pb LOG info attemptId Map String Token AMRMTokenIdentifier uamMap registryClient uamMap registryClient loadStateFromRegistry attemptId getApplicationId LOG info uamMap size attemptId getApplicationId uamMap HashMap String entry recoveredDataMap entry getKey NMSS_SECONDARY_SC_PREFIX String scId entry getKey substring NMSS_SECONDARY_SC_PREFIX length Token AMRMTokenIdentifier amrmToken Token amrmToken decodeFromUrlString String entry getValue STRING_TO_BYTE_FORMAT
RegisterApplicationMasterResponseProto pb RegisterApplicationMasterResponseProto parseFrom recoveredDataMap get NMSS_REG_RESPONSE_KEY amRegistrationResponse RegisterApplicationMasterResponsePBImpl pb LOG info attemptId Map String Token AMRMTokenIdentifier uamMap registryClient uamMap registryClient loadStateFromRegistry attemptId getApplicationId LOG info uamMap size attemptId getApplicationId uamMap HashMap String entry recoveredDataMap entry getKey NMSS_SECONDARY_SC_PREFIX String scId entry getKey substring NMSS_SECONDARY_SC_PREFIX length Token AMRMTokenIdentifier amrmToken Token amrmToken decodeFromUrlString String entry getValue STRING_TO_BYTE_FORMAT uamMap put scId amrmToken
String scId entry getKey substring NMSS_SECONDARY_SC_PREFIX length Token AMRMTokenIdentifier amrmToken Token amrmToken decodeFromUrlString String entry getValue STRING_TO_BYTE_FORMAT uamMap put scId amrmToken LOG debug scId LOG info uamMap size attemptId getApplicationId containers String Token AMRMTokenIdentifier entry uamMap SubClusterId subClusterId SubClusterId newInstance entry getKey YarnConfiguration config YarnConfiguration getConf FederationProxyProviderUtil updateConfForFederation config subClusterId getId uamPool reAttachUAM subClusterId getId config attemptId getApplicationId amRegistrationResponse getQueue getApplicationContext getUser homeSubClusterId getId entry getValue subClusterId toString secondaryRelayers put subClusterId getId uamPool getAMRMClientRelayer subClusterId getId RegisterApplicationMasterResponse response uamPool registerApplicationMaster subClusterId getId amRegistrationRequest
amrmToken decodeFromUrlString String entry getValue STRING_TO_BYTE_FORMAT uamMap put scId amrmToken LOG debug scId LOG info uamMap size attemptId getApplicationId containers String entry uamMap SubClusterId subClusterId SubClusterId newInstance entry getKey YarnConfiguration config YarnConfiguration getConf FederationProxyProviderUtil updateConfForFederation config subClusterId getId uamPool reAttachUAM subClusterId getId config attemptId getApplicationId amRegistrationResponse getQueue getApplicationContext getUser homeSubClusterId getId entry getValue subClusterId toString secondaryRelayers put subClusterId getId uamPool getAMRMClientRelayer subClusterId getId RegisterApplicationMasterResponse response uamPool registerApplicationMaster subClusterId getId amRegistrationRequest lastSCResponseTime put subClusterId clock getTime subClusterTimeOut response
uamMap put scId amrmToken LOG debug scId LOG info uamMap size attemptId getApplicationId containers entry uamMap SubClusterId subClusterId SubClusterId newInstance entry getKey YarnConfiguration config YarnConfiguration getConf FederationProxyProviderUtil updateConfForFederation config subClusterId getId uamPool reAttachUAM subClusterId getId config attemptId getApplicationId amRegistrationResponse getQueue getApplicationContext getUser homeSubClusterId getId entry getValue subClusterId toString secondaryRelayers put subClusterId getId uamPool getAMRMClientRelayer subClusterId getId RegisterApplicationMasterResponse response uamPool registerApplicationMaster subClusterId getId amRegistrationRequest lastSCResponseTime put subClusterId clock getTime subClusterTimeOut container response containerIdToSubClusterIdMap put container getId subClusterId
entry SubClusterId subClusterId SubClusterId newInstance entry getKey YarnConfiguration config YarnConfiguration getConf FederationProxyProviderUtil updateConfForFederation config subClusterId getId uamPool reAttachUAM subClusterId getId config attemptId getApplicationId amRegistrationResponse getQueue getApplicationContext getUser homeSubClusterId getId entry getValue subClusterId toString secondaryRelayers put subClusterId getId uamPool getAMRMClientRelayer subClusterId getId RegisterApplicationMasterResponse response uamPool registerApplicationMaster subClusterId getId amRegistrationRequest lastSCResponseTime put subClusterId clock getTime subClusterTimeOut container response getContainersFromPreviousAttempts containerIdToSubClusterIdMap put container getId subClusterId containers LOG debug subClusterId container getId LOG info response getContainersFromPreviousAttempts size subClusterId
YarnConfiguration config YarnConfiguration getConf FederationProxyProviderUtil updateConfForFederation config subClusterId getId uamPool reAttachUAM subClusterId getId config attemptId getApplicationId amRegistrationResponse getQueue getApplicationContext getUser homeSubClusterId getId entry getValue subClusterId toString secondaryRelayers put subClusterId getId uamPool getAMRMClientRelayer subClusterId getId RegisterApplicationMasterResponse response uamPool registerApplicationMaster subClusterId getId amRegistrationRequest lastSCResponseTime put subClusterId clock getTime subClusterTimeOut container response getContainersFromPreviousAttempts containerIdToSubClusterIdMap put container getId subClusterId containers LOG debug subClusterId container getId LOG info response getContainersFromPreviousAttempts size subClusterId e LOG error subClusterId attemptId e UserGroupInformation appSubmitter UserGroupInformation createRemoteUser getApplicationContext getUser
getNMStateStore RegisterApplicationMasterRequestPBImpl pb RegisterApplicationMasterRequestPBImpl amRegistrationRequest getNMStateStore storeAMRMProxyAppContextEntry attemptId NMSS_REG_REQUEST_KEY pb getProto toByteArray e LOG error attemptId e amRegistrationResponse amRegistrationResponse amRegistrationResponse homeRMRelayer registerApplicationMaster request amRegistrationResponse getContainersFromPreviousAttempts cacheAllocatedContainers amRegistrationResponse getContainersFromPreviousAttempts homeSubClusterId ApplicationId appId attemptId getApplicationId reAttachUAMAndMergeRegisterResponse amRegistrationResponse appId getNMStateStore
e LOG error attemptId e amRegistrationResponse amRegistrationResponse amRegistrationResponse homeRMRelayer registerApplicationMaster request amRegistrationResponse getContainersFromPreviousAttempts cacheAllocatedContainers amRegistrationResponse getContainersFromPreviousAttempts homeSubClusterId ApplicationId appId attemptId getApplicationId reAttachUAMAndMergeRegisterResponse amRegistrationResponse appId getNMStateStore RegisterApplicationMasterResponsePBImpl pb RegisterApplicationMasterResponsePBImpl amRegistrationResponse getNMStateStore storeAMRMProxyAppContextEntry attemptId NMSS_REG_RESPONSE_KEY pb getProto toByteArray e LOG error attemptId e
FinishApplicationMasterRequest request finishAMCalled failedToUnRegister ExecutorCompletionService FinishApplicationMasterResponseInfo compSvc Set String subClusterIds uamPool getAllUAMIds subClusterIds FinishApplicationMasterRequest finishRequest request compSvc ExecutorCompletionService FinishApplicationMasterResponseInfo threadpool
FinishApplicationMasterRequest request finishAMCalled failedToUnRegister ExecutorCompletionService FinishApplicationMasterResponseInfo compSvc Set String subClusterIds uamPool getAllUAMIds subClusterIds size FinishApplicationMasterRequest finishRequest request compSvc ExecutorCompletionService FinishApplicationMasterResponseInfo threadpool LOG info subClusterIds size String subClusterIds compSvc FinishApplicationMasterResponseInfo FinishApplicationMasterResponseInfo
LOG info subClusterId FinishApplicationMasterResponse uamResponse uamResponse uamPool finishApplicationMaster subClusterId finishRequest uamResponse secondaryRelayers remove subClusterId getNMStateStore getNMStateStore removeAMRMProxyAppContextEntry attemptId NMSS_SECONDARY_SC_PREFIX subClusterId e LOG warn subClusterId attemptId e FinishApplicationMasterResponseInfo uamResponse subClusterId FinishApplicationMasterResponse homeResponse homeRMRelayer finishApplicationMaster request homeHeartbeartHandler shutdown
secondaryRelayers remove subClusterId getNMStateStore getNMStateStore removeAMRMProxyAppContextEntry attemptId NMSS_SECONDARY_SC_PREFIX subClusterId e LOG warn subClusterId attemptId e FinishApplicationMasterResponseInfo uamResponse subClusterId FinishApplicationMasterResponse homeResponse homeRMRelayer finishApplicationMaster request homeHeartbeartHandler shutdown subClusterIds size LOG info subClusterIds size subClusterIds size Future FinishApplicationMasterResponseInfo future compSvc take FinishApplicationMasterResponseInfo uamResponse future get
ExecutorCompletionService RegisterApplicationMasterResponse completionService ExecutorCompletionService threadpool Token AMRMTokenIdentifier entry SubClusterId subClusterId SubClusterId newInstance entry getKey Token AMRMTokenIdentifier amrmToken entry getValue completionService RegisterApplicationMasterResponse RegisterApplicationMasterResponse RegisterApplicationMasterResponse response YarnConfiguration config YarnConfiguration getConf FederationProxyProviderUtil updateConfForFederation config subClusterId getId uamPool reAttachUAM subClusterId getId config appId amRegistrationResponse getQueue getApplicationContext getUser homeSubClusterId getId amrmToken subClusterId toString secondaryRelayers put subClusterId getId uamPool getAMRMClientRelayer subClusterId getId response uamPool registerApplicationMaster subClusterId getId amRegistrationRequest lastSCResponseTime put subClusterId clock getTime subClusterTimeOut response response
Token AMRMTokenIdentifier entry SubClusterId subClusterId SubClusterId newInstance entry getKey Token AMRMTokenIdentifier amrmToken entry getValue RegisterApplicationMasterResponse RegisterApplicationMasterResponse RegisterApplicationMasterResponse response YarnConfiguration config YarnConfiguration getConf FederationProxyProviderUtil updateConfForFederation config subClusterId getId uamPool reAttachUAM subClusterId getId config appId amRegistrationResponse getQueue getApplicationContext getUser homeSubClusterId getId amrmToken subClusterId toString secondaryRelayers put subClusterId getId uamPool getAMRMClientRelayer subClusterId getId response uamPool registerApplicationMaster subClusterId getId amRegistrationRequest lastSCResponseTime put subClusterId clock getTime subClusterTimeOut response response getContainersFromPreviousAttempts cacheAllocatedContainers response getContainersFromPreviousAttempts subClusterId
FederationProxyProviderUtil updateConfForFederation config subClusterId getId uamPool reAttachUAM subClusterId getId config appId amRegistrationResponse getQueue getApplicationContext getUser homeSubClusterId getId amrmToken subClusterId toString secondaryRelayers put subClusterId getId uamPool getAMRMClientRelayer subClusterId getId response uamPool registerApplicationMaster subClusterId getId amRegistrationRequest lastSCResponseTime put subClusterId clock getTime subClusterTimeOut response response getContainersFromPreviousAttempts cacheAllocatedContainers response getContainersFromPreviousAttempts subClusterId LOG info subClusterId appId e LOG error subClusterId appId e response Future RegisterApplicationMasterResponse future completionService take
lastSCResponseTime put subClusterId clock getTime subClusterTimeOut uamRegisterFutures clear scId String subClusterId scId getId YarnConfiguration config YarnConfiguration getConf FederationProxyProviderUtil updateConfForFederation config subClusterId RegisterApplicationMasterResponse uamResponse Token AMRMTokenIdentifier token token uamPool launchUAM subClusterId config attemptId getApplicationId amRegistrationResponse getQueue getApplicationContext getUser homeSubClusterId toString subClusterId secondaryRelayers put subClusterId uamPool getAMRMClientRelayer subClusterId uamResponse uamPool registerApplicationMaster subClusterId amRegistrationRequest
uamRegisterFutures clear scId String subClusterId scId getId YarnConfiguration config YarnConfiguration getConf FederationProxyProviderUtil updateConfForFederation config subClusterId RegisterApplicationMasterResponse uamResponse Token AMRMTokenIdentifier token token uamPool launchUAM subClusterId config attemptId getApplicationId amRegistrationResponse getQueue getApplicationContext getUser homeSubClusterId toString subClusterId secondaryRelayers put subClusterId uamPool getAMRMClientRelayer subClusterId uamResponse uamPool registerApplicationMaster subClusterId amRegistrationRequest e LOG error subClusterId attemptId e
String subClusterId scId getId YarnConfiguration config YarnConfiguration getConf FederationProxyProviderUtil updateConfForFederation config subClusterId RegisterApplicationMasterResponse uamResponse Token AMRMTokenIdentifier token token uamPool launchUAM subClusterId config attemptId getApplicationId amRegistrationResponse getQueue getApplicationContext getUser homeSubClusterId toString subClusterId secondaryRelayers put subClusterId uamPool getAMRMClientRelayer subClusterId uamResponse uamPool registerApplicationMaster subClusterId amRegistrationRequest e LOG error subClusterId attemptId e uamRegistrations put scId uamResponse LOG info subClusterId attemptId
secondaryRelayers put subClusterId uamPool getAMRMClientRelayer subClusterId uamResponse uamPool registerApplicationMaster subClusterId amRegistrationRequest e LOG error subClusterId attemptId e uamRegistrations put scId uamResponse LOG info subClusterId attemptId uamPool allocateAsync subClusterId requests get scId HeartbeatCallBack scId e LOG error subClusterId attemptId e registryClient registryClient writeAMRMTokenForUAM attemptId getApplicationId subClusterId token
String className getClassName service className className YarnRuntimeException sName String appLocalClassPath conf get String format YarnConfiguration NM_AUX_SERVICES_CLASSPATH sName appLocalClassPath appLocalClassPath createAuxServiceFromLocalClasspath service appLocalClassPath conf AuxServiceConfiguration serviceConf service getConfiguration List Path destFiles ArrayList serviceConf List AuxServiceFile files serviceConf getFiles files AuxServiceFile file files destFiles add maybeDownloadJars sName className file getSrcFile file getType conf destFiles
sName AuxiliaryService s s serviceMap remove sName serviceRecordMap remove sName serviceMetaData remove sName s
AuxiliaryService s Preconditions checkArgument validateAuxServiceName sName sName s createAuxService service conf fromConfiguration s YarnRuntimeException sName sName s getName LOG warn sName s getClass s getName s setAuxiliaryLocalPathHandler auxiliaryLocalPathHandler setStateStoreDir sName s Configuration customConf Configuration conf service entry service customConf set entry getKey entry getValue s init customConf
Preconditions checkArgument validateAuxServiceName sName sName s createAuxService service conf fromConfiguration s YarnRuntimeException sName sName s getName LOG warn sName s getClass s getName s setAuxiliaryLocalPathHandler auxiliaryLocalPathHandler setStateStoreDir sName s Configuration customConf Configuration conf service entry service customConf set entry getKey entry getValue s init customConf LOG info sName
manifestFS manifest LOG warn manifest FileStatus status status manifestFS getFileStatus manifest LOG warn manifest status LOG warn manifest status status
foundChanges AuxServiceRecord service AuxServiceRecord existingService serviceRecordMap get service getName loadedAuxServices add service getName existingService existingService service LOG debug service getName foundChanges maybeRemoveAuxService service getName AuxiliaryService s initAuxService service conf startAuxService service getName s service addService service getName s service
NMStateStoreService stateStore context getNMStateStore stateStore rsrcLocalizationSrvc recoverLocalizedResources stateStore loadLocalizationState RecoveredApplicationsState appsState stateStore loadApplicationsState ContainerManagerApplicationProto rasIterator appsState rasIterator ContainerManagerApplicationProto proto rasIterator next
p ApplicationId appId ApplicationIdPBImpl p getId Credentials creds Credentials creds readTokenStorageStream DataInputStream p getCredentials newInput List ApplicationACLMapProto aclProtoList p getAclsList Map ApplicationAccessType String acls HashMap ApplicationAccessType String aclProtoList size ApplicationACLMapProto aclProto aclProtoList acls put ProtoUtils convertFromProtoFormat aclProto getAccessType aclProto getAcl LogAggregationContext logAggregationContext p getLogAggregationContext logAggregationContext LogAggregationContextPBImpl p getLogAggregationContext FlowContext fc p getFlowContext FlowContextProto fcp p getFlowContext fc FlowContext fcp getFlowName fcp getFlowVersion fcp getFlowRunId
creds readTokenStorageStream DataInputStream p getCredentials newInput List ApplicationACLMapProto aclProtoList p getAclsList Map ApplicationAccessType String acls HashMap ApplicationAccessType String aclProtoList size ApplicationACLMapProto aclProto aclProtoList acls put ProtoUtils convertFromProtoFormat aclProto getAccessType aclProto getAcl LogAggregationContext logAggregationContext p getLogAggregationContext logAggregationContext LogAggregationContextPBImpl p getLogAggregationContext FlowContext fc p getFlowContext FlowContextProto fcp p getFlowContext fc FlowContext fcp getFlowName fcp getFlowVersion fcp getFlowRunId LOG debug fc appId fc FlowContext TimelineUtils generateDefaultFlowName appId YarnConfiguration DEFAULT_FLOW_VERSION appId getClusterTimestamp
connectAddress NetUtils getConnectAddress initialAddress server start connectAddress NetUtils getConnectAddress server NodeId nodeId buildNodeId connectAddress hostOverride NodeManager NMContext context setNodeId nodeId context getNMTokenSecretManager setNodeId nodeId context getContainerTokenSecretManager setNodeId nodeId serviceStart waitForRecoveredContainers server start connectAddress NetUtils getConnectAddress server NodeId serverNode buildNodeId connectAddress hostOverride
connectAddress NetUtils getConnectAddress initialAddress server start connectAddress NetUtils getConnectAddress server NodeId nodeId buildNodeId connectAddress hostOverride NodeManager NMContext context setNodeId nodeId context getNMTokenSecretManager setNodeId nodeId context getContainerTokenSecretManager setNodeId nodeId serviceStart waitForRecoveredContainers server start connectAddress NetUtils getConnectAddress server NodeId serverNode buildNodeId connectAddress hostOverride
LOG info applications keySet List ApplicationId appIds ArrayList ApplicationId applications keySet handle CMgrCompletedAppsEvent appIds CMgrCompletedAppsEvent Reason ON_SHUTDOWN LOG info waitStartTime System currentTimeMillis applications System currentTimeMillis waitStartTime Thread sleep ex LOG warn ex applications LOG info
LOG info handle CMgrCompletedContainersEvent containerIds CMgrCompletedContainersEvent Reason ON_NODEMANAGER_RESYNC allContainersCompleted allContainersCompleted allContainersCompleted allContainersCompleted Thread sleep ex LOG warn ex allContainersCompleted LOG info
containerTokenIdentifier String ContainerId containerId containerTokenIdentifier getContainerID String containerIdStr containerId toString String user containerTokenIdentifier getApplicationSubmitter
rsrc getValue YarnException rsrc getKey rsrc getValue Credentials credentials YarnServerSecurityUtils parseCredentials launchContext containerStartTime SystemClock getInstance getTime Container container ContainerImpl getConfig dispatcher launchContext credentials metrics containerTokenIdentifier context containerStartTime ApplicationId applicationID containerId getApplicationAttemptId getApplicationId context containerId container NMAuditLogger logFailure remoteUser AuditConstants START_CONTAINER applicationID containerId RPCUtil getRemoteException containerIdStr readLock lock context applicationID FlowContext flowContext getFlowContext launchContext applicationID Application application ApplicationImpl dispatcher user flowContext applicationID credentials context
RPCUtil getRemoteException containerIdStr readLock lock context applicationID FlowContext flowContext getFlowContext launchContext applicationID Application application ApplicationImpl dispatcher user flowContext applicationID credentials context context applicationID application LOG info applicationID LogAggregationContext logAggregationContext containerTokenIdentifier getLogAggregationContext Map ApplicationAccessType String appAcls container getLaunchContext getApplicationACLs context getNMStateStore storeApplication applicationID buildAppProto applicationID user credentials appAcls logAggregationContext flowContext dispatcher getEventHandler handle ApplicationInitEvent applicationID appAcls logAggregationContext containerTokenIdentifier FlowContext flowContext getFlowContext launchContext applicationID
readLock lock context applicationID FlowContext flowContext getFlowContext launchContext applicationID Application application ApplicationImpl dispatcher user flowContext applicationID credentials context context applicationID application LOG info applicationID LogAggregationContext logAggregationContext containerTokenIdentifier getLogAggregationContext Map ApplicationAccessType String appAcls container getLaunchContext getApplicationACLs context getNMStateStore storeApplication applicationID buildAppProto applicationID user credentials appAcls logAggregationContext flowContext dispatcher getEventHandler handle ApplicationInitEvent applicationID appAcls logAggregationContext containerTokenIdentifier FlowContext flowContext getFlowContext launchContext applicationID flowContext
containerID String String containerIDStr containerID toString Container container context getContainers get containerID
containerID String String containerIDStr containerID toString Container container context getContainers get containerID
sb append status getCapability append sb append sb append LOG isDebugEnabled status getDiagnostics sb append sb append sb append status getExitStatus append sb append sb append status getIPs append sb append sb append status getHost append sb append sb append status getExposedPorts append sb append sb append status getContainerSubState sb append
appID Application app context getApplications get appID app
String diagnostic diagnostic diagnostic dispatcher getEventHandler handle ApplicationFinishEvent appID diagnostic containerId ApplicationId appId containerId getApplicationAttemptId getApplicationId Application app context getApplications get appId app LOG warn appId Container container app getContainers get containerId
request ContainerId containerId request getContainerId Container container context getContainers get containerId container
containerID Container container context getContainers get containerID
event writeLock lock ApplicationId applicationID event getApplicationID
event writeLock lock ContainerId containerID event getContainerID
lfs delete subDir error LOG warn subDir Path baseDir Path del subDir baseDir Path baseDir subDir LOG debug del lfs delete del error LOG warn subDir
ContainerId containerId container getContainerId String containerIdStr containerId toString
ContainerId containerId container getContainerId String containerIdStr containerId toString LOG info containerIdStr context getNMStateStore storeContainerKilled containerId e LOG error containerId e alreadyLaunched launch markLaunched launch isLaunchCompleted alreadyLaunched LOG info containerIdStr LOG debug containerIdStr exec deactivateContainer containerId Path pidFilePath launch getPidFilePath
processId user containerIdStr LOG debug processId user containerIdStr ContainerExecutor Signal signal sleepDelayBeforeSigKill ContainerExecutor Signal TERM ContainerExecutor Signal KILL result sendSignal user processId signal
ContainerId containerId container getContainerId container
ContainerId containerId container getContainerId
command ContainerId containerId container getContainerTokenIdentifier getContainerID String containerIdStr containerId toString String user container getUser Signal signal translateCommandToSignal command signal Signal
String containerIdStr containerId toString String user container getUser Signal signal translateCommandToSignal command signal Signal LOG info command LOG info command containerIdStr alreadyLaunched containerAlreadyLaunched compareAndSet alreadyLaunched LOG info containerIdStr LOG debug containerIdStr pidFilePath pidFilePath toString String processId getContainerPid processId
signal LOG info command LOG info command containerIdStr alreadyLaunched containerAlreadyLaunched compareAndSet alreadyLaunched LOG info containerIdStr LOG debug containerIdStr pidFilePath pidFilePath toString String processId getContainerPid processId LOG debug processId user containerIdStr result exec signalContainer ContainerSignalContext Builder setContainer container setUser user setPid processId setSignal signal build String diagnostics command signal processId user containerIdStr result
ContainerId containerId container getContainerId String containerIdStr containerId toString
ContainerId containerId container getContainerId String containerIdStr containerId toString LOG info containerIdStr
ContainerId containerId container getContainerId String containerIdStr containerId toString LOG info containerIdStr LOG info containerId exec pauseContainer container dispatcher getEventHandler handle ContainerEvent containerId ContainerEventType CONTAINER_PAUSED context getNMStateStore storeContainerPaused container getContainerId e LOG warn container getContainerId e e String message containerIdStr StringUtils stringifyException e
ContainerId containerId container getContainerId String containerIdStr containerId toString
ContainerId containerId container getContainerId String containerIdStr containerId toString LOG info containerIdStr alreadyPaused shouldPauseContainer compareAndSet alreadyPaused
String containerIdStr containerId toString LOG info containerIdStr alreadyPaused shouldPauseContainer compareAndSet alreadyPaused LOG info containerIdStr exec resumeContainer container dispatcher getEventHandler handle ContainerEvent containerId ContainerEventType CONTAINER_RESUMED context getNMStateStore removeContainerPaused container getContainerId e LOG warn container getContainerId e e String message containerIdStr StringUtils stringifyException e
Path containerWorkDir getContainerWorkDir cleanupContainerFiles containerWorkDir containerLogDir getContainerLogDir Map Path List String localResources getLocalizedResources String appIdStr app getAppId toString Path nmPrivateContainerScriptPath getNmPrivateContainerScriptPath appIdStr containerIdStr Path nmPrivateTokensPath getNmPrivateTokensPath appIdStr containerIdStr Path nmPrivateKeystorePath container getCredentials getSecretKey AMSecretKeys YARN_APPLICATION_AM_KEYSTORE getNmPrivateKeystorePath appIdStr containerIdStr Path nmPrivateTruststorePath container getCredentials getSecretKey AMSecretKeys YARN_APPLICATION_AM_TRUSTSTORE getNmPrivateTruststorePath appIdStr containerIdStr pidFilePath getPidFilePath appIdStr containerIdStr String pidFileSubpath getPidFileSubpath appIdStr containerIdStr pidFilePath dirsHandler getLocalPathForWrite pidFileSubpath
IOException String pidFileSubpath getPidFileSubpath appIdStr containerIdStr pidFilePath dirsHandler getLocalPathForWrite pidFileSubpath LOG info containerWorkDir toString containerLogDir toString nmPrivateContainerScriptPath toString nmPrivateTokensPath toString pidFilePath toString List String localDirs dirsHandler getLocalDirs List String logDirs dirsHandler getLogDirs List String containerLocalDirs getContainerLocalDirs localDirs List String containerLogDirs getContainerLogDirs logDirs List String filecacheDirs getNMFilecacheDirs localDirs List String userLocalDirs getUserLocalDirs localDirs List String userFilecacheDirs getUserFilecacheDirs localDirs List String applicationLocalDirs getApplicationLocalDirs localDirs appIdStr dirsHandler ret ContainerExitStatus DISKS_FAILED IOException dirsHandler getDisksHealthReport
launch RecoveredContainerLaunch context getConfig dispatcher exec app event getContainer dirsHandler containerManager containerLauncher submit launch running put containerId launch app context get containerId launch RecoverPausedContainerLaunch context getConfig dispatcher exec app event getContainer dirsHandler containerManager containerLauncher submit launch event containerId event containerId event ContainerLaunch runningContainer running get containerId runningContainer
ContainerLaunch runningContainer running get containerId runningContainer LOG info containerId runningContainer signalContainer signalEvent getCommand LOG warn containerId signalEvent getCommand ContainerLaunch launchedContainer running get containerId launchedContainer launchedContainer pauseContainer
e LOG warn containerId signalEvent getCommand launchedContainer containerId launchedContainer launchedContainer pauseContainer e LOG info StringUtils stringifyException e containerId
dispatcher getEventHandler handle ContainerEvent containerId ContainerEventType RECOVER_PAUSED_CONTAINER notInterrupted File pidFile locatePidFile appIdStr containerIdStr pidFile String pidPathStr pidFile getPath pidFilePath Path pidPathStr exec activateContainer containerId pidFilePath retCode exec reacquireContainer ContainerReacquisitionContext Builder setContainer container setUser container getUser setContainerId containerId build LOG warn containerIdStr LOG warn containerId notInterrupted
retCode exec reacquireContainer ContainerReacquisitionContext Builder setContainer container setUser container getUser setContainerId containerId build LOG warn containerIdStr e LOG warn containerId notInterrupted e LOG error containerIdStr e notInterrupted completed set exec deactivateContainer containerId getContext getNMStateStore storeContainerCompleted containerId retCode e
e LOG warn containerId notInterrupted e LOG error containerIdStr e notInterrupted completed set exec deactivateContainer containerId getContext getNMStateStore storeContainerCompleted containerId retCode e LOG error containerId retCode LOG warn retCode
dispatcher getEventHandler handle ContainerEvent containerId ContainerEventType CONTAINER_LAUNCHED notInterrupted File pidFile locatePidFile appIdStr containerIdStr pidFile String pidPathStr pidFile getPath pidFilePath Path pidPathStr exec activateContainer containerId pidFilePath retCode exec reacquireContainer ContainerReacquisitionContext Builder setContainer container setUser container getUser setContainerId containerId build LOG warn containerIdStr LOG warn containerId notInterrupted
retCode exec reacquireContainer ContainerReacquisitionContext Builder setContainer container setUser container getUser setContainerId containerId build LOG warn containerIdStr e LOG warn containerId notInterrupted e LOG error containerIdStr e notInterrupted completed set exec deactivateContainer containerId getContext getNMStateStore storeContainerCompleted containerId retCode e
e LOG warn containerId notInterrupted e LOG error containerIdStr e notInterrupted completed set exec deactivateContainer containerId getContext getNMStateStore storeContainerCompleted containerId retCode e LOG error containerId retCode LOG warn retCode
String String prefixCommands operation workingDir String String env inheritParentEnv String fullCommandArray getPrivilegedOperationExecutionCommand prefixCommands operation ShellCommandExecutor exec ShellCommandExecutor fullCommandArray workingDir env inheritParentEnv exec execute LOG LOG debug
String String prefixCommands operation workingDir String String env inheritParentEnv String fullCommandArray getPrivilegedOperationExecutionCommand prefixCommands operation ShellCommandExecutor exec ShellCommandExecutor fullCommandArray workingDir env inheritParentEnv exec execute LOG LOG debug LOG debug Arrays toString fullCommandArray LOG debug
String prefixCommands operation String fullCommandArray getPrivilegedOperationExecutionCommand prefixCommands operation ProcessBuilder pb ProcessBuilder fullCommandArray OutputStream stdin InputStream stdout pb redirectErrorStream Process p pb start stdin p getOutputStream stdout p getInputStream LOG LOG debug
resetCGroupParameters LOG info LOG info String format yarnCGroupPath oomListenerPath executor Executors newFixedThreadPool Future String errorListener executor submit IOUtils toString process getErrorStream Charset defaultCharset InputStream events process getInputStream event read read events read event event resolveOOM executor read LOG warn String format read exitCode process waitFor String error errorListener get
controller String existingMountPath getControllerPath controller String requestedMountPath File cGroupsMountConfig getMountPath controller getName getAbsolutePath existingMountPath requestedMountPath existingMountPath rwLock writeLock lock String mountOptions existingMountPath mountOptions Joiner on join parsedMtab get existingMountPath mountOptions controller getName String cGroupKV mountOptions requestedMountPath PrivilegedOperation OperationType opType PrivilegedOperation OperationType MOUNT_CGROUPS PrivilegedOperation op PrivilegedOperation opType op appendArgs cGroupPrefix cGroupKV
rwLock writeLock lock String mountOptions existingMountPath mountOptions Joiner on join parsedMtab get existingMountPath mountOptions controller getName String cGroupKV mountOptions requestedMountPath PrivilegedOperation OperationType opType PrivilegedOperation OperationType MOUNT_CGROUPS PrivilegedOperation op PrivilegedOperation opType op appendArgs cGroupPrefix cGroupKV LOG info controller getName requestedMountPath privilegedOperationExecutor executePrivilegedOperation op controllerPaths put controller requestedMountPath
String controller String cGroupId String path getPathForCGroup controller cGroupId
String str inl str inl readLine str
controller String cGroupId deleted String cGroupPath getPathForCGroup controller cGroupId
controller String cGroupId String param String String cGroupParamPath getPathForCGroupParam controller cGroupId param PrintWriter pw
getCpuUsagePercent cgroupUsage cgroup getCpuUsagePercent procfsUsage procfs getCpuUsagePercent
getCpuUsagePercent cgroupUsage cgroup getCpuUsagePercent LOG procfsUsage procfs getCpuUsagePercent LOG debug procfsUsage cgroupUsage
container containerKilled finished finished String pids cgroups getCGroupParam CGroupsHandler CGroupController MEMORY container getContainerId toString CGROUP_PROCS_FILE split finished String pids
NetworkTagMappingManager conf Class NetworkTagMappingManager managerClass conf getClass YarnConfiguration NM_NETWORK_TAG_MAPPING_MANAGER NetworkTagMappingJsonManager NetworkTagMappingManager
conf cGroupsHandler cGroupsHandler cGroupsHandler CGroupsHandlerImpl conf PrivilegedOperationExecutor getInstance conf
containerId String containerIdStr containerId toString
containerId String containerIdStr containerId toString LOG debug containerIdStr String classIdStrFromFile cGroupsHandler getCGroupParam CGroupsHandler CGroupController NET_CLS containerIdStr CGroupsHandler CGROUP_PARAM_CLASSID classId trafficController getClassIdFromFileContents classIdStrFromFile
String List String regexes ArrayList regexes add String format ROOT_QDISC_HANDLE regexes add String format ROOT_QDISC_HANDLE regexes add String format ROOT_QDISC_HANDLE ROOT_CLASS_ID regexes add String format ROOT_QDISC_HANDLE DEFAULT_CLASS_ID ROOT_QDISC_HANDLE ROOT_CLASS_ID regexes add String format ROOT_QDISC_HANDLE YARN_ROOT_CLASS_ID ROOT_QDISC_HANDLE ROOT_CLASS_ID String regex regexes Pattern pattern Pattern compile regex Pattern MULTILINE pattern
String readState BatchBuilder builder BatchBuilder PrivilegedOperation OperationType TC_READ_STATE readState PrivilegedOperation op builder commitBatchToTempFile String output privilegedOperationExecutor executePrivilegedOperation op
String state String tcClassesStr state substring state indexOf String tcClasses Pattern compile Pattern MULTILINE split tcClassesStr Pattern tcClassPattern Pattern compile String format ROOT_QDISC_HANDLE classIdSet String tcClassSplit tcClasses String tcClass tcClassSplit trim tcClass Matcher classMatcher tcClassPattern matcher tcClass classMatcher classId Integer parseInt classMatcher group classId MIN_CONTAINER_CLASS_ID classIdSet set classId MIN_CONTAINER_CLASS_ID
BatchBuilder builder BatchBuilder PrivilegedOperation OperationType TC_READ_STATS readClasses PrivilegedOperation op builder commitBatchToTempFile String output privilegedOperationExecutor executePrivilegedOperation op
Map Integer Integer BatchBuilder builder BatchBuilder PrivilegedOperation OperationType TC_READ_STATS readClasses PrivilegedOperation op builder commitBatchToTempFile String output privilegedOperationExecutor executePrivilegedOperation op LOG debug output Map Integer Integer classIdBytesStats parseStatsString output
String input String classIdStr String format Integer parseInt input
device newIPID newHash device setIPID newIPID device setAocxHash newHash
device newIPID newHash device setIPID newIPID device setAocxHash newHash LOG info newIPID device
List PrivilegedOperation container List PrivilegedOperation ret ArrayList String containerIdStr container getContainerId toString Resource requestedResource container getResource cGroupsHandler createCGroup CGroupsHandler CGroupController DEVICES containerIdStr deviceCount requestedResource getResourceValue FPGA_URI
Resource requestedResource container getResource cGroupsHandler createCGroup CGroupsHandler CGroupController DEVICES containerIdStr deviceCount requestedResource getResourceValue FPGA_URI LOG info containerIdStr deviceCount String ipFilePath String requestedIPID getRequestedIPID container String localizedIPIDHash ipFilePath vendorPlugin retrieveIPfilePath requestedIPID container getWorkDir container getResourceSet getLocalizedResources ipFilePath fis ipFilePath localizedIPIDHash DigestUtils sha256Hex fis e ResourceHandlerException e FpgaResourceAllocator FpgaAllocation allocation allocator assignFpga vendorPlugin getFpgaType deviceCount container localizedIPIDHash
e ResourceHandlerException e FpgaResourceAllocator FpgaAllocation allocation allocator assignFpga vendorPlugin getFpgaType deviceCount container localizedIPIDHash LOG info allocation PrivilegedOperation privilegedOperation PrivilegedOperation PrivilegedOperation OperationType FPGA Arrays asList CONTAINER_ID_CLI_OPTION containerIdStr allocation getDenied List Integer denied ArrayList allocation getDenied forEach device denied add device getMinor privilegedOperation appendArgs Arrays asList EXCLUDED_FPGAS_CLI_OPTION StringUtils join denied privilegedOperationExecutor executePrivilegedOperation privilegedOperation deviceCount ipFilePath vendorPlugin retrieveIPfilePath getRequestedIPID container container getWorkDir container getResourceSet getLocalizedResources ipFilePath LOG warn REQUEST_FPGA_IP_ID_KEY
container Resource requestedResource container getResource ContainerId containerId container getContainerId numRequestedGpuDevices getRequestedGpus requestedResource numRequestedGpuDevices
List List GpuDevice usableGpus usableGpus gpuDiscoverer getGpusUsableByYarn usableGpus usableGpus String message
containerId resource index index numaNodesList size index NumaNodeResource numaNode numaNodesList get currentAssignNode index numaNodesList size numaNode resource numaNode assignResources resource containerId
NumaNodeResource numaNode numaNodesList get currentAssignNode index numaNodesList size numaNode resource numaNode assignResources resource containerId LOG info numaNode getNodeId numaNode getNodeId containerId currentAssignNode currentAssignNode index numaNodesList size NumaResourceAllocation numaNode getNodeId resource getMemorySize numaNode getNodeId resource getVirtualCores memoryRequirement resource getMemorySize Map String Long memoryAllocations Maps newHashMap NumaNodeResource numaNode numaNodesList memoryRemaining numaNode assignAvailableMemory memoryRequirement containerId memoryAllocations put numaNode getNodeId memoryRequirement memoryRemaining memoryRequirement memoryRemaining memoryRequirement memoryRequirement
LOG info resource getMemorySize containerId releaseNumaResource containerId cpusRequirement resource getVirtualCores Map String Integer cpuAllocations Maps newHashMap index index numaNodesList size index NumaNodeResource numaNode numaNodesList get currentAssignNode index numaNodesList size cpusRemaining numaNode assignAvailableCpus cpusRequirement containerId cpuAllocations put numaNode getNodeId cpusRequirement cpusRemaining cpusRequirement cpusRemaining cpusRequirement currentAssignNode currentAssignNode index numaNodesList size
LOG info resource getMemorySize containerId releaseNumaResource containerId cpusRequirement resource getVirtualCores Map String Integer cpuAllocations Maps newHashMap index index numaNodesList size index NumaNodeResource numaNode numaNodesList get currentAssignNode index numaNodesList size cpusRemaining numaNode assignAvailableCpus cpusRequirement containerId cpuAllocations put numaNode getNodeId cpusRequirement cpusRemaining cpusRequirement cpusRemaining cpusRequirement currentAssignNode currentAssignNode index numaNodesList size cpusRequirement
String dockerVolumeCommand container String commandFile dockerClient writeCommandToTempFile dockerVolumeCommand container getContainerId nmContext PrivilegedOperation privOp PrivilegedOperation PrivilegedOperation OperationType RUN_DOCKER_CMD privOp appendArgs commandFile String output privilegedOperationExecutor executePrivilegedOperation privOp
dockerExecCommand setTTY List String command ArrayList String StringBuilder sb StringBuilder sb append sb append ctx getShell command add sb toString command add dockerExecCommand setOverrideCommandWithArgs command String commandFile dockerClient writeCommandToTempFile dockerExecCommand ContainerId fromString containerId nmContext PrivilegedOperation privOp PrivilegedOperation PrivilegedOperation OperationType EXEC_CONTAINER privOp appendArgs commandFile privOp disableFailureLogging IOStreamPair output output privilegedOperationExecutor executePrivilegedInteractiveOperation privOp
String getIpAndHost container ContainerId containerId container getContainerId String containerIdStr containerId toString DockerInspectCommand inspectCommand DockerInspectCommand containerIdStr getIpAndHost String output executeDockerInspect containerId inspectCommand
network defaultNetwork network defaultNetwork useHostNetwork network equalsIgnoreCase useHostNetwork InetAddress address address InetAddress getLocalHost ips address getHostAddress LOG error containerId String ipAndHost String ipAndHost ips ipAndHost host ipAndHost
network defaultNetwork useHostNetwork network equalsIgnoreCase useHostNetwork InetAddress address address InetAddress getLocalHost ips address getHostAddress LOG error containerId String ipAndHost String ipAndHost ips ipAndHost host ipAndHost
imageName start System currentTimeMillis DockerPullCommand dockerPullCommand DockerPullCommand imageName
containerIdStr imageName start System currentTimeMillis DockerPullCommand dockerPullCommand DockerPullCommand imageName LOG debug imageName containerIdStr DockerCommandExecutor executeDockerCommand dockerPullCommand containerIdStr privilegedOperationExecutor nmContext end System currentTimeMillis pullImageTimeMs end start
DockerInspectCommand inspectCommand DockerInspectCommand containerId toString get String DockerInspectCommand STATUS_TEMPLATE DockerInspectCommand STOPSIGNAL_TEMPLATE delimiter String output executeDockerInspect containerId inspectCommand trim output String statusAndSignal StringUtils split output delimiter containerStatus DockerCommandExecutor parseContainerStatus statusAndSignal statusAndSignal stopSignal statusAndSignal e LOG debug containerId e DockerCommandExecutor containerStatus DockerKillCommand dockerStopCommand DockerKillCommand containerId toString setSignal stopSignal DockerCommandExecutor executeDockerCommand dockerStopCommand containerId toString env privilegedOperationExecutor nmContext
String containerId inspectCommand String commandFile dockerClient writeCommandToTempFile inspectCommand containerId nmContext PrivilegedOperation privOp PrivilegedOperation PrivilegedOperation OperationType RUN_DOCKER_CMD privOp appendArgs commandFile String output privilegedOperationExecutor executePrivilegedOperation privOp
ctx String String env signal ContainerExecutionException Container container ctx getContainer ContainerVolumePublisher publisher ContainerVolumePublisher container container getCsiVolumesRootDir publisher unpublishVolumes e ContainerExecutionException e serviceMode Boolean parseBoolean env get ENV_DOCKER_CONTAINER_DOCKER_SERVICE_MODE container serviceMode String containerId container getContainerId toString DockerCommandExecutor DockerContainerStatus containerStatus DockerCommandExecutor getContainerStatus containerId privilegedOperationExecutor nmContext DockerCommandExecutor containerStatus DockerKillCommand dockerKillCommand DockerKillCommand containerId setSignal signal name DockerCommandExecutor executeDockerCommand dockerKillCommand containerId env privilegedOperationExecutor nmContext
String String String env String delayedRemoval env get ENV_DOCKER_CONTAINER_DELAYED_REMOVAL delayedRemoval delayedRemoval
config String driverNames CsiConfigUtils getCsiDriverNames config driverNames driverNames String driverName driverNames InetSocketAddress adaptorServiceAddress CsiConfigUtils getCsiAdaptorAddressForDriver driverName config
reapRuncLayerMountsInterval conf getInt NM_REAP_RUNC_LAYER_MOUNTS_INTERVAL DEFAULT_NM_REAP_RUNC_LAYER_MOUNTS_INTERVAL exec HadoopExecutors newScheduledThreadPool exec PrivilegedOperation launchOp PrivilegedOperation PrivilegedOperation OperationType REAP_RUNC_LAYER_MOUNTS launchOp appendArgs Integer toString layersToKeep String stdout privilegedOperationExecutor executePrivilegedOperation launchOp stdout
String pluginName conf get NM_RUNC_MANIFEST_TO_RESOURCES_PLUGIN DEFAULT_NM_RUNC_MANIFEST_TO_RESOURCES_PLUGIN
DockerContainerStatus String containerId privilegedOperationExecutor nmContext String currentContainerStatus executeStatusCommand containerId privilegedOperationExecutor nmContext DockerContainerStatus dockerContainerStatus parseContainerStatus currentContainerStatus
LocalizerStatus status createStatus LocalizerHeartbeatResponse response nodemanager heartbeat status response response newRsrc pendingResources newRsrc getResource pendingResources put newRsrc getResource cs submit download Path newRsrc getDestinationDirectory getFile newRsrc getResource ugi Path pending pendingResources pending cancel status createStatus nodemanager heartbeat status e e printStackTrace System out
String appId argv String locId argv InetSocketAddress nmAddr InetSocketAddress argv Integer parseInt argv String tokenFileName argv String sLocaldirs Arrays copyOfRange argv argv length ArrayList Path localDirs ArrayList sLocaldirs length String sLocaldir sLocaldirs localDirs add Path sLocaldir String uid UserGroupInformation getCurrentUser getShortUserName user uid LOG warn uid user ContainerLocalizer localizer ContainerLocalizer FileContext getLocalFSFileContext user appId locId tokenFileName localDirs RecordFactoryProvider getRecordFactory localizer runLocalization nmAddr e e printStackTrace System out
LocalizedResource rsrc localrsrc get req event inProgressLocalResourcesMap remove req rsrc rsrc LOG info rsrc getLocalPath removeResource req rsrc rsrc rsrc LocalizedResource req dispatcher localrsrc put req rsrc rsrc ResourceReleaseEvent relEvent ResourceReleaseEvent event
rsrc LOG warn rsrc rsrc recoverResource req ResourceRecoveredEvent event localrsrc put req rsrc rsrc LOG warn event getType req rsrc handle event event getType rsrc rsrc rsrc removeResource req event getType
LocalizedResource rem LocalizedResource rsrc localrsrc get rem getRequest rsrc
File file File uniquePath toUri getRawPath file rPath uniquePath LOG warn uniquePath delService FileDeletionTask deletionTask FileDeletionTask delService getUser uniquePath delService delete deletionTask Path localPath Path rPath req getPath getName LocalizedResource rsrc localrsrc get req rsrc LOG warn req rsrc setLocalPath localPath LocalResource lr LocalResource newInstance req getResource req getType req getVisibility req getSize req getTimestamp
event writeLock lock Path resourcePath event getLocalResourceRequest getPath
conf perDirFileLimit conf getInt YarnConfiguration NM_LOCAL_CACHE_MAX_FILES_PER_DIRECTORY YarnConfiguration DEFAULT_NM_LOCAL_CACHE_MAX_FILES_PER_DIRECTORY perDirFileLimit
LocalizedResourceProto it it it LocalizedResourceProto proto it next LocalResource rsrc LocalResourcePBImpl proto getResource LocalResourceRequest req LocalResourceRequest rsrc
tracker LocalizedResourceProto it it it LocalizedResourceProto proto it next LocalResource rsrc LocalResourcePBImpl proto getResource LocalResourceRequest req LocalResourceRequest rsrc LOG debug req proto getLocalPath tracker handle ResourceRecoveredEvent req Path proto getLocalPath proto getSize Map Entry LocalResourceProto Path it it it Map Entry LocalResourceProto Path entry it next LocalResource rsrc LocalResourcePBImpl entry getKey LocalResourceRequest req LocalResourceRequest rsrc Path localPath entry getValue tracker handle ResourceRecoveredEvent req localPath
cacheCleanup scheduleWithFixedDelay CacheCleanup dispatcher cacheCleanupPeriod cacheCleanupPeriod TimeUnit MILLISECONDS server createServer server start localizationServerAddress getConfig updateConnectAddr YarnConfiguration NM_BIND_HOST YarnConfiguration NM_LOCALIZER_ADDRESS YarnConfiguration DEFAULT_NM_LOCALIZER_ADDRESS server getListenerAddress
fs String logDir RemoteIterator FileStatus fileStatuses fs listStatus Path logDir fileStatuses fileStatuses FileStatus fileStatus fileStatuses next String appName fileStatus getPath getName appName
LOG debug
fs mkdirs directoryPath DIRECTORY_PERMISSION tempPath Path directoryPath getTemporaryFileName actualPath actualPath tempPath LOG warn tempPath fs setPermission tempPath FILE_PERMISSION Path finalPath Path directoryPath actualPath getName fs tempPath finalPath LOG warn finalPath deleteTempFile tempPath actualPath getName fs delete finalPath replication conf getInt YarnConfiguration SHARED_CACHE_NM_UPLOADER_REPLICATION_FACTOR YarnConfiguration DEFAULT_SHARED_CACHE_NM_UPLOADER_REPLICATION_FACTOR
Class ContainerLogAggregationPolicy policyClass logAggregationContext String className logAggregationContext getLogAggregationPolicyClassName className Class policyFromContext conf getClassByName className ContainerLogAggregationPolicy policyFromContext policyClass policyFromContext asSubclass ContainerLogAggregationPolicy LOG warn appId className LOG warn appId className policyClass policyClass conf getClass YarnConfiguration NM_LOG_AGG_POLICY_CLASS AllContainerLogAggregationPolicy ContainerLogAggregationPolicy
addCredentials Set ContainerId pendingContainerInThisCycle HashSet ContainerId pendingContainers drainTo pendingContainerInThisCycle Set ContainerId finishedContainers HashSet ContainerId pendingContainerInThisCycle container ContainerType containerType container getContainerTokenIdentifier getContainerType container getContainerId containerType pendingContainerInThisCycle add container getContainerId pendingContainerInThisCycle LOG debug sendLogAggregationReport appFinished logAggregationTimes
container getContainerId pendingContainerInThisCycle add container getContainerId pendingContainerInThisCycle LOG debug sendLogAggregationReport appFinished logAggregationTimes LOG debug logAggregationTimes String diagnosticMessage logAggregationSucceedInThisCycle DeletionTask deletionTask logAggregationFileController initializeWriter logControllerContext
LOG error e1 deletionTask FileDeletionTask delService userUgi getShortUserName uploadedFilePathsInThisCycleList container containerLogAggregators remove container logControllerContext setUploadedLogsInThisCycle uploadedLogsInThisCycle logControllerContext setLogUploadTimeStamp System currentTimeMillis logControllerContext increLogAggregationTimes logAggregationFileController postWrite logControllerContext diagnosticMessage appId LogAggregationUtils getNodeString nodeId Times format logControllerContext getLogUploadTimeStamp e diagnosticMessage e getMessage renameTemporaryLogFileFailed logAggregationSucceedInThisCycle
Credentials systemCredentials context getSystemCredentialsForApps get appId systemCredentials
uploadLogsForContainers wait THREAD_SLEEP_TIME e LOG warn appFinishing set e appFinishing set e uploadLogsForContainers doAppLogAggregationPostCleanUp e
conf interval conf getLong YarnConfiguration NM_LOG_AGGREGATION_ROLL_MONITORING_INTERVAL_SECONDS YarnConfiguration DEFAULT_NM_LOG_AGGREGATION_ROLL_MONITORING_INTERVAL_SECONDS interval
conf threadPoolSize getAggregatorThreadPoolSize conf threadPool HadoopExecutors newFixedThreadPool threadPoolSize ThreadFactoryBuilder setNameFormat build rollingMonitorInterval calculateRollingMonitorInterval conf
stateStore RecoveredLogDeleterState state stateStore loadLogDeleterState now System currentTimeMillis ApplicationId LogDeleterProto entry state ApplicationId appId entry getKey LogDeleterProto proto entry getValue deleteDelayMsec proto getDeletionTime now
handle appStartedEvent appOwners put appStartedEvent getApplicationId appStartedEvent getUser dispatcher getEventHandler handle ApplicationEvent appStartedEvent getApplicationId ApplicationEventType APPLICATION_LOG_HANDLING_INITED appFinishedEvent ApplicationId appId appFinishedEvent getApplicationId
handle appStartedEvent appOwners put appStartedEvent getApplicationId appStartedEvent getUser dispatcher getEventHandler handle ApplicationEvent appStartedEvent getApplicationId ApplicationEventType APPLICATION_LOG_HANDLING_INITED appFinishedEvent ApplicationId appId appFinishedEvent getApplicationId LOG info appId deleteDelaySeconds String user appOwners remove appId user
appFinishedEvent ApplicationId appId appFinishedEvent getApplicationId LOG info appId deleteDelaySeconds String user appOwners remove appId user LOG error appId NonAggregatingLogHandler dispatcher getEventHandler handle ApplicationEvent appId ApplicationEventType APPLICATION_LOG_HANDLING_FAILED LogDeleterRunnable logDeleter LogDeleterRunnable user appId deletionTimestamp System currentTimeMillis deleteDelaySeconds LogDeleterProto deleterProto LogDeleterProto newBuilder setUser user setDeletionTime deletionTimestamp build stateStore storeLogDeleter appId deleterProto
processTreeClass conf getClass YarnConfiguration NM_CONTAINER_MON_PROCESS_TREE ResourceCalculatorProcessTree LOG info processTreeClass containerMetricsEnabled conf getBoolean YarnConfiguration NM_CONTAINER_METRICS_ENABLE YarnConfiguration DEFAULT_NM_CONTAINER_METRICS_ENABLE containerMetricsPeriodMs conf getLong YarnConfiguration NM_CONTAINER_METRICS_PERIOD_MS YarnConfiguration DEFAULT_NM_CONTAINER_METRICS_PERIOD_MS containerMetricsUnregisterDelayMs conf getLong YarnConfiguration NM_CONTAINER_METRICS_UNREGISTER_DELAY_MS YarnConfiguration DEFAULT_NM_CONTAINER_METRICS_UNREGISTER_DELAY_MS configuredPMemForContainers NodeManagerHardwareUtils getContainerMemoryMB resourceCalculatorPlugin conf configuredVCoresForContainers NodeManagerHardwareUtils getVCores resourceCalculatorPlugin conf vmemRatio conf getFloat YarnConfiguration NM_VMEM_PMEM_RATIO YarnConfiguration DEFAULT_NM_VMEM_PMEM_RATIO Preconditions checkArgument vmemRatio YarnConfiguration NM_VMEM_PMEM_RATIO Resource resourcesForContainers Resource newInstance configuredPMemForContainers configuredVCoresForContainers setAllocatedResourcesForContainers resourcesForContainers pmemCheckEnabled conf getBoolean YarnConfiguration NM_PMEM_CHECK_ENABLED YarnConfiguration DEFAULT_NM_PMEM_CHECK_ENABLED vmemCheckEnabled conf getBoolean YarnConfiguration NM_VMEM_CHECK_ENABLED YarnConfiguration DEFAULT_NM_VMEM_CHECK_ENABLED elasticMemoryEnforcement conf getBoolean YarnConfiguration NM_ELASTIC_MEMORY_CONTROL_ENABLED YarnConfiguration DEFAULT_NM_ELASTIC_MEMORY_CONTROL_ENABLED strictMemoryEnforcement conf getBoolean YarnConfiguration NM_MEMORY_RESOURCE_ENFORCED YarnConfiguration DEFAULT_NM_MEMORY_RESOURCE_ENFORCED
LOG info processTreeClass containerMetricsEnabled conf getBoolean YarnConfiguration NM_CONTAINER_METRICS_ENABLE YarnConfiguration DEFAULT_NM_CONTAINER_METRICS_ENABLE containerMetricsPeriodMs conf getLong YarnConfiguration NM_CONTAINER_METRICS_PERIOD_MS YarnConfiguration DEFAULT_NM_CONTAINER_METRICS_PERIOD_MS containerMetricsUnregisterDelayMs conf getLong YarnConfiguration NM_CONTAINER_METRICS_UNREGISTER_DELAY_MS YarnConfiguration DEFAULT_NM_CONTAINER_METRICS_UNREGISTER_DELAY_MS configuredPMemForContainers NodeManagerHardwareUtils getContainerMemoryMB resourceCalculatorPlugin conf configuredVCoresForContainers NodeManagerHardwareUtils getVCores resourceCalculatorPlugin conf vmemRatio conf getFloat YarnConfiguration NM_VMEM_PMEM_RATIO YarnConfiguration DEFAULT_NM_VMEM_PMEM_RATIO Preconditions checkArgument vmemRatio YarnConfiguration NM_VMEM_PMEM_RATIO Resource resourcesForContainers Resource newInstance configuredPMemForContainers configuredVCoresForContainers setAllocatedResourcesForContainers resourcesForContainers pmemCheckEnabled conf getBoolean YarnConfiguration NM_PMEM_CHECK_ENABLED YarnConfiguration DEFAULT_NM_PMEM_CHECK_ENABLED vmemCheckEnabled conf getBoolean YarnConfiguration NM_VMEM_CHECK_ENABLED YarnConfiguration DEFAULT_NM_VMEM_CHECK_ENABLED elasticMemoryEnforcement conf getBoolean YarnConfiguration NM_ELASTIC_MEMORY_CONTROL_ENABLED YarnConfiguration DEFAULT_NM_ELASTIC_MEMORY_CONTROL_ENABLED strictMemoryEnforcement conf getBoolean YarnConfiguration NM_MEMORY_RESOURCE_ENFORCED YarnConfiguration DEFAULT_NM_MEMORY_RESOURCE_ENFORCED LOG info pmemCheckEnabled
containerMetricsEnabled conf getBoolean YarnConfiguration NM_CONTAINER_METRICS_ENABLE YarnConfiguration DEFAULT_NM_CONTAINER_METRICS_ENABLE containerMetricsPeriodMs conf getLong YarnConfiguration NM_CONTAINER_METRICS_PERIOD_MS YarnConfiguration DEFAULT_NM_CONTAINER_METRICS_PERIOD_MS containerMetricsUnregisterDelayMs conf getLong YarnConfiguration NM_CONTAINER_METRICS_UNREGISTER_DELAY_MS YarnConfiguration DEFAULT_NM_CONTAINER_METRICS_UNREGISTER_DELAY_MS configuredPMemForContainers NodeManagerHardwareUtils getContainerMemoryMB resourceCalculatorPlugin conf configuredVCoresForContainers NodeManagerHardwareUtils getVCores resourceCalculatorPlugin conf vmemRatio conf getFloat YarnConfiguration NM_VMEM_PMEM_RATIO YarnConfiguration DEFAULT_NM_VMEM_PMEM_RATIO Preconditions checkArgument vmemRatio YarnConfiguration NM_VMEM_PMEM_RATIO Resource resourcesForContainers Resource newInstance configuredPMemForContainers configuredVCoresForContainers setAllocatedResourcesForContainers resourcesForContainers pmemCheckEnabled conf getBoolean YarnConfiguration NM_PMEM_CHECK_ENABLED YarnConfiguration DEFAULT_NM_PMEM_CHECK_ENABLED vmemCheckEnabled conf getBoolean YarnConfiguration NM_VMEM_CHECK_ENABLED YarnConfiguration DEFAULT_NM_VMEM_CHECK_ENABLED elasticMemoryEnforcement conf getBoolean YarnConfiguration NM_ELASTIC_MEMORY_CONTROL_ENABLED YarnConfiguration DEFAULT_NM_ELASTIC_MEMORY_CONTROL_ENABLED strictMemoryEnforcement conf getBoolean YarnConfiguration NM_MEMORY_RESOURCE_ENFORCED YarnConfiguration DEFAULT_NM_MEMORY_RESOURCE_ENFORCED LOG info pmemCheckEnabled LOG info vmemCheckEnabled
containerMetricsPeriodMs conf getLong YarnConfiguration NM_CONTAINER_METRICS_PERIOD_MS YarnConfiguration DEFAULT_NM_CONTAINER_METRICS_PERIOD_MS containerMetricsUnregisterDelayMs conf getLong YarnConfiguration NM_CONTAINER_METRICS_UNREGISTER_DELAY_MS YarnConfiguration DEFAULT_NM_CONTAINER_METRICS_UNREGISTER_DELAY_MS configuredPMemForContainers NodeManagerHardwareUtils getContainerMemoryMB resourceCalculatorPlugin conf configuredVCoresForContainers NodeManagerHardwareUtils getVCores resourceCalculatorPlugin conf vmemRatio conf getFloat YarnConfiguration NM_VMEM_PMEM_RATIO YarnConfiguration DEFAULT_NM_VMEM_PMEM_RATIO Preconditions checkArgument vmemRatio YarnConfiguration NM_VMEM_PMEM_RATIO Resource resourcesForContainers Resource newInstance configuredPMemForContainers configuredVCoresForContainers setAllocatedResourcesForContainers resourcesForContainers pmemCheckEnabled conf getBoolean YarnConfiguration NM_PMEM_CHECK_ENABLED YarnConfiguration DEFAULT_NM_PMEM_CHECK_ENABLED vmemCheckEnabled conf getBoolean YarnConfiguration NM_VMEM_CHECK_ENABLED YarnConfiguration DEFAULT_NM_VMEM_CHECK_ENABLED elasticMemoryEnforcement conf getBoolean YarnConfiguration NM_ELASTIC_MEMORY_CONTROL_ENABLED YarnConfiguration DEFAULT_NM_ELASTIC_MEMORY_CONTROL_ENABLED strictMemoryEnforcement conf getBoolean YarnConfiguration NM_MEMORY_RESOURCE_ENFORCED YarnConfiguration DEFAULT_NM_MEMORY_RESOURCE_ENFORCED LOG info pmemCheckEnabled LOG info vmemCheckEnabled LOG info elasticMemoryEnforcement
setAllocatedResourcesForContainers resourcesForContainers pmemCheckEnabled conf getBoolean YarnConfiguration NM_PMEM_CHECK_ENABLED YarnConfiguration DEFAULT_NM_PMEM_CHECK_ENABLED vmemCheckEnabled conf getBoolean YarnConfiguration NM_VMEM_CHECK_ENABLED YarnConfiguration DEFAULT_NM_VMEM_CHECK_ENABLED elasticMemoryEnforcement conf getBoolean YarnConfiguration NM_ELASTIC_MEMORY_CONTROL_ENABLED YarnConfiguration DEFAULT_NM_ELASTIC_MEMORY_CONTROL_ENABLED strictMemoryEnforcement conf getBoolean YarnConfiguration NM_MEMORY_RESOURCE_ENFORCED YarnConfiguration DEFAULT_NM_MEMORY_RESOURCE_ENFORCED LOG info pmemCheckEnabled LOG info vmemCheckEnabled LOG info elasticMemoryEnforcement LOG info strictMemoryEnforcement elasticMemoryEnforcement CGroupElasticMemoryController YarnException oomListenerThread CGroupElasticMemoryController conf context ResourceHandlerModule getCGroupsHandler pmemCheckEnabled vmemCheckEnabled pmemCheckEnabled maxPmemAllottedForContainers maxVmemAllottedForContainers containersMonitorEnabled isContainerMonitorEnabled monitoringInterval
monitoringEvent ContainerStartMonitoringEvent startEvent ContainerStartMonitoringEvent monitoringEvent
Map String ResourcePlugin pluginMap Maps newHashMap String resourceName resourceName resourceName trim ensurePluginIsSupported resourceName pluginMap resourceName ResourcePlugin plugin resourceName GpuDiscoverer gpuDiscoverer GpuDiscoverer GpuNodeResourceUpdateHandler updateHandler GpuNodeResourceUpdateHandler gpuDiscoverer conf plugin GpuResourcePlugin updateHandler gpuDiscoverer resourceName plugin FpgaResourcePlugin plugin YarnException resourceName plugin initialize context
String resourceName SUPPORTED_RESOURCE_PLUGINS resourceName String msg resourceName StringUtils join SUPPORTED_RESOURCE_PLUGINS
String pluginClassName Class pluginClazz Class forName pluginClassName DevicePlugin pluginClazz YarnRuntimeException pluginClassName DevicePlugin getCanonicalName checkInterfaceCompatibility DevicePlugin pluginClazz DevicePlugin dpInstance DevicePlugin ReflectionUtils newInstance pluginClazz configuration DeviceRegisterRequest request request dpInstance getRegisterRequestInfo e YarnRuntimeException e getMessage String resourceName request getResourceName resourceName YarnRuntimeException resourceName pluginClassName resourceName
Class pluginClazz Class forName pluginClassName DevicePlugin pluginClazz YarnRuntimeException pluginClassName DevicePlugin getCanonicalName checkInterfaceCompatibility DevicePlugin pluginClazz DevicePlugin dpInstance DevicePlugin ReflectionUtils newInstance pluginClazz configuration DeviceRegisterRequest request request dpInstance getRegisterRequestInfo e YarnRuntimeException e getMessage String resourceName request getResourceName resourceName YarnRuntimeException resourceName pluginClassName resourceName YarnRuntimeException resourceName YarnConfiguration RESOURCE_TYPES_CONFIGURATION_FILE
DeviceRegisterRequest request request dpInstance getRegisterRequestInfo e YarnRuntimeException e getMessage String resourceName request getResourceName resourceName YarnRuntimeException resourceName pluginClassName resourceName YarnRuntimeException resourceName YarnConfiguration RESOURCE_TYPES_CONFIGURATION_FILE LOG info resourceName pluginClassName DevicePluginAdapter pluginAdapter DevicePluginAdapter resourceName dpInstance deviceMappingManager LOG info pluginClassName pluginAdapter initialize context
e YarnRuntimeException e getMessage String resourceName request getResourceName resourceName YarnRuntimeException resourceName pluginClassName resourceName YarnRuntimeException resourceName YarnConfiguration RESOURCE_TYPES_CONFIGURATION_FILE LOG info resourceName pluginClassName DevicePluginAdapter pluginAdapter DevicePluginAdapter resourceName dpInstance deviceMappingManager LOG info pluginClassName pluginAdapter initialize context e YarnRuntimeException pluginClassName LOG info pluginClassName
expectedClass LOG debug expectedClass getSimpleName Method expectedDevicePluginMethods expectedClass getMethods found Method expectedDevicePluginMethods found
expectedClass LOG debug expectedClass getSimpleName Method expectedDevicePluginMethods expectedClass getMethods found Method method expectedDevicePluginMethods found LOG debug method getName Method getName method getName
LOG info binaryName found String envBinaryPath envProvider apply ENV_SCRIPT_PATH envBinaryPath binaryPath getScriptFromEnvSetting envBinaryPath found binaryPath found envBinaryPath LOG warn envBinaryPath binaryPath getScriptFromHadoopCommon envProvider binaryName found binaryPath found LOG info binaryPath getScriptFromSearchDirs binaryName scriptPaths found binaryPath
Set Device Set Device devices HashSet
String String String envProvider String binaryName String scriptPath String hadoopCommon envProvider apply HADOOP_COMMON_HOME hadoopCommon String targetPath hadoopCommon binaryName
String String String envProvider String binaryName String scriptPath String hadoopCommon envProvider apply HADOOP_COMMON_HOME hadoopCommon String targetPath hadoopCommon binaryName LOG info targetPath targetPath
String String binaryName String String scriptPath String dir File f File dir binaryName f
p CommandExecutor executor commandExecutorProvider apply String p toString
p CommandExecutor executor commandExecutorProvider apply String p toString LOG info p executor execute String statOutput executor getOutput String stat statOutput trim split major Integer parseInt stat minor Integer parseInt stat devType getDevType p stat deviceNumber makeDev major minor
p CommandExecutor executor commandExecutorProvider apply String p toString LOG info p executor execute String statOutput executor getOutput String stat statOutput trim split major Integer parseInt stat minor Integer parseInt stat devType getDevType p stat deviceNumber makeDev major minor LOG info major minor deviceNumber devType String sysPath udev getSysPath deviceNumber devType
String String String output
String String devName String output LOG debug devName output shellExecutor getMajorMinorInfo devName String strs output trim split
num String policy envs get TOPOLOGY_POLICY_ENV_KEY policy policy TOPOLOGY_POLICY_PACK cTable LOG error List Map Entry Set Device Integer combinationsToCost cTable get count Iterator Map Entry Set Device Integer iterator combinationsToCost iterator policy iterator LinkedList combinationsToCost descendingIterator iterator Map Entry Set Device Integer element iterator next element getKey allocation addAll element getKey
String envBinaryPath System getenv ENV_BINARY_PATH envBinaryPath File envBinaryPath pathOfGpuBinary envBinaryPath LOG info pathOfGpuBinary LOG info File binaryFile found String dir binaryFile File dir DEFAULT_BINARY_NAME binaryFile found pathOfGpuBinary binaryFile getAbsolutePath
envBinaryPath File envBinaryPath pathOfGpuBinary envBinaryPath LOG info pathOfGpuBinary LOG info File binaryFile found dir binaryFile File dir DEFAULT_BINARY_NAME binaryFile found pathOfGpuBinary binaryFile getAbsolutePath LOG info pathOfGpuBinary
resourceName container Resource requestedResource container getResource ContainerId containerId container getContainerId requestedDeviceCount getRequestedDeviceCount resourceName requestedResource
resourceName ContainerId Iterator Map Entry Device ContainerId iter allUsedDevices get resourceName entrySet iterator Map Entry Device ContainerId entry iter entry iter next entry
deviceDockerCommandPlugin DeviceResourceDockerRuntimePluginImpl resourceName devicePlugin deviceResourceUpdater DeviceResourceUpdaterImpl resourceName devicePlugin
container String containerId container getContainerId toString
String containerId container getContainerId toString LOG debug containerId container DeviceRuntimeSpec deviceRuntimeSpec getRuntimeSpec container deviceRuntimeSpec LOG warn devicePlugin getClass getCanonicalName containerId dockerRunCommand addRuntime deviceRuntimeSpec getContainerRuntime LOG debug deviceRuntimeSpec getContainerRuntime containerId Set MountDeviceSpec deviceMounts deviceRuntimeSpec getDeviceMounts LOG debug deviceMounts containerId MountDeviceSpec mountDeviceSpec deviceMounts dockerRunCommand addDevice mountDeviceSpec getDevicePathInHost mountDeviceSpec getDevicePathInContainer Set MountVolumeSpec mountVolumeSpecs deviceRuntimeSpec getVolumeMounts
LOG warn devicePlugin getClass getCanonicalName containerId dockerRunCommand addRuntime deviceRuntimeSpec getContainerRuntime LOG debug deviceRuntimeSpec getContainerRuntime containerId Set MountDeviceSpec deviceMounts deviceRuntimeSpec getDeviceMounts LOG debug deviceMounts containerId MountDeviceSpec mountDeviceSpec deviceMounts dockerRunCommand addDevice mountDeviceSpec getDevicePathInHost mountDeviceSpec getDevicePathInContainer Set MountVolumeSpec mountVolumeSpecs deviceRuntimeSpec getVolumeMounts LOG debug mountVolumeSpecs containerId MountVolumeSpec mountVolumeSpec mountVolumeSpecs mountVolumeSpec dockerRunCommand addReadOnlyMountLocation mountVolumeSpec getHostPath mountVolumeSpec getMountPath dockerRunCommand addReadWriteMountLocation mountVolumeSpec getHostPath mountVolumeSpec getMountPath
DeviceRuntimeSpec container ContainerId containerId container getContainerId DeviceRuntimeSpec deviceRuntimeSpec cachedSpec get containerId deviceRuntimeSpec Set Device allocated getAllocatedDevices container allocated allocated
container String containerIdStr container getContainerId toString DeviceMappingManager DeviceAllocation allocation deviceMappingManager assignDevices resourceName container
LOG error Optional empty File f File path f LOG error Optional empty f LOG error Optional empty ShellCommandExecutor shell ShellCommandExecutor String path MAX_EXEC_TIMEOUT_MS shell execute String output shell getOutput Optional of output
conf String vendorPluginClass conf get YarnConfiguration NM_FPGA_VENDOR_PLUGIN YarnConfiguration DEFAULT_NM_FPGA_VENDOR_PLUGIN
String pluginDefaultBinaryName DEFAULT_BINARY_NAME String executable config get YarnConfiguration NM_FPGA_PATH_TO_EXEC pluginDefaultBinaryName File binaryPath File executable binaryPath LOG warn YarnConfiguration NM_FPGA_PATH_TO_EXEC executable pluginDefaultBinaryName String pluginDefaultPreferredPath getDefaultPathToExecutable pluginDefaultPreferredPath LOG warn ALTERAOCLSDKROOT_NAME binaryPath File pluginDefaultPreferredPath pluginDefaultBinaryName binaryPath executable binaryPath getAbsolutePath
String String String String String ipFilePath
String ipPath device Shell ShellCommandExecutor shexec String aclName aclName device getAliasDevName shexec Shell ShellCommandExecutor String pathToExecutable aclName ipPath shexec execute shexec
String ipPath device Shell ShellCommandExecutor shexec String aclName aclName device getAliasDevName shexec Shell ShellCommandExecutor String pathToExecutable aclName ipPath shexec execute shexec LOG debug shexec getOutput
String ipPath device Shell ShellCommandExecutor shexec String aclName aclName device getAliasDevName shexec Shell ShellCommandExecutor String pathToExecutable aclName ipPath shexec execute shexec LOG debug shexec getOutput LOG info ipPath aclName LOG error LOG error shexec getOutput
Shell ShellCommandExecutor shexec String aclName aclName device getAliasDevName shexec Shell ShellCommandExecutor String pathToExecutable aclName ipPath shexec execute shexec LOG debug shexec getOutput LOG info ipPath aclName LOG error LOG error shexec getOutput e LOG error ipPath aclName e
String msg getErrorMessageOfScriptExecutionThresholdReached
getGpuDeviceInformation YarnException numOfErrorExecutionSinceLastSucceed String msg getErrorMessageOfScriptExecutionThresholdReached LOG error msg YarnException msg lastDiscoveredGpuInformation nvidiaBinaryHelper getGpuDeviceInformation pathOfGpuBinary e numOfErrorExecutionSinceLastSucceed String msg getErrorMessageOfScriptExecution e getMessage LOG debug msg YarnException msg e YarnException e numOfErrorExecutionSinceLastSucceed String msg getFailedToParseErrorMessage e getMessage
String msg YarnConfiguration NM_GPU_ALLOWED_DEVICES YarnConfiguration AUTOMATICALLY_DISCOVER_GPU_DEVICES YarnConfiguration NM_GPU_ALLOWED_DEVICES
splitByColon throwIfNecessary GpuDeviceSpecificationException createWithWrongValueSpecified device devices getConf LOG warn device GpuDevice gpuDevice gpuDevice parseGpuDevice splitByColon e throwIfNecessary GpuDeviceSpecificationException createWithWrongValueSpecified device devices e getConf LOG warn device gpuDevices gpuDevice gpuDevices add gpuDevice throwIfNecessary GpuDeviceSpecificationException createWithDuplicateValueSpecified device devices getConf LOG warn device
config nvidiaHelper setConf config nvidiaBinaryHelper nvidiaHelper numOfErrorExecutionSinceLastSucceed lookUpAutoDiscoveryBinary config LOG info GpuDeviceInformation info getGpuDeviceInformation
LOG info List GpuDevice usableGpus gpuDiscoverer getGpusUsableByYarn usableGpus usableGpus String message
MAX_REPEATED_ERROR_ALLOWED String msg MAX_REPEATED_ERROR_ALLOWED
String endpoint conf get YarnConfiguration NVIDIA_DOCKER_PLUGIN_V1_ENDPOINT YarnConfiguration DEFAULT_NVIDIA_DOCKER_PLUGIN_V1_ENDPOINT endpoint endpoint
String cliOptions URL url URL endpoint URLConnection uc url openConnection uc setRequestProperty StringWriter writer StringWriter IOUtils copy uc getInputStream writer cliOptions writer toString LOG info cliOptions String str cliOptions str str trim str DEVICE_OPTION addToCommand DEVICE_OPTION getValue str str volumeDriver getValue str
Container container List Container extraOppContainersToReclaim pickOpportunisticContainersToReclaimResources container getContainerId Container extraOppContainersToReclaim String preemptionAction usePauseEventForPreemption
numAllowed queuingLimit getMaxQueueLength Iterator Container containerIter queuedOpportunisticContainers values iterator containerIter Container container containerIter next container numAllowed container sendKillEvent ContainerExitStatus KILLED_BY_CONTAINER_SCHEDULER containerIter remove
Map String String LOG info Map String String volumeMounts HashMap List VolumeMetaData volumes getVolumes
LOG info List VolumeMetaData volumes getVolumes
Map String String volume Map String String bindVolumes HashMap File localMount getLocalVolumeMountPath localMountRoot volume getVolumeId toString File localStaging getLocalVolumeStagingPath localMountRoot volume getVolumeId toString
containerId String idStr containerId toString
String user appId proto String localPath proto getLocalPath String startedKey getResourceStartedKey user appId localPath String completedKey getResourceCompletedKey user appId localPath
String user appId localPath String localPathStr localPath toString String startedKey getResourceStartedKey user appId localPathStr String completedKey getResourceCompletedKey user appId localPathStr
iter next result setNextMasterKey parseMasterKey entry getValue LOG info result getNextMasterKey getKeyId idEndPos ApplicationAttemptId attemptId idEndPos key indexOf AMRMPROXY_KEY_PREFIX length idEndPos IOException key attemptId ApplicationAttemptId fromString key substring AMRMPROXY_KEY_PREFIX length idEndPos e LOG warn key e unknownKeys add key
conf Path storeRoot createStorageDir conf Options options Options options createIfMissing
Version loadedVersion loadVersion
nodeId nodeHostAddr nodeId toString
appId List ApplicationAttemptId appAttemptList appToAppAttemptMap get appId appAttemptList
dispatcher createDispatcher dispatcher register NMTimelineEventType ForwardingEventHandler addIfService dispatcher nmLoginUGI UserGroupInformation isSecurityEnabled UserGroupInformation getLoginUser UserGroupInformation getCurrentUser
memoryMetric setRealtimeAggregationOp TimelineMetricOperation SUM memoryMetric addValue currentTimeMillis pmemUsage entity addMetric memoryMetric cpuUsagePercentPerCore TimelineMetric cpuMetric TimelineMetric cpuMetric setId ContainerMetric CPU toString cpuMetric setRealtimeAggregationOp TimelineMetricOperation SUM cpuMetric addValue currentTimeMillis Math round cpuUsagePercentPerCore entity addMetric cpuMetric ApplicationId appId container getContainerId getApplicationAttemptId getApplicationId TimelineV2Client timelineClient getTimelineClient appId timelineClient timelineClient putEntitiesAsync entity
entity addMetric memoryMetric cpuUsagePercentPerCore TimelineMetric cpuMetric TimelineMetric cpuMetric setId ContainerMetric CPU toString cpuMetric setRealtimeAggregationOp TimelineMetricOperation SUM cpuMetric addValue currentTimeMillis Math round cpuUsagePercentPerCore entity addMetric cpuMetric ApplicationId appId container getContainerId getApplicationAttemptId getApplicationId TimelineV2Client timelineClient getTimelineClient appId timelineClient timelineClient putEntitiesAsync entity LOG error container getContainerId
cpuUsagePercentPerCore TimelineMetric cpuMetric TimelineMetric cpuMetric setId ContainerMetric CPU toString cpuMetric setRealtimeAggregationOp TimelineMetricOperation SUM cpuMetric addValue currentTimeMillis Math round cpuUsagePercentPerCore entity addMetric cpuMetric ApplicationId appId container getContainerId getApplicationAttemptId getApplicationId TimelineV2Client timelineClient getTimelineClient appId timelineClient timelineClient putEntitiesAsync entity LOG error container getContainerId LOG error container getContainerId
TimelineMetric cpuMetric TimelineMetric cpuMetric setId ContainerMetric CPU toString cpuMetric setRealtimeAggregationOp TimelineMetricOperation SUM cpuMetric addValue currentTimeMillis Math round cpuUsagePercentPerCore entity addMetric cpuMetric ApplicationId appId container getContainerId getApplicationAttemptId getApplicationId TimelineV2Client timelineClient getTimelineClient appId timelineClient timelineClient putEntitiesAsync entity LOG error container getContainerId e LOG error container getContainerId LOG debug container getContainerId e
cpuMetric setId ContainerMetric CPU toString cpuMetric setRealtimeAggregationOp TimelineMetricOperation SUM cpuMetric addValue currentTimeMillis Math round cpuUsagePercentPerCore entity addMetric cpuMetric ApplicationId appId container getContainerId getApplicationAttemptId getApplicationId TimelineV2Client timelineClient getTimelineClient appId timelineClient timelineClient putEntitiesAsync entity LOG error container getContainerId e LOG error container getContainerId LOG debug container getContainerId e e
event eventType Container container event getContainer ContainerId containerId container getContainerId TimelineEntity entity createContainerEntity containerId TimelineEvent tEvent TimelineEvent tEvent setId eventType tEvent setTimestamp event getTimestamp entity addEvent tEvent ApplicationId appId container getContainerId getApplicationAttemptId getApplicationId TimelineV2Client timelineClient getTimelineClient appId timelineClient timelineClient putEntitiesAsync entity
Container container event getContainer ContainerId containerId container getContainerId TimelineEntity entity createContainerEntity containerId TimelineEvent tEvent TimelineEvent tEvent setId eventType tEvent setTimestamp event getTimestamp entity addEvent tEvent ApplicationId appId container getContainerId getApplicationAttemptId getApplicationId TimelineV2Client timelineClient getTimelineClient appId timelineClient timelineClient putEntitiesAsync entity LOG error container getContainerId
ContainerId containerId container getContainerId TimelineEntity entity createContainerEntity containerId TimelineEvent tEvent TimelineEvent tEvent setId eventType tEvent setTimestamp event getTimestamp entity addEvent tEvent ApplicationId appId container getContainerId getApplicationAttemptId getApplicationId TimelineV2Client timelineClient getTimelineClient appId timelineClient timelineClient putEntitiesAsync entity LOG error container getContainerId LOG error container getContainerId
TimelineEvent tEvent TimelineEvent tEvent setId eventType tEvent setTimestamp event getTimestamp entity addEvent tEvent ApplicationId appId container getContainerId getApplicationAttemptId getApplicationId TimelineV2Client timelineClient getTimelineClient appId timelineClient timelineClient putEntitiesAsync entity LOG error container getContainerId e LOG error container getContainerId LOG debug container getContainerId e e
tEvent setId eventType tEvent setTimestamp event getTimestamp entity addEvent tEvent ApplicationId appId container getContainerId getApplicationAttemptId getApplicationId TimelineV2Client timelineClient getTimelineClient appId timelineClient timelineClient putEntitiesAsync entity LOG error container getContainerId e LOG error container getContainerId LOG debug container getContainerId e e LOG error container getContainerId e getMessage
String controller String groupName String path pathForCgroup controller groupName
String controller String groupName String param String String path pathForCgroup controller groupName param controller param
String str inl str inl readLine str
deleted
Resource Configuration configuration Configuration conf Configuration configuration String memory ResourceInformation MEMORY_MB getName String vcores ResourceInformation VCORES getName Resource ret Resource newInstance Map String ResourceInformation resourceInformation ResourceUtils getNodeResourceInformation conf Map String ResourceInformation entry resourceInformation ret setResourceInformation entry getKey entry getValue
Configuration conf Configuration configuration String memory ResourceInformation MEMORY_MB getName String vcores ResourceInformation VCORES getName Resource ret Resource newInstance Map String ResourceInformation resourceInformation ResourceUtils getNodeResourceInformation conf Map String ResourceInformation entry resourceInformation ret setResourceInformation entry getKey entry getValue LOG debug entry getKey entry getValue resourceInformation memory Long value resourceInformation get memory getValue value YarnRuntimeException value ResourceInformation memResInfo resourceInformation get memory memResInfo getValue ret setMemorySize getContainerMemoryMB conf
resourceInformation memory Long value resourceInformation get memory getValue value YarnRuntimeException value ResourceInformation memResInfo resourceInformation get memory memResInfo getValue ret setMemorySize getContainerMemoryMB conf LOG debug ret getMemorySize resourceInformation vcores Long value resourceInformation get vcores getValue value YarnRuntimeException value ResourceInformation vcoresResInfo resourceInformation get vcores vcoresResInfo getValue ret setVirtualCores getVCores conf
Long value resourceInformation get memory getValue value YarnRuntimeException value ResourceInformation memResInfo resourceInformation get memory memResInfo getValue ret setMemorySize getContainerMemoryMB conf LOG debug ret getMemorySize resourceInformation vcores Long value resourceInformation get vcores getValue value YarnRuntimeException value ResourceInformation vcoresResInfo resourceInformation get vcores vcoresResInfo getValue ret setVirtualCores getVCores conf LOG debug ret getVirtualCores
String command String containerPath containerURI getPath split String cId containerPath containerPath containerPath command containerPath toLowerCase Container container nmContext getContainers get ContainerId fromString cId session container session close session close LOG info session getRemoteAddress getHostString
containerPath command containerPath toLowerCase Container container nmContext getContainers get ContainerId fromString cId session container session close session close LOG info session getRemoteAddress getHostString LOG info cId ContainerExecContext execContext ContainerExecContext Builder setContainer container setNMLocalPath nmContext getLocalDirsHandler setShell command build pair exec execContainer execContext
StringBuilder sb StringBuilder String endOfFile outputFileName sb append endOfFile sb append containerIdStr sb append sb append StringUtils repeat endOfFile length os write sb toString getBytes Charset forName ApplicationId appId containerId getApplicationAttemptId getApplicationId Application app nmContext getApplications get appId String appOwner app app getUser ContainerLogsRequest logRequest ContainerLogsRequest logRequest setAppId appId
initializer initializer getName AuthenticationFilterInitializer getName hasHadoopAuthFilterInitializer targets add initializer getName hasHadoopAuthFilterInitializer targets add AuthenticationFilterInitializer getName conf set filterInitializerConfKey StringUtils join targets ContainerShellWebSocket init nmContext LOG info bindAddress webApp WebApps $for Context nmContext at bindAddress withServlet ContainerShellWebSocketServlet params withServlet TerminalServlet terminalParams with conf withHttpSpnegoPrincipalKey YarnConfiguration NM_WEBAPP_SPNEGO_USER_NAME_KEY withHttpSpnegoKeytabKey YarnConfiguration NM_WEBAPP_SPNEGO_KEYTAB_FILE_KEY withCSRFProtection YarnConfiguration NM_CSRF_PREFIX withXFSProtection YarnConfiguration NM_XFS_PREFIX start nmWebApp port webApp httpServer getConnectorAddress getPort
dispatcher handle app dispatcher getEventHandler handle ApplicationInitedEvent app getAppId
Path workSpacePath Path workSpace getAbsolutePath files mkdir workSpacePath FileUtil chmod workSpace getAbsolutePath File localDir File workSpace getAbsoluteFile files mkdir Path localDir getAbsolutePath FsPermission File logDir File workSpace getAbsoluteFile files mkdir Path logDir getAbsolutePath FsPermission String exec_path System getProperty exec_path exec_path conf Configuration conf setClass org apache hadoop fs local LocalFs org apache hadoop fs AbstractFileSystem appSubmitter System getProperty appSubmitter appSubmitter appSubmitter conf set YarnConfiguration NM_NONSECURE_MODE_LOCAL_USER_KEY appSubmitter
assertThat result get isEqualTo assertThat result get isEqualTo assertThat result get isEqualTo assertThat result get isEqualTo String format mockExec getConf get YarnConfiguration NM_LOG_DIRS assertThat result get isEqualTo assertThat result get isEqualTo assertThat result get isEqualTo assertThat result get isEqualTo assertThat result get isEqualTo assertThat result get isEqualTo assertThat result get isEqualTo assertThat result get isEqualTo assertThat result get isEqualTo assertThat result get isEqualTo
nm init conf Object services nm getServices toArray Object lastService services services length Assert assertTrue lastService NodeStatusUpdater nm start e TestNodeStatusUpdater nmStartError e YarnRuntimeException e start System out println nm getServiceState waitCount nm getServiceState waitCount
nm context dispatcher healthChecker MyNodeStatusUpdater context dispatcher healthChecker metrics context exec del nodeStatusUpdater diskhandler MyContainerManager context exec del nodeStatusUpdater metrics diskhandler YarnConfiguration conf createNMConfig nm init conf nm start System out println nm getServiceState waitCount nm getServiceState waitCount LOG info
LOG info Server resourceTracker getMockResourceTracker resource resourceTracker start LOG info NodeManager nodeManager NodeManager YarnConfiguration nmConf YarnConfiguration nmConf setSocketAddr YarnConfiguration RM_RESOURCE_TRACKER_ADDRESS resourceTracker getListenerAddress nmConf set YarnConfiguration NM_LOCALIZER_ADDRESS nodeManager init nmConf nodeManager start LOG info ContainerManager containerManager nodeManager getContainerManager ContainersMonitor containerMonitor containerManager getContainersMonitor assertEquals containerMonitor getVCoresAllocatedForContainers assertEquals GB containerMonitor getPmemAllocatedForContainers
YarnConfiguration nmConf YarnConfiguration nmConf setSocketAddr YarnConfiguration RM_RESOURCE_TRACKER_ADDRESS resourceTracker getListenerAddress nmConf set YarnConfiguration NM_LOCALIZER_ADDRESS nodeManager init nmConf nodeManager start LOG info ContainerManager containerManager nodeManager getContainerManager ContainersMonitor containerMonitor containerManager getContainersMonitor assertEquals containerMonitor getVCoresAllocatedForContainers assertEquals GB containerMonitor getPmemAllocatedForContainers LOG info resource GenericTestUtils waitFor containerMonitor getVCoresAllocatedForContainers assertEquals GB containerMonitor getPmemAllocatedForContainers resource setVirtualCores resource setMemorySize
R R R ExecutorCompletionService R completionService ExecutorCompletionService R getThreadPool
T R R T testContexts T R ExecutorCompletionService R completionService ExecutorCompletionService R getThreadPool LOG info testContexts size index index testContexts size index T testContext testContexts get index
T R R T testContexts T R ExecutorCompletionService R completionService ExecutorCompletionService R getThreadPool LOG info testContexts size index index testContexts size index T testContext testContexts get index LOG info testContext toString completionService R R
T R R T testContexts T R func ExecutorCompletionService R completionService ExecutorCompletionService R getThreadPool LOG info testContexts size index index testContexts size index T testContext testContexts get index LOG info testContext toString completionService R R LOG info testContext toString R response response func invoke testContext
T testContext testContexts get index LOG info testContext toString R R LOG info testContext toString R response response func invoke testContext LOG info testContext toString LOG error testContext response response ArrayList R responseList ArrayList R
response func invoke testContext LOG info testContext toString LOG error testContext response response ArrayList R responseList ArrayList R LOG info testContexts size testContexts size Future R future completionService take R response future get TimeUnit MILLISECONDS responseList add response
T RegisterApplicationMasterResponseInfo T T testContexts RegisterApplicationMasterResponseInfo T testContexts T RegisterApplicationMasterResponseInfo T RegisterApplicationMasterResponseInfo T T testContext RegisterApplicationMasterResponseInfo T response index testContexts indexOf testContext response RegisterApplicationMasterResponseInfo T registerApplicationMaster index testContext Assert assertNotNull response getResponse Assert assertEquals Integer toString index response getResponse getQueue
T FinishApplicationMasterResponseInfo T T testContexts FinishApplicationMasterResponseInfo T testContexts T FinishApplicationMasterResponseInfo T FinishApplicationMasterResponseInfo T T testContext FinishApplicationMasterResponseInfo T response response FinishApplicationMasterResponseInfo T finishApplicationMaster testContexts indexOf testContext FinalApplicationStatus SUCCEEDED testContext Assert assertNotNull response getResponse
ArrayList String ArrayList String testContexts ArrayList String
ArrayList String numberOfRequests ArrayList String testContexts ArrayList String LOG info numberOfRequests ep ep numberOfRequests ep testContexts add Integer toString ep
numberOfRequests ArrayList String testContexts ArrayList String
numberOfRequests ArrayList String testContexts ArrayList String LOG info numberOfRequests i i numberOfRequests i testContexts add Integer toString i
numberOfApps ArrayList Integer tempAppIds ArrayList Integer i i numberOfApps i tempAppIds add Integer i ArrayList Integer appIds tempAppIds List Integer appIds Integer Integer Integer Integer testAppId RegisterApplicationMasterResponse registerResponse registerApplicationMaster testAppId Assert assertNotNull registerResponse List Container containers getContainersAndAssert testAppId releaseContainersAndAssert testAppId containers LOG info testAppId
List Container containers ArrayList Container numberOfResourceRequests List ResourceRequest askList ArrayList ResourceRequest numberOfResourceRequests testAppId testAppId numberOfResourceRequests testAppId askList add createResourceRequest Integer toString testAppId testAppId allocateRequest setAskList askList AllocateResponse allocateResponse allocate appId allocateRequest Assert assertNotNull allocateResponse Assert assertNull allocateResponse getAMRMToken containers addAll allocateResponse getAllocatedContainers numHeartbeat containers askList numHeartbeat allocateResponse allocate appId Records newRecord AllocateRequest Assert assertNotNull allocateResponse Assert assertNull allocateResponse getAMRMToken containers addAll allocateResponse getAllocatedContainers
List ResourceRequest askList ArrayList ResourceRequest numberOfResourceRequests testAppId testAppId numberOfResourceRequests testAppId askList add createResourceRequest Integer toString testAppId testAppId allocateRequest setAskList askList AllocateResponse allocateResponse allocate appId allocateRequest Assert assertNotNull allocateResponse Assert assertNull allocateResponse getAMRMToken containers addAll allocateResponse getAllocatedContainers numHeartbeat containers size askList size numHeartbeat allocateResponse allocate appId Records newRecord AllocateRequest Assert assertNotNull allocateResponse Assert assertNull allocateResponse getAMRMToken containers addAll allocateResponse getAllocatedContainers LOG info Integer toString allocateResponse getAllocatedContainers size
allocateRequest setReleaseList relList AllocateResponse allocateResponse allocate appId allocateRequest Assert assertNotNull allocateResponse Assert assertNull allocateResponse getAMRMToken List ContainerId containersForReleasedContainerIds ArrayList List ContainerId newlyFinished getCompletedContainerIds allocateResponse getCompletedContainersStatuses containersForReleasedContainerIds addAll newlyFinished numHeartbeat containersForReleasedContainerIds size relList size numHeartbeat allocateResponse allocate appId Records newRecord AllocateRequest Assert assertNotNull allocateResponse Assert assertNull allocateResponse getAMRMToken newlyFinished getCompletedContainerIds allocateResponse getCompletedContainersStatuses containersForReleasedContainerIds addAll newlyFinished LOG info Integer toString allocateResponse getAllocatedContainers size
AllocateResponse allocateResponse interceptor allocate allocateRequest Assert assertNotNull allocateResponse checkAMRMToken allocateResponse getAMRMToken lastResponseId allocateResponse getResponseId containers addAll allocateResponse getAllocatedContainers LOG info Integer toString allocateResponse getAllocatedContainers size numHeartbeat containers size numHeartbeat allocateRequest Records newRecord AllocateRequest allocateRequest setResponseId lastResponseId allocateResponse interceptor allocate allocateRequest Assert assertNotNull allocateResponse checkAMRMToken allocateResponse getAMRMToken lastResponseId allocateResponse getResponseId interceptor drainAllAsyncQueue
Assert assertNotNull allocateResponse checkAMRMToken allocateResponse getAMRMToken lastResponseId allocateResponse getResponseId containers addAll allocateResponse getAllocatedContainers LOG info Integer toString allocateResponse getAllocatedContainers size numHeartbeat containers size numHeartbeat allocateRequest Records newRecord AllocateRequest allocateRequest setResponseId lastResponseId allocateResponse interceptor allocate allocateRequest Assert assertNotNull allocateResponse checkAMRMToken allocateResponse getAMRMToken lastResponseId allocateResponse getResponseId interceptor drainAllAsyncQueue containers addAll allocateResponse getAllocatedContainers
List containers Assert assertTrue containers size AllocateRequest allocateRequest Records newRecord AllocateRequest List ContainerId relList ArrayList ContainerId containers size container containers relList add container getId allocateRequest setReleaseList relList allocateRequest setResponseId lastResponseId AllocateResponse allocateResponse interceptor allocate allocateRequest Assert assertNotNull allocateResponse checkAMRMToken allocateResponse getAMRMToken lastResponseId allocateResponse getResponseId List ContainerId containersForReleasedContainerIds ArrayList ContainerId List ContainerId newlyFinished getCompletedContainerIds allocateResponse getCompletedContainersStatuses containersForReleasedContainerIds addAll newlyFinished
lastResponseId allocateResponse getResponseId List ContainerId containersForReleasedContainerIds ArrayList ContainerId List ContainerId newlyFinished getCompletedContainerIds allocateResponse getCompletedContainersStatuses containersForReleasedContainerIds addAll newlyFinished LOG info Integer toString newlyFinished size numHeartbeat containersForReleasedContainerIds size size numHeartbeat allocateRequest Records newRecord AllocateRequest allocateRequest setResponseId lastResponseId allocateResponse interceptor allocate allocateRequest Assert assertNotNull allocateResponse checkAMRMToken allocateResponse getAMRMToken lastResponseId allocateResponse getResponseId interceptor drainAllAsyncQueue newlyFinished getCompletedContainerIds allocateResponse getCompletedContainersStatuses
List ContainerId containersForReleasedContainerIds ArrayList ContainerId List ContainerId newlyFinished getCompletedContainerIds allocateResponse getCompletedContainersStatuses containersForReleasedContainerIds addAll newlyFinished LOG info Integer toString newlyFinished size numHeartbeat containersForReleasedContainerIds size size numHeartbeat allocateRequest Records newRecord AllocateRequest allocateRequest setResponseId lastResponseId allocateResponse interceptor allocate allocateRequest Assert assertNotNull allocateResponse checkAMRMToken allocateResponse getAMRMToken lastResponseId allocateResponse getResponseId interceptor drainAllAsyncQueue newlyFinished getCompletedContainerIds allocateResponse getCompletedContainersStatuses containersForReleasedContainerIds addAll newlyFinished
registerReq setHost Integer toString testAppId registerReq setRpcPort testAppId registerReq setTrackingUrl UserGroupInformation ugi interceptor getUGIWithToken interceptor getAttemptId ugi RegisterApplicationMasterResponse registerResponse interceptor registerApplicationMaster registerReq Assert assertNotNull registerResponse lastResponseId Assert assertEquals interceptor getUnmanagedAMPoolSize registerSubCluster SubClusterId newInstance registerSubCluster SubClusterId newInstance HOME_SC_ID numberOfContainers List Container containers getContainersAndAssert numberOfContainers numberOfContainers Container containers
localFS delete Path localDir getAbsolutePath localFS delete Path tmpDir getAbsolutePath localFS delete Path localLogDir getAbsolutePath localFS delete Path remoteLogDir getAbsolutePath localDir mkdir tmpDir mkdir localLogDir mkdir remoteLogDir mkdir
localFS delete Path localDir getAbsolutePath localFS delete Path tmpDir getAbsolutePath localFS delete Path localLogDir getAbsolutePath localFS delete Path remoteLogDir getAbsolutePath localDir mkdir tmpDir mkdir localLogDir mkdir remoteLogDir mkdir LOG info localDir getAbsolutePath
containerManager ContainerId containerID List ContainerState finalStates List ContainerId list ArrayList ContainerId list add containerID GetContainerStatusesRequest request GetContainerStatusesRequest newInstance list ContainerStatus containerStatus HashSet ContainerState fStates HashSet finalStates timeoutSecs Thread sleep containerStatus containerManager getContainerStatuses request getContainerStatuses get
containerManager appID Application app containerManager getContext getApplications get appID timeout app timeout
localFS delete Path localDir getAbsolutePath localFS delete Path tmpDir getAbsolutePath localFS delete Path localLogDir getAbsolutePath localFS delete Path remoteLogDir getAbsolutePath localDir mkdir tmpDir mkdir localLogDir mkdir remoteLogDir mkdir
localFS delete Path localDir getAbsolutePath localFS delete Path tmpDir getAbsolutePath localFS delete Path localLogDir getAbsolutePath localFS delete Path remoteLogDir getAbsolutePath localDir mkdir tmpDir mkdir localLogDir mkdir remoteLogDir mkdir LOG info localDir getAbsolutePath
StartContainersRequest allRequests StartContainersRequest newInstance list containerManager startContainers allRequests timeoutSecs processStartFile exists timeoutSecs Thread sleep LOG info Assert assertTrue processStartFile exists BufferedReader reader BufferedReader FileReader processStartFile String pid reader readLine trim Assert assertEquals reader readLine reader close reader BufferedReader FileReader childProcessStartFile String child reader readLine trim Assert assertEquals reader readLine reader close
List PrivilegedOperation ops ArrayList ops add opTasksNone ops add opDisallowed PrivilegedOperationExecutor squashCGroupOperations ops Assert fail e LOG info e ops clear ops add opTasksNone ops add opTasksInvalid PrivilegedOperationExecutor squashCGroupOperations ops Assert fail e
File emptyMtab createEmptyCgroups CGroupsHandler cGroupsHandler CGroupsHandlerImpl createMountConfiguration privilegedOperationExecutorMock emptyMtab getAbsolutePath PrivilegedOperation expectedOp PrivilegedOperation PrivilegedOperation OperationType MOUNT_CGROUPS String controllerKV controller getName tmpPath Path SEPARATOR controller getName expectedOp appendArgs hierarchy controllerKV cGroupsHandler initializeCGroupController controller ArgumentCaptor PrivilegedOperation opCaptor ArgumentCaptor forClass PrivilegedOperation verify privilegedOperationExecutorMock executePrivilegedOperation opCaptor capture eq Assert assertEquals expectedOp opCaptor getValue verifyNoMoreInteractions privilegedOperationExecutorMock cGroupsHandler initializeCGroupController controller verifyNoMoreInteractions privilegedOperationExecutorMock
PrivilegedOperation expectedOp PrivilegedOperation PrivilegedOperation OperationType MOUNT_CGROUPS String controllerKV controller getName tmpPath Path SEPARATOR controller getName expectedOp appendArgs hierarchy controllerKV cGroupsHandler initializeCGroupController controller ArgumentCaptor PrivilegedOperation opCaptor ArgumentCaptor forClass PrivilegedOperation verify privilegedOperationExecutorMock executePrivilegedOperation opCaptor capture eq Assert assertEquals expectedOp opCaptor getValue verifyNoMoreInteractions privilegedOperationExecutorMock cGroupsHandler initializeCGroupController controller verifyNoMoreInteractions privilegedOperationExecutorMock e LOG error e assertTrue e
String path cGroupsHandler createCGroup controller testCGroup assertTrue File expectedPath exists Assert assertEquals expectedPath path String param String paramValue cGroupsHandler updateCGroupParam controller testCGroup param paramValue String paramPath expectedPath Path SEPARATOR controller getName param File paramFile File paramPath assertTrue paramFile exists Assert assertEquals paramValue String Files readAllBytes paramFile toPath e LOG error e Assert fail
conf setBoolean YarnConfiguration NM_RECOVERY_ENABLED TrafficController trafficController TrafficController conf privilegedOperationExecutorMock when privilegedOperationExecutorMock executePrivilegedOperation any PrivilegedOperation eq thenReturn DEFAULT_TC_STATE_EXAMPLE trafficController bootstrap DEVICE ROOT_BANDWIDTH_MBIT YARN_BANDWIDTH_MBIT ArgumentCaptor PrivilegedOperation readOpCaptor ArgumentCaptor forClass PrivilegedOperation verify privilegedOperationExecutorMock times executePrivilegedOperation readOpCaptor capture eq List PrivilegedOperation readOps readOpCaptor getAllValues verifyTrafficControlOperation readOps get PrivilegedOperation OperationType TC_READ_STATE Arrays asList READ_QDISC_CMD READ_FILTER_CMD READ_CLASS_CMD ArgumentCaptor PrivilegedOperation writeOpCaptor ArgumentCaptor forClass PrivilegedOperation verify privilegedOperationExecutorMock times executePrivilegedOperation writeOpCaptor capture eq List PrivilegedOperation writeOps writeOpCaptor getAllValues verifyTrafficControlOperation writeOps get PrivilegedOperation OperationType TC_MODIFY_STATE Arrays asList WIPE_STATE_CMD verifyTrafficControlOperation writeOps get PrivilegedOperation OperationType TC_MODIFY_STATE Arrays asList ADD_ROOT_QDISC_CMD ADD_CGROUP_FILTER_CMD ADD_ROOT_CLASS_CMD ADD_DEFAULT_CLASS_CMD ADD_YARN_CLASS_CMD
Assert assertTrue classId MIN_CONTAINER_CLASS_ID Assert assertEquals String format FORMAT_CONTAINER_CLASS_STR classId trafficController getStringForNetClsClassId classId TrafficController BatchBuilder builder trafficController BatchBuilder PrivilegedOperation OperationType TC_MODIFY_STATE addContainerClass classId CONTAINER_BANDWIDTH_MBIT PrivilegedOperation addClassOp builder commitBatchToTempFile String expectedAddClassCmd String format FORMAT_ADD_CONTAINER_CLASS_TO_DEVICE classId YARN_BANDWIDTH_MBIT verifyTrafficControlOperation addClassOp PrivilegedOperation OperationType TC_MODIFY_STATE Arrays asList expectedAddClassCmd TrafficController BatchBuilder strictModeBuilder trafficController BatchBuilder PrivilegedOperation OperationType TC_MODIFY_STATE addContainerClass classId CONTAINER_BANDWIDTH_MBIT PrivilegedOperation addClassStrictModeOp strictModeBuilder commitBatchToTempFile String expectedAddClassStrictModeCmd String format FORMAT_ADD_CONTAINER_CLASS_TO_DEVICE classId CONTAINER_BANDWIDTH_MBIT verifyTrafficControlOperation addClassStrictModeOp PrivilegedOperation OperationType TC_MODIFY_STATE Arrays asList expectedAddClassStrictModeCmd TrafficController BatchBuilder deleteBuilder trafficController BatchBuilder PrivilegedOperation OperationType TC_MODIFY_STATE deleteContainerClass classId PrivilegedOperation deleteClassOp deleteBuilder commitBatchToTempFile String expectedDeleteClassCmd String format FORAMT_DELETE_CONTAINER_CLASS_FROM_DEVICE classId verifyTrafficControlOperation deleteClassOp PrivilegedOperation OperationType TC_MODIFY_STATE Arrays asList expectedDeleteClassCmd
when mockApplicationId toString thenReturn when appAttemptId getApplicationId thenReturn mockApplicationId when cId getApplicationAttemptId thenReturn appAttemptId when container getLaunchContext thenReturn context when context getEnvironment thenReturn env when container getUser thenReturn submittingUser String uid String gid Shell ShellCommandExecutor shexec1 Shell ShellCommandExecutor String runAsUser Shell ShellCommandExecutor shexec2 Shell ShellCommandExecutor String runAsUser Shell ShellCommandExecutor shexec3 Shell ShellCommandExecutor String runAsUser shexec1 execute uid shexec1 getOutput replaceAll
when container getUser thenReturn submittingUser String uid String gid Shell ShellCommandExecutor shexec1 Shell ShellCommandExecutor String runAsUser Shell ShellCommandExecutor shexec2 Shell ShellCommandExecutor String runAsUser Shell ShellCommandExecutor shexec3 Shell ShellCommandExecutor String runAsUser shexec1 execute uid shexec1 getOutput replaceAll e LOG info e shexec2 execute gid shexec2 getOutput replaceAll e
Shell ShellCommandExecutor shexec3 Shell ShellCommandExecutor String runAsUser shexec1 execute uid shexec1 getOutput replaceAll e LOG info e shexec2 execute gid shexec2 getOutput replaceAll e LOG info e shexec3 execute groups shexec3 getOutput replace split e
ConcurrentMap ContainerId Container containerMap mock ConcurrentMap when mockNMContext getLocalDirsHandler thenReturn localDirsHandler when mockNMContext getResourcePluginManager thenReturn resourcePluginManager when mockNMContext getContainers thenReturn containerMap when containerMap get any thenReturn container ContainerManager mockContainerManager mock ContainerManager ResourceLocalizationService mockLocalzationService mock ResourceLocalizationService LocalizedResource mockLocalizedResource mock LocalizedResource when mockLocalizedResource getLocalPath thenReturn Path when mockLocalzationService getLocalizedResource any anyString any thenReturn mockLocalizedResource when mockContainerManager getResourceLocalizationService thenReturn mockLocalzationService when mockNMContext getContainerManager thenReturn mockContainerManager when localDirsHandler getLocalPathForWrite anyString thenReturn Path tmpPath
Assert assertEquals dockerCommands get counter Assert assertEquals String join groups dockerCommands get counter Assert assertEquals dockerCommands get counter Assert assertEquals dockerCommands get counter Assert assertEquals dockerCommands get counter Assert assertEquals dockerCommands get counter Assert assertEquals dockerCommands get counter Assert assertEquals dockerCommands get counter Assert assertEquals uidGidPair dockerCommands get counter Assert assertEquals dockerCommands get counter env put DockerLinuxContainerRuntime ENV_DOCKER_CONTAINER_NETWORK customNetwork3 runtime launchContainer builder build Assert fail customNetwork3
ConcurrentMap ContainerId Container containerMap mock ConcurrentMap when mockNMContext getLocalDirsHandler thenReturn localDirsHandler when mockNMContext getResourcePluginManager thenReturn resourcePluginManager when mockNMContext getContainers thenReturn containerMap when containerMap get any thenReturn container ContainerManager mockContainerManager mock ContainerManager ResourceLocalizationService mockLocalzationService mock ResourceLocalizationService LocalizedResource mockLocalizedResource mock LocalizedResource when mockLocalizedResource getLocalPath thenReturn Path when mockLocalzationService getLocalizedResource any anyString any thenReturn mockLocalizedResource when mockContainerManager getResourceLocalizationService thenReturn mockLocalzationService when mockNMContext getContainerManager thenReturn mockContainerManager when localDirsHandler getLocalPathForWrite anyString thenReturn Path tmpPath
File appLogDir containerId String String String containerStr containerId toString File containerLogDir File appLogDir containerStr created containerLogDir mkdirs
LogKey key LogKey valueStream reader next key valueStream LOG info key toString Map String String perContainerMap HashMap String String logMap put key toString perContainerMap ByteArrayOutputStream baos ByteArrayOutputStream PrintStream ps PrintStream baos LogReader readAContainerLogsForALogType valueStream ps String writtenLines baos toString split System getProperty Assert assertEquals writtenLines substring String fileType writtenLines substring fileTypes add fileType
logAggregationService appId String Path appLogDir logAggregationService getLogAggregationFileController conf getRemoteAppLogDir appId user RemoteIterator FileStatus nodeFiles Path qualifiedLogDir FileContext getFileContext conf makeQualified appLogDir nodeFiles FileContext getFileContext qualifiedLogDir toUri conf listStatus appLogDir fnf LOG info fnf count nodeFiles FileStatus status nodeFiles next String filename status getPath getName filename filename LOG info filename
Path qualifiedLogDir FileContext getFileContext conf makeQualified appLogDir nodeFiles FileContext getFileContext qualifiedLogDir toUri conf listStatus appLogDir fnf LOG info fnf count nodeFiles FileStatus status nodeFiles next String filename status getPath getName filename lastLogFile filename lastLogFile LOG info filename LOG info lastLogFile filename
totalBoostAgainstMedian bstAgainstMedian totalBoostAgainstMin bstAgainstMinimum count maxBoostAgainstMedian bstAgainstMedian maxBoostAgainstMedian bstAgainstMedian maxBoostAgainstMin bstAgainstMinimum maxBoostAgainstMin bstAgainstMinimum totalBoostAgainstMinCertainModel bstAgainstMinimum totalBoostAgainstMedianCertainModel bstAgainstMedian maxBoostAgainstMinCertainModel bstAgainstMinimum maxBoostAgainstMinCertainModel bstAgainstMinimum maxBoostAgainstMedianCertainModel bstAgainstMedian maxBoostAgainstMedianCertainModel bstAgainstMedian countOfEachModel LOG info model maxBoostAgainstMedianCertainModel
totalBoostAgainstMin bstAgainstMinimum count maxBoostAgainstMedian bstAgainstMedian maxBoostAgainstMedian bstAgainstMedian maxBoostAgainstMin bstAgainstMinimum maxBoostAgainstMin bstAgainstMinimum totalBoostAgainstMinCertainModel bstAgainstMinimum totalBoostAgainstMedianCertainModel bstAgainstMedian maxBoostAgainstMinCertainModel bstAgainstMinimum maxBoostAgainstMinCertainModel bstAgainstMinimum maxBoostAgainstMedianCertainModel bstAgainstMedian maxBoostAgainstMedianCertainModel bstAgainstMedian countOfEachModel LOG info model maxBoostAgainstMedianCertainModel LOG info model totalBoostAgainstMedianCertainModel countOfEachModel
count maxBoostAgainstMedian bstAgainstMedian maxBoostAgainstMedian bstAgainstMedian maxBoostAgainstMin bstAgainstMinimum maxBoostAgainstMin bstAgainstMinimum totalBoostAgainstMinCertainModel bstAgainstMinimum totalBoostAgainstMedianCertainModel bstAgainstMedian maxBoostAgainstMinCertainModel bstAgainstMinimum maxBoostAgainstMinCertainModel bstAgainstMinimum maxBoostAgainstMedianCertainModel bstAgainstMedian maxBoostAgainstMedianCertainModel bstAgainstMedian countOfEachModel LOG info model maxBoostAgainstMedianCertainModel LOG info model totalBoostAgainstMedianCertainModel countOfEachModel LOG info model maxBoostAgainstMinCertainModel
maxBoostAgainstMin bstAgainstMinimum maxBoostAgainstMin bstAgainstMinimum totalBoostAgainstMinCertainModel bstAgainstMinimum totalBoostAgainstMedianCertainModel bstAgainstMedian maxBoostAgainstMinCertainModel bstAgainstMinimum maxBoostAgainstMinCertainModel bstAgainstMinimum maxBoostAgainstMedianCertainModel bstAgainstMedian maxBoostAgainstMedianCertainModel bstAgainstMedian countOfEachModel LOG info model maxBoostAgainstMedianCertainModel LOG info model totalBoostAgainstMedianCertainModel countOfEachModel LOG info model maxBoostAgainstMinCertainModel LOG info model totalBoostAgainstMinCertainModel countOfEachModel LOG info maxBoostAgainstMedian LOG info totalBoostAgainstMedian count
port startNMWebAppServer
LOG info port StringBuilder sb StringBuilder sb append append port append String dest sb toString WebSocketClient client WebSocketClient ContainerShellClientSocketTest socket ContainerShellClientSocketTest client start URI echoUri URI dest Future Session future client connect socket echoUri Session session future get session getRemote sendString session close client stop
ContainerShellClientSocketTest socket ContainerShellClientSocketTest client start URI echoUri URI dest Future Session future client connect socket echoUri Session session future get session getRemote sendString session close client stop t LOG error t client stop server close
request String operation UserGroupInformation user checkAcls operation checkRMStatus user getShortUserName operation Map NodeId ResourceOption nodeResourceMap request getNodeResourceMap Set NodeId nodeIds nodeResourceMap keySet NodeId nodeId nodeIds RMNode node rm getRMContext getRMNodes get nodeId node
NodeId nodeId RMNode node rm getRMContext getRMNodes get nodeId node LOG error nodeId RPCUtil getRemoteException nodeId allSuccess NodeId ResourceOption entry ResourceOption newResourceOption entry getValue NodeId nodeId entry getKey RMNode node rm getRMContext getRMNodes get nodeId node LOG warn nodeId allSuccess rm getRMContext getDispatcher getEventHandler handle RMNodeResourceUpdateEvent nodeId newResourceOption
conf String placementConstraintsHandler conf get YarnConfiguration RM_PLACEMENT_CONSTRAINTS_HANDLER YarnConfiguration DISABLED_RM_PLACEMENT_CONSTRAINTS_HANDLER placementConstraintsHandler YarnConfiguration DISABLED_RM_PLACEMENT_CONSTRAINTS_HANDLER
FinishApplicationMasterResponse ApplicationAttemptId applicationAttemptId YarnServerSecurityUtils authorizeRequest getApplicationAttemptId ApplicationId appId applicationAttemptId getApplicationId RMApp rmApp rmContext getRMApps get applicationAttemptId getApplicationId RMAppImpl rmApp removeCollectorData rmApp LOG info rmApp getApplicationId FinishApplicationMasterResponse newInstance AllocateResponseLock lock responseMap get applicationAttemptId lock throwApplicationDoesNotExistInCacheException applicationAttemptId lock applicationAttemptId String message appId
appAttemptId String message appAttemptId
AMRMTokenIdentifier amrmTokenIdentifier YarnServerSecurityUtils authorizeRequest ApplicationAttemptId appAttemptId amrmTokenIdentifier getApplicationAttemptId amLivelinessMonitor receivedPing appAttemptId AllocateResponseLock lock responseMap get appAttemptId lock String message appAttemptId
appAttemptId String message appAttemptId ApplicationMasterNotRegisteredException message AMRMClientUtils request getResponseId lastResponse getResponseId lastResponse request getResponseId lastResponse getResponseId InvalidApplicationMasterRequestException AMRMClientUtils assembleInvalidResponseIdExceptionMessage appAttemptId lastResponse getResponseId request getResponseId AllocateResponse response recordFactory newRecordInstance AllocateResponse amsProcessingChain allocate amrmTokenIdentifier getApplicationAttemptId request response MasterKeyData nextMasterKey rmContext getAMRMTokenSecretManager getNextMasterKeyData nextMasterKey nextMasterKey amrmTokenIdentifier RMApp app rmContext getRMApps get appAttemptId getApplicationId RMAppAttempt appAttempt app getRMAppAttempt appAttemptId RMAppAttemptImpl appAttemptImpl RMAppAttemptImpl appAttempt Token AMRMTokenIdentifier amrmToken appAttempt getAMRMToken
AllocateResponse response recordFactory newRecordInstance AllocateResponse response setResponseId AMRMClientUtils PRE_REGISTER_RESPONSE_ID
ApplicationId ApplicationId applicationId org apache hadoop yarn server utils BuilderUtils newApplicationId recordFactory ResourceManager getClusterTimeStamp applicationCounter incrementAndGet
LOG warn ie RMAuditLogger logFailure user AuditConstants SUBMIT_APP_REQUEST ie getMessage applicationId callerContext submissionContext getQueue RPCUtil getRemoteException ie checkTags submissionContext getApplicationTags String value String tag submissionContext getApplicationTags tag TimelineUtils FLOW_RUN_ID_TAG_PREFIX tag TimelineUtils FLOW_RUN_ID_TAG_PREFIX value tag substring TimelineUtils FLOW_RUN_ID_TAG_PREFIX length Long valueOf value e LOG warn value e RMAuditLogger logFailure user AuditConstants SUBMIT_APP_REQUEST e getMessage applicationId submissionContext getQueue RPCUtil getRemoteException e
String value String tag submissionContext tag TimelineUtils FLOW_RUN_ID_TAG_PREFIX tag TimelineUtils FLOW_RUN_ID_TAG_PREFIX value tag substring TimelineUtils FLOW_RUN_ID_TAG_PREFIX length Long valueOf value e LOG warn value e RMAuditLogger logFailure user AuditConstants SUBMIT_APP_REQUEST e getMessage applicationId submissionContext getQueue RPCUtil getRemoteException e applicationId LOG info applicationId SubmitApplicationResponse newInstance ByteBuffer tokenConf submissionContext getAMContainerSpec getTokensConf
RMAuditLogger ArgsBuilder arguments RMAuditLogger ArgsBuilder append Keys QUEUENAME request getQueueName append Keys INCLUDEAPPS String valueOf request getIncludeApplications append Keys INCLUDECHILDQUEUES String valueOf request getIncludeChildQueues append Keys RECURSIVE String valueOf request getRecursive QueueInfo queueInfo scheduler getQueueInfo request getQueueName request getIncludeChildQueues request getRecursive List ApplicationReport appReports EMPTY_APPS_REPORT request getIncludeApplications List ApplicationAttemptId apps scheduler getAppsInQueue request getQueueName appReports ArrayList ApplicationReport apps size ApplicationAttemptId app apps RMApp rmApp rmContext getRMApps get app getApplicationId rmApp callerUGI rmApp rmApp appReports add rmApp createAndGetApplicationReport callerUGI getUserName queueInfo setApplications appReports response setQueueInfo queueInfo
planName reservationId reservationSystem LOG debug reservationId reservationSystem synchronizePlan planName
nodeId DecommissioningNodeContext context decomNodes get nodeId context
applicationAttemptId RMApp app getRmContext getRMApps get applicationAttemptId getApplicationId
app List Container transferredContainers getScheduler getTransferredContainers applicationAttemptId transferredContainers response setContainersFromPreviousAttempts transferredContainers rmContext getNMTokenSecretManager clearNodeSetForAttempt applicationAttemptId List NMToken nmTokens ArrayList NMToken Container container transferredContainers NMToken token getRmContext getNMTokenSecretManager createAndGetNMToken app getUser applicationAttemptId container token nmTokens add token e e getCause UnknownHostException UnknownHostException e getCause response setNMTokensFromPreviousAttempts nmTokens
List RMNode nodesToDecom ArrayList RMNode HostDetails hostDetails gracefulDecommissionableNodes clear hostDetails hostsReader getLazyLoadedHostDetails hostDetails hostsReader getHostDetails Set String includes hostDetails getIncludedHosts Map String Integer excludes hostDetails getExcludedMap RMNode n NodeState s n getState isExcluded isValidNode n getHostName includes excludes keySet String nodeStr n getNodeID s isExcluded s NodeState
hostDetails hostsReader getHostDetails Set String includes hostDetails getIncludedHosts Map String Integer excludes hostDetails getExcludedMap n NodeState s n getState isExcluded isValidNode n getHostName includes excludes keySet String nodeStr n getNodeID s isExcluded s NodeState LOG info nodeStr nodesToRecom add n Integer timeoutToUse excludes get n getHostName excludes get n getHostName timeout
Map String Integer excludes hostDetails getExcludedMap n NodeState s n getState isExcluded isValidNode n getHostName includes excludes keySet String nodeStr n getNodeID s isExcluded s NodeState LOG info nodeStr nodesToRecom add n Integer timeoutToUse excludes get n getHostName excludes get n getHostName timeout s NodeState s NodeState LOG info nodeStr nodesToDecom add n
String nodeStr n getNodeID s s LOG info nodeStr nodesToRecom add n Integer timeoutToUse excludes get n getHostName excludes get n getHostName timeout s s LOG info nodeStr nodesToDecom add n gracefulDecommissionableNodes add n s n timeoutToUse LOG info nodeStr timeoutToUse nodesToDecom add n
LOG info nodeStr nodesToRecom add n Integer timeoutToUse excludes get n getHostName excludes get n getHostName timeout LOG info nodeStr nodesToDecom add n gracefulDecommissionableNodes add n n timeoutToUse LOG info nodeStr timeoutToUse nodesToDecom add n gracefulDecommissionableNodes add n LOG info nodeStr
completedAppsInStateStore ApplicationId removeId completedApps get completedApps size completedAppsInStateStore RMApp removeApp rmContext getRMApps get removeId
event ApplicationId applicationId event getApplicationId
String schedulerClassName conf get YarnConfiguration RM_SCHEDULER YarnConfiguration DEFAULT_RM_SCHEDULER
String schedulerClassName YarnConfiguration DEFAULT_YARN_API_SYSTEM_SERVICES_CLASS
builder withAttribute WebAppProxy PROXY_HOST_ATTRIBUTE proxyParts WebAppContext uiWebAppContext getConfig YarnConfiguration YarnConfiguration String onDiskPath getConfig get YarnConfiguration YARN_WEBAPP_UI2_WARFILE_PATH uiWebAppContext WebAppContext uiWebAppContext setContextPath UI2_WEBAPP_NAME onDiskPath String war VersionInfo getVersion URL url getClass getClassLoader getResource war url onDiskPath getWebAppsPath onDiskPath url getFile onDiskPath onDiskPath LOG error
getConfig YarnConfiguration YarnConfiguration String onDiskPath getConfig get YarnConfiguration YARN_WEBAPP_UI2_WARFILE_PATH uiWebAppContext WebAppContext uiWebAppContext setContextPath UI2_WEBAPP_NAME onDiskPath String war VersionInfo getVersion URL url getClass getClassLoader getResource war url onDiskPath getWebAppsPath onDiskPath url getFile onDiskPath onDiskPath LOG error onDiskPath
argv argv deleteRMStateStore conf argv deleteRMConfStore conf argv argv removeApplication conf argv printUsage System err ResourceManager resourceManager ResourceManager ShutdownHookManager get addShutdownHook CompositeServiceShutdownHook resourceManager SHUTDOWN_HOOK_PRIORITY resourceManager init conf resourceManager start
conf applicationId RMStateStore rmStore RMStateStoreFactory getStore conf rmStore setResourceManager ResourceManager rmStore init conf rmStore start ApplicationId removeAppId ApplicationId fromString applicationId
containerStatus ApplicationAttemptId appAttemptId containerStatus getContainerId getApplicationAttemptId RMApp rmApp rmContext getRMApps get appAttemptId getApplicationId rmApp
RegisterNodeManagerResponse request NodeId nodeId request getNodeId String host nodeId getHost cmPort nodeId getPort httpPort request getHttpPort Resource capability request getResource String nodeManagerVersion request getNMVersion Resource physicalResource request getPhysicalResource NodeStatus nodeStatus request getNodeStatus RegisterNodeManagerResponse response recordFactory newRecordInstance RegisterNodeManagerResponse minimumNodeManagerVersion minimumNodeManagerVersion minimumNodeManagerVersion YarnVersionInfo getVersion nodeManagerVersion nodeManagerVersion minimumNodeManagerVersion String message nodeManagerVersion minimumNodeManagerVersion
String message nodeManagerVersion minimumNodeManagerVersion LOG info message response setDiagnosticsMessage message response setNodeAction NodeAction SHUTDOWN response InetSocketAddress nmAddress NetUtils createSocketAddrForHost host cmPort InetAddress inetAddress Server getRemoteIp inetAddress nmAddress String message inetAddress getHostAddress host LOG warn message response setDiagnosticsMessage message response setNodeAction NodeAction SHUTDOWN response host
LOG warn message response setDiagnosticsMessage message response setNodeAction NodeAction SHUTDOWN response host nodeId String message host LOG info message response setDiagnosticsMessage message response setNodeAction NodeAction SHUTDOWN response String nid nodeId toString Resource dynamicLoadCapability loadNodeResourceFromDRConfiguration nid dynamicLoadCapability LOG debug nid capability dynamicLoadCapability capability dynamicLoadCapability
String nid nodeId toString Resource dynamicLoadCapability loadNodeResourceFromDRConfiguration nid dynamicLoadCapability LOG debug nid capability dynamicLoadCapability capability dynamicLoadCapability response setResource capability capability minAllocMb capability minAllocVcores String message host capability minAllocMb minAllocVcores LOG info message response setDiagnosticsMessage message response setNodeAction NodeAction SHUTDOWN response response setContainerTokenMasterKey containerTokenSecretManager getCurrentKey response setNMTokenMasterKey nmTokenSecretManager getCurrentKey RMNode rmNode RMNodeImpl nodeId rmContext host cmPort httpPort resolve host capability nodeManagerVersion physicalResource
LOG debug nid capability dynamicLoadCapability capability dynamicLoadCapability response setResource capability capability minAllocMb capability minAllocVcores String message host capability minAllocMb minAllocVcores LOG info message response setDiagnosticsMessage message response setNodeAction NodeAction SHUTDOWN response response setContainerTokenMasterKey containerTokenSecretManager getCurrentKey response setNMTokenMasterKey nmTokenSecretManager getCurrentKey RMNode rmNode RMNodeImpl nodeId rmContext host cmPort httpPort resolve host capability nodeManagerVersion physicalResource RMNode oldNode rmContext getRMNodes putIfAbsent nodeId rmNode oldNode RMNodeStartedEvent startEvent RMNodeStartedEvent nodeId request getNMContainerStatuses request getRunningApplications nodeStatus
LOG debug nodeId request getLogAggregationReportsForApps size startEvent setLogAggregationReportsForApps request getLogAggregationReportsForApps rmContext getDispatcher getEventHandler handle startEvent LOG info host nmLivelinessMonitor unregister nodeId request rmNode rmNode rmNode LOG debug rmContext getDispatcher getEventHandler handle NodeRemovedSchedulerEvent rmNode rmContext getRMNodes put nodeId rmNode
request NodeStatus remoteNodeStatus request getNodeStatus NodeId nodeId remoteNodeStatus getNodeId nodeId getHost nodeId String message nodeId nodeId getHost
NodeStatus remoteNodeStatus request getNodeStatus NodeId nodeId remoteNodeStatus getNodeId nodeId getHost nodeId String message nodeId nodeId getHost LOG info message YarnServerBuilderUtils newNodeHeartbeatResponse NodeAction SHUTDOWN message RMNode rmNode rmContext getRMNodes get nodeId rmNode String message remoteNodeStatus getNodeId LOG info message YarnServerBuilderUtils newNodeHeartbeatResponse NodeAction RESYNC message nmLivelinessMonitor receivedPing nodeId decommissioningWatcher update rmNode remoteNodeStatus NodeHeartbeatResponse lastNodeHeartbeatResponse rmNode getLastNodeHeartBeatResponse remoteNodeStatus lastNodeHeartbeatResponse
LOG info message YarnServerBuilderUtils newNodeHeartbeatResponse NodeAction SHUTDOWN message RMNode rmNode rmContext getRMNodes get nodeId rmNode String message remoteNodeStatus getNodeId LOG info message YarnServerBuilderUtils newNodeHeartbeatResponse NodeAction RESYNC message nmLivelinessMonitor receivedPing nodeId decommissioningWatcher update rmNode remoteNodeStatus NodeHeartbeatResponse lastNodeHeartbeatResponse rmNode getLastNodeHeartBeatResponse remoteNodeStatus getResponseId lastNodeHeartbeatResponse getResponseId LOG info rmNode getNodeAddress remoteNodeStatus getResponseId lastNodeHeartbeatResponse remoteNodeStatus getResponseId lastNodeHeartbeatResponse getResponseId String message lastNodeHeartbeatResponse getResponseId remoteNodeStatus getResponseId
String message remoteNodeStatus getNodeId LOG info message YarnServerBuilderUtils newNodeHeartbeatResponse NodeAction RESYNC message nmLivelinessMonitor receivedPing nodeId decommissioningWatcher update rmNode remoteNodeStatus NodeHeartbeatResponse lastNodeHeartbeatResponse rmNode getLastNodeHeartBeatResponse remoteNodeStatus getResponseId lastNodeHeartbeatResponse getResponseId LOG info rmNode getNodeAddress remoteNodeStatus getResponseId lastNodeHeartbeatResponse remoteNodeStatus getResponseId lastNodeHeartbeatResponse getResponseId String message lastNodeHeartbeatResponse getResponseId remoteNodeStatus getResponseId LOG info message rmContext getDispatcher getEventHandler handle RMNodeEvent nodeId RMNodeEventType REBOOTING YarnServerBuilderUtils newNodeHeartbeatResponse NodeAction RESYNC message rmNode decommissioningWatcher rmNode
Map ApplicationId RMApp rmApps rmContext getRMApps Map ApplicationId AppCollectorData entry ApplicationId appId entry getKey AppCollectorData collectorData entry getValue collectorData collectorData collectorData setRMIdentifier ResourceManager getClusterTimeStamp collectorData setVersion timelineCollectorVersion getAndIncrement RMApp rmApp rmApps get appId rmApp LOG warn appId rmApp AppCollectorData previousCollectorData rmApp getCollectorData AppCollectorData previousCollectorData collectorData
UnRegisterNodeManagerResponse request UnRegisterNodeManagerResponse response recordFactory newRecordInstance UnRegisterNodeManagerResponse NodeId nodeId request getNodeId RMNode rmNode rmContext getRMNodes get nodeId rmNode
Set String nodeLabels NodeId nodeId Map NodeId Set String labelsUpdate HashMap NodeId Set String labelsUpdate put nodeId nodeLabels rmContext getNodeLabelManager replaceLabelsOnNode labelsUpdate
wasEvent writer applicationStarted wasEvent getApplicationStartData
writer applicationStarted wasEvent getApplicationStartData LOG info wasEvent getApplicationId LOG error wasEvent getApplicationId wafEvent writer applicationFinished wafEvent getApplicationFinishData LOG info wafEvent getApplicationId LOG error wafEvent getApplicationId waasEvent writer applicationAttemptStarted waasEvent getApplicationAttemptStartData
LOG error wasEvent getApplicationId wafEvent writer applicationFinished wafEvent getApplicationFinishData LOG info wafEvent getApplicationId LOG error wafEvent getApplicationId waasEvent writer applicationAttemptStarted waasEvent getApplicationAttemptStartData LOG info waasEvent getApplicationAttemptId
wafEvent writer applicationFinished wafEvent getApplicationFinishData LOG info wafEvent getApplicationId LOG error wafEvent getApplicationId waasEvent writer applicationAttemptStarted waasEvent getApplicationAttemptStartData LOG info waasEvent getApplicationAttemptId LOG error waasEvent getApplicationAttemptId
writer applicationFinished wafEvent getApplicationFinishData LOG info wafEvent getApplicationId LOG error wafEvent getApplicationId waasEvent writer applicationAttemptStarted waasEvent getApplicationAttemptStartData LOG info waasEvent getApplicationAttemptId LOG error waasEvent getApplicationAttemptId waafEvent writer applicationAttemptFinished waafEvent getApplicationAttemptFinishData
waasEvent writer applicationAttemptStarted waasEvent getApplicationAttemptStartData LOG info waasEvent getApplicationAttemptId LOG error waasEvent getApplicationAttemptId waafEvent writer applicationAttemptFinished waafEvent getApplicationAttemptFinishData LOG info waafEvent getApplicationAttemptId LOG error waafEvent getApplicationAttemptId
connect ContainerId masterContainerID masterContainer getId ApplicationSubmissionContext applicationContext application getSubmissionContext
connect ContainerId masterContainerID masterContainer getId ApplicationSubmissionContext applicationContext application getSubmissionContext LOG info masterContainer application getAppAttemptId ContainerLaunchContext launchContext createAMContainerLaunchContext applicationContext masterContainerID StartContainerRequest scRequest StartContainerRequest newInstance launchContext masterContainer getContainerToken List StartContainerRequest list ArrayList StartContainerRequest list add scRequest StartContainersRequest allRequests StartContainersRequest newInstance list StartContainersResponse response containerMgrProxy startContainers allRequests response getFailedRequests response getFailedRequests masterContainerID Throwable t response getFailedRequests get masterContainerID deSerialize parseAndThrowException t
LOG info application getAppAttemptId launch handler handle RMAppAttemptEvent application getAppAttemptId RMAppAttemptEventType LAUNCHED System currentTimeMillis ie onAMLaunchFailed masterContainer getId ie LOG info application getAppAttemptId cleanup ie LOG info ie StringBuilder sb StringBuilder sb append masterContainer getId toString append sb toString
ie String message application getAppAttemptId StringUtils stringifyException ie
ResourceBlacklistRequest ResourceBlacklistRequest ret List String blacklist ArrayList blacklistNodes currentBlacklistSize blacklist size failureThreshold blacklistDisableFailureThreshold numberOfNodeManagerHosts currentBlacklistSize failureThreshold
updateClusterState SubClusterHeartbeatRequest request SubClusterHeartbeatRequest newInstance subClusterId SubClusterState SC_RUNNING capability stateStoreService subClusterHeartbeat request
String clientRMAddress getServiceAddress rmContext getClientRMService getBindAddress String amRMAddress getServiceAddress rmContext getApplicationMasterService getBindAddress String rmAdminAddress getServiceAddress config getSocketAddr YarnConfiguration RM_ADMIN_ADDRESS YarnConfiguration DEFAULT_RM_ADMIN_ADDRESS YarnConfiguration DEFAULT_RM_ADMIN_PORT String webAppAddress getServiceAddress NetUtils createSocketAddr WebAppUtils getRMWebAppURLWithScheme config SubClusterInfo subClusterInfo SubClusterInfo newInstance subClusterId amRMAddress clientRMAddress rmAdminAddress webAppAddress SubClusterState SC_NEW ResourceManager getClusterTimeStamp registerSubCluster SubClusterRegisterRequest newInstance subClusterInfo
entity appId LOG LOG debug entity TimelineUtils dumpTimelineRecordtoJSON entity TimelineCollector timelineCollector rmTimelineCollectorManager get appId timelineCollector TimelineEntities entities TimelineEntities entities addEntity entity timelineCollector putEntities entities UserGroupInformation getCurrentUser LOG debug entity e LOG error entity LOG debug entity e e
name SchedulingMonitor mon runningSchedulingMonitors get name mon stop
Map ApplicationAttemptId Set RMContainer Map ApplicationAttemptId Set RMContainer selectedCandidates clusterResource totalPreemptionAllowed Map ApplicationAttemptId Set RMContainer curCandidates HashMap preemptableAmountCalculator computeIdealAllocation clusterResource totalPreemptionAllowed CapacitySchedulerPreemptionUtils deductPreemptableResourcesBasedSelectedCandidates preemptionContext selectedCandidates List RMContainer skippedAMContainerlist ArrayList preemptionContext preemptionContext
Collection FiCaSchedulerApp apps tq leafQueue getAllApplications apps PriorityQueue TempAppPerPartition orderedByPriority createTempAppForResCalculation tq apps clusterResource perUserAMUsed TreeSet TempAppPerPartition orderedApps calculateIdealAssignedResourcePerApp clusterResource tq selectedCandidates queueReassignableResource orderedByPriority Resource maxIntraQueuePreemptable Resources multiply tq getGuaranteed maxAllowablePreemptLimit Resources rc clusterResource maxIntraQueuePreemptable tq getActuallyToBePreempted Resources subtractFrom maxIntraQueuePreemptable tq getActuallyToBePreempted maxIntraQueuePreemptable Resource newInstance Resource preemptionLimit Resources min rc clusterResource maxIntraQueuePreemptable totalPreemptedResourceAllowed calculateToBePreemptedResourcePerApp clusterResource orderedApps Resources clone preemptionLimit tq addAllApps orderedApps validateOutSameAppPriorityFromDemand clusterResource TreeSet TempAppPerPartition orderedApps tq getUsersPerPartition context getIntraQueuePreemptionOrderPolicy
PriorityQueue TempAppPerPartition orderedByPriority createTempAppForResCalculation tq apps clusterResource perUserAMUsed TreeSet TempAppPerPartition orderedApps calculateIdealAssignedResourcePerApp clusterResource tq selectedCandidates queueReassignableResource orderedByPriority Resource maxIntraQueuePreemptable Resources multiply tq getGuaranteed maxAllowablePreemptLimit Resources rc clusterResource maxIntraQueuePreemptable tq getActuallyToBePreempted Resources subtractFrom maxIntraQueuePreemptable tq getActuallyToBePreempted maxIntraQueuePreemptable Resource newInstance Resource preemptionLimit Resources min rc clusterResource maxIntraQueuePreemptable totalPreemptedResourceAllowed calculateToBePreemptedResourcePerApp clusterResource orderedApps Resources clone preemptionLimit tq addAllApps orderedApps validateOutSameAppPriorityFromDemand clusterResource TreeSet TempAppPerPartition orderedApps tq getUsersPerPartition context getIntraQueuePreemptionOrderPolicy LOG LOG debug tq queueName tq partition TempAppPerPartition tq
used used Resources createResource used amUsed amUsed Resources createResource amUsed pending pending Resources createResource pending reserved reserved Resources createResource reserved HashSet String partitions HashSet String app getAppAttemptResourceUsage getNodePartitionsSet partitions addAll app getTotalPendingRequestsPerPartition keySet TempAppPerPartition tmpApp TempAppPerPartition app Resources clone used Resources clone amUsed Resources clone reserved Resources clone pending tmpApp idealAssigned Resources createResource String userName app getUser TempUserPerPartition tmpUser usersPerPartition get userName tmpUser ResourceUsage userResourceUsage tq leafQueue getUser userName getResourceUsage Resource userSpecificAmUsed perUserAMUsed get userName amUsed userSpecificAmUsed Resources none userSpecificAmUsed tmpUser TempUserPerPartition tq leafQueue getUser userName tq queueName Resources clone userResourceUsage getUsed partition Resources clone amUsed Resources clone userResourceUsage getReserved partition Resources none
partition leafQueue rollingResourceUsagePerUser user leafQueue rollingResourceUsagePerUser put user Resources clone leafQueue getUser user getResourceUsage getUsed partition
app RMContainer RMContainer List RMContainer liveContainers ArrayList app getLiveContainers sortContainers liveContainers
app RMContainer RMContainer Resource Resource totalPreemptedResourceAllowed Resource Resource rollingResourceUsagePerUser List RMContainer liveContainers ArrayList app getLiveContainers sortContainers liveContainers LOG debug totalPreemptedResourceAllowed Resource rollingUsedResourcePerUser rollingResourceUsagePerUser get app getUser RMContainer liveContainers app rollingUsedResourcePerUser
candidatesSelectionPolicies add QueuePriorityContainerCandidateSelector selectCandidatesForResevedContainers config getBoolean CapacitySchedulerConfiguration PREEMPTION_SELECT_CANDIDATES_FOR_RESERVED_CONTAINERS CapacitySchedulerConfiguration DEFAULT_PREEMPTION_SELECT_CANDIDATES_FOR_RESERVED_CONTAINERS selectCandidatesForResevedContainers candidatesSelectionPolicies add ReservedContainerCandidatesSelector additionalPreemptionBasedOnReservedResource config getBoolean CapacitySchedulerConfiguration ADDITIONAL_RESOURCE_BALANCE_BASED_ON_RESERVED_CONTAINERS CapacitySchedulerConfiguration DEFAULT_ADDITIONAL_RESOURCE_BALANCE_BASED_ON_RESERVED_CONTAINERS candidatesSelectionPolicies add FifoCandidatesSelector additionalPreemptionBasedOnReservedResource isPreemptionToBalanceRequired config getBoolean CapacitySchedulerConfiguration PREEMPTION_TO_BALANCE_QUEUES_BEYOND_GUARANTEED CapacitySchedulerConfiguration DEFAULT_PREEMPTION_TO_BALANCE_QUEUES_BEYOND_GUARANTEED maximumKillWaitTimeForPreemptionToQueueBalance config getLong CapacitySchedulerConfiguration MAX_WAIT_BEFORE_KILL_FOR_QUEUE_BALANCE_PREEMPTION CapacitySchedulerConfiguration DEFAULT_MAX_WAIT_BEFORE_KILL_FOR_QUEUE_BALANCE_PREEMPTION isPreemptionToBalanceRequired PreemptionCandidatesSelector selector FifoCandidatesSelector selector setMaximumKillWaitTime maximumKillWaitTimeForPreemptionToQueueBalance candidatesSelectionPolicies add selector isIntraQueuePreemptionEnabled config getBoolean CapacitySchedulerConfiguration INTRAQUEUE_PREEMPTION_ENABLED CapacitySchedulerConfiguration DEFAULT_INTRAQUEUE_PREEMPTION_ENABLED isIntraQueuePreemptionEnabled candidatesSelectionPolicies add IntraQueueCandidatesSelector
partitionToLookAt cloneQueues root Resources clone nlm getResourceByLabel partitionToLookAt clusterResources partitionToLookAt leafQueueNames ImmutableSet copyOf getLeafQueueNames getQueueByPartition CapacitySchedulerConfiguration ROOT RMNodeLabelsManager NO_LABEL Resource totalPreemptionAllowed Resources multiply clusterResources percentageClusterPreemptionAllowed partitionToUnderServedQueues clear Map ApplicationAttemptId Set RMContainer toPreempt HashMap Map PreemptionCandidatesSelector Map ApplicationAttemptId Set RMContainer toPreemptPerSelector HashMap PreemptionCandidatesSelector selector startTime LOG LOG debug MessageFormat format selector getClass getName startTime clock getTime Map ApplicationAttemptId Set RMContainer curCandidates selector selectCandidates toPreempt clusterResources totalPreemptionAllowed toPreemptPerSelector putIfAbsent selector curCandidates
Map PreemptionCandidatesSelector Map ApplicationAttemptId Set RMContainer toPreemptPerSelector HashMap PreemptionCandidatesSelector selector startTime LOG LOG debug MessageFormat format selector getClass getName startTime clock getTime Map ApplicationAttemptId Set RMContainer curCandidates selector selectCandidates toPreempt clusterResources totalPreemptionAllowed toPreemptPerSelector putIfAbsent selector curCandidates LOG LOG debug MessageFormat format selector getClass getName clock getTime startTime totalSelected curSelected Set RMContainer set toPreempt totalSelected set size
q2 preemptionContext q1 q2 TempQueuePerPartition tq1 preemptionContext getQueueByPartition q1 RMNodeLabelsManager NO_LABEL TempQueuePerPartition tq2 preemptionContext getQueueByPartition q2 RMNodeLabelsManager NO_LABEL List TempQueuePerPartition path1 getPathToRoot tq1 List TempQueuePerPartition path2 getPathToRoot tq2 i path1 size j path2 size path1 get i path2 get j i j p1 path1 get i relativePriority p2 path2 get j relativePriority p1 p2 priorityDigraph put q2 q1
TempQueuePerPartition tq2 preemptionContext getQueueByPartition q2 RMNodeLabelsManager NO_LABEL List TempQueuePerPartition path1 getPathToRoot tq1 List TempQueuePerPartition path2 getPathToRoot tq2 i path1 size j path2 size path1 get i path2 get j i j p1 path1 get i relativePriority p2 path2 get j relativePriority p1 p2 priorityDigraph put q2 q1 LOG debug q2 q1 p2 p1 priorityDigraph put q1 q2
Collections sort reservedContainers CONTAINER_CREATION_TIME_COMPARATOR currentTime System currentTimeMillis RMContainer reservedContainer reservedContainers currentTime reservedContainer FiCaSchedulerNode node preemptionContext getScheduler getNode reservedContainer getReservedNode node List RMContainer newlySelectedToBePreemptContainers ArrayList String demandingQueueName reservedContainer getQueueName demandingQueueSatisfied isQueueSatisfied demandingQueueName node getPartition canPreempt demandingQueueSatisfied canPreempt canPreemptEnoughResourceForAsked reservedContainer getReservedResource demandingQueueName node newlySelectedToBePreemptContainers canPreempt
o1 o2 o1 getContainerId compareTo o2 getContainerId canAllocateReservedContainer Resource cur Resources add available node getTotalKillableResources String partition node getPartition Resources cur amPreemptionCost c String containerQueueName c getQueueName c getContainerId c
config rmContext scheduler conf config context rmContext scheduler scheduler throwOnInvariantViolation conf getBoolean InvariantsChecker THROW_ON_VIOLATION monitoringInterval conf getLong InvariantsChecker INVARIANT_MONITOR_INTERVAL
replaceNodeToAttribute nodeHost attributePrefix node getAttributes attributes node replaceAttributes attributes attributePrefix logMsg append append entry getKey append append StringUtils join entry getValue keySet append LOG debug logMsg dispatcher NodeAttribute attributePrefix dispatcher getEventHandler handle NodeAttributesStoreEvent nodeAttributeMapping op Map String Set NodeAttribute newNodeToAttributesMap HashMap String Set NodeAttribute nodeAttributeMapping k Host node nodeCollections get k newNodeToAttributesMap put k node attributes keySet
String operation String msg String format operation
QueueMapping newMapping validateAndGetAutoCreatedQueueMapping queueManager mapping newMapping IOException mapping getQueue newMappings add newMapping QueueMapping newMapping validateAndGetQueueMapping queueManager queue mapping newMappings add newMapping QueueMapping newMapping validateAndGetAutoCreatedQueueMapping queueManager mapping newMapping newMappings add newMapping newMappings add mapping newMappings mappings newMappings
ApplicationPlacementContext asc String user String queueName asc getQueue String applicationName asc getApplicationName ApplicationPlacementContext mappedQueue getAppPlacementContext user applicationName mappedQueue queueName queueName mappedQueue getQueue
scheduler IOException LOG info getClass getSimpleName CapacitySchedulerContext csContext CapacitySchedulerContext scheduler queueManager csContext getCapacitySchedulerQueueManager CapacitySchedulerConfiguration conf csContext getConfiguration overrideWithQueueMappings conf getOverrideWithQueueMappings groups groups Groups getUserToGroupsMappingService conf MappingRuleValidationContext validationContext buildValidationContext mappingRules conf getMappingRules rule mappingRules rule validate validationContext
CapacitySchedulerContext csContext CapacitySchedulerContext scheduler queueManager csContext getCapacitySchedulerQueueManager CapacitySchedulerConfiguration conf csContext getConfiguration overrideWithQueueMappings conf getOverrideWithQueueMappings groups groups Groups getUserToGroupsMappingService conf MappingRuleValidationContext validationContext buildValidationContext mappingRules conf getMappingRules rule mappingRules rule validate validationContext e LOG error rule e getMessage IOException e
asc String String appQueue asc getQueue appQueue appQueue appQueue
VariableContext variables variables createVariableContext asc user e LOG error e YarnException e rule MappingRuleResult result evaluateRule rule variables result asc variables rule asc rule result LOG asc rule YarnException LOG error result
variables String queueName validateAndNormalizeQueue variables replacePathVariables
conf createQueue getCreateFlag conf conf defaultQueueName conf getAttribute defaultQueueName
create createQueue create defaultQueueName assureRoot YarnConfiguration DEFAULT_QUEUE_NAME
PlacementRule ruleStr Class PlacementRule ruleClass Class forName ruleStr asSubclass PlacementRule
ApplicationPlacementContext getPlacementForApp asc String user YarnException Set String groupSet groupSet groupProvider getGroupsSet user ioe YarnException ioe String parentQueue PlacementRule parentRule getParentRule parentRule LOG debug parentRule getName ApplicationPlacementContext parent parentRule getPlacementForApp asc user parent getQueue parent getQueue LOG debug parentQueue parent getQueue
asc String String queueName asc getQueue queueName
mapping mapping mapping mapping LOG LOG debug user getContextForGroupParent user mapping getPrimaryGroup user mapping mapping mapping LOG LOG debug user getContextForGroupParent user mapping getSecondaryGroup user mapping LOG LOG debug user getPlacementContext mapping user mapping LOG
getContextForGroupParent user mapping getPrimaryGroup user mapping mapping mapping LOG LOG debug user getContextForGroupParent user mapping getSecondaryGroup user mapping LOG LOG debug user getPlacementContext mapping user mapping LOG LOG debug user getPlacementContext mapping getPrimaryGroup user mapping LOG
LOG LOG debug user getContextForGroupParent user mapping getSecondaryGroup user mapping LOG LOG debug user getPlacementContext mapping user mapping LOG LOG debug user getPlacementContext mapping getPrimaryGroup user mapping LOG LOG debug user getPlacementContext mapping getSecondaryGroup user
mapping LOG LOG debug user getPlacementContext mapping user mapping LOG LOG debug user getPlacementContext mapping getPrimaryGroup user mapping LOG LOG debug user getPlacementContext mapping getSecondaryGroup user LOG LOG debug user
mapping LOG LOG debug user getPlacementContext mapping getPrimaryGroup user mapping LOG LOG debug user getPlacementContext mapping getSecondaryGroup user LOG LOG debug user getPlacementContext mapping user mapping mapping LOG
getPlacementContext mapping getPrimaryGroup user mapping LOG LOG debug user getPlacementContext mapping getSecondaryGroup user LOG LOG debug user getPlacementContext mapping user mapping mapping LOG LOG debug user getPlacementContext mapping getPrimaryGroup user mapping
LOG debug user getPlacementContext mapping getSecondaryGroup user LOG LOG debug user getPlacementContext mapping user mapping mapping LOG LOG debug user getPlacementContext mapping getPrimaryGroup user mapping String secondaryGroup getSecondaryGroup user secondaryGroup LOG
getPlacementContext mapping user mapping mapping LOG LOG debug user getPlacementContext mapping getPrimaryGroup user mapping String secondaryGroup getSecondaryGroup user secondaryGroup LOG LOG debug user getPlacementContext mapping secondaryGroup LOG LOG debug user
user mapping mapping LOG LOG debug user getPlacementContext mapping getPrimaryGroup user mapping String secondaryGroup getSecondaryGroup user secondaryGroup LOG LOG debug user getPlacementContext mapping secondaryGroup LOG LOG debug user
ApplicationPlacementContext asc String user String queueName asc getQueue ApplicationId applicationId asc getApplicationId ApplicationPlacementContext mappedQueue getPlacementForUser user mappedQueue queueName queueName mappedQueue getQueue
String user String queueName String cleanUser cleanName user PlacementRule parentRule getParentRule parentRule
conf hostsFilePath conf get YarnConfiguration RM_SUBMISSION_PREPROCESSOR_FILE_PATH YarnConfiguration DEFAULT_RM_SUBMISSION_PREPROCESSOR_FILE_PATH refreshPeriod conf getInt YarnConfiguration RM_SUBMISSION_PREPROCESSOR_REFRESH_INTERVAL_MS YarnConfiguration DEFAULT_RM_SUBMISSION_PREPROCESSOR_REFRESH_INTERVAL_MS
FileInputStream fileInputStream FileInputStream hostFile BufferedReader reader Map String Map ContextProp String tempHostCommands HashMap reader BufferedReader InputStreamReader fileInputStream StandardCharsets UTF_8 String line line reader String commands line split commands commands String host commands trim host Map ContextProp String cMap commands
String line line String commands line split commands commands String host commands trim host Map ContextProp String cMap i i commands i String cSplit commands i split cSplit cSplit LOG error commands i cMap cMap HashMap
appId Path appDirPath getAppDir rmAppRoot appId mkdirsWithRetries appDirPath Path nodeCreatePath getNodePath appDirPath appId toString
appId Path appDirPath getAppDir rmAppRoot appId Path nodeCreatePath getNodePath appDirPath appId toString
appAttemptId Path appDirPath getAppDir rmAppRoot appAttemptId getApplicationId Path nodeCreatePath getNodePath appDirPath appAttemptId toString
appAttemptId Path appDirPath getAppDir rmAppRoot appAttemptId getApplicationId Path nodeCreatePath getNodePath appDirPath appAttemptId toString
appAttemptId Path appDirPath getAppDir rmAppRoot appAttemptId getApplicationId Path nodeRemovePath getNodePath appDirPath appAttemptId toString
appState ApplicationId appId appState getApplicationSubmissionContext getApplicationId Path nodeRemovePath getAppDir rmAppRoot appId
identifier Path nodeCreatePath getNodePath rmDTSecretManagerRoot DELEGATION_TOKEN_PREFIX identifier getSequenceNumber
identifier renewDate Path nodeCreatePath getNodePath rmDTSecretManagerRoot DELEGATION_TOKEN_PREFIX identifier getSequenceNumber RMDelegationTokenIdentifierData identifierData RMDelegationTokenIdentifierData identifier renewDate
masterKey Path nodeCreatePath getNodePath rmDTSecretManagerRoot DELEGATION_KEY_PREFIX masterKey getKeyId ByteArrayOutputStream os ByteArrayOutputStream os
masterKey Path nodeCreatePath getNodePath rmDTSecretManagerRoot DELEGATION_KEY_PREFIX masterKey getKeyId
planName reservationIdName Path planCreatePath getNodePath reservationRoot planName mkdirsWithRetries planCreatePath Path reservationPath getNodePath planCreatePath reservationIdName
planName reservationIdName Path planCreatePath getNodePath reservationRoot planName Path reservationPath getNodePath planCreatePath reservationIdName
Path storeRoot createStorageDir Options options Options options createIfMissing
String planReservationString key substring RM_RESERVATION_KEY_PREFIX length String parts planReservationString split SEPARATOR parts length LOG warn key String planName parts String reservationName parts ReservationAllocationStateProto allocationState ReservationAllocationStateProto parseFrom entry getValue rmState getReservationState planName rmState getReservationState put planName HashMap ReservationId ReservationAllocationStateProto ReservationId reservationId ReservationId parseReservationId reservationName rmState getReservationState get planName put reservationId allocationState numReservations e IOException e
state numKeys loadRMDTSecretManagerKeys state
state numKeys loadRMDTSecretManagerKeys state LOG info numKeys numTokens loadRMDTSecretManagerTokens state
rmState appState put appId appState String attemptNodePrefix getApplicationNodeKey appId SEPARATOR iter Entry entry iter peekNext String key asString entry getKey key attemptNodePrefix String attemptId key substring attemptNodePrefix length attemptId ApplicationAttemptStateData attemptState createAttemptState attemptId entry getValue appState attempts put attemptState getAttemptId attemptState LOG warn key iter next numAttempts appState attempts size
appId String key getApplicationNodeKey appId
attemptId String key getApplicationAttemptNodeKey attemptId
attemptId String attemptKey getApplicationAttemptNodeKey attemptId
String planName String reservationIdName String key getReservationNodeKey planName reservationIdName
String planName String reservationIdName batch String reservationKey getReservationNodeKey planName reservationIdName batch delete bytes reservationKey
tokenId renewDate String tokenKey getRMDTTokenNodeKey tokenId RMDelegationTokenIdentifierData tokenData RMDelegationTokenIdentifierData tokenId renewDate
tokenId String tokenKey getRMDTTokenNodeKey tokenId
masterKey String dbKey getRMDTMasterKeyNodeKey masterKey
masterKey String dbKey getRMDTMasterKeyNodeKey masterKey
Path root getStorageDir
removeAppId String appKey getApplicationNodeKey removeAppId
numEntries iter iter seekToFirst iter Entry entry iter next
appAttemptId ApplicationStateData appState state getApplicationState get appAttemptId getApplicationId ApplicationAttemptStateData attemptState appState attempts remove appAttemptId
RMDelegationTokenIdentifier rmDTIdentifier Long Map RMDelegationTokenIdentifier Long rmDTState state rmSecretManagerState getTokenState rmDTState rmDTIdentifier IOException e IOException rmDTIdentifier
RMDelegationTokenIdentifier rmDTIdentifier Map RMDelegationTokenIdentifier Long rmDTState state rmSecretManagerState getTokenState rmDTState remove rmDTIdentifier
rmDTIdentifier renewDate removeRMDelegationTokenState rmDTIdentifier storeOrUpdateRMDT rmDTIdentifier renewDate
DelegationKey delegationKey Set DelegationKey rmDTMasterKeyState state rmSecretManagerState getMasterKeyState rmDTMasterKeyState delegationKey IOException e IOException delegationKey getKeyId
Version loadedVersion loadVersion
writeLock lock
event writeLock lock LOG debug event getType RMStateStoreState oldState getRMStateStoreState stateMachine doTransition event getType event oldState getRMStateStoreState
isFenced
RMStateStore conf Class RMStateStore storeClass conf getClass YarnConfiguration RM_STORE MemoryRMStateStore RMStateStore
fencingNodePath getNodePath zkRootNodePath FENCING_LOCK zkSessionTimeout conf getInt YarnConfiguration RM_ZK_TIMEOUT_MS YarnConfiguration DEFAULT_RM_ZK_TIMEOUT_MS zknodeLimit conf getInt YarnConfiguration RM_ZK_ZNODE_SIZE_LIMIT_BYTES YarnConfiguration DEFAULT_RM_ZK_ZNODE_SIZE_LIMIT_BYTES appIdNodeSplitIndex conf getInt YarnConfiguration ZK_APPID_NODE_SPLIT_INDEX YarnConfiguration DEFAULT_ZK_APPID_NODE_SPLIT_INDEX appIdNodeSplitIndex appIdNodeSplitIndex LOG info appIdNodeSplitIndex YarnConfiguration ZK_APPID_NODE_SPLIT_INDEX YarnConfiguration DEFAULT_ZK_APPID_NODE_SPLIT_INDEX appIdNodeSplitIndex YarnConfiguration DEFAULT_ZK_APPID_NODE_SPLIT_INDEX zkAcl ZKCuratorManager getZKAcls conf HAUtil conf String zkRootNodeAclConf HAUtil getConfValueForRMInstance YarnConfiguration ZK_RM_STATE_STORE_ROOT_NODE_ACL conf zkRootNodeAclConf zkRootNodeAclConf ZKUtil resolveConfIndirection zkRootNodeAclConf zkRootNodeAcl ZKUtil parseACLs zkRootNodeAclConf ZKUtil
List String planNodes getChildren reservationRoot String planNodes
List String planNodes getChildren reservationRoot String planName planNodes LOG debug planName String planNodePath getNodePath reservationRoot planName List String reservationNodes getChildren planNodePath String reservationNodeName reservationNodes String reservationNodePath getNodePath planNodePath reservationNodeName
tokenRoot List String childNodes getChildren tokenRoot dtNodeFound String childNodeName childNodes childNodeName dtNodeFound String parentNodePath getNodePath tokenRoot childNodeName loadDelegationTokenFromNode rmState parentNodePath List String leafNodes getChildren parentNodePath String leafNodeName leafNodes loadDelegationTokenFromNode rmState getNodePath parentNodePath leafNodeName childNodeName childNodeName childNodeName childNodeName
appNodePath appData getData appNodePath
List String childNodes getChildren appRoot appNodeFound String childNodeName childNodes childNodeName appNodeFound loadRMAppStateFromAppNode rmState getNodePath appRoot childNodeName childNodeName String parentNodePath getNodePath appRoot childNodeName List String leafNodes getChildren parentNodePath String leafNodeName leafNodes String appIdStr childNodeName leafNodeName loadRMAppStateFromAppNode rmState getNodePath parentNodePath leafNodeName appIdStr childNodeName
appId String nodeCreatePath getLeafAppIdNodePath appId toString
ZnodeSplitInfo alternatePathInfo getAlternateAppPath appId toString alternatePathInfo nodeUpdatePath alternatePathInfo path pathExists appIdNodeSplitIndex String rootNode getSplitZnodeParent nodeUpdatePath appIdNodeSplitIndex rootNode zkManager safeCreate rootNode zkAcl CreateMode PERSISTENT zkAcl fencingNodePath LOG debug appId nodeUpdatePath appStateData appStateDataPB getProto toByteArray pathExists zkManager safeSetData nodeUpdatePath appStateData zkAcl fencingNodePath zkManager safeCreate nodeUpdatePath appStateData zkAcl CreateMode PERSISTENT zkAcl fencingNodePath
alternatePathInfo operation YarnRuntimeException appId appDirPath alternatePathInfo path String path getNodePath appDirPath appAttemptId toString attemptStateData attemptStateDataPB attemptStateDataPB getProto toByteArray LOG debug operation appAttemptId path operation path zkManager safeSetData path attemptStateData zkAcl fencingNodePath zkManager safeCreate path attemptStateData zkAcl CreateMode PERSISTENT zkAcl fencingNodePath
rmDTIdentifier String nodeCreatePath getLeafDelegationTokenNodePath rmDTIdentifier getSequenceNumber
rmDTIdentifier renewDate String nodeCreatePath getLeafDelegationTokenNodePath rmDTIdentifier getSequenceNumber LOG debug DELEGATION_TOKEN_PREFIX rmDTIdentifier getSequenceNumber RMDelegationTokenIdentifierData identifierData RMDelegationTokenIdentifierData rmDTIdentifier renewDate ByteArrayOutputStream seqOs ByteArrayOutputStream seqOut seqOs SafeTransaction trx zkManager createTransaction zkAcl fencingNodePath trx create nodeCreatePath identifierData toByteArray zkAcl CreateMode PERSISTENT seqOut writeInt rmDTIdentifier getSequenceNumber
delegationKey String nodeCreatePath getNodePath dtMasterKeysRootPath DELEGATION_KEY_PREFIX delegationKey getKeyId
delegationKey String nodeRemovePath getNodePath dtMasterKeysRootPath DELEGATION_KEY_PREFIX delegationKey getKeyId
String planName String reservationIdName String planNodePath getNodePath reservationRoot planName String reservationPath getNodePath planNodePath reservationIdName
reservationAllocation String planName String reservationIdName String planCreatePath getNodePath reservationRoot planName String reservationPath getNodePath planCreatePath reservationIdName reservationData reservationAllocation toByteArray planCreatePath
ReservationId writeLock lock ReservationId resId ReservationId newInstance ResourceManager getClusterTimeStamp resCounter incrementAndGet
Plan String planQueueName String planQueuePath getPlanQueuePath planQueueName SharingPolicy adPolicy getAdmissionPolicy planQueuePath adPolicy init planQueuePath getReservationSchedulerConfiguration Resource minAllocation getMinAllocation Resource maxAllocation getMaxAllocation ResourceCalculator rescCalc getResourceCalculator Resource totCap getPlanQueueCapacity planQueueName Plan plan InMemoryPlan getRootQueueMetrics adPolicy getAgent planQueuePath totCap planStepSize rescCalc minAllocation maxAllocation planQueueName getReplanner planQueuePath getReservationSchedulerConfiguration getMoveOnExpiry planQueuePath maxPeriodicity rmContext
getReplanner String planQueueName ReservationSchedulerConfiguration reservationConfig getReservationSchedulerConfiguration String plannerClassName reservationConfig getReplanner planQueueName
String queueName ReservationSchedulerConfiguration reservationConfig getReservationSchedulerConfiguration String agentClassName reservationConfig getReservationAgent queueName
String queueName ReservationSchedulerConfiguration reservationConfig getReservationSchedulerConfiguration String admissionPolicyClassName reservationConfig getReservationAdmissionPolicy queueName
plan String planQueueName plan getQueueName
curReservationNames remove reservationId expired add reservationId cleanupExpiredQueues planQueueName plan getMoveOnExpiry expired defReservationQueue totalAssignedCapacity currentReservations setQueueEntitlement planQueueName defReservationQueue e LOG warn planQueueName e List ReservationAllocation sortedAllocations sortByDelta ArrayList ReservationAllocation currentReservations now plan ReservationAllocation res sortedAllocations String currResId res getReservationId toString curReservationNames currResId addReservationQueue planQueueName planQueue currResId
setQueueEntitlement planQueueName defReservationQueue e LOG warn planQueueName e List ReservationAllocation sortedAllocations sortByDelta ArrayList ReservationAllocation currentReservations now plan ReservationAllocation res sortedAllocations String currResId res getReservationId toString currResId addReservationQueue planQueueName planQueue currResId Resource capToAssign res getResourcesAtTime now targetCapacity planResources planResources capToAssign calculateReservationToPlanProportion plan getResourceCalculator planResources reservedResources capToAssign targetCapacity calculateReservationToPlanRatio plan getResourceCalculator clusterResources planResources capToAssign
addReservationQueue planQueueName planQueue currResId Resource capToAssign res getResourcesAtTime now targetCapacity planResources planResources capToAssign calculateReservationToPlanProportion plan getResourceCalculator planResources reservedResources capToAssign targetCapacity calculateReservationToPlanRatio plan getResourceCalculator clusterResources planResources capToAssign LOG debug capToAssign currResId targetCapacity maxCapacity res maxCapacity targetCapacity setQueueEntitlement planQueueName currResId targetCapacity maxCapacity e LOG warn currResId planQueueName e
Queue planQueueName Queue planQueue fs getQueueManager getParentQueue planQueueName planQueue
reservation InMemoryReservationAllocation inMemReservation InMemoryReservationAllocation reservation inMemReservation String errMsg inMemReservation getReservationId
writeLock lock inMemReservation getReservationId String errMsg inMemReservation getReservationId LOG error errMsg IllegalArgumentException errMsg policy validate inMemReservation reservation setAcceptanceTimestamp clock getTime rmStateStore rmStateStore storeNewReservation ReservationSystemUtil buildStateProto inMemReservation getQueueName inMemReservation getReservationId toString ReservationInterval searchInterval ReservationInterval inMemReservation getStartTime inMemReservation getEndTime Set InMemoryReservationAllocation reservations currentReservations get searchInterval reservations reservations HashSet InMemoryReservationAllocation
IllegalArgumentException errMsg policy validate inMemReservation reservation setAcceptanceTimestamp clock getTime rmStateStore rmStateStore storeNewReservation ReservationSystemUtil buildStateProto inMemReservation getQueueName inMemReservation getReservationId toString ReservationInterval searchInterval ReservationInterval inMemReservation getStartTime inMemReservation getEndTime Set InMemoryReservationAllocation reservations currentReservations get searchInterval reservations reservations HashSet InMemoryReservationAllocation reservations inMemReservation LOG error inMemReservation getReservationId currentReservations put searchInterval reservations reservationTable put inMemReservation getReservationId inMemReservation
ReservationAllocation reservation writeLock lock result ReservationId resId reservation getReservationId ReservationAllocation currReservation getReservationById resId currReservation String errMsg resId
result ReservationId resId reservation getReservationId ReservationAllocation currReservation getReservationById resId currReservation String errMsg resId LOG error errMsg IllegalArgumentException errMsg policy validate reservation currReservation LOG error reservation getReservationId result result addReservation reservation
ReservationId resId reservation getReservationId ReservationAllocation currReservation getReservationById resId currReservation String errMsg resId LOG error errMsg IllegalArgumentException errMsg policy validate reservation currReservation LOG error reservation getReservationId result result addReservation reservation e LOG error reservation getReservationId e getMessage result
LOG error errMsg IllegalArgumentException errMsg policy validate reservation currReservation LOG error reservation getReservationId result result addReservation reservation e LOG error reservation getReservationId e getMessage result LOG info reservation getReservationId result addReservation currReservation
Set InMemoryReservationAllocation reservations currentReservations get searchInterval reservations rmStateStore rmStateStore removeReservation getQueueName reservation getReservationId toString reservations remove reservation LOG error reservation getReservationId reservations currentReservations remove searchInterval String errMsg reservation getReservationId LOG error errMsg IllegalArgumentException errMsg reservationTable remove reservation getReservationId decrementAllocation reservation
reservationID writeLock lock ReservationAllocation reservation getReservationById reservationID reservation String errMsg reservationID
createReservation reservationId user plan contract LOG info contract res planner createReservation reservationId user plan contract res
conf allocateLeft conf getBoolean FAVOR_EARLY_ALLOCATION DEFAULT_GREEDY_FAVOR_EARLY_ALLOCATION allocateLeft
createReservation reservationId user plan contract LOG info contract res planner createReservation reservationId user plan contract res
node vcores setInt getNodePrefix node VCORES vcores
node memory setInt getNodePrefix node MEMORY memory
node overCommitTimeout setInt getNodePrefix node OVERCOMMIT_TIMEOUT overCommitTimeout
resourcesFile tmp getPath ObjectMapper mapper ObjectMapper Map data mapper readValue File resourcesFile Map Iterator iterator data entrySet iterator iterator Map Entry entry Map Entry iterator next String profileName entry getKey toString profileName IOException profileName MINIMUM_PROFILE profileName MAXIMUM_PROFILE IOException String format MINIMUM_PROFILE MAXIMUM_PROFILE sourceFile entry getValue Map Map profileInfo Map entry getValue profileInfo MEMORY profileInfo VCORES IOException profileName MEMORY VCORES
Map Entry entry Map Entry iterator next String profileName entry getKey toString profileName IOException profileName MINIMUM_PROFILE profileName MAXIMUM_PROFILE IOException String format MINIMUM_PROFILE MAXIMUM_PROFILE sourceFile entry getValue Map Map profileInfo Map entry getValue profileInfo MEMORY profileInfo VCORES IOException profileName MEMORY VCORES Resource resource parseResource profileInfo profiles put profileName resource LOG info profileName resource profiles put MINIMUM_PROFILE ResourceUtils getResourceTypesMinimumAllocation profiles put MAXIMUM_PROFILE ResourceUtils getResourceTypesMaximumAllocation
event writeLock lock ApplicationId appID event getApplicationId
state ApplicationStateData appState state getApplicationState get getApplicationId recoveredFinalState appState getState recoveredFinalState
RMAppNodeUpdateType type node NodeState nodeState node getState updatedNodes put node RMAppNodeUpdateType convertToNodeUpdateType type
app AppAdminClient client AppAdminClient createAppAdminClient app applicationType app conf result client actionCleanUp app name app user result
configuration diagnosticsLimitKC configuration getInt YarnConfiguration APP_ATTEMPT_DIAGNOSTICS_LIMIT_KC YarnConfiguration DEFAULT_APP_ATTEMPT_DIAGNOSTICS_LIMIT_KC diagnosticsLimitKC String message String format DIAGNOSTIC_LIMIT_CONFIG_ERROR_MESSAGE YarnConfiguration APP_ATTEMPT_DIAGNOSTICS_LIMIT_KC diagnosticsLimitKC
event writeLock lock ApplicationAttemptId appAttemptID event getApplicationAttemptId
finalTrackingUrl sanitizeTrackingUrl unregisterEvent getFinalTrackingUrl finalStatus unregisterEvent getFinalApplicationStatus finishEvent diags append getAMContainerCrashedDiagnostics finishEvent exitStatus finishEvent getContainerStatus getExitStatus diags append diags append AggregateAppResourceUsage resUsage attemptMetrics getAggregateAppResourceUsage RMStateStore rmStore rmContext getStateStore
container ContainerId containerId container getId containerId
List ContainerStatus List ContainerStatus newlyLaunchedContainers ArrayList ContainerStatus List ContainerStatus newlyCompletedContainers ArrayList ContainerStatus List Map Entry ApplicationId ContainerStatus needUpdateContainers ArrayList Map Entry ApplicationId ContainerStatus numRemoteRunningContainers ContainerStatus remoteContainer ContainerId containerId remoteContainer getContainerId containerId
List ContainerStatus List ContainerStatus newlyLaunchedContainers ArrayList ContainerStatus List ContainerStatus newlyCompletedContainers ArrayList ContainerStatus List Map Entry ApplicationId ContainerStatus needUpdateContainers ArrayList Map Entry ApplicationId ContainerStatus numRemoteRunningContainers ContainerStatus remoteContainer ContainerId containerId remoteContainer getContainerId containerId LOG info containerId ApplicationId containerAppId containerId getApplicationAttemptId getApplicationId containerAppId LOG info containerId containerAppId
containerId readLock lock SchedulerApplicationAttempt application getCurrentAttemptForContainer containerId application
containerId SchedulerApplicationAttempt application getCurrentAttemptForContainer containerId application
appAttemptId SchedulerApplicationAttempt attempt getApplicationAttempt appAttemptId attempt
appAttemptId SchedulerApplicationAttempt attempt getApplicationAttempt appAttemptId attempt
container ApplicationId appId container getContainerId getApplicationAttemptId getApplicationId RMApp rmApp rmContext getRMApps get appId rmApp LOG error container killOrphanContainerOnNode nm container SchedulerApplication T schedulerApp applications get appId schedulerApp LOG info container rmApp getState killOrphanContainerOnNode nm container LOG info container SchedulerApplicationAttempt schedulerAttempt schedulerApp getCurrentAppAttempt rmApp
killOrphanContainerOnNode nm container Queue queue schedulerApp getQueue String queueName queue CSQueue CSQueue queue getQueuePath queue getQueueName RMContainer rmContainer recoverAndCreateContainer container nm queueName rmContainer handle RMContainerRecoverEvent container getContainerId container SchedulerNode schedulerNode nodeTracker getNode nm getNodeID schedulerNode recoverContainer rmContainer Queue queueToRecover schedulerAttempt getQueue queueToRecover recoverContainer getClusterResource schedulerAttempt rmContainer schedulerAttempt recoverContainer schedulerNode rmContainer RMAppAttempt appAttempt rmApp getCurrentAppAttempt appAttempt Container masterContainer appAttempt getMasterContainer masterContainer masterContainer rmContainer getContainerId
containerId RMContainer rmContainer getRMContainer containerId rmContainer
updateNodeResource nm resourceOption writeLock lock SchedulerNode node getSchedulerNode nm getNodeID Resource newResource resourceOption getResource timeout resourceOption getOverCommitTimeout Resource oldResource node getTotalResource oldResource newResource rmContext getNodeLabelManager updateNodeResource nm getNodeID newResource
container containerIncreasedOnNode container getId schedulerNode container c SchedulerApplication T app applications get c getKey ContainerId containerId c getValue getContainerId app app getCurrentAppAttempt RMContainer rmContainer app getCurrentAppAttempt getRMContainer containerId rmContainer rmContainer getExposedPorts rmContainer getExposedPorts String strExposedPorts c getValue getExposedPorts strExposedPorts strExposedPorts Gson gson Gson
List releasedContainers List ContainerId untrackedContainerIdList ArrayList ContainerId completedContainer ContainerId containerId completedContainer getContainerId
LOG debug nm getClusterResource SchedulerNode schedulerNode getNode nm getNodeID List ContainerStatus completedContainers updateNewContainerInfo nm schedulerNode schedulerNode schedulerNode notifyNodeUpdate Resource releasedResources Resource newInstance releasedContainers updateCompletedContainers completedContainers releasedResources nm getNodeID schedulerNode nm schedulerNode schedulerNode schedulerNode getAllocatedResource rmContext getDispatcher getEventHandler handle RMNodeResourceUpdateEvent nm getNodeID ResourceOption newInstance schedulerNode getAllocatedResource updateSchedulerHealthInformation releasedResources releasedContainers schedulerNode updateNodeResourceUtilization nm schedulerNode schedulerNode signalContainersIfOvercommitted schedulerNode LOG
eventType SchedulerEventType MARK_CONTAINER_FOR_KILLABLE schedulerNode ResourceCalculator rc getResourceCalculator Resource unallocated Resource newInstance schedulerNode getUnallocatedResource Resources rc unallocated LOG info schedulerNode getNodeID unallocated container schedulerNode LOG info eventType container getContainerId container getAllocatedResource ApplicationAttemptId appId container getApplicationAttemptId ContainerPreemptEvent event ContainerPreemptEvent appId container eventType rmContext getDispatcher getEventHandler handle event Resources addTo unallocated container getAllocatedResource
updates List UpdateContainerRequest promotionRequests updates getPromotionRequests promotionRequests promotionRequests
appAttempt updates List UpdateContainerRequest promotionRequests updates getPromotionRequests promotionRequests promotionRequests LOG info promotionRequests handleIncreaseRequests appAttempt promotionRequests List UpdateContainerRequest increaseRequests updates getIncreaseRequests increaseRequests increaseRequests LOG info increaseRequests handleIncreaseRequests appAttempt increaseRequests List UpdateContainerRequest demotionRequests updates getDemotionRequests demotionRequests demotionRequests LOG info demotionRequests handleDecreaseRequests appAttempt demotionRequests List UpdateContainerRequest decreaseRequests updates getDecreaseRequests decreaseRequests decreaseRequests
containerId RMContainer rmContainer getRMContainer containerId rmContainer
Resource Resource ret ResourceUtils getResourceTypesMinimumAllocation
Resource Resource ret ResourceUtils getResourceTypesMaximumAllocation
user ApplicationId Set ApplicationId userApps usersApplications get user userApps userApps HashSet ApplicationId usersApplications put user userApps activeUsers metrics incrActiveUsers
ConfigurationMutationACLPolicy conf Class ConfigurationMutationACLPolicy policyClass conf getClass YarnConfiguration RM_SCHEDULER_MUTATION_ACL_POLICY_CLASS DefaultConfigurationMutationACLPolicy ConfigurationMutationACLPolicy
queueName SchedulerQueue T queue queueManager getQueue queueName queue
writeLock lock
resReq String labelExp resReq getNodeLabelExpression
resReq String labelExp resReq getNodeLabelExpression LOG LOG debug labelExp
ResourceInformation requestedRI availableResource ResourceInformation availableRI availableResource getResourceInformation requestedRI getName requestedResourceValue requestedRI getValue availableResourceValue availableRI getValue unitsRelation UnitsConversionUtil compareUnits requestedRI getUnits availableRI getUnits
ResourceInformation requestedRI availableResource ResourceInformation availableRI availableResource getResourceInformation requestedRI getName requestedResourceValue requestedRI getValue availableResourceValue availableRI getValue unitsRelation UnitsConversionUtil compareUnits requestedRI getUnits availableRI getUnits LOG LOG debug requestedRI
ResourceInformation requestedRI availableResource ResourceInformation availableRI availableResource getResourceInformation requestedRI getName requestedResourceValue requestedRI getValue availableResourceValue availableRI getValue unitsRelation UnitsConversionUtil compareUnits requestedRI getUnits availableRI getUnits LOG LOG debug requestedRI LOG debug availableRI
ResourceInformation requestedRI availableResource ResourceInformation availableRI availableResource getResourceInformation requestedRI getName requestedResourceValue requestedRI getValue availableResourceValue availableRI getValue unitsRelation UnitsConversionUtil compareUnits requestedRI getUnits availableRI getUnits LOG LOG debug requestedRI LOG debug availableRI LOG debug unitsRelation unitsRelation availableResourceValue UnitsConversionUtil convert availableRI getUnits requestedRI getUnits availableRI getValue unitsRelation requestedResourceValue UnitsConversionUtil convert requestedRI getUnits availableRI getUnits requestedRI getValue LOG LOG debug requestedResourceValue
rmContext getScheduler CapacityScheduler CapacityScheduler cs CapacityScheduler rmContext getScheduler cs numNodes rmContext getRMNodes size newAppActivitiesMaxQueueLength numAsyncSchedulerThreads cs getNumAsyncSchedulerThreads numAsyncSchedulerThreads newAppActivitiesMaxQueueLength Math max configuredAppActivitiesMaxQueueLength numNodes numAsyncSchedulerThreads newAppActivitiesMaxQueueLength Math max configuredAppActivitiesMaxQueueLength numNodes appActivitiesMaxQueueLength newAppActivitiesMaxQueueLength LOG info appActivitiesMaxQueueLength newAppActivitiesMaxQueueLength configuredAppActivitiesMaxQueueLength numNodes numAsyncSchedulerThreads appActivitiesMaxQueueLength newAppActivitiesMaxQueueLength appActivitiesMaxQueueLength configuredAppActivitiesMaxQueueLength
Iterator Map Entry ApplicationId Queue AppAllocation iteApp completedAppAllocations entrySet iterator iteApp Map Entry ApplicationId Queue AppAllocation appAllocation iteApp next RMApp rmApp rmContext getRMApps get appAllocation getKey rmApp rmApp iteApp remove Iterator AppAllocation appActivitiesIt appAllocation getValue iterator appActivitiesIt appActivitiesIt next appActivitiesIt remove appAllocation getValue iteApp remove
Iterator Map Entry ApplicationId Queue AppAllocation iteApp completedAppAllocations entrySet iterator iteApp Map Entry ApplicationId Queue AppAllocation appAllocation iteApp next RMApp rmApp rmContext getRMApps get appAllocation getKey rmApp rmApp iteApp remove Iterator AppAllocation appActivitiesIt appAllocation getValue iterator appActivitiesIt appActivitiesIt next appActivitiesIt remove appAllocation getValue iteApp remove
String queuePath Resource CapacitySchedulerConfiguration conf csContext getConfiguration Set String configuredNodelabels conf getConfiguredNodeLabels queuePath String label configuredNodelabels Resource minResource getMinimumAbsoluteResource queuePath label Resource maxResource getMaximumAbsoluteResource queuePath label LOG debug capacityConfigType getQueuePath CapacityConfigType localType checkConfigTypeIsAbsoluteResource queuePath label CapacityConfigType ABSOLUTE_RESOURCE CapacityConfigType PERCENTAGE capacityConfigType CapacityConfigType capacityConfigType localType
Resource currentLimitResource getCurrentLimitResource nodePartition clusterResource currentResourceLimits schedulingMode Resource nowTotalUsed queueUsage getUsed nodePartition Resource usedExceptKillable nowTotalUsed usedExceptKillable Resources subtract nowTotalUsed getTotalKillableResource nodePartition currentResourceLimits setHeadroom Resources subtract currentLimitResource usedExceptKillable Resources clusterResource usedExceptKillable currentLimitResource Resources clusterResource resourceCouldBeUnreserved Resources Resource newTotalWithoutReservedResource Resources subtract usedExceptKillable resourceCouldBeUnreserved Resources clusterResource newTotalWithoutReservedResource currentLimitResource LOG LOG debug getQueuePath queueUsage getUsed clusterResource resourceCouldBeUnreserved newTotalWithoutReservedResource currentLimitResource LOG
Resource usedExceptKillable nowTotalUsed usedExceptKillable Resources subtract nowTotalUsed getTotalKillableResource nodePartition currentResourceLimits setHeadroom Resources subtract currentLimitResource usedExceptKillable Resources clusterResource usedExceptKillable currentLimitResource Resources clusterResource resourceCouldBeUnreserved Resources Resource newTotalWithoutReservedResource Resources subtract usedExceptKillable resourceCouldBeUnreserved Resources clusterResource newTotalWithoutReservedResource currentLimitResource LOG LOG debug getQueuePath queueUsage getUsed clusterResource resourceCouldBeUnreserved newTotalWithoutReservedResource currentLimitResource LOG LOG debug getQueuePath nodePartition queueUsage getUsed nodePartition clusterResource resourceCouldBeUnreserved currentLimitResource usedExceptKillable LOG
ContainerAllocationProposal FiCaSchedulerApp FiCaSchedulerNode allocation request getFirstAllocatedOrReservedContainer SchedulerContainer FiCaSchedulerApp FiCaSchedulerNode schedulerContainer allocation getAllocatedOrReservedContainer allocation Resource required allocation getAllocatedOrReservedResource Resource netAllocated Resources subtract required request getTotalReleasedResource readLock lock String partition schedulerContainer getNodePartition Resource maxResourceLimit allocation maxResourceLimit getQueueMaxResource partition maxResourceLimit labelManager getResourceByLabel schedulerContainer getNodePartition cluster Resources Resources partition netAllocated maxResourceLimit
FiCaSchedulerApp next iter next next prev next LeafQueue nextQueue next getCSLeafQueue LOG info next getApplicationAttemptId nextQueue trackRunnableApp next FiCaSchedulerApp appSched next nextQueue submitApplicationAttempt next next getUser noLongerPendingApps add appSched noLongerPendingApps prev next FiCaSchedulerApp appSched noLongerPendingApps appSched getCSLeafQueue appSched
next LeafQueue nextQueue next getCSLeafQueue LOG info next getApplicationAttemptId nextQueue trackRunnableApp next FiCaSchedulerApp appSched next nextQueue submitApplicationAttempt next next getUser noLongerPendingApps add appSched noLongerPendingApps prev next FiCaSchedulerApp appSched noLongerPendingApps appSched getCSLeafQueue appSched LOG error appSched getApplicationAttemptId appSched getUser appSched
scheduleAsynchronously conf getScheduleAynschronously asyncScheduleInterval conf getLong ASYNC_SCHEDULER_INTERVAL DEFAULT_ASYNC_SCHEDULER_INTERVAL assignMultipleEnabled conf getAssignMultipleEnabled maxAssignPerHeartbeat conf getMaxAssignPerHeartbeat maxAsyncSchedulingThreads conf getInt CapacitySchedulerConfiguration SCHEDULE_ASYNCHRONOUSLY_MAXIMUM_THREAD maxAsyncSchedulingThreads Math max maxAsyncSchedulingThreads scheduleAsynchronously asyncSchedulerThreads ArrayList maxAsyncSchedulingThreads asyncSchedulerThreads add AsyncScheduleThread resourceCommitterService ResourceCommitterService asyncMaxPendingBacklogs conf getInt CapacitySchedulerConfiguration SCHEDULE_ASYNCHRONOUSLY_MAXIMUM_PENDING_BACKLOGS CapacitySchedulerConfiguration DEFAULT_SCHEDULE_ASYNCHRONOUSLY_MAXIMUM_PENDING_BACKLOGS offswitchPerHeartbeatLimit conf getOffSwitchPerHeartbeatLimit multiNodePlacementEnabled conf getMultiNodePlacementEnabled
CSQueue queue getOrCreateQueueFromPlacementContext applicationId user queueName placementContext queue rmContext getDispatcher getEventHandler handle RMAppEvent applicationId RMAppEventType KILL queueName String queueErrorMsg queueName LOG error FATAL queueErrorMsg QueueInvalidException queueErrorMsg queue rmContext getDispatcher getEventHandler handle RMAppEvent applicationId RMAppEventType KILL queueName String queueErrorMsg queueName
queue LeafQueue rmContext getDispatcher getEventHandler handle RMAppEvent applicationId RMAppEventType KILL queueName String queueErrorMsg queueName LOG error FATAL queueErrorMsg QueueInvalidException queueErrorMsg queue LeafQueue queue recoverDrainingState queue submitApplication applicationId user queueName queue getMetrics submitApp user SchedulerApplication FiCaSchedulerApp application SchedulerApplication FiCaSchedulerApp queue user priority
queue LeafQueue rmContext getDispatcher getEventHandler handle RMAppEvent applicationId RMAppEventType KILL queueName String queueErrorMsg queueName LOG error FATAL queueErrorMsg QueueInvalidException queueErrorMsg queue LeafQueue queue recoverDrainingState queue submitApplication applicationId user queueName queue getMetrics submitApp user SchedulerApplication FiCaSchedulerApp application SchedulerApplication FiCaSchedulerApp queue user priority
CSQueue queue getQueue queueName queue placementContext placementContext autoCreateLeafQueue placementContext e LOG error queueName e rmContext getDispatcher getEventHandler handle RMAppEvent applicationId RMAppEventType KILL queueName String queueErrorMsg queueName LOG error FATAL queueErrorMsg e QueueInvalidException queueErrorMsg
queue queue getParent placementContext String message applicationId user queueName QUEUE_MAPPING rmContext getDispatcher getEventHandler handle RMAppEvent applicationId RMAppEventType APP_REJECTED message queue getParent getQueueShortName placementContext getParentQueue queue getParent placementContext getParentQueue String message placementContext getQueue queue getParent getQueueShortName CapacitySchedulerConfiguration QUEUE_MAPPING placementContext getParentQueue user rmContext getDispatcher getEventHandler handle RMAppEvent applicationId RMAppEventType APP_REJECTED message priority workflowPriorityMappingsMgr mapWorkflowPriorityForApp applicationId queue user priority e String message applicationId user e getMessage rmContext getDispatcher getEventHandler handle RMAppEvent applicationId RMAppEventType APP_REJECTED message
queue getParent getQueueShortName placementContext getParentQueue queue getParent placementContext getParentQueue String message placementContext getQueue queue getParent getQueueShortName CapacitySchedulerConfiguration QUEUE_MAPPING placementContext getParentQueue user rmContext getDispatcher getEventHandler handle RMAppEvent applicationId RMAppEventType APP_REJECTED message priority workflowPriorityMappingsMgr mapWorkflowPriorityForApp applicationId queue user priority e String message applicationId user e getMessage rmContext getDispatcher getEventHandler handle RMAppEvent applicationId RMAppEventType APP_REJECTED message queue submitApplication applicationId user queueName ace LOG info applicationId queueName user ace
writeLock lock SchedulerApplication FiCaSchedulerApp application applications get applicationAttemptId getApplicationId application LOG warn applicationAttemptId getApplicationId CSQueue queue CSQueue application getQueue FiCaSchedulerApp attempt FiCaSchedulerApp applicationAttemptId application getUser queue queue getAbstractUsersManager rmContext application getPriority isAttemptRecovering activitiesManager transferStateFromPreviousAttempt attempt transferStateFromPreviousAttempt application getCurrentAppAttempt application setCurrentAppAttempt attempt attempt setPriority application getPriority maxRunningEnforcer checkRunnabilityWithUpdate attempt maxRunningEnforcer trackApp attempt queue submitApplicationAttempt attempt application getUser
SchedulerApplication FiCaSchedulerApp application applications get applicationAttemptId getApplicationId application LOG warn applicationAttemptId getApplicationId CSQueue queue CSQueue application getQueue FiCaSchedulerApp attempt FiCaSchedulerApp applicationAttemptId application getUser queue queue getAbstractUsersManager rmContext application getPriority isAttemptRecovering activitiesManager transferStateFromPreviousAttempt attempt transferStateFromPreviousAttempt application getCurrentAppAttempt application setCurrentAppAttempt attempt attempt setPriority application getPriority maxRunningEnforcer checkRunnabilityWithUpdate attempt maxRunningEnforcer trackApp attempt queue submitApplicationAttempt attempt application getUser LOG info applicationAttemptId application getUser queue getQueuePath isAttemptRecovering
writeLock lock
applicationAttemptId rmAppAttemptFinalState writeLock lock LOG info applicationAttemptId rmAppAttemptFinalState FiCaSchedulerApp attempt getApplicationAttempt applicationAttemptId SchedulerApplication FiCaSchedulerApp application applications get applicationAttemptId getApplicationId application attempt
SchedulerApplication FiCaSchedulerApp application applications get applicationAttemptId getApplicationId application attempt LOG info applicationAttemptId rmContainer attempt rmContainer LOG info rmContainer getContainerId completedContainer rmContainer SchedulerUtils createAbnormalContainerStatus rmContainer getContainerId SchedulerUtils COMPLETED_APPLICATION RMContainerEventType KILL rmContainer attempt completedContainer rmContainer SchedulerUtils createAbnormalContainerStatus rmContainer getContainerId RMContainerEventType KILL attempt stop rmAppAttemptFinalState Queue queue attempt getQueue CSQueue csQueue CSQueue queue csQueue
applicationAttemptId FiCaSchedulerApp application getApplicationAttempt applicationAttemptId application
application applicationAttemptId LOG error applicationAttemptId EMPTY_ALLOCATION handleContainerUpdates application updateRequests releaseContainers release application LeafQueue updateDemandForQueue normalizeResourceRequests ask normalizeSchedulingRequests schedulingRequests Allocation allocation application getWriteLock lock application EMPTY_ALLOCATION ask schedulingRequests schedulingRequests LOG
EMPTY_ALLOCATION ask LOG LOG debug applicationAttemptId ask size application showRequests application ask application updateDemandForQueue LeafQueue application getQueue LOG LOG debug application showRequests application updateBlacklist blacklistAdditions blacklistRemovals allocation application getAllocation getResourceCalculator getClusterResource getMinimumResourceCapability application getWriteLock unlock updateDemandForQueue application
assignedContainers CandidateNodeSet FiCaSchedulerNode candidates getCandidateNodeSet node CSAssignment assignment allocateContainersToNode candidates withNodeHeartbeat assignment withNodeHeartbeat assignment offswitchCount assignment assignedContainers assignment offswitchCount assignedContainers assignment allocateContainersToNode candidates assignment assignment offswitchCount assignment assignment assignedContainers offswitchCount
node LOG debug node getNodeName node getUnallocatedResource node node
reservedContainer FiCaSchedulerApp reservedApplication getCurrentAttemptForContainer reservedContainer getContainerId reservedApplication
rmContainer Container container rmContainer getContainer ContainerId containerId container getId FiCaSchedulerApp application getCurrentAttemptForContainer container getId ApplicationId appId containerId getApplicationAttemptId getApplicationId application
writeLock lock
writeLock lock
queueName CSQueue queue getQueue queueName queue
writeLock lock
e YarnException e FiCaSchedulerApp app application getCurrentAppAttempt app rmContainer app source detachContainer getClusterResource app rmContainer dest attachContainer getClusterResource app rmContainer rmContainer app source detachContainer getClusterResource app rmContainer dest attachContainer getClusterResource app rmContainer app source finishApplicationAttempt app sourceQueueName dest submitApplicationAttempt app user app move dest source appFinished
SchedulerApplication FiCaSchedulerApp application applications get applicationId application YarnException applicationId RMApp rmApp rmContext getRMApps get applicationId appPriority checkAndGetApplicationPriority newPriority user rmApp getQueue applicationId application appPriority future set appPriority rmApp getApplicationSubmissionContext setPriority appPriority ApplicationStateData appState ApplicationStateData newInstance rmApp getSubmitTime rmApp getStartTime rmApp getApplicationSubmissionContext rmApp getUser rmApp getCallerContext appState setApplicationTimeouts rmApp getApplicationTimeouts appState setLaunchTime rmApp getLaunchTime rmContext getStateStore updateApplicationStateSynchronously appState future LeafQueue queue LeafQueue getQueue rmApp getQueue queue updateApplicationPriority application appPriority
attemptId request getContainersToRelease get getSchedulerApplicationAttempt getApplicationAttemptId LOG debug request isSuccess attemptId FiCaSchedulerApp app getApplicationAttempt attemptId app attemptId app getApplicationAttemptId app request app request commitSuccess System nanoTime commitStart CapacitySchedulerMetrics getMetrics addCommitSuccess commitSuccess LOG info isSuccess commitFailed System nanoTime commitStart CapacitySchedulerMetrics getMetrics addCommitFailure commitFailed LOG info
writeLock lock
toBeMovedContainer FiCaSchedulerNode targetNode writeLock lock LOG debug toBeMovedContainer targetNode getNodeID FiCaSchedulerNode sourceNode getNode toBeMovedContainer getNodeId sourceNode
writeLock lock LOG debug toBeMovedContainer targetNode getNodeID FiCaSchedulerNode sourceNode getNode toBeMovedContainer getNodeId sourceNode LOG debug toBeMovedContainer getNodeId getNode targetNode getNodeID targetNode LOG debug targetNode LOG debug FiCaSchedulerApp app getApplicationAttempt toBeMovedContainer getApplicationAttemptId app
queueName CSQueue queue getQueue queueName queue queue queueName
newQueues newConf CSQueue oldQueue oldQueue String queuePath oldQueue getQueuePath CSQueue newQueue newQueues get queuePath String configPrefix newConf getQueuePrefix oldQueue getQueuePath String state newConf get configPrefix QueueState newQueueState state newQueueState QueueState valueOf state LOG warn oldQueue getQueuePath newQueue oldQueue QueueState newQueueState QueueState
LOG warn oldQueue getQueuePath newQueue oldQueue getState LOG info queuePath IOException oldQueue getQueuePath oldQueue getState oldQueue getQueuePath newQueue getQueuePath IOException queuePath oldQueue getQueuePath newQueue getQueuePath oldQueue oldQueue newQueue IOException oldQueue getQueuePath oldQueue newQueue IOException oldQueue getQueuePath CapacitySchedulerConfiguration AUTO_CREATE_CHILD_QUEUE_ENABLED oldQueue newQueue oldQueue getState
newQueue oldQueue getState LOG info queuePath IOException oldQueue getQueuePath oldQueue getState oldQueue getQueuePath newQueue getQueuePath IOException queuePath oldQueue getQueuePath newQueue getQueuePath oldQueue oldQueue newQueue IOException oldQueue getQueuePath oldQueue newQueue IOException oldQueue getQueuePath CapacitySchedulerConfiguration AUTO_CREATE_CHILD_QUEUE_ENABLED oldQueue newQueue oldQueue getState LOG info oldQueue getQueuePath
queue userLimit setInt getQueuePrefix queue USER_LIMIT userLimit
queue subQueues set getQueuePrefix queue QUEUES StringUtils arrayToString subQueues
queue isReservable setBoolean getQueuePrefix queue IS_RESERVABLE isReservable
String queueName String queueManagementPolicyClassName getAutoCreatedQueueManagementPolicy queueName
Resources none Resource resource Resource newInstance Matcher matcher RESOURCE_PATTERN matcher resourceString matcher String subGroup matcher group subGroup Resources none subGroup subGroup substring subGroup length String kvPair subGroup split String splits kvPair split splits splits length updateResourceValuesFromConfig resourceTypes resource splits resource Resources none
CapacitySchedulerConfiguration conf root parseQueue csContext conf CapacitySchedulerConfiguration ROOT queues queues NOOP setQueueAcls authorizer appPriorityACLManager queues labelManager reinitializeQueueLabels getQueueToLabels queueStateManager initialize
queue ManagedParentQueue csContext queueName parent oldQueues get fullQueueName queue LeafQueue csContext queueName parent oldQueues get fullQueueName queue hook hook queue IllegalStateException fullQueueName ParentQueue parentQueue parentQueue ManagedParentQueue csContext queueName parent oldQueues get fullQueueName parentQueue ParentQueue csContext queueName parent oldQueues get fullQueueName queue hook hook parentQueue List CSQueue childQueues ArrayList
nodeLocalityDelay schedConf getNodeLocalityDelay rackLocalityAdditionalDelay schedConf getRackLocalityAdditionalDelay rackLocalityFullReset schedConf getRackLocalityFullReset minimumAllocationFactor Resources ratio resourceCalculator Resources subtract maximumAllocation minimumAllocation maximumAllocation StringBuilder aclsString StringBuilder e aclsString append e getKey e getValue getAclString StringBuilder labelStrBuilder StringBuilder s labelStrBuilder append s append defaultAppPriorityPerQueue Priority newInstance conf getDefaultApplicationPriorityConfPerQueue getQueuePath queueUL Math min conf getUserLimit getQueuePath e val e getValue floatValue
applicationId String String writeLock lock String msg getQueuePath applicationId
AccessControlException msg getNumApplications String msg getQueuePath getNumApplications applicationId LOG info msg AccessControlException msg User user usersManager getUserAndAddIfAbsent userName user getTotalApplications String msg getQueuePath user getTotalApplications userName applicationId LOG info msg AccessControlException msg writeLock unlock getParent validateSubmitApplication applicationId userName queue AccessControlException
Resource nodePartition userName userWeight userName getUser userName userWeight getUser userName getWeight readLock lock effectiveUserLimit Math max usersManager getUserLimit Math max getAbstractUsersManager getNumActiveUsers preWeightedUserLimit effectiveUserLimit effectiveUserLimit Math min effectiveUserLimit userWeight Resource queuePartitionResource getEffectiveCapacity nodePartition Resource userAMLimit Resources multiplyAndNormalizeUp resourceCalculator queuePartitionResource queueCapacities getMaxAMResourcePercentage nodePartition effectiveUserLimit usersManager getUserLimitFactor minimumAllocation userAMLimit Resources min resourceCalculator lastClusterResource userAMLimit Resources clone getAMResourceLimitPerPartition nodePartition Resource preWeighteduserAMLimit Resources multiplyAndNormalizeUp resourceCalculator queuePartitionResource queueCapacities getMaxAMResourcePercentage nodePartition preWeightedUserLimit usersManager getUserLimitFactor minimumAllocation preWeighteduserAMLimit Resources min resourceCalculator lastClusterResource preWeighteduserAMLimit Resources clone getAMResourceLimitPerPartition nodePartition queueUsage setUserAMLimit nodePartition preWeighteduserAMLimit
writeLock lock Map String Resource userAmPartitionLimit HashMap String Resource String nodePartition calculateAndGetAMResourceLimitPerPartition nodePartition FiCaSchedulerApp fsApp fsApp FiCaSchedulerApp application fsApp next ApplicationId applicationId application getApplicationId String partitionName application getAppAMNodePartitionName Resource amLimit getAMResourceLimitPerPartition partitionName amLimit amLimit calculateAndGetAMResourceLimitPerPartition partitionName Resource amIfStarted Resources add application getAMResource partitionName queueUsage getAMUsed partitionName
FiCaSchedulerApp fsApp fsApp FiCaSchedulerApp application fsApp next ApplicationId applicationId application getApplicationId String partitionName application getAppAMNodePartitionName Resource amLimit getAMResourceLimitPerPartition partitionName amLimit amLimit calculateAndGetAMResourceLimitPerPartition partitionName Resource amIfStarted Resources add application getAMResource partitionName queueUsage getAMUsed partitionName LOG LOG debug application getId application getAMResource partitionName maxAMResourcePerQueuePercent amLimit lastClusterResource amIfStarted partitionName amIfStarted amLimit Resources lastClusterResource queueUsage getAMUsed partitionName Resources LOG warn application updateAMContainerDiagnostics AMState INACTIVATED CSAMContainerLaunchDiagnosticsConstants QUEUE_AM_RESOURCE_LIMIT_EXCEED
amIfStarted amLimit Resources partitionName Resources LOG warn application updateAMContainerDiagnostics AMState INACTIVATED CSAMContainerLaunchDiagnosticsConstants QUEUE_AM_RESOURCE_LIMIT_EXCEED LOG debug applicationId amIfStarted amLimit User user getUser application getUser Resource userAMLimit userAmPartitionLimit get partitionName userAMLimit userAMLimit getUserAMResourceLimitPerPartition partitionName application getUser userAmPartitionLimit put partitionName userAMLimit Resource userAmIfStarted Resources add application getAMResource partitionName user getConsumedAMResources partitionName userAmIfStarted userAMLimit Resources partitionName Resources
Resource userAMLimit userAmPartitionLimit get partitionName userAMLimit userAMLimit getUserAMResourceLimitPerPartition partitionName application getUser userAmPartitionLimit put partitionName userAMLimit Resource userAmIfStarted Resources add application getAMResource partitionName user getConsumedAMResources partitionName userAmIfStarted userAMLimit Resources partitionName Resources LOG warn application updateAMContainerDiagnostics AMState INACTIVATED CSAMContainerLaunchDiagnosticsConstants USER_AM_RESOURCE_LIMIT_EXCEED LOG debug applicationId user userAmIfStarted userAMLimit user activateApplication orderingPolicy addSchedulableEntity application application updateAMContainerDiagnostics AMState ACTIVATED
application writeLock lock applicationAttemptMap put application getApplicationAttemptId application application runnableApps add application
applicationAttemptMap put application getApplicationAttemptId application application runnableApps add application LOG debug application getApplicationAttemptId nonRunnableApps add application LOG info application getApplicationAttemptId user submitApplication getPendingAppsOrderingPolicy addSchedulableEntity application activateApplications application updateAMContainerDiagnostics AMState INACTIVATED CSAMContainerLaunchDiagnosticsConstants CLUSTER_RESOURCE_EMPTY
application userName writeLock lock User user usersManager getUserAndAddIfAbsent userName runnable runnableApps remove application runnable application
application LOG error application getQueuePath String partitionName application getAppAMNodePartitionName wasActive orderingPolicy removeSchedulableEntity application wasActive pendingOrderingPolicy removeSchedulableEntity application queueUsage decAMUsed partitionName application getAMResource partitionName user getResourceUsage decAMUsed partitionName application getAMResource partitionName metrics decAMUsed partitionName application getUser application getAMResource partitionName applicationAttemptMap remove application getApplicationAttemptId user finishApplication wasActive user usersManager removeUser application getUser activateApplications
clusterResource FiCaSchedulerNode candidates currentResourceLimits updateCurrentResourceLimits currentResourceLimits clusterResource FiCaSchedulerNode node CandidateNodeSetUtils getSingleNode candidates
CachedUserLimit cul userLimits get application getUser Resource cachedUserLimit cul cachedUserLimit cul userLimit Resource userLimit computeUserLimitAndSetHeadroom application clusterResource candidates getPartition schedulingMode cachedUserLimit cul cul CachedUserLimit userLimit userLimits put application getUser cul userAssignable cul canAssign cul userAssignable userAssignable canAssignToUser clusterResource application getUser userLimit application candidates getPartition currentResourceLimits userAssignable cul cul canAssign
Resource cluster FiCaSchedulerApp FiCaSchedulerNode request ContainerAllocationProposal FiCaSchedulerApp FiCaSchedulerNode allocation request getFirstAllocatedOrReservedContainer SchedulerContainer FiCaSchedulerApp FiCaSchedulerNode schedulerContainer allocation getAllocatedOrReservedContainer allocation readLock lock FiCaSchedulerApp app schedulerContainer getSchedulerApplicationAttempt String username app getUser String p schedulerContainer getNodePartition Resource userLimit computeUserLimitAndSetHeadroom app cluster p allocation getSchedulingMode User user getUser username user
SchedulerContainer FiCaSchedulerApp FiCaSchedulerNode schedulerContainer allocation getAllocatedOrReservedContainer allocation readLock lock FiCaSchedulerApp app schedulerContainer getSchedulerApplicationAttempt String username app getUser String p schedulerContainer getNodePartition Resource userLimit computeUserLimitAndSetHeadroom app cluster p allocation getSchedulingMode User user getUser username user LOG debug username Resource usedResource Resources clone user getUsed p Resources subtractFrom usedResource request getTotalReleasedResource Resources cluster usedResource userLimit
application String String user application getUser User queueUser getUser user queueUser
userName readLock lock User user getUser userName user
User user getUser userName user LOG debug userName currentResourceLimits setAmountNeededUnreserve Resources none Resources user getUsed nodePartition limit Resources Resources subtract user getUsed application getCurrentReservation limit LOG LOG debug userName getQueuePath user getUsed application getCurrentReservation limit Resource amountNeededToUnreserve Resources subtract user getUsed nodePartition limit currentResourceLimits setAmountNeededUnreserve amountNeededToUnreserve LOG
allocateResource clusterResource resource nodePartition rmContainer rmContainer nodePartition TreeSet RMContainer rmContainers rmContainers ignorePartitionExclusivityRMContainers nodePartition rmContainers TreeSet ignorePartitionExclusivityRMContainers put nodePartition rmContainers rmContainers add rmContainer String userName application getUser User user usersManager updateUserResourceUsage userName resource nodePartition Resource partitionHeadroom Resources createResource metrics userName partitionHeadroom getHeadroom user cachedResourceLimitsForHeadroom getLimit clusterResource getResourceLimitForActiveUsers userName clusterResource nodePartition SchedulingMode RESPECT_PARTITION_EXCLUSIVITY nodePartition metrics setAvailableResourcesToUser nodePartition userName partitionHeadroom
releaseResource clusterResource resource nodePartition rmContainer rmContainer nodePartition ignorePartitionExclusivityRMContainers nodePartition Set RMContainer rmContainers ignorePartitionExclusivityRMContainers get nodePartition rmContainers remove rmContainer rmContainers ignorePartitionExclusivityRMContainers remove nodePartition String userName application getUser User user usersManager updateUserResourceUsage userName resource nodePartition Resource partitionHeadroom Resources createResource metrics userName partitionHeadroom getHeadroom user cachedResourceLimitsForHeadroom getLimit clusterResource getResourceLimitForActiveUsers userName clusterResource nodePartition SchedulingMode RESPECT_PARTITION_EXCLUSIVITY nodePartition metrics setAvailableResourcesToUser nodePartition userName partitionHeadroom
clusterResource application rmContainer application rmContainer rmContainer FiCaSchedulerNode node scheduler getNode rmContainer getContainer getNodeId allocateResource clusterResource application rmContainer getContainer getResource node getPartition rmContainer
clusterResource application rmContainer application rmContainer rmContainer FiCaSchedulerNode node scheduler getNode rmContainer getContainer getNodeId releaseResource clusterResource application rmContainer getContainer getResource node getPartition rmContainer
validate newlyParsedQueue shouldFailAutoCreationWhenGuaranteedCapacityExceeded csContext getConfiguration getShouldFailAutoQueueCreationWhenGuaranteedCapacityExceeded getQueuePath shouldFailAutoCreationWhenGuaranteedCapacityExceeded childCap sumOfChildCapacities getCapacity childCap IOException childCap getQueuePath getCapacity leafQueueTemplate initializeLeafQueueConfigs build reinitialize newlyParsedQueue clusterResource res res reinitialize res clusterResource reinitializeQueueManagementPolicy List QueueManagementChange queueManagementChanges queueManagementPolicy computeQueueManagementChanges validateAndApplyQueueManagementChanges queueManagementChanges LOG info queueName getCapacity getMaximumCapacity
ParentQueue newlyParsedParentQueue ParentQueue newlyParsedQueue setupQueueConfigs clusterResource Map String CSQueue currentChildQueues getQueuesMap childQueues Map String CSQueue newChildQueues getQueuesMap newlyParsedParentQueue childQueues Map String CSQueue e newChildQueues String newChildQueueName e getKey CSQueue newChildQueue e getValue CSQueue childQueue currentChildQueues get newChildQueueName childQueue childQueue newChildQueue ParentQueue childQueue ParentQueue newChildQueue newChildQueue setParent currentChildQueues put newChildQueueName newChildQueue CapacitySchedulerQueueManager queueManager csContext getCapacitySchedulerQueueManager queueManager addQueue newChildQueueName newChildQueue
String CSQueue e String newChildQueueName e getKey CSQueue newChildQueue e getValue CSQueue childQueue currentChildQueues get newChildQueueName childQueue childQueue newChildQueue childQueue newChildQueue newChildQueue setParent currentChildQueues put newChildQueueName newChildQueue CapacitySchedulerQueueManager queueManager csContext getCapacitySchedulerQueueManager queueManager addQueue newChildQueueName newChildQueue childQueue reinitialize newChildQueue clusterResource LOG info getQueuePath childQueue newChildQueue setParent
writeLock lock numApplications
writeLock lock numApplications
FiCaSchedulerNode candidates FiCaSchedulerNode node CandidateNodeSetUtils getSingleNode candidates candidates now System currentTimeMillis now
FiCaSchedulerNode node CandidateNodeSetUtils getSingleNode candidates candidates getPartition LOG now System currentTimeMillis now lastSkipQueueDebugLoggingTimestamp LOG debug getQueuePath candidates getPartition lastSkipQueueDebugLoggingTimestamp now ActivitiesLogger QUEUE recordQueueActivity activitiesManager node getParentName getQueuePath ActivityState REJECTED ActivityDiagnosticConstant QUEUE_NOT_ABLE_TO_ACCESS_PARTITION ActivitiesLogger NODE finishSkippedNodeAllocation activitiesManager node CSAssignment NULL_ASSIGNMENT candidates getPartition LOG now System currentTimeMillis now lastSkipQueueDebugLoggingTimestamp
ActivitiesLogger NODE finishSkippedNodeAllocation activitiesManager node CSAssignment assignedToChild assignContainersToChildQueues clusterResource candidates resourceLimits schedulingMode assignment setType assignedToChild getType assignment setRequestLocalityType assignedToChild getRequestLocalityType assignment setExcessReservation assignedToChild getExcessReservation assignment setContainersToKill assignedToChild getContainersToKill assignment setFulfilledReservation assignedToChild isFulfilledReservation assignment setFulfilledReservedContainer assignedToChild getFulfilledReservedContainer Resources clusterResource assignedToChild getResource Resources ActivitiesLogger QUEUE recordQueueActivity activitiesManager node getParentName getQueuePath ActivityState ACCEPTED ActivityDiagnosticConstant EMPTY isReserved assignedToChild getAssignmentInformation getReservationDetails assignedToChild getAssignmentInformation getReservationDetails isEmpty ActivitiesLogger NODE finishAllocatedNodeAllocation activitiesManager node assignedToChild getAssignmentInformation getFirstAllocatedOrReservedContainerId isReserved AllocationState RESERVED AllocationState ALLOCATED Resources addTo assignment getResource assignedToChild getResource
CSAssignment assignedToChild assignContainersToChildQueues clusterResource candidates resourceLimits schedulingMode assignment setType assignedToChild getType assignment setRequestLocalityType assignedToChild getRequestLocalityType assignment setExcessReservation assignedToChild getExcessReservation assignment setContainersToKill assignedToChild getContainersToKill assignment setFulfilledReservation assignedToChild isFulfilledReservation assignment setFulfilledReservedContainer assignedToChild getFulfilledReservedContainer Resources clusterResource assignedToChild getResource Resources ActivitiesLogger QUEUE recordQueueActivity activitiesManager node getParentName getQueuePath ActivityState ACCEPTED ActivityDiagnosticConstant EMPTY isReserved assignedToChild getAssignmentInformation getReservationDetails assignedToChild getAssignmentInformation getReservationDetails isEmpty ActivitiesLogger NODE finishAllocatedNodeAllocation activitiesManager node assignedToChild getAssignmentInformation getFirstAllocatedOrReservedContainerId isReserved AllocationState RESERVED AllocationState ALLOCATED Resources addTo assignment getResource assignedToChild getResource Resources addTo assignment getAssignmentInformation getAllocated assignedToChild getAssignmentInformation getAllocated
CSAssignment CSAssignment assignment CSAssignment NULL_ASSIGNMENT printChildQueues CSQueue iter iter CSQueue childQueue iter next
LOG debug childQueue getQueuePath childQueue childAssignment getResource childAssignment getType Resources resourceCalculator cluster childAssignment getResource Resources none assignment childAssignment childAssignment assignment assignment childAssignment Resource blockedHeadroom childQueue blockedHeadroom childLimits getHeadroom blockedHeadroom childLimits getBlockedHeadroom Resource resourceToSubtract Resources max resourceCalculator cluster blockedHeadroom Resources none limits addBlockedHeadroom resourceToSubtract LOG
clusterResource node releasedResource writeLock lock releaseResource clusterResource releasedResource node getPartition
Resources rc clusterResource queueResourceQuotas getEffectiveMinResource label configuredMinResources numeratorForMinRatio queueResourceQuotas getEffectiveMinResource label Map String Float effectiveMinRatioPerResource getEffectiveMinRatioPerResource configuredMinResources numeratorForMinRatio childQueue Resource minResource childQueue getQueueResourceQuotas getConfiguredMinResource label childQueue equals childQueue getQueueResourceQuotas setEffectiveMinResource label getMinResourceNormalized childQueue getQueuePath effectiveMinRatioPerResource minResource Resource parentMaxRes queueResourceQuotas getConfiguredMaxResource label parent parentMaxRes equals Resources none parentMaxRes parent getQueueResourceQuotas getEffectiveMaxResource label Resource childMaxResource childQueue getQueueResourceQuotas getConfiguredMaxResource label Resource effMaxResource Resources min resourceCalculator resourceByLabel childMaxResource equals Resources none parentMaxRes childMaxResource parentMaxRes childQueue getQueueResourceQuotas setEffectiveMaxResource label Resources clone effMaxResource deriveCapacityFromAbsoluteConfigurations label clusterResource rc childQueue
Resource Float effectiveMinRatio Resource minResource Resource ret Resource newInstance minResource maxLength ResourceUtils getNumberOfCountableResourceTypes i i maxLength i ResourceInformation nResourceInformation minResource getResourceInformation i Float ratio effectiveMinRatio get nResourceInformation getName ratio ret setResourceValue i nResourceInformation getValue ratio floatValue
childQueue getQueueCapacities setAbsoluteCapacity label childQueue getQueueCapacities getCapacity label getQueueCapacities getAbsoluteCapacity label childQueue getQueueCapacities setAbsoluteMaximumCapacity label childQueue getQueueCapacities getMaximumCapacity label getQueueCapacities getAbsoluteMaximumCapacity label childQueue LeafQueue LeafQueue leafQueue LeafQueue childQueue CapacitySchedulerConfiguration conf csContext getConfiguration maxApplications conf getMaximumApplicationsPerQueue childQueue getQueuePath maxApplications maxGlobalPerQueueApps conf getGlobalMaximumApplicationsPerQueue maxGlobalPerQueueApps maxApplications maxGlobalPerQueueApps childQueue getQueueCapacities getAbsoluteCapacity label maxApplications conf getMaximumSystemApplications childQueue getQueueCapacities getAbsoluteCapacity label leafQueue setMaxApplications maxApplications maxApplicationsPerUser Math min maxApplications maxApplications leafQueue getUsersManager getUserLimit leafQueue getUsersManager getUserLimitFactor leafQueue setMaxApplicationsPerUser maxApplicationsPerUser
clusterResource rmContainer FiCaSchedulerNode node scheduler getNode rmContainer getContainer getNodeId allocateResource clusterResource rmContainer getContainer getResource node getPartition
clusterResource rmContainer FiCaSchedulerNode node scheduler getNode rmContainer getContainer getNodeId releaseResource clusterResource rmContainer getContainer getResource node getPartition
cluster FiCaSchedulerApp FiCaSchedulerNode request request ContainerAllocationProposal FiCaSchedulerApp FiCaSchedulerNode allocation request getFirstAllocatedOrReservedContainer SchedulerContainer FiCaSchedulerApp FiCaSchedulerNode schedulerContainer allocation getAllocatedOrReservedContainer allocation writeLock lock allocateResource cluster allocation getAllocatedOrReservedResource schedulerContainer getNodePartition
List QueueManagementChange queueManagementChanges Collections emptyList parentQueue AutoCreatedQueueManagementPolicy policyClazz parentQueue getAutoCreatedQueueManagementPolicy startTime startTime clock getTime queueManagementChanges policyClazz computeQueueManagementChanges queueManagementChanges size QueueManagementChangeEvent queueManagementChangeEvent QueueManagementChangeEvent parentQueue queueManagementChanges scheduler getRMContext getDispatcher getEventHandler handle queueManagementChangeEvent LOG LOG debug policyClazz getClass getName clock getTime startTime queueManagementChanges size LOG debug parentQueue getQueuePath queueManagementChanges size queueManagementChanges toString queueManagementChanges size
AutoCreatedQueueManagementPolicy policyClazz parentQueue getAutoCreatedQueueManagementPolicy startTime startTime clock getTime queueManagementChanges policyClazz computeQueueManagementChanges queueManagementChanges size QueueManagementChangeEvent queueManagementChangeEvent QueueManagementChangeEvent parentQueue queueManagementChanges scheduler getRMContext getDispatcher getEventHandler handle queueManagementChangeEvent LOG LOG debug policyClazz getClass getName clock getTime startTime queueManagementChanges size LOG debug parentQueue getQueuePath queueManagementChanges size queueManagementChanges toString queueManagementChanges size e LOG error parentQueue getQueuePath e
Resource consumed Resources multiplyAndNormalizeUp resourceCalculator partitionResource getUsageRatio nodePartition lQueue getMinimumAllocation Resource currentCapacity Resources lessThan resourceCalculator partitionResource consumed queueCapacity queueCapacity Resources add consumed required usersSummedByWeight activeUsersTimesWeights Resource resourceUsed Resources add totalResUsageForActiveUsers getUsed nodePartition required resourceUsed currentCapacity usersSummedByWeight allUsersTimesWeights Resource userLimitResource Resources max resourceCalculator partitionResource Resources divideAndCeil resourceCalculator resourceUsed usersSummedByWeight Resources divideAndCeil resourceCalculator Resources multiplyAndRoundDown currentCapacity getUserLimit Resource maxUserLimit Resources none maxUserLimit Resources multiplyAndRoundDown queueCapacity getUserLimitFactor maxUserLimit partitionResource userLimitResource Resources roundUp resourceCalculator Resources min resourceCalculator partitionResource userLimitResource maxUserLimit lQueue getMinimumAllocation
userName writeLock lock User user getUser userName user ResourceUsage resourceUsage user getResourceUsage activeUsersSet userName activeUsersSet remove userName nonActiveUsersSet add userName activeUsersTimesWeights sumActiveUsersTimesWeights partition resourceUsage totalResUsageForActiveUsers decUsed partition resourceUsage getUsed partition totalResUsageForNonActiveUsers incUsed partition resourceUsage getUsed partition
scheduler scheduler scheduler conf scheduler getConfiguration overrideWithWorkflowPriorityMappings conf getOverrideWithWorkflowPriorityMappings
CSAssignment Resource result RMContainer CSAssignment SkippedType skipped result getAllocationState AllocationState APP_SKIPPED CSAssignment SkippedType OTHER CSAssignment SkippedType NONE CSAssignment assignment CSAssignment skipped assignment setApplication application assignment setExcessReservation result getContainerToBeUnreserved assignment setRequestLocalityType result requestLocalityType result getResourceToBeAllocated Resource allocatedResource result getResourceToBeAllocated RMContainer updatedContainer result getUpdatedContainer assignment setResource allocatedResource assignment setType result getContainerNodeType result getAllocationState AllocationState
Resource allocatedResource result getResourceToBeAllocated RMContainer updatedContainer result getUpdatedContainer assignment setResource allocatedResource assignment setType result getContainerNodeType result RESERVED LOG LOG debug application getApplicationId allocatedResource appInfo getQueueName clusterResource assignment getAssignmentInformation addReservationDetails updatedContainer application getCSLeafQueue getQueuePath assignment getAssignmentInformation incrReservations Resources addTo assignment getAssignmentInformation getReserved allocatedResource ActivitiesLogger APP finishSkippedAppAllocationRecording activitiesManager application getApplicationId ActivityState SKIPPED ActivityDiagnosticConstant EMPTY ActivitiesLogger APP finishAllocatedAppAllocationRecording activitiesManager application getApplicationId updatedContainer getContainerId ActivityState RESERVED ActivityDiagnosticConstant EMPTY result
application LOG debug application getApplicationAttemptId application updateAppSkipNodeDiagnostics ActivitiesLogger APP recordSkippedAppActivityWithoutAllocation activitiesManager node application schedulerKey ActivityDiagnosticConstant REQUEST_SKIPPED_IN_IGNORE_EXCLUSIVITY_MODE ActivityLevel REQUEST ContainerAllocation APP_SKIPPED Optional DiagnosticsCollector dcOpt activitiesManager Optional empty activitiesManager getOptionalDiagnosticsCollector schedulerKey node dcOpt ActivitiesLogger APP recordSkippedAppActivityWithoutAllocation activitiesManager node application schedulerKey ActivityDiagnosticConstant NODE_DO_NOT_MATCH_PARTITION_OR_PLACEMENT_CONSTRAINTS ActivitiesManager getDiagnostics dcOpt ActivityLevel NODE ContainerAllocation PRIORITY_SKIPPED application schedulerKey LOG debug ActivitiesLogger APP recordSkippedAppActivityWithoutAllocation activitiesManager node application schedulerKey ActivityDiagnosticConstant REQUEST_SKIPPED_BECAUSE_OF_RESERVATION ActivityLevel REQUEST ContainerAllocation PRIORITY_SKIPPED
application schedulerKey required LOG debug ActivitiesLogger APP recordSkippedAppActivityWithoutAllocation activitiesManager node application schedulerKey ActivityDiagnosticConstant REQUEST_SKIPPED_BECAUSE_OF_RESERVATION ActivityLevel REQUEST ContainerAllocation PRIORITY_SKIPPED required node LOG debug required ActivitiesLogger APP recordAppActivityWithoutAllocation activitiesManager node application schedulerKey ActivityDiagnosticConstant QUEUE_DO_NOT_HAVE_ENOUGH_HEADROOM ActivityState REJECTED ActivityLevel REQUEST ContainerAllocation QUEUE_SKIPPED missedNonPartitionedRequestSchedulingOpportunity AppPlacementAllocator appPlacementAllocator appInfo getAppPlacementAllocator schedulerKey appPlacementAllocator ActivitiesLogger APP recordSkippedAppActivityWithoutAllocation activitiesManager node application schedulerKey ActivityDiagnosticConstant REQUEST_SKIPPED_BECAUSE_NULL_ANY_REQUEST ActivityLevel REQUEST ContainerAllocation PRIORITY_SKIPPED String requestPartition appPlacementAllocator getPrimaryRequestedNodePartition
schedulerKey required requiredContainers application getOutstandingAsksCount schedulerKey reservedContainers application getNumReservedContainers schedulerKey starvation reservedContainers nodeFactor Resources ratio rc required application getCSLeafQueue getMaximumAllocation starvation application getReReservations schedulerKey reservedContainers Math min nodeFactor application getCSLeafQueue getMinimumAllocationFactor
FiCaSchedulerNode candidates FiCaSchedulerNode node CandidateNodeSetUtils getSingleNode candidates candidates
String pathName path getName pathName startsWith YarnConfiguration CS_CONFIGURATION_FILE pathName endsWith TMP Configuration conf Configuration fsConf String schedulerConfPathStr conf get YarnConfiguration SCHEDULER_CONFIGURATION_FS_PATH schedulerConfPathStr schedulerConfPathStr IOException YarnConfiguration SCHEDULER_CONFIGURATION_FS_PATH schedulerConfDir Path schedulerConfPathStr String scheme schedulerConfDir toUri getScheme scheme scheme FileSystem getDefaultUri conf getScheme scheme String disableCacheName String format scheme conf setBoolean disableCacheName fileSystem schedulerConfDir getFileSystem conf
pathName startsWith YarnConfiguration CS_CONFIGURATION_FILE pathName endsWith TMP Configuration conf Configuration fsConf String schedulerConfPathStr conf get YarnConfiguration SCHEDULER_CONFIGURATION_FS_PATH schedulerConfPathStr schedulerConfPathStr IOException YarnConfiguration SCHEDULER_CONFIGURATION_FS_PATH schedulerConfDir Path schedulerConfPathStr String scheme schedulerConfDir toUri getScheme scheme scheme FileSystem getDefaultUri conf getScheme scheme String disableCacheName String format scheme conf setBoolean disableCacheName fileSystem schedulerConfDir getFileSystem conf maxVersion conf getInt YarnConfiguration SCHEDULER_CONFIGURATION_FS_MAX_VERSION YarnConfiguration DEFAULT_SCHEDULER_CONFIGURATION_FS_MAX_VERSION
Path finalConfigPath getFinalConfigPath tempConfigPath fileSystem rename tempConfigPath finalConfigPath
fileSystem delete tempConfigPath
Path vSchedConf start Time monotonicNow String tempSchedulerConfigFile YarnConfiguration CS_CONFIGURATION_FILE System currentTimeMillis TMP Path tempSchedulerConfigPath Path schedulerConfDir tempSchedulerConfigFile outputStream tempSchedulerConfigPath cleanConfigurationFile vSchedConf writeXml outputStream
Version loadedVersion getConfStoreVersion Version currentVersion getCurrentVersion
conf String store conf get YarnConfiguration SCHEDULER_CONFIGURATION_STORE_CLASS YarnConfiguration MEMORY_CONFIGURATION_STORE store YarnConfiguration MEMORY_CONFIGURATION_STORE YarnConfiguration YarnConfiguration YarnConfiguration conf YarnConfiguration SCHEDULER_CONFIGURATION_STORE_CLASS
parentQueue leafQueueTemplate parentQueue getLeafQueueTemplate leafQueueTemplateCapacities leafQueueTemplate getQueueCapacities Set String parentQueueLabels parentQueue getNodeLabelsForQueue String leafQueueTemplateCapacities parentQueueLabels
List QueueManagementChange updateLeafQueueState readLock lock List QueueManagementChange queueManagementChanges ArrayList List FiCaSchedulerApp pendingApps getSortedPendingApplications Map String QueueCapacities leafQueueEntitlements HashMap String nodeLabel parentAbsoluteCapacity managedParentQueue getQueueCapacities getAbsoluteCapacity nodeLabel leafQueueTemplateAbsoluteCapacity leafQueueTemplateCapacities getAbsoluteCapacity nodeLabel Map String QueueCapacities deactivatedLeafQueues deactivateLeafQueuesIfInActive managedParentQueue nodeLabel leafQueueEntitlements deactivatedLeafQueues
List QueueManagementChange queueManagementChanges ArrayList List FiCaSchedulerApp pendingApps getSortedPendingApplications Map String QueueCapacities leafQueueEntitlements HashMap String nodeLabel parentAbsoluteCapacity managedParentQueue getQueueCapacities getAbsoluteCapacity nodeLabel leafQueueTemplateAbsoluteCapacity leafQueueTemplateCapacities getAbsoluteCapacity nodeLabel Map String QueueCapacities deactivatedLeafQueues deactivateLeafQueuesIfInActive managedParentQueue nodeLabel leafQueueEntitlements LOG deactivatedLeafQueues size LOG debug managedParentQueue getQueuePath nodeLabel deactivatedLeafQueues size deactivatedLeafQueues size deactivatedLeafQueues deactivatedCapacity getTotalDeactivatedCapacity deactivatedLeafQueues nodeLabel sumOfChildQueueActivatedCapacity parentQueueState getAbsoluteActivatedChildQueueCapacity nodeLabel availableCapacity parentAbsoluteCapacity sumOfChildQueueActivatedCapacity deactivatedCapacity EPSILON LOG
parentAbsoluteCapacity managedParentQueue getQueueCapacities getAbsoluteCapacity nodeLabel leafQueueTemplateAbsoluteCapacity leafQueueTemplateCapacities getAbsoluteCapacity nodeLabel Map String QueueCapacities deactivatedLeafQueues deactivateLeafQueuesIfInActive managedParentQueue nodeLabel leafQueueEntitlements LOG deactivatedLeafQueues size LOG debug managedParentQueue getQueuePath nodeLabel deactivatedLeafQueues size deactivatedLeafQueues size deactivatedLeafQueues deactivatedCapacity getTotalDeactivatedCapacity deactivatedLeafQueues nodeLabel sumOfChildQueueActivatedCapacity parentQueueState getAbsoluteActivatedChildQueueCapacity nodeLabel availableCapacity parentAbsoluteCapacity sumOfChildQueueActivatedCapacity deactivatedCapacity EPSILON LOG LOG debug managedParentQueue getQueuePath nodeLabel parentAbsoluteCapacity leafQueueTemplateAbsoluteCapacity deactivatedCapacity sumOfChildQueueActivatedCapacity availableCapacity availableCapacity leafQueueTemplateAbsoluteCapacity pendingApps size maxLeafQueuesTobeActivated getMaxLeavesToBeActivated availableCapacity leafQueueTemplateAbsoluteCapacity pendingApps size LOG
writeLock lock Set String newPartitions HashSet Set String newQueues HashSet newQueue newQueue LeafQueue String nodeLabel leafQueueState createLeafQueueStateIfNotExists LeafQueue newQueue nodeLabel newPartitions add nodeLabel newQueues add newQueue getQueuePath Map Entry String Map String LeafQueueStatePerPartition itr leafQueueState itr Map Entry String Map String LeafQueueStatePerPartition e itr next String partition e getKey newPartitions partition itr remove
leafQueueState createLeafQueueStateIfNotExists LeafQueue newQueue nodeLabel newPartitions add nodeLabel newQueues add newQueue getQueuePath Map Entry String Map String LeafQueueStatePerPartition itr leafQueueState itr Map Entry String Map String LeafQueueStatePerPartition e itr next String partition e getKey newPartitions partition itr remove LOG info managedParentQueue getQueuePath partition Map String LeafQueueStatePerPartition queues e getValue Map Entry String LeafQueueStatePerPartition queueItr queues queueItr String queue queueItr next getKey newQueues queue queueItr remove
queueManagementChange AutoCreatedLeafQueueConfig updatedQueueTemplate queueManagementChange getUpdatedQueueTemplate CSQueue queue queueManagementChange getQueue queue AutoCreatedLeafQueue SchedulerDynamicEditException queue getClass getName AutoCreatedLeafQueue leafQueue AutoCreatedLeafQueue queue nodeLabel updatedQueueTemplate updatedQueueTemplate nodeLabel leafQueue nodeLabel LOG debug leafQueue getQueuePath activate leafQueue nodeLabel leafQueue nodeLabel
c getRmContainer LOG debug c getRmContainer c r c r getRmContainer LOG debug r getRmContainer c getAllocateFromReservedContainer c getAllocateFromReservedContainer getRmContainer LOG debug c getAllocateFromReservedContainer getRmContainer c r c r getRmContainer
allocation getAllocateFromReservedContainer LOG LOG debug allocation getAllocateFromReservedContainer getRmContainer getContainerId Resource availableResource Resources clone schedulerContainer getSchedulerNode getUnallocatedResource allocation allocation releaseContainer allocation releaseContainer getRmContainer releaseContainer getRmContainer releaseContainer getSchedulerNode getReservedContainer LOG LOG debug releaseContainer getRmContainer getContainerId releaseContainer getSchedulerNode getNodeID releaseContainer getSchedulerNode getReservedContainer releaseContainer getRmContainer releaseContainer getSchedulerNode schedulerContainer getSchedulerNode Resources addTo availableResource releaseContainer getRmContainer getAllocatedResource Resources allocation availableResource
readLock lock request request ContainerAllocationProposal FiCaSchedulerApp FiCaSchedulerNode allocation request getFirstAllocatedOrReservedContainer SchedulerContainer FiCaSchedulerApp FiCaSchedulerNode schedulerContainer allocation getAllocatedOrReservedContainer schedulerContainer getSchedulerNode getRMNode getState LOG LOG debug schedulerContainer getSchedulerNode getNodeID schedulerContainer getSchedulerNode getRMNode getState schedulerContainer containerRequest schedulerContainer getRmContainer getContainerRequest allocation schedulerContainer getSchedulerNode schedulerContainer LOG
schedulerContainer getSchedulerNode getRMNode getState LOG LOG debug schedulerContainer getSchedulerNode getNodeID schedulerContainer getSchedulerNode getRMNode getState schedulerContainer containerRequest schedulerContainer getRmContainer getContainerRequest allocation getAllocationLocalityType schedulerContainer getSchedulerNode schedulerContainer getSchedulerRequestKey LOG LOG debug allocation getAllocationLocalityType schedulerContainer getSchedulerNode schedulerContainer getSchedulerRequestKey getApplicationAttemptId allocation schedulerContainer schedulerContainer getRmContainer getState schedulerContainer getRmContainer schedulerContainer getSchedulerNode
allocation getAllocateFromReservedContainer RMContainer reservedContainer allocation getAllocateFromReservedContainer getRmContainer unreserve schedulerContainer getSchedulerRequestKey schedulerContainer getSchedulerNode reservedContainer addToNewlyAllocatedContainers schedulerContainer getSchedulerNode rmContainer liveContainers put containerId rmContainer ContainerRequest containerRequest appSchedulingInfo allocate allocation getAllocationLocalityType schedulerContainer getSchedulerNode schedulerContainer getSchedulerRequestKey schedulerContainer getRmContainer RMContainerImpl rmContainer setContainerRequest containerRequest containerRequest containerRequest getSchedulingRequest RMContainerImpl rmContainer setAllocationTags containerRequest getSchedulingRequest getAllocationTags AppSchedulingInfo updateMetrics getApplicationId allocation getAllocationLocalityType schedulerContainer getSchedulerNode schedulerContainer getRmContainer getUser getQueue attemptResourceUsage incUsed schedulerContainer getNodePartition allocation getAllocatedOrReservedResource rmContainer handle RMContainerEvent containerId RMContainerEventType START schedulerContainer getSchedulerNode allocateContainer rmContainer
ContainerRequest containerRequest appSchedulingInfo allocate allocation getAllocationLocalityType schedulerContainer getSchedulerNode schedulerContainer getSchedulerRequestKey schedulerContainer getRmContainer RMContainerImpl rmContainer setContainerRequest containerRequest containerRequest containerRequest getSchedulingRequest RMContainerImpl rmContainer setAllocationTags containerRequest getSchedulingRequest getAllocationTags AppSchedulingInfo updateMetrics getApplicationId allocation getAllocationLocalityType schedulerContainer getSchedulerNode schedulerContainer getRmContainer getUser getQueue attemptResourceUsage incUsed schedulerContainer getNodePartition allocation getAllocatedOrReservedResource rmContainer handle RMContainerEvent containerId RMContainerEventType START schedulerContainer getSchedulerNode allocateContainer rmContainer incNumAllocatedContainers allocation getAllocationLocalityType allocation getRequestLocalityType LOG LOG debug containerId getApplicationAttemptId containerId rmContainer getAllocatedNode getHost allocation getAllocationLocalityType String partition schedulerContainer getSchedulerNode getPartition partition partition partition
NodeId schedulerKey Resource Map NodeId RMContainer reservedContainers reservedContainers get schedulerKey reservedContainers reservedContainers Map NodeId RMContainer entry reservedContainers NodeId nodeId entry getKey RMContainer reservedContainer entry getValue Resource reservedResource reservedContainer getReservedResource reservedResource
LOG debug Map NodeId RMContainer map reservedContainers get reservedContainer getReservedSchedulerKey map LOG debug reservedContainer LOG debug targetNode targetNode LOG debug targetNode reserveResource reservedContainer getReservedSchedulerKey reservedContainer
allocateContainer rmContainer launchedOnNode allocateContainer rmContainer launchedOnNode Container container rmContainer getContainer
Map String PlacementConstraint constraintsForApp HashMap readLock lock appId LOG warn appId Map Set String PlacementConstraint entry Set String sourceTags entry getKey PlacementConstraint constraint entry getValue sourceTags constraint String sourceTag getValidSourceTag sourceTags constraintsForApp put sourceTag constraint readLock unlock constraintsForApp
appId String PlacementConstraint writeLock lock Map String PlacementConstraint constraintsForApp appConstraints get appId constraintsForApp
String String sourceTags sourceTags String sourceTag getValidSourceTag sourceTags sourceTag
readLock lock
LOG debug requestAttribute schedulerNode getNodeID LOG debug requestAttribute schedulerNode getNodeID found NodeAttribute it schedulerNode it NodeAttribute nodeAttribute it next LOG LOG debug requestAttribute requestAttribute getAttributeValue nodeAttribute getAttributeValue requestAttribute nodeAttribute requestAttribute nodeAttribute LOG debug requestAttribute schedulerNode getNodeID found found found
NodeAttribute NodeAttribute nodeAttribute
ConstraintPlacementAlgorithm algorithm instances instances algorithm instances get algorithm DefaultPlacementAlgorithm LOG info algorithm getClass getName String iteratorName RMContextImpl amsContext getYarnConfiguration get YarnConfiguration RM_PLACEMENT_CONSTRAINTS_ALGORITHM_ITERATOR BatchedRequests IteratorType SERIAL name LOG info iteratorName iteratorType BatchedRequests IteratorType valueOf iteratorName e YarnRuntimeException e algoPSize RMContextImpl amsContext getYarnConfiguration getInt YarnConfiguration RM_PLACEMENT_CONSTRAINTS_ALGORITHM_POOL_SIZE YarnConfiguration DEFAULT_RM_PLACEMENT_CONSTRAINTS_ALGORITHM_POOL_SIZE placementDispatcher PlacementDispatcher placementDispatcher init RMContextImpl amsContext algorithm algoPSize
algorithm DefaultPlacementAlgorithm LOG info algorithm getClass getName String iteratorName RMContextImpl amsContext getYarnConfiguration get YarnConfiguration RM_PLACEMENT_CONSTRAINTS_ALGORITHM_ITERATOR BatchedRequests IteratorType SERIAL name LOG info iteratorName iteratorType BatchedRequests IteratorType valueOf iteratorName e YarnRuntimeException e algoPSize RMContextImpl amsContext getYarnConfiguration getInt YarnConfiguration RM_PLACEMENT_CONSTRAINTS_ALGORITHM_POOL_SIZE YarnConfiguration DEFAULT_RM_PLACEMENT_CONSTRAINTS_ALGORITHM_POOL_SIZE placementDispatcher PlacementDispatcher placementDispatcher init RMContextImpl amsContext algorithm algoPSize LOG info algoPSize schedPSize RMContextImpl amsContext getYarnConfiguration getInt YarnConfiguration RM_PLACEMENT_CONSTRAINTS_SCHEDULER_POOL_SIZE YarnConfiguration DEFAULT_RM_PLACEMENT_CONSTRAINTS_SCHEDULER_POOL_SIZE schedulingThreadPool Executors newFixedThreadPool schedPSize
ConstraintPlacementAlgorithmOutputCollector collector
placement placement List PlacedSchedulingRequest processed placedRequests computeIfAbsent placement getApplicationId k ArrayList processed
List Container blackList List oppResourceReqs opportContext String updateBlacklist blackList opportContext opportContext addToOutstandingReqs oppResourceReqs Set String nodeBlackList HashSet opportContext getBlacklist List Container allocatedContainers ArrayList maxAllocationsPerAMHeartbeat getMaxAllocationsPerAMHeartbeat List Map Resource List Allocation allocations ArrayList opportContext remAllocs maxAllocationsPerAMHeartbeat remAllocs maxAllocationsPerAMHeartbeat getTotalAllocations allocations remAllocs
List Container enrichedAsk nodeLocation toAllocate rmIdentifier appParams idCounter blacklist id userName List allocations List Container allocatedContainers ArrayList toAllocate RMNode node nodeQueueLoadMonitor selectLocalNode nodeLocation blacklist node toAllocate Container container createContainer rmIdentifier appParams idCounter id userName allocations nodeLocation enrichedAsk getRequest convertToRemoteNode node allocatedContainers add container
List Container enrichedAsk rackLocation toAllocate rmIdentifier appParams idCounter blacklist id userName List allocations List Container allocatedContainers ArrayList toAllocate RMNode node nodeQueueLoadMonitor selectRackLocalNode rackLocation blacklist node toAllocate Container container createContainer rmIdentifier appParams idCounter id userName allocations rackLocation enrichedAsk getRequest convertToRemoteNode node allocatedContainers add container metrics incrRackLocalOppContainers
List Container enrichedAsk toAllocate rmIdentifier appParams idCounter blacklist id userName List allocations List Container allocatedContainers ArrayList toAllocate RMNode node nodeQueueLoadMonitor selectAnyNode blacklist node toAllocate Container container createContainer rmIdentifier appParams idCounter id userName allocations ResourceRequest ANY enrichedAsk getRequest convertToRemoteNode node allocatedContainers add container metrics incrOffSwitchOppContainers
rmNode status opportQueueCapacity status getOpportQueueCapacity estimatedQueueWaitTime status getEstimatedQueueWaitTime waitQueueLength status getWaitQueueLength rmNode estimatedQueueWaitTime clusterNodes put rmNode getNodeID ClusterNode rmNode getNodeID setQueueWaitTime estimatedQueueWaitTime setQueueLength waitQueueLength setNodeLabels rmNode getNodeLabels setQueueCapacity opportQueueCapacity
rmNode clusterNode status estimatedQueueWaitTime status getEstimatedQueueWaitTime waitQueueLength status getWaitQueueLength rmNode estimatedQueueWaitTime clusterNode setQueueWaitTime estimatedQueueWaitTime setQueueLength waitQueueLength setNodeLabels rmNode getNodeLabels updateTimestamp
allocFile getAllocationFile conf allocFile fs allocFile getFileSystem conf reloadListener onCheck time clock getTime lastModified fs getFileStatus allocFile getModificationTime lastModified time lastModified reloadAllocations
reloadListener onCheck time clock getTime lastModified fs getFileStatus allocFile getModificationTime lastModified time lastModified reloadAllocations ex lastReloadAttemptFailed LOG error ex lastReloadAttemptFailed lastModified lastReloadAttemptFailed LOG warn fs exists allocFile lastReloadAttemptFailed
rmContainer writeLock lock Container container rmContainer getContainer ContainerId containerId container getId containerId
Resource getHeadroom FSQueue fsQueue getQueue SchedulingPolicy policy fsQueue getPolicy Resource queueFairShare fsQueue getFairShare Resource queueUsage fsQueue getResourceUsage Resource clusterResource scheduler getClusterResource Resource clusterUsage scheduler getRootQueueMetrics getAllocatedResources Resource clusterAvailableResources Resources subtract clusterResource clusterUsage subtractResourcesOnBlacklistedNodes clusterAvailableResources Resource queueMaxAvailableResources Resources subtract fsQueue getMaxShare queueUsage Resource maxAvailableResource Resources componentwiseMin clusterAvailableResources queueMaxAvailableResources Resource headroom policy getHeadroom queueFairShare queueUsage maxAvailableResource
resetAllowedLocalityLevel schedulerKey type schedulerKey container reservedContainer container container createContainer node pendingAsk getPerAllocationResource schedulerKey rmContainer RMContainerImpl container schedulerKey getApplicationAttemptId node getNodeID appSchedulingInfo getUser rmContext RMContainerImpl rmContainer setQueueName getQueueName addToNewlyAllocatedContainers node rmContainer liveContainers put container getId rmContainer ContainerRequest containerRequest appSchedulingInfo allocate type node schedulerKey rmContainer attemptResourceUsage incUsed container getResource getQueue incUsedResource container getResource RMContainerImpl rmContainer setContainerRequest containerRequest rmContainer handle RMContainerEvent container getId RMContainerEventType START
node RMContainer nodeReservedContainer node getReservedContainer reservableForThisApp nodeReservedContainer nodeReservedContainer getApplicationAttemptId equals getApplicationAttemptId reservableForThisApp node
node NodeType type type NodeType existingReservations getNumReservations node getRackName type NodeType OFF_SWITCH totalAvailNodes type NodeType OFF_SWITCH scheduler getNumClusterNodes scheduler getNumNodesInRack node getRackName numAllowedReservations Math ceil totalAvailNodes scheduler getReservableNodesRatio existingReservations numAllowedReservations DecimalFormat df DecimalFormat df setMaximumFractionDigits
Resources capability available RMContainer allocatedContainer allocate type node schedulerKey pendingAsk reservedContainer allocatedContainer unreserve schedulerKey node LOG debug capability available Resources none unreserve schedulerKey node node allocateContainer allocatedContainer setAMResource capability getQueue addAMResourceUsage capability setAmRunning capability
Resources none unreserve schedulerKey node node allocateContainer allocatedContainer setAMResource capability getQueue addAMResourceUsage capability setAmRunning capability LOG debug capability capability node node schedulerKey updateAMDiagnosticMsg capability LOG debug getName FairScheduler CONTAINER_RESERVED
node RMContainer rmContainer node getReservedContainer SchedulerRequestKey reservedSchedulerKey rmContainer getReservedSchedulerKey node
PendingAsk amAsk appSchedulingInfo getNextPendingAsk updateAMDiagnosticMsg amAsk getPerAllocationResource
Resource Resource assigned none
updateDemand writeLock lock demand Resources createResource childQueue childQueue updateDemand Resource toAdd childQueue getDemand demand Resources add demand toAdd
Resource Resource assigned Resources none
List RMContainer FSAppAttempt starvedApp List RMContainer containersToPreempt ArrayList rr starvedApp List FSSchedulerNode potentialNodes scheduler getNodeTracker getNodesByResourceName rr getResourceName rr PreemptableContainers bestContainers getBestPreemptableContainers rr potentialNodes bestContainers List RMContainer containers bestContainers getAllContainers containers containersToPreempt addAll containers trackPreemptionsAgainstNode containers starvedApp RMContainer container containers FSAppAttempt app scheduler getSchedulerApp container getApplicationAttemptId
PreemptableContainers Resource node maxAMContainers PreemptableContainers preemptableContainers PreemptableContainers maxAMContainers List RMContainer containersToCheck node getRunningContainersWithAMsAtTheEnd containersToCheck removeAll node getContainersForPreemption Resource potential Resources subtractFromNonNegative Resources clone node getUnallocatedResource node getTotalReserved RMContainer container containersToCheck FSAppAttempt app scheduler getSchedulerApp container getApplicationAttemptId app
setFairShare fairShare fairShare fairShare metrics setFairShare fairShare
Resource additionalResource Resource usagePlusAddition Resources add getResourceUsage additionalResource Resources usagePlusAddition
allocateContainer rmContainer launchedOnNode allocateContainer rmContainer launchedOnNode Container container rmContainer getContainer
LOG Container container rmContainer getContainer LOG debug container getId container getResource getRMNode getNodeAddress getNumContainers getAllocatedResource getUnallocatedResource Resource allocated rmContainer getAllocatedResource Resources allocated FSAppAttempt app appIdToAppMap get rmContainer getApplicationAttemptId app Resource reserved resourcesPreemptedForApp get app Resource fulfilled Resources componentwiseMin reserved allocated Resources subtractFrom reserved fulfilled Resources subtractFrom totalResourcesPreempted fulfilled Resources reserved resourcesPreemptedForApp remove app appIdToAppMap remove rmContainer getApplicationAttemptId
FSQueue rootQueue queueMgr getRootQueue Resource clusterResource getClusterResource
FSQueue rootQueue queueMgr getRootQueue Resource clusterResource getClusterResource STATE_DUMP_LOG debug clusterResource rootMetrics getAllocatedResources Resource newInstance rootMetrics getAvailableMB rootMetrics getAvailableVirtualCores rootQueue getDemand
rejectApplicationWithMessage applicationId queueName queueName queue queueMgr getLeafQueue queueName applicationId UserGroupInformation userUgi UserGroupInformation createRemoteUser user queue userUgi queue userUgi String msg user applicationId queueName rejectApplicationWithMessage applicationId msg queue removeAssignedApp applicationId RMApp rmApp rmContext getRMApps get applicationId rmApp rmApp setQueue queueName
rejectApplicationWithMessage applicationId msg queue removeAssignedApp applicationId RMApp rmApp rmContext getRMApps get applicationId rmApp rmApp setQueue queueName LOG error applicationId rmApp rmApp getAMResourceRequests List MaxResourceValidationResult invalidAMResourceRequests validateResourceRequests rmApp getAMResourceRequests queue invalidAMResourceRequests String msg String format applicationId queueName invalidAMResourceRequests queue getMaxShare rejectApplicationWithMessage applicationId msg queue removeAssignedApp applicationId
RMApp rmApp rmContext getRMApps get applicationId rmApp rmApp setQueue queueName LOG error applicationId rmApp rmApp getAMResourceRequests List MaxResourceValidationResult invalidAMResourceRequests validateResourceRequests rmApp getAMResourceRequests queue invalidAMResourceRequests String msg String format applicationId queueName invalidAMResourceRequests queue getMaxShare rejectApplicationWithMessage applicationId msg queue removeAssignedApp applicationId SchedulerApplication FSAppAttempt application SchedulerApplication queue user applications put applicationId application
SchedulerApplication FSAppAttempt application applications get applicationAttemptId getApplicationId String user application getUser FSLeafQueue queue FSLeafQueue application getQueue FSAppAttempt attempt FSAppAttempt applicationAttemptId user queue ActiveUsersManager getRootQueueMetrics rmContext transferStateFromPreviousAttempt attempt transferStateFromPreviousAttempt application getCurrentAppAttempt application setCurrentAppAttempt attempt runnable maxRunningEnforcer canAppBeRunnable queue attempt queue addApp attempt runnable runnable maxRunningEnforcer trackRunnableApp attempt maxRunningEnforcer trackNonRunnableApp attempt queue getMetrics submitAppAttempt user
String user application getUser FSLeafQueue queue FSLeafQueue application getQueue FSAppAttempt attempt FSAppAttempt applicationAttemptId user queue ActiveUsersManager getRootQueueMetrics rmContext transferStateFromPreviousAttempt attempt transferStateFromPreviousAttempt application getCurrentAppAttempt application setCurrentAppAttempt attempt runnable maxRunningEnforcer canAppBeRunnable queue attempt queue addApp attempt runnable runnable maxRunningEnforcer trackRunnableApp attempt maxRunningEnforcer trackNonRunnableApp attempt queue getMetrics submitAppAttempt user LOG info applicationAttemptId user
writeLock lock
applicationAttemptId rmAppAttemptFinalState writeLock lock LOG info applicationAttemptId rmAppAttemptFinalState FSAppAttempt attempt getApplicationAttempt applicationAttemptId attempt
rmContainer writeLock lock Container container rmContainer getContainer FSAppAttempt application getCurrentAttemptForContainer container getId ApplicationId appId container getId getApplicationAttemptId getApplicationId application
rmContainer event writeLock lock Container container rmContainer getContainer FSAppAttempt application getCurrentAttemptForContainer container getId ApplicationId appId container getId getApplicationAttemptId getApplicationId application LOG info container appId event NodeId nodeID container getNodeId FSSchedulerNode node getFSSchedulerNode nodeID rmContainer node application unreserve rmContainer getReservedSchedulerKey node
application LOG info container appId event NodeId nodeID container getNodeId FSSchedulerNode node getFSSchedulerNode nodeID rmContainer node application unreserve rmContainer getReservedSchedulerKey node LOG debug nodeID application containerCompleted rmContainer containerStatus event node node releaseContainer rmContainer getContainerId
NodeId nodeID container getNodeId FSSchedulerNode node getFSSchedulerNode nodeID rmContainer node application unreserve rmContainer getReservedSchedulerKey node LOG debug nodeID application containerCompleted rmContainer containerStatus event node node releaseContainer rmContainer getContainerId LOG debug nodeID updateRootQueueMetrics LOG
addNode node writeLock lock FSSchedulerNode schedulerNode FSSchedulerNode node usePortForNodeName nodeTracker addNode schedulerNode triggerUpdate Resource clusterResource getClusterResource queueMgr getRootQueue setSteadyFairShare clusterResource queueMgr getRootQueue recomputeSteadyShares
rmNode writeLock lock NodeId nodeId rmNode getNodeID FSSchedulerNode node nodeTracker getNode nodeId node
LOG error nodeId List RMContainer runningContainers node getCopiedListOfRunningContainers RMContainer container runningContainers completedContainer container SchedulerUtils createAbnormalContainerStatus container getContainerId SchedulerUtils LOST_CONTAINER RMContainerEventType KILL node releaseContainer container getContainerId RMContainer reservedContainer node getReservedContainer reservedContainer completedContainer reservedContainer SchedulerUtils createAbnormalContainerStatus reservedContainer getContainerId SchedulerUtils LOST_CONTAINER RMContainerEventType KILL nodeTracker removeNode nodeId Resource clusterResource getClusterResource queueMgr getRootQueue setSteadyFairShare clusterResource queueMgr getRootQueue recomputeSteadyShares updateRootQueueMetrics triggerUpdate
container ContainerStatus status SchedulerUtils createKilledContainerStatus container getContainerId
appAttemptId FSAppAttempt application getSchedulerApp appAttemptId application
LOG error appAttemptId EMPTY_ALLOCATION ApplicationId applicationId application getApplicationId FSLeafQueue queue application getQueue List MaxResourceValidationResult invalidAsks validateResourceRequests ask queue invalidAsks SchedulerInvalidResoureRequestException String format applicationId queue getName invalidAsks handleContainerUpdates application updateRequests normalizeResourceRequests ask queue getName application recordContainerRequestTime getClock getTime releaseContainers release application ReentrantReadWriteLock WriteLock lock application getWriteLock lock lock ask
handleContainerUpdates application updateRequests normalizeResourceRequests ask queue getName application recordContainerRequestTime getClock getTime releaseContainers release application ReentrantReadWriteLock WriteLock lock application getWriteLock lock lock ask LOG LOG debug appAttemptId application getApplicationId application showRequests application updateResourceRequests ask application showRequests lock unlock
NodeId nodeID node node getNodeID nodeID LOG info nodeID assignPreemptedContainers node FSAppAttempt reservedAppSchedulable node getReservedAppSchedulable validReservation reservedAppSchedulable validReservation reservedAppSchedulable assignReservedContainer node validReservation assignedContainers Resource assignedResource Resources clone Resources none Resource maxResourcesToAssign Resources multiply node getUnallocatedResource node Resource assignment queueMgr getRootQueue assignContainer node
queueName readLock lock FSQueue queue getQueueManager getQueue queueName queue
List FSAppAttempt noLongerPendingApps ArrayList FSAppAttempt iter FSAppAttempt next iter next next prev next getQueue next trackRunnableApp next FSAppAttempt appSched next next getQueue addApp appSched noLongerPendingApps add appSched noLongerPendingApps prev next FSAppAttempt appSched noLongerPendingApps appSched getQueue appSched
FSAppAttempt next iter next next prev next getQueue next trackRunnableApp next FSAppAttempt appSched next next getQueue addApp appSched noLongerPendingApps add appSched noLongerPendingApps prev next FSAppAttempt appSched noLongerPendingApps appSched getQueue appSched LOG error appSched appSched appSched
FSQueue FSParentQueue topParent String newQueueNames AllocationConfiguration queueConf scheduler getAllocationConfiguration Iterator String i newQueueNames iterator FSParentQueue parent topParent FSQueue queue i FSParentQueue newParent String queueName i next SchedulingPolicy childPolicy scheduler getAllocationConfiguration getSchedulingPolicy queueName parent childPolicy
FSParentQueue parent topParent FSQueue queue i FSParentQueue newParent String queueName i next SchedulingPolicy childPolicy scheduler getAllocationConfiguration getSchedulingPolicy queueName parent childPolicy LOG error queueName i FSLeafQueue leafQueue FSLeafQueue queueName scheduler parent leafQueues add leafQueue queue leafQueue childPolicy
siteConf set YarnConfiguration FS_BASED_RM_CONF_STORE outputDir ConfigurationProvider provider FileSystemBasedConfigurationProvider provider init siteConf rmContext setConfigurationProvider provider RMNodeLabelsManager mgr RMNodeLabelsManager mgr init siteConf rmContext setNodeLabelManager mgr cs cs setConf siteConf cs setRMContext rmContext cs serviceInit csConfig cs serviceStart LOG info cs serviceStop
LOG info LOG info LOG info noOfErrors errors size noOfWarnings warnings size
LOG info LOG info LOG info noOfErrors errors size noOfWarnings warnings size LOG info noOfErrors
t LOG debug t
String property String action properties getProperty property action
schedulerKey RMContainer rmContainer RMContainerImpl container schedulerKey getApplicationAttemptId node getNodeID appSchedulingInfo getUser rmContext node getPartition RMContainerImpl rmContainer setQueueName getQueueName updateAMContainerDiagnostics AMState ASSIGNED addToNewlyAllocatedContainers node rmContainer ContainerId containerId container getId liveContainers put containerId rmContainer ContainerRequest containerRequest appSchedulingInfo allocate type node schedulerKey rmContainer attemptResourceUsage incUsed node getPartition container getResource RMContainerImpl rmContainer setContainerRequest containerRequest rmContainer handle RMContainerEvent containerId RMContainerEventType START
applicationAttemptId FifoAppAttempt application getApplicationAttempt applicationAttemptId application
applicationAttemptId ask release FifoAppAttempt application getApplicationAttempt applicationAttemptId application LOG error applicationAttemptId getApplicationId EMPTY_ALLOCATION application applicationAttemptId LOG error applicationAttemptId EMPTY_ALLOCATION normalizeResourceRequests ask releaseContainers release application application application LOG info applicationAttemptId EMPTY_ALLOCATION ask
LOG error applicationAttemptId getApplicationId EMPTY_ALLOCATION application applicationAttemptId LOG error applicationAttemptId EMPTY_ALLOCATION normalizeResourceRequests ask releaseContainers release application application application LOG info applicationAttemptId EMPTY_ALLOCATION ask LOG debug applicationAttemptId application application showRequests application updateResourceRequests ask
application applicationAttemptId LOG error applicationAttemptId EMPTY_ALLOCATION normalizeResourceRequests ask releaseContainers release application application application LOG info applicationAttemptId EMPTY_ALLOCATION ask LOG debug applicationAttemptId application application showRequests application updateResourceRequests ask LOG debug applicationAttemptId application application showRequests
applicationId user SchedulerApplication FifoAppAttempt application SchedulerApplication DEFAULT_QUEUE user applications put applicationId application metrics submitApp user
applicationId user SchedulerApplication FifoAppAttempt application SchedulerApplication DEFAULT_QUEUE user applications put applicationId application metrics submitApp user LOG info applicationId user applications size
AppAddedSchedulerEvent appAddedEvent AppAddedSchedulerEvent event addApplication appAddedEvent getApplicationId appAddedEvent getQueue appAddedEvent getUser appAddedEvent getIsAppRecovering AppRemovedSchedulerEvent appRemovedEvent AppRemovedSchedulerEvent event doneApplication appRemovedEvent getApplicationID appRemovedEvent getFinalState AppAttemptAddedSchedulerEvent appAttemptAddedEvent AppAttemptAddedSchedulerEvent event addApplicationAttempt appAttemptAddedEvent getApplicationAttemptId appAttemptAddedEvent getTransferStateFromPreviousAttempt appAttemptAddedEvent getIsAttemptRecovering AppAttemptRemovedSchedulerEvent appAttemptRemovedEvent AppAttemptRemovedSchedulerEvent event
rmContainer Container container rmContainer getContainer FifoAppAttempt application getCurrentAttemptForContainer container getId ApplicationId appId container getId getApplicationAttemptId getApplicationId FiCaSchedulerNode node FiCaSchedulerNode getNode container getNodeId application
container ContainerStatus status SchedulerUtils createKilledContainerStatus container getContainerId
appSchedulingInfo schedulerRequestKey rmContext appSchedulingInfo appSchedulingInfo rmContext rmContext schedulerRequestKey schedulerRequestKey multiNodeSortPolicyName appSchedulingInfo getApplicationSchedulingEnvs get ApplicationSchedulingConfig ENV_MULTI_NODE_SORTING_POLICY_CLASS multiNodeSortingManager MultiNodeSortingManager N rmContext getMultiNodeSortingManager
isMultiNodePlacementEnabled multiNodePlacementPolicies policySpecs addAll multiNodePlacementPolicies multiNodePlacementEnabled isMultiNodePlacementEnabled
newNumAllocations existingNumAllocations newNumAllocations sizing getNumAllocations sizing setNumAllocations existingNumAllocations schedulingRequest newSchedulingRequest sizing setNumAllocations newNumAllocations SchedulerInvalidResoureRequestException schedulingRequest toString newSchedulingRequest toString newNumAllocations existingNumAllocations sizing setNumAllocations newNumAllocations newNumAllocations SchedulerInvalidResoureRequestException PendingAskUpdateResult updateResult PendingAskUpdateResult PendingAsk schedulingRequest getResourceSizing PendingAsk newSchedulingRequest getResourceSizing targetNodePartition targetNodePartition
readLock lock
writeLock lock
writeLock lock
AMRMTokenIdentifier token writeLock lock AMRMTokenIdentifier identifier token decodeIdentifier
identifier readLock lock ApplicationAttemptId applicationAttemptId identifier getApplicationAttemptId
identifier readLock lock ApplicationAttemptId applicationAttemptId identifier getApplicationAttemptId
serviceStateLock writeLock lock isServiceStarted renewerService shutdown serviceStateLock writeLock unlock dtCancelThread interrupt dtCancelThread join e e printStackTrace delayedRemovalThread delayedRemovalThread interrupt delayedRemovalThread join
evt ApplicationId applicationId evt getApplicationId Credentials ts evt getCredentials shouldCancelAtEnd evt shouldCancelAtEnd ts LOG debug applicationId Collection Token tokens ts getAllTokens now System currentTimeMillis appTokens put applicationId Collections synchronizedSet HashSet DelegationTokenToRenew Set DelegationTokenToRenew tokenList HashSet DelegationTokenToRenew hasHdfsToken Token tokens
now System currentTimeMillis appTokens put applicationId Collections synchronizedSet HashSet DelegationTokenToRenew Set DelegationTokenToRenew tokenList HashSet DelegationTokenToRenew hasHdfsToken token token token LOG info applicationId token hasHdfsToken token DelegationTokenToRenew dttr allTokens get token dttr Configuration tokenConf tokenConf
DelegationTokenToRenew dttr allTokens get token dttr Configuration tokenConf evt tokenConf tokenConf evt tokenConf LOG info tokenConf size LOG Map Entry String String itor tokenConf itor Map Entry String String entry itor next LOG debug entry getKey entry getValue tokenConf getConfig dttr DelegationTokenToRenew Arrays asList applicationId token tokenConf now shouldCancelAtEnd evt getUser renewToken dttr
token expiresIn token expirationDate System currentTimeMillis expiresIn
dttr referringAppIds applicationIds HashSet dttr referringAppIds dttr referringAppIds clear appId applicationIds Set DelegationTokenToRenew tokenSet appTokens get appId tokenSet tokenSet Iterator DelegationTokenToRenew iter tokenSet iterator tokenSet iter DelegationTokenToRenew t iter next t token iter remove allTokens remove t token t cancelTimer
t Collection ApplicationId applicationIds t referringAppIds applicationIds
applicationId rmContext getSystemCredentialsForApps remove applicationId Set DelegationTokenToRenew tokens appTokens remove applicationId tokens tokens tokens Iterator DelegationTokenToRenew it tokens iterator it DelegationTokenToRenew dttr it next
attemptId writeLock lock HashSet NodeId nodeSet appAttemptToNodeKeyMap get attemptId nodeSet
NMToken appAttemptId writeLock lock HashSet NodeId nodeSet appAttemptToNodeKeyMap get appAttemptId NMToken nmToken nodeSet nodeSet
String conf LOG info String addresses conf getStrings YarnConfiguration NM_CSI_ADAPTOR_ADDRESSES addresses addresses String addresses
String CsiAdaptorProtocol conf LOG info String addresses conf getStrings YarnConfiguration NM_CSI_ADAPTOR_ADDRESSES addresses addresses String addr addresses LOG info addr InetSocketAddress address NetUtils createSocketAddr addr YarnRPC rpc YarnRPC create conf UserGroupInformation currentUser UserGroupInformation getCurrentUser CsiAdaptorProtocol adaptorClient NMProxy createNMProxy conf CsiAdaptorProtocol currentUser rpc address
String addresses conf getStrings YarnConfiguration NM_CSI_ADAPTOR_ADDRESSES addresses addresses String addr addresses LOG info addr InetSocketAddress address NetUtils createSocketAddr addr YarnRPC rpc YarnRPC create conf UserGroupInformation currentUser UserGroupInformation getCurrentUser CsiAdaptorProtocol adaptorClient NMProxy createNMProxy conf CsiAdaptorProtocol currentUser rpc address LOG info addr GetPluginInfoResponse response adaptorClient getPluginInfo GetPluginInfoRequest newInstance response getDriverName String driverName response getDriverName adaptorMap driverName YarnException driverName adaptorMap put driverName adaptorClient
writeLock lock VolumeId volumeId event getVolumeId volumeId LOG warn event getType name LOG info event getType name volumeId toString VolumeState oldState VolumeState newState oldState stateMachine getCurrentState newState stateMachine doTransition event getType event e LOG warn oldState event getType volumeId e newState oldState newState
ApplicationId appId ApplicationAttemptId appAttemptId ContainerId containerId appId Apps toAppID parts e LOG debug parts e redirectPath appId redirectPath pjoin ahsPageURLPrefix appId appAttemptId ApplicationAttemptId fromString parts e
LOG debug parts e redirectPath appId redirectPath pjoin ahsPageURLPrefix appId appAttemptId ApplicationAttemptId fromString parts e LOG debug parts e redirectPath appAttemptId redirectPath pjoin ahsPageURLPrefix appAttemptId containerId ContainerId fromString parts
updateNodeResource hsr String nodeId resourceOption UserGroupInformation callerUGI getCallerUserGroupInformation hsr initForWritableEndpoints callerUGI RMNode rmNode getRMNode nodeId Map NodeId ResourceOption nodeResourceMap Collections singletonMap rmNode getNodeID resourceOption getResourceOption UpdateNodeResourceRequest updateRequest UpdateNodeResourceRequest newInstance nodeResourceMap RMContext rmContext rm getRMContext AdminService admin rmContext getRMAdminService admin updateNodeResource updateRequest e String message rmNode getNodeID LOG error message e YarnRuntimeException message e e
limitNum limit limitNum Integer parseInt limit limitNum AppActivitiesInfo appId AppActivitiesInfo appId maxTime time time maxTime Double parseDouble time maxTime Double parseDouble time ApplicationId applicationId
rm getClientRMService renewDelegationToken req ue ue getCause ue getCause getCause BadRequestException ue getCause getCause getMessage ue getCause getCause Response status Status FORBIDDEN entity ue getCause getCause getMessage build LOG info ue ue LOG info ue ue
Response status Status FORBIDDEN entity ye getMessage build Token RMDelegationTokenIdentifier token extractToken hsr org apache hadoop yarn api records Token dToken BuilderUtils newDelegationToken token getIdentifier token getKind toString token getPassword token getService toString CancelDelegationTokenRequest req CancelDelegationTokenRequest newInstance dToken rm getClientRMService cancelDelegationToken req ue ue getCause ue getCause getCause BadRequestException ue getCause getCause getMessage ue getCause getCause org apache hadoop Response status Status FORBIDDEN entity ue getCause getCause getMessage build
Token RMDelegationTokenIdentifier token extractToken hsr org apache hadoop yarn api records Token dToken BuilderUtils newDelegationToken token getIdentifier token getKind toString token getPassword token getService toString CancelDelegationTokenRequest req CancelDelegationTokenRequest newInstance dToken rm getClientRMService cancelDelegationToken req ue ue getCause ue getCause getCause BadRequestException ue getCause getCause getMessage ue getCause getCause org apache hadoop Response status Status FORBIDDEN entity ue getCause getCause getMessage build LOG info ue
UserGroupInformation callerUGI getCallerUserGroupInformation hsr initForWritableEndpoints callerUGI ResourceScheduler scheduler rm getResourceScheduler scheduler MutableConfScheduler MutableConfScheduler scheduler MutableConfigurationProvider mutableConfigurationProvider MutableConfScheduler scheduler getMutableConfProvider mutableConfigurationProvider formatConfigurationInStore conf rm getRMContext getRMAdminService refreshQueues e LOG error e mutableConfigurationProvider revertToOldConfig conf e Response status Status OK entity build e
callerUGI MutableConfigurationProvider provider MutableConfScheduler scheduler getMutableConfProvider provider callerUGI mutationInfo org apache hadoop security AccessControlException LogMutation logMutation provider logAndApplyMutation callerUGI mutationInfo rm getRMContext getRMAdminService refreshQueues e provider confirmPendingMutation logMutation e provider confirmPendingMutation logMutation e
task SchedulerRequestKey schedulerKey task getSchedulerKey Map String ResourceRequest requests requests get schedulerKey requests requests HashMap String ResourceRequest requests put schedulerKey requests
LOG LOG debug applicationId ask size ask
Container Container i i Container container i next String host container getNodeId toString Resources container getResource Task t t Task task t next task task host NodeManager nodeManager getNodeManager host task start nodeManager container getId i remove Resources addTo used container getResource
ResourceRequest request request setNumContainers request getNumContainers ask remove request ask add ResourceRequest clone request
driver put testCapacityDRConf EnumSet of YarnServiceProtos SchedulerResourceTypes CPU YarnServiceProtos SchedulerResourceTypes MEMORY driver put testCapacityDefConf EnumSet of YarnServiceProtos SchedulerResourceTypes MEMORY driver put testFairDefConf EnumSet of YarnServiceProtos SchedulerResourceTypes MEMORY YarnServiceProtos SchedulerResourceTypes CPU EnumSet YarnServiceProtos SchedulerResourceTypes entry driver EnumSet YarnServiceProtos SchedulerResourceTypes expectedValue entry getValue MockRM rm MockRM entry getKey rm start MockNM nm1 rm registerNode DEFAULT_HOST DEFAULT_PORT GB RMApp app1 MockRMAppSubmitter submitWithMemory rm Thread sleep nm1 nodeHeartbeat RMAppAttempt attempt1 app1 getCurrentAppAttempt MockAM am1 rm sendAMLaunched attempt1 getAppAttemptId RegisterApplicationMasterResponse resp am1 registerAppAttempt EnumSet YarnServiceProtos SchedulerResourceTypes types resp getSchedulerResourceTypes
attempt drainEventsImplicitly timeWaiting timeWaiting List ContainerStatus containers attempt getJustFinishedContainers
nm nodeHeartbeat drainEventsImplicitly container getResourceScheduler getRMContainer containerId LOG info containerId containerState Thread sleep WAIT_MS_PER_LOOP timeWaiting WAIT_MS_PER_LOOP containerState container getState timeWaiting LOG info containerId container getState containerState nm nm nodeHeartbeat drainEventsImplicitly Thread sleep WAIT_MS_PER_LOOP timeWaiting WAIT_MS_PER_LOOP
rm tick rm drainEventsImplicitly rm tick Thread sleep tick
app rm rm drainEventsImplicitly RMAppAttempt attempt waitForAttemptScheduled app rm
app rm rm drainEventsImplicitly rm waitForState app getApplicationId RMAppState ACCEPTED RMAppAttempt attempt app getCurrentAppAttempt waitForSchedulerAppAttemptAdded attempt getAppAttemptId rm
RPCUtil getRemoteException e ContainerId containerID tokenId getContainerID ApplicationId applicationId containerID getApplicationAttemptId getApplicationId List Container applicationContainers containers get applicationId applicationContainers applicationContainers ArrayList Container containers put applicationId applicationContainers Container container applicationContainers container getId containerID IllegalStateException containerID containerManagerAddress Container container BuilderUtils newContainer containerID nodeId nodeHttpAddress tokenId getResource ContainerStatus containerStatus BuilderUtils newContainerStatus container getId ContainerState NEW container getResource applicationContainers add container containerStatusMap put container containerStatus Resources subtractFrom available tokenId getResource
heartbeat ioe RPCUtil getRemoteException ioe ctr Container container Container i i container i next container containerID i remove ctr ctr IllegalStateException containerID ctr Resources addTo available container getResource Resources subtractFrom used container getResource
waitCount waitCount
Container mockContainer mock Container NodeId mockNodeId mock NodeId String host when mockNodeId getHost thenReturn host when mockContainer getNodeId thenReturn mockNodeId when mockRMAppAttempt getMasterContainer thenReturn mockContainer when app getCurrentAppAttempt thenReturn mockRMAppAttempt Map String Long resourceSecondsMap HashMap resourceSecondsMap put ResourceInformation MEMORY_MB getName resourceSecondsMap put ResourceInformation VCORES getName RMAppMetrics metrics RMAppMetrics Resource newInstance resourceSecondsMap HashMap when app getRMAppMetrics thenReturn metrics when app getDiagnostics thenReturn StringBuilder RMAppManager ApplicationSummary SummaryBuilder summary RMAppManager ApplicationSummary createAppSummary app String msg summary toString
GetApplicationReportRequest appReportRequest recordFactory newRecordInstance GetApplicationReportRequest appReportRequest setApplicationId applicationId KillApplicationRequest finishAppRequest recordFactory newRecordInstance KillApplicationRequest finishAppRequest setApplicationId applicationId ApplicationClientProtocol enemyRmClient getRMClientForUser ENEMY ApplicationReport appReport enemyRmClient getApplicationReport appReportRequest getApplicationReport verifyEnemyAppReport appReport List ApplicationReport appReports enemyRmClient getApplications recordFactory newRecordInstance GetApplicationsRequest getApplicationList Assert assertEquals appReports size ApplicationReport report appReports verifyEnemyAppReport report enemyRmClient forceKillApplication finishAppRequest Assert fail
MockRM rm MockRM rm start MockNM nm1 rm registerNode RMApp app MockRMAppSubmitter submitWithMemory rm nm1 nodeHeartbeat RMAppAttempt attempt app getCurrentAppAttempt MockAM am rm sendAMLaunched attempt getAppAttemptId am registerAppAttempt request am allocate request ArrayList ContainerId nm1 nodeHeartbeat List Container conts am allocate ArrayList ResourceRequest ArrayList ContainerId getAllocatedContainers contReceived conts size waitCount contReceived request waitCount
Thread sleep conts am allocate ArrayList ResourceRequest ArrayList ContainerId getAllocatedContainers contReceived conts size nm1 nodeHeartbeat Assert assertEquals request contReceived am unregisterAppAttempt NodeHeartbeatResponse resp nm1 nodeHeartbeat attempt getAppAttemptId ContainerState COMPLETE rm waitForState am getApplicationAttemptId RMAppAttemptState FINISHED resp nm1 nodeHeartbeat List ContainerId containersToCleanup resp getContainersToCleanup List ApplicationId appsToCleanup resp getApplicationsToCleanup numCleanedContainers containersToCleanup size numCleanedApps appsToCleanup size waitCount numCleanedContainers numCleanedApps waitCount
rm start MockNM nm1 rm registerNode RMApp app MockRMAppSubmitter submitWithMemory rm nm1 nodeHeartbeat RMAppAttempt attempt app getCurrentAppAttempt MockAM am rm sendAMLaunched attempt getAppAttemptId am registerAppAttempt request am allocate request ArrayList ContainerId rm drainEvents nm1 nodeHeartbeat List Container conts am allocate ArrayList ResourceRequest ArrayList ContainerId getAllocatedContainers contReceived conts size waitCount contReceived request waitCount
rm nm resp waitCount cleanedConts List ContainerId contsToClean rm drainEvents contsToClean resp getContainersToCleanup cleanedConts contsToClean size cleanedConts Thread sleep resp nm nodeHeartbeat waitCount contsToClean LOG error
ClientRMService ClientRMService rmContext scheduler rmAppManager applicationACLsManager queueACLsManager getRMContext getRMDelegationTokenSecretManager rm start nodeMemory MockNM nm1 rm registerNode nodeMemory rm sendNodeStarted nm1 nm1 nodeHeartbeat rm waitForState nm1 getNodeId NodeState RUNNING Integer decommissioningTimeout rm sendNodeGracefulDecommission nm1 decommissioningTimeout rm waitForState nm1 getNodeId NodeState DECOMMISSIONING Configuration conf Configuration YarnRPC rpc YarnRPC create conf InetSocketAddress rmAddress rm getClientRMService getBindAddress
rm start NodeLabel labelX NodeLabel newInstance NodeLabel labelY NodeLabel newInstance RMNodeLabelsManager labelsMgr rm getRMContext getNodeLabelManager labelsMgr addToCluserNodeLabels ImmutableSet of labelX labelY NodeId node1 NodeId newInstance NodeId node2 NodeId newInstance Map NodeId Set String map HashMap NodeId Set String map put node1 ImmutableSet of map put node2 ImmutableSet of labelsMgr replaceLabelsOnNode map Configuration conf Configuration YarnRPC rpc YarnRPC create conf InetSocketAddress rmAddress rm getClientRMService getBindAddress
rm start NodeAttributesManager mgr rm getRMContext getNodeAttributesManager NodeId host1 NodeId newInstance NodeId host2 NodeId newInstance NodeAttribute gpu NodeAttribute newInstance NodeAttribute PREFIX_CENTRALIZED NodeAttributeType STRING NodeAttribute os NodeAttribute newInstance NodeAttribute PREFIX_CENTRALIZED NodeAttributeType STRING NodeAttribute docker NodeAttribute newInstance NodeAttribute PREFIX_DISTRIBUTED NodeAttributeType STRING Map String Set NodeAttribute nodes HashMap nodes put host1 getHost ImmutableSet of gpu os nodes put host2 getHost ImmutableSet of docker mgr addNodeAttributes nodes Configuration conf Configuration YarnRPC rpc YarnRPC create conf InetSocketAddress rmAddress rm getClientRMService getBindAddress
yarnConf setClass CapacitySchedulerConfiguration RESOURCE_CALCULATOR_CLASS DominantResourceCalculator ResourceCalculator rm yarnConf ClientRMService ClientRMService rmContext scheduler rmAppManager applicationACLsManager queueACLsManager getRMContext getRMDelegationTokenSecretManager rm start Resource resource BuilderUtils newResource resource setResourceInformation ResourceInformation newInstance resource setResourceInformation ResourceInformation newInstance resource setResourceInformation ResourceInformation newInstance MockNM node rm registerNode resource node nodeHeartbeat Configuration conf Configuration YarnRPC rpc YarnRPC create conf InetSocketAddress rmAddress rm getClientRMService getBindAddress
YarnConfiguration conf YarnConfiguration conf set YarnConfiguration RM_PRINCIPAL conf set CommonConfigurationKeysPublic HADOOP_SECURITY_AUTHENTICATION UserGroupInformation setConfiguration conf ResourceScheduler scheduler createMockScheduler conf initialInterval maxLifetime renewInterval RMDelegationTokenSecretManager rmDtSecretManager createRMDelegationTokenSecretManager initialInterval maxLifetime renewInterval rmDtSecretManager startThreads
maxLifetime renewInterval RMDelegationTokenSecretManager rmDtSecretManager createRMDelegationTokenSecretManager initialInterval maxLifetime renewInterval rmDtSecretManager startThreads LOG info initialInterval maxLifetime renewInterval ClientRMService clientRMService ClientRMServiceForTest conf scheduler rmDtSecretManager clientRMService init conf clientRMService start ApplicationClientProtocol clientRMWithDT UserGroupInformation loggedInUser UserGroupInformation createRemoteUser Assert assertEquals loggedInUser getShortUserName loggedInUser setAuthenticationMethod AuthenticationMethod KERBEROS org apache hadoop yarn api records Token token getDelegationToken loggedInUser clientRMService loggedInUser getShortUserName tokenFetchTime System currentTimeMillis
org apache hadoop yarn api records Token token getDelegationToken loggedInUser clientRMService loggedInUser getShortUserName tokenFetchTime System currentTimeMillis LOG info tokenFetchTime clientRMWithDT getClientRMProtocolWithDT token clientRMService getBindAddress conf GetNewApplicationRequest request Records newRecord GetNewApplicationRequest clientRMWithDT getNewApplication request e fail e e fail e System currentTimeMillis tokenFetchTime Thread sleep nextExpTime renewDelegationToken loggedInUser clientRMService token renewalTime System currentTimeMillis
System currentTimeMillis Thread sleep nextExpTime renewDelegationToken loggedInUser clientRMService token renewalTime System currentTimeMillis LOG info renewalTime nextExpTime System currentTimeMillis System currentTimeMillis nextExpTime Thread sleep Thread sleep clientRMWithDT getNewApplication request e fail e e fail e System currentTimeMillis renewalTime
clientRMWithDT getNewApplication request fail e assertEquals InvalidToken getName e getClass getName assertTrue e getMessage contains clientRMWithDT RPC stopProxy clientRMWithDT clientRMWithDT token getDelegationToken loggedInUser clientRMService loggedInUser getShortUserName tokenFetchTime System currentTimeMillis LOG info tokenFetchTime clientRMWithDT getClientRMProtocolWithDT token clientRMService getBindAddress conf request Records newRecord GetNewApplicationRequest clientRMWithDT getNewApplication request
MockNM nm1 rm registerNode MockNM nm2 rm registerNode RMApp app MockRMAppSubmitter submitWithMemory rm nm1 nodeHeartbeat RMAppAttempt attempt app getCurrentAppAttempt MockAM am rm sendAMLaunched attempt getAppAttemptId am registerAppAttempt request am allocate request ArrayList ContainerId List Container conts am allocate ArrayList ResourceRequest ArrayList ContainerId getAllocatedContainers contReceived conts size contReceived nm1 nodeHeartbeat conts addAll am allocate ArrayList ResourceRequest ArrayList ContainerId getAllocatedContainers contReceived conts size
List Container conts am allocate ArrayList ResourceRequest ArrayList ContainerId getAllocatedContainers contReceived conts size contReceived nm1 nodeHeartbeat conts addAll am allocate ArrayList ResourceRequest ArrayList ContainerId getAllocatedContainers contReceived conts size LOG info contReceived Thread sleep WAIT_SLEEP_MS Assert assertEquals conts size conts am allocate ArrayList ResourceRequest ArrayList ContainerId getAllocatedContainers contReceived conts size contReceived nm2 nodeHeartbeat conts addAll am allocate ArrayList ResourceRequest ArrayList ContainerId getAllocatedContainers contReceived conts size
allocateContainersAndValidateNMTokens am containersReceivedForNM1 nmTokens nm1 Assert assertEquals nmTokens size MockNM nm2 rm registerNode nm2 nodeHeartbeat ArrayList Container containersReceivedForNM2 ArrayList Container response am allocate releaseContainerList Assert assertEquals response getAllocatedContainers size allocateContainersAndValidateNMTokens am containersReceivedForNM2 nmTokens nm2 Assert assertEquals nmTokens size nm2 rm registerNode Map NodeId RMNode nodes rm getRMContext getRMNodes nodes nm2 Thread sleep WAIT_SLEEP_MS interval nm2 interval
conf setInt YarnConfiguration RM_AM_MAX_ATTEMPTS count count
startRMs addNodeCapacityToPlan rm1 explicitFailover addNodeCapacityToPlan rm2 ClientRMService clientService rm2 getClientRMService ReservationId reservationID getNewReservation clientService getReservationId ReservationSubmissionRequest request createReservationSubmissionRequest reservationID ReservationSubmissionResponse response response clientService submitReservation request e Assert fail e getMessage Assert assertNotNull response Assert assertNotNull reservationID
response clientService submitReservation request e Assert fail e getMessage Assert assertNotNull response Assert assertNotNull resID1 LOG info resID1 ReservationId resID2 getNewReservation clientService getReservationId request setReservationId resID2 response clientService submitReservation request e Assert fail e getMessage Assert assertNotNull response Assert assertNotNull resID2
ReservationId resID2 getNewReservation clientService getReservationId request setReservationId resID2 response clientService submitReservation request e Assert fail e getMessage Assert assertNotNull response Assert assertNotNull resID2 LOG info resID2 ReservationId resID3 getNewReservation clientService getReservationId request setReservationId resID3 response clientService submitReservation request e Assert fail e getMessage
rm getResourceScheduler FairScheduler fs FairScheduler rm getResourceScheduler rm start MockNM nm1 rm registerNode RMApp app MockRMAppSubmitter submitWithMemory rm nm1 nodeHeartbeat RMAppAttempt attempt app getCurrentAppAttempt MockAM am rm sendAMLaunched attempt getAppAttemptId am registerAppAttempt request am allocate request ArrayList ContainerId nm1 nodeHeartbeat List Container conts ArrayList request waitCount conts request waitCount
waitCount conts size request waitCount LOG info conts size request Thread sleep List Container allocation am allocate ArrayList ResourceRequest ArrayList ContainerId getAllocatedContainers conts addAll allocation nm1 nodeHeartbeat Assert assertEquals request conts size Container container conts rm signalToContainer container getId SignalContainerCommand OUTPUT_THREAD_DUMP NodeHeartbeatResponse resp List SignalContainerRequest contsToSignal signaledConts waitCount
invocation cId compareTo RMContainer invocation getArguments getContainerId when rmc compareTo RMContainer when rmc isAMContainer thenReturn when app getAMResource label thenReturn res when app getAppAMNodePartitionName thenReturn label reserved reservedContainers add rmc when rmc getReservedResource thenReturn res liveContainers add rmc addContainerToSchedulerNode host rmc reserved String partition
HashMap String HashMap String HashMap String ResourceUsage userResourceUsagePerLabel HashMap LeafQueue queue mulp String a split String strs a split String queueName strs mulp strs strs mulp Integer strs intValue List RMContainer liveContainers ArrayList RMContainer List RMContainer reservedContainers ArrayList RMContainer ApplicationId appId ApplicationId newInstance id ApplicationAttemptId appAttemptId ApplicationAttemptId newInstance appId FiCaSchedulerApp app mock FiCaSchedulerApp when app getAMResource anyString thenReturn Resources createResource mockContainers strs app appAttemptId queueName reservedContainers liveContainers
userResourceUsage put app getUser usage usage incAMUsed app getAMResource label usage incUsed app getAppAttemptResourceUsage getUsed label id String label String queueName userMap queue LeafQueue nameToCSQueues get queueName Resource totResoucePerPartition partitionToResource get Resource capacity Resources multiply totResoucePerPartition queue getQueueCapacities getAbsoluteCapacity HashSet String users userMap get queue getQueueName users users userMap get queue getQueuePath when queue getAllUsers thenReturn users Resource userLimit
FiCaSchedulerNode sn mock FiCaSchedulerNode when sn getNodeID thenReturn nodeId when sn getPartition thenReturn partition Resource totalRes Resources createResource arr length String res arr res String resSring res substring res indexOf length totalRes parseResourceFromString resSring when sn getTotalResource thenReturn totalRes when sn getUnallocatedResource thenReturn Resources clone totalRes when sn getTotalKillableResources thenReturn Resources none List RMContainer liveContainers ArrayList when sn getCopiedListOfRunningContainers thenReturn liveContainers nodeIdToSchedulerNodes put nodeId sn
String nodeLabelsConfigStr String partitionConfigArr nodeLabelsConfigStr split clusterResource Resources createResource String p partitionConfigArr String partitionName p substring p indexOf Resource res parseResourceFromString p substring p indexOf p indexOf exclusivity Boolean valueOf p substring p indexOf p length when nlm getResourceByLabel eq partitionName any Resource thenReturn res when nlm isExclusiveNodeLabel eq partitionName thenReturn exclusivity partitionToResource put partitionName res
queuePath ROOT String queueName getQueueName q when queue getQueueName thenReturn queueName ParentQueue parentQueue getParentQueue queueExprArray idx myLevel parentQueue when queue getParent thenReturn parentQueue parentQueue getChildQueues add queue queuePath parentQueue getQueuePath queueName when queue getQueuePath thenReturn queuePath QueueCapacities qc QueueCapacities myLevel ResourceUsage ru ResourceUsage QueueResourceQuotas qr QueueResourceQuotas when queue getQueueCapacities thenReturn qc when queue getQueueResourceUsage thenReturn ru when queue getQueueResourceQuotas thenReturn qr
qr setEffectiveMaxResource parseResourceFromString values trim qr setEffectiveMinResource parseResourceFromString values trim qr setEffectiveMaxResource partitionName parseResourceFromString values trim qr setEffectiveMinResource partitionName parseResourceFromString values trim when queue getUsedCapacity thenReturn used when queue getEffectiveCapacity partitionName thenReturn parseResourceFromString values trim when queue getEffectiveMaxCapacity partitionName thenReturn parseResourceFromString values trim ru setPending partitionName pending Resource reserved Resources none values reserved parseResourceFromString values trim ru setReserved partitionName reserved LeafQueue lq LeafQueue queue when lq getTotalPendingResourcesConsideringUserLimit isA Resource isA String eq thenReturn pending
alloc timeSteps RLESparseResourceAllocation rleSparseVector ReservationSystemTestUtil generateRLESparseResourceAllocation alloc timeSteps PeriodicRLESparseResourceAllocation periodicVector PeriodicRLESparseResourceAllocation rleSparseVector
alloc timeSteps RLESparseResourceAllocation rleSparseVector ReservationSystemTestUtil generateRLESparseResourceAllocation alloc timeSteps PeriodicRLESparseResourceAllocation periodicVector PeriodicRLESparseResourceAllocation rleSparseVector
ResourceCalculator resCalc DefaultResourceCalculator RLESparseResourceAllocation rleSparseVector RLESparseResourceAllocation resCalc ReservationInterval riAdd ReservationInterval Resource rr Resource newInstance ReservationInterval riAdd2 ReservationInterval Resource rr2 Resource newInstance ReservationInterval riRemove ReservationInterval
ResourceCalculator resCalc DefaultResourceCalculator RLESparseResourceAllocation rleSparseVector RLESparseResourceAllocation resCalc ReservationInterval riAdd ReservationInterval Resource rr Resource newInstance ReservationInterval riAdd2 ReservationInterval Resource rr2 Resource newInstance ReservationInterval riRemove ReservationInterval LOG info rleSparseVector toString rleSparseVector addInterval riAdd rr rleSparseVector addInterval riAdd2 rr2
ResourceCalculator resCalc DefaultResourceCalculator RLESparseResourceAllocation rleSparseVector RLESparseResourceAllocation resCalc ReservationInterval riAdd ReservationInterval Resource rr Resource newInstance ReservationInterval riAdd2 ReservationInterval Resource rr2 Resource newInstance ReservationInterval riRemove ReservationInterval LOG info rleSparseVector toString rleSparseVector addInterval riAdd rr rleSparseVector addInterval riAdd2 rr2 LOG info rleSparseVector toString rleSparseVector removeInterval riRemove rr
Resource rr2 Resource newInstance ReservationInterval riRemove ReservationInterval LOG info rleSparseVector toString rleSparseVector addInterval riAdd rr rleSparseVector addInterval riAdd2 rr2 LOG info rleSparseVector toString rleSparseVector removeInterval riRemove rr LOG info rleSparseVector toString Assert assertEquals rleSparseVector getCapacityAtTime getMemorySize Assert assertEquals rleSparseVector getCapacityAtTime getMemorySize Assert assertEquals rleSparseVector getCapacityAtTime getMemorySize Assert assertEquals rleSparseVector getCapacityAtTime getMemorySize Assert assertEquals rleSparseVector getCapacityAtTime getMemorySize ReservationInterval riRemove2 ReservationInterval rleSparseVector removeInterval riRemove2 rr
ResourceCalculator resCalc DefaultResourceCalculator RLESparseResourceAllocation rleSparseVector RLESparseResourceAllocation resCalc rleSparseVector addInterval ReservationInterval Long MAX_VALUE Resource newInstance
timeSteps alloc RLESparseResourceAllocation rleSparseVector ReservationSystemTestUtil generateRLESparseResourceAllocation alloc timeSteps
timeSteps alloc RLESparseResourceAllocation rleSparseVector ReservationSystemTestUtil generateRLESparseResourceAllocation alloc timeSteps
Assert fail e Assert assertNull plan String message e getMessage Assert assertTrue message startsWith LOG info message request createSimpleReservationSubmissionRequest plan plan rrValidator validateReservationSubmissionRequest rSystem request ReservationSystemTestUtil getNewReservationId Assert fail e Assert assertNull plan String message e getMessage Assert assertTrue message startsWith
Assert fail e Assert assertNull plan String message e getMessage Assert assertTrue message startsWith LOG info message request createSimpleReservationUpdateRequest plan plan rrValidator validateReservationUpdateRequest rSystem request Assert fail e Assert assertNull plan String message e getMessage Assert assertTrue message startsWith
seed rand nextLong rand setSeed seed
seed rand nextLong rand setSeed seed
seed rand nextLong rand setSeed seed
source String queueName QueueMetrics source queueName Map String QueueMetrics users QueueMetrics source users
source String queueName QueueMetrics source queueName Map String QueueMetrics users QueueMetrics source users
waitCount waitCount
YarnConfiguration conf YarnConfiguration CapacitySchedulerContext csContext mock CapacitySchedulerContext when csContext getConfiguration thenReturn csConf when csContext getConf thenReturn conf when csContext getMinimumResourceCapability thenReturn Resources createResource GB when csContext getMaximumResourceCapability thenReturn Resources createResource GB when csContext getResourceCalculator thenReturn resourceCalculator when csContext getRMContext thenReturn rmContext when csContext getPreemptionManager thenReturn PreemptionManager Resource clusterResource Resources createResource GB when csContext getClusterResource thenReturn clusterResource CSQueueStore queues CSQueueStore CSQueue root CapacitySchedulerQueueManager parseQueue csContext csConf queues queues TestUtils spyHook root updateClusterResource clusterResource ResourceLimits clusterResource LeafQueue queue LeafQueue queues get A
nodeUpdate nm_0 nodeUpdate nm_1 application_0 schedule checkApplicationResourceUsage GB application_0 application_1 schedule checkApplicationResourceUsage GB application_1 checkNodeResourceUsage GB nm_0 checkNodeResourceUsage GB nm_1 LOG info Task task_1_1 Task application_1 priority_0 String ResourceRequest ANY application_1 addTask task_1_1 application_1 schedule Task task_0_1 Task application_0 priority_0 String host_0 host_1 application_0 addTask task_0_1 application_0 schedule
application_0 schedule checkApplicationResourceUsage GB application_0 application_1 schedule checkApplicationResourceUsage GB application_1 checkNodeResourceUsage GB nm_0 checkNodeResourceUsage GB nm_1 LOG info Task task_1_1 Task application_1 priority_0 String ResourceRequest ANY application_1 addTask task_1_1 application_1 schedule Task task_0_1 Task application_0 priority_0 String host_0 host_1 application_0 addTask task_0_1 application_0 schedule LOG info nm_0 getHostName nodeUpdate nm_0
conf setClass YarnConfiguration RM_SCHEDULER CapacityScheduler ResourceScheduler MyContainerManager containerManager MyContainerManager MockRMWithAMS rm MockRMWithAMS conf containerManager rm start MockNM nm1 rm registerNode Map ApplicationAccessType String acls HashMap ApplicationAccessType String acls put ApplicationAccessType VIEW_APP MockRMAppSubmissionData data MockRMAppSubmissionData Builder createWithMemory rm withAppName withUser withAcls acls build RMApp app MockRMAppSubmitter submit rm data nm1 nodeHeartbeat RMAppAttempt attempt app getCurrentAppAttempt ApplicationAttemptId applicationAttemptId attempt getAppAttemptId msecToWait msecToSleep attempt msecToWait
String b1QTobeDeleted LeafQueue csB1Queue Mockito spy LeafQueue queues get b1QTobeDeleted when csB1Queue getState thenReturn QueueState DRAINING thenReturn QueueState STOPPED cs getCapacitySchedulerQueueManager addQueue b1QTobeDeleted csB1Queue conf CapacitySchedulerConfiguration setupQueueConfigurationWithOutB1 conf cs reinitialize conf mockContext fail conf CapacitySchedulerConfiguration setupQueueConfigurationWithOutB1 conf cs reinitialize conf mockContext
conf setQueues AGROUP String conf setCapacity AGROUP_A conf setUserLimitFactor AGROUP_A conf setUserLimitFactor C conf setAutoCreateChildQueueEnabled C conf setAutoCreatedLeafQueueConfigCapacity C conf setAutoCreatedLeafQueueConfigMaxCapacity C conf setAutoCreatedLeafQueueConfigUserLimit C conf setAutoCreatedLeafQueueConfigUserLimitFactor C conf setAutoCreatedLeafQueueTemplateCapacityByLabel C NODEL_LABEL_GPU NODE_LABEL_GPU_TEMPLATE_CAPACITY conf setAutoCreatedLeafQueueTemplateMaxCapacity C NODEL_LABEL_GPU conf setAutoCreatedLeafQueueTemplateCapacityByLabel C NODEL_LABEL_SSD NODEL_LABEL_SSD_TEMPLATE_CAPACITY conf setAutoCreatedLeafQueueTemplateMaxCapacity C NODEL_LABEL_SSD conf setDefaultNodeLabelExpression C NODEL_LABEL_GPU conf setAutoCreatedLeafQueueConfigDefaultNodeLabelExpression C NODEL_LABEL_SSD
conf setAutoCreatedLeafQueueConfigCapacity D conf setAutoCreatedLeafQueueConfigMaxCapacity D conf setAutoCreatedLeafQueueConfigUserLimit D conf setAutoCreatedLeafQueueConfigUserLimitFactor D conf set CapacitySchedulerConfiguration PREFIX C DOT CapacitySchedulerConfiguration AUTO_CREATED_LEAF_QUEUE_TEMPLATE_PREFIX DOT CapacitySchedulerConfiguration ORDERING_POLICY FAIR_APP_ORDERING_POLICY accessibleNodeLabelsOnC add NODEL_LABEL_GPU accessibleNodeLabelsOnC add NODEL_LABEL_SSD accessibleNodeLabelsOnC add NO_LABEL conf setAccessibleNodeLabels C accessibleNodeLabelsOnC conf setAccessibleNodeLabels ROOT accessibleNodeLabelsOnC conf setCapacityByLabel ROOT NODEL_LABEL_GPU conf setCapacityByLabel ROOT NODEL_LABEL_SSD conf setAccessibleNodeLabels C accessibleNodeLabelsOnC conf setCapacityByLabel C NODEL_LABEL_GPU conf setCapacityByLabel C NODEL_LABEL_SSD
parentQueue String leafQueueName Map String QueueEntitlement expectedEntitlement QueueEntitlement ManagedParentQueue autoCreateEnabledParentQueue ManagedParentQueue parentQueue AutoCreatedLeafQueue leafQueue AutoCreatedLeafQueue cs getQueue leafQueueName GuaranteedOrZeroCapacityOverTimePolicy policy GuaranteedOrZeroCapacityOverTimePolicy autoCreateEnabledParentQueue getAutoCreatedQueueManagementPolicy Map String QueueEntitlement expectedEntitlements HashMap String
SuppressWarnings MockRM rm MockRM conf rm start MockNM nm1 rm registerNode GB MockNM nm2 rm registerNode GB nm1 nodeHeartbeat nm2 nodeHeartbeat waitCount size rm getRMContext getRMNodes size size rm getRMContext getRMNodes size waitCount
Resource clusterResource Resources createResource numNodes GB numNodes when csContext getNumClusterNodes thenReturn numNodes when csContext getClusterResource thenReturn clusterResource root updateClusterResource clusterResource ResourceLimits clusterResource Priority priority TestUtils createMockPriority app0 updateResourceRequests Collections singletonList TestUtils createResourceRequest ResourceRequest ANY GB priority recordFactory NO_LABEL app2 updateResourceRequests Collections singletonList TestUtils createResourceRequest ResourceRequest ANY GB priority recordFactory NO_LABEL b setUserLimit b setUserLimitFactor User queueUser0 b getUser user0 User queueUser1 b getUser user1 assertEquals b getAbstractUsersManager getNumActiveUsers CSAssignment assign assign b assignContainers clusterResource node0 ResourceLimits clusterResource SchedulingMode RESPECT_PARTITION_EXCLUSIVITY
FiCaSchedulerNode host rack port memory vcores NodeId nodeId NodeId newInstance host port RMNode rmNode mock RMNode when rmNode getNodeID thenReturn nodeId when rmNode getTotalCapability thenReturn Resources createResource memory vcores when rmNode getNodeAddress thenReturn host port when rmNode getHostName thenReturn host when rmNode getRackName thenReturn rack when rmNode getState thenReturn NodeState RUNNING FiCaSchedulerNode node spy FiCaSchedulerNode rmNode
atm nm Map String Long nmTags atm getAllocationTagsWithCount nm getNodeId StringBuffer sb StringBuffer nmTags nmTags forEach tag count sb append tag count
List ResourceRequest reqs Arrays asList createResourceRequest ResourceRequest ANY createResourceRequest ResourceRequest ANY createResourceRequest ResourceRequest ANY ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance allocator setNodeQueueLoadMonitor createNodeQueueLoadMonitor List Container containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST reqs appAttId oppCntxt
List ResourceRequest reqs Arrays asList createResourceRequest ResourceRequest ANY createResourceRequest createResourceRequest createResourceRequest ResourceRequest ANY createResourceRequest createResourceRequest createResourceRequest ResourceRequest ANY ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance allocator setNodeQueueLoadMonitor createNodeQueueLoadMonitor List Container containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST reqs appAttId oppCntxt
List ResourceRequest reqs Arrays asList createResourceRequest createResourceRequest createResourceRequest ResourceRequest ANY ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance allocator setNodeQueueLoadMonitor createNodeQueueLoadMonitor List Container containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST reqs appAttId oppCntxt
List ResourceRequest reqs Arrays asList createResourceRequest createResourceRequest createResourceRequest ResourceRequest ANY ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance NodeQueueLoadMonitor selector createNodeQueueLoadMonitor Arrays asList Arrays asList Arrays asList Arrays asList allocator setNodeQueueLoadMonitor selector List Container containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST reqs appAttId oppCntxt
allocator setMaxAllocationsPerAMHeartbeat List ResourceRequest reqs Arrays asList createResourceRequest createResourceRequest createResourceRequest ResourceRequest ANY ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance allocator setNodeQueueLoadMonitor createNodeQueueLoadMonitor List Container containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST reqs appAttId oppCntxt
allocator setMaxAllocationsPerAMHeartbeat List ResourceRequest reqs Arrays asList createResourceRequest createResourceRequest createResourceRequest ResourceRequest ANY ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance allocator setNodeQueueLoadMonitor createNodeQueueLoadMonitor List Container containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST reqs appAttId oppCntxt LOG info containers assertEquals containers size containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST ArrayList appAttId oppCntxt
allocator setMaxAllocationsPerAMHeartbeat List ResourceRequest reqs Arrays asList createResourceRequest ResourceRequest ANY createResourceRequest createResourceRequest ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance allocator setNodeQueueLoadMonitor createNodeQueueLoadMonitor List Container containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST reqs appAttId oppCntxt
allocator setMaxAllocationsPerAMHeartbeat List ResourceRequest reqs Arrays asList createResourceRequest ResourceRequest ANY createResourceRequest createResourceRequest ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance allocator setNodeQueueLoadMonitor createNodeQueueLoadMonitor List Container containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST reqs appAttId oppCntxt LOG info containers assertEquals containers size containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST ArrayList appAttId oppCntxt
allocator setMaxAllocationsPerAMHeartbeat List ResourceRequest reqs Arrays asList createResourceRequest ResourceRequest ANY createResourceRequest createResourceRequest ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance allocator setNodeQueueLoadMonitor createNodeQueueLoadMonitor List Container containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST reqs appAttId oppCntxt LOG info containers assertEquals containers size containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST ArrayList appAttId oppCntxt LOG info containers assertEquals containers size containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST ArrayList appAttId oppCntxt
oppCntxt spy oppCntxt OpportunisticSchedulerMetrics metrics mock OpportunisticSchedulerMetrics when oppCntxt getOppSchedulerMetrics thenReturn metrics List ResourceRequest reqs Arrays asList createResourceRequest createResourceRequest createResourceRequest ResourceRequest ANY ApplicationAttemptId appAttId ApplicationAttemptId newInstance ApplicationId newInstance allocator setNodeQueueLoadMonitor createNodeQueueLoadMonitor List Container containers allocator allocateContainers EMPTY_BLACKLIST_REQUEST reqs appAttId oppCntxt
setupFSConfigConversionFiles ArgumentCaptor FSConfigToCSConfigConverterParams conversionParams ArgumentCaptor forClass FSConfigToCSConfigConverterParams FSConfigToCSConfigArgumentHandler argumentHandler createArgumentHandler String args getArgumentsAsArrayWithDefaults FSConfigConverterTestCommons FS_ALLOC_FILE FSConfigConverterTestCommons CONVERSION_RULES_FILE argumentHandler parseAndConvert args verify mockConverter convert conversionParams capture FSConfigToCSConfigConverterParams params conversionParams getValue
setupFSConfigConversionFiles ArgumentCaptor FSConfigToCSConfigConverterParams conversionParams ArgumentCaptor forClass FSConfigToCSConfigConverterParams FSConfigToCSConfigArgumentHandler argumentHandler createArgumentHandler String args getArgumentsAsArrayWithDefaults FSConfigConverterTestCommons FS_ALLOC_FILE FSConfigConverterTestCommons CONVERSION_RULES_FILE argumentHandler parseAndConvert args verify mockConverter convert conversionParams capture FSConfigToCSConfigConverterParams params conversionParams getValue
setupFSConfigConversionFiles ArgumentCaptor FSConfigToCSConfigConverterParams conversionParams ArgumentCaptor forClass FSConfigToCSConfigConverterParams FSConfigToCSConfigArgumentHandler argumentHandler createArgumentHandler String args getArgumentsAsArrayWithDefaults FSConfigConverterTestCommons FS_ALLOC_FILE FSConfigConverterTestCommons CONVERSION_RULES_FILE argumentHandler parseAndConvert args verify mockConverter convert conversionParams capture FSConfigToCSConfigConverterParams params conversionParams getValue
Assert assertEquals nm1 getNodeId allocated1 get getNodeId report_nm1 rm getResourceScheduler getNodeReport nm1 getNodeId Assert assertEquals report_nm1 getAvailableResource getMemorySize Assert assertEquals GB report_nm1 getUsedResource getMemorySize Container c1 allocated1 get Assert assertEquals GB c1 getResource getMemorySize Map NodeId ResourceOption nodeResourceMap HashMap NodeId ResourceOption nodeResourceMap put nm1 getNodeId ResourceOption newInstance Resource newInstance GB UpdateNodeResourceRequest request UpdateNodeResourceRequest newInstance nodeResourceMap rm getAdminService updateNodeResource request waitCount waitCount report_nm1 rm getResourceScheduler getNodeReport nm1 getNodeId report_nm1 report_nm1 getAvailableResource getMemorySize
UpdateNodeResourceRequest request UpdateNodeResourceRequest newInstance nodeResourceMap rm getAdminService updateNodeResource request waitCount waitCount report_nm1 rm getResourceScheduler getNodeReport nm1 getNodeId report_nm1 report_nm1 getAvailableResource getMemorySize LOG info waitCount Thread sleep report_nm1 rm getResourceScheduler getNodeReport nm1 getNodeId Assert assertEquals GB report_nm1 getUsedResource getMemorySize Assert assertEquals GB report_nm1 getAvailableResource getMemorySize ContainerStatus containerStatus BuilderUtils newContainerStatus c1 getId ContainerState COMPLETE c1 getResource nm1 containerStatus containerStatus waitCount
MyFS dfs MyFS FileSystem get conf
MyFS dfs MyFS FileSystem get conf LOG info Object dfs hashCode conf hashCode MyToken token1 token2 token3 token1 dfs getDelegationToken token2 dfs getDelegationToken token3 dfs getDelegationToken Renewer tokenToRenewIn2Sec token1
delegationTokenRenewer addApplicationAsync applicationId_0 ts Configuration waitForEventsToGetProcessed delegationTokenRenewer numberOfExpectedRenewals attempts attempts Thread sleep Renewer counter numberOfExpectedRenewals LOG info dfs hashCode Renewer counter Renewer lastRenewed assertEquals numberOfExpectedRenewals Renewer counter assertEquals Renewer lastRenewed token1 ts Credentials MyToken token4 dfs getDelegationToken Renewer tokenToRenewIn2Sec token4
assertEquals numberOfExpectedRenewals Renewer counter assertEquals Renewer lastRenewed token1 ts Credentials MyToken token4 dfs getDelegationToken Renewer tokenToRenewIn2Sec token4 LOG info token4 String nn4 DelegationTokenRenewer SCHEME ts addToken Text nn4 token4 ApplicationId applicationId_1 BuilderUtils newApplicationId delegationTokenRenewer addApplicationAsync applicationId_1 ts Configuration waitForEventsToGetProcessed delegationTokenRenewer delegationTokenRenewer applicationFinished applicationId_1 waitForEventsToGetProcessed delegationTokenRenewer numberOfExpectedRenewals Renewer counter
MyFS dfs MyFS FileSystem get conf
MyFS dfs MyFS FileSystem get conf
MyFS dfs MyFS FileSystem get conf
MyFS dfs MyFS FileSystem get conf LOG info Object dfs hashCode conf hashCode Credentials ts Credentials MyToken token1 dfs getDelegationToken Renewer tokenToRenewIn2Sec token1
lconf setBoolean YarnConfiguration RM_DELEGATION_TOKEN_ALWAYS_CANCEL DelegationTokenRenewer localDtr createNewDelegationTokenRenewer lconf counter RMContext mockContext mock RMContext when mockContext getSystemCredentialsForApps thenReturn ConcurrentHashMap ApplicationId SystemCredentialsForAppsProto ClientRMService mockClientRMService mock ClientRMService when mockContext getClientRMService thenReturn mockClientRMService when mockContext getDelegationTokenRenewer thenReturn localDtr when mockContext getDispatcher thenReturn dispatcher InetSocketAddress sockAddr InetSocketAddress createUnresolved when mockClientRMService getBindAddress thenReturn sockAddr localDtr setDelegationTokenRenewerPoolTracker localDtr setRMContext mockContext localDtr init lconf localDtr start MyFS dfs MyFS FileSystem get lconf
ClientRMService mockClientRMService mock ClientRMService when mockContext getClientRMService thenReturn mockClientRMService when mockContext getDelegationTokenRenewer thenReturn localDtr when mockContext getDispatcher thenReturn dispatcher InetSocketAddress sockAddr InetSocketAddress createUnresolved when mockClientRMService getBindAddress thenReturn sockAddr localDtr setDelegationTokenRenewerPoolTracker localDtr setRMContext mockContext localDtr init lconf localDtr start MyFS dfs MyFS FileSystem get lconf LOG info Object dfs hashCode lconf hashCode Credentials ts Credentials MyToken token1 dfs getDelegationToken Renewer tokenToRenewIn2Sec token1
lconf setLong YarnConfiguration RM_DELAYED_DELEGATION_TOKEN_REMOVAL_INTERVAL_MS DelegationTokenRenewer localDtr createNewDelegationTokenRenewer lconf counter RMContext mockContext mock RMContext when mockContext getSystemCredentialsForApps thenReturn ConcurrentHashMap ApplicationId SystemCredentialsForAppsProto ClientRMService mockClientRMService mock ClientRMService when mockContext getClientRMService thenReturn mockClientRMService when mockContext getDelegationTokenRenewer thenReturn localDtr when mockContext getDispatcher thenReturn dispatcher InetSocketAddress sockAddr InetSocketAddress createUnresolved when mockClientRMService getBindAddress thenReturn sockAddr localDtr setDelegationTokenRenewerPoolTracker localDtr setRMContext mockContext localDtr init lconf localDtr start MyFS dfs MyFS FileSystem get lconf
lconf setLong YarnConfiguration RM_DELAYED_DELEGATION_TOKEN_REMOVAL_INTERVAL_MS DelegationTokenRenewer localDtr createNewDelegationTokenRenewer conf counter RMContext mockContext mock RMContext when mockContext getSystemCredentialsForApps thenReturn ConcurrentHashMap ApplicationId SystemCredentialsForAppsProto ClientRMService mockClientRMService mock ClientRMService when mockContext getClientRMService thenReturn mockClientRMService when mockContext getDelegationTokenRenewer thenReturn localDtr when mockContext getDispatcher thenReturn dispatcher InetSocketAddress sockAddr InetSocketAddress createUnresolved when mockClientRMService getBindAddress thenReturn sockAddr localDtr setDelegationTokenRenewerPoolTracker localDtr setRMContext mockContext localDtr init lconf localDtr start MyFS dfs MyFS FileSystem get lconf
config renewerCounter pool TimeUnit submit r renewerCounter incrementAndGet submit r pool renewToken dttr Thread sleep config getTimeDuration YarnConfiguration RM_DT_RENEWER_THREAD_TIMEOUT YarnConfiguration DEFAULT_RM_DT_RENEWER_THREAD_TIMEOUT TimeUnit MILLISECONDS renewToken dttr
JSONObject json assertEquals json json length JSONObject info json getJSONObject assertEquals info info length info info getJSONObject
WebResource r resource ClientResponse response SchedConfUpdateInfo updateInfo SchedConfUpdateInfo Map String String updateParam HashMap updateParam put CapacitySchedulerConfiguration MAXIMUM_AM_RESOURCE_SUFFIX QueueConfigInfo aUpdateInfo QueueConfigInfo updateParam updateInfo getUpdateQueueInfo add aUpdateInfo CapacityScheduler cs CapacityScheduler rm getResourceScheduler assertEquals CapacitySchedulerConfiguration DEFAULT_MAXIMUM_APPLICATIONMASTERS_RESOURCE_PERCENT cs getConfiguration getMaximumApplicationMasterResourcePerQueuePercent response r path path path path queryParam userName accept MediaType APPLICATION_JSON entity YarnWebServiceUtils toJson updateInfo SchedConfUpdateInfo MediaType APPLICATION_JSON put ClientResponse
String responseStr response getEntity String
String responseStr response getEntity String LOG info path toString responseStr
String responseStr response getEntity String
String responseStr response getEntity String LOG info path toString responseStr
startTime clock getTime Map SubClusterId SubClusterInfo subClustersActive federationFacade getSubClusters SubClusterId subClusterId getRandomActiveSubCluster subClustersActive
LOG debug i subClusterId ApplicationClientProtocol clientRMProxy getClientRMProxyForSubCluster subClusterId GetNewApplicationResponse response response clientRMProxy getNewApplication request e LOG warn subClusterId getId e response stopTime clock getTime routerMetrics succeededAppsCreated stopTime startTime response subClustersActive remove subClusterId routerMetrics incrAppsFailedCreated String errMsg
LOG info applicationId i subClusterId ApplicationHomeSubCluster appHomeSubCluster ApplicationHomeSubCluster newInstance applicationId subClusterId i subClusterId federationFacade addApplicationHomeSubCluster appHomeSubCluster e routerMetrics incrAppsFailedSubmitted String message applicationId RouterServerUtil logAndThrowException message e federationFacade updateApplicationHomeSubCluster appHomeSubCluster e String message applicationId SubClusterId subClusterIdInStateStore federationFacade getApplicationHomeSubCluster applicationId
federationFacade updateApplicationHomeSubCluster appHomeSubCluster e String message applicationId SubClusterId subClusterIdInStateStore federationFacade getApplicationHomeSubCluster applicationId subClusterId subClusterIdInStateStore LOG info applicationId subClusterId routerMetrics incrAppsFailedSubmitted RouterServerUtil logAndThrowException message e ApplicationClientProtocol clientRMProxy getClientRMProxyForSubCluster subClusterId SubmitApplicationResponse response response clientRMProxy submitApplication request
KillApplicationResponse request startTime clock getTime request request getApplicationId routerMetrics incrAppsFailedKilled RouterServerUtil logAndThrowException ApplicationId applicationId request getApplicationId SubClusterId subClusterId subClusterId federationFacade getApplicationHomeSubCluster request getApplicationId e routerMetrics incrAppsFailedKilled RouterServerUtil logAndThrowException applicationId e ApplicationClientProtocol clientRMProxy getClientRMProxyForSubCluster subClusterId KillApplicationResponse response
RouterServerUtil logAndThrowException ApplicationId applicationId request getApplicationId SubClusterId subClusterId subClusterId federationFacade getApplicationHomeSubCluster request getApplicationId e routerMetrics incrAppsFailedKilled RouterServerUtil logAndThrowException applicationId e ApplicationClientProtocol clientRMProxy getClientRMProxyForSubCluster subClusterId KillApplicationResponse response LOG info applicationId subClusterId response clientRMProxy forceKillApplication request e routerMetrics incrAppsFailedKilled
SubClusterId subClusterId subClusterId federationFacade getApplicationHomeSubCluster request getApplicationId e routerMetrics incrAppsFailedKilled RouterServerUtil logAndThrowException applicationId e ApplicationClientProtocol clientRMProxy getClientRMProxyForSubCluster subClusterId KillApplicationResponse response LOG info applicationId subClusterId response clientRMProxy forceKillApplication request e routerMetrics incrAppsFailedKilled LOG error request getApplicationId subClusterId getId e e
request request getApplicationId routerMetrics incrAppsFailedRetrieved RouterServerUtil logAndThrowException SubClusterId subClusterId subClusterId federationFacade getApplicationHomeSubCluster request getApplicationId e routerMetrics incrAppsFailedRetrieved RouterServerUtil logAndThrowException request getApplicationId e ApplicationClientProtocol clientRMProxy getClientRMProxyForSubCluster subClusterId GetApplicationReportResponse response response clientRMProxy getApplicationReport request e routerMetrics incrAppsFailedRetrieved
SubClusterId subClusterId subClusterId federationFacade getApplicationHomeSubCluster request getApplicationId e routerMetrics incrAppsFailedRetrieved RouterServerUtil logAndThrowException request getApplicationId e ApplicationClientProtocol clientRMProxy getClientRMProxyForSubCluster subClusterId GetApplicationReportResponse response response clientRMProxy getApplicationReport request e routerMetrics incrAppsFailedRetrieved LOG error request getApplicationId subClusterId getId e e response
ApplicationClientProtocol protocol getClientRMProxyForSubCluster subClusterId Method method ApplicationClientProtocol getMethod request getMethodName request getTypes method invoke protocol request getParams Map SubClusterId R results TreeMap futures addAll executorService invokeAll callables i i futures i SubClusterId subClusterId clusterIds get i Future Object future futures get i Object result future get results put subClusterId clazz cast result ex Throwable cause ex getCause
Map SubClusterId SubClusterInfo subClustersInfo facade getSubClusters List SubClusterInfo subclusters ArrayList subclusters addAll subClustersInfo values SubClusterInfo cmp SubClusterInfo SubClusterInfo o1 SubClusterInfo o2 o1 getSubClusterId compareTo o2 getSubClusterId Collections sort subclusters cmp SubClusterInfo subcluster subclusters SubClusterId subClusterId subcluster getSubClusterId String webAppAddress subcluster getRMWebServiceAddress String capability subcluster getCapability ClusterMetricsInfo subClusterInfo getClusterMetricsInfo capability tbody tr td a webAppAddress subClusterId toString __ td Integer toString subClusterInfo getAppsSubmitted td Integer toString subClusterInfo getAppsPending td Integer toString subClusterInfo getAppsRunning td Integer toString subClusterInfo getAppsFailed td Integer toString subClusterInfo getAppsKilled td Integer toString subClusterInfo getAppsCompleted td Integer toString subClusterInfo getContainersAllocated td Integer toString subClusterInfo getReservedContainers td Integer toString subClusterInfo getPendingContainers td StringUtils byteDesc subClusterInfo getAvailableMB BYTES_IN_MB td StringUtils byteDesc subClusterInfo getAllocatedMB BYTES_IN_MB td StringUtils byteDesc subClusterInfo getReservedMB BYTES_IN_MB td StringUtils byteDesc subClusterInfo getTotalMB BYTES_IN_MB td Long toString subClusterInfo getAvailableVirtualCores td Long toString subClusterInfo getAllocatedVirtualCores td Long toString subClusterInfo getReservedVirtualCores td Long toString subClusterInfo getTotalVirtualCores td Integer toString subClusterInfo getActiveNodes td Integer toString subClusterInfo getLostNodes td Integer toString subClusterInfo getDecommissionedNodes td Integer toString subClusterInfo getUnhealthyNodes td Integer toString subClusterInfo getRebootedNodes td Integer toString subClusterInfo getTotalNodes __
ApplicationId applicationId applicationId ApplicationId fromString newApp getApplicationId e routerMetrics incrAppsFailedSubmitted Response status Status BAD_REQUEST entity e getLocalizedMessage build List SubClusterId blacklist ArrayList SubClusterId ApplicationSubmissionContext context RMWebAppUtil createAppSubmissionContext newApp getConf SubClusterId subClusterId subClusterId policyFacade getHomeSubcluster context blacklist e routerMetrics incrAppsFailedSubmitted Response status Status SERVICE_UNAVAILABLE entity e getLocalizedMessage build
ApplicationHomeSubCluster appHomeSubCluster ApplicationHomeSubCluster newInstance applicationId subClusterId subClusterId federationFacade addApplicationHomeSubCluster appHomeSubCluster e routerMetrics incrAppsFailedSubmitted String errMsg applicationId Response status Status SERVICE_UNAVAILABLE entity errMsg e getLocalizedMessage build federationFacade updateApplicationHomeSubCluster appHomeSubCluster e String errMsg applicationId SubClusterId subClusterIdInStateStore
String errMsg applicationId SubClusterId subClusterIdInStateStore subClusterIdInStateStore federationFacade getApplicationHomeSubCluster applicationId e1 routerMetrics incrAppsFailedSubmitted Response status Status SERVICE_UNAVAILABLE entity e1 getLocalizedMessage build subClusterId subClusterIdInStateStore LOG info applicationId subClusterId routerMetrics incrAppsFailedSubmitted Response status Status SERVICE_UNAVAILABLE entity errMsg build SubClusterInfo subClusterInfo subClusterInfo federationFacade getSubCluster subClusterId
subClusterId LOG info applicationId subClusterId routerMetrics incrAppsFailedSubmitted Response status Status SERVICE_UNAVAILABLE entity errMsg build SubClusterInfo subClusterInfo subClusterInfo federationFacade getSubCluster subClusterId e routerMetrics incrAppsFailedSubmitted Response status Status SERVICE_UNAVAILABLE entity e getLocalizedMessage build Response response response getOrCreateInterceptorForSubCluster subClusterId subClusterInfo getRMWebServiceAddress submitApplication newApp hsr e
Map SubClusterId SubClusterInfo subClustersActive subClustersActive federationFacade getSubClusters routerMetrics incrMultipleAppsFailedRetrieved CompletionService AppsInfo compSvc ExecutorCompletionService threadpool HttpServletRequest hsrCopy clone hsr SubClusterInfo info subClustersActive compSvc AppsInfo AppsInfo DefaultRequestInterceptorREST interceptor getOrCreateInterceptorForSubCluster info getSubClusterId info getRMWebServiceAddress AppsInfo rmApps interceptor getApps hsrCopy stateQuery statesQuery finalStatusQuery userQuery queueQuery count startedBegin startedEnd finishBegin finishEnd applicationTypes applicationTags name unselectedFields rmApps routerMetrics incrMultipleAppsFailedRetrieved
Map SubClusterId SubClusterInfo subClustersActive subClustersActive getActiveSubclusters e LOG error e getMessage NodesInfo CompletionService NodesInfo compSvc ExecutorCompletionService NodesInfo threadpool SubClusterInfo info subClustersActive compSvc NodesInfo NodesInfo DefaultRequestInterceptorREST interceptor getOrCreateInterceptorForSubCluster info getSubClusterId info getRMWebServiceAddress NodesInfo nodesInfo interceptor getNodes states nodesInfo e
Map SubClusterId SubClusterInfo subClustersActive subClustersActive getActiveSubclusters e LOG error e getLocalizedMessage metrics CompletionService ClusterMetricsInfo compSvc ExecutorCompletionService ClusterMetricsInfo threadpool SubClusterInfo info subClustersActive compSvc ClusterMetricsInfo ClusterMetricsInfo DefaultRequestInterceptorREST interceptor getOrCreateInterceptorForSubCluster info getSubClusterId info getRMWebServiceAddress ClusterMetricsInfo metrics interceptor getClusterMetricsInfo metrics e
T T Map String String paramMap hsr paramMap hsr getParameterMap additionalParam paramMap additionalParam ClientResponse response RouterWebServiceUtil invokeRMWebService webApp targetPath method hsr hsr getPathInfo paramMap formParam getMediaTypeFromHttpServletRequest hsr returnType conf returnType T RouterWebServiceUtil clientResponseToResponse response response response getEntity returnType response
setUpConfig interceptor TestableFederationClientInterceptor stateStore MemoryFederationStateStore stateStore init getConf FederationStateStoreFacade getInstance reinitialize stateStore getConf stateStoreUtil FederationStateStoreTestUtil stateStore interceptor setConf getConf interceptor init user subClusters ArrayList SubClusterId i i i SubClusterId sc SubClusterId newInstance Integer toString i stateStoreUtil registerSubCluster sc subClusters add sc
String user ClientRequestInterceptor interceptor interceptor pipeline e e printStackTrace ClientRequestInterceptor pipeline user ClientRequestInterceptor ClientRequestInterceptor RequestInterceptorChainWrapper wrapper getRouterClientRMService getInterceptorChain ClientRequestInterceptor interceptor wrapper getRootInterceptor Assert assertNotNull interceptor
String user RMAdminRequestInterceptor interceptor interceptor pipeline e e printStackTrace RMAdminRequestInterceptor pipeline user RMAdminRequestInterceptor RMAdminRequestInterceptor RequestInterceptorChainWrapper wrapper getRouterRMAdminService getInterceptorChain RMAdminRequestInterceptor interceptor wrapper getRootInterceptor Assert assertNotNull interceptor
newApp validateRunning ApplicationId appId ApplicationId fromString newApp getApplicationId
setUpConfig interceptor TestableFederationInterceptorREST stateStore MemoryFederationStateStore stateStore init getConf FederationStateStoreFacade getInstance reinitialize stateStore getConf stateStoreUtil FederationStateStoreTestUtil stateStore interceptor setConf getConf interceptor init user subClusters ArrayList i i i SubClusterId sc SubClusterId newInstance Integer toString i stateStoreUtil registerSubCluster sc subClusters add sc
String user RESTRequestInterceptor interceptor interceptor pipeline e e printStackTrace RESTRequestInterceptor pipeline user RESTRequestInterceptor RESTRequestInterceptor RequestInterceptorChainWrapper wrapper getInterceptorChain user RESTRequestInterceptor interceptor wrapper getRootInterceptor Assert assertNotNull interceptor
FileSystem fs FileSystem get conf String root conf get YarnConfiguration SHARED_CACHE_ROOT YarnConfiguration DEFAULT_SHARED_CACHE_ROOT Path pidPath Path root GLOBAL_CLEANER_PID fs delete pidPath
metrics reportCleaningStart String pattern SharedCacheUtil getCacheEntryGlobPattern nestedLevel FileStatus resources fs globStatus Path root pattern numResources resources resources length
LOG info numResources beginMs System currentTimeMillis resource Thread LOG warn resource processSingleResource resource LOG warn resource getPath toString sleepTime Thread sleep sleepTime endMs System currentTimeMillis durationMs endMs beginMs
resource Thread LOG warn resource processSingleResource resource LOG warn resource getPath toString sleepTime Thread sleep sleepTime endMs System currentTimeMillis durationMs endMs beginMs LOG info numResources durationMs
resource Path path resource getPath ResourceStatus resourceStatus ResourceStatus INIT path
resource Path path resource getPath ResourceStatus resourceStatus ResourceStatus INIT path toString LOG info path toString path resourceStatus ResourceStatus DELETED e LOG error path e String key path getName store cleanResourceReferences key e
e LOG error path e String key path getName store cleanResourceReferences key e LOG error e store key store key deleted removeResourceFromCacheFileSystem path deleted resourceStatus ResourceStatus DELETED
String key path getName store cleanResourceReferences key e LOG error e store key store key deleted removeResourceFromCacheFileSystem path deleted resourceStatus ResourceStatus DELETED LOG error path resourceStatus ResourceStatus ERROR
Path path Path renamedPath Path path toString RENAMED_SUFFIX path renamedPath
conf Map String String initialCachedResources getInitialCachedResources FileSystem get conf conf
FileStatus entries fs globStatus Path root pattern numEntries entries entries length LOG info numEntries Map String String initialCachedEntries HashMap String String entries FileStatus entry entries Path file entry getPath String fileName file getName entry Path parent file getParent parent String key parent getName initialCachedEntries key LOG warn key initialCachedEntries get key fileName
SCMWebApp scmWebApp SCMWebApp scm webApp WebApps $for at bindAddress start scmWebApp
containerId Context nmContext yarnCluster getNodeManager getNMContext timeout Container waitContainer nmContext getContainers get containerId waitContainer
localORLogDirs String dirType localORLogDirs String dirsProperty localORLogDirs YarnConfiguration NM_LOCAL_DIRS YarnConfiguration NM_LOG_DIRS Configuration conf Configuration conf setLong YarnConfiguration NM_DISK_HEALTH_CHECK_INTERVAL_MS TOO_HIGH_DISK_HEALTH_CHECK_INTERVAL conf setFloat YarnConfiguration NM_MIN_HEALTHY_DISKS_FRACTION yarnCluster yarnCluster stop FileUtil fullyDelete localFSDirBase localFSDirBase mkdirs LOG info yarnCluster MiniYARNCluster TestDiskFailures getName numLocalDirs numLogDirs yarnCluster init conf yarnCluster start NodeManager nm yarnCluster getNodeManager
localORLogDirs String dirsHandler checkDirs List String list localORLogDirs dirsHandler getLocalDirs dirsHandler getLogDirs String seenDirs StringUtils join list
localORLogDirs String expectedDirs dirsHandler checkDirs List String list localORLogDirs dirsHandler getLocalDirs dirsHandler getLogDirs String seenDirs StringUtils join list LOG info expectedDirs
conf metrics EntityGroupFSTimelineStoreMetrics create summaryStore createSummaryStore addService summaryStore logRetainSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_RETAIN_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_RETAIN_SECONDS_DEFAULT logRetainMillis logRetainSecs
conf metrics EntityGroupFSTimelineStoreMetrics create summaryStore createSummaryStore addService summaryStore logRetainSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_RETAIN_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_RETAIN_SECONDS_DEFAULT logRetainMillis logRetainSecs LOG info logRetainSecs unknownActiveSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_UNKNOWN_ACTIVE_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_UNKNOWN_ACTIVE_SECONDS_DEFAULT unknownActiveMillis unknownActiveSecs
conf metrics EntityGroupFSTimelineStoreMetrics create summaryStore createSummaryStore addService summaryStore logRetainSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_RETAIN_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_RETAIN_SECONDS_DEFAULT logRetainMillis logRetainSecs LOG info logRetainSecs unknownActiveSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_UNKNOWN_ACTIVE_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_UNKNOWN_ACTIVE_SECONDS_DEFAULT unknownActiveMillis unknownActiveSecs LOG info unknownActiveSecs appCacheMaxSize conf getInt YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_APP_CACHE_SIZE YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_APP_CACHE_SIZE_DEFAULT
metrics EntityGroupFSTimelineStoreMetrics create summaryStore createSummaryStore addService summaryStore logRetainSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_RETAIN_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_RETAIN_SECONDS_DEFAULT logRetainMillis logRetainSecs LOG info logRetainSecs unknownActiveSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_UNKNOWN_ACTIVE_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_UNKNOWN_ACTIVE_SECONDS_DEFAULT unknownActiveMillis unknownActiveSecs LOG info unknownActiveSecs appCacheMaxSize conf getInt YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_APP_CACHE_SIZE YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_APP_CACHE_SIZE_DEFAULT LOG info appCacheMaxSize TimelineEntityGroupId appCacheMaxSize TimelineEntityGroupId eldest appCacheMaxSize TimelineEntityGroupId groupId eldest getKey
addService summaryStore logRetainSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_RETAIN_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_RETAIN_SECONDS_DEFAULT logRetainMillis logRetainSecs LOG info logRetainSecs unknownActiveSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_UNKNOWN_ACTIVE_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_UNKNOWN_ACTIVE_SECONDS_DEFAULT unknownActiveMillis unknownActiveSecs LOG info unknownActiveSecs appCacheMaxSize conf getInt YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_APP_CACHE_SIZE YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_APP_CACHE_SIZE_DEFAULT LOG info appCacheMaxSize TimelineEntityGroupId EntityCacheItem appCacheMaxSize TimelineEntityGroupId EntityCacheItem eldest appCacheMaxSize TimelineEntityGroupId groupId eldest getKey LOG debug groupId EntityCacheItem cacheItem eldest getValue
Collection String pluginNames conf getTrimmedStringCollection YarnConfiguration TIMELINE_SERVICE_ENTITY_GROUP_PLUGIN_CLASSES String pluginClasspath conf getTrimmed YarnConfiguration TIMELINE_SERVICE_ENTITY_GROUP_PLUGIN_CLASSPATH String systemClasses conf getTrimmedStrings YarnConfiguration TIMELINE_SERVICE_ENTITY_GROUP_PLUGIN_SYSTEM_CLASSES List TimelineEntityGroupPlugin pluginList LinkedList TimelineEntityGroupPlugin ClassLoader customClassLoader pluginClasspath pluginClasspath customClassLoader createPluginClassLoader pluginClasspath systemClasses ioe LOG warn ioe String name pluginNames LOG debug name TimelineEntityGroupPlugin cacheIdPlugin customClassLoader
summaryTdm init conf addService summaryTdm serviceStart fs activeRootPath fs mkdirs activeRootPath fs setPermission activeRootPath ACTIVE_DIR_PERMISSION fs doneRootPath fs mkdirs doneRootPath fs setPermission doneRootPath DONE_DIR_PERMISSION objMapper ObjectMapper objMapper setAnnotationIntrospector JaxbAnnotationIntrospector TypeFactory defaultInstance jsonFactory MappingJsonFactory objMapper scanIntervalSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_SCAN_INTERVAL_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_SCAN_INTERVAL_SECONDS_DEFAULT cleanerIntervalSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_CLEANER_INTERVAL_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_CLEANER_INTERVAL_SECONDS_DEFAULT numThreads conf getInt YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_THREADS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_THREADS_DEFAULT
addService summaryTdm serviceStart fs activeRootPath fs mkdirs activeRootPath fs setPermission activeRootPath ACTIVE_DIR_PERMISSION fs doneRootPath fs mkdirs doneRootPath fs setPermission doneRootPath DONE_DIR_PERMISSION objMapper ObjectMapper objMapper setAnnotationIntrospector JaxbAnnotationIntrospector TypeFactory defaultInstance jsonFactory MappingJsonFactory objMapper scanIntervalSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_SCAN_INTERVAL_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_SCAN_INTERVAL_SECONDS_DEFAULT cleanerIntervalSecs conf getLong YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_CLEANER_INTERVAL_SECONDS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_CLEANER_INTERVAL_SECONDS_DEFAULT numThreads conf getInt YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_THREADS YarnConfiguration TIMELINE_SERVICE_ENTITYGROUP_FS_STORE_THREADS_DEFAULT LOG info activeRootPath scanIntervalSecs
dir RemoteIterator FileStatus iter list dir logsToScanCount iter FileStatus stat iter next String name stat getPath getName ApplicationId appId parseApplicationId name appId
appDirPath appState AppState COMPLETED appDirPath getActiveAppPath applicationId appDirPath appState AppState ACTIVE RemoteIterator FileStatus iter list activeRootPath iter Path child Path iter next getPath getName applicationId toString appDirPath Path activeRootPath child appDirPath appState AppState ACTIVE appState AppState
appLogPath fs RemoteIterator FileStatus iter fs listStatusIterator appLogPath iter FileStatus stat iter next stat
List TimelineStore List cacheItems List TimelineStore stores LinkedList TimelineStore groupId TimelineStore storeForId getCachedStore groupId cacheItems storeForId
Set TimelineEntityGroupId groupIds HashSet TimelineEntityGroupId
entityType primaryFilter secondaryFilters Set TimelineEntityGroupId groupIds HashSet TimelineEntityGroupId cacheIdPlugin Set TimelineEntityGroupId idsFromPlugin cacheIdPlugin getTimelineEntityGroupId entityType primaryFilter secondaryFilters idsFromPlugin
groupId EntityCacheItem EntityCacheItem cacheItem cachedLogs cacheItem cachedLogs get groupId cacheItem
groupId EntityCacheItem EntityCacheItem cacheItem cachedLogs cacheItem cachedLogs get groupId cacheItem LOG debug groupId cacheItem EntityCacheItem groupId getConfig AppLogs appLogs getAndSetAppLogs groupId getApplicationId appLogs
cachedLogs cacheItem cachedLogs get groupId cacheItem LOG debug groupId cacheItem EntityCacheItem groupId getConfig AppLogs appLogs getAndSetAppLogs groupId getApplicationId appLogs LOG debug appLogs groupId cacheItem setAppLogs appLogs cachedLogs put groupId cacheItem LOG warn groupId TimelineStore store cacheItem getAppLogs AppLogs appLogs cacheItem getAppLogs
TimelineEntities entityType primaryFilter secondaryFilters LOG debug entityType primaryFilter List EntityCacheItem relatedCacheItems ArrayList List TimelineStore stores getTimelineStoresForRead entityType primaryFilter secondaryFilters relatedCacheItems TimelineEntities returnEntities TimelineEntities TimelineStore stores
entityId entityType LOG debug entityType entityId List EntityCacheItem relatedCacheItems ArrayList List TimelineStore stores getTimelineStoresForRead entityId entityType relatedCacheItems TimelineStore stores
Path appDirPath fs LOG debug appDirPath attemptDirName Path logPath getPath appDirPath FileStatus status fs getFileStatus logPath numParsed status startTime Time monotonicNow
tdm Path appDirPath appCompleted jsonFactory objMapper fs LOG debug appDirPath attemptDirName Path logPath getPath appDirPath FileStatus status fs getFileStatus logPath numParsed status startTime Time monotonicNow LOG debug logPath offset count parsePath tdm logPath appCompleted jsonFactory objMapper fs
ArrayList TimelineEntity entityList ArrayList TimelineEntity bytesParsed bytesParsedLastBatch postError MappingIterator TimelineEntity iter objMapper readValues parser TimelineEntity iter TimelineEntity entity iter next String etype entity getEntityType String eid entity getEntityId LOG trace etype count bytesParsed parser getCurrentLocation getCharOffset LOG trace bytesParsed
Configuration conf YarnConfiguration
conf DocumentStoreVendor storeType DocumentStoreUtils getStoreVendor conf
conf storeType DocumentStoreUtils getStoreVendor conf
List TimelineEntityDocument List TimelineEntityDocument entityDocs ArrayList
String String collectionName context StringBuilder queryStrBuilder StringBuilder queryStrBuilder append String format SELECT_DISTINCT_TYPES_FROM_COLLECTION collectionName String sqlQuery addPredicates context collectionName queryStrBuilder
String collectionName context maxDocumentsSize String sqlQuery buildQueryWithPredicates context collectionName maxDocumentsSize
context getFlowName hasPredicate queryStrBuilder append AND_OPERATOR append String format CONTAINS_FUNC_FOR_ID context getFlowName context getAppId hasPredicate queryStrBuilder append AND_OPERATOR append String format CONTAINS_FUNC_FOR_ID context getAppId context getEntityId hasPredicate queryStrBuilder append AND_OPERATOR append String format CONTAINS_FUNC_FOR_ID context getEntityId context getFlowRunId hasPredicate queryStrBuilder append AND_OPERATOR append String format CONTAINS_FUNC_FOR_ID context getFlowRunId context getEntityType hasPredicate queryStrBuilder append AND_OPERATOR append String format CONTAINS_FUNC_FOR_TYPE context getEntityType
Observable ResourceResponse Database databaseReadObs client readDatabase String format DATABASE_LINK databaseName Observable ResourceResponse Database databaseReadObs databaseName throwable throwable DocumentClientException DocumentClientException de DocumentClientException throwable de
collectionName LOG info collectionName databaseName databaseName collectionName DocumentCollection DocumentCollection collection DocumentCollection collection setId collectionName
o setArgName o setRequired options addOption o o Option SUB_APP_METRICS_TTL_OPTION_SHORT o setArgName o setRequired options addOption o o Option SKIP_EXISTING_TABLE_OPTION_SHORT o setRequired options addOption o CommandLineParser parser PosixParser CommandLine commandLine commandLine parser parse options args
serviceInit Configuration conf serviceInit conf Configuration hbaseConf HBaseTimelineStorageUtils getTimelineServiceHBaseConf conf conn ConnectionFactory createConnection hbaseConf entityTable EntityTableRW getTableMutator hbaseConf conn appToFlowTable AppToFlowTableRW getTableMutator hbaseConf conn applicationTable ApplicationTableRW getTableMutator hbaseConf conn flowRunTable FlowRunTableRW getTableMutator hbaseConf conn flowActivityTable FlowActivityTableRW getTableMutator hbaseConf conn subApplicationTable SubApplicationTableRW getTableMutator hbaseConf conn domainTable DomainTableRW getTableMutator hbaseConf conn UserGroupInformation ugi UserGroupInformation isSecurityEnabled UserGroupInformation getLoginUser UserGroupInformation getCurrentUser storageMonitor HBaseStorageMonitor conf
K converterColumnKey LOG debug converterColumnKey keyConverter decode entry getKey iae LOG error iae columnNameParts Separator QUALIFIERS split entry getKey actualColumnPrefixBytes columnNameParts actualColumnPrefixBytes columnNameParts converterColumnKey keyConverter decode columnNameParts iae
K converterColumnKey converterColumnKey keyConverter decode columnKey iae LOG error iae columnNameParts Separator QUALIFIERS split columnKey columnNameParts actualColumnPrefixBytes columnNameParts actualColumnPrefixBytes columnNameParts converterColumnKey keyConverter decode columnNameParts iae
createTable admin hbaseConf IOException TableName table getTableName hbaseConf admin table IOException table getNameAsString HTableDescriptor flowRunTableDescp HTableDescriptor table HColumnDescriptor infoCF HColumnDescriptor FlowRunColumnFamily INFO getBytes infoCF setBloomFilterType BloomType ROWCOL flowRunTableDescp addFamily infoCF infoCF setMinVersions infoCF setMaxVersions DEFAULT_METRICS_MAX_VERSIONS String coprocessorJarPathStr hbaseConf get YarnConfiguration FLOW_RUN_COPROCESSOR_JAR_HDFS_LOCATION YarnConfiguration DEFAULT_HDFS_LOCATION_FLOW_RUN_COPROCESSOR_JAR Path coprocessorJarPath Path coprocessorJarPathStr LOG info coprocessorJarPath toString flowRunTableDescp addCoprocessor coprocessorJarPath Coprocessor PRIORITY_USER admin createTable flowRunTableDescp
Set String hbaseConf conn validateParams augmentParams hbaseConf conn Set String types TreeSet TimelineReaderContext context getContext EntityRowKeyPrefix prefix EntityRowKeyPrefix context getClusterId context getUserId context getFlowName context getFlowRunId context getAppId currRowKey prefix getRowKeyPrefix nextRowKey prefix getRowKeyPrefix nextRowKey nextRowKey length FilterList typeFilterList FilterList typeFilterList addFilter FirstKeyOnlyFilter typeFilterList addFilter KeyOnlyFilter typeFilterList addFilter PageFilter
typeFilterList addFilter FirstKeyOnlyFilter typeFilterList addFilter KeyOnlyFilter typeFilterList addFilter PageFilter LOG debug typeFilterList counter results typeFilterList TimelineEntity entity parseEntityForType results next entity counter entity getType LOG warn entity getType String currType entity getType LOG
typeFilterList addFilter KeyOnlyFilter typeFilterList addFilter PageFilter LOG debug typeFilterList counter results typeFilterList currRowKey TimelineEntity entity parseEntityForType results next entity counter entity getType LOG warn entity getType String currType entity getType LOG LOG debug Arrays toString currRowKey
hbaseConf conn validateParams augmentParams hbaseConf conn FilterList filterList constructFilterListBasedOnFields HashSet filterList
Set TimelineEntity hbaseConf conn validateParams augmentParams hbaseConf conn Set TimelineEntity entities LinkedHashSet FilterList filterList createFilterList filterList
request FlowScannerOperation requestOp FlowScannerOperation MINOR_COMPACTION request requestOp request isMajor FlowScannerOperation MAJOR_COMPACTION FlowScannerOperation MINOR_COMPACTION
currentColumnQualifier CellUtil cloneQualifier cell previousColumnQualifier previousColumnQualifier currentColumnQualifier converter getValueConverter currentColumnQualifier previousColumnQualifier currentColumnQualifier addedCnt emitCells cells currentColumnCells currentAggOp converter currentTimestamp resetState currentColumnCells alreadySeenAggDim previousColumnQualifier currentColumnQualifier currentAggOp getCurrentAggOp cell converter getValueConverter currentColumnQualifier collectCells currentColumnCells currentAggOp cell alreadySeenAggDim converter scannerContext nextCell scannerContext currentColumnCells addedCnt addedCnt emitCells cells currentColumnCells currentAggOp converter currentTimestamp
sum converter add sum currentValue summationDone LOG LOG trace sum Bytes toString CellUtil cloneQualifier cell converter decodeValue CellUtil cloneValue cell cell getTimestamp action finalCells add cell summationDone Cell anyCell currentColumnCells first List Tag tags ArrayList Tag Tag t HBaseTimelineServerUtils createTag AggregationOperation SUM_FINAL getTagType Bytes toBytes FLOW_APP_ID tags add t t HBaseTimelineServerUtils createTag AggregationCompactionDimension APPLICATION_ID getTagType Bytes toBytes FLOW_APP_ID tags add t tagByteArray HBaseTimelineServerUtils convertTagListToByteArray tags Cell sumCell HBaseTimelineServerUtils createNewCell CellUtil cloneRow anyCell CellUtil cloneFamily anyCell CellUtil cloneQualifier anyCell TimestampGenerator getSupplementedTimestamp System currentTimeMillis FLOW_APP_ID converter encodeValue sum tagByteArray
LOG LOG trace sum Bytes toString CellUtil cloneQualifier cell converter decodeValue CellUtil cloneValue cell cell getTimestamp action finalCells add cell Cell anyCell currentColumnCells first List Tag tags ArrayList Tag Tag t HBaseTimelineServerUtils createTag AggregationOperation SUM_FINAL getTagType Bytes toBytes FLOW_APP_ID tags add t t HBaseTimelineServerUtils createTag AggregationCompactionDimension APPLICATION_ID getTagType Bytes toBytes FLOW_APP_ID tags add t tagByteArray HBaseTimelineServerUtils convertTagListToByteArray tags Cell sumCell HBaseTimelineServerUtils createNewCell CellUtil cloneRow anyCell CellUtil cloneFamily anyCell CellUtil cloneQualifier anyCell TimestampGenerator getSupplementedTimestamp System currentTimeMillis FLOW_APP_ID converter encodeValue sum tagByteArray finalCells add sumCell LOG
currentCell Number previouslyChosenCellValue Number converter decodeValue CellUtil cloneValue previouslyChosenCell Number currentCellValue Number converter decodeValue CellUtil cloneValue currentCell converter currentCellValue previouslyChosenCellValue currentCell previouslyChosenCell converter currentCellValue previouslyChosenCellValue currentCell previouslyChosenCell currentCell
request FlowScannerOperation requestOp FlowScannerOperation MINOR_COMPACTION request requestOp request isMajor FlowScannerOperation MAJOR_COMPACTION FlowScannerOperation MINOR_COMPACTION
currentColumnQualifier CellUtil cloneQualifier cell previousColumnQualifier previousColumnQualifier currentColumnQualifier converter getValueConverter currentColumnQualifier previousColumnQualifier currentColumnQualifier addedCnt emitCells cells currentColumnCells currentAggOp converter currentTimestamp resetState currentColumnCells alreadySeenAggDim previousColumnQualifier currentColumnQualifier currentAggOp getCurrentAggOp cell converter getValueConverter currentColumnQualifier collectCells currentColumnCells currentAggOp cell alreadySeenAggDim converter scannerContext nextCell scannerContext currentColumnCells addedCnt addedCnt emitCells cells currentColumnCells currentAggOp converter currentTimestamp
summationDone LOG LOG trace sum Bytes toString CellUtil cloneQualifier cell converter decodeValue CellUtil cloneValue cell cell getTimestamp action finalCells add cell summationDone Cell anyCell currentColumnCells first List Tag tags ArrayList Tag Tag t HBaseTimelineServerUtils createTag AggregationOperation SUM_FINAL getTagType Bytes toBytes FLOW_APP_ID tags add t t HBaseTimelineServerUtils createTag AggregationCompactionDimension APPLICATION_ID getTagType Bytes toBytes FLOW_APP_ID tags add t tagByteArray HBaseTimelineServerUtils convertTagListToByteArray tags Cell sumCell HBaseTimelineServerUtils createNewCell CellUtil cloneRow anyCell CellUtil cloneFamily anyCell CellUtil cloneQualifier anyCell TimestampGenerator getSupplementedTimestamp System currentTimeMillis FLOW_APP_ID converter encodeValue sum tagByteArray finalCells add sumCell
LOG trace sum Bytes toString CellUtil cloneQualifier cell converter decodeValue CellUtil cloneValue cell cell getTimestamp action finalCells add cell Cell anyCell currentColumnCells first List Tag tags ArrayList Tag Tag t HBaseTimelineServerUtils createTag AggregationOperation SUM_FINAL getTagType Bytes toBytes FLOW_APP_ID tags add t t HBaseTimelineServerUtils createTag AggregationCompactionDimension APPLICATION_ID getTagType Bytes toBytes FLOW_APP_ID tags add t tagByteArray HBaseTimelineServerUtils convertTagListToByteArray tags Cell sumCell HBaseTimelineServerUtils createNewCell CellUtil cloneRow anyCell CellUtil cloneFamily anyCell CellUtil cloneQualifier anyCell TimestampGenerator getSupplementedTimestamp System currentTimeMillis FLOW_APP_ID converter encodeValue sum tagByteArray finalCells add sumCell LOG LOG trace sum Bytes toString CellUtil cloneQualifier sumCell action
currentCell Number previouslyChosenCellValue Number converter decodeValue CellUtil cloneValue previouslyChosenCell Number currentCellValue Number converter decodeValue CellUtil cloneValue currentCell converter currentCellValue previouslyChosenCellValue currentCell previouslyChosenCell converter currentCellValue previouslyChosenCellValue currentCell previouslyChosenCell currentCell
host host bindAddress conf get YarnConfiguration DEFAULT_TIMELINE_SERVICE_BIND_HOST YarnConfiguration DEFAULT_TIMELINE_SERVICE_BIND_HOST startPort bindAddress host startPort HttpServer2 Builder builder HttpServer2 Builder setName setConf conf addEndpoint URI create YarnConfiguration useHttps conf bindAddress portRanges portRanges builder setPortRanges portRanges YarnConfiguration useHttps conf builder WebAppUtils loadSslConfiguration builder conf timelineRestServer builder build timelineRestServer addJerseyResourcePackage TimelineCollectorWebService getPackage getName GenericExceptionHandler getPackage getName YarnJacksonJaxbJsonProvider getPackage getName timelineRestServer setAttribute COLLECTOR_MANAGER_ATTR_KEY timelineRestServer start
appId token ReportNewCollectorInfoRequest request ReportNewCollectorInfoRequest newInstance appId timelineRestServerBindAddress token
appId GetTimelineCollectorContextRequest request GetTimelineCollectorContextRequest newInstance appId
appId GetTimelineCollectorContextRequest request GetTimelineCollectorContextRequest newInstance appId LOG info appId GetTimelineCollectorContextResponse response getNMCollectorService getTimelineCollectorContext request String userId response getUserId userId userId
GetTimelineCollectorContextResponse response getNMCollectorService getTimelineCollectorContext request String userId response getUserId userId userId LOG debug userId collector getTimelineEntityContext setUserId userId String flowName response getFlowName flowName flowName LOG debug flowName collector getTimelineEntityContext setFlowName flowName String flowVersion response getFlowVersion flowVersion flowVersion LOG debug flowVersion collector getTimelineEntityContext setFlowVersion flowVersion flowRunId response getFlowRunId flowRunId
Configuration conf getConfig InetSocketAddress nmCollectorServiceAddress conf getSocketAddr YarnConfiguration NM_BIND_HOST YarnConfiguration NM_COLLECTOR_SERVICE_ADDRESS YarnConfiguration DEFAULT_NM_COLLECTOR_SERVICE_ADDRESS YarnConfiguration DEFAULT_NM_COLLECTOR_SERVICE_PORT
ContainerId containerId ApplicationId appId containerId getApplicationAttemptId getApplicationId shouldRemoveApplication appIdToContainerId Set ContainerId masterContainers appIdToContainerId get appId masterContainers
conf String timelineWriterClassName conf get YarnConfiguration TIMELINE_SERVICE_WRITER_CLASS YarnConfiguration DEFAULT_TIMELINE_SERVICE_WRITER_CLASS
TimelineCollector appId TimelineCollector collector TimelineCollector collectorInTable collectors collectorInTable collectors get appId collectorInTable collector init getConfig collector setWriter writer collector start collectors put appId collector
TimelineCollector collectorInTable collectors collectorInTable collectors get appId collectorInTable collector init getConfig collector setWriter writer collector start collectors put appId collector LOG info appId collectorInTable collector postPut appId collectorInTable e YarnRuntimeException e
remove appId TimelineCollector collector collectors remove appId collector
req res String async String String init res UserGroupInformation callerUgi getUser req isAsync async async trim equalsIgnoreCase callerUgi String msg
UserGroupInformation callerUgi getUser req isAsync async async trim equalsIgnoreCase callerUgi String msg LOG error msg ForbiddenException msg startTime Time monotonicNow succeeded ApplicationId appID parseApplicationId appId appID Response status Response Status BAD_REQUEST build NodeTimelineCollectorManager collectorManager NodeTimelineCollectorManager context getAttribute NodeTimelineCollectorManager COLLECTOR_MANAGER_ATTR_KEY TimelineCollector collector collectorManager get appID collector
appID Response status Response Status BAD_REQUEST build NodeTimelineCollectorManager collectorManager NodeTimelineCollectorManager context getAttribute NodeTimelineCollectorManager COLLECTOR_MANAGER_ATTR_KEY TimelineCollector collector collectorManager get appID collector LOG error appId NotFoundException appId collector putEntitiesAsync processTimelineEntities entities appId Boolean valueOf isSubAppEntities callerUgi collector putEntities processTimelineEntities entities appId Boolean valueOf isSubAppEntities callerUgi succeeded Response ok build NotFoundException e WebApplicationException e Response Status INTERNAL_SERVER_ERROR
NodeTimelineCollectorManager collectorManager NodeTimelineCollectorManager context getAttribute NodeTimelineCollectorManager COLLECTOR_MANAGER_ATTR_KEY TimelineCollector collector collectorManager get appID collector LOG error appId NotFoundException appId collector putEntitiesAsync processTimelineEntities entities appId Boolean valueOf isSubAppEntities callerUgi collector putEntities processTimelineEntities entities appId Boolean valueOf isSubAppEntities callerUgi succeeded Response ok build NotFoundException e WebApplicationException e Response Status INTERNAL_SERVER_ERROR e LOG error e
req res String init res UserGroupInformation callerUgi getUser req callerUgi String msg
ApplicationId appID parseApplicationId appId appID Response status Response Status BAD_REQUEST build NodeTimelineCollectorManager collectorManager NodeTimelineCollectorManager context getAttribute NodeTimelineCollectorManager COLLECTOR_MANAGER_ATTR_KEY TimelineCollector collector collectorManager get appID collector LOG error appId NotFoundException appId domain setOwner callerUgi getShortUserName collector putDomain domain callerUgi Response ok build NotFoundException e WebApplicationException e Response Status INTERNAL_SERVER_ERROR e
conf String timelineReaderClassName conf get YarnConfiguration TIMELINE_SERVICE_READER_CLASS YarnConfiguration DEFAULT_TIMELINE_SERVICE_READER_CLASS
hostProperty YarnConfiguration TIMELINE_SERVICE_BIND_HOST String bindAddress WebAppUtils getWebAppBindURL conf hostProperty webAppURLWithoutScheme LOG info bindAddress String httpScheme WebAppUtils getHttpSchemePrefix conf HttpServer2 Builder builder HttpServer2 Builder setName setConf conf addEndpoint URI create httpScheme bindAddress httpScheme WebAppUtils WebAppUtils loadSslConfiguration builder conf readerWebServer builder build readerWebServer addJerseyResourcePackage TimelineReaderWebServices getPackage getName GenericExceptionHandler getPackage getName YarnJacksonJaxbJsonProvider getPackage getName LogWebService getPackage getName readerWebServer setAttribute TIMELINE_READER_MANAGER_ATTR timelineReaderManager readerWebServer start String msg
endTime Time monotonicNow
endTime Time monotonicNow LOG info url endTime startTime e BadRequestException invalidNumMsg e BadRequestException e getMessage e getMessage e NotFoundException NotFoundException e e BadRequestException e getMessage e getMessage e BadRequestException BadRequestException e e ForbiddenException ForbiddenException e
req String String String String String String String String String String String String String String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
TimelineReaderManager timelineReaderManager getTimelineReaderManager Set TimelineEntity entities TimelineReaderContext context TimelineUIDConverter APPLICATION_UID decodeUID uId context BadRequestException uId context setEntityType TimelineReaderWebServicesUtils parseStr entityType entities timelineReaderManager getEntities context TimelineReaderWebServicesUtils createTimelineEntityFilters limit createdTimeStart createdTimeEnd relatesTo isRelatedTo infofilters conffilters metricfilters eventfilters fromId TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd checkAccessForGenericEntities entities callerUGI entityType succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
req String String String String String String String String String String String String String String String String String String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
startTime Time monotonicNow succeeded init res TimelineReaderManager timelineReaderManager getTimelineReaderManager Set TimelineEntity entities TimelineReaderContext context TimelineReaderWebServicesUtils createTimelineReaderContext clusterId userId flowName flowRunId appId entityType entities timelineReaderManager getEntities context TimelineReaderWebServicesUtils createTimelineEntityFilters limit createdTimeStart createdTimeEnd relatesTo isRelatedTo infofilters conffilters metricfilters eventfilters fromId TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd checkAccessForGenericEntities entities callerUGI entityType succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
req String String String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
init res TimelineReaderManager timelineReaderManager getTimelineReaderManager TimelineEntity entity TimelineReaderContext context TimelineUIDConverter GENERIC_ENTITY_UID decodeUID uId context BadRequestException uId entity timelineReaderManager getEntity context TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd checkAccessForGenericEntity entity callerUGI succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
TimelineEntity entity TimelineReaderContext context TimelineUIDConverter GENERIC_ENTITY_UID decodeUID uId context BadRequestException uId entity timelineReaderManager getEntity context TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd checkAccessForGenericEntity entity callerUGI succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded LOG info url latency entity
req String String String String String String String String String String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
LOG info url TimelineReaderWebServicesUtils getUserName callerUGI startTime Time monotonicNow succeeded init res TimelineReaderManager timelineReaderManager getTimelineReaderManager TimelineEntity entity entity timelineReaderManager getEntity TimelineReaderWebServicesUtils createTimelineReaderContext clusterId userId flowName flowRunId appId entityType entityIdPrefix entityId TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd checkAccessForGenericEntity entity callerUGI succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
succeeded init res TimelineReaderManager timelineReaderManager getTimelineReaderManager TimelineEntity entity entity timelineReaderManager getEntity TimelineReaderWebServicesUtils createTimelineReaderContext clusterId userId flowName flowRunId appId entityType entityIdPrefix entityId TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd checkAccessForGenericEntity entity callerUGI succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded LOG info url latency entity
req String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
TimelineReaderManager timelineReaderManager getTimelineReaderManager TimelineEntity entity TimelineReaderContext context TimelineUIDConverter FLOWRUN_UID decodeUID uId context BadRequestException uId checkAccess timelineReaderManager callerUGI context getUserId context setEntityType TimelineEntityType YARN_FLOW_RUN toString entity timelineReaderManager getEntity context TimelineReaderWebServicesUtils createTimelineDataToRetrieve metricsToRetrieve succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
TimelineReaderContext context TimelineUIDConverter FLOWRUN_UID decodeUID uId context BadRequestException uId checkAccess timelineReaderManager callerUGI context getUserId context setEntityType TimelineEntityType YARN_FLOW_RUN toString entity timelineReaderManager getEntity context TimelineReaderWebServicesUtils createTimelineDataToRetrieve metricsToRetrieve succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded LOG info url latency entity
req String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
startTime Time monotonicNow succeeded init res TimelineReaderManager timelineReaderManager getTimelineReaderManager TimelineEntity entity TimelineReaderContext context TimelineReaderWebServicesUtils createTimelineReaderContext clusterId userId flowName flowRunId TimelineEntityType YARN_FLOW_RUN toString checkAccess timelineReaderManager callerUGI context getUserId entity timelineReaderManager getEntity context TimelineReaderWebServicesUtils createTimelineDataToRetrieve metricsToRetrieve succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
init res TimelineReaderManager timelineReaderManager getTimelineReaderManager TimelineEntity entity TimelineReaderContext context TimelineReaderWebServicesUtils createTimelineReaderContext clusterId userId flowName flowRunId TimelineEntityType YARN_FLOW_RUN toString checkAccess timelineReaderManager callerUGI context getUserId entity timelineReaderManager getEntity context TimelineReaderWebServicesUtils createTimelineDataToRetrieve metricsToRetrieve succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded LOG info url latency entity
req String String String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
TimelineReaderManager timelineReaderManager getTimelineReaderManager Set TimelineEntity entities TimelineReaderContext context TimelineUIDConverter FLOW_UID decodeUID uId context BadRequestException uId checkAccess timelineReaderManager callerUGI context getUserId context setEntityType TimelineEntityType YARN_FLOW_RUN toString entities timelineReaderManager getEntities context TimelineReaderWebServicesUtils createTimelineEntityFilters limit createdTimeStart createdTimeEnd fromId TimelineReaderWebServicesUtils createTimelineDataToRetrieve metricsToRetrieve fields succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
req String String String String String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
startTime Time monotonicNow succeeded init res TimelineReaderManager timelineReaderManager getTimelineReaderManager Set TimelineEntity entities TimelineReaderContext timelineReaderContext TimelineReaderWebServicesUtils createTimelineReaderContext clusterId userId flowName TimelineEntityType YARN_FLOW_RUN toString checkAccess timelineReaderManager callerUGI timelineReaderContext getUserId entities timelineReaderManager getEntities timelineReaderContext TimelineReaderWebServicesUtils createTimelineEntityFilters limit createdTimeStart createdTimeEnd fromId TimelineReaderWebServicesUtils createTimelineDataToRetrieve metricsToRetrieve fields succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
req String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
startTime Time monotonicNow succeeded init res TimelineReaderManager timelineReaderManager getTimelineReaderManager Set TimelineEntity entities DateRange range parseDateRange dateRange TimelineEntityFilters entityFilters TimelineReaderWebServicesUtils createTimelineEntityFilters limit range dateStart range dateEnd fromId entities timelineReaderManager getEntities TimelineReaderWebServicesUtils createTimelineReaderContext clusterId TimelineEntityType YARN_FLOW_ACTIVITY toString entityFilters TimelineReaderWebServicesUtils createTimelineDataToRetrieve succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
req String String String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
TimelineReaderManager timelineReaderManager getTimelineReaderManager TimelineEntity entity TimelineReaderContext context TimelineUIDConverter APPLICATION_UID decodeUID uId context BadRequestException uId context setEntityType TimelineEntityType YARN_APPLICATION toString entity timelineReaderManager getEntity context TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd checkAccessForAppEntity entity callerUGI succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
TimelineReaderContext context TimelineUIDConverter APPLICATION_UID decodeUID uId context BadRequestException uId context setEntityType TimelineEntityType YARN_APPLICATION toString entity timelineReaderManager getEntity context TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd checkAccessForAppEntity entity callerUGI succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded LOG info url latency entity
req String String String String String String String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
LOG info url TimelineReaderWebServicesUtils getUserName callerUGI startTime Time monotonicNow succeeded init res TimelineReaderManager timelineReaderManager getTimelineReaderManager TimelineEntity entity entity timelineReaderManager getEntity TimelineReaderWebServicesUtils createTimelineReaderContext clusterId userId flowName flowRunId appId TimelineEntityType YARN_APPLICATION toString TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd checkAccessForAppEntity entity callerUGI succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
succeeded init res TimelineReaderManager timelineReaderManager getTimelineReaderManager TimelineEntity entity entity timelineReaderManager getEntity TimelineReaderWebServicesUtils createTimelineReaderContext clusterId userId flowName flowRunId appId TimelineEntityType YARN_APPLICATION toString TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd checkAccessForAppEntity entity callerUGI succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded LOG info url latency entity
req String String String String String String String String String String String String String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
TimelineReaderManager timelineReaderManager getTimelineReaderManager Set TimelineEntity entities TimelineReaderContext context TimelineUIDConverter FLOWRUN_UID decodeUID uId context BadRequestException uId checkAccess timelineReaderManager callerUGI context getUserId context setEntityType TimelineEntityType YARN_APPLICATION toString entities timelineReaderManager getEntities context TimelineReaderWebServicesUtils createTimelineEntityFilters limit createdTimeStart createdTimeEnd relatesTo isRelatedTo infofilters conffilters metricfilters eventfilters fromId TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
String req String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
startTime Time monotonicNow succeeded init res TimelineReaderManager timelineReaderManager getTimelineReaderManager Set String results TimelineReaderContext context TimelineReaderWebServicesUtils createTimelineReaderContext clusterId userId flowName flowRunId appId results timelineReaderManager getEntityTypes context checkAccess getTimelineReaderManager callerUGI context getUserId succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntityTypesLatency latency succeeded
req String String String String String String String String String String String String String String String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
startTime Time monotonicNow succeeded init res TimelineReaderManager timelineReaderManager getTimelineReaderManager Set TimelineEntity entities TimelineReaderContext context TimelineReaderWebServicesUtils createTimelineReaderContext clusterId entityType userId entities timelineReaderManager getEntities context TimelineReaderWebServicesUtils createTimelineEntityFilters limit createdTimeStart createdTimeEnd relatesTo isRelatedTo infofilters conffilters metricfilters eventfilters fromId TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd checkAccessForSubAppEntities entities callerUGI succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
req String String String String String String String String String String String String url req getRequestURI req getQueryString QUERY_STRING_SEP req getQueryString UserGroupInformation callerUGI TimelineReaderWebServicesUtils getUser req
startTime Time monotonicNow succeeded init res TimelineReaderManager timelineReaderManager getTimelineReaderManager Set TimelineEntity entities TimelineReaderContext context TimelineReaderWebServicesUtils createTimelineReaderContext clusterId entityType entityIdPrefix entityId userId entities timelineReaderManager getEntities context TimelineEntityFilters Builder build TimelineReaderWebServicesUtils createTimelineDataToRetrieve confsToRetrieve metricsToRetrieve fields metricsLimit metricsTimeStart metricsTimeEnd checkAccessForSubAppEntities entities callerUGI succeeded e handleException e url startTime latency Time monotonicNow startTime METRICS addGetEntitiesLatency latency succeeded
ugi String entityUser String authUser TimelineReaderWebServicesUtils getUserName ugi String requestedUser TimelineReaderWebServicesUtils parseStr entityUser
isWhitelistReadAuthEnabled YarnConfiguration DEFAULT_TIMELINE_SERVICE_READ_AUTH_ENABLED isWhitelistReadAuthEnabled Boolean valueOf isWhitelistReadAuthEnabledStr isWhitelistReadAuthEnabled String listAllowedUsers conf getInitParameter YarnConfiguration TIMELINE_SERVICE_READ_ALLOWED_USERS listAllowedUsers listAllowedUsers YarnConfiguration DEFAULT_TIMELINE_SERVICE_READ_ALLOWED_USERS LOG info listAllowedUsers allowedUsersAclList AccessControlList listAllowedUsers LOG info allowedUsersAclList getUsers String adminAclListStr conf getInitParameter YarnConfiguration YARN_ADMIN_ACL adminAclListStr adminAclListStr TimelineReaderWhitelistAuthorizationFilter EMPTY_STRING LOG info adminAclList AccessControlList adminAclListStr
String conf String schemaCreatorClassName conf get YarnConfiguration TIMELINE_SERVICE_SCHEMA_CREATOR_CLASS YarnConfiguration DEFAULT_TIMELINE_SERVICE_SCHEMA_CREATOR_CLASS
SubjectPublicKeyInfo subPubKeyInfo SubjectPublicKeyInfo getInstance publicKey getEncoded X509v3CertificateBuilder certBuilder X509v3CertificateBuilder issuer BigInteger srand from to subject subPubKeyInfo AlgorithmIdentifier digAlgId DefaultDigestAlgorithmIdentifierFinder find SIG_ALG_ID ContentSigner contentSigner contentSigner BcRSAContentSignerBuilder SIG_ALG_ID digAlgId build PrivateKeyFactory createKey privateKey getEncoded oce GeneralSecurityException oce certBuilder addExtension Extension basicConstraints BasicConstraints certBuilder addExtension Extension basicConstraints BasicConstraints certBuilder addExtension Extension authorityKeyIdentifier JcaX509ExtensionUtils createAuthorityKeyIdentifier caCert X509CertificateHolder certHolder certBuilder build contentSigner X509Certificate cert JcaX509CertificateConverter setProvider getCertificate certHolder
Date from Date Date to GregorianCalendar Calendar DECEMBER getTime KeyPairGenerator keyGen KeyPairGenerator getInstance keyGen initialize caKeyPair keyGen genKeyPair String subject UUID randomUUID caCert createCert subject subject from to caKeyPair getPublic caKeyPair getPrivate
LOG warn CommonConfigurationKeys HADOOP_SECURITY_AUTHENTICATION auth String proxy WebAppUtils getProxyHostAndPort conf String proxyParts proxy split proxyHost proxyParts fetcher AppReportFetcher conf bindAddress conf get YarnConfiguration PROXY_ADDRESS bindAddress bindAddress YarnRuntimeException YarnConfiguration PROXY_ADDRESS String parts StringUtils split bindAddress port parts bindAddress parts port Integer parseInt parts String bindHost conf getTrimmed YarnConfiguration PROXY_BIND_HOST
String proxy WebAppUtils getProxyHostAndPort conf String proxyParts proxy split proxyHost proxyParts fetcher AppReportFetcher conf bindAddress conf get YarnConfiguration PROXY_ADDRESS bindAddress bindAddress YarnRuntimeException YarnConfiguration PROXY_ADDRESS String parts StringUtils split bindAddress port parts bindAddress parts port Integer parseInt parts String bindHost conf getTrimmed YarnConfiguration PROXY_BIND_HOST bindHost LOG debug YarnConfiguration PROXY_BIND_HOST
checkUser securityEnabled userWasWarned userApproved FetchedAppReport fetchedAppReport fetchedAppReport getFetchedAppReport id fetchedAppReport ApplicationReport applicationReport fetchedAppReport applicationReport fetchedAppReport getApplicationReport applicationReport LOG warn remoteUser id URI toFetch ProxyUriUtils getUriFromTrackingPlugins id trackingUriPlugins toFetch ProxyUtils sendRedirect req resp toFetch toString
fetchedAppReport ApplicationReport applicationReport fetchedAppReport applicationReport fetchedAppReport getApplicationReport applicationReport LOG warn remoteUser id URI toFetch ProxyUriUtils getUriFromTrackingPlugins id trackingUriPlugins toFetch ProxyUtils sendRedirect req resp toFetch toString notFound resp appId URI trackingUri getTrackingUri req resp id applicationReport getOriginalTrackingUrl fetchedAppReport getAppReportSource trackingUri
now Time monotonicNow proxyAddresses now proxyAddresses HashSet
req resp ProxyUtils rejectNonHttpRequests req HttpServletRequest httpReq HttpServletRequest req HttpServletResponse httpResp HttpServletResponse resp
insertPoint PROXY_PATH length redirect insert insertPoint String queryString httpReq getQueryString queryString queryString redirect append redirect append queryString ProxyUtils sendRedirect httpReq httpResp redirect toString String user httpReq c httpReq c user c getValue user
start server Server QueuedThreadPool server getThreadPool setMaxThreads ServletContextHandler context ServletContextHandler context setContextPath server setHandler context context addServlet ServletHolder TestServlet ServerConnector server getConnectors setHost server start originalPort ServerConnector server getConnectors getLocalPort
proxyConn HttpURLConnection url openConnection proxyConn connect assertEquals HttpURLConnection HTTP_OK proxyConn getResponseCode String s readInputStream proxyConn getInputStream assertTrue s contains assertTrue s contains appReportFetcher answer proxyConn HttpURLConnection url openConnection proxyConn setRequestProperty proxyConn connect assertEquals HttpURLConnection HTTP_OK proxyConn getResponseCode appReportFetcher answer URL clientUrl URL proxyPort proxyConn HttpURLConnection clientUrl openConnection proxyConn connect
