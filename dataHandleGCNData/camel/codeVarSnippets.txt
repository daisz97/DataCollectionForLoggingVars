Test public void testValidateJsonComponent throws Exception for String name catalog findComponentNames String json catalog componentJSonSchema name
Test public void testValidateJsonComponent throws Exception for String name catalog findComponentNames String json catalog componentJSonSchema name LOG info name
Test public void testValidateJsonDataFormats throws Exception for String name catalog findDataFormatNames String json catalog dataFormatJSonSchema name
Test public void testValidateJsonDataFormats throws Exception for String name catalog findDataFormatNames String json catalog dataFormatJSonSchema name LOG info name
Test public void testValidateJsonLanguages throws Exception for String name catalog findLanguageNames String json catalog languageJSonSchema name
Test public void testValidateJsonLanguages throws Exception for String name catalog findLanguageNames String json catalog languageJSonSchema name LOG info name
Test public void testValidateJsonModels throws Exception for String name catalog findModelNames String json catalog modelJSonSchema name
Test public void testValidateJsonModels throws Exception for String name catalog findModelNames String json catalog modelJSonSchema name LOG info name
Test public void validatePropertiesSummary throws Exception EndpointValidationResult result catalog validateEndpointProperties assertFalse result isSuccess String reason result summaryErrorMessage true
Test public void validatePropertiesSummary throws Exception EndpointValidationResult result catalog validateEndpointProperties assertFalse result isSuccess String reason result summaryErrorMessage true LOG info reason result catalog validateEndpointProperties assertFalse result isSuccess reason result summaryErrorMessage false
Test public void testSimpleExpression throws Exception LanguageValidationResult result catalog validateLanguageExpression null assertTrue result isSuccess assertEquals result getText result catalog validateLanguageExpression null assertFalse result isSuccess assertEquals result getText
Test public void testSimpleExpression throws Exception LanguageValidationResult result catalog validateLanguageExpression null assertTrue result isSuccess assertEquals result getText result catalog validateLanguageExpression null assertFalse result isSuccess assertEquals result getText LOG info result getError assertTrue result getError startsWith assertEquals result getShortError assertEquals result getIndex result catalog validateLanguageExpression null assertFalse result isSuccess assertEquals result getText
Test public void testSimplePredicate throws Exception LanguageValidationResult result catalog validateLanguagePredicate null assertTrue result isSuccess assertEquals result getText result catalog validateLanguagePredicate null assertFalse result isSuccess assertEquals result getText
Test public void testPredicatePlaceholder throws Exception LanguageValidationResult result catalog validateLanguagePredicate null assertTrue result isSuccess assertEquals result getText result catalog validateLanguagePredicate null assertFalse result isSuccess assertEquals result getText
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method clazz getMethod List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method clazz getMethod List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method clazz getMethod List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List CamelEndpointDetails details new ArrayList RouteBuilderParser parseRouteBuilderEndpoints clazz details
assertEquals details get getLineNumberEnd assertEquals details get getAbsolutePosition assertEquals details get getLinePosition assertEquals details get getEndpointUri assertEquals details get getLineNumber assertEquals details get getLineNumberEnd assertEquals details get getAbsolutePosition assertEquals details get getLinePosition assertEquals details get getEndpointUri assertEquals details get getLineNumber assertEquals details get getLineNumberEnd assertEquals details get getAbsolutePosition assertEquals details get getLinePosition List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
assertEquals details get getLineNumber assertEquals details get getLineNumberEnd assertEquals details get getAbsolutePosition assertEquals details get getLinePosition assertEquals details get getEndpointUri assertEquals details get getLineNumber assertEquals details get getLineNumberEnd assertEquals details get getAbsolutePosition assertEquals details get getLinePosition List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list LOG info result getElement assertEquals list get getElement list CamelJavaParserHelper parseCamelProducerUris method true true for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method clazz getMethod List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
Test void parseTree throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File List CamelNodeDetails list RouteBuilderParser parseRouteBuilderTree clazz true assertEquals list size CamelNodeDetails details list get assertEquals details getFileName assertEquals details getRouteId assertEquals details getMethodName assertEquals details getClassName assertEquals list get getLineNumber assertEquals list get getLineNumberEnd String tree details dump
Test void parseTree throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File List CamelNodeDetails list RouteBuilderParser parseRouteBuilderTree clazz true assertEquals list size CamelNodeDetails details list get CamelNodeDetails details2 list get assertEquals details getFileName assertEquals details2 getFileName assertEquals details getRouteId assertEquals details getClassName assertEquals details getMethodName assertEquals details2 getRouteId assertEquals details2 getMethodName assertEquals details2 getClassName String tree details dump
List CamelNodeDetails list RouteBuilderParser parseRouteBuilderTree clazz true assertEquals list size CamelNodeDetails details list get CamelNodeDetails details2 list get assertEquals details getFileName assertEquals details2 getFileName assertEquals details getRouteId assertEquals details getClassName assertEquals details getMethodName assertEquals details2 getRouteId assertEquals details2 getMethodName assertEquals details2 getClassName String tree details dump LOG info tree String tree2 details2 dump
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method clazz getMethod List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method clazz getMethod List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz assertNull method List MethodSource JavaClassSource methods CamelJavaParserHelper findInlinedConfigureMethods clazz assertEquals methods size method methods get List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File List CamelEndpointDetails details new ArrayList RouteBuilderParser parseRouteBuilderEndpoints clazz details
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method clazz getMethod List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true false for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method clazz getMethod List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true false for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true false for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method clazz getMethod List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true false for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true false for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true false for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List CamelEndpointDetails details new ArrayList RouteBuilderParser parseRouteBuilderEndpoints clazz details
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List CamelEndpointDetails details new ArrayList RouteBuilderParser parseRouteBuilderEndpoints clazz details LOG info details List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method clazz getMethod List ParserResult list CamelJavaParserHelper parseCamelSimpleExpressions method for ParserResult simple list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method clazz getMethod List ParserResult list CamelJavaParserHelper parseCamelSimpleExpressions method for ParserResult simple list LOG info simple getElement
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List CamelEndpointDetails details new ArrayList RouteBuilderParser parseRouteBuilderEndpoints clazz details
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List CamelEndpointDetails details new ArrayList RouteBuilderParser parseRouteBuilderEndpoints clazz details LOG info details List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List CamelEndpointDetails details new ArrayList RouteBuilderParser parseRouteBuilderEndpoints clazz details
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List CamelEndpointDetails details new ArrayList RouteBuilderParser parseRouteBuilderEndpoints clazz details LOG info details List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List CamelEndpointDetails details new ArrayList RouteBuilderParser parseRouteBuilderEndpoints clazz details
Test void parse throws Exception JavaClassSource clazz JavaClassSource Roaster parse new File MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List CamelEndpointDetails details new ArrayList RouteBuilderParser parseRouteBuilderEndpoints clazz details LOG info details List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list
MethodSource JavaClassSource method CamelJavaParserHelper findConfigureMethod clazz List CamelEndpointDetails details new ArrayList RouteBuilderParser parseRouteBuilderEndpoints clazz details LOG info details List ParserResult list CamelJavaParserHelper parseCamelConsumerUris method true true for ParserResult result list LOG info result getElement assertEquals list get getElement assertEquals list get getElement assertEquals list get getElement assertEquals list get getElement assertEquals list get getElement assertEquals list get getElement list CamelJavaParserHelper parseCamelProducerUris method true true for ParserResult result list
Test void testXml throws Exception List CamelRouteDetails list new ArrayList InputStream is new FileInputStream String fqn String baseDir XmlRouteParser parseXmlRouteRouteIds is baseDir fqn list for CamelRouteDetails detail list
Test void testXml throws Exception InputStream is new FileInputStream String key Element element CamelXmlHelper getSelectedCamelElementNode key is assertNotNull element key
Test void testXml throws Exception List CamelSimpleExpressionDetails list new ArrayList InputStream is new FileInputStream String fqn String baseDir XmlRouteParser parseXmlRouteSimpleExpressions is baseDir fqn list for CamelSimpleExpressionDetails detail list
Test void testXml throws Exception List CamelEndpointDetails endpoints new ArrayList InputStream is new FileInputStream String fqn String baseDir XmlRouteParser parseXmlRouteEndpoints is baseDir fqn endpoints for CamelEndpointDetails detail endpoints
Test void testXmlTree throws Exception InputStream is new FileInputStream String fqn String baseDir List CamelNodeDetails list XmlRouteParser parseXmlRouteTree is baseDir fqn assertEquals list size CamelNodeDetails details list get assertEquals details getFileName assertEquals details getRouteId assertEquals null details getMethodName assertEquals null details getClassName String tree details dump
private void test String filename int pos throws Exception List CamelEndpointDetails endpoints new ArrayList InputStream is new FileInputStream filename String fqn filename String baseDir XmlRouteParser parseXmlRouteEndpoints is baseDir fqn endpoints for CamelEndpointDetails detail endpoints
Test public void testBadVMTransportOptionsJMSPrefix throws Exception try final String vmUri
Test public void testBadVMTransportOptionsBrokerPrefix throws Exception try final String vmUri
Test public void testForwardingAMessageAcrossJMSKeepingCustomJMSHeaders throws Exception MockEndpoint resultEndpoint resolveMandatoryEndpoint MockEndpoint class resultEndpoint expectedBodiesReceived expectedBody AssertionClause firstMessageExpectations resultEndpoint message firstMessageExpectations header isEqualTo firstMessageExpectations header isEqualTo replyQueue firstMessageExpectations header isEqualTo correlationID firstMessageExpectations header isEqualTo messageType template sendBodyAndHeader expectedBody resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges Exchange exchange list get Object replyTo exchange getIn getHeader
firstMessage header isEqualTo messageType firstMessage header isEqualTo groupID Map String Object headers new HashMap headers put if useReplyToHeader headers put replyQueueName headers put correlationID headers put messageType headers put groupID template sendBodyAndHeaders expectedBody headers resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges Exchange exchange list get Message in exchange getIn Object replyTo in getHeader
Test public void testSendThenFailoverThenSend throws Exception ProducerTemplate requester senderContext createProducerTemplate LOG info String response String requester requestBody fromEndpoint assertNotNull response
Test public void testSendThenFailoverThenSend throws Exception ProducerTemplate requester senderContext createProducerTemplate LOG info String response String requester requestBody fromEndpoint assertNotNull response LOG info response TimeUnit SECONDS sleep LOG info shutdownBrokerA createBrokerA LOG info response String requester requestBody fromEndpoint assertNotNull response
headers put replyQueueName headers put correlationID headers put groupID Exchange reply template request new Processor public void process Exchange exchange exchange getIn setBody Map String Object headers new HashMap headers put headers put replyQueueName headers put correlationID headers put groupID exchange getIn setHeaders headers Message in reply getIn Object replyTo in getHeader
headers put correlationID headers put groupID Exchange reply template request new Processor public void process Exchange exchange exchange getIn setBody Map String Object headers new HashMap headers put headers put replyQueueName headers put correlationID headers put groupID exchange getIn setHeaders headers Message in reply getIn Object replyTo in getHeader LOG info replyTo
headers put groupID Exchange reply template request new Processor public void process Exchange exchange exchange getIn setBody Map String Object headers new HashMap headers put headers put replyQueueName headers put correlationID headers put groupID exchange getIn setHeaders headers Message in reply getIn Object replyTo in getHeader LOG info replyTo LOG info in getHeaders
headers put correlationID headers put groupID exchange getIn setHeaders headers Message in reply getIn Object replyTo in getHeader LOG info replyTo LOG info in getHeaders LOG info in getBody assertMessageHeader in correlationID Map String Object receivedHeaders myBean getHeaders assertThat receivedHeaders hasKey assertThat receivedHeaders hasEntry groupID assertThat receivedHeaders hasEntry correlationID replyTo receivedHeaders get
private int dumpDb java sql Connection jdbcConn throws Exception int count ResultSet resultSet jdbcConn createStatement executeQuery while resultSet next count
private boolean consumedFrom String qName throws Exception ActiveMQConnectionFactory factory new ActiveMQConnectionFactory factory setWatchTopicAdvisories false Connection connection factory createConnection connection start Session session connection createSession false Session AUTO_ACKNOWLEDGE MessageConsumer consumer session createConsumer new ActiveMQQueue qName Message message consumer receive
private int dumpDb java sql Connection jdbcConn throws Exception int count ResultSet resultSet jdbcConn createStatement executeQuery while resultSet next count
Test public void testMocksAreValid throws Exception expectedEndpoint expectedMessageCount expectedEndpoint message header isEqualTo MockEndpoint assertIsSatisfied camelContext List Exchange list expectedEndpoint getReceivedExchanges for Exchange exchange list Object body exchange getIn getBody
public void onMessage Message message synchronized this messages this messages add message if this verbose
public void waitForMessagesToArrive int messageCount long maxWaitTime long maxRemainingMessageCount long Math max messageCount this messages size
Test public void testSendTextMessage throws Exception String expectedBody template sendBodyAndHeader startEndpointUri expectedBody listener assertMessagesArrived List Message list listener flushMessages assertTrue list isEmpty Message message list get
public void connect throws Exception String uri getHttpUri toASCIIString
void reConnect throws Exception if websocket null websocket isOpen String uri getHttpUri toASCIIString
Override public void process Exchange exchange throws Exception Message in exchange getIn Object message in getBody if message null
Override public boolean process Exchange exchange AsyncCallback callback try Request request getEndpoint getBinding prepareRequest getEndpoint exchange
Override public void process HttpResponse response HttpContext context throws HttpException IOException int statusCode response getStatusLine getStatusCode if statusCode statusCode
catch InvalidAS2NameException e throw new HttpException e response addHeader AS2Header AS2_FROM as2From String as2To HttpMessageUtils getHeaderValue httpEntityEnclosingRequest AS2Header AS2_FROM try AS2Utils validateAS2Name as2To catch InvalidAS2NameException e throw new HttpException e response addHeader AS2Header AS2_TO as2To response addHeader AS2Header MESSAGE_ID AS2Utils createMessageId serverFQDN AS2SignedDataGenerator gen null if dispositionNotificationOptions getSignedReceiptProtocol null signingCertificateChain null signingPrivateKey null gen SigningUtils createSigningGenerator signingAlgorithm signingCertificateChain signingPrivateKey if gen null try
issueCert Utils makeCertificate issueKP issueDN issueKP issueDN String signingDN signingKP kpg generateKeyPair signingCert Utils makeCertificate signingKP signingDN issueKP issueDN certList new ArrayList certList add signingCert certList add issueCert KeyPair decryptingKP signingKP testServer new AS2ServerConnection AS2_VERSION SERVER_FQDN TARGET_PORT AS2SignatureAlgorithm SHA256WITHRSA certList toArray new Certificate signingKP getPrivate decryptingKP getPrivate testServer listen new HttpRequestHandler Override public void handle HttpRequest request HttpResponse response HttpContext context throws HttpException IOException try org apache camel component as2 api entity EntityParser parseAS2MessageEntity request context setAttribute AS2ServerManager SUBJECT SUBJECT context setAttribute AS2ServerManager FROM AS2_NAME
Test public void createReceivedContentMicTest throws Exception HttpEntityEnclosingRequest request new BasicHttpEntityEnclosingRequest HttpVersion HTTP_1_1 request addHeader AS2Header DISPOSITION_NOTIFICATION_OPTIONS DISPOSITION_NOTIFICATION_OPTIONS_VALUE request addHeader AS2Header CONTENT_TYPE CONTENT_TYPE_VALUE ApplicationEDIFACTEntity edifactEntity new ApplicationEDIFACTEntity EDI_MESSAGE AS2Charset US_ASCII AS2TransferEncoding NONE true InputStream is edifactEntity getContent BasicHttpEntity basicEntity new BasicHttpEntity basicEntity setContent is basicEntity setContentType CONTENT_TYPE_VALUE request setEntity basicEntity ReceivedContentMic receivedContentMic MicUtils createReceivedContentMic request null assertNotNull receivedContentMic
Test public void createReceivedContentMicTest throws Exception HttpEntityEnclosingRequest request new BasicHttpEntityEnclosingRequest HttpVersion HTTP_1_1 request addHeader AS2Header DISPOSITION_NOTIFICATION_OPTIONS DISPOSITION_NOTIFICATION_OPTIONS_VALUE request addHeader AS2Header CONTENT_TYPE CONTENT_TYPE_VALUE ApplicationEDIFACTEntity edifactEntity new ApplicationEDIFACTEntity EDI_MESSAGE AS2Charset US_ASCII AS2TransferEncoding NONE true InputStream is edifactEntity getContent BasicHttpEntity basicEntity new BasicHttpEntity basicEntity setContent is basicEntity setContentType CONTENT_TYPE_VALUE request setEntity basicEntity ReceivedContentMic receivedContentMic MicUtils createReceivedContentMic request null assertNotNull receivedContentMic LOG debug receivedContentMic getDigestAlgorithmId assertEquals EXPECTED_MESSAGE_DIGEST_ALGORITHM receivedContentMic getDigestAlgorithmId
Exception exception null try if request HttpEntityEnclosingRequest EntityParser parseAS2MessageEntity request apiProxy handleMDNResponse HttpEntityEnclosingRequest request response context ApplicationEDIEntity ediEntity HttpMessageUtils extractEdiPayload request as2ServerConnection getDecryptingPrivateKey Exchange exchange getEndpoint createExchange HttpCoreContext coreContext HttpCoreContext adapt context exchange setProperty AS2Constants AS2_INTERCHANGE coreContext exchange getIn setBody ediEntity getEdiMessage try getProcessor process exchange finally exception exchange getException catch Exception e
final Map String Object headers new HashMap headers put REQUEST_URI headers put SUBJECT headers put FROM headers put AS2_NAME headers put AS2_NAME headers put AS2MessageStructure PLAIN headers put ContentType create AS2MediaType APPLICATION_EDIFACT AS2Charset US_ASCII headers put EDI_MESSAGE_CONTENT_TRANSFER_ENCODING headers put final Triple HttpEntity HttpRequest HttpResponse result executeRequest headers HttpEntity responseEntity result getLeft HttpRequest request result getMiddle HttpResponse response result getRight assertNotNull result
headers put SUBJECT headers put FROM headers put AS2_NAME headers put AS2_NAME headers put AS2MessageStructure ENCRYPTED headers put ContentType create AS2MediaType APPLICATION_EDIFACT AS2Charset US_ASCII headers put EDI_MESSAGE_CONTENT_TRANSFER_ENCODING headers put headers put AS2EncryptionAlgorithm AES128_CBC headers put certList final Triple HttpEntity HttpRequest HttpResponse result executeRequest headers HttpEntity responseEntity result getLeft HttpRequest request result getMiddle HttpResponse response result getRight assertNotNull result
headers put AS2_NAME headers put AS2_NAME headers put AS2MessageStructure SIGNED headers put ContentType create AS2MediaType APPLICATION_EDIFACT AS2Charset US_ASCII headers put EDI_MESSAGE_CONTENT_TRANSFER_ENCODING headers put AS2SignatureAlgorithm SHA512WITHRSA headers put certList toArray new Certificate headers put signingKP getPrivate headers put headers put SIGNED_RECEIPT_MIC_ALGORITHMS final Triple HttpEntity HttpRequest HttpResponse result executeRequest headers HttpEntity responseEntity result getLeft HttpRequest request result getMiddle HttpResponse response result getRight assertNotNull result
headers put SUBJECT headers put FROM headers put AS2_NAME headers put AS2_NAME headers put AS2MessageStructure PLAIN_COMPRESSED headers put ContentType create AS2MediaType APPLICATION_EDIFACT AS2Charset US_ASCII headers put EDI_MESSAGE_CONTENT_TRANSFER_ENCODING headers put AS2CompressionAlgorithm ZLIB headers put headers put SIGNED_RECEIPT_MIC_ALGORITHMS final Triple HttpEntity HttpRequest HttpResponse result executeRequest headers HttpEntity responseEntity result getLeft HttpRequest request result getMiddle HttpResponse response result getRight assertNotNull result
Test public void receivePlainEDIMessageTest throws Exception AS2ClientConnection clientConnection new AS2ClientConnection AS2_VERSION USER_AGENT CLIENT_FQDN TARGET_HOST TARGET_PORT AS2ClientManager clientManager new AS2ClientManager clientConnection clientManager send EDI_MESSAGE REQUEST_URI SUBJECT FROM AS2_NAME AS2_NAME AS2MessageStructure PLAIN ContentType create AS2MediaType APPLICATION_EDIFACT AS2Charset US_ASCII null null null null null DISPOSITION_NOTIFICATION_TO SIGNED_RECEIPT_MIC_ALGORITHMS null null MockEndpoint mockEndpoint getMockEndpoint mockEndpoint expectedMinimumMessageCount mockEndpoint setResultWaitTime TimeUnit MILLISECONDS convert TimeUnit SECONDS mockEndpoint assertIsSatisfied final List Exchange exchanges mockEndpoint getExchanges assertNotNull exchanges assertFalse exchanges isEmpty
Test public void receiveMultipartSignedMessageTest throws Exception AS2ClientConnection clientConnection new AS2ClientConnection AS2_VERSION USER_AGENT CLIENT_FQDN TARGET_HOST TARGET_PORT AS2ClientManager clientManager new AS2ClientManager clientConnection clientManager send EDI_MESSAGE REQUEST_URI SUBJECT FROM AS2_NAME AS2_NAME AS2MessageStructure SIGNED ContentType create AS2MediaType APPLICATION_EDIFACT AS2Charset US_ASCII null AS2SignatureAlgorithm SHA256WITHRSA certList toArray new Certificate signingKP getPrivate null DISPOSITION_NOTIFICATION_TO SIGNED_RECEIPT_MIC_ALGORITHMS null null MockEndpoint mockEndpoint getMockEndpoint mockEndpoint expectedMinimumMessageCount mockEndpoint setResultWaitTime TimeUnit MILLISECONDS convert TimeUnit SECONDS mockEndpoint assertIsSatisfied final List Exchange exchanges mockEndpoint getExchanges assertNotNull exchanges assertFalse exchanges isEmpty
Test public void receiveEnvelopedMessageTest throws Exception AS2ClientConnection clientConnection new AS2ClientConnection AS2_VERSION USER_AGENT CLIENT_FQDN TARGET_HOST TARGET_PORT AS2ClientManager clientManager new AS2ClientManager clientConnection clientManager send EDI_MESSAGE REQUEST_URI SUBJECT FROM AS2_NAME AS2_NAME AS2MessageStructure ENCRYPTED ContentType create AS2MediaType APPLICATION_EDIFACT AS2Charset US_ASCII null null null null null DISPOSITION_NOTIFICATION_TO SIGNED_RECEIPT_MIC_ALGORITHMS AS2EncryptionAlgorithm AES128_CBC certList toArray new Certificate MockEndpoint mockEndpoint getMockEndpoint mockEndpoint expectedMinimumMessageCount mockEndpoint setResultWaitTime TimeUnit MILLISECONDS convert TimeUnit SECONDS mockEndpoint assertIsSatisfied final List Exchange exchanges mockEndpoint getExchanges assertNotNull exchanges assertFalse exchanges isEmpty
public void addListener ManagerEventListener listener throws CamelAsteriskException if managerConnection null managerConnection addEventListener listener
public void removeListener ManagerEventListener listener throws CamelAsteriskException if managerConnection null managerConnection removeEventListener listener
catch Exception ex resultEntries put atmosPath AtmosResultCode KO finally result setResultEntries resultEntries return result else LOG info if atmosEntry isDirectory throw new AtmosException atmosPath String oldAtmosPath atmosPath Collection File listFiles FileUtils listFiles fileLocalPath null true if listFiles null listFiles isEmpty throw new AtmosException localPath resultEntries new HashMap listFiles size for File file listFiles
Override protected void doService HttpServletRequest request HttpServletResponse response throws ServletException IOException log trace request HttpConsumer consumer getServletResolveConsumerStrategy resolve request getConsumers if consumer null
if consumer null log debug request response sendError HttpServletResponse SC_NOT_FOUND return if consumer isSuspended log debug request response sendError HttpServletResponse SC_SERVICE_UNAVAILABLE return if consumer getEndpoint getHttpMethodRestrict null consumer getEndpoint getHttpMethodRestrict equals request getMethod response sendError HttpServletResponse SC_METHOD_NOT_ALLOWED return if equals request getMethod consumer isTraceEnabled response sendError HttpServletResponse SC_METHOD_NOT_ALLOWED return if consumer WebsocketConsumer
Override public void addWebSocket String connectionKey WebSocket websocket values put connectionKey websocket keys put websocket connectionKey if LOG isDebugEnabled
Override public void onError WebSocket webSocket WebSocketException t
Override public List AtmosphereRequest onMessage WebSocket webSocket String data
Override public List AtmosphereRequest onMessage WebSocket webSocket byte data int offset int length
Message in exchange getIn Object message in getBody if message null LOG debug return if message String message byte message Reader message InputStream if LOG isInfoEnabled LOG info message getClass message in getBody String class if message Reader message in getBody String class else if message InputStream message in getBody byte class LOG debug message if getEndpoint isSendToAll
Override public List AtmosphereRequest onTextStream WebSocket webSocket Reader data
Override public List AtmosphereRequest onBinaryStream WebSocket webSocket InputStream data
Test void testFeedGetsUpdatedEvents throws Exception MockEndpoint endpoint getMockEndpoint endpoint expectedMessageCount assertMockEndpointsSatisfied List Exchange list endpoint getReceivedExchanges String expectedTitles int counter for Exchange exchange list Entry entry exchange getIn getBody Entry class assertNotNull entry exchange String expectedTitle expectedTitles counter String title entry getTitle assertEquals expectedTitle title counter
Override protected void doStart throws Exception super doStart this map getAtomixEndpoint getAtomix getMap resourceName new DistributedMap Config getAtomixEndpoint getConfiguration getResourceOptions resourceName new DistributedMap Options getAtomixEndpoint getConfiguration getResourceConfig resourceName join Object key getAtomixEndpoint getConfiguration getKey if key null
Override protected void doStart throws Exception super doStart DistributedGroup group getAtomixEndpoint getAtomix getGroup groupName new DistributedGroup Config getAtomixEndpoint getConfiguration getResourceOptions groupName new DistributedGroup Options getAtomixEndpoint getConfiguration getResourceConfig groupName join this localMember group join memberName join this consumer localMember messaging consumer channelName
Override protected void doStart throws Exception super doStart this queue getAtomixEndpoint getAtomix getQueue resourceName new DistributedQueue Config getAtomixEndpoint getConfiguration getResourceOptions resourceName new DistributedQueue Options getAtomixEndpoint getConfiguration getResourceConfig resourceName join
Override protected void doStart throws Exception super doStart this set getAtomixEndpoint getAtomix getSet resourceName new DistributedSet Config getAtomixEndpoint getConfiguration getResourceOptions resourceName new DistributedSet Options getAtomixEndpoint getConfiguration getResourceConfig resourceName join
Override protected void doStart throws Exception super doStart this value getAtomixEndpoint getAtomix getValue resourceName new DistributedValue Config getAtomixEndpoint getConfiguration getResourceOptions resourceName new DistributedValue Options getAtomixEndpoint getConfiguration getResourceConfig resourceName join
Override protected void doStop throws Exception super doStop if atomix null
Override protected void doStop throws Exception super doStop if atomix null
private AtomixReplica getOrCreateReplica throws Exception if atomix null ObjectHelper notNull getCamelContext ObjectHelper notNull address ObjectHelper notNull configuration atomix AtomixClusterHelper createReplica getCamelContext address configuration if ObjectHelper isNotEmpty configuration getNodes
private void run String id try DefaultCamelContext context new DefaultCamelContext int events ThreadLocalRandom current nextInt CountDownLatch contextLatch new CountDownLatch events context disableJMX context setName id context addService createClusterService id address context addRoutePolicyFactory ClusteredRoutePolicyFactory forNamespace context addRoutes new RouteBuilder Override public void configure throws Exception from routeId id log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt context start contextLatch await
service setId address port service setStorageLevel StorageLevel MEMORY service setAddress address service setNodes addresses context disableJMX context setName address port context addService service context addRoutePolicyFactory ClusteredRoutePolicyFactory forNamespace context addRoutes new RouteBuilder Override public void configure throws Exception from routeId address port log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt context start contextLatch await
AtomixClusterService service new AtomixClusterService service setId address port service setStorageLevel StorageLevel MEMORY service setAddress address service setNodes addresses context disableJMX context setName address port context addService service context addRoutes new RouteBuilder Override public void configure throws Exception from routeId address port routePolicy ClusteredRoutePolicy forNamespace log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt context start contextLatch await
Override public void process Exchange exchange throws Exception List MetricDatum metricData getMetricData exchange PutMetricDataRequest request new PutMetricDataRequest withMetricData metricData withNamespace determineNameSpace exchange
else DescribeStreamRequest req1 new DescribeStreamRequest withStreamName getEndpoint getConfiguration getStreamName DescribeStreamResult res1 getClient describeStream req1 List Shard shards res1 getStreamDescription getShards if shards size LOG warn return null shardId shards get getShardId isShardClosed shards get getSequenceNumberRange getEndingSequenceNumber null LOG debug shardId GetShardIteratorRequest req new GetShardIteratorRequest withStreamName getEndpoint getConfiguration getStreamName withShardId shardId withShardIteratorType getEndpoint getConfiguration getIteratorType if hasSequenceNumber req withStartingSequenceNumber getEndpoint getConfiguration getSequenceNumber GetShardIteratorResult result getClient getShardIterator req currentShardIterator result getShardIterator
private static void displayTextInputStream InputStream input throws IOException BufferedReader reader new BufferedReader new InputStreamReader input String line null while line reader readLine null
Override public int processBatch Queue Object exchanges throws Exception int total exchanges size for int index index total isBatchAllowed index final Exchange exchange ObjectHelper cast Exchange class exchanges poll exchange setProperty Exchange BATCH_INDEX index exchange setProperty Exchange BATCH_SIZE total exchange setProperty Exchange BATCH_COMPLETE index total pendingExchanges total index Integer visibilityTimeout getConfiguration getVisibilityTimeout if this scheduledExecutor null visibilityTimeout null visibilityTimeout intValue int delay visibilityTimeout intValue int period visibilityTimeout intValue int repeatSeconds Double valueOf visibilityTimeout doubleValue intValue if LOG isDebugEnabled
queueUrl protocol getFullyQualifiedAWSHost configuration getQueueOwnerAWSAccountId configuration getQueueName else if configuration getQueueOwnerAWSAccountId null GetQueueUrlRequest getQueueUrlRequest new GetQueueUrlRequest getQueueUrlRequest setQueueName configuration getQueueName getQueueUrlRequest setQueueOwnerAWSAccountId configuration getQueueOwnerAWSAccountId GetQueueUrlResult getQueueUrlResult client getQueueUrl getQueueUrlRequest queueUrl getQueueUrlResult getQueueUrl else ListQueuesResult listQueuesResult client listQueues for String url listQueuesResult getQueueUrls if url endsWith configuration getQueueName queueUrl url LOG trace queueUrl break if queueUrl null configuration isAutoCreateQueue
public Object processActivity Object inputParameters String taskToken throws Exception
Override public void process Exchange exchange throws Exception String eventName getEventName exchange String version getVersion exchange
public Object processWorkflow Object parameters long startTime boolean replaying throws Exception
public void signalReceived Object parameters throws Exception
public Object getWorkflowState Object parameters throws Exception
Override public void process Exchange exchange throws Exception
private boolean isExcluded String routeId if excludePatterns isEmpty for String pattern excludePatterns if pattern equals routeId
Override public void process Exchange exchange throws Exception List MetricDatum metricData getMetricData exchange PutMetricDataRequest Builder builder PutMetricDataRequest builder builder metricData metricData namespace determineNameSpace exchange PutMetricDataRequest request builder build
else DescribeStreamRequest req1 DescribeStreamRequest builder streamName getEndpoint getConfiguration getStreamName build DescribeStreamResponse res1 getClient describeStream req1 List Shard shards res1 streamDescription shards if shards size LOG warn return null shardId shards get shardId isShardClosed shards get sequenceNumberRange endingSequenceNumber null LOG debug shardId GetShardIteratorRequest Builder req GetShardIteratorRequest builder streamName getEndpoint getConfiguration getStreamName shardId shardId shardIteratorType getEndpoint getConfiguration getIteratorType if hasSequenceNumber req startingSequenceNumber getEndpoint getConfiguration getSequenceNumber GetShardIteratorResponse result getClient getShardIterator req build currentShardIterator result shardIterator
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure throws Exception String awsEndpoint from to awsEndpoint process new Processor SuppressWarnings Override public void process Exchange exchange throws Exception ResponseInputStream GetObjectResponse s3 exchange getIn getBody ResponseInputStream class
Override public int processBatch Queue Object exchanges throws Exception int total exchanges size for int index index total isBatchAllowed index final Exchange exchange ObjectHelper cast Exchange class exchanges poll exchange setProperty Exchange BATCH_INDEX index exchange setProperty Exchange BATCH_SIZE total exchange setProperty Exchange BATCH_COMPLETE index total pendingExchanges total index Integer visibilityTimeout getConfiguration getVisibilityTimeout if this scheduledExecutor null visibilityTimeout null visibilityTimeout intValue int delay visibilityTimeout intValue int period visibilityTimeout intValue int repeatSeconds Double valueOf visibilityTimeout doubleValue intValue if LOG isDebugEnabled
queueUrl getAwsEndpointUri configuration getQueueOwnerAWSAccountId configuration getQueueName else if configuration getQueueOwnerAWSAccountId null GetQueueUrlRequest Builder getQueueUrlRequest GetQueueUrlRequest builder getQueueUrlRequest queueName configuration getQueueName getQueueUrlRequest queueOwnerAWSAccountId configuration getQueueOwnerAWSAccountId GetQueueUrlResponse getQueueUrlResult client getQueueUrl getQueueUrlRequest build queueUrl getQueueUrlResult queueUrl else ListQueuesResponse listQueuesResult client listQueues for String url listQueuesResult queueUrls if url endsWith configuration getQueueName queueUrl url LOG trace queueUrl break if queueUrl null configuration isAutoCreateQueue
private boolean sendAsyncEvents final Iterable EventData eventData final SendOptions sendOptions final Exchange exchange final AsyncCallback asyncCallback sendAsyncEventsWithSuitableMethod eventData sendOptions subscribe unused LOG debug error
public final void addToHintMap final EncodeHintType hintType final Object value this writerHintMap put hintType value
public final void removeFromHintMap final EncodeHintType hintType if this writerHintMap containsKey hintType this writerHintMap remove hintType
public final void removeFromHintMap final DecodeHintType hintType if this readerHintMap containsKey hintType this readerHintMap remove hintType
BeforeEach Override public void setUp throws Exception super setUp File directory new File PATH if directory isDirectory directory exists
Override protected void doShutdown throws Exception if LOG isDebugEnabled beanInfoCache LRUCache LRUCache cache LRUCache this beanInfoCache
else List MethodInfo methods getOperations name if methods null methods size methodInfo methods get if emptyParameters methodInfo hasParameters throw new MethodNotFoundException exchange pojo methodName else if methods null methodInfo chooseMethod pojo exchange methodName if emptyParameters if methodInfo null methodInfo hasParameters throw new MethodNotFoundException exchange pojo methodName if methodInfo null name null name equals methodInfo getMethod getName throw new AmbiguousMethodCallException exchange methods else throw new MethodNotFoundException exchange pojo methodName
beanHolder new RequestBeanHolder beanHolder answer new BeanProcessor beanHolder else if bean null if beanType null beanClass null throw new IllegalArgumentException if beanType null try clazz camelContext getClassResolver resolveMandatoryClass beanType catch ClassNotFoundException e throw RuntimeCamelException wrapRuntimeCamelException e else clazz beanClass if scope BeanScope Singleton clazz null Set beans camelContext getRegistry findByType clazz
else if bean null if beanType null beanClass null throw new IllegalArgumentException if beanType null try clazz camelContext getClassResolver resolveMandatoryClass beanType catch ClassNotFoundException e throw RuntimeCamelException wrapRuntimeCamelException e else clazz beanClass if scope BeanScope Singleton clazz null Set beans camelContext getRegistry findByType clazz if beans size if beans size
if beanType null beanClass null throw new IllegalArgumentException if beanType null try clazz camelContext getClassResolver resolveMandatoryClass beanType catch ClassNotFoundException e throw RuntimeCamelException wrapRuntimeCamelException e else clazz beanClass if scope BeanScope Singleton clazz null Set beans camelContext getRegistry findByType clazz if beans size if beans size LOG debug clazz bean beans iterator next
if beanType null try clazz camelContext getClassResolver resolveMandatoryClass beanType catch ClassNotFoundException e throw RuntimeCamelException wrapRuntimeCamelException e else clazz beanClass if scope BeanScope Singleton clazz null Set beans camelContext getRegistry findByType clazz if beans size if beans size LOG debug clazz bean beans iterator next else LOG debug beans size clazz
clazz camelContext getClassResolver resolveMandatoryClass beanType catch ClassNotFoundException e throw RuntimeCamelException wrapRuntimeCamelException e else clazz beanClass if scope BeanScope Singleton clazz null Set beans camelContext getRegistry findByType clazz if beans size if beans size LOG debug clazz bean beans iterator next else LOG debug beans size clazz if bean null scope BeanScope Singleton camelContext getInjector supportsAutoWiring try
Override public void invalidRecord InvalidRecordException ex throws Exception String msg LOG_PREFIX ex getMessage ex getRecordContext getRecordText if getConfiguration isIgnoreInvalidRecords
Override public void unexpectedRecord UnexpectedRecordException ex throws Exception String msg LOG_PREFIX ex getMessage ex getRecordContext getRecordText if getConfiguration isIgnoreUnexpectedRecords
Override public void unidentifiedRecord UnidentifiedRecordException ex throws Exception String msg LOG_PREFIX ex getMessage ex getRecordContext getRecordText if getConfiguration isIgnoreUnidentifiedRecords
Test void testUnmarshal throws Exception MockEndpoint mock getMockEndpoint mock expectedMessageCount template sendBody FIXED_DATA mock assertIsSatisfied List Exchange exchanges mock getExchanges if verbose for Exchange exchange exchanges Object body exchange getIn getBody
Override public void act final Client client final Exchange exchange throws NoSuchHeaderException InvalidPayloadException final Integer jobs exchange getIn getMandatoryBody Integer class final int result client kick jobs if LOG isDebugEnabled
Override public void act final Client client final Exchange exchange throws NoSuchHeaderException final Message in exchange getIn final long priority BeanstalkExchangeHelper getPriority endpoint in final int delay BeanstalkExchangeHelper getDelay endpoint in final int timeToRun BeanstalkExchangeHelper getTimeToRun endpoint in final long jobId client put priority delay timeToRun in getBody byte class if LOG isDebugEnabled
SuppressWarnings private void loadModels Class root models add root modelClassNames add root getName for Field field root getDeclaredFields Link linkField field getAnnotation Link class if linkField null if LOG isDebugEnabled
Override public void initAnnotatedFields maxpos for Class cl models List Field linkFields new ArrayList if LOG isDebugEnabled
if LOG isDebugEnabled LOG debug new Object cl getName dataField pos dataField if dataField required numberMandatoryFields else numberOptionalFields int pos dataField pos if annotatedFields containsKey pos Field f annotatedFields get pos LOG warn f getName field getName dataFields put pos dataField annotatedFields put pos field maxpos Math max maxpos pos Link linkField field getAnnotation Link class if linkField null
else numberOptionalFields int pos dataField pos if annotatedFields containsKey pos Field f annotatedFields get pos LOG warn f getName field getName dataFields put pos dataField annotatedFields put pos field maxpos Math max maxpos pos Link linkField field getAnnotation Link class if linkField null if LOG isDebugEnabled LOG debug cl getName field linkFields add field if linkFields isEmpty
int pos dataField pos if annotatedFields containsKey pos Field f annotatedFields get pos LOG warn f getName field getName dataFields put pos dataField annotatedFields put pos field maxpos Math max maxpos pos Link linkField field getAnnotation Link class if linkField null if LOG isDebugEnabled LOG debug cl getName field linkFields add field if linkFields isEmpty annotatedLinkFields put cl getName linkFields totalFields numberMandatoryFields numberOptionalFields
Override public String unbind CamelContext camelContext Map String Object model throws Exception StringBuilder buffer new StringBuilder Map Integer List String results new HashMap org apache camel util ObjectHelper notNull this separator char separator ConverterUtils getCharDelimiter this getSeparator if LOG isDebugEnabled
List List String product new ArrayList int idx int idxSize do idxSize List String v new ArrayList for int ii ii sortValues lastKey ii List String l values get ii if l null v add idxSize continue if l size idx v add l get idx if LOG isDebugEnabled
List String v new ArrayList for int ii ii sortValues lastKey ii List String l values get ii if l null v add idxSize continue if l size idx v add l get idx if LOG isDebugEnabled LOG debug l get idx ii idx else v add l get idxSize if LOG isDebugEnabled
field setAccessible true DataField datafield field getAnnotation DataField class if datafield null if obj null FormattingOptions formattingOptions ConverterUtils convert datafield field getType field getAnnotation BindyConverter class getLocale Format format formatFactory getFormat formattingOptions Object value field get obj if org apache camel util ObjectHelper isNotEmpty datafield defaultValue org apache camel util ObjectHelper isEmpty value value datafield defaultValue result formatString format value if datafield trim result result trim if datafield clip result length datafield length result result substring datafield length if LOG isDebugEnabled
result formatString format value if datafield trim result result trim if datafield clip result length datafield length result result substring datafield length if LOG isDebugEnabled LOG debug value datafield pos result else result Integer key if isMessageOrdered obj null Integer key1 sections get obj getClass getName Integer key2 datafield position Integer keyGenerated generateKey key1 key2 if LOG isDebugEnabled
private void initCsvRecordParameters if separator null for Class cl models CsvRecord record cl getAnnotation CsvRecord class Section section cl getAnnotation Section class if record null
private void initCsvRecordParameters if separator null for Class cl models CsvRecord record cl getAnnotation CsvRecord class Section section cl getAnnotation Section class if record null LOG debug record skipFirstLine record skipFirstLine
private void initCsvRecordParameters if separator null for Class cl models CsvRecord record cl getAnnotation CsvRecord class Section section cl getAnnotation Section class if record null LOG debug record skipFirstLine record skipFirstLine LOG debug skipFirstLine skipField record skipField
private void initCsvRecordParameters if separator null for Class cl models CsvRecord record cl getAnnotation CsvRecord class Section section cl getAnnotation Section class if record null LOG debug record skipFirstLine record skipFirstLine LOG debug skipFirstLine skipField record skipField LOG debug skipField generateHeaderColumnNames record generateHeaderColumns
private void initCsvRecordParameters if separator null for Class cl models CsvRecord record cl getAnnotation CsvRecord class Section section cl getAnnotation Section class if record null LOG debug record skipFirstLine record skipFirstLine LOG debug skipFirstLine skipField record skipField LOG debug skipField generateHeaderColumnNames record generateHeaderColumns LOG debug generateHeaderColumnNames org apache camel util ObjectHelper notNull record separator separator record separator
for Class cl models CsvRecord record cl getAnnotation CsvRecord class Section section cl getAnnotation Section class if record null LOG debug record skipFirstLine record skipFirstLine LOG debug skipFirstLine skipField record skipField LOG debug skipField generateHeaderColumnNames record generateHeaderColumns LOG debug generateHeaderColumnNames org apache camel util ObjectHelper notNull record separator separator record separator LOG debug separator crlf record crlf
Section section cl getAnnotation Section class if record null LOG debug record skipFirstLine record skipFirstLine LOG debug skipFirstLine skipField record skipField LOG debug skipField generateHeaderColumnNames record generateHeaderColumns LOG debug generateHeaderColumnNames org apache camel util ObjectHelper notNull record separator separator record separator LOG debug separator crlf record crlf LOG debug crlf messageOrdered record isOrdered
skipFirstLine record skipFirstLine LOG debug skipFirstLine skipField record skipField LOG debug skipField generateHeaderColumnNames record generateHeaderColumns LOG debug generateHeaderColumnNames org apache camel util ObjectHelper notNull record separator separator record separator LOG debug separator crlf record crlf LOG debug crlf messageOrdered record isOrdered LOG debug messageOrdered if org apache camel util ObjectHelper isNotEmpty record quote quote record quote
skipField record skipField LOG debug skipField generateHeaderColumnNames record generateHeaderColumns LOG debug generateHeaderColumnNames org apache camel util ObjectHelper notNull record separator separator record separator LOG debug separator crlf record crlf LOG debug crlf messageOrdered record isOrdered LOG debug messageOrdered if org apache camel util ObjectHelper isNotEmpty record quote quote record quote LOG debug quote quoting record quoting
generateHeaderColumnNames record generateHeaderColumns LOG debug generateHeaderColumnNames org apache camel util ObjectHelper notNull record separator separator record separator LOG debug separator crlf record crlf LOG debug crlf messageOrdered record isOrdered LOG debug messageOrdered if org apache camel util ObjectHelper isNotEmpty record quote quote record quote LOG debug quote quoting record quoting LOG debug quoting autospanLine record autospanLine
org apache camel util ObjectHelper notNull record separator separator record separator LOG debug separator crlf record crlf LOG debug crlf messageOrdered record isOrdered LOG debug messageOrdered if org apache camel util ObjectHelper isNotEmpty record quote quote record quote LOG debug quote quoting record quoting LOG debug quoting autospanLine record autospanLine LOG debug autospanLine allowEmptyStream record allowEmptyStream
LOG debug separator crlf record crlf LOG debug crlf messageOrdered record isOrdered LOG debug messageOrdered if org apache camel util ObjectHelper isNotEmpty record quote quote record quote LOG debug quote quoting record quoting LOG debug quoting autospanLine record autospanLine LOG debug autospanLine allowEmptyStream record allowEmptyStream LOG debug allowEmptyStream quotingEscaped record quotingEscaped
LOG debug crlf messageOrdered record isOrdered LOG debug messageOrdered if org apache camel util ObjectHelper isNotEmpty record quote quote record quote LOG debug quote quoting record quoting LOG debug quoting autospanLine record autospanLine LOG debug autospanLine allowEmptyStream record allowEmptyStream LOG debug allowEmptyStream quotingEscaped record quotingEscaped LOG debug quotingEscaped endWithLineBreak record endWithLineBreak
LOG debug messageOrdered if org apache camel util ObjectHelper isNotEmpty record quote quote record quote LOG debug quote quoting record quoting LOG debug quoting autospanLine record autospanLine LOG debug autospanLine allowEmptyStream record allowEmptyStream LOG debug allowEmptyStream quotingEscaped record quotingEscaped LOG debug quotingEscaped endWithLineBreak record endWithLineBreak LOG debug endWithLineBreak removeQuotes record removeQuotes
Override public void initAnnotatedFields for Class cl models List Field linkFields new ArrayList if LOG isDebugEnabled
LOG debug cl getName for Field field cl getDeclaredFields DataField dataField field getAnnotation DataField class if dataField null if LOG isDebugEnabled LOG debug cl getName dataField pos dataField if dataField required numberMandatoryFields else numberOptionalFields dataFields put dataField pos dataField annotatedFields put dataField pos field Link linkField field getAnnotation Link class if linkField null if LOG isDebugEnabled
LOG debug cl getName dataField pos dataField if dataField required numberMandatoryFields else numberOptionalFields dataFields put dataField pos dataField annotatedFields put dataField pos field Link linkField field getAnnotation Link class if linkField null if LOG isDebugEnabled LOG debug cl getName field linkFields add field if linkFields isEmpty annotatedLinkFields put cl getName linkFields totalFields numberMandatoryFields numberOptionalFields
if dataField required numberMandatoryFields else numberOptionalFields dataFields put dataField pos dataField annotatedFields put dataField pos field Link linkField field getAnnotation Link class if linkField null if LOG isDebugEnabled LOG debug cl getName field linkFields add field if linkFields isEmpty annotatedLinkFields put cl getName linkFields totalFields numberMandatoryFields numberOptionalFields if LOG isDebugEnabled
if dataField required numberMandatoryFields else numberOptionalFields dataFields put dataField pos dataField annotatedFields put dataField pos field Link linkField field getAnnotation Link class if linkField null if LOG isDebugEnabled LOG debug cl getName field linkFields add field if linkFields isEmpty annotatedLinkFields put cl getName linkFields totalFields numberMandatoryFields numberOptionalFields if LOG isDebugEnabled
while itr hasNext dataField itr next length dataField length delimiter dataField delimiter if length dataField lengthPos Field lengthField annotatedFields get dataField lengthPos lengthField setAccessible true Object modelObj model get lengthField getDeclaringClass getName Object lengthObj lengthField get modelObj length Integer lengthObj intValue if length delimiter null dataField lengthPos throw new IllegalArgumentException dataField toString if offset throw new IllegalArgumentException dataField toString if dataField pos offset
int endIndex offset length if endIndex record length endIndex record length token record substring offset endIndex offset length else if delimiter equals final UnicodeHelper tempToken new UnicodeHelper record substring offset record length this countGrapheme UnicodeHelper Method GRAPHEME UnicodeHelper Method CODEPOINTS token tempToken substring tempToken indexOf delimiter offset token length else token if dataField trim token trim token dataField paddingChar if dataField required counterMandatoryFields
Override public String unbind CamelContext camelContext Map String Object model throws Exception StringBuilder buffer new StringBuilder Map Integer List String results new HashMap for Class clazz models if model containsKey clazz getName Object obj model get clazz getName if LOG isDebugEnabled
else padChar padCharField if align contains temp append generatePaddingChars padChar fieldLength result length temp append result else if align contains temp append result temp append generatePaddingChars padChar fieldLength result length else if align contains temp append generatePaddingChars padChar fieldLength result length temp append result else throw new IllegalArgumentException field getName result temp toString else if result length fieldLength
private void initFixedLengthRecordParameters for Class cl models FixedLengthRecord record cl getAnnotation FixedLengthRecord class if record null
private void initFixedLengthRecordParameters for Class cl models FixedLengthRecord record cl getAnnotation FixedLengthRecord class if record null LOG debug record crlf record crlf
private void initFixedLengthRecordParameters for Class cl models FixedLengthRecord record cl getAnnotation FixedLengthRecord class if record null LOG debug record crlf record crlf LOG debug crlf eol record eol
private void initFixedLengthRecordParameters for Class cl models FixedLengthRecord record cl getAnnotation FixedLengthRecord class if record null LOG debug record crlf record crlf LOG debug crlf eol record eol LOG debug eol header record header
private void initFixedLengthRecordParameters for Class cl models FixedLengthRecord record cl getAnnotation FixedLengthRecord class if record null LOG debug record crlf record crlf LOG debug crlf eol record eol LOG debug eol header record header LOG debug header hasHeader header void class
private void initFixedLengthRecordParameters for Class cl models FixedLengthRecord record cl getAnnotation FixedLengthRecord class if record null LOG debug record crlf record crlf LOG debug crlf eol record eol LOG debug eol header record header LOG debug header hasHeader header void class LOG debug hasHeader skipHeader record skipHeader
for Class cl models FixedLengthRecord record cl getAnnotation FixedLengthRecord class if record null LOG debug record crlf record crlf LOG debug crlf eol record eol LOG debug eol header record header LOG debug header hasHeader header void class LOG debug hasHeader skipHeader record skipHeader LOG debug skipHeader footer record footer
if record null LOG debug record crlf record crlf LOG debug crlf eol record eol LOG debug eol header record header LOG debug header hasHeader header void class LOG debug hasHeader skipHeader record skipHeader LOG debug skipHeader footer record footer LOG debug footer hasFooter record footer void class
crlf record crlf LOG debug crlf eol record eol LOG debug eol header record header LOG debug header hasHeader header void class LOG debug hasHeader skipHeader record skipHeader LOG debug skipHeader footer record footer LOG debug footer hasFooter record footer void class LOG debug hasFooter skipFooter record skipFooter
eol record eol LOG debug eol header record header LOG debug header hasHeader header void class LOG debug hasHeader skipHeader record skipHeader LOG debug skipHeader footer record footer LOG debug footer hasFooter record footer void class LOG debug hasFooter skipFooter record skipFooter LOG debug skipFooter isHeader hasHeader cl equals header false
header record header LOG debug header hasHeader header void class LOG debug hasHeader skipHeader record skipHeader LOG debug skipHeader footer record footer LOG debug footer hasFooter record footer void class LOG debug hasFooter skipFooter record skipFooter LOG debug skipFooter isHeader hasHeader cl equals header false LOG debug isHeader isFooter hasFooter cl equals footer false
hasHeader header void class LOG debug hasHeader skipHeader record skipHeader LOG debug skipHeader footer record footer LOG debug footer hasFooter record footer void class LOG debug hasFooter skipFooter record skipFooter LOG debug skipFooter isHeader hasHeader cl equals header false LOG debug isHeader isFooter hasFooter cl equals footer false LOG debug isFooter paddingChar record paddingChar
skipHeader record skipHeader LOG debug skipHeader footer record footer LOG debug footer hasFooter record footer void class LOG debug hasFooter skipFooter record skipFooter LOG debug skipFooter isHeader hasHeader cl equals header false LOG debug isHeader isFooter hasFooter cl equals footer false LOG debug isFooter paddingChar record paddingChar LOG debug paddingChar recordLength record length
footer record footer LOG debug footer hasFooter record footer void class LOG debug hasFooter skipFooter record skipFooter LOG debug skipFooter isHeader hasHeader cl equals header false LOG debug isHeader isFooter hasFooter cl equals footer false LOG debug isFooter paddingChar record paddingChar LOG debug paddingChar recordLength record length LOG debug recordLength ignoreTrailingChars record ignoreTrailingChars
hasFooter record footer void class LOG debug hasFooter skipFooter record skipFooter LOG debug skipFooter isHeader hasHeader cl equals header false LOG debug isHeader isFooter hasFooter cl equals footer false LOG debug isFooter paddingChar record paddingChar LOG debug paddingChar recordLength record length LOG debug recordLength ignoreTrailingChars record ignoreTrailingChars LOG debug ignoreTrailingChars ignoreMissingChars record ignoreMissingChars
skipFooter record skipFooter LOG debug skipFooter isHeader hasHeader cl equals header false LOG debug isHeader isFooter hasFooter cl equals footer false LOG debug isFooter paddingChar record paddingChar LOG debug paddingChar recordLength record length LOG debug recordLength ignoreTrailingChars record ignoreTrailingChars LOG debug ignoreTrailingChars ignoreMissingChars record ignoreMissingChars LOG debug ignoreMissingChars countGrapheme record countGrapheme
Override public void initAnnotatedFields for Class cl models List Field linkFields new ArrayList for Field field cl getDeclaredFields KeyValuePairField keyValuePairField field getAnnotation KeyValuePairField class if keyValuePairField null if LOG isDebugEnabled
public void bind CamelContext camelContext List String data Map String Object model int line Map String List Object lists throws Exception Map Integer List String results new HashMap
public void bind CamelContext camelContext List String data Map String Object model int line Map String List Object lists throws Exception Map Integer List String results new HashMap LOG debug data ObjectHelper notNull keyValuePairSeparator for String s data String keyValuePair s split getKeyValuePairSeparator if keyValuePair length int key Integer parseInt keyValuePair String value keyValuePair
try field set obj result catch Exception e throw new IllegalArgumentException field obj result if l isEmpty l set obj else l add obj lists put clazz getName l obj null else throw new IllegalArgumentException key clazz getName else if values size if obj null
else if values size if obj null value values get Object result null if value null FormattingOptions formattingOptions ConverterUtils convert keyValuePairField field getType field getAnnotation BindyConverter class getLocale Format format formatFactory getFormat formattingOptions result formatField format value key line LOG debug result else result getDefaultValueForPrimitive field getType try field set obj result catch Exception e
Override public String unbind CamelContext camelContext Map String Object model throws Exception StringBuilder builder new StringBuilder Map Integer KeyValuePairField keyValuePairFieldsSorted new TreeMap keyValuePairFields Iterator Integer it keyValuePairFieldsSorted keySet iterator Map Integer String positions new TreeMap ObjectHelper notNull this pairSeparator char separator ConverterUtils getCharDelimiter this getPairSeparator if LOG isDebugEnabled
Override public String unbind CamelContext camelContext Map String Object model throws Exception StringBuilder builder new StringBuilder Map Integer KeyValuePairField keyValuePairFieldsSorted new TreeMap keyValuePairFields Iterator Integer it keyValuePairFieldsSorted keySet iterator Map Integer String positions new TreeMap ObjectHelper notNull this pairSeparator char separator ConverterUtils getCharDelimiter this getPairSeparator if LOG isDebugEnabled LOG debug Integer toHexString separator this getPairSeparator while it hasNext KeyValuePairField keyValuePairField keyValuePairFieldsSorted get it next ObjectHelper notNull keyValuePairField Field field annotatedFields get keyValuePairField tag field setAccessible true if LOG isDebugEnabled
while it hasNext KeyValuePairField keyValuePairField keyValuePairFieldsSorted get it next ObjectHelper notNull keyValuePairField Field field annotatedFields get keyValuePairField tag field setAccessible true if LOG isDebugEnabled LOG debug keyValuePairField tag field getType field getDeclaringClass getName FormattingOptions formattingOptions ConverterUtils convert keyValuePairField field getType field getAnnotation BindyConverter class getLocale Format Object format Format Object formatFactory getFormat formattingOptions Object obj model get field getDeclaringClass getName if obj null Object keyValue field get obj if this isMessageOrdered Integer key1 sections get obj getClass getName Integer key2 keyValuePairField position
ObjectHelper notNull keyValuePairField Field field annotatedFields get keyValuePairField tag field setAccessible true if LOG isDebugEnabled LOG debug keyValuePairField tag field getType field getDeclaringClass getName FormattingOptions formattingOptions ConverterUtils convert keyValuePairField field getType field getAnnotation BindyConverter class getLocale Format Object format Format Object formatFactory getFormat formattingOptions Object obj model get field getDeclaringClass getName if obj null Object keyValue field get obj if this isMessageOrdered Integer key1 sections get obj getClass getName Integer key2 keyValuePairField position LOG debug key1 key2 Integer keyGenerated generateKey key1 key2
if obj null Object keyValue field get obj if this isMessageOrdered Integer key1 sections get obj getClass getName Integer key2 keyValuePairField position LOG debug key1 key2 Integer keyGenerated generateKey key1 key2 if LOG isDebugEnabled LOG debug String valueOf keyGenerated key1 if keyValue null String valueFormatted try valueFormatted format format keyValue catch Exception e throw new IllegalArgumentException keyValuePairField tag e
catch Exception e throw new IllegalArgumentException keyValuePairField tag e String value keyValuePairField tag this getKeyValuePairSeparator valueFormatted if LOG isDebugEnabled LOG debug keyValue keyValuePairField tag valueFormatted positions put keyGenerated value if LOG isDebugEnabled LOG debug positions size else if keyValue null String valueFormatted try valueFormatted format format keyValue catch Exception e throw new IllegalArgumentException keyValuePairField tag e
LOG debug keyValue keyValuePairField tag valueFormatted positions put keyGenerated value if LOG isDebugEnabled LOG debug positions size else if keyValue null String valueFormatted try valueFormatted format format keyValue catch Exception e throw new IllegalArgumentException keyValuePairField tag e String value keyValuePairField tag this getKeyValuePairSeparator valueFormatted separator builder append value if LOG isDebugEnabled LOG debug keyValuePairField tag this getKeyValuePairSeparator valueFormatted separator
private void initMessageParameters if pairSeparator null keyValuePairSeparator null for Class cl models Message message cl getAnnotation Message class Section section cl getAnnotation Section class if message null ObjectHelper notNull message pairSeparator pairSeparator message pairSeparator
private void initMessageParameters if pairSeparator null keyValuePairSeparator null for Class cl models Message message cl getAnnotation Message class Section section cl getAnnotation Section class if message null ObjectHelper notNull message pairSeparator pairSeparator message pairSeparator LOG debug pairSeparator ObjectHelper notNull message keyValuePairSeparator keyValuePairSeparator message keyValuePairSeparator
private void initMessageParameters if pairSeparator null keyValuePairSeparator null for Class cl models Message message cl getAnnotation Message class Section section cl getAnnotation Section class if message null ObjectHelper notNull message pairSeparator pairSeparator message pairSeparator LOG debug pairSeparator ObjectHelper notNull message keyValuePairSeparator keyValuePairSeparator message keyValuePairSeparator LOG debug keyValuePairSeparator crlf message crlf
private void initMessageParameters if pairSeparator null keyValuePairSeparator null for Class cl models Message message cl getAnnotation Message class Section section cl getAnnotation Section class if message null ObjectHelper notNull message pairSeparator pairSeparator message pairSeparator LOG debug pairSeparator ObjectHelper notNull message keyValuePairSeparator keyValuePairSeparator message keyValuePairSeparator LOG debug keyValuePairSeparator crlf message crlf LOG debug crlf messageOrdered message isOrdered
Map String Object model model factory factory Pattern pattern Pattern compile separator Matcher matcher pattern matcher trimmedLine List String separators new ArrayList while matcher find separators add matcher group if separators size separators add separators get separators size String tokens pattern split trimmedLine factory getAutospanLine factory getMaxpos List String result Arrays asList tokens if removeQuotes result unquoteTokens result separators quote if result isEmpty throw new IllegalArgumentException
List String separators new ArrayList while matcher find separators add matcher group if separators size separators add separators get separators size String tokens pattern split trimmedLine factory getAutospanLine factory getMaxpos List String result Arrays asList tokens if removeQuotes result unquoteTokens result separators quote if result isEmpty throw new IllegalArgumentException else if LOG isDebugEnabled LOG debug result size factory bind getCamelContext result model count get
Test public void testOneGroupMessage throws Exception String message List String data Arrays asList message split CamelContext camelContext new DefaultCamelContext factory bind camelContext data model counter
Test public void testSeveralGroupMessage throws Exception String message List String data Arrays asList message split CamelContext camelContext new DefaultCamelContext factory bind camelContext data model counter
Test public void testNoGroupMessage throws Exception String message List String data Arrays asList message split CamelContext camelContext new DefaultCamelContext factory bind camelContext data model counter
public Collection BoxCollaboration Info getFolderCollaborations String folderId try
public BoxCollaboration addFolderCollaborationByEmail String folderId String email BoxCollaboration Role role try
public BoxCollaboration Info getCollaborationInfo String collaborationId try
public BoxCollaboration updateCollaborationInfo String collaborationId BoxCollaboration Info info try
public void deleteCollaboration String collaborationId try
public BoxFile addFileComment String fileId String message try
public List BoxComment Info getFileComments String fileId try
public BoxComment Info getCommentInfo String commentId try
public BoxComment replyToComment String commentId String message try
public BoxComment changeCommentMessage String commentId String message try
public void deleteComment String commentId try
public void listen EventListener listener Long startingPosition try
public BoxFile Info getFileInfo String fileId String fields try
public BoxFile updateFileInfo String fileId BoxFile Info info try
public BoxFile uploadFile String parentFolderId InputStream content String fileName Date created Date modified Long size Boolean check ProgressListener listener try
public BoxFile uploadNewFileVersion String fileId InputStream fileContent Date modified Long fileSize ProgressListener listener try
public Collection BoxFileVersion getFileVersions String fileId try
public OutputStream downloadFile String fileId OutputStream output Long rangeStart Long rangeEnd ProgressListener listener try
public OutputStream downloadPreviousFileVersion String fileId Integer version OutputStream output ProgressListener listener try
public BoxFileVersion promoteFileVersion String fileId Integer version try
public BoxFile copyFile String fileId String destinationFolderId String newName try
public BoxFile moveFile String fileId String destinationFolderId String newName try
public BoxFile renameFile String fileId String newFileName try
public void deleteFile String fileId try
public void deleteFileVersion String fileId Integer version try
public BoxSharedLink createFileSharedLink String fileId BoxSharedLink Access access Date unshareDate BoxSharedLink Permissions permissions try
public URL getDownloadURL String fileId try
public URL getFilePreviewLink String fileId try
public byte getFileThumbnail String fileId BoxFile ThumbnailFileType fileType Integer minWidth Integer minHeight Integer maxWidth Integer maxHeight try
public Metadata createFileMetadata String fileId Metadata metadata String typeName try
public Metadata getFileMetadata String fileId String typeName try
public Metadata updateFileMetadata String fileId Metadata metadata try
public void deleteFileMetadata String fileId try
public void checkUpload String fileName String parentFolderId Long size try
public BoxFolder getFolder String path try
public Collection BoxItem Info getFolderItems String folderId Long offset Long limit String fields try
public BoxFolder createFolder String parentFolderId String folderName try
public BoxFolder createFolder String parentFolderId String path try
public BoxFolder copyFolder String folderId String destinationFolderId String newName try
public BoxFolder moveFolder String folderId String destinationFolderId String newName try
public BoxFolder renameFolder String folderId String newFolderName try
public void deleteFolder String folderId try
public BoxFolder Info getFolderInfo String folderId String fields try
public BoxFolder updateFolderInfo String folderId BoxFolder Info info try
public BoxSharedLink createFolderSharedLink String folderId BoxSharedLink Access access Date unshareDate BoxSharedLink Permissions permissions try
public BoxGroup createGroup String name String provenance String externalSyncIdentifier String description String invitabilityLevel String memberViewabilityLevel try
public void deleteGroup String groupId try
public BoxGroup Info getGroupInfo String groupId try
public BoxGroup updateGroupInfo String groupId BoxGroup Info groupInfo try
public Collection BoxGroupMembership Info getGroupMemberships String groupId try
public BoxGroupMembership addGroupMembership String groupId String userId BoxGroupMembership Role role try
public void deleteGroupMembership String groupMembershipId try
public BoxGroupMembership Info getGroupMembershipInfo String groupMembershipId try
public BoxGroupMembership updateGroupMembershipInfo String groupMembershipId BoxGroupMembership Info info try
public Collection BoxItem searchFolder String folderId String query try
public List BoxTask Info getFileTasks String fileId try
public BoxTask addFileTask String fileId BoxTask Action action Date dueAt String message try
public void deleteTask String taskId try
public BoxTask Info getTaskInfo String taskId try
public BoxTask updateTaskInfo String taskId BoxTask Info info try
public List BoxTaskAssignment Info getTaskAssignments String taskId try
public BoxTaskAssignment Info getTaskAssignmentInfo String taskAssignmentId try
public void deleteTaskAssignment String taskAssignmentId try
public List BoxUser Info getAllEnterpriseOrExternalUsers String filterTerm String fields try
public BoxUser createEnterpriseUser String login String name CreateUserParams params try
public BoxUser createAppUser String name CreateUserParams params try
public BoxUser Info getUserInfo String userId try
public BoxUser updateUserInfo String userId BoxUser Info info try
public void deleteUser String userId boolean notifyUser boolean force try
public EmailAlias addUserEmailAlias String userId String email try
public Collection EmailAlias getUserEmailAlias String userId try
public void deleteUserEmailAlias String userId String emailAliasId try
public BoxFolder Info moveFolderToUser String userId String sourceUserId try
Override public void onEvent BoxEvent event try
Test public void testAddFolderCollaborationByEmail throws Exception deleteTestCollaborator final Map String Object headers new HashMap headers put testFolder getID headers put CAMEL_TEST_COLLABORATOR_EMAIL headers put BoxCollaboration Role EDITOR final com box sdk BoxCollaboration result requestBodyAndHeaders testFolder getID headers assertNotNull result
Disabled Test public void testAddFolderCollaboration throws Exception deleteTestCollaborator BoxUser user null try CreateUserParams params new CreateUserParams params setSpaceAmount user BoxUser createAppUser getConnection CAMEL_TEST_COLLABORATOR_NAME params getResource final Map String Object headers new HashMap headers put testFolder getID headers put user headers put BoxCollaboration Role EDITOR final com box sdk BoxCollaboration result requestBodyAndHeaders testFolder getID headers assertNotNull result
Test public void testGetCollaborationInfo throws Exception final com box sdk BoxCollaboration Info result requestBody testCollaboration getID assertNotNull result
Test public void testGetFolderCollaborations throws Exception SuppressWarnings final java util Collection result requestBody testFolder getID assertNotNull result
SuppressWarnings Test public void testGetPendingCollaborations throws Exception final java util Collection result requestBody null assertNotNull result
Test public void testUpdateCollaborationInfo throws Exception final Map String Object headers new HashMap headers put testCollaboration getID BoxCollaboration Info info testCollaboration getInfo info setRole BoxCollaboration Role PREVIEWER headers put info final com box sdk BoxCollaboration result requestBodyAndHeaders null headers assertNotNull result assertNotNull result getInfo assertEquals BoxCollaboration Role PREVIEWER result getInfo getRole
Test public void testAddFileComment throws Exception final Map String Object headers new HashMap headers put testFile getID headers put CAMEL_TEST_FILE_COMMENT final com box sdk BoxFile result requestBodyAndHeaders null headers assertNotNull result assertNotNull result getComments assertTrue result getComments size assertEquals CAMEL_TEST_FILE_COMMENT result getComments get getMessage
Test public void testChangeCommentMessage throws Exception BoxComment Info commentInfo testFile addComment CAMEL_TEST_FILE_COMMENT final Map String Object headers new HashMap headers put commentInfo getID headers put CAMEL_TEST_FILE_CHANGED_COMMENT final com box sdk BoxComment result requestBodyAndHeaders null headers assertNotNull result assertNotNull result getInfo getMessage assertEquals CAMEL_TEST_FILE_CHANGED_COMMENT result getInfo getMessage
Test public void testGetCommentInfo throws Exception BoxComment Info commentInfo testFile addComment CAMEL_TEST_FILE_COMMENT final com box sdk BoxComment Info result requestBody commentInfo getID assertNotNull result assertEquals CAMEL_TEST_FILE_COMMENT result getMessage
Test public void testGetFileComments throws Exception testFile addComment CAMEL_TEST_FILE_COMMENT SuppressWarnings final java util List result requestBody testFile getID assertNotNull result assertEquals result size
Test public void testReplyToComment throws Exception BoxComment Info commentInfo testFile addComment CAMEL_TEST_FILE_COMMENT final Map String Object headers new HashMap headers put commentInfo getID headers put CAMEL_TEST_FILE_REPLY_COMMENT final com box sdk BoxComment result requestBodyAndHeaders null headers assertNotNull result assertEquals CAMEL_TEST_FILE_REPLY_COMMENT result getInfo getMessage
Disabled Test public void testGetEnterpriseEvents throws Exception Date before new Date Date after new Date after setTime before getTime ONE_MINUTE_OF_MILLISECONDS final Map String Object headers new HashMap headers put null headers put after headers put before headers put null SuppressWarnings final java util List result requestBodyAndHeaders null headers assertNotNull result
Test public void testCopyFile throws Exception com box sdk BoxFile result null try final Map String Object headers new HashMap headers put testFile getID headers put headers put CAMEL_TEST_COPY_FILE_NAME result requestBodyAndHeaders null headers assertNotNull result assertEquals CAMEL_TEST_COPY_FILE_NAME result getInfo getName
Test public void testCreateFileMetadata throws Exception Metadata metadata new Metadata metadata add final Map String Object headers new HashMap headers put testFile getID headers put metadata headers put null final com box sdk Metadata result requestBodyAndHeaders null headers assertNotNull result assertEquals result get
Test public void testCreateFileSharedLink throws Exception final Map String Object headers new HashMap headers put testFile getID headers put BoxSharedLink Access DEFAULT headers put null headers put null final com box sdk BoxSharedLink result requestBodyAndHeaders null headers assertNotNull result
Test public void testDeleteFile throws Exception requestBody testFile getID BoxFolder rootFolder BoxFolder getRootFolder getConnection Iterable BoxItem Info it rootFolder search CAMEL_TEST_FILE int searchResults sizeOfIterable it boolean exists searchResults true false assertFalse exists
Test public void testDownloadFile throws Exception final Map String Object headers new HashMap headers put testFile getID ByteArrayOutputStream output new ByteArrayOutputStream headers put output headers put null headers put null headers put null final java io OutputStream result requestBodyAndHeaders null headers assertNotNull result
Disabled Test public void testDownloadPreviousFileVersion throws Exception final Map String Object headers new HashMap headers put testFile getID headers put ByteArrayOutputStream output new ByteArrayOutputStream headers put output headers put null final java io OutputStream result requestBodyAndHeaders null headers assertNotNull result
Test public void testGetDownloadURL throws Exception final java net URL result requestBody testFile getID assertNotNull result
Test public void testGetFileInfo throws Exception final Map String Object headers new HashMap headers put testFile getID headers put null final com box sdk BoxFile Info result requestBodyAndHeaders null headers assertNotNull result
Test public void testGetFileMetadata throws Exception testFile createMetadata new Metadata final Map String Object headers new HashMap headers put testFile getID headers put null final com box sdk Metadata result requestBodyAndHeaders null headers assertNotNull result
Test public void testGetFilePreviewLink throws Exception final java net URL result requestBody testFile getID assertNotNull result
Test public void testGetFileThumbnail throws Exception final Map String Object headers new HashMap headers put testFile getID headers put ThumbnailFileType JPG headers put headers put headers put headers put final byte result requestBodyAndHeaders null headers assertNotNull result
Test public void testGetFileVersions throws Exception SuppressWarnings final java util Collection result requestBody testFile getID assertNotNull result
Test public void testMoveFile throws Exception com box sdk BoxFile result null try final Map String Object headers new HashMap headers put testFile getID headers put headers put CAMEL_TEST_MOVE_FILE_NAME result requestBodyAndHeaders null headers assertNotNull result assertEquals CAMEL_TEST_MOVE_FILE_NAME result getInfo getName
Disabled Test public void testPromoteFileVersion throws Exception testFile uploadVersion getClass getResourceAsStream CAMEL_TEST_FILE final Map String Object headers new HashMap headers put testFile getID headers put final com box sdk BoxFileVersion result requestBodyAndHeaders null headers assertNotNull result
Test public void testRenameFile throws Exception com box sdk BoxFile result null try final Map String Object headers new HashMap headers put testFile getID headers put CAMEL_TEST_RENAME_FILE_NAME result requestBodyAndHeaders null headers assertNotNull result assertEquals CAMEL_TEST_RENAME_FILE_NAME result getInfo getName
Test public void testUpdateFileInfo throws Exception BoxFile Info info testFile getInfo info setDescription CAMEL_TEST_FILE_DESCRIPTION final Map String Object headers new HashMap headers put testFile getID headers put info final com box sdk BoxFile result requestBodyAndHeaders null headers assertNotNull result assertEquals CAMEL_TEST_FILE_DESCRIPTION result getInfo getDescription
Test public void testUpdateFileMetadata throws Exception Metadata metadata new Metadata metadata testFile createMetadata metadata final Map String Object headers new HashMap headers put testFile getID headers put metadata metadata add final com box sdk Metadata result requestBodyAndHeaders null headers assertNotNull result assertNotNull result get assertEquals metadata get
Test public void testUploadFile throws Exception com box sdk BoxFile result null try final Map String Object headers new HashMap headers put headers put getClass getResourceAsStream CAMEL_TEST_FILE headers put CAMEL_TEST_UPLOAD_FILE_NAME headers put null headers put null headers put null headers put null result requestBodyAndHeaders null headers assertNotNull result
Test public void testUploadOverwriteFile throws Exception com box sdk BoxFile result null try final Map String Object headers new HashMap String Object headers put headers put getClass getResourceAsStream CAMEL_TEST_FILE headers put CAMEL_TEST_UPLOAD_FILE_NAME headers put null headers put null headers put null headers put null result requestBodyAndHeaders null headers assertNotNull result result requestBodyAndHeaders null headers assertNotNull result
Test public void testUploadNewFileVersion throws Exception com box sdk BoxFile result null try final Map String Object headers new HashMap headers put testFile getID headers put getClass getResourceAsStream CAMEL_TEST_FILE headers put null headers put null headers put null result requestBodyAndHeaders null headers assertNotNull result
Test public void testCreateFolder throws Exception deleteTestFolder final Map String Object headers new HashMap headers put headers put CAMEL_TEST_FOLDER testFolder requestBodyAndHeaders null headers assertNotNull testFolder assertEquals CAMEL_TEST_FOLDER testFolder getInfo getName
Test public void testCreateFolderByPath throws Exception deleteTestFolder final Map String Object headers new HashMap headers put headers put new String CAMEL_TEST_FOLDER testFolder requestBodyAndHeaders null headers assertNotNull testFolder assertEquals CAMEL_TEST_FOLDER testFolder getInfo getName
Test public void testCopyFolder throws Exception com box sdk BoxFolder result null try final Map String Object headers new HashMap headers put testFolder getID headers put CAMEL_TEST_DESTINATION_FOLDER_ID headers put CAMEL_TEST_COPY_FOLDER result requestBodyAndHeaders null headers assertNotNull result assertEquals CAMEL_TEST_COPY_FOLDER result getInfo getName
Test public void testCreateSharedLink throws Exception final Map String Object headers new HashMap headers put testFolder getID headers put BoxSharedLink Access COLLABORATORS headers put null headers put new BoxSharedLink Permissions final com box sdk BoxSharedLink result requestBodyAndHeaders null headers assertNotNull result
Test public void testGetFolder throws Exception final com box sdk BoxFolder result requestBody new String CAMEL_TEST_FOLDER assertNotNull result assertEquals testFolder getID result getID
Test public void testGetFolderInfo throws Exception final Map String Object headers new HashMap headers put testFolder getID headers put new String final com box sdk BoxFolder Info result requestBodyAndHeaders null headers assertNotNull result assertNotNull result getName assertEquals CAMEL_TEST_FOLDER result getName
Test public void testGetFolderItems throws Exception final Map String Object headers new HashMap headers put CAMEL_TEST_ROOT_FOLDER_ID headers put null headers put null headers put null SuppressWarnings final java util Collection result requestBodyAndHeaders null headers assertNotNull result
Test public void testGetRootFolder throws Exception final com box sdk BoxFolder result requestBody null assertNotNull result
Test public void testMoveFolder throws Exception final Map String Object headers new HashMap headers put testFolder getID headers put CAMEL_TEST_DESTINATION_FOLDER_ID headers put CAMEL_TEST_MOVE_FOLDER final com box sdk BoxFolder result requestBodyAndHeaders null headers assertNotNull result assertEquals CAMEL_TEST_MOVE_FOLDER result getInfo getName
Test public void testRenameFolder throws Exception final Map String Object headers new HashMap headers put testFolder getID headers put CAMEL_TEST_RENAME_FOLDER final com box sdk BoxFolder result requestBodyAndHeaders null headers assertNotNull result assertEquals CAMEL_TEST_RENAME_FOLDER result getInfo getName
Test public void testUpdateInfo throws Exception final BoxFolder Info testFolderInfo testFolder getInfo final Map String Object headers new HashMap headers put testFolder getID testFolderInfo setDescription CAMEL_TEST_FOLDER_DESCRIPTION headers put testFolderInfo final com box sdk BoxFolder result requestBodyAndHeaders null headers assertNotNull result assertEquals CAMEL_TEST_FOLDER_DESCRIPTION result getInfo getDescription
Test public void testAddGroupMembership throws Exception final Map String Object headers new HashMap headers put testGroup getID headers put testUser getID headers put null final com box sdk BoxGroupMembership result requestBodyAndHeaders null headers assertNotNull result
Test public void testCreateGroup throws Exception com box sdk BoxGroup result null try result requestBody CAMEL_TEST_CREATE_GROUP_NAME assertNotNull result assertEquals CAMEL_TEST_CREATE_GROUP_NAME result getInfo getName
Test public void testGetAllGroups throws Exception SuppressWarnings final java util Collection result requestBody null assertNotNull result
Test public void testGetGroupInfo throws Exception final com box sdk BoxGroup Info result requestBody testGroup getID assertNotNull result
Test public void testUpdateGroupInfo throws Exception BoxGroup Info info testGroup getInfo info setDescription CAMEL_TEST_GROUP_DESCRIPTION try final Map String Object headers new HashMap headers put testGroup getID headers put info final com box sdk BoxGroup result requestBodyAndHeaders null headers assertNotNull result
Test public void testGetGroupMembershipInfo throws Exception BoxGroupMembership Info info testGroup addMembership testUser BoxGroupMembership Role MEMBER final com box sdk BoxGroupMembership Info result requestBody info getID assertNotNull result
Test public void testGetGroupMemberships throws Exception SuppressWarnings final java util Collection result requestBody testGroup getID assertNotNull result
Test public void testUpdateGroupMembershipInfo throws Exception BoxGroupMembership Info info testGroup addMembership testUser BoxGroupMembership Role MEMBER info setRole BoxGroupMembership Role ADMIN final Map String Object headers new HashMap headers put info getID headers put info final com box sdk BoxGroupMembership result requestBodyAndHeaders null headers assertNotNull result
Test public void testSearchFolder final Map String Object headers new HashMap headers put headers put SuppressWarnings final java util Collection result requestBodyAndHeaders null headers assertNotNull result
Disabled Test public void testAddAssignmentToTask throws Exception com box sdk BoxTask result null final Map String Object headers new HashMap headers put testTask getID headers put getCurrentUser result requestBodyAndHeaders null headers assertNotNull result
Test public void testAddFileTask throws Exception com box sdk BoxTask result null try final Map String Object headers new HashMap headers put testFile getID headers put BoxTask Action REVIEW Date now new Date Date dueAt new Date now getTime TEN_MINUTES_IN_MILLIS headers put dueAt headers put CAMEL_TEST_MESSAGE result requestBodyAndHeaders null headers assertNotNull result
Test public void testGetFileTasks throws Exception SuppressWarnings final java util List result requestBody testFile getID assertNotNull result
Disabled Test public void testGetTaskAssignmentInfo throws Exception BoxTaskAssignment Info info testTask addAssignment getCurrentUser com box sdk BoxTaskAssignment Info result null try result requestBody info getID assertNotNull result
Disabled Test public void testGetTaskAssignments throws Exception final Map String Object headers new HashMap headers put testTask getID headers put getCurrentUser requestBodyAndHeaders null headers SuppressWarnings final java util List result requestBody testTask getID assertNotNull result
Test public void testGetTaskInfo throws Exception final com box sdk BoxTask Info result requestBody testTask getID assertNotNull result
Disabled Test public void testUpdateTaskInfo throws Exception BoxTask Info info testTask getInfo final Map String Object headers new HashMap headers put testTask getID headers put info final com box sdk BoxTask result requestBodyAndHeaders null headers assertNotNull result
Disabled Test public void testAddUserEmailAlias throws Exception com box sdk EmailAlias result null try final Map String Object headers new HashMap headers put testUser getID headers put CAMEL_TEST_USER_EMAIL_ALIAS result requestBodyAndHeaders null headers assertNotNull result
Test public void testCreateAppUser throws Exception assumeTrue jwtAuthentoication com box sdk BoxUser result null try CreateUserParams params new CreateUserParams params setSpaceAmount final Map String Object headers new HashMap headers put CAMEL_TEST_CREATE_APP_USER_NAME headers put params result requestBodyAndHeaders null headers assertNotNull result
assumeFalse jwtAuthentoication String enterpriseUser1Login String options get CAMEL_TEST_ENTERPRISE_USER_LOGIN_KEY if enterpriseUser1Login null equals enterpriseUser1Login trim enterpriseUser1Login null assertNotNull enterpriseUser1Login com box sdk BoxUser result null try CreateUserParams params new CreateUserParams params setSpaceAmount final Map String Object headers new HashMap headers put enterpriseUser1Login headers put CAMEL_TEST_CREATE_ENTERPRISE_USER_NAME headers put params result requestBodyAndHeaders null headers assertNotNull result
Test public void testGetAllEnterpriseOrExternalUsers throws Exception final Map String Object headers new HashMap headers put null headers put null SuppressWarnings final java util List result requestBodyAndHeaders null headers assertNotNull result
Test public void testGetCurrentUser throws Exception final com box sdk BoxUser result requestBody testUser getID assertNotNull result
Test public void testGetUserEmailAlias throws Exception SuppressWarnings final java util Collection result requestBody testUser getID assertNotNull result
Test public void testGetUserInfo throws Exception final com box sdk BoxUser Info result requestBody testUser getID assertNotNull result
Test public void testUpdateUserInfo throws Exception assumeFalse jwtAuthentoication BoxUser Info info testUser getInfo info setJobTitle CAMEL_TEST_USER_JOB_TITLE try final Map String Object headers new HashMap headers put testUser getID headers put info final com box sdk BoxUser result requestBodyAndHeaders null headers assertNotNull result
Disabled Test public void testAll throws Exception final List AddOn result requestBody null List class assertNotNull result
Override AfterEach public void tearDown throws Exception if this gateway null customer null for String id this addressIds if this gateway address delete customer getId id isSuccess
Test public void testCreate throws Exception assertNotNull this gateway assertNotNull this customer final Result Address address requestBodyAndHeaders null new BraintreeHeaderBuilder add customer getId add new AddressRequest company streetAddress locality build Result class assertNotNull address assertTrue address isSuccess
Test public void testDelete throws Exception assertNotNull this gateway assertNotNull this customer final Address address createAddress final Result Address result requestBodyAndHeaders null new BraintreeHeaderBuilder add customer getId add address getId build Result class assertNotNull address assertTrue result isSuccess
Test public void testFind throws Exception assertNotNull this gateway assertNotNull this customer final Address addressRef createAddress this addressIds add addressRef getId final Address address requestBodyAndHeaders null new BraintreeHeaderBuilder add customer getId add addressRef getId build Address class assertNotNull address
Test public void testUpdate throws Exception assertNotNull this gateway assertNotNull this customer final Address addressRef createAddress this addressIds add addressRef getId final Result Address result requestBodyAndHeaders null new BraintreeHeaderBuilder add customer getId add addressRef getId add new AddressRequest company streetAddress customer getId locality customer getId build Result class assertNotNull result assertTrue result isSuccess
Disabled Test public void testFind throws Exception final CreditCardVerification result requestBody null CreditCardVerification class assertNotNull result
Disabled Test public void testSearch throws Exception final ResourceCollection CreditCardVerification result requestBody null ResourceCollection class assertNotNull result
Disabled Test public void testAll throws Exception final List Discount result requestBody null List class assertNotNull result
Override AfterEach public void tearDown throws Exception if this gateway null for String token this paymentMethodsTokens if this gateway paymentMethod delete token isSuccess
Test public void testDelete throws Exception assertNotNull this gateway assertNotNull this customer final PaymentMethod paymentMethod createPaymentMethod final Result PaymentMethod deleteResult requestBody paymentMethod getToken Result class assertNotNull deleteResult assertTrue deleteResult isSuccess
Test public void testFind throws Exception assertNotNull this gateway assertNotNull this customer final PaymentMethod paymentMethod createPaymentMethod this paymentMethodsTokens add paymentMethod getToken final PaymentMethod method requestBody paymentMethod getToken PaymentMethod class assertNotNull method
Disabled Test public void testCreate throws Exception final com braintreegateway Result result requestBody null assertNotNull result
Disabled Test public void testFind throws Exception final com braintreegateway PaymentMethodNonce result requestBody null assertNotNull result
Disabled Test public void testAll throws Exception final List Plan result requestBody null List class assertNotNull result
Test public void testTransactionLevelFees throws Exception String merchantAccountId System getenv String reportDateString System getenv SimpleDateFormat sdf new SimpleDateFormat Calendar reportDate Calendar getInstance reportDate setTime sdf parse reportDateString TransactionLevelFeeReportRequest request new TransactionLevelFeeReportRequest date reportDate merchantAccountId merchantAccountId final com braintreegateway Result TransactionLevelFeeReport result requestBody request assertNotNull result assertTrue result isSuccess TransactionLevelFeeReport report result getTarget assertNotNull report
Disabled Test public void testGenerate throws Exception final com braintreegateway Result result requestBody null assertNotNull result
Disabled Test public void testGenerateWithCustomFields throws Exception final Map String Object headers new HashMap headers put null headers put null final com braintreegateway Result result requestBodyAndHeaders null headers assertNotNull result
Disabled Test public void testCancel throws Exception final com braintreegateway Result result requestBody null assertNotNull result
Disabled Test public void testCreate throws Exception final com braintreegateway Result result requestBody null assertNotNull result
Disabled Test public void testDelete throws Exception final Map String Object headers new HashMap headers put null headers put null final com braintreegateway Result result requestBodyAndHeaders null headers assertNotNull result
Disabled Test public void testFind throws Exception final com braintreegateway Subscription result requestBody null assertNotNull result
Disabled Test public void testRetryCharge throws Exception final com braintreegateway Result result requestBody null assertNotNull result
Disabled Test public void testRetryChargeWithAmount throws Exception final Map String Object headers new HashMap headers put null headers put null final com braintreegateway Result result requestBodyAndHeaders null headers assertNotNull result
Disabled Test public void testSearch throws Exception final com braintreegateway ResourceCollection result requestBody null assertNotNull result
Disabled Test public void testUpdate throws Exception final Map String Object headers new HashMap headers put null headers put null final com braintreegateway Result result requestBodyAndHeaders null headers assertNotNull result
Test public void testFind throws Exception assertNotNull this gateway final Result Transaction createResult requestBody new TransactionRequest amount new BigDecimal paymentMethodNonce options submitForSettlement false done Result class assertNotNull createResult assertTrue createResult isSuccess LOG info createResult getTarget getId this transactionIds add createResult getTarget getId final Transaction result requestBody createResult getTarget getId assertNotNull result
Test public void testRefund throws Exception assertNotNull this gateway final Result Transaction createResult requestBody new TransactionRequest amount new BigDecimal paymentMethodNonce options submitForSettlement true done Result class assertNotNull createResult assertTrue createResult isSuccess String createId createResult getTarget getId final Result Transaction settleResult this gateway testing settle createId assertNotNull settleResult assertTrue settleResult isSuccess final Result Transaction result requestBody createId Result class assertNotNull result assertTrue result isSuccess
Test public void testRefundWithAmount throws Exception assertNotNull this gateway final Result Transaction createResult requestBody new TransactionRequest amount new BigDecimal paymentMethodNonce options submitForSettlement true done Result class assertNotNull createResult assertTrue createResult isSuccess String createId createResult getTarget getId final Result Transaction settleResult this gateway testing settle createId assertNotNull settleResult assertTrue settleResult isSuccess final Result Transaction result requestBodyAndHeaders null new BraintreeHeaderBuilder add createId add new BigDecimal build Result class assertNotNull result assertTrue result isSuccess
Test public void testRefundWithRequest throws Exception assertNotNull this gateway final Result Transaction createResult requestBody new TransactionRequest amount new BigDecimal paymentMethodNonce options submitForSettlement true done Result class assertNotNull createResult assertTrue createResult isSuccess String createId createResult getTarget getId final Result Transaction settleResult this gateway testing settle createId assertNotNull settleResult assertTrue settleResult isSuccess final Result Transaction result requestBodyAndHeaders null new BraintreeHeaderBuilder add createId add new TransactionRefundRequest amount new BigDecimal build Result class assertNotNull result assertTrue result isSuccess
Disabled Test public void testCancelRelease throws Exception final com braintreegateway Result result requestBody null assertNotNull result
Disabled Test public void testCredit throws Exception final com braintreegateway Result result requestBody null assertNotNull result
Disabled Test public void testHoldInEscrow throws Exception final com braintreegateway Result result requestBody null assertNotNull result
Disabled Test public void testReleaseFromEscrow throws Exception final com braintreegateway Result result requestBody null assertNotNull result
Disabled Test public void testSearch throws Exception final com braintreegateway ResourceCollection result requestBody null assertNotNull result
Disabled Test public void testSubmitForPartialSettlement throws Exception final Map String Object headers new HashMap headers put null headers put null final com braintreegateway Result result requestBodyAndHeaders null headers assertNotNull result
Disabled Test public void testVoidTransaction throws Exception final com braintreegateway Result result requestBody null assertNotNull result
private void initInsertStatement Insert insert generateInsert table getAllColumns false ttl SimpleStatement statement applyConsistencyLevel insert build writeConsistencyLevel
Override public Exchange add CamelContext camelContext String key Exchange exchange final Object idValues getPKValues key
protected void initSelectStatement Select select generateSelect table getAllColumns pkColumns SimpleStatement statement applyConsistencyLevel select build readConsistencyLevel
Override public Exchange get CamelContext camelContext String key Object pkValues getPKValues key
private void initDeleteIfIdStatement Delete delete generateDelete table pkColumns false Delete deleteIf delete ifColumn exchangeIdColumn isEqualTo bindMarker SimpleStatement statement applyConsistencyLevel deleteIf build writeConsistencyLevel
Override public void confirm CamelContext camelContext String exchangeId String keyColumn getKeyColumn LOGGER debug List Row rows selectKeyIds for Row row rows if row getString exchangeIdColumn equals exchangeId String key row getString keyColumn Object cqlParams append getPKValues key exchangeId
private void initDeleteStatement Delete delete generateDelete table pkColumns false SimpleStatement statement applyConsistencyLevel delete build writeConsistencyLevel
private void initSelectKeyIdStatement Select select generateSelect table new String getKeyColumn exchangeIdColumn pkColumns pkColumns length SimpleStatement statement applyConsistencyLevel select build readConsistencyLevel
protected void initInsertStatement Insert insert generateInsert table pkColumns true ttl SimpleStatement statement applyConsistencyLevel insert build writeConsistencyLevel
protected void initSelectStatement Select select generateSelect table pkColumns pkColumns SimpleStatement statement applyConsistencyLevel select build readConsistencyLevel
protected void initDeleteStatement Delete delete generateDelete table pkColumns true SimpleStatement statement applyConsistencyLevel delete build writeConsistencyLevel
protected void initClearStatement Truncate truncate generateTruncate table SimpleStatement statement applyConsistencyLevel truncate build writeConsistencyLevel
Override protected void doInit throws Exception super doInit if objectMapper null if useDefaultObjectMapper camelContext null Set ObjectMapper set camelContext getRegistry findByType ObjectMapper class if set size objectMapper set iterator next
Override public void dispose T context super dispose context if context getStatus isStopped
boolean deploymentException false Set Bean routes new HashSet manager getBeans RoutesBuilder class ANY routes addAll manager getBeans RouteContainer class ANY for Bean context manager getBeans CamelContext class ANY for Bean route routes Set Annotation qualifiers new HashSet context getQualifiers qualifiers retainAll route getQualifiers if qualifiers size deploymentException addRouteToContext route context manager adv if deploymentException return eagerBeans forEach type getReferencesByType manager type getJavaClass ANY toString manager getBeans Object class ANY STARTUP forEach bean getReference manager bean getBeanClass bean toString if configuration autoStartContexts for CamelContext context contexts
void notify T event
void appendBuilders List RoutesBuilder list for Bean bean manager getBeans RoutesBuilder class ANY logger trace bean if shouldIgnoreBean bean
void appendBuilders List RoutesBuilder list throws IllegalAccessException InstantiationException Set Class classes resolver findImplementations RoutesBuilder class packages for Class aClass classes logger trace aClass if shouldIgnoreBean aClass
public String init ChatScriptMessage input throws Exception ChatScriptMessage g new ChatScriptMessage input getUserName this botName null String response doMessage g
final SMSMessage smsMessage exchange getIn getMandatoryBody SMSMessage class LOG trace smsMessage final Set ConstraintViolation SMSMessage constraintViolations getValidator validate smsMessage if constraintViolations size final StringBuffer msg new StringBuffer for final ConstraintViolation SMSMessage cv constraintViolations msg append String format cv getPropertyPath toString cv getMessage LOG debug msg toString throw new InvalidPayloadRuntimeException exchange SMSMessage class LOG trace smsMessage final CMMessage cmMessage new CMMessage smsMessage getPhoneNumber smsMessage getMessage LOG debug if smsMessage getFrom null smsMessage getFrom isEmpty String df getConfiguration getDefaultFrom cmMessage setSender df
final StringBuffer msg new StringBuffer for final ConstraintViolation SMSMessage cv constraintViolations msg append String format cv getPropertyPath toString cv getMessage LOG debug msg toString throw new InvalidPayloadRuntimeException exchange SMSMessage class LOG trace smsMessage final CMMessage cmMessage new CMMessage smsMessage getPhoneNumber smsMessage getMessage LOG debug if smsMessage getFrom null smsMessage getFrom isEmpty String df getConfiguration getDefaultFrom cmMessage setSender df LOG debug df cmMessage setIdAsString smsMessage getId cmMessage setUnicodeAndMultipart getConfiguration getDefaultMaxNumberOfParts sender send cmMessage
private void doHttpPost final String urlString final String requestString final HttpClient client HttpClientBuilder create build final HttpPost post new HttpPost urlString post setEntity new StringEntity requestString Charset forName try final HttpResponse response client execute post final int statusCode response getStatusLine getStatusCode
try final HttpResponse response client execute post final int statusCode response getStatusLine getStatusCode LOG debug statusCode if statusCode throw new CMDirectException if statusCode throw new CMDirectException try BufferedReader rd new BufferedReader new InputStreamReader response getEntity getContent final StringBuffer result new StringBuffer String line null while line rd readLine null result append line line result toString if line isEmpty
Override public RouteBuilder route return new RouteBuilder Override public void configure throws Exception Assert hasLength uri
int sendExchangeWithPropsAndBody Map String Object properties InputStream inputStream throws Exception Exchange exchange getEndpoint createExchange exchange getIn setHeaders properties exchange getIn setBody inputStream
SuppressWarnings public CmisObject moveDocument Exchange exchange throws Exception validateRequiredHeader exchange CamelCMISConstants CMIS_DESTIONATION_FOLDER_ID validateRequiredHeader exchange CamelCMISConstants CMIS_SOURCE_FOLDER_ID validateRequiredHeader exchange CamelCMISConstants CMIS_OBJECT_ID Message message exchange getIn String destinationFolderId message getHeader CamelCMISConstants CMIS_DESTIONATION_FOLDER_ID String class String sourceFolderId message getHeader CamelCMISConstants CMIS_SOURCE_FOLDER_ID String class String objectId message getHeader CamelCMISConstants CMIS_OBJECT_ID String class Folder sourceFolder Folder getSessionFacade getObjectById sourceFolderId Folder targetFolder Folder getSessionFacade getObjectById destinationFolderId Document document Document getSessionFacade getObjectById objectId if document null if document getAllowableActions getAllowableActions contains Action CAN_MOVE_OBJECT throw new CamelCmisUnauthorizedException objectId document getName try
private int pollWithQuery CMISConsumer cmisConsumer throws Exception int count int pageNumber boolean finished false ItemIterable QueryResult itemIterable executeQuery query while finished ItemIterable QueryResult currentPage itemIterable skipTo count getPage
public List Map String Object retrieveResult Boolean retrieveContent Integer readSize ItemIterable QueryResult itemIterable List Map String Object result new ArrayList boolean queryForContent retrieveContent null retrieveContent readContent int documentsToRead readSize null readSize readCount int count int pageNumber boolean finished false while finished ItemIterable QueryResult currentPage itemIterable skipTo count getPage
int processFolderRecursively Folder folder throws Exception processFolderNode folder OperationContext operationContext cmisConsumer createOperationContext operationContext setMaxItemsPerPage pageSize int count int pageNumber boolean finished false ItemIterable CmisObject itemIterable folder getChildren operationContext while finished ItemIterable CmisObject currentPage itemIterable skipTo count getPage
Override protected void doStart throws Exception if sessionId get null client configuration createConsulClient getCamelContext sessionClient client sessionClient keyValueClient client keyValueClient sessionId set sessionClient createSession ImmutableSession builder name getNamespace ttl configuration getSessionTtl lockDelay configuration getSessionLockDelay build getId
Override protected void doStart throws Exception if sessionId get null client configuration createConsulClient getCamelContext sessionClient client sessionClient keyValueClient client keyValueClient sessionId set sessionClient createSession ImmutableSession builder name getNamespace ttl configuration getSessionTtl lockDelay configuration getSessionLockDelay build getId LOGGER debug sessionId get boolean lock acquireLock
Override protected void doStop throws Exception if sessionId get null if keyValueClient releaseLock this path sessionId get
private static void run String id try int events ThreadLocalRandom current nextInt CountDownLatch contextLatch new CountDownLatch events ConsulClusterService service new ConsulClusterService service setId id service setUrl String format container getContainerIpAddress container getMappedPort Consul DEFAULT_HTTP_PORT
CountDownLatch contextLatch new CountDownLatch events ConsulClusterService service new ConsulClusterService service setId id service setUrl String format container getContainerIpAddress container getMappedPort Consul DEFAULT_HTTP_PORT LOGGER info service getUrl DefaultCamelContext context new DefaultCamelContext context disableJMX context setName id context addService service context addRoutePolicyFactory ClusteredRoutePolicyFactory forNamespace context addRoutes new RouteBuilder Override public void configure from routeId id log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt
service setId id service setUrl String format container getContainerIpAddress container getMappedPort Consul DEFAULT_HTTP_PORT LOGGER info service getUrl DefaultCamelContext context new DefaultCamelContext context disableJMX context setName id context addService service context addRoutePolicyFactory ClusteredRoutePolicyFactory forNamespace context addRoutes new RouteBuilder Override public void configure from routeId id log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt LOGGER info id context start
LOGGER info service getUrl DefaultCamelContext context new DefaultCamelContext context disableJMX context setName id context addService service context addRoutePolicyFactory ClusteredRoutePolicyFactory forNamespace context addRoutes new RouteBuilder Override public void configure from routeId id log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt LOGGER info id context start LOGGER info id contextLatch await
private static void run String id try int events ThreadLocalRandom current nextInt CountDownLatch contextLatch new CountDownLatch events ConsulClusterService service new ConsulClusterService service setId id service setUrl String format container getContainerIpAddress container getMappedPort Consul DEFAULT_HTTP_PORT
ConsulClusterService service new ConsulClusterService service setId id service setUrl String format container getContainerIpAddress container getMappedPort Consul DEFAULT_HTTP_PORT LOGGER info service getUrl DefaultCamelContext context new DefaultCamelContext context disableJMX context setName id context addService service context addRoutes new RouteBuilder Override public void configure throws Exception from routeId id routePolicy ClusteredRoutePolicy forNamespace log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt context start contextLatch await
private static void run String id try int events ThreadLocalRandom current nextInt CountDownLatch contextLatch new CountDownLatch events ConsulClusterService service new ConsulClusterService service setId id service setUrl String format container getContainerIpAddress container getMappedPort Consul DEFAULT_HTTP_PORT
ConsulClusterService service new ConsulClusterService service setId id service setUrl String format container getContainerIpAddress container getMappedPort Consul DEFAULT_HTTP_PORT LOGGER info service getUrl DefaultCamelContext context new DefaultCamelContext context disableJMX context setName id context addService service context addRoutes new RouteBuilder Override public void configure throws Exception from routeId id log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt context start contextLatch await
private void processFlowProcess String x
private void processTransactionMappingFeed StateMachineTransactionMapping x
private void proceedNetworkMapFeed NetworkMapCache MapChange x
private void processStateMachineUpdate StateMachineUpdate x
private void processContractStateUpdate Vault Update ContractState x
private void processError Throwable throwable String operation
public void processEvent Exchange exchange
private void processDone String operation
private Boolean setDocument String id int expiry Object obj int retryAttempts PersistTo persistTo ReplicateTo replicateTo throws Exception UpsertOptions options UpsertOptions upsertOptions expiry Duration ofSeconds expiry durability persistTo replicateTo timeout Duration ofMillis retryAttempts long producerRetryPause retryStrategy BestEffortRetryStrategy withExponentialBackoff Duration ofMillis producerRetryPause Duration ofMillis producerRetryPause MutationResult result collection upsert id obj options if LOG isDebugEnabled
continue if feed isDeleted endpoint isUpdates continue lastSequence feed getSeq JsonObject doc feed getDoc Exchange exchange endpoint createExchange lastSequence feed getId doc feed isDeleted if LOG isTraceEnabled LOG trace new Object exchange feed getId lastSequence try consumer getProcessor process exchange catch Exception e consumer getExceptionHandler handleException exchange e stopped true catch CouchDbException e if LOG isDebugEnabled
lastSequence feed getSeq JsonObject doc feed getDoc Exchange exchange endpoint createExchange lastSequence feed getId doc feed isDeleted if LOG isTraceEnabled LOG trace new Object exchange feed getId lastSequence try consumer getProcessor process exchange catch Exception e consumer getExceptionHandler handleException exchange e stopped true catch CouchDbException e if LOG isDebugEnabled LOG debug e if waitForStability lastSequence throw e
while problems if repeatDbErrorCount MAX_DB_ERROR_REPEATS LOG error return false try Thread sleep int Math random catch InterruptedException e if LOG isDebugEnabled LOG debug e try couchClient context serverVersion initChanges lastSequence problems false catch Exception e if LOG isDebugEnabled
protected void logErrorAndThrow final Logger log String message throws CryptoCmsException
return OriginatorInformation originatorInfo parser getOriginatorInfo if originatorInfo null LOG debug SuppressWarnings Store X509CertificateHolder certStore originatorInfo getCertificates Collection X509CertificateHolder certs certStore getMatches null if certs null certs size LOG debug for X509CertificateHolder cert certs LOG debug cert getSubject cert getIssuer cert getSerialNumber SuppressWarnings Store X509CRLHolder crlsStore originatorInfo getCRLs Collection X509CRLHolder crls crlsStore getMatches null if crls null crls size LOG debug for X509CRLHolder crl crls
SuppressWarnings Store X509CRLHolder crlsStore originatorInfo getCRLs Collection X509CRLHolder crls crlsStore getMatches null if crls null crls size LOG debug for X509CRLHolder crl crls LOG debug crl getIssuer SuppressWarnings Collection X509CRLEntryHolder revokedCerts crl getRevokedCertificates for X509CRLEntryHolder revokedCert revokedCerts LOG debug revokedCert getCertificateIssuer revokedCert getSerialNumber revokedCert getRevocationDate LOG debug parser getEncryptionAlgOID LOG debug RecipientInformationStore recipientStore parser getRecipientInfos Collection RecipientInformation recipients recipientStore getRecipients int counter for RecipientInformation recipient recipients
Override protected void marshalInternal InputStream is OutputStream os Exchange exchange throws Exception LOG debug conf getAlgorithmID
OriginatorInformationProvider originatorInformationProvider conf getOriginatorInformationProvider if originatorInformationProvider null LOG debug OriginatorInformation originatorInformation originatorInformationProvider getOriginatorInformation exchange if originatorInformation null LOG debug gen setOriginatorInfo originatorInformation AttributesGeneratorProvider attributeGeneratorProvider conf getUnprotectedAttributesGeneratorProvider if attributeGeneratorProvider null LOG debug gen setUnprotectedAttributeGenerator attributeGeneratorProvider getAttributesGenerator exchange if conf getRecipient isEmpty throw new CryptoCmsException for RecipientInfo recipientInfo conf getRecipient TransRecipientInfo keyTransrecipientInfo TransRecipientInfo recipientInfo
LOG debug OriginatorInformation originatorInformation originatorInformationProvider getOriginatorInformation exchange if originatorInformation null LOG debug gen setOriginatorInfo originatorInformation AttributesGeneratorProvider attributeGeneratorProvider conf getUnprotectedAttributesGeneratorProvider if attributeGeneratorProvider null LOG debug gen setUnprotectedAttributeGenerator attributeGeneratorProvider getAttributesGenerator exchange if conf getRecipient isEmpty throw new CryptoCmsException for RecipientInfo recipientInfo conf getRecipient TransRecipientInfo keyTransrecipientInfo TransRecipientInfo recipientInfo LOG debug keyTransrecipientInfo X509Certificate encryptCert keyTransrecipientInfo getCertificate exchange
PrivateKey key signer getPrivateKey exchange if key null throw new CryptoCmsException signer ContentSigner contentSigner try contentSigner new JcaContentSignerBuilder signer getSignatureAlgorithm exchange setProvider BouncyCastleProvider PROVIDER_NAME build key catch OperatorCreationException e throw new CryptoCmsInvalidKeyException signer signer getSignatureAlgorithm exchange e getMessage e JcaSignerInfoGeneratorBuilder signerBuilder new JcaSignerInfoGeneratorBuilder new JcaDigestCalculatorProviderBuilder setProvider BouncyCastleProvider PROVIDER_NAME build signerBuilder setSignedAttributeGenerator signer getSignedAttributeGenerator exchange setUnsignedAttributeGenerator signer getUnsignedAttributeGenerator exchange gen addSignerInfoGenerator signerBuilder build contentSigner signerCert List Certificate certificateList new ArrayList for Certificate cert signer getCertificateChain exchange if certificateList contains cert certificateList add cert
protected void debugLog CMSSignedDataParser sp throws CMSException if LOG isDebugEnabled return SignerInformationStore signers sp getSignerInfos Set AlgorithmIdentifier messageDigestAlgorithms sp getDigestAlgorithmIDs for AlgorithmIdentifier algorithm messageDigestAlgorithms LOG debug algorithm getAlgorithm getId LOG debug int i for SignerInformation signer signers getSigners i LOG debug new Object i signerInformationToString signer if signer getSignedAttributes null SuppressWarnings Hashtable String Attribute authAttTable signer getSignedAttributes toHashtable if authAttTable null
SignerInformationStore signers sp getSignerInfos Set AlgorithmIdentifier messageDigestAlgorithms sp getDigestAlgorithmIDs for AlgorithmIdentifier algorithm messageDigestAlgorithms LOG debug algorithm getAlgorithm getId LOG debug int i for SignerInformation signer signers getSigners i LOG debug new Object i signerInformationToString signer if signer getSignedAttributes null SuppressWarnings Hashtable String Attribute authAttTable signer getSignedAttributes toHashtable if authAttTable null LOG debug i attributesToString authAttTable if signer getUnsignedAttributes null SuppressWarnings Hashtable String Attribute unAuthAtts signer getUnsignedAttributes toHashtable
Override public void process Exchange exchange throws Exception InputStream signature exchange getIn getHeader CryptoCmsConstants CAMEL_CRYPTO_CMS_SIGNED_DATA InputStream class if signature null
public static List PGPPublicKey findPublicKeys List String useridParts boolean forEncryption PGPPublicKeyRingCollection pgpPublicKeyringCollection List PGPPublicKey result new ArrayList useridParts size for Iterator PGPPublicKeyRing keyRingIter pgpPublicKeyringCollection getKeyRings keyRingIter hasNext PGPPublicKeyRing keyRing keyRingIter next PGPPublicKey primaryKey keyRing getPublicKey String foundKeyUserIdForUserIdPart findFirstKeyUserIdContainingOneOfTheParts useridParts primaryKey if foundKeyUserIdForUserIdPart null
PGPPublicKeyRing keyRing keyRingIter next PGPPublicKey primaryKey keyRing getPublicKey String foundKeyUserIdForUserIdPart findFirstKeyUserIdContainingOneOfTheParts useridParts primaryKey if foundKeyUserIdForUserIdPart null LOG debug primaryKey getKeyID useridParts continue LOG debug foundKeyUserIdForUserIdPart primaryKey getKeyID useridParts for Iterator PGPPublicKey keyIter keyRing getPublicKeys keyIter hasNext PGPPublicKey key keyIter next if forEncryption if isEncryptionKey key LOG debug foundKeyUserIdForUserIdPart Long toString key getKeyID result add key else if forEncryption isSignatureKey key result add key
public static List PGPSecretKeyAndPrivateKeyAndUserId findSecretKeysWithPrivateKeyAndUserId Map String String sigKeyUserId2Password String provider PGPSecretKeyRingCollection pgpSec throws PGPException List PGPSecretKeyAndPrivateKeyAndUserId result new ArrayList sigKeyUserId2Password size for Iterator i pgpSec getKeyRings i hasNext Object data i next if data PGPSecretKeyRing PGPSecretKeyRing keyring PGPSecretKeyRing data PGPSecretKey primaryKey keyring getSecretKey List String useridParts new ArrayList sigKeyUserId2Password keySet String foundKeyUserIdForUserIdPart findFirstKeyUserIdContainingOneOfTheParts useridParts primaryKey getPublicKey if foundKeyUserIdForUserIdPart null
if data PGPSecretKeyRing PGPSecretKeyRing keyring PGPSecretKeyRing data PGPSecretKey primaryKey keyring getSecretKey List String useridParts new ArrayList sigKeyUserId2Password keySet String foundKeyUserIdForUserIdPart findFirstKeyUserIdContainingOneOfTheParts useridParts primaryKey getPublicKey if foundKeyUserIdForUserIdPart null LOG debug primaryKey getKeyID useridParts continue LOG debug foundKeyUserIdForUserIdPart primaryKey getKeyID useridParts for Iterator PGPSecretKey iterKey keyring getSecretKeys iterKey hasNext PGPSecretKey secKey iterKey next if isSigningKey secKey PGPPrivateKey privateKey secKey extractPrivateKey new JcePBESecretKeyDecryptorBuilder setProvider provider build sigKeyUserId2Password get foundKeyUserIdForUserIdPart toCharArray if privateKey null result add new PGPSecretKeyAndPrivateKeyAndUserId secKey privateKey foundKeyUserIdForUserIdPart
SuppressWarnings public static PGPPublicKey getPublicKeyWithKeyIdAndUserID long keyId List String userIdParts PGPPublicKeyRingCollection publicKeyringCollection throws PGPException PGPPublicKeyRing publicKeyring publicKeyringCollection getPublicKeyRing keyId if publicKeyring null
Test void testSendMessage throws Exception MockEndpoint resultEndpoint resolveMandatoryEndpoint MockEndpoint class resultEndpoint expectedMessageCount Map String Object body new LinkedHashMap body put body put template sendBody body resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges for Exchange exchange list Message in exchange getIn String text in getBody String class
MockEndpoint resultEndpoint resolveMandatoryEndpoint MockEndpoint class resultEndpoint expectedMessageCount Map String Object body1 new LinkedHashMap body1 put body1 put Map String Object body2 new LinkedHashMap body2 put body2 put body2 put template sendBody body1 template sendBody body2 resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges Message in1 list get getIn String text1 in1 getBody String class
body1 put Map String Object body2 new LinkedHashMap body2 put body2 put body2 put template sendBody body1 template sendBody body2 resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges Message in1 list get getIn String text1 in1 getBody String class LOG debug text1 assertTrue Pattern matches text1 trim Message in2 list get getIn String text2 in2 getBody String class
MockEndpoint resultEndpoint resolveMandatoryEndpoint MockEndpoint class resultEndpoint expectedMessageCount Map String Object body1 new LinkedHashMap body1 put body1 put Map String Object body2 new LinkedHashMap body2 put body2 put body2 put body2 put template sendBody body1 template sendBody body2 List Exchange list resultEndpoint getReceivedExchanges Message in1 list get getIn String text1 in1 getBody String class
body1 put Map String Object body2 new LinkedHashMap body2 put body2 put body2 put body2 put template sendBody body1 template sendBody body2 List Exchange list resultEndpoint getReceivedExchanges Message in1 list get getIn String text1 in1 getBody String class LOG debug text1 assertEquals text1 trim Message in2 list get getIn String text2 in2 getBody String class
SuppressWarnings Test void testUnMarshal throws Exception MockEndpoint endpoint getMockEndpoint endpoint expectedMessageCount endpoint assertIsSatisfied Exchange exchange endpoint getExchanges get List List String data List List String exchange getIn getBody for List String line data
if Header HEADER_LIST equals key value null return false if relayHeaders return true if relayAllMessageHeaders return false MessageHeaderFilter messageHeaderfilter getMessageHeaderFilter exchange if messageHeaderfilter null LOG debug return false LOG trace messageHeaderfilter try messageHeaderfilter filter direction List Header value catch Throwable t if LOG isDebugEnabled
protected void incoming org apache camel Exchange camelExchange
if conduitSelector null conduitSelector complete cxfExchange ex cxfExchange getOutMessage getContent Exception class if ex null cxfExchange getInMessage null ex cxfExchange getInMessage getContent Exception class if ex null camelExchange setException ex else camelExchange setException ex finally if endpoint getCookieHandler null cxfExchange getInMessage null try Map String List String cxfHeaders CastUtils cast Map cxfExchange getInMessage get Message PROTOCOL_HEADERS endpoint getCookieHandler storeCookies camelExchange endpoint getRequestUri camelExchange cxfHeaders catch IOException e
sfb getFeatures add new CXFMessageDataFormatFeature sfb setDataBinding new SourceDataBinding else if getDataFormat dealias DataFormat RAW RAWDataFormatFeature feature new RAWDataFormatFeature if this getExchangePattern equals ExchangePattern InOnly feature setOneway true feature addInIntercepters getInInterceptors feature addOutInterceptors getOutInterceptors sfb getFeatures add feature else LOG debug getDataFormat if isLoggingFeatureEnabled LoggingFeature loggingFeature new LoggingFeature if getLoggingSizeLimit loggingFeature setLimit getLoggingSizeLimit
feature addInIntercepters getInInterceptors feature addOutInterceptors getOutInterceptors factoryBean getFeatures add feature else if getDataFormat dealias DataFormat CXF_MESSAGE factoryBean getFeatures add new CXFMessageDataFormatFeature factoryBean setDataBinding new SourceDataBinding else if getDataFormat DataFormat PAYLOAD factoryBean getFeatures add new PayLoadDataFormatFeature allowStreaming factoryBean setDataBinding new HybridSourceDataBinding if isLoggingFeatureEnabled LoggingFeature loggingFeature new LoggingFeature if getLoggingSizeLimit loggingFeature setLimit getLoggingSizeLimit factoryBean getFeatures add loggingFeature if getWrappedStyle null
public Bus getBus if bus null bus CxfEndpointUtils createBus getCamelContext this createBus true
Override protected void doStop throws Exception if createBus bus null
Map String Object responseContext new HashMap invocationContext put Client RESPONSE_CONTEXT responseContext invocationContext put Client REQUEST_CONTEXT prepareRequest camelExchange cxfExchange try client invoke boi getParams endpoint camelExchange invocationContext cxfExchange catch Exception exception camelExchange setException exception finally if endpoint getCookieHandler null try Message inMessage cxfExchange getInMessage if inMessage null Map String List String cxfHeaders CastUtils cast Map inMessage get Message PROTOCOL_HEADERS endpoint getCookieHandler storeCookies camelExchange endpoint getRequestUri camelExchange cxfHeaders catch IOException e
private BindingOperationInfo getBindingOperationInfo Exchange ex CxfEndpoint endpoint CxfEndpoint this getEndpoint BindingOperationInfo answer null String lp ex getIn getHeader CxfConstants OPERATION_NAME String class if lp null
if camelExchange null Map String List String h CastUtils cast Map camelExchange getProperty Message PROTOCOL_HEADERS if h null transportHeaders putAll h Map String List String headers CastUtils cast Map camelHeaders get Message PROTOCOL_HEADERS if headers null transportHeaders putAll headers DataFormat dataFormat camelExchange getProperty CxfConstants DATA_FORMAT_PROPERTY DataFormat class for Map Entry String Object entry camelHeaders entrySet if Message RESPONSE_CODE equals entry getKey Exchange HTTP_RESPONSE_CODE equals entry getKey LOG debug Message RESPONSE_CODE entry getValue cxfContext put Message RESPONSE_CODE entry getValue continue if Message CONTENT_TYPE equalsIgnoreCase entry getKey dataFormat equals DataFormat RAW if entry getValue null
DataFormat dataFormat camelExchange getProperty CxfConstants DATA_FORMAT_PROPERTY DataFormat class for Map Entry String Object entry camelHeaders entrySet if Message RESPONSE_CODE equals entry getKey Exchange HTTP_RESPONSE_CODE equals entry getKey LOG debug Message RESPONSE_CODE entry getValue cxfContext put Message RESPONSE_CODE entry getValue continue if Message CONTENT_TYPE equalsIgnoreCase entry getKey dataFormat equals DataFormat RAW if entry getValue null LOG debug Message CONTENT_TYPE entry getValue cxfContext put Message CONTENT_TYPE entry getValue toString continue if entry getKey equalsIgnoreCase List String listValue new ArrayList listValue add entry getValue toString transportHeaders put listValue
List Source answer new ArrayList for MessagePartInfo partInfo partInfos if inObjects hasValue partInfo continue Object part inObjects get partInfo if part Holder part Holder part value if part Source Element element null if part DOMSource element getFirstElement DOMSource part getNode if element null addNamespace element nsMap answer add new DOMSource element else
Override public void initialize Client client Bus bus client getEndpoint put removeFaultInInterceptorFromClient client removeInterceptor client getEndpoint getInInterceptors HolderInInterceptor class removeInterceptor client getEndpoint getOutInterceptors HolderOutInterceptor class removeInterceptor client getEndpoint getBinding getInInterceptors SoapHeaderInterceptor class client getEndpoint getBinding getInInterceptors add new ConfigureDocLitWrapperInterceptor true resetPartTypes client getEndpoint getBinding
if publishedEndpointUrl null factory setPublishedEndpointUrl publishedEndpointUrl if interceptorHolder getInInterceptors isEmpty factory setInInterceptors interceptorHolder getInInterceptors if interceptorHolder getOutInterceptors isEmpty factory setOutInterceptors interceptorHolder getOutInterceptors if interceptorHolder getOutFaultInterceptors isEmpty factory setOutFaultInterceptors interceptorHolder getOutFaultInterceptors if interceptorHolder getInFaultInterceptors isEmpty factory setInFaultInterceptors interceptorHolder getInFaultInterceptors if getProperties null if factory getProperties null factory getProperties putAll getProperties else factory setProperties getProperties
public void setBus Bus bus this bus bus if defaultBus BusFactory setDefaultBus bus
protected void setupClientMatrix WebClient client Exchange exchange throws Exception org apache cxf message Message cxfMessage org apache cxf message Message exchange getIn getHeader if cxfMessage null String requestURL String cxfMessage get String matrixParam null int matrixStart requestURL indexOf int matrixEnd requestURL indexOf requestURL indexOf requestURL length Map String String maps null if requestURL null matrixStart matrixParam requestURL substring matrixStart matrixEnd if matrixParam null maps getMatrixParametersFromMatrixString matrixParam ExchangeHelper getCharsetName exchange if maps null for Map Entry String String entry maps entrySet client matrix entry getKey entry getValue
Test public void testCxfEndpointHasCamelContext throws Exception String s Document xml context getTypeConverter convertTo Document class s
Test public void testInvokingSimpleServerWithParams throws Exception Exchange senderExchange new DefaultExchange context ExchangePattern InOut final List String params new ArrayList params add TEST_MESSAGE senderExchange getIn setBody params senderExchange getIn setHeader CxfConstants OPERATION_NAME ECHO_OPERATION Exchange exchange template send senderExchange org apache camel Message out exchange getOut MessageContentsList result MessageContentsList out getBody
Test public void testInvokingSimpleServerWithParams throws Exception Exchange exchange sendSimpleMessage org apache camel Message out exchange getOut String result out getBody String class
Test public void testInvokingJaxWsServerWithParams throws Exception Exchange exchange sendJaxWsMessage org apache camel Message out exchange getOut String result out getBody String class
Override public String echo String text
Override public void foo InE in InE in1 Holder InE out Holder InE out1 LOG info
Override public void foo InE in InE in1 Holder InE out Holder InE out1 LOG info LOG info in
Test public void testNullBodoy throws Exception Object body template sendBody ExchangePattern InOut null
Test public void testFileToCxfMessageDataFormat throws Exception MockEndpoint mock getMockEndpoint mock expectedMessageCount template sendBodyAndHeader createBody Exchange FILE_NAME assertMockEndpointsSatisfied String out mock getReceivedExchanges get getIn getBody String class assertNotNull out
Test public void testSenderXmlData throws Exception MockEndpoint result getMockEndpoint result reset result expectedMessageCount template sendBody xmlData assertMockEndpointsSatisfied int i for Exchange exchange result getExchanges Element element Element exchange getIn getBody String message CxfUtilsTestHelper elementToString element
public String greetMe String me LOG info
public void greetMeOneWay String me LOG info
Override public void process Exchange exchange throws Exception LOG info BindingOperationInfo boi BindingOperationInfo exchange getProperty BindingOperationInfo class getName if boi null
Override SuppressWarnings public void process Exchange exchange throws Exception LOG info BindingOperationInfo boi BindingOperationInfo exchange getProperty BindingOperationInfo class getName if boi null
final List Object expectedBodies new ArrayList EndpointHelper pollEndpoint expectedMessageEndpoint new Processor public void process Exchange exchange throws Exception Object body getInBody exchange if body WrappedFile body exchange getIn getBody String class if split Iterator it ObjectHelper createIterator body delimiter false true while it hasNext Object line it next LOG trace line expectedBodies add line else expectedBodies add body timeout
private DirectVmConsumer awaitConsumer throws InterruptedException DirectVmConsumer answer null StopWatch watch new StopWatch boolean done false while done Thread sleep if LOG isDebugEnabled
void onStopped final DisruptorConsumer consumer throws Exception synchronized this if consumers remove consumer
private void resizeThreadPoolExecutor final int newSize if executor null newSize
executor component getCamelContext getExecutorServiceManager newFixedThreadPool this uri newSize else if executor null newSize LOGGER debug component getCamelContext getExecutorServiceManager shutdown executor executor null else if executor ThreadPoolExecutor LOGGER debug newSize final ThreadPoolExecutor threadPoolExecutor ThreadPoolExecutor executor if newSize threadPoolExecutor getCorePoolSize threadPoolExecutor setCorePoolSize newSize threadPoolExecutor setMaximumPoolSize newSize else threadPoolExecutor setMaximumPoolSize newSize threadPoolExecutor setCorePoolSize newSize else if newSize
private synchronized void shutdownDisruptor boolean isReconfiguring
public synchronized void addEndpoint final DisruptorEndpoint disruptorEndpoint
public synchronized void addEndpoint final DisruptorEndpoint disruptorEndpoint LOGGER debug disruptorEndpoint endpoints add disruptorEndpoint
public synchronized void removeEndpoint final DisruptorEndpoint disruptorEndpoint
Test void testInOut throws Exception getMockEndpoint expectedBodiesReceived final String out template requestBody String class assertEquals out
Test void testDisruptorQueue throws Exception final CountDownLatch latch new CountDownLatch final CamelContext context new DefaultCamelContext context addRoutes new RouteBuilder Override public void configure from to from process new Processor Override public void process final Exchange e
Test void testThatShowsEndpointResolutionIsNotConsistent throws Exception final CountDownLatch latch new CountDownLatch final CamelContext context new DefaultCamelContext context addRoutes new RouteBuilder Override public void configure from to from process new Processor Override public void process final Exchange e
LOG debug hostname List String hostnames new ArrayList hostnames add hostname List String resolved new ArrayList while hostnames isEmpty NamingEnumeration attributeEnumeration null try String hostname hostnames remove InetAddress inetAddress InetAddress getByName hostname InitialDirContext initialDirContext new InitialDirContext Attributes attributes initialDirContext getAttributes inetAddress getHostName DNS_TYPES attributeEnumeration attributes getAll while attributeEnumeration hasMore Attribute attribute Attribute attributeEnumeration next String id attribute getID
hostnames add hostname List String resolved new ArrayList while hostnames isEmpty NamingEnumeration attributeEnumeration null try String hostname hostnames remove InetAddress inetAddress InetAddress getByName hostname InitialDirContext initialDirContext new InitialDirContext Attributes attributes initialDirContext getAttributes inetAddress getHostName DNS_TYPES attributeEnumeration attributes getAll while attributeEnumeration hasMore Attribute attribute Attribute attributeEnumeration next String id attribute getID String value String attribute get if resolvesTo contains value
private List String getLocalIps throws Exception List String localIps new ArrayList Enumeration NetworkInterface networkInterfacesEnumeration NetworkInterface getNetworkInterfaces while networkInterfacesEnumeration hasMoreElements NetworkInterface networkInterface networkInterfacesEnumeration nextElement Enumeration InetAddress inetAddressesEnumeration networkInterface getInetAddresses while inetAddressesEnumeration hasMoreElements InetAddress inetAddress inetAddressesEnumeration nextElement String ip inetAddress getHostAddress
Override public void onInit Route route
Override public void onRemove Route route
Override public void onStart Route route
Override public void onStop Route route
Override public void onSuspend Route route
Override public void onResume Route route
Override public void onExchangeBegin Route route Exchange exchange
Override public void onExchangeDone Route route Exchange exchange
private void startRouteImpl Route route throws Exception ServiceStatus routeStatus controller route getRouteStatus route getId if routeStatus ServiceStatus Stopped
private void stopRouteImpl Route route throws Exception ServiceStatus routeStatus controller route getRouteStatus route getId if routeStatus ServiceStatus Started
Override public void process Exchange exchange throws Exception String unmarshalId endpoint getConfiguration getUnmarshalId if unmarshalId null
Override public URL loadResource String uri URL answer null ClassLoader cl Thread currentThread getContextClassLoader if cl null
Override public T T convertTo Class T type Exchange exchange Object value throws TypeConversionException CamelContext context exchange null exchange getContext null ClassLoader appcl context null context getApplicationContextClassLoader null T result ClassLoader tccl Thread currentThread getContextClassLoader try if appcl null appcl tccl
ClassLoader tccl Thread currentThread getContextClassLoader try if appcl null appcl tccl LOG debug appcl Thread currentThread setContextClassLoader appcl String mapId null if value null Class sourceType value getClass ClassMappingMetadata metadata getClassMappingMetadata sourceType type if metadata null mapId metadata getMapId result mapper map value type mapId finally if appcl null appcl tccl Thread currentThread setContextClassLoader tccl
Map String DozerBeanMapperConfiguration configurations lookupDozerBeanMapperConfigurations if configurations null configuration null String key null for Map Entry String DozerBeanMapperConfiguration entry configurations entrySet if entry getValue configuration key entry getKey break if key null configurations remove key if configurations null for Map Entry String DozerBeanMapperConfiguration entry configurations entrySet String id entry getKey MapperFactory factory new MapperFactory getCamelContext entry getValue Mapper beanMapper factory create if mappers containsValue beanMapper
result new DropboxFileUploadResult dropboxPath DropboxResultCode KO return result else if fileLocalPath isDirectory LOG debug if isPresent DropboxUploadMode force equals mode throw new DropboxException dropboxPath if dropboxPath endsWith DropboxConstants DROPBOX_FILE_SEPARATOR dropboxPath dropboxPath DropboxConstants DROPBOX_FILE_SEPARATOR String oldDropboxPath dropboxPath Collection File listFiles FileUtils listFiles fileLocalPath null true if listFiles isEmpty throw new DropboxException localPath HashMap String DropboxResultCode resultMap new HashMap listFiles size for File file listFiles String absPath file getAbsolutePath
private Map Entry String Object downloadSingleFile String path throws DropboxException try OutputStreamBuilder target OutputStreamBuilder withExchange exchange DbxDownloader FileMetadata downloadedFile client files download path if downloadedFile null downloadedFile download target
Override protected int poll throws Exception Exchange exchange endpoint createExchange DropboxFileDownloadResult result new DropboxAPIFacade configuration getClient exchange get configuration getRemotePath Map String Object map result getEntries if map size for Map Entry String Object entry map entrySet exchange getIn setHeader DropboxResultHeader DOWNLOADED_FILE name entry getKey exchange getIn setBody entry getValue else StringBuilder pathsExtracted new StringBuilder for Map Entry String Object entry map entrySet pathsExtracted append entry getKey append exchange getIn setHeader DropboxResultHeader DOWNLOADED_FILES name pathsExtracted toString exchange getIn setBody map if LOG isDebugEnabled
DropboxUploadMode uploadMode DropboxHelper getUploadMode configuration exchange DropboxConfigurationValidator validatePutOp localPath remotePath uploadMode DropboxFileUploadResult result new DropboxAPIFacade configuration getClient exchange put localPath remotePath uploadMode Map String DropboxResultCode map result getResults if map size for Map Entry String DropboxResultCode entry map entrySet exchange getIn setHeader DropboxResultHeader UPLOADED_FILE name entry getKey exchange getIn setBody entry getValue else StringBuilder pathsExtracted new StringBuilder for Map Entry String DropboxResultCode entry map entrySet pathsExtracted append entry getKey append exchange getIn setHeader DropboxResultHeader UPLOADED_FILES name pathsExtracted toString exchange getIn setBody map if LOG isDebugEnabled
SuppressWarnings public K V Cache K V getCache String name Class K keyType Class V valueType throws Exception CacheConfiguration K V cacheConfiguration null if configuration null if configuration hasConfiguration name
cacheConfiguration CacheConfiguration class cast configuration getConfigurations get name else if configuration hasConfiguration LOGGER debug name cacheConfiguration CacheConfiguration class cast configuration getConfiguration if keyType null valueType null if cacheConfiguration null keyType cacheConfiguration getKeyType valueType cacheConfiguration getValueType else keyType Class K Object class valueType Class V Object class Cache K V cache cacheManager getCache name keyType valueType if cache null configuration null configuration isCreateCacheIfNotExist if cacheConfiguration null if keyType cacheConfiguration getKeyType valueType cacheConfiguration getValueType
if keyType null valueType null if cacheConfiguration null keyType cacheConfiguration getKeyType valueType cacheConfiguration getValueType else keyType Class K Object class valueType Class V Object class Cache K V cache cacheManager getCache name keyType valueType if cache null configuration null configuration isCreateCacheIfNotExist if cacheConfiguration null if keyType cacheConfiguration getKeyType valueType cacheConfiguration getValueType LOGGER info name CacheConfigurationBuilder builder CacheConfigurationBuilder newCacheConfigurationBuilder keyType valueType cacheConfiguration getResourcePools withClassLoader cacheConfiguration getClassLoader withEvictionAdvisor cacheConfiguration getEvictionAdvisor withExpiry cacheConfiguration getExpiryPolicy for ServiceConfiguration serviceConfig cacheConfiguration getServiceConfigurations builder builder withService serviceConfig
Override public Consumer createConsumer final Processor processor throws Exception final SqlProcessingStrategy proStrategy new ElsqlSqlProcessingStrategy elSql final SqlPrepareStatementStrategy preStategy new ElsqlSqlPrepareStatementStrategy final Exchange dummy createExchange final SqlParameterSource param new ElsqlSqlMapSource dummy null final String sql elSql getSql elsqlName new SpringSqlParams param
Override public void process final Exchange exchange throws Exception final Object data exchange getIn getBody final SqlParameterSource param new ElsqlSqlMapSource exchange data final String sql elSql getSql elSqlName new SpringSqlParams param
Override public int commit DefaultSqlEndpoint defaultSqlEndpoint Exchange exchange Object data NamedParameterJdbcTemplate jdbcTemplate SqlParameterSource parameterSource String query throws Exception final SqlParameterSource param new ElsqlSqlMapSource exchange data final String sql elSql getSql query new SpringSqlParams param
Override public int commitBatchComplete DefaultSqlEndpoint endpoint NamedParameterJdbcTemplate namedJdbcTemplate SqlParameterSource parameterSource String query throws Exception final SqlParameterSource param new EmptySqlParameterSource final String sql elSql getSql query new SpringSqlParams param
public static void setIndex AtomicLong index EtcdKeysResponse response if response null response node null index set response node modifiedIndex
private void stopConsumer Route route synchronized lock try if suspendedRoutes contains route
private void startAllStoppedConsumers synchronized lock try for Route route suspendedRoutes
Throwable throwable promise getException if throwable EtcdException EtcdException exception EtcdException throwable if EtcdHelper isOutdatedIndexException exception LOGGER debug servicePath exception etcdCause index set exception index throwable null else try EtcdKeysResponse response promise get EtcdHelper setIndex index response if response node value null setLeader tryTakeLeadership else if ObjectHelper equal serviceName response node value leader get setLeader false
CompletableFuture GetResponse completableGetResponse kvClient get ByteSequence from String format prefixName key getBytes GetResponse getResponse completableGetResponse get List KeyValue keyValueList getResponse getKvs boolean optimisticLockingError keyValueList isEmpty if optimisticLockingError DefaultExchangeHolder holderFound DefaultExchangeHolder convertFromEtcd3Format keyValueList get getValue optimisticLockingError Objects equals holder holderFound if optimisticLockingError CompletableFuture DeleteResponse completableDeleteResponse kvClient delete ByteSequence from String format prefixName key getBytes DeleteResponse deleteResponse completableDeleteResponse get optimisticLockingError deleteResponse getDeleted if optimisticLockingError LOG warn key throw new OptimisticLockingException catch InterruptedException ExecutionException ClassNotFoundException IOException e
optimisticLockingError deleteResponse getDeleted if optimisticLockingError LOG warn key throw new OptimisticLockingException catch InterruptedException ExecutionException ClassNotFoundException IOException e LOG error e getMessage e throw new RuntimeException e getMessage e LOG trace exchange getExchangeId key if useRecovery LOG trace exchange getExchangeId key try CompletableFuture PutResponse completablePutResponse kvClient put ByteSequence from String format persistencePrefixName key getBytes convertToEtcd3Format holder completablePutResponse get LOG trace exchange getExchangeId key catch IOException InterruptedException ExecutionException e
catch IOException InterruptedException ExecutionException e LOG error e getMessage e throw new RuntimeException e getMessage e else if useRecovery LOG trace exchange getExchangeId key Txn transaction kvClient txn try CompletableFuture GetResponse completableResponse kvClient get ByteSequence from String format prefixName key getBytes GetResponse getResponse completableResponse get DefaultExchangeHolder removedHolder DefaultExchangeHolder convertFromEtcd3Format getResponse getKvs get getValue transaction If new Cmp ByteSequence from String format prefixName key getBytes Cmp Op EQUAL CmpTarget value ByteSequence from String format prefixName key getBytes Then Op delete ByteSequence from String format prefixName key getBytes DeleteOption DEFAULT Op put ByteSequence from String format persistencePrefixName key getBytes convertToEtcd3Format removedHolder PutOption DEFAULT commit LOG trace exchange getExchangeId key LOG trace exchange getExchangeId key catch Throwable throwable
Override public ExecResult execute ExecCommand command notNull command ByteArrayOutputStream out new ByteArrayOutputStream ByteArrayOutputStream err new ByteArrayOutputStream DefaultExecutor executor prepareDefaultExecutor command PumpStreamHandler handler new PumpStreamHandler out err command getInput executor setStreamHandler handler CommandLine cl toCommandLine command try int exitValue executor execute cl InputStream stdout out size null new ByteArrayInputStream out toByteArray InputStream stderr err size null new ByteArrayInputStream err toByteArray ExecResult result new ExecResult command stdout stderr exitValue return result catch ExecuteException ee
ExecResult result new ExecResult command stdout stderr exitValue return result catch ExecuteException ee LOG error command toString ee getMessage InputStream stdout out size null new ByteArrayInputStream out toByteArray InputStream stderr err size null new ByteArrayInputStream err toByteArray throw new ExecException command stdout stderr ee getExitValue ee catch IOException ioe InputStream stdout out size null new ByteArrayInputStream out toByteArray InputStream stderr err size null new ByteArrayInputStream err toByteArray int exitValue if executor ExecDefaultExecutor exitValue ExecDefaultExecutor executor getExitValue String msg ioe getMessage if msg null equals msg toLowerCase Locale ENGLISH
LOG error command toString ee getMessage InputStream stdout out size null new ByteArrayInputStream out toByteArray InputStream stderr err size null new ByteArrayInputStream err toByteArray throw new ExecException command stdout stderr ee getExitValue ee catch IOException ioe InputStream stdout out size null new ByteArrayInputStream out toByteArray InputStream stderr err size null new ByteArrayInputStream err toByteArray int exitValue if executor ExecDefaultExecutor exitValue ExecDefaultExecutor executor getExitValue String msg ioe getMessage if msg null equals msg toLowerCase Locale ENGLISH LOG debug ioe ExecResult result new ExecResult command stdout stderr exitValue return result
private ExecEndpoint createExecEndpoint String uri throws Exception
Test Disabled public void testJavaVersion throws Exception ExecResult body templateJavaVersion requestBody Object ExecResult class InputStream out body getStdout InputStream err body getStderr assertNull out assertNotNull err String outString IOUtils toString err Charset defaultCharset
Test Disabled public void testWinJavaVersionWorkingDir throws Exception ExecResult body templateJavaVersionWorkingDir requestBody Object ExecResult class InputStream out body getStdout InputStream err body getStderr assertNull out assertNotNull err String outerr IOUtils toString err Charset defaultCharset
Override protected RouteBuilder createRouteBuilder return new RouteBuilder public void configure from to process new Processor public void process Exchange exchange throws Exception assertIsInstanceOf ExecResult class exchange getIn getBody String wordCountOutput exchange getIn getBody String class
Override protected RouteBuilder createRouteBuilder return new RouteBuilder public void configure from to process new Processor public void process Exchange exchange throws Exception assertIsInstanceOf ExecResult class exchange getIn getBody String wordCountOutput exchange getIn getBody String class log info wordCountOutput from to from to buildJavaExecutablePath from to ANT_BUILD_FILE_NAME from to ANT_BUILD_FILE_NAME ANT_OUT_FILE_NAME ANT_OUT_FILE_NAME process new Processor public void process Exchange exchange throws Exception InputStream outFile exchange getIn getBody InputStream class
this nameStyle FacebookNameStyle EXACT else candidates addAll getCandidateMethods convertToGetMethod method argNames if candidates isEmpty this nameStyle FacebookNameStyle GET int nGetMethods candidates size candidates addAll getCandidateMethods convertToSearchMethod method argNames if candidates isEmpty throw new IllegalArgumentException String format method arguments if nameStyle null nameStyle FacebookNameStyle SEARCH else if candidates size nGetMethods nameStyle FacebookNameStyle GET_AND_SEARCH if LOG isDebugEnabled final Set String missing getMissingProperties method nameStyle arguments
public static List FacebookMethodsType getCandidateMethods String name String argNames final List FacebookMethodsType methods METHOD_MAP get name if methods null
public static Object invokeMethod Facebook facebook FacebookMethodsType method Map String Object properties throws RuntimeCamelException
Test public void testOfType throws Exception org hl7 fhir instance model api IBaseConformance result requestBody CapabilityStatement class
Test public void testEncodeJSON throws Exception Map String Object headers new HashMap headers put ExtraParameters ENCODE_JSON getHeaderName Boolean TRUE org hl7 fhir instance model api IBaseConformance result requestBodyAndHeaders CapabilityStatement class headers
Test public void testCreateResource throws Exception Patient patient new Patient addName new HumanName addGiven setFamily MethodOutcome result requestBody patient
Test public void testCreateStringResource throws Exception Patient patient new Patient addName new HumanName addGiven setFamily String patientString this fhirContext newXmlParser encodeResourceToString patient MethodOutcome result requestBody patientString
Test public void testCreateStringResourceEncodeXml throws Exception Patient patient new Patient addName new HumanName addGiven setFamily String patientString this fhirContext newXmlParser encodeResourceToString patient Map String Object headers new HashMap headers put ExtraParameters ENCODE_XML getHeaderName Boolean TRUE MethodOutcome result requestBodyAndHeaders patientString headers
Test public void testDeleteResource throws Exception assertTrue patientExists IBaseOperationOutcome result requestBody this patient
Test public void testDeleteResourceById throws Exception assertTrue patientExists IBaseOperationOutcome result requestBody this patient getIdElement
Test public void testDeleteResourceByStringId throws Exception assertTrue patientExists Map String Object headers new HashMap headers put headers put this patient getIdElement getIdPart IBaseOperationOutcome result requestBodyAndHeaders null headers
Test public void testDeleteResourceConditionalByUrl throws Exception assertTrue patientExists IBaseOperationOutcome result requestBody
Test public void testDeleteResourceConditionalByUrlCacheControlDirective throws Exception assertTrue patientExists Map String Object headers new HashMap headers put ExtraParameters CACHE_CONTROL_DIRECTIVE getHeaderName new CacheControlDirective setNoCache true IBaseOperationOutcome result requestBodyAndHeaders headers
Test public void testEncodeRequestToXml throws Exception final Map String Object headers new HashMap headers put ExtraParameters ENCODE_XML getHeaderName Boolean TRUE String url Bundle result requestBodyAndHeaders url headers
Test public void testOnInstance throws Exception final Map String Object headers new HashMap headers put this patient getIdElement headers put Bundle class headers put Bundle result requestBodyAndHeaders null headers
Test public void testOnServer throws Exception Map String Object headers new HashMap headers put Bundle class headers put Bundle result requestBodyAndHeaders null headers
Test public void testOnType throws Exception final Map String Object headers new HashMap headers put Patient class headers put Bundle class headers put Bundle result requestBodyAndHeaders null headers
Test public void testOnTypeWithSubsetElements throws Exception final Map String Object headers new HashMap headers put Patient class headers put Bundle class headers put headers put ExtraParameters SUBSET_ELEMENTS getHeaderName new String Bundle result requestBodyAndHeaders null headers
Test public void testByUrl throws Exception String url Bundle bundle this fhirClient search byUrl url returnBundle Bundle class execute assertNotNull bundle getLink IBaseBundle LINK_NEXT String nextPageLink bundle getLink getUrl final Map String Object headers new HashMap headers put nextPageLink headers put Bundle class IBaseBundle result requestBodyAndHeaders null headers
Test public void testNext throws Exception String url Bundle bundle this fhirClient search byUrl url returnBundle Bundle class execute assertNotNull bundle getLink IBaseBundle LINK_NEXT Bundle result requestBody bundle assertNotNull result
Test public void testPrevious throws Exception String url Bundle bundle this fhirClient search byUrl url returnBundle Bundle class execute assertNotNull bundle getLink IBaseBundle LINK_NEXT String nextPageLink bundle getLink getUrl bundle this fhirClient loadPage byUrl nextPageLink andReturnBundle Bundle class execute assertNotNull bundle getLink IBaseBundle LINK_PREV Bundle result requestBody bundle
Test public void testPreviousWithEncodingEnum throws Exception String url Bundle bundle this fhirClient search byUrl url returnBundle Bundle class execute assertNotNull bundle getLink IBaseBundle LINK_NEXT String nextPageLink bundle getLink getUrl bundle this fhirClient loadPage byUrl nextPageLink andReturnBundle Bundle class execute assertNotNull bundle getLink IBaseBundle LINK_PREV Map String Object headers new HashMap headers put ExtraParameters ENCODING_ENUM getHeaderName EncodingEnum XML Bundle result requestBodyAndHeaders bundle headers
Test public void testAdd throws Exception Meta meta fhirClient meta get Meta class fromResource this patient getIdElement execute assertEquals meta getTag size Meta inMeta new Meta inMeta addTag setSystem setCode final Map String Object headers new HashMap headers put inMeta headers put this patient getIdElement IBaseMetaType result requestBodyAndHeaders null headers
Test public void testDelete throws Exception Meta meta fhirClient meta get Meta class fromResource this patient getIdElement execute assertEquals meta getTag size Meta inMeta new Meta inMeta addTag setSystem setCode meta fhirClient meta add onResource this patient getIdElement meta inMeta execute assertEquals meta getTag size final Map String Object headers new HashMap headers put meta headers put this patient getIdElement IBaseMetaType result requestBodyAndHeaders null headers
Test public void testGetFromResource throws Exception final Map String Object headers new HashMap headers put Meta class headers put this patient getIdElement IBaseMetaType result requestBodyAndHeaders null headers
Test public void testGetFromServer throws Exception IBaseMetaType result requestBody Meta class assertNotNull result
Test public void testGetFromType throws Exception final Map String Object headers new HashMap headers put Meta class headers put IBaseMetaType result requestBodyAndHeaders null headers
Test public void testGetFromTypePreferResponseType throws Exception final Map String Object headers new HashMap headers put Meta class headers put headers put ExtraParameters PREFER_RESPONSE_TYPE getHeaderName Patient class Meta result requestBodyAndHeaders null headers
Test public void testOnInstance throws Exception final Map String Object headers new HashMap headers put this patient getIdElement headers put headers put null headers put Parameters class headers put Boolean FALSE headers put null headers put null final Parameters result requestBodyAndHeaders null headers
Test public void testOnInstanceVersion throws Exception final Map String Object headers new HashMap headers put this patient getIdElement headers put headers put null headers put Parameters class headers put Boolean FALSE headers put null headers put null final Parameters result requestBodyAndHeaders null headers
Test public void testOnType throws Exception final Map String Object headers new HashMap headers put Patient class headers put headers put null headers put Parameters class headers put Boolean FALSE headers put null headers put null final org hl7 fhir instance model api IBaseResource result requestBodyAndHeaders null headers assertNotNull result
Disabled Test public void testProcessMessage throws Exception final Map String Object headers new HashMap headers put null headers put null headers put Boolean FALSE headers put null headers put null final org hl7 fhir instance model api IBaseBundle result requestBodyAndHeaders null headers assertNotNull result
Test Disabled value public void testPatchByUrl throws Exception final Map String Object headers new HashMap headers put PATCH headers put headers put null MethodOutcome result requestBodyAndHeaders null headers assertNotNull result
private void assertActive MethodOutcome result
private void assertValidResponse Patient result
Test public void testSearchByUrl throws Exception String url Bundle result requestBody url
Test public void testWithBundle throws Exception Bundle result requestBody createTransactionBundle assertNotNull result assertTrue result getEntry get getResponse getStatus contains
Test public void testWithStringBundle throws Exception Bundle transactionBundle createTransactionBundle String stringBundle fhirContext newJsonParser encodeResourceToString transactionBundle final String result requestBody stringBundle assertNotNull result assertTrue result contains
Test public void testWithResources throws Exception Patient oscar new Patient addName new HumanName addGiven setFamily Patient bobbyHebb new Patient addName new HumanName addGiven setFamily List IBaseResource patients new ArrayList patients add oscar patients add bobbyHebb List IBaseResource result requestBody patients assertNotNull result
Test public void testWithResourcesSummaryEnum throws Exception Patient oscar new Patient addName new HumanName addGiven setFamily Patient bobbyHebb new Patient addName new HumanName addGiven setFamily List IBaseResource patients new ArrayList patients add oscar patients add bobbyHebb final Map String Object headers new HashMap headers put ExtraParameters SUMMARY_ENUM getHeaderName SummaryEnum DATA List IBaseResource result requestBodyAndHeaders patients headers assertNotNull result
Test public void testResource throws Exception Date date new SimpleDateFormat parse assertNotEquals date patient getBirthDate this patient setBirthDate date final Map String Object headers new HashMap headers put this patient headers put this patient getIdElement headers put PreferReturnEnum REPRESENTATION MethodOutcome result requestBodyAndHeaders null headers assertNotNull result
Test public void testResourceNoId throws Exception Date date new SimpleDateFormat parse assertNotEquals date patient getBirthDate this patient setBirthDate date final Map String Object headers new HashMap headers put this patient headers put PreferReturnEnum REPRESENTATION MethodOutcome result requestBodyAndHeaders null headers assertNotNull result
Test public void testResourceStringId throws Exception Date date new SimpleDateFormat parse assertNotEquals date patient getBirthDate this patient setBirthDate date final Map String Object headers new HashMap headers put this patient headers put this patient getIdElement getIdPart headers put PreferReturnEnum REPRESENTATION MethodOutcome result requestBodyAndHeaders null headers assertNotNull result
Test public void testResourceAsString throws Exception Date date new SimpleDateFormat parse assertNotEquals date patient getBirthDate this patient setBirthDate date final Map String Object headers new HashMap headers put this fhirContext newJsonParser encodeResourceToString this patient headers put this patient getIdElement headers put PreferReturnEnum REPRESENTATION MethodOutcome result requestBodyAndHeaders null headers assertNotNull result
Test public void testResourceAsStringWithStringId throws Exception Date date new SimpleDateFormat parse assertNotEquals date patient getBirthDate this patient setBirthDate date final Map String Object headers new HashMap headers put this fhirContext newJsonParser encodeResourceToString this patient headers put this patient getIdElement getIdPart headers put PreferReturnEnum REPRESENTATION MethodOutcome result requestBodyAndHeaders null headers assertNotNull result
Test public void testResourceBySearchUrl throws Exception Date date new SimpleDateFormat parse assertNotEquals date patient getBirthDate this patient setBirthDate date String url Patient SP_IDENTIFIER URLEncoder encode this patient getId final Map String Object headers new HashMap headers put this patient headers put url headers put PreferReturnEnum REPRESENTATION MethodOutcome result requestBodyAndHeaders null headers assertNotNull result
Test public void testResourceBySearchUrlAndResourceAsString throws Exception Date date new SimpleDateFormat parse assertNotEquals date patient getBirthDate this patient setBirthDate date String url Patient SP_IDENTIFIER URLEncoder encode this patient getId final Map String Object headers new HashMap headers put this fhirContext newJsonParser encodeResourceToString this patient headers put url headers put PreferReturnEnum REPRESENTATION MethodOutcome result requestBodyAndHeaders null headers assertNotNull result
Test public void testResource throws Exception Patient bobbyHebb new Patient addName new HumanName addGiven setFamily MethodOutcome result requestBody bobbyHebb assertNotNull result
Test public void testResourceAsString throws Exception Patient bobbyHebb new Patient addName new HumanName addGiven setFamily MethodOutcome result requestBody this fhirContext newXmlParser encodeResourceToString bobbyHebb assertNotNull result
Override protected boolean pollDirectory String fileName List GenericFile File fileList int depth LOG trace fileName depth File directory new File fileName if directory exists directory isDirectory
return false else if depth endpoint minDepth isValidFile gf false files LOG trace file if extendedAttributes null Path path file toPath Map String Object allAttributes new HashMap for String attribute extendedAttributes try String prefix null if attribute endsWith prefix attribute substring attribute length else if attribute equals prefix if ObjectHelper isNotEmpty prefix
Override public FileConsumer createConsumer Processor processor throws Exception ObjectHelper notNull operations ObjectHelper notNull file if file exists file isDirectory if isAutoCreate
private void writeFileByStream InputStream in File target throws IOException boolean exists target exists try SeekableByteChannel out prepareOutputFileChannel target
private void writeFileByReaderWithCharset Reader in File target String charset throws IOException boolean exists target exists boolean append endpoint getFileExist GenericFileExist Append try Writer out Files newBufferedWriter target toPath Charset forName charset StandardOpenOption WRITE append StandardOpenOption APPEND StandardOpenOption TRUNCATE_EXISTING StandardOpenOption CREATE
private void writeFileEmptyBody File target throws IOException if target exists
processStrategy prepareOnStartup operations endpoint prepareOnStartup true fileExpressionResult null shutdownRunningTask null pendingExchanges if prePollCheck LOG debug return List GenericFile T files new ArrayList String name endpoint getConfiguration getDirectory StopWatch stop new StopWatch boolean limitHit try limitHit pollDirectory name files catch Exception e
pendingExchanges if prePollCheck LOG debug return List GenericFile T files new ArrayList String name endpoint getConfiguration getDirectory StopWatch stop new StopWatch boolean limitHit try limitHit pollDirectory name files catch Exception e LOG debug name e getMessage files size removeExcessiveInProgressFiles files throw e long delta stop taken
if LOG isDebugEnabled LOG debug TimeUtils printDuration delta name if limitHit LOG debug maxMessagesPerPoll if endpoint getSorter null files sort endpoint getSorter LinkedList Exchange exchanges new LinkedList for GenericFile T file files Exchange exchange endpoint createExchange file endpoint configureExchange exchange endpoint configureMessage file exchange getIn exchanges add exchange if endpoint getSortBy null exchanges sort endpoint getSortBy if endpoint isShuffle
Override public int processBatch Queue Object exchanges int total exchanges size int answer total if maxMessagesPerPoll total maxMessagesPerPoll
LOG trace name endpoint boolean retrieved Exception cause null try retrieved operations retrieveFile name exchange target getFileLength catch Exception e retrieved false cause e if retrieved if ignoreCannotRetrieveFile name exchange cause LOG trace name endpoint getInProgressRepository remove absoluteFileName return false else if cause GenericFileOperationFailedException
Converter public static InputStream genericFileToInputStream GenericFile file Exchange exchange throws IOException if file getFile File File f File file getFile if f exists String charset file getCharset if charset null
Exchange dummy endpoint createExchange String parent FileUtil onlyPath fileName String onlyName FileUtil stripPath fileName dummy getIn setHeader Exchange FILE_NAME fileName dummy getIn setHeader Exchange FILE_NAME_ONLY onlyName dummy getIn setHeader Exchange FILE_PARENT parent String to endpoint getMoveExisting evaluate dummy String class to FileUtil normalizePath to if ObjectHelper isEmpty to throw new GenericFileOperationFailedException fileName File toFile new File to String directory toFile getParent boolean absolute FileUtil isAbsolute toFile if directory null if operations buildDirectory directory absolute
try consumer createConsumer null consumer setCustomProcessor new Processor Override public void process Exchange exchange throws Exception answer add exchange consumer setStartScheduler false ServiceHelper startService consumer consumer poll catch Exception e throw RuntimeCamelException wrapRuntimeCamelException e finally try ServiceHelper stopService consumer catch Exception e
protected void onCompletion Exchange exchange
int retryCounter boolean done false Throwable cause null int polledMessages PollingConsumerPollStrategy pollStrategy getConsumer getPollStrategy boolean sendEmptyMessageWhenIdle getConsumer isSendEmptyMessageWhenIdle StopWatch watch new StopWatch while done try cause null done true if isRunAllowed if retryCounter LOG trace this getEndpoint else
if retryCounter LOG trace this getEndpoint else LOG debug retryCounter this getEndpoint boolean begin pollStrategy begin getConsumer getEndpoint if begin retryCounter polledMessages getConsumer poll LOG trace polledMessages if polledMessages sendEmptyMessageWhenIdle processEmptyMessage else if polledMessages timeout done false pollStrategy commit getConsumer getEndpoint polledMessages else
Override public void process Exchange exchange throws Exception Object name exchange getIn getHeader Exchange FILE_NAME if name null
public void writeFile Exchange exchange String fileName throws GenericFileOperationFailedException if endpoint isAutoCreate String name FileUtil normalizePath fileName File file new File name String directory file getParent boolean absolute FileUtil isAbsolute file if directory null if operations buildDirectory directory absolute
try if localMember isLeader LOGGER trace path lock return synchronized FileLockClusterView this if lock null LOGGER info path lock fireLeadershipChangedEvent Optional empty LOGGER debug path lock null lock channel tryLock if lock null LOGGER info path lock fireLeadershipChangedEvent Optional of localMember else
LOGGER trace path lock return synchronized FileLockClusterView this if lock null LOGGER info path lock fireLeadershipChangedEvent Optional empty LOGGER debug path lock null lock channel tryLock if lock null LOGGER info path lock fireLeadershipChangedEvent Optional of localMember else LOGGER debug path catch OverlappingFileLockException e
Override public void prepareOnStartup GenericFileOperations File operations GenericFileEndpoint File endpoint throws Exception this endpoint endpoint
String key asKey file Runnable r if removeOnRollback idempotentRepository remove exchange key else idempotentRepository confirm exchange key try changed releaseExclusiveReadLockOnRollback operations file exchange catch Exception e LOG warn e if readLockIdempotentReleaseDelay readLockIdempotentReleaseExecutorService null LOG debug readLockIdempotentReleaseDelay readLockIdempotentReleaseExecutorService schedule r readLockIdempotentReleaseDelay TimeUnit MILLISECONDS else if readLockIdempotentReleaseDelay
String key asKey file Runnable r if removeOnCommit idempotentRepository remove exchange key else idempotentRepository confirm exchange key try changed releaseExclusiveReadLockOnCommit operations file exchange catch Exception e LOG warn e if readLockIdempotentReleaseDelay readLockIdempotentReleaseExecutorService null LOG debug readLockIdempotentReleaseDelay readLockIdempotentReleaseExecutorService schedule r readLockIdempotentReleaseDelay TimeUnit MILLISECONDS else if readLockIdempotentReleaseDelay
Override public void prepareOnStartup GenericFileOperations File operations GenericFileEndpoint File endpoint throws Exception this endpoint endpoint
Override public void prepareOnStartup GenericFileOperations File operations GenericFileEndpoint File endpoint throws Exception this endpoint endpoint
if target exists CamelLogger log LOG readLockLoggingLevel file return false try lock timeout channel tryLock channel lock catch IllegalStateException ex if lock null LOG trace lock target exclusive true else boolean interrupted sleep if interrupted return false catch IOException e if timeout
Override public void prepareOnStartup GenericFileOperations File operations GenericFileEndpoint File endpoint if deleteOrphanLockFiles String dir endpoint getConfiguration getDirectory File file new File dir
Override public void prepareOnStartup GenericFileOperations File operations GenericFileEndpoint File endpoint if deleteOrphanLockFiles String dir endpoint getConfiguration getDirectory File file new File dir LOG debug dir Pattern excludePattern endpoint getExcludePattern Pattern includePattern endpoint getIncludePattern String endpointPath endpoint getConfiguration getDirectory StopWatch watch new StopWatch deleteLockFiles file endpoint isRecursive endpointPath endpoint getFilter endpoint getAntFilter excludePattern includePattern if watch taken
Test public void testCamel throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedItemDesc counter body get
Test public void testCamel throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn assertEquals in getHeader counter Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedItemDescriptions counter body get
Test public void testCamel throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn assertEquals in getHeader counter Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedItemDescriptions counter body get
Test public void testCamel throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn assertEquals in getHeader counter Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedItemDescriptions counter body get
Test public void testCamel throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedItemDesc counter body get
Test public void testCamel throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedItemDesc counter body get
Test public void testCamel throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedItemDesc counter body get counter
Test public void testCamel throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn assertEquals in getHeader counter Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedFirstName counter body get
Test public void testFlatpack throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn assertEquals in getHeader counter Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedFirstName counter body get
Test public void testCamel throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn assertEquals in getHeader counter Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedFirstName counter body get
Test public void testCamel throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn assertEquals in getHeader counter Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedFirstName counter body get
Test public void testCamel throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedFirstName counter body get
Test public void testHeaderAndTrailer throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges Map header list get getIn getBody Map class assertEquals header get assertEquals header get for Exchange exchange list subList Message in exchange getIn Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedFirstName counter body get
Test public void testHeaderAndTrailer throws Exception results expectedMessageCount results message body isInstanceOf List class results message header isEqualTo results assertIsSatisfied List Map String String data CastUtils cast results getExchanges get getIn getBody List class Map String String header data get assertEquals header get assertEquals header get int counter for Map String String row data subList assertEquals expectedFirstName counter row get
Test public void testCamel throws Exception results expectedMessageCount results assertIsSatisfied int counter List Exchange list results getReceivedExchanges for Exchange exchange list Message in exchange getIn Map body in getBody Map class assertNotNull body ObjectHelper className in getBody assertEquals expectedItemDesc counter body get
else if column getAttribute equals assertEquals column getTextContent else fail NodeList list docElement getElementsByTagName for int counter counter list getLength counter Element record Element list item counter NodeList columnNodes record getElementsByTagName boolean firstNameFound false for int i i columnNodes getLength i Element column Element columnNodes item i if column getAttribute equals assertEquals expectedFirstName counter column getTextContent firstNameFound true assertTrue firstNameFound
else if column getAttribute equals assertEquals column getTextContent else fail for Exchange exchange list subList Message in exchange getIn Element record in getBody Document class getDocumentElement NodeList columnNodes record getElementsByTagName boolean firstNameFound false for int i i columnNodes getLength i Element column Element columnNodes item i if column getAttribute equals assertEquals expectedFirstName counter column getTextContent firstNameFound true assertTrue firstNameFound
public FreemarkerEndpoint findOrCreateEndpoint String uri String newResourceUri String newUri uri replace getResourceUri newResourceUri
Override protected void onExchange Exchange exchange throws Exception String path getResourceUri ObjectHelper notNull configuration ObjectHelper notNull path if allowTemplateFromHeader String newResourceUri exchange getIn getHeader FreemarkerConstants FREEMARKER_RESOURCE_URI String class if newResourceUri null exchange getIn removeHeader FreemarkerConstants FREEMARKER_RESOURCE_URI
return Reader reader null String content null if allowTemplateFromHeader content exchange getIn getHeader FreemarkerConstants FREEMARKER_TEMPLATE String class if content null reader new StringReader content exchange getIn removeHeader FreemarkerConstants FREEMARKER_TEMPLATE Object dataModel null if allowTemplateFromHeader dataModel exchange getIn getHeader FreemarkerConstants FREEMARKER_DATA_MODEL Object class if dataModel null dataModel ExchangeHelper createVariableMap exchange isAllowContextMapAll Template template if reader null
Reader reader null String content null if allowTemplateFromHeader content exchange getIn getHeader FreemarkerConstants FREEMARKER_TEMPLATE String class if content null reader new StringReader content exchange getIn removeHeader FreemarkerConstants FREEMARKER_TEMPLATE Object dataModel null if allowTemplateFromHeader dataModel exchange getIn getHeader FreemarkerConstants FREEMARKER_DATA_MODEL Object class if dataModel null dataModel ExchangeHelper createVariableMap exchange isAllowContextMapAll Template template if reader null log debug FreemarkerConstants FREEMARKER_TEMPLATE dataModel
Override protected void doStart throws Exception boolean startScheduler isStartScheduler setStartScheduler false try super doStart if endpoint isAutoCreate hasStartingDirectory String dir endpoint getConfiguration getDirectory
LOG trace dir if isUseList if isStepwise files operations listFiles else files operations listFiles dir else FTPFile file new FTPFile file setType FTPFile FILE_TYPE fileExpressionResult evaluateFileExpression if fileExpressionResult null file setName fileExpressionResult files new ArrayList files add file catch GenericFileOperationFailedException e
if files null files isEmpty LOG trace dir return true else LOG trace files size dir if getEndpoint isPreSort Collections sort files a b a getName compareTo b getName for FTPFile file files if LOG isTraceEnabled LOG trace file getName file isDirectory file isFile if canPollMoreFiles fileList return false if file isDirectory RemoteFile FTPFile remote asRemoteFile absolutePath file getEndpoint getCharset if endpoint isRecursive depth endpoint getMaxDepth isValidFile remote true files
if client null client createFtpClient if getBufferSize client setBufferSize getBufferSize if getConfiguration getConnectTimeout client setConnectTimeout getConfiguration getConnectTimeout if getConfiguration getSoTimeout soTimeout getConfiguration getSoTimeout dataTimeout getConfiguration getTimeout if getConfiguration getActivePortRange null String parts getConfiguration getActivePortRange split if parts length throw new IllegalArgumentException int min getCamelContext getTypeConverter mandatoryConvertTo int class parts int max getCamelContext getTypeConverter mandatoryConvertTo int class parts
int max getCamelContext getTypeConverter mandatoryConvertTo int class parts LOG debug min max client setActivePortRange min max if ftpClientParameters null Map String Object localParameters new HashMap ftpClientParameters Object timeout localParameters remove if timeout null soTimeout getCamelContext getTypeConverter convertTo int class timeout timeout localParameters remove if timeout null dataTimeout getCamelContext getTypeConverter convertTo int class timeout setProperties client localParameters if ftpClientConfigParameters null if ftpClientConfig null ftpClientConfig new FTPClientConfig
Override public boolean deleteFile String name throws GenericFileOperationFailedException
Override public boolean renameFile String from String to throws GenericFileOperationFailedException
boolean append resumeDownload existingSize os new FileOutputStream temp append exchange getIn setHeader Exchange FILE_LOCAL_WORK_PATH local getPath catch Exception e throw new GenericFileOperationFailedException local boolean result try GenericFile FTPFile target GenericFile FTPFile exchange getProperty FileComponent FILE_EXCHANGE_FILE target setBody local String remoteName name String currentDir null if endpoint getConfiguration isStepwise currentDir getCurrentDirectory String path FileUtil onlyPath name if path null
remoteName FileUtil stripPath name if resumeDownload existingSize clientActivityListener onResumeDownloading endpoint getConfiguration remoteServerInformation name existingSize log trace existingSize log debug remoteName existingSize client setRestartOffset existingSize log trace remoteName result client retrieveFile remoteName os exchange getIn setHeader FtpConstants FTP_REPLY_CODE client getReplyCode exchange getIn setHeader FtpConstants FTP_REPLY_STRING client getReplyString if endpoint getConfiguration isStepwise changeCurrentDirectory currentDir catch IOException e log trace name if resumeDownload
InputStream is null if exchange getIn getBody null if endpoint isAllowNullBody log trace is new ByteArrayInputStream new byte else throw new GenericFileOperationFailedException name try if is null String charset endpoint getCharset if charset null is new ByteArrayInputStream exchange getIn getMandatoryBody String class getBytes charset log trace is charset else is exchange getIn getMandatoryBody InputStream class
throw new GenericFileOperationFailedException name try if is null String charset endpoint getCharset if charset null is new ByteArrayInputStream exchange getIn getMandatoryBody String class getBytes charset log trace is charset else is exchange getIn getMandatoryBody InputStream class final StopWatch watch new StopWatch boolean answer log debug targetName is if endpoint getFileExist GenericFileExist Append log trace targetName answer client appendFile targetName is
String charset endpoint getCharset if charset null is new ByteArrayInputStream exchange getIn getMandatoryBody String class getBytes charset log trace is charset else is exchange getIn getMandatoryBody InputStream class final StopWatch watch new StopWatch boolean answer log debug targetName is if endpoint getFileExist GenericFileExist Append log trace targetName answer client appendFile targetName is else log trace targetName answer client storeFile targetName is
dataTimeout getConfiguration getTimeout if ftpClientParameters null Map String Object localParameters new HashMap ftpClientParameters Object timeout localParameters remove if timeout null soTimeout getCamelContext getTypeConverter convertTo int class timeout timeout localParameters remove if timeout null dataTimeout getCamelContext getTypeConverter convertTo int class timeout setProperties client localParameters if ftpClientConfigParameters null if ftpClientConfig null ftpClientConfig new FTPClientConfig Map String Object localConfigParameters new HashMap ftpClientConfigParameters setProperties ftpClientConfig localConfigParameters
boolean answer super connect configuration exchange FtpsConfiguration config FtpsConfiguration configuration if answer try String execProt config getExecProt Long execPbsz config getExecPbsz if config isDisableSecureDataChannelDefaults if ObjectHelper isEmpty execProt execProt if ObjectHelper isEmpty execPbsz execPbsz 0L if execPbsz null log debug execPbsz getFtpClient execPBSZ execPbsz if execProt null
Override public void handleFailedWrite Exchange exchange Exception exception throws Exception loggedIn false if isStopping isStopped
Override protected void doStart throws Exception boolean startScheduler isStartScheduler setStartScheduler false try super doStart if endpoint isAutoCreate hasStartingDirectory String dir endpoint getConfiguration getDirectory
else dir absolutePath LOG trace dir if isUseList if isStepwise files operations listFiles else files operations listFiles dir else fileExpressionResult evaluateFileExpression if fileExpressionResult null SftpRemoteFile file new SftpRemoteFileSingle fileExpressionResult files new ArrayList files add file catch GenericFileOperationFailedException e
LOG trace session createSession configuration if endpoint getConfiguration getConnectTimeout LOG trace endpoint getConfiguration getConnectTimeout session connect endpoint getConfiguration getConnectTimeout else LOG trace session connect LOG trace channel ChannelSftp session openChannel if endpoint getConfiguration getConnectTimeout LOG trace endpoint getConfiguration getConnectTimeout channel connect endpoint getConfiguration getConnectTimeout else LOG trace
protected Session createSession final RemoteFileConfiguration configuration throws JSchException final JSch jsch new JSch JSch setLogger new JSchLogger endpoint getConfiguration getJschLoggingLevel SftpConfiguration sftpConfig SftpConfiguration configuration if isNotEmpty sftpConfig getCiphers
ciphers put sftpConfig getCiphers JSch setConfig ciphers if isNotEmpty sftpConfig getPrivateKeyFile LOG debug sftpConfig getPrivateKeyFile if isNotEmpty sftpConfig getPrivateKeyPassphrase jsch addIdentity sftpConfig getPrivateKeyFile sftpConfig getPrivateKeyPassphrase else jsch addIdentity sftpConfig getPrivateKeyFile if sftpConfig getPrivateKey null LOG debug byte passphrase null if isNotEmpty sftpConfig getPrivateKeyPassphrase passphrase sftpConfig getPrivateKeyPassphrase getBytes StandardCharsets UTF_8 jsch addIdentity sftpConfig getPrivateKey null passphrase if sftpConfig getPrivateKeyUri null
if isNotEmpty sftpConfig getPrivateKeyPassphrase passphrase sftpConfig getPrivateKeyPassphrase getBytes StandardCharsets UTF_8 try InputStream is ResourceHelper resolveMandatoryResourceAsInputStream endpoint getCamelContext sftpConfig getPrivateKeyUri ByteArrayOutputStream bos new ByteArrayOutputStream IOHelper copyAndCloseInput is bos jsch addIdentity bos toByteArray null passphrase catch IOException e throw new JSchException sftpConfig getPrivateKeyUri e if sftpConfig getKeyPair null LOG debug KeyPair keyPair sftpConfig getKeyPair if keyPair getPrivate null StringBuilder sb new StringBuilder sb append append
try InputStream is ResourceHelper resolveMandatoryResourceAsInputStream endpoint getCamelContext sftpConfig getPrivateKeyUri ByteArrayOutputStream bos new ByteArrayOutputStream IOHelper copyAndCloseInput is bos jsch addIdentity bos toByteArray null passphrase catch IOException e throw new JSchException sftpConfig getPrivateKeyUri e if sftpConfig getKeyPair null LOG debug KeyPair keyPair sftpConfig getKeyPair if keyPair getPrivate null StringBuilder sb new StringBuilder sb append append sb append Base64 getEncoder encodeToString keyPair getPrivate getEncoded append sb append append
jsch addIdentity sb toString getBytes StandardCharsets UTF_8 null null else LOG warn if isNotEmpty sftpConfig getKnownHostsFile LOG debug sftpConfig getKnownHostsFile jsch setKnownHosts sftpConfig getKnownHostsFile if isNotEmpty sftpConfig getKnownHostsUri LOG debug sftpConfig getKnownHostsUri try InputStream is ResourceHelper resolveMandatoryResourceAsInputStream endpoint getCamelContext sftpConfig getKnownHostsUri jsch setKnownHosts is catch IOException e throw new JSchException sftpConfig getKnownHostsUri e if sftpConfig getKnownHosts null LOG debug
if isNotEmpty sftpConfig getKnownHostsFile LOG debug sftpConfig getKnownHostsFile jsch setKnownHosts sftpConfig getKnownHostsFile if isNotEmpty sftpConfig getKnownHostsUri LOG debug sftpConfig getKnownHostsUri try InputStream is ResourceHelper resolveMandatoryResourceAsInputStream endpoint getCamelContext sftpConfig getKnownHostsUri jsch setKnownHosts is catch IOException e throw new JSchException sftpConfig getKnownHostsUri e if sftpConfig getKnownHosts null LOG debug jsch setKnownHosts new ByteArrayInputStream sftpConfig getKnownHosts String knownHostsFile sftpConfig getKnownHostsFile if knownHostsFile null sftpConfig isUseUserKnownHostsFile
if isNotEmpty sftpConfig getKnownHostsUri LOG debug sftpConfig getKnownHostsUri try InputStream is ResourceHelper resolveMandatoryResourceAsInputStream endpoint getCamelContext sftpConfig getKnownHostsUri jsch setKnownHosts is catch IOException e throw new JSchException sftpConfig getKnownHostsUri e if sftpConfig getKnownHosts null LOG debug jsch setKnownHosts new ByteArrayInputStream sftpConfig getKnownHosts String knownHostsFile sftpConfig getKnownHostsFile if knownHostsFile null sftpConfig isUseUserKnownHostsFile knownHostsFile System getProperty LOG info knownHostsFile if ObjectHelper isNotEmpty knownHostsFile
Override public synchronized boolean deleteFile String name throws GenericFileOperationFailedException
Override public synchronized boolean renameFile String from String to throws GenericFileOperationFailedException
Override public synchronized boolean buildDirectory String directory boolean absolute throws GenericFileOperationFailedException directory endpoint getConfiguration normalizePath directory LOG trace directory absolute boolean success false boolean cdCheck this endpoint getConfiguration isExistDirCheckUsingLs String originalDirectory cdCheck getCurrentDirectory null try try if cdCheck channel cd directory else channel ls directory entry ChannelSftp LsEntrySelector BREAK success true catch SftpException e if success
this endpoint getMoveExistingFileStrategy moveExistingFile endpoint this targetName InputStream is null if exchange getIn getBody null if endpoint isAllowNullBody LOG trace is new ByteArrayInputStream new byte else throw new GenericFileOperationFailedException name try if is null String charset endpoint getCharset if charset null is new ByteArrayInputStream exchange getIn getMandatoryBody String class getBytes charset LOG trace is charset else
private void writeSlowFile throws Exception LOG debug createDirectory FTP_ROOT_DIR FileOutputStream fos new FileOutputStream FTP_ROOT_DIR true for int i i i fos write i LS getBytes
private void writeSlowFile throws Exception LOG debug createDirectory FTP_ROOT_DIR FileOutputStream fos new FileOutputStream FTP_ROOT_DIR true for int i i i fos write i LS getBytes
Override BeforeEach public void setUp throws Exception super setUp byte iso payload getBytes byte utf payload getBytes LOG debug new String iso Charset forName LOG debug new String utf Charset forName for byte b iso
Override BeforeEach public void setUp throws Exception byte utf payload getBytes byte iso payload getBytes LOG debug new String utf Charset forName LOG debug new String iso Charset forName for byte b utf
private void writeSlowFile throws Exception LOG debug createDirectory FTP_ROOT_DIR FileOutputStream fos new FileOutputStream FTP_ROOT_DIR true for int i i i fos write i LS getBytes
type message getHeader GangliaConstants METRIC_TYPE GMetricType class GMetricSlope slope conf getSlope if message getHeaders containsKey GangliaConstants METRIC_SLOPE slope message getHeader GangliaConstants METRIC_SLOPE GMetricSlope class String units conf getUnits if message getHeaders containsKey GangliaConstants METRIC_UNITS units message getHeader GangliaConstants METRIC_UNITS String class int tmax conf getTmax if message getHeaders containsKey GangliaConstants METRIC_TMAX tmax message getHeader GangliaConstants METRIC_TMAX Integer class int dmax conf getDmax if message getHeaders containsKey GangliaConstants METRIC_DMAX dmax message getHeader GangliaConstants METRIC_DMAX Integer class String value message getBody String class if value null value length type GMetricType FLOAT type GMetricType DOUBLE
String latlng exchange getIn getHeader GeoCoderConstants LATLNG String class if latlng null latlng endpoint getLatlng if latlng null String lat StringHelper before latlng String lng StringHelper after latlng LatLng latLng new LatLng Double parseDouble lat Double parseDouble lng LOG debug latlng GeocodingResult results GeocodingApi reverseGeocode context latLng await LOG debug results if results null extractGeoResult results exchange else if address null if equals address processCurrentLocation exchange
latlng endpoint getLatlng if latlng null String lat StringHelper before latlng String lng StringHelper after latlng LatLng latLng new LatLng Double parseDouble lat Double parseDouble lng LOG debug latlng GeocodingResult results GeocodingApi reverseGeocode context latLng await LOG debug results if results null extractGeoResult results exchange else if address null if equals address processCurrentLocation exchange else LOG debug address
protected void processCurrentLocation Exchange exchange throws Exception LOG debug GeolocationPayload payload new GeolocationPayload payload considerIp true GeolocationResult result GeolocationApi geolocate context payload await
protected void processCurrentLocation Exchange exchange throws Exception LOG debug GeolocationPayload payload new GeolocationPayload payload considerIp true GeolocationResult result GeolocationApi geolocate context payload await LOG debug result exchange getIn setHeader GeoCoderConstants STATUS GeocoderStatus OK String resLatlng result location toString exchange getIn setHeader GeoCoderConstants LATLNG resLatlng
protected void processCurrentLocation Exchange exchange throws Exception LOG debug GeolocationPayload payload new GeolocationPayload payload considerIp true GeolocationResult result GeolocationApi geolocate context payload await LOG debug result exchange getIn setHeader GeoCoderConstants STATUS GeocoderStatus OK String resLatlng result location toString exchange getIn setHeader GeoCoderConstants LATLNG resLatlng LOG debug resLatlng GeocodingResult results GeocodingApi reverseGeocode context result location await
Test public void testGeoCoderProxyNoAuth throws Exception GeoCoderEndpoint endpoint context getEndpoint getApiKey GeoCoderEndpoint class GeoApiContext context endpoint createGeoApiContext GeocodingApiRequest geocodingApiRequest GeocodingApi reverseGeocode context new LatLng GeocodingResult results geocodingApiRequest await
Test public void testGeoCoderWithAuth throws Exception GeoCoderEndpoint endpoint context getEndpoint getApiKey GeoCoderEndpoint class GeoApiContext context endpoint createGeoApiContext GeocodingApiRequest geocodingApiRequest GeocodingApi reverseGeocode context new LatLng GeocodingResult results geocodingApiRequest await
else throw new IllegalArgumentException operation if ObjectHelper isNotEmpty exchange getIn getHeader GitConstants GIT_COMMIT_USERNAME ObjectHelper isNotEmpty exchange getIn getHeader GitConstants GIT_COMMIT_EMAIL username exchange getIn getHeader GitConstants GIT_COMMIT_USERNAME String class email exchange getIn getHeader GitConstants GIT_COMMIT_EMAIL String class boolean allowEmpty endpoint isAllowEmpty if ObjectHelper isNotEmpty exchange getIn getHeader GitConstants GIT_ALLOW_EMPTY allowEmpty exchange getIn getHeader GitConstants GIT_ALLOW_EMPTY Boolean class try if ObjectHelper isNotEmpty endpoint getBranchName git checkout setCreateBranch false setName endpoint getBranchName call if ObjectHelper isNotEmpty username ObjectHelper isNotEmpty email git commit setAllowEmpty allowEmpty setCommitter username email setMessage commitMessage call else git commit setAllowEmpty allowEmpty setMessage commitMessage call
else throw new IllegalArgumentException operation if ObjectHelper isNotEmpty exchange getIn getHeader GitConstants GIT_COMMIT_USERNAME ObjectHelper isNotEmpty exchange getIn getHeader GitConstants GIT_COMMIT_EMAIL username exchange getIn getHeader GitConstants GIT_COMMIT_USERNAME String class email exchange getIn getHeader GitConstants GIT_COMMIT_EMAIL String class boolean allowEmpty endpoint isAllowEmpty if ObjectHelper isNotEmpty exchange getIn getHeader GitConstants GIT_ALLOW_EMPTY allowEmpty exchange getIn getHeader GitConstants GIT_ALLOW_EMPTY Boolean class try if ObjectHelper isNotEmpty endpoint getBranchName git checkout setCreateBranch false setName endpoint getBranchName call if ObjectHelper isNotEmpty username ObjectHelper isNotEmpty email git commit setAllowEmpty allowEmpty setAll true setCommitter username email setMessage commitMessage call else git commit setAllowEmpty allowEmpty setAll true setMessage commitMessage call
CherryPickResult result null String commitId null try if ObjectHelper isNotEmpty exchange getIn getHeader GitConstants GIT_COMMIT_ID commitId exchange getIn getHeader GitConstants GIT_COMMIT_ID String class else throw new IllegalArgumentException operation RevWalk walk new RevWalk repo ObjectId id repo resolve commitId RevCommit commit walk parseCommit id walk dispose if ObjectHelper isNotEmpty endpoint getBranchName git checkout setCreateBranch false setName endpoint getBranchName call result git cherryPick include commit call catch Exception e
public synchronized RepositoryCommit addRepositoryCommit User author new User author setEmail author setHtmlUrl author setLogin RepositoryCommit rc new RepositoryCommit rc setAuthor author rc setSha fakeSha incrementAndGet
private Bigquery buildClient HttpTransport httpTransport throws Exception GoogleCredential credential null if Strings isNullOrEmpty serviceAccount Strings isNullOrEmpty serviceAccountKey if logger isDebugEnabled
String tmpSuffix ex getIn getHeader GoogleBigQueryConstants TABLE_SUFFIX String class String tmpTableId ex getIn getHeader GoogleBigQueryConstants TABLE_ID tableId String class if tmpTableId isEmpty throw new IllegalArgumentException if tmpPartitionDecorator equals partitionDecorator tmpSuffix equals suffix tmpTableId equals tableId if processGroup isEmpty totalProcessed process tableId partitionDecorator suffix processGroup exchange getExchangeId processGroup clear partitionDecorator tmpPartitionDecorator suffix tmpSuffix tableId tmpTableId processGroup add ex if processGroup isEmpty totalProcessed process tableId partitionDecorator suffix processGroup exchange getExchangeId if totalProcessed
Override public void process Exchange exchange throws Exception String translatedQuery SqlHelper translateQuery query exchange Map String Object queryParameters extractParameters exchange exchange getMessage setHeader GoogleBigQueryConstants TRANSLATED_QUERY translatedQuery Long affectedRows executeSQL translatedQuery queryParameters
protected void assertRowExist String tableName Map String String row throws Exception QueryRequest queryRequest new QueryRequest String query DATASET_ID tableName row entrySet stream map e e getKey e getValue collect Collectors joining
Test public void testList throws Exception final com google api services calendar model Acl result requestBody getCalendar getId assertTrue result getItems size
Test public void testGet throws Exception com google api services calendar model Colors result requestBody null assertNotNull result
event setLocation ArrayList EventAttendee attendees new ArrayList attendees add new EventAttendee setEmail event setAttendees attendees Date startDate new Date Date endDate new Date startDate getTime DateTime start new DateTime startDate TimeZone getTimeZone event setStart new EventDateTime setDateTime start DateTime end new DateTime endDate TimeZone getTimeZone event setEnd new EventDateTime setDateTime end final Map String Object headers new HashMap headers put getCalendar getId headers put event final com google api services calendar model Event result requestBodyAndHeaders null headers assertEquals result getSummary
Test public void testQuery throws Exception com google api services calendar model FreeBusyRequest request new FreeBusyRequest List FreeBusyRequestItem items new ArrayList items add new FreeBusyRequestItem setId getCalendar getId request setItems items request setTimeMin DateTime parseRfc3339 request setTimeMax DateTime parseRfc3339 final com google api services calendar model FreeBusyResponse result requestBody request assertNotNull result
Test public void testGet throws Exception final com google api services calendar model Setting result requestBody assertNotNull result
Test public void testList throws Exception final com google api services calendar model Settings result requestBody null assertNotNull result
Test public void testGet throws Exception final com google api services drive model About result requestBody null assertNotNull result
Disabled Test public void testList throws Exception final com google api services drive model App result requestBody null assertNotNull result
Test public void testGet throws Exception final com google api services drive model ChangeList list requestBody null List Change items list getItems if items isEmpty Change change items get Long id change getId final com google api services drive model Change result requestBody id assertNotNull result
Test public void testList throws Exception final com google api services drive model ChangeList result requestBody null assertNotNull result
Test public void testUploadFileToFolder throws Exception File folder uploadTestFolder File file uploadTestFile final Map String Object headers new HashMap headers put folder getId com google api services drive model ChildReference child new com google api services drive model ChildReference child setId file getId headers put child requestBodyAndHeaders null headers final com google api services drive model ChildList result requestBody folder getId assertNotNull result
Test public void testComment throws Exception File testFile uploadTestFile String fileId testFile getId Map String Object headers new HashMap headers put fileId com google api services drive model Comment comment new com google api services drive model Comment comment setContent headers put comment requestBodyAndHeaders null headers com google api services drive model CommentList result1 requestBody fileId assertNotNull result1 get
Test public void testCopy throws Exception File testFile uploadTestFile String fromFileId testFile getId File toFile new File toFile setTitle UPLOAD_FILE getName final Map String Object headers new HashMap headers put fromFileId headers put toFile final File result requestBodyAndHeaders null headers assertNotNull result assertEquals toFile getTitle result getTitle
Test public void testGet throws Exception File testFile uploadTestFile String fileId testFile getId final File result requestBody fileId assertNotNull result
Test public void testInsert throws Exception File file new File file setTitle UPLOAD_FILE getName File result requestBody file assertNotNull result
Test public void testInsert1 throws Exception File result uploadTestFile assertNotNull result
Test public void testPatch throws Exception File file uploadTestFile file setTitle UPLOAD_FILE getName final Map String Object headers new HashMap headers put file getId headers put headers put file File result requestBodyAndHeaders null headers assertNotNull result assertEquals UPLOAD_FILE getName result getTitle
Test public void testUpdate throws Exception File theTestFile uploadTestFile final Map String Object headers new HashMap headers put theTestFile getId headers put theTestFile File result requestBodyAndHeaders null headers assertNotNull result
Test public void testUpdate1 throws Exception File testFile uploadTestFile String fileId testFile getId final File file requestBody fileId file setTitle java io File fileContent new java io File TEST_UPLOAD_IMG FileContent mediaContent new FileContent null fileContent final Map String Object headers new HashMap headers put fileId headers put file headers put mediaContent File result requestBodyAndHeaders null headers assertNotNull result
Disabled Test public void testWatch throws Exception final Map String Object headers new HashMap headers put null headers put null final com google api services drive Drive Files Watch result requestBodyAndHeaders null headers assertNotNull result
Test public void testList throws Exception File testFile uploadTestFile String fileId testFile getId final com google api services drive model PermissionList result requestBody fileId assertNotNull result
Test public void testList throws Exception File testFile uploadTestFile String fileId testFile getId final com google api services drive model PropertyList result requestBody fileId assertNotNull result
Test public void testReplyToComment throws Exception File testFile uploadTestFile String fileId testFile getId Map String Object headers new HashMap headers put fileId com google api services drive model Comment comment new com google api services drive model Comment comment setContent headers put comment requestBodyAndHeaders null headers com google api services drive model CommentList result1 requestBody fileId assertNotNull result1 get
LOG debug result1 Comment comment2 result1 getItems get String commentId comment2 getCommentId headers new HashMap headers put fileId headers put commentId com google api services drive model CommentReply reply new com google api services drive model CommentReply reply setContent headers put reply requestBodyAndHeaders null headers headers new HashMap headers put fileId headers put commentId final com google api services drive model CommentReplyList result requestBodyAndHeaders null headers assertNotNull result
Test public void testList throws Exception File testFile uploadTestFile String fileId testFile getId final com google api services drive model RevisionList result requestBody fileId assertNotNull result
Test public void testGetProfile throws Exception final com google api services gmail model Profile result requestBody CURRENT_USERID assertNotNull result assertNotNull result getEmailAddress
Test public void testList throws Exception Message m1 createThreadedTestEmail null Message m2 createThreadedTestEmail m1 getThreadId Map String Object headers new HashMap headers put com google api services gmail model ListThreadsResponse result requestBodyAndHeaders CURRENT_USERID headers assertNotNull result assertTrue result getThreads size
Override protected void doStop throws Exception super doStop localLog info endpoint getProjectId endpoint getDestinationName if subscribers null subscribers isEmpty
Test public void testCreate throws Exception String title new Random nextInt Integer MAX_VALUE Spreadsheet sheetToCreate new Spreadsheet SpreadsheetProperties sheetProperties new SpreadsheetProperties sheetProperties setTitle title sheetToCreate setProperties sheetProperties assertThatGoogleApi getGoogleApiTestServer createSpreadsheetRequest hasTitle title andReturnRandomSpreadsheet final Spreadsheet result requestBody sheetToCreate assertNotNull result assertEquals title result getProperties getTitle
Test public void testGet throws Exception assertThatGoogleApi getGoogleApiTestServer createSpreadsheetRequest hasSheetTitle andReturnRandomSpreadsheet Spreadsheet testSheet getSpreadsheet assertThatGoogleApi getGoogleApiTestServer getSpreadsheetRequest testSheet getSpreadsheetId andReturnSpreadsheet testSheet final Spreadsheet result requestBody testSheet getSpreadsheetId assertNotNull result assertEquals testSheet getSpreadsheetId result getSpreadsheetId
Test public void testBatchUpdate throws Exception assertThatGoogleApi getGoogleApiTestServer createSpreadsheetRequest hasSheetTitle andReturnRandomSpreadsheet Spreadsheet testSheet getSpreadsheet String updateTitle testSheet getProperties getTitle assertThatGoogleApi getGoogleApiTestServer batchUpdateSpreadsheetRequest testSheet getSpreadsheetId updateTitle updateTitle andReturnUpdated final Map String Object headers new HashMap headers put GoogleSheetsConstants PROPERTY_PREFIX testSheet getSpreadsheetId headers put GoogleSheetsConstants PROPERTY_PREFIX new BatchUpdateSpreadsheetRequest setIncludeSpreadsheetInResponse true setRequests Collections singletonList new Request setUpdateSpreadsheetProperties new UpdateSpreadsheetPropertiesRequest setProperties new SpreadsheetProperties setTitle updateTitle setFields final BatchUpdateSpreadsheetResponse result requestBodyAndHeaders null headers assertNotNull result assertEquals updateTitle result getUpdatedSpreadsheet getProperties getTitle
Test public void testGet throws Exception assertThatGoogleApi getGoogleApiTestServer createSpreadsheetRequest hasSheetTitle andReturnRandomSpreadsheet Spreadsheet testSheet getSpreadsheet assertThatGoogleApi getGoogleApiTestServer getValuesRequest testSheet getSpreadsheetId TEST_SHEET andReturnValues Collections emptyList final Map String Object headers new HashMap headers put GoogleSheetsConstants PROPERTY_PREFIX testSheet getSpreadsheetId headers put GoogleSheetsConstants PROPERTY_PREFIX TEST_SHEET final ValueRange result requestBodyAndHeaders null headers assertNotNull result assertEquals TEST_SHEET result getRange assertTrue ObjectHelper isEmpty result getValues
List List Object data Arrays asList Arrays asList Arrays asList assertThatGoogleApi getGoogleApiTestServer updateValuesRequest testSheet getSpreadsheetId TEST_SHEET data andReturnUpdateResponse ValueRange values new ValueRange values setValues data final Map String Object headers new HashMap headers put GoogleSheetsConstants PROPERTY_PREFIX testSheet getSpreadsheetId headers put GoogleSheetsConstants PROPERTY_PREFIX TEST_SHEET headers put GoogleSheetsConstants PROPERTY_PREFIX values headers put GoogleSheetsConstants PROPERTY_PREFIX final UpdateValuesResponse result requestBodyAndHeaders null headers assertNotNull result assertEquals testSheet getSpreadsheetId result getSpreadsheetId assertEquals TEST_SHEET result getUpdatedRange assertEquals Integer valueOf result getUpdatedRows assertEquals Integer valueOf result getUpdatedCells
assertThatGoogleApi getGoogleApiTestServer createSpreadsheetRequest hasSheetTitle andReturnRandomSpreadsheet Spreadsheet testSheet getSpreadsheet List List Object data Collections singletonList Arrays asList assertThatGoogleApi getGoogleApiTestServer appendValuesRequest testSheet getSpreadsheetId TEST_SHEET data andReturnAppendResponse TEST_SHEET final Map String Object headers new HashMap headers put GoogleSheetsConstants PROPERTY_PREFIX testSheet getSpreadsheetId headers put GoogleSheetsConstants PROPERTY_PREFIX TEST_SHEET headers put GoogleSheetsConstants PROPERTY_PREFIX new ValueRange setValues data headers put GoogleSheetsConstants PROPERTY_PREFIX final AppendValuesResponse result requestBodyAndHeaders null headers assertNotNull result assertEquals testSheet getSpreadsheetId result getSpreadsheetId assertEquals TEST_SHEET result getUpdates getUpdatedRange assertEquals Integer valueOf result getUpdates getUpdatedRows assertEquals Integer valueOf result getUpdates getUpdatedCells
Test public void testClear throws Exception String spreadsheetId UUID randomUUID toString assertThatGoogleApi getGoogleApiTestServer createSpreadsheetRequest hasSheetTitle andReturnSpreadsheet spreadsheetId Spreadsheet testSheet getSpreadsheet assertThatGoogleApi getGoogleApiTestServer updateValuesRequest spreadsheetId TEST_SHEET Arrays asList Arrays asList Arrays asList andReturnUpdateResponse applyTestData testSheet assertThatGoogleApi getGoogleApiTestServer clearValuesRequest testSheet getSpreadsheetId TEST_SHEET andReturnClearResponse TEST_SHEET final Map String Object headers new HashMap headers put GoogleSheetsConstants PROPERTY_PREFIX testSheet getSpreadsheetId headers put GoogleSheetsConstants PROPERTY_PREFIX TEST_SHEET headers put GoogleSheetsConstants PROPERTY_PREFIX new ClearValuesRequest final ClearValuesResponse result requestBodyAndHeaders null headers assertNotNull result assertEquals testSheet getSpreadsheetId result getSpreadsheetId assertEquals TEST_SHEET result getClearedRange
Override protected void doStart throws Exception super doStart if server null LOG info initializeServer server start
protected void initializeServer throws Exception NettyServerBuilder serverBuilder BindableService bindableService getBindableServiceFactory createBindableService this ServerInterceptor headerInterceptor new GrpcHeaderInterceptor if ObjectHelper isEmpty configuration getHost ObjectHelper isEmpty configuration getPort
protected void initializeChannel throws Exception NettyChannelBuilder channelBuilder if ObjectHelper isEmpty configuration getHost ObjectHelper isEmpty configuration getPort
Override public void applyRequestMetadata RequestInfo requestInfo Executor executor MetadataApplier metadataApplier String authority requestInfo getTransportAttrs get ATTR_LB_ADDR_AUTHORITY
BeforeAll public static void startGrpcServer throws Exception grpcServer ServerBuilder forPort GRPC_TEST_PORT addService new PingPongImpl build start
BeforeAll public static void startGrpcServer throws Exception grpcServerWithTLS NettyServerBuilder forPort GRPC_TLS_TEST_PORT sslContext GrpcSslContexts forServer new File new File trustManager new File clientAuth ClientAuth REQUIRE sslProvider SslProvider OPENSSL build addService new PingPongImpl build start grpcServerWithJWT NettyServerBuilder forPort GRPC_JWT_TEST_PORT addService new PingPongImpl intercept new JwtServerInterceptor JwtAlgorithm HMAC256 GRPC_JWT_CORRECT_SECRET null null build start
BeforeAll public static void startGrpcServer throws Exception grpcServerWithTLS NettyServerBuilder forPort GRPC_TLS_TEST_PORT sslContext GrpcSslContexts forServer new File new File trustManager new File clientAuth ClientAuth REQUIRE sslProvider SslProvider OPENSSL build addService new PingPongImpl build start grpcServerWithJWT NettyServerBuilder forPort GRPC_JWT_TEST_PORT addService new PingPongImpl intercept new JwtServerInterceptor JwtAlgorithm HMAC256 GRPC_JWT_CORRECT_SECRET null null build start LOG info GRPC_TLS_TEST_PORT
BeforeEach public void startGrpcServer throws Exception pingPongServer new PingPongImpl grpcServer ServerBuilder forPort GRPC_TEST_PORT addService pingPongServer build start
BeforeAll public static void startGrpcServer throws Exception grpcServer ServerBuilder forPort GRPC_TEST_PORT addService new PingPongImpl build start
public void doEventReceived Object event log trace event final Exchange exchange eventBusEndpoint createExchange event
Override public void process Exchange exchange throws Exception Object body exchange getIn getBody if body null
configUri getCamelContext resolvePropertyPlaceholders configUri if configUri null InputStream is ResourceHelper resolveMandatoryResourceAsInputStream context configUri config new XmlConfigBuilder is build if hazelcastInstance null config null config new XmlConfigBuilder build config getProperties setProperty config getProperties setProperty hzInstance Hazelcast newHazelcastInstance config else if config null if ObjectHelper isNotEmpty config getInstanceName hzInstance Hazelcast getOrCreateHazelcastInstance config else hzInstance Hazelcast newHazelcastInstance config if hzInstance null
if config null String configUri getAndRemoveParameter parameters HAZELCAST_CONFIGU_URI_PARAM String class if configUri null configUri getCamelContext resolvePropertyPlaceholders configUri if configUri null InputStream is ResourceHelper resolveMandatoryResourceAsInputStream context configUri config new XmlClientConfigBuilder is build if hazelcastInstance null config null config new XmlClientConfigBuilder build config getProperties setProperty config getProperties setProperty hzInstance HazelcastClient newHazelcastClient config else if config null hzInstance HazelcastClient newHazelcastClient config if hzInstance null
private synchronized void stopConsumer Route route try if suspendedRoutes contains route
private synchronized void startAllStoppedConsumers try for Route route suspendedRoutes
final Object body queue poll endpoint getConfiguration getPollTimeout TimeUnit MILLISECONDS if body null if body DefaultExchangeHolder DefaultExchangeHolder unmarshal exchange DefaultExchangeHolder body else exchange getIn setBody body try processor process exchange new AsyncCallback public void done boolean asyncDone if exchange getException null if transactionCtx null transactionCtx rollbackTransaction getExceptionHandler handleException exchange exchange getException catch Exception e
try processor process exchange new AsyncCallback public void done boolean asyncDone if exchange getException null if transactionCtx null transactionCtx rollbackTransaction getExceptionHandler handleException exchange exchange getException catch Exception e LOG error e e if transactionCtx null LOG trace transactionCtx getTxnId transactionCtx rollbackTransaction if exchange getException null transactionCtx null LOG trace transactionCtx getTxnId
Override public Exchange add CamelContext camelContext String key Exchange oldExchange Exchange newExchange throws OptimisticLockingException if optimistic throw new UnsupportedOperationException LOG trace newExchange getExchangeId key if oldExchange null DefaultExchangeHolder holder DefaultExchangeHolder marshal newExchange true allowSerializedHeaders final DefaultExchangeHolder misbehaviorHolder cache putIfAbsent key holder if misbehaviorHolder null Exchange misbehaviorEx unmarshallExchange camelContext misbehaviorHolder LOG error key misbehaviorEx null misbehaviorEx getExchangeId throw new OptimisticLockingException else DefaultExchangeHolder oldHolder DefaultExchangeHolder marshal oldExchange true allowSerializedHeaders DefaultExchangeHolder newHolder DefaultExchangeHolder marshal newExchange true allowSerializedHeaders if cache replace key oldHolder newHolder
Override public void remove CamelContext camelContext String key Exchange exchange DefaultExchangeHolder holder DefaultExchangeHolder marshal exchange true allowSerializedHeaders if optimistic LOG trace exchange getExchangeId key if cache remove key holder
Override public Exchange add CamelContext camelContext String key Exchange oldExchange Exchange newExchange throws OptimisticLockingException if optimistic throw new UnsupportedOperationException LOG trace newExchange getExchangeId key if oldExchange null DefaultExchangeHolder holder DefaultExchangeHolder marshal newExchange true allowSerializedHeaders final DefaultExchangeHolder misbehaviorHolder replicatedCache putIfAbsent key holder if misbehaviorHolder null Exchange misbehaviorEx unmarshallExchange camelContext misbehaviorHolder LOG error key misbehaviorEx null misbehaviorEx getExchangeId throw new OptimisticLockingException else DefaultExchangeHolder oldHolder DefaultExchangeHolder marshal oldExchange true allowSerializedHeaders DefaultExchangeHolder newHolder DefaultExchangeHolder marshal newExchange true allowSerializedHeaders if replicatedCache replace key oldHolder newHolder
Override public void remove CamelContext camelContext String key Exchange exchange DefaultExchangeHolder holder DefaultExchangeHolder marshal exchange true allowSerializedHeaders if optimistic LOG trace exchange getExchangeId key if replicatedCache remove key holder
Override public int processBatch Queue Object exchanges throws Exception int total exchanges size if maxMessagesPerPoll total maxMessagesPerPoll
private HdfsInfo setupHdfs boolean onStartup throws IOException String hdfsFsDescription endpointConfig getFileSystemLabel hdfsPath toString if onStartup
private int processFileStatuses HdfsInfo info FileStatus fileStatuses final AtomicInteger totalMessageCount new AtomicInteger List HdfsInputStream hdfsFiles Arrays stream fileStatuses filter status normalFileIsDirectoryHasSuccessFile status info filter this :: hasMatchingOwner limit endpointConfig getMaxMessagesPerPoll map this :: asHdfsFile filter Objects :: nonNull collect Collectors toList
private int processFileStatuses HdfsInfo info FileStatus fileStatuses final AtomicInteger totalMessageCount new AtomicInteger List HdfsInputStream hdfsFiles Arrays stream fileStatuses filter status normalFileIsDirectoryHasSuccessFile status info filter this :: hasMatchingOwner limit endpointConfig getMaxMessagesPerPoll map this :: asHdfsFile filter Objects :: nonNull collect Collectors toList LOG info hdfsFiles size fileStatuses length for int i i hdfsFiles size i HdfsInputStream hdfsFile hdfsFiles get i try int messageCount processHdfsInputStream hdfsFile totalMessageCount
private int processFileStatuses HdfsInfo info FileStatus fileStatuses final AtomicInteger totalMessageCount new AtomicInteger List HdfsInputStream hdfsFiles Arrays stream fileStatuses filter status normalFileIsDirectoryHasSuccessFile status info filter this :: hasMatchingOwner limit endpointConfig getMaxMessagesPerPoll map this :: asHdfsFile filter Objects :: nonNull collect Collectors toList LOG info hdfsFiles size fileStatuses length for int i i hdfsFiles size i HdfsInputStream hdfsFile hdfsFiles get i try int messageCount processHdfsInputStream hdfsFile totalMessageCount LOG debug i hdfsFiles size
private boolean hasMatchingOwner FileStatus fileStatus if endpointConfig getOwner null endpointConfig getOwner equals fileStatus getOwner if LOG isDebugEnabled
public static HdfsInputStream createInputStream String hdfsPath HdfsInfoFactory hdfsInfoFactory HdfsConfiguration endpointConfig hdfsInfoFactory getEndpointConfig HdfsInputStream iStream new HdfsInputStream iStream fileType endpointConfig getFileType iStream actualPath hdfsPath iStream suffixedPath iStream actualPath endpointConfig getOpenedSuffix iStream suffixedReadPath iStream actualPath endpointConfig getReadSuffix iStream chunkSize endpointConfig getChunkSize iStream streamDownload endpointConfig isStreamDownload try iStream info hdfsInfoFactory newHdfsInfo iStream actualPath if iStream info getFileSystem rename new Path iStream actualPath new Path iStream suffixedPath iStream in iStream fileType createInputStream iStream suffixedPath hdfsInfoFactory iStream opened true else
if oStream null return oStream StringBuilder actualPath new StringBuilder hdfsPath if config hasSplitStrategies actualPath newFileName String hdfsFsDescription config getFileSystemLabel actualPath toString if onStartup LOG info hdfsFsDescription else LOG debug hdfsFsDescription HdfsInfoFactory hdfsInfoFactory new HdfsInfoFactory config HdfsOutputStream answer HdfsOutputStream createOutputStream actualPath toString hdfsInfoFactory if onStartup LOG info hdfsFsDescription else
IOHelper close oStream LOG StringBuilder actualPath newFileName oStream HdfsOutputStream createOutputStream actualPath toString hdfsInfoFactory String path oStream getActualPath LOG trace path oStream append key body exchange idle set false boolean close scheduler null Boolean closeHeader exchange getIn getHeader HdfsConstants HDFS_CLOSE Boolean class if closeHeader null close closeHeader if close try LOG trace oStream close
private void processExchangeForUser String user Exchange exchange throws Exception String urlPath String format getMostRecentMessageUrl user
private void processApiResponse Exchange exchange CloseableHttpResponse response throws Exception try Map String Object jsonMap MAPPER readValue response getEntity getContent MAP_TYPE
private void processApiResponse Exchange exchange CloseableHttpResponse response throws Exception try Map String Object jsonMap MAPPER readValue response getEntity getContent MAP_TYPE LOG debug response MAPPER writeValueAsString jsonMap if jsonMap null jsonMap size List Map String Object items List Map String Object jsonMap get HipchatApiConstants API_ITEMS if items null items size try Map String Object item items get String date String item get HipchatApiConstants API_DATE String message String item get HipchatApiConstants API_MESSAGE
private StatusLine sendUserMessage String user Exchange exchange throws IOException InvalidPayloadException String urlPath String format getConfig withAuthToken HipchatApiConstants URI_PATH_USER_MESSAGE user Map String String jsonParam getCommonHttpPostParam exchange
private StatusLine sendUserMessage String user Exchange exchange throws IOException InvalidPayloadException String urlPath String format getConfig withAuthToken HipchatApiConstants URI_PATH_USER_MESSAGE user Map String String jsonParam getCommonHttpPostParam exchange LOG info user MAPPER writeValueAsString jsonParam StatusLine statusLine post urlPath jsonParam
Override protected boolean doDecode IoSession session IoBuffer in ProtocolDecoderOutput out throws Exception DecoderState state decoderState session in position state current
Override protected boolean doDecode IoSession session IoBuffer in ProtocolDecoderOutput out throws Exception DecoderState state decoderState session in position state current LOG debug in position in limit boolean messageDecoded false while in hasRemaining int previousPosition in position byte current in get if current config getEndByte2 state previous config getEndByte1 if state isStarted int currentPosition in position int currentLimit in limit
Override protected boolean doDecode IoSession session IoBuffer in ProtocolDecoderOutput out throws Exception DecoderState state decoderState session in position state current LOG debug in position in limit boolean messageDecoded false while in hasRemaining int previousPosition in position byte current in get if current config getEndByte2 state previous config getEndByte1 if state isStarted int currentPosition in position int currentLimit in limit LOG debug previousPosition previousPosition state start in position state start in limit currentPosition
while in hasRemaining int previousPosition in position byte current in get if current config getEndByte2 state previous config getEndByte1 if state isStarted int currentPosition in position int currentLimit in limit LOG debug previousPosition previousPosition state start in position state start in limit currentPosition LOG debug in position in limit try out write config isProduceString parseMessageToString in slice charsetDecoder session parseMessageToByteArray in slice messageDecoded true finally
messageDecoded true finally LOG debug currentPosition currentLimit in position currentPosition in limit currentLimit state reset else LOG warn previousPosition else if current config getStartByte state markStart previousPosition else state markPrevious current messageDecoded false if messageDecoded
private Object parseMessageToByteArray IoBuffer buf throws CharacterCodingException int len buf limit
private Object parseMessageToString IoBuffer buf CharsetDecoder decoder throws CharacterCodingException int len buf limit
Override protected Object decode ChannelHandlerContext ctx ByteBuf buffer throws Exception ByteBuf buf ByteBuf super decode ctx buffer if buf null try int pos buf bytesBefore byte config getStartByte if pos ByteBuf msg buf readerIndex pos slice
protected void doService HttpServletRequest request HttpServletResponse response throws ServletException IOException log trace request HttpConsumer consumer resolve request if consumer null boolean hasAnyMethod METHODS stream anyMatch m getServletResolveConsumerStrategy isHttpMethodAllowed request m getConsumers if hasAnyMethod
HttpHelper setCharsetFromContentType request getContentType exchange exchange setIn new HttpMessage exchange consumer getEndpoint request response String contextPath consumer getEndpoint getPath exchange getIn setHeader contextPath String httpPath String exchange getIn getHeader Exchange HTTP_PATH if contextPath null httpPath startsWith contextPath exchange getIn setHeader Exchange HTTP_PATH httpPath substring contextPath length try consumer createUoW exchange catch Exception e log error e throw new ServletException e try if log isTraceEnabled log trace exchange getExchangeId
exchange getIn setHeader contextPath String httpPath String exchange getIn getHeader Exchange HTTP_PATH if contextPath null httpPath startsWith contextPath exchange getIn setHeader Exchange HTTP_PATH httpPath substring contextPath length try consumer createUoW exchange catch Exception e log error e throw new ServletException e try if log isTraceEnabled log trace exchange getExchangeId consumer getProcessor process exchange catch Exception e exchange setException e
Override public void connect HttpConsumer consumer
Override public void disconnect HttpConsumer consumer
LOG trace name object if object File String fileName request getParameter name boolean accepted true if fileNameExtWhitelist null String ext FileUtil onlyExt fileName if ext null ext ext toLowerCase Locale US fileNameExtWhitelist fileNameExtWhitelist toLowerCase Locale US if fileNameExtWhitelist equals fileNameExtWhitelist contains ext accepted false if accepted AttachmentMessage am message getExchange getMessage AttachmentMessage class am addAttachment fileName new DataHandler new CamelFileDataSource File object fileName else
else throw new RuntimeCamelException HttpConstants CONTENT_TYPE_JAVA_SERIALIZED_OBJECT InputStream is null if checkChunked message exchange is message getBody InputStream class else if isText contentType is exchange getContext getTypeConverter tryConvertTo InputStream class message getBody if is null ServletOutputStream os response getOutputStream if checkChunked message exchange CachedOutputStream stream new CachedOutputStream exchange try int len copyStream is stream response getBufferSize response setContentLength len
if checkChunked message exchange is message getBody InputStream class else if isText contentType is exchange getContext getTypeConverter tryConvertTo InputStream class message getBody if is null ServletOutputStream os response getOutputStream if checkChunked message exchange CachedOutputStream stream new CachedOutputStream exchange try int len copyStream is stream response getBufferSize response setContentLength len OutputStream current stream getCurrentStream if current ByteArrayOutputStream if LOG isDebugEnabled
if is null ServletOutputStream os response getOutputStream if checkChunked message exchange CachedOutputStream stream new CachedOutputStream exchange try int len copyStream is stream response getBufferSize response setContentLength len OutputStream current stream getCurrentStream if current ByteArrayOutputStream if LOG isDebugEnabled LOG debug len ByteArrayOutputStream bos ByteArrayOutputStream current bos writeTo os else if LOG isDebugEnabled
if current ByteArrayOutputStream if LOG isDebugEnabled LOG debug len ByteArrayOutputStream bos ByteArrayOutputStream current bos writeTo os else if LOG isDebugEnabled LOG debug len len copyStream stream getInputStream os len finally IOHelper close is os else if LOG isDebugEnabled LOG debug response getBufferSize copyStream is os response getBufferSize
Override public void register HttpConsumer consumer synchronized lock if LOG isDebugEnabled
Override public void unregister HttpConsumer consumer synchronized lock if LOG isDebugEnabled
Override public void register HttpRegistryProvider provider synchronized lock if LOG isDebugEnabled
Override public void unregister HttpRegistryProvider provider synchronized lock if LOG isDebugEnabled
private HttpClientConfigurer configureHttpProxy Map String Object parameters HttpClientConfigurer configurer boolean secure throws Exception String proxyAuthScheme getParameter parameters String class getProxyAuthScheme if proxyAuthScheme null proxyAuthScheme secure String proxyAuthHost getParameter parameters String class getProxyAuthHost Integer proxyAuthPort getParameter parameters Integer class getProxyAuthPort if proxyAuthHost null proxyAuthHost getParameter parameters String class if proxyAuthPort null proxyAuthPort getParameter parameters Integer class if proxyAuthHost null proxyAuthPort null String proxyAuthUsername getParameter parameters String class getProxyAuthUsername String proxyAuthPassword getParameter parameters String class getProxyAuthPassword String proxyAuthDomain getParameter parameters String class getProxyAuthDomain String proxyAuthNtHost getParameter parameters String class getProxyAuthNtHost
Override public void doStop throws Exception if clientConnectionManager null
String scheme getCamelContext getGlobalOption if scheme null scheme HttpHelper isSecureConnection getEndpointUri LOG debug host port scheme HttpHost proxy new HttpHost host port scheme clientBuilder setProxy proxy else clientBuilder useSystemProperties if isAuthenticationPreemptive clientBuilder addInterceptorFirst new PreemptiveAuthInterceptor HttpClientConfigurer configurer getHttpClientConfigurer if configurer null configurer configureHttpClient clientBuilder if isBridgeEndpoint clientBuilder setDefaultCookieStore new NoopCookieStore
if value null strategy null strategy applyFilterToCamelHeaders key value exchange values add value if values isEmpty String s values size values toString values get httpRequest addHeader key s if getEndpoint getCookieHandler null Map String List String cookieHeaders getEndpoint getCookieHandler loadCookies exchange httpRequest getURI for Map Entry String List String entry cookieHeaders entrySet String key entry getKey if entry getValue isEmpty httpRequest addHeader key entry getValue stream collect Collectors joining if getEndpoint isPreserveHostHeader String hostHeader exchange getIn getHeader String class if hostHeader null httpRequest setHeader hostHeader
URI uri HttpHelper createURI exchange url getEndpoint url uri toASCIIString HttpMethods methodToUse HttpMethodHelper createMethod exchange getEndpoint HttpRequestBase method methodToUse createMethod url if getEndpoint isDeleteWithBody equals method getMethod HttpEntity requestEntity createRequestEntity exchange method new HttpDeleteWithBodyMethod url requestEntity else if getEndpoint isGetWithBody equals method getMethod HttpEntity requestEntity createRequestEntity exchange method new HttpGetWithBodyMethod url requestEntity LOG trace url method if methodToUse isEntityEnclosing HttpEntity requestEntity createRequestEntity exchange HttpEntityEnclosingRequestBase method setEntity requestEntity if requestEntity null requestEntity getContentType null
Override public void handleJsonMetric String json
Override public void handleJsonMetric String json LOG debug json int drain queue size queueSize if drain
throw new UnsupportedOperationException Throwable exception getExecutionException if exception null LOG debug exception getClass getName exception getMessage else LOG debug if exchange getProperty Exchange FAILURE_ENDPOINT null exchange setProperty Exchange FAILURE_ENDPOINT exchange getProperty Exchange TO_ENDPOINT exchange setProperty Exchange EXCEPTION_HANDLED true exchange setProperty Exchange EXCEPTION_CAUGHT exception exchange setRouteStop false exchange setException null exchange adapt ExtendedExchange class setRedeliveryExhausted false try if fallbackCommand null
Throwable exception getExecutionException if exception null LOG debug exception getClass getName exception getMessage else LOG debug if exchange getProperty Exchange FAILURE_ENDPOINT null exchange setProperty Exchange FAILURE_ENDPOINT exchange getProperty Exchange TO_ENDPOINT exchange setProperty Exchange EXCEPTION_HANDLED true exchange setProperty Exchange EXCEPTION_CAUGHT exception exchange setRouteStop false exchange setException null exchange adapt ExtendedExchange class setRedeliveryExhausted false try if fallbackCommand null return fallbackCommand execute
Exchange copy ExchangeHelper createCorrelatedCopy exchange false false try processor process copy catch Exception e copy setException e if getProperties executionTimeoutEnabled get getProperties fallbackEnabled get isCommandTimedOut get TimedOutStatus TIMED_OUT LOG debug exchange return null if fallbackInUse get LOG debug exchange return null Throwable hystrixExecutionException getExecutionException Exception camelExchangeException copy getException synchronized lock if fallbackInUse get
copy setException e if getProperties executionTimeoutEnabled get getProperties fallbackEnabled get isCommandTimedOut get TimedOutStatus TIMED_OUT LOG debug exchange return null if fallbackInUse get LOG debug exchange return null Throwable hystrixExecutionException getExecutionException Exception camelExchangeException copy getException synchronized lock if fallbackInUse get LOG debug exchange return null if hystrixExecutionException null exchange setException new CamelExchangeException exchange hystrixExecutionException
LOG debug exchange return null Throwable hystrixExecutionException getExecutionException Exception camelExchangeException copy getException synchronized lock if fallbackInUse get LOG debug exchange return null if hystrixExecutionException null exchange setException new CamelExchangeException exchange hystrixExecutionException if camelExchangeException HystrixBadRequestException LOG debug processor exchange exchange setException camelExchangeException throw camelExchangeException ExchangeHelper copyResults exchange copy
LOG info route throwException true for int i i REQUEST_VOLUME_THRESHOLD i try template asyncRequestBody catch CamelExecutionException e LOG info e toString Thread sleep resetMocks getMockEndpoint expectedPropertyReceived CircuitBreakerConstants RESPONSE_SHORT_CIRCUITED true route throwException false try template requestBody LOG info catch CamelExecutionException e
Thread sleep resetMocks getMockEndpoint expectedPropertyReceived CircuitBreakerConstants RESPONSE_SHORT_CIRCUITED true route throwException false try template requestBody LOG info catch CamelExecutionException e LOG info e assertMockEndpointsSatisfied Thread sleep for int i i REQUEST_VOLUME_THRESHOLD i try template requestBody LOG info
String routeId String mbeanServer getAttribute on assertEquals routeId String commandKey String mbeanServer getAttribute on assertEquals commandKey String groupKey String mbeanServer getAttribute on assertEquals groupKey Thread sleep Long totalRequests Long mbeanServer getAttribute on assertEquals totalRequests longValue Long errorCount Long mbeanServer getAttribute on assertEquals errorCount longValue Boolean open Boolean mbeanServer getAttribute on assertEquals false open booleanValue Thread sleep String latest stream oldestMetricsAsJSon
assertEquals commandKey String groupKey String mbeanServer getAttribute on assertEquals groupKey Thread sleep Long totalRequests Long mbeanServer getAttribute on assertEquals totalRequests longValue Long errorCount Long mbeanServer getAttribute on assertEquals errorCount longValue Boolean open Boolean mbeanServer getAttribute on assertEquals false open booleanValue Thread sleep String latest stream oldestMetricsAsJSon LOG info latest Stream String jsons stream streamMetrics jsons forEach s
Test public void testSlowLoop throws Exception for int i i i try
Override protected Endpoint createEndpoint final String uri final String remaining final Map String Object parameters throws Exception
private T1 lookupConnection final String fullUri final Map String Object parameters throws Exception
Override public void channelRead final ChannelHandlerContext ctx final Object msg throws Exception if msg AbstractMessage final AbstractMessage amsg AbstractMessage msg final Cause cause amsg getHeader getCauseOfTransmission getCause if this discards contains cause
private void maybeFireExistingQueryResults if endpoint isFireExistingQueryResults
Override protected void doStop throws Exception super doStop events stopLocalListen predicate eventTypes
Override public Consumer createConsumer Processor processor throws Exception IgniteEvents events createIgniteEvents IgniteEventsConsumer consumer new IgniteEventsConsumer this processor events configureConsumer consumer
Override public Producer createProducer throws Exception IgniteAtomicSequence atomicSeq ignite atomicSequence name initialValue false if atomicSeq null atomicSeq ignite atomicSequence name initialValue true
Override protected void doStart throws Exception super doStart messaging localListen endpoint getTopic predicate
Override protected void doStop throws Exception super doStop messaging stopLocalListen endpoint getTopic predicate
Override public synchronized void onInit Route route super onInit route
private void doInsert Exchange exchange String dataBaseName String retentionPolicy throws InvalidPayloadException if endpoint isBatch Point p exchange getIn getMandatoryBody Point class try
Test public void doesNotAddCamelHeaders Map String Object pointInMapFormat new HashMap pointInMapFormat put InfluxDbConstants MEASUREMENT_NAME double value 99.999999d pointInMapFormat put value Point p CamelInfluxDbConverters fromMapToPoint pointInMapFormat assertNotNull p String line p lineProtocol assertNotNull line
Test public void canAddDouble Map String Object pointInMapFormat new HashMap pointInMapFormat put InfluxDbConstants MEASUREMENT_NAME double value 99.999999d pointInMapFormat put value Point p CamelInfluxDbConverters fromMapToPoint pointInMapFormat assertNotNull p String line p lineProtocol assertNotNull line
Test public void canAddInt Map String Object pointInMapFormat new HashMap pointInMapFormat put InfluxDbConstants MEASUREMENT_NAME int value pointInMapFormat put value Point p CamelInfluxDbConverters fromMapToPoint pointInMapFormat assertNotNull p String line p lineProtocol assertNotNull line
Test public void canAddByte Map String Object pointInMapFormat new HashMap pointInMapFormat put InfluxDbConstants MEASUREMENT_NAME byte value Byte MAX_VALUE pointInMapFormat put value Point p CamelInfluxDbConverters fromMapToPoint pointInMapFormat assertNotNull p String line p lineProtocol assertNotNull line
public synchronized IRCConnection getIRCConnection IrcConfiguration configuration final IRCConnection connection if connectionCache containsKey configuration getCacheKey if LOG isDebugEnabled
protected IRCConnection createConnection IrcConfiguration configuration IRCConnection conn null IRCEventListener ircLogger if configuration getUsingSSL if LOG isDebugEnabled
IRCEventListener ircLogger if configuration getUsingSSL if LOG isDebugEnabled LOG debug configuration getHostname configuration getSpaceSeparatedChannelNames configuration getNickname configuration getUsername SSLContextParameters sslParams configuration getSslContextParameters if sslParams null sslParams retrieveGlobalSslContextParameters if sslParams null conn new CamelSSLIRCConnection configuration getHostname configuration getPorts configuration getPassword configuration getNickname configuration getUsername configuration getRealname sslParams getCamelContext else SSLIRCConnection sconn new SSLIRCConnection configuration getHostname configuration getPorts configuration getPassword configuration getNickname configuration getUsername configuration getRealname sconn addTrustManager configuration getTrustManager conn sconn else if LOG isDebugEnabled
Override protected void doStop throws Exception if connection null for IrcChannel channel endpoint getConfiguration getChannelList
private void handleNickInUse IRCConnection connection component getIRCConnection configuration String nick connection getNick if nick endsWith
Override public void onError int num String msg
Override public void onError String msg
Override public void onInvite String chan IRCUser user String passiveNick
Override public void onJoin String chan IRCUser user
Override public void onKick String chan IRCUser user String passiveNick String msg
Override public void onMode String chan IRCUser user IRCModeParser ircModeParser
Override public void onMode IRCUser user String passiveNick String mode
Override public void onNick IRCUser user String newNick
Override public void onNotice String target IRCUser user String msg
Override public void onPart String chan IRCUser user String msg
Override public void onPing String ping
Override public void onPrivmsg String target IRCUser user String msg
Override public void onQuit IRCUser user String msg
Override public void onReply int num String value String msg
Override public void onTopic String chan IRCUser user String topic
Override public void unknown String prefix String command String middle String trailing
final String msg exchange getIn getBody String class final String sendTo exchange getIn getHeader IrcConstants IRC_SEND_TO String class if connection null connection isConnected reconnect if connection null connection isConnected throw new RuntimeCamelException connection getHost if msg null if isMessageACommand msg LOG debug msg connection send msg else if sendTo null LOG debug sendTo msg connection doPrivmsg sendTo msg else for IrcChannel channel getEndpoint getConfiguration getChannelList
Override protected void doStop throws Exception if connection null for IrcChannel channel getEndpoint getConfiguration getChannelList
Test public void testIrcMessages throws Exception resetMock joined joined expectedMessageCount joined expectedHeaderValuesReceivedInAnyOrder IrcConstants IRC_TARGET properties get properties get joined assertIsSatisfied sendMessages resultEndpoint expectedBodiesReceivedInAnyOrder body1 body2 body3 body3 resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges for Exchange exchange list
Test public void testIrcMessages throws Exception resultEndpoint expectedBodiesReceived resultEnd resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges for Exchange exchange list
Test public void testIrcPrivateMessages throws Exception resultEndpoint expectedBodiesReceived expectedBody1 expectedBody2 resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges for Exchange exchange list
Test public void testIrcMessages throws Exception resultEndpoint expectedBodiesReceivedInAnyOrder body1 body2 resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges for Exchange exchange list
Test public void test throws Exception resultEndpoint expectedMessageCount resultEndpoint assertIsSatisfied String body resultEndpoint getExchanges get getIn getBody String class
for int i i NO_OF_MESSAGES i String payloadToSend PAYLOAD replace i list add payloadToSend if i noOfBlocks System out println noOfBlocks template sendBody sedaEndpoint list toArray new String list clear MockEndpoint mockEndpoint getMockEndpoint while mockEndpoint getReceivedCounter noOfBlocks LOGGER info mockEndpoint getReceivedCounter Thread sleep long delta System currentTimeMillis start int seconds int delta int msgPrSec NO_OF_MESSAGES seconds
Test public void testConcurrentConsumers throws Exception long start System currentTimeMillis context getRouteController startRoute MockEndpoint endpoint getMockEndpoint endpoint expectedMessageCount NO_OF_MESSAGES assertMockEndpointsSatisfied TimeUnit MINUTES long delta System currentTimeMillis start int seconds int delta int msgPrSec NO_OF_MESSAGES seconds
Override protected void doStart throws Exception boolean objectMapperFoundRegistry false if objectMapper null if useDefaultObjectMapper camelContext null if isAutoDiscoverObjectMapper Set ObjectMapper set camelContext getRegistry findByType ObjectMapper class if set size objectMapper set iterator next
boolean objectMapperFoundRegistry false if objectMapper null if useDefaultObjectMapper camelContext null if isAutoDiscoverObjectMapper Set ObjectMapper set camelContext getRegistry findByType ObjectMapper class if set size objectMapper set iterator next LOG info objectMapper objectMapperFoundRegistry true else if set size LOG debug set size else LOG info if objectMapper null objectMapper new ObjectMapper
objectMapper disable sf continue DeserializationFeature df getCamelContext getTypeConverter tryConvertTo DeserializationFeature class disable if df null objectMapper disable df continue MapperFeature mf getCamelContext getTypeConverter tryConvertTo MapperFeature class disable if mf null objectMapper disable mf continue throw new IllegalArgumentException disable if modules null for Module module modules LOG debug module objectMapper registerModules module
xmlMapper disable df continue MapperFeature mf getCamelContext getTypeConverter tryConvertTo MapperFeature class disable if mf null xmlMapper disable mf continue throw new IllegalArgumentException disable if modules null for Module module modules LOG info module xmlMapper registerModules module if moduleClassNames null Iterable it ObjectHelper createIterable moduleClassNames for Object o it String name o toString
private synchronized void initEncryptor if encryptor null StringHelper notEmpty password StandardPBEStringEncryptor pbeStringEncryptor new StandardPBEStringEncryptor pbeStringEncryptor setPassword password if algorithm null pbeStringEncryptor setAlgorithm algorithm
JAXBContext context createContext value getClass Marshaller marshaller context createMarshaller Writer buffer new StringWriter if prettyPrint marshaller setProperty Marshaller JAXB_FORMATTED_OUTPUT Boolean TRUE String charset exchange null exchange getProperty Exchange CHARSET_NAME String class null if charset null marshaller setProperty Marshaller JAXB_ENCODING charset Object toMarshall value if objectFactoryMethod null try Object instance objectFactoryMethod getDeclaringClass newInstance if instance null toMarshall objectFactoryMethod invoke instance value catch Exception e
if charset null marshaller setProperty Marshaller JAXB_ENCODING charset if isFragment marshaller setProperty Marshaller JAXB_FRAGMENT Boolean TRUE if ObjectHelper isNotEmpty schemaLocation marshaller setProperty Marshaller JAXB_SCHEMA_LOCATION schemaLocation if ObjectHelper isNotEmpty noNamespaceSchemaLocation marshaller setProperty Marshaller JAXB_NO_NAMESPACE_SCHEMA_LOCATION noNamespaceSchemaLocation if namespacePrefixMapper null marshaller setProperty namespacePrefixMapper getRegistrationKey namespacePrefixMapper Map String Object customProperties exchange getProperty JaxbConstants JAXB_PROVIDER_PROPERTIES Map class if customProperties null customProperties getJaxbProviderProperties if customProperties null for Entry String Object property customProperties entrySet
marshaller marshal element stream return else if objectFactory element null Method objectFactoryMethod JaxbHelper getJaxbElementFactoryMethod camelContext element getClass if objectFactoryMethod null try Object instance objectFactoryMethod getDeclaringClass newInstance if instance null Object toMarshall objectFactoryMethod invoke instance element if asXmlStreamWriter exchange XMLStreamWriter writer typeConverter convertTo XMLStreamWriter class exchange stream if needFiltering exchange writer new FilteringXmlStreamWriter writer charset if xmlStreamWriterWrapper null writer xmlStreamWriterWrapper wrapWriter writer
protected JAXBContext createContext throws Exception if contextPath null ClassLoader cl camelContext getApplicationContextClassLoader if cl null if contextPathIsClassName
ClassLoader cl camelContext getApplicationContextClassLoader if cl null if contextPathIsClassName LOG debug contextPath cl Class clazz camelContext getClassResolver resolveMandatoryClass contextPath cl return JAXBContext newInstance clazz else LOG debug contextPath cl return JAXBContext newInstance contextPath cl else if contextPathIsClassName LOG debug contextPath Class clazz camelContext getClassResolver resolveMandatoryClass contextPath return JAXBContext newInstance clazz else
Test public void concurrentMarshallSuccess throws Exception mockMarshall expectedMessageCount testCount Address address new Address address setAddressLine1 Person person new Person person setFirstName person setLastName person setAge Integer valueOf person setAddress address long start System currentTimeMillis for int i i testCount i template sendBody person assertMockEndpointsSatisfied LOG info testCount System currentTimeMillis start String payload mockMarshall getExchanges get getIn getBody String class
Test public void testMarshallMultipleNamespaces throws Exception mockMarshall expectedMessageCount Order order new Order order setId Address address new Address address setStreet address setStreetNumber address setZip address setCity order setAddress address template sendBody order assertMockEndpointsSatisfied String payload mockMarshall getExchanges get getIn getBody String class
Test public void testMarshallIfPartClassSetInHeaders throws Exception mockMarshall expectedMessageCount Address address new Address address setStreet address setStreetNumber address setZip address setCity template sendBody address assertMockEndpointsSatisfied String payload mockMarshall getExchanges get getIn getBody String class
Test public void testMarshallMultipleNamespaces throws Exception mockMarshall expectedMessageCount Address address new Address address setStreet address setStreetNumber address setZip address setCity template sendBody address assertMockEndpointsSatisfied String payload mockMarshall getExchanges get getIn getBody String class
Test public void testMarshallSuccess throws Exception mockMarshall expectedMessageCount Address address new Address address setAddressLine1 Person person new Person person setFirstName person setLastName person setAge Integer valueOf person setAddress address template sendBody person assertMockEndpointsSatisfied String payload mockMarshall getExchanges get getIn getBody String class
Test public void testMarshallSuccess throws Exception mockMarshall expectedMessageCount Address address new Address address setAddressLine1 Person person new Person person setFirstName person setLastName person setAge Integer valueOf person setAddress address template sendBody person assertMockEndpointsSatisfied String payload mockMarshall getExchanges get getIn getBody String class
public void unmarshal final CountDownLatch latch throws Exception ByteArrayInputStream warmUpPayloads createPayloads warmupCount for ByteArrayInputStream payload warmUpPayloads template sendBody payload final ByteArrayInputStream payloads createPayloads testCycleCount ExecutorService pool Executors newFixedThreadPool long start System currentTimeMillis for int i i payloads length i final int finalI i pool execute new Runnable public void run template sendBody payloads finalI latch await long end System currentTimeMillis
public void marshal final CountDownLatch latch throws Exception Foo warmUpPayloads createFoo warmupCount for Foo payload warmUpPayloads template sendBody payload final Foo payloads createFoo testCycleCount ExecutorService pool Executors newFixedThreadPool long start System currentTimeMillis for int i i payloads length i final int finalI i pool execute new Runnable public void run template sendBody payloads finalI latch await long end System currentTimeMillis
Test public void testNamespacePrefix throws Exception MockEndpoint mock getMockEndpoint mock expectedMessageCount Order order new Order order setId Address address new Address address setStreet address setStreetNumber address setZip address setCity order setAddress address template sendBody order assertMockEndpointsSatisfied String xml mock getExchanges get getIn getBody String class
Override protected void doStart throws Exception super doStart DeploymentService deploymentService DeploymentService ServiceRegistry get service ServiceRegistry DEPLOYMENT_SERVICE if configuration getDeploymentId null InternalRuntimeManager manager InternalRuntimeManager deploymentService getRuntimeManager configuration getDeploymentId configure manager this
Override protected void doStop throws Exception super doStop DeploymentService deploymentService DeploymentService ServiceRegistry get service ServiceRegistry DEPLOYMENT_SERVICE if configuration getDeploymentId null
protected void configureConsumer String eventListenerType InternalRuntimeManager manager JBPMConsumer consumer
else if JBPMConstants JBPM_TASK_EVENT_LISTENER equals eventListenerType consumerAware JBPMCamelConsumerAware cacheManager get if consumerAware null consumerAware new CamelTaskEventListener cacheManager add consumerAware LOGGER debug consumerAware else if JBPMConstants JBPM_CASE_EVENT_LISTENER equals eventListenerType consumerAware JBPMCamelConsumerAware cacheManager get if consumerAware null consumerAware new CamelCaseEventListener cacheManager add consumerAware LOGGER debug consumerAware else if JBPMConstants JBPM_EVENT_EMITTER equals eventListenerType LOGGER debug ServiceRegistry get register new CamelEventEmitter this configuration getEmitterSendItems
initialized true Object isHandleExceptionParamValue workItem getParameter JBPMConstants HANDLE_EXCEPTION_WI_PARAM boolean isHandleException if isHandleExceptionParamValue null isHandleException true else if isHandleExceptionParamValue String isHandleException Boolean parseBoolean String isHandleExceptionParamValue else if isHandleExceptionParamValue Boolean isHandleException Boolean isHandleExceptionParamValue booleanValue else throw new IllegalArgumentException isHandleExceptionParamValue getClass getCanonicalName JBPMConstants HANDLE_EXCEPTION_WI_PARAM String workItemCamelEndpointId getCamelEndpointId workItem String camelUri workItemCamelEndpointId try Exchange requestExchange buildExchange producerTemplate workItem
protected String getCamelEndpointId WorkItem workItem String workItemCamelEndpointId String workItem getParameter JBPMConstants CAMEL_ENDPOINT_ID_WI_PARAM if camelEndpointId null camelEndpointId isEmpty if workItemCamelEndpointId null workItemCamelEndpointId isEmpty
return new MutableCacheEntryListenerConfiguration new Factory CacheEntryListener Object Object Override public CacheEntryListener Object Object create return new JCacheEntryEventListener Override protected void onEvents Iterable CacheEntryEvent events for CacheEntryEvent event events Exchange exchange getEndpoint createExchange Message message exchange getIn message setHeader JCacheConstants EVENT_TYPE event getEventType name message setHeader JCacheConstants KEY event getKey message setBody event getValue if event isOldValueAvailable message setHeader JCacheConstants OLD_VALUE event getOldValue try getProcessor process exchange catch Exception e
Override public Processor wrap Route route Processor processor if isEnabled return processor Cache cache this cache if cache null CacheManager cacheManager this cacheManager if cacheManager null Set CacheManager lookupResult route getCamelContext getRegistry findByType CacheManager class if ObjectHelper isNotEmpty lookupResult cacheManager lookupResult iterator next LOG debug cacheManager if cacheManager null cacheManager Caching getCachingProvider getCacheManager LOG debug cacheManager String cacheName ObjectHelper isNotEmpty this cacheName this cacheName route getRouteId
Cache cache this cache if cache null CacheManager cacheManager this cacheManager if cacheManager null Set CacheManager lookupResult route getCamelContext getRegistry findByType CacheManager class if ObjectHelper isNotEmpty lookupResult cacheManager lookupResult iterator next LOG debug cacheManager if cacheManager null cacheManager Caching getCachingProvider getCacheManager LOG debug cacheManager String cacheName ObjectHelper isNotEmpty this cacheName this cacheName route getRouteId LOG debug cacheName cache cacheManager getCache cacheName if cache null
Override public boolean process final Exchange exchange final AsyncCallback callback
Object key keyExpression null keyExpression evaluate exchange Object class exchange getMessage getBody if key null return super process exchange callback Object value cache get key if value null LOG debug key exchange getExchangeId exchange getMessage setBody value callback done true return true LOG debug key exchange getExchangeId return super process exchange new AsyncCallback Override public void done boolean doneSync try if exchange isFailed Object value exchange getMessage getBody
Object value cache get key if value null LOG debug key exchange getExchangeId exchange getMessage setBody value callback done true return true LOG debug key exchange getExchangeId return super process exchange new AsyncCallback Override public void done boolean doneSync try if exchange isFailed Object value exchange getMessage getBody if value null LOG debug key value exchange getExchangeId cache put key value
Override public Exchange add CamelContext camelContext String key Exchange oldExchange Exchange newExchange throws OptimisticLockingException if optimistic throw new UnsupportedOperationException LOG trace newExchange getExchangeId key if oldExchange null DefaultExchangeHolder newHolder DefaultExchangeHolder marshal newExchange true allowSerializedHeaders DefaultExchangeHolder oldHolder cache getAndPut key newHolder if oldHolder null Exchange exchange unmarshallExchange camelContext oldHolder LOG error key exchange null exchange getExchangeId throw new OptimisticLockingException else DefaultExchangeHolder oldHolder DefaultExchangeHolder marshal oldExchange true allowSerializedHeaders DefaultExchangeHolder newHolder DefaultExchangeHolder marshal newExchange true allowSerializedHeaders if cache replace key oldHolder newHolder
Override public void remove CamelContext camelContext String key Exchange exchange DefaultExchangeHolder holder DefaultExchangeHolder marshal exchange true allowSerializedHeaders if optimistic LOG trace exchange getExchangeId key if cache remove key holder
Override public void onEvent EventIterator events LOG trace
Override public void onEvent EventIterator events LOG trace LOG debug endpoint events RuntimeCamelException rce null try final Exchange exchange createExchange events try
else if absPath startsWith absPath absPath boolean isDeep getJcrEndpoint isDeep String uuid null String uuids getJcrEndpoint getUuids if uuids null uuids uuids trim if equals uuids uuid uuids split String nodeTypeName null String nodeTypeNames getJcrEndpoint getNodeTypeNames if nodeTypeNames null nodeTypeNames nodeTypeNames trim if equals nodeTypeNames nodeTypeName nodeTypeNames split
Override protected void doService final HttpServletRequest request final HttpServletResponse response throws ServletException IOException log trace request HttpConsumer consumer getServletResolveConsumerStrategy resolve request getConsumers if consumer null boolean hasAnyMethod METHODS stream anyMatch m getServletResolveConsumerStrategy isHttpMethodAllowed request m getConsumers if hasAnyMethod
HttpHelper setCharsetFromContentType request getContentType exchange exchange setIn new HttpMessage exchange consumer getEndpoint request response String contextPath consumer getEndpoint getPath exchange getIn setHeader contextPath updateHttpPath exchange contextPath if log isTraceEnabled log trace exchange getExchangeId continuation setAttribute EXCHANGE_ATTRIBUTE_ID exchange getExchangeId try consumer createUoW exchange catch Exception e log error e throw new ServletException e continuation suspend ClassLoader oldTccl overrideTccl exchange
exchange getIn setHeader contextPath updateHttpPath exchange contextPath if log isTraceEnabled log trace exchange getExchangeId continuation setAttribute EXCHANGE_ATTRIBUTE_ID exchange getExchangeId try consumer createUoW exchange catch Exception e log error e throw new ServletException e continuation suspend ClassLoader oldTccl overrideTccl exchange if log isTraceEnabled log trace exchange getExchangeId consumer getAsyncProcessor process exchange new AsyncCallback
String connectorKey getConnectorKey endpoint synchronized CONNECTORS ConnectorRef connectorRef CONNECTORS get connectorKey if connectorRef null Server server createServer Connector connector getConnector server endpoint if equalsIgnoreCase endpoint getHttpUri getHost LOG warn endpoint if endpoint isEnableJmx enableJmx server server addConnector connector connectorRef new ConnectorRef getCamelContext server connector createServletForConnector server connector endpoint getHandlers endpoint if endpoint isSessionSupport enableSessionSupport connectorRef server connectorKey connectorRef server start
if connectorRef null Server server createServer Connector connector getConnector server endpoint if equalsIgnoreCase endpoint getHttpUri getHost LOG warn endpoint if endpoint isEnableJmx enableJmx server server addConnector connector connectorRef new ConnectorRef getCamelContext server connector createServletForConnector server connector endpoint getHandlers endpoint if endpoint isSessionSupport enableSessionSupport connectorRef server connectorKey connectorRef server start LOG debug connectorKey connectorRef CONNECTORS put connectorKey connectorRef else
server addConnector connector connectorRef new ConnectorRef getCamelContext server connector createServletForConnector server connector endpoint getHandlers endpoint if endpoint isSessionSupport enableSessionSupport connectorRef server connectorKey connectorRef server start LOG debug connectorKey connectorRef CONNECTORS put connectorKey connectorRef else LOG debug connectorKey connectorRef if endpoint getHandlers null endpoint getHandlers isEmpty List Handler existingHandlers new ArrayList if connectorRef server getHandlers null connectorRef server getHandlers length existingHandlers Arrays asList connectorRef server getHandlers List Handler newHandlers new ArrayList endpoint getHandlers boolean changed existingHandlers containsAll newHandlers newHandlers containsAll existingHandlers
if ObjectHelper isNotEmpty camelContext getGlobalOption TMP_DIR File file new File camelContext getGlobalOption TMP_DIR if file isDirectory throw new RuntimeCamelException camelContext getGlobalOptions get TMP_DIR context setAttribute file Filter filter JettyHttpEndpoint endpoint getMultipartFilter if filter null filter new MultiPartFilter filterHolder setFilter new CamelFilterWrapper filter String pathSpec endpoint getPath if pathSpec null equals pathSpec pathSpec if endpoint isMatchOnUriPrefix pathSpec pathSpec endsWith pathSpec pathSpec addFilter context filterHolder pathSpec
ServletContextHandler context new ServletContextHandler server ServletContextHandler NO_SECURITY ServletContextHandler NO_SESSIONS addJettyHandlers server handlers CamelServlet camelServlet new CamelContinuationServlet ServletHolder holder new ServletHolder holder setServlet camelServlet holder setAsyncSupported true holder setInitParameter CamelServlet ASYNC_PARAM Boolean toString endpoint isAsync context addServlet holder File file File createTempFile file delete holder getRegistration setMultipartConfig new MultipartConfigElement file getParentFile getAbsolutePath camelServlet setServletResolveConsumerStrategy new HttpRestServletResolveConsumerStrategy try connector getConnectionFactory HttpConnectionFactory class getHttpConfiguration setMultiPartFormDataCompliance MultiPartFormDataCompliance RFC7578 catch Throwable e
ArrayList ConnectionFactory connectionFactories new ArrayList ServerConnector result new org eclipse jetty server ServerConnector server if sslcf null httpConfig addCustomizer new org eclipse jetty server SecureRequestCustomizer SslConnectionFactory scf new org eclipse jetty server SslConnectionFactory sslcf connectionFactories add scf result setDefaultProtocol scf getProtocol connectionFactories add httpFactory for ConnectionFactory cf connectionFactories result addConnectionFactory cf result setPort port if host null result setHost host if sslcf null if getSslSocketConnectorProperties null equals endpoint getProtocol
private void testHttpClient String uri throws Exception System setProperty MockEndpoint mockEndpoint getMockEndpoint mockEndpoint expectedBodiesReceived template requestBodyAndHeader uri new ByteArrayInputStream getBytes mockEndpoint assertIsSatisfied List Exchange list mockEndpoint getReceivedExchanges Exchange exchange list get assertNotNull exchange Message in exchange getIn assertNotNull in Map String Object headers in getHeaders
private void testHttpClient String uri throws Exception System setProperty MockEndpoint mockEndpoint getMockEndpoint mockEndpoint expectedBodiesReceived template requestBodyAndHeader uri new ByteArrayInputStream getBytes mockEndpoint assertIsSatisfied List Exchange list mockEndpoint getReceivedExchanges Exchange exchange list get assertNotNull exchange Message in exchange getIn assertNotNull in Map String Object headers in getHeaders
Test public void testEndpoint throws Exception MockEndpoint mockEndpoint getMockEndpoint mockEndpoint expectedBodiesReceived expectedBody invokeHttpEndpoint mockEndpoint assertIsSatisfied List Exchange list mockEndpoint getReceivedExchanges Exchange exchange list get assertNotNull exchange Message in exchange getIn assertNotNull in Map String Object headers in getHeaders
if isPlatform return MockEndpoint mockEndpointA resolveMandatoryEndpoint MockEndpoint class mockEndpointA expectedBodiesReceived expectedBody MockEndpoint mockEndpointB resolveMandatoryEndpoint MockEndpoint class mockEndpointB expectedBodiesReceived expectedBody invokeHttpEndpoint mockEndpointA assertIsSatisfied mockEndpointB assertIsSatisfied List Exchange list mockEndpointA getReceivedExchanges Exchange exchange list get assertNotNull exchange Message in exchange getIn assertNotNull in Map String Object headers in getHeaders
if isPlatform return MockEndpoint mockEndpointA resolveMandatoryEndpoint MockEndpoint class mockEndpointA expectedBodiesReceived expectedBody MockEndpoint mockEndpointB resolveMandatoryEndpoint MockEndpoint class mockEndpointB expectedBodiesReceived expectedBody invokeHttpEndpoint mockEndpointA assertIsSatisfied mockEndpointB assertIsSatisfied List Exchange list mockEndpointA getReceivedExchanges Exchange exchange list get assertNotNull exchange Message in exchange getIn assertNotNull in Map String Object headers in getHeaders
Test public void testCustomerErrorHandler throws Exception String response template requestBody null String class
Test public void threadPoolTest long initialJettyThreadNumber countJettyThread
Test public void threadPoolTest long initialJettyThreadNumber countJettyThread LOG info initialJettyThreadNumber assertEquals initialJettyThreadNumber context stop long jettyThreadNumberAfterStop countJettyThread
Test public void testEndpoint throws Exception mockEndpoint reset mockEndpoint expectedBodiesReceived expectedBody template sendBodyAndHeader port expectedBody mockEndpoint assertIsSatisfied List Exchange list mockEndpoint getReceivedExchanges Exchange exchange list get assertNotNull exchange Message in exchange getIn assertNotNull in Map String Object headers in getHeaders
Test public void testJettyAsync throws Exception getMockEndpoint expectedMinimumMessageCount template asyncRequestBody null template asyncRequestBody null template asyncRequestBody null template asyncRequestBody null template asyncRequestBody null assertMockEndpointsSatisfied int size getMockEndpoint getReceivedExchanges size for int i i size i Exchange exchange getMockEndpoint getReceivedExchanges get i
Override public boolean process final Exchange exchange final AsyncCallback callback executor submit new Callable Object public Object call throws Exception LOG info getEndpoint getDelay Thread sleep getEndpoint getDelay int count counter incrementAndGet if getEndpoint getFailFirstAttempts count
private void processExchange Role role Exchange exchange try
Override public void process Exchange exchange throws Exception byte body exchange getIn getBody byte class Integer setOffset exchange getIn getHeader JGroupsRaftConstants HEADER_JGROUPSRAFT_SET_OFFSET Integer class Integer setLength exchange getIn getHeader JGroupsRaftConstants HEADER_JGROUPSRAFT_SET_LENGTH Integer class Long setTimeout exchange getIn getHeader JGroupsRaftConstants HEADER_JGROUPSRAFT_SET_TIMEOUT Long class TimeUnit setTimeUnit exchange getIn getHeader JGroupsRaftConstants HEADER_JGROUPSRAFT_SET_TIMEUNIT TimeUnit class if body null byte result if setOffset null setLength null setTimeout null setTimeUnit null
Override public void process Exchange exchange throws Exception byte body exchange getIn getBody byte class Integer setOffset exchange getIn getHeader JGroupsRaftConstants HEADER_JGROUPSRAFT_SET_OFFSET Integer class Integer setLength exchange getIn getHeader JGroupsRaftConstants HEADER_JGROUPSRAFT_SET_LENGTH Integer class Long setTimeout exchange getIn getHeader JGroupsRaftConstants HEADER_JGROUPSRAFT_SET_TIMEOUT Long class TimeUnit setTimeUnit exchange getIn getHeader JGroupsRaftConstants HEADER_JGROUPSRAFT_SET_TIMEUNIT TimeUnit class if body null byte result if setOffset null setLength null setTimeout null setTimeUnit null LOG debug body setOffset setLength setTimeout setTimeUnit result raftHandle set body setOffset setLength setTimeout setTimeUnit else if setOffset null setLength null LOG debug body setOffset setLength result raftHandle set body setOffset setLength else
Override public void roleChanged Role role
Override protected void doStop throws Exception isMaster false fireLeadershipChangedEvent Optional empty LOG info raftId raftHandle channel disconnect if raftHandle null raftHandle log null raftHandle log close
Override public void viewAccepted View view if endpoint isEnableViewMessages Exchange exchange endpoint createExchange view try
Override public void receive Message message Exchange exchange endpoint createExchange message try
public static Predicate dropNonCoordinatorViews return new Predicate Override public boolean matches Exchange exchange Object body exchange getIn getBody
public static Predicate dropNonCoordinatorViews return new Predicate Override public boolean matches Exchange exchange Object body exchange getIn getBody LOG debug body if body View View view View body Address coordinatorNodeAddress view getMembers get COORDINATOR_NODE_INDEX Address channelAddress exchange getIn getHeader HEADER_JGROUPS_CHANNEL_ADDRESS Address class
Override public void process Exchange exchange throws Exception Object body exchange getIn getBody if body null Address destinationAddress exchange getIn getHeader JGroupsEndpoint HEADER_JGROUPS_DEST Address class Address sourceAddress exchange getIn getHeader JGroupsEndpoint HEADER_JGROUPS_SRC Address class
Override public void process Exchange exchange throws Exception Object body exchange getIn getBody if body null Address destinationAddress exchange getIn getHeader JGroupsEndpoint HEADER_JGROUPS_DEST Address class Address sourceAddress exchange getIn getHeader JGroupsEndpoint HEADER_JGROUPS_SRC Address class LOG debug body clusterName if destinationAddress null
lock unlock lock null if channel null channel new JChannel jgroupsConfig lockService new LockService channel channel connect jgroupsClusterName lock lockService getLock lockName final CamelContext context ObjectHelper notNull getCamelContext executor context getExecutorServiceManager newSingleThreadScheduledExecutor this getClusterService getId lockName executor execute new Runnable Override public void run LOG info lockName jgroupsClusterName jgroupsConfig lock lock isMaster true fireLeadershipChangedEvent Optional ofNullable localMember
int events ThreadLocalRandom current nextInt CountDownLatch contextLatch new CountDownLatch events JGroupsLockClusterService service new JGroupsLockClusterService service setId id DefaultCamelContext context new DefaultCamelContext context disableJMX context setName id context addService service context addRoutes new RouteBuilder Override public void configure throws Exception from routeId id log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt context start contextLatch await
private void processExchange Object body String issueKey String changed throws Exception Exchange e getEndpoint createExchange e getIn setBody body e getIn setHeader issueKey e getIn setHeader changed e getIn setHeader watchedIssuesKeys
Override public void onMessage Message message Session session throws JMSException LOG trace
Override public void onMessage Message message Session session throws JMSException LOG trace LOG debug endpoint message boolean sendReply RuntimeCamelException rce try Object replyDestination getReplyToDestination message sendReply replyDestination null disableReplyTo Destination destination JmsMessageHelper getJMSDestination message if destination null sendReply endpoint isReplyToSameDestinationAllowed destination equals replyDestination
if ObjectHelper isNotEmpty eagerPoisonBody eagerLoadingOfProperties try exchange getIn getBody exchange getIn getHeaders catch Throwable e exchange setException e String text eagerPoisonBody try text endpoint getCamelContext resolveLanguage createExpression eagerPoisonBody evaluate exchange String class catch Throwable t exchange getIn setBody text else if eagerLoadingOfProperties exchange getIn getBody exchange getIn getHeaders String correlationId message getJMSCorrelationID
protected void sendReply Destination replyDestination final Message message final Exchange exchange final org apache camel Message out final Exception cause if replyDestination null
protected void sendReply String replyDestination final Message message final Exchange exchange final org apache camel Message out final Exception cause if replyDestination null
if force JmsMessageType type endpoint null endpoint getConfiguration getJmsMessageType null if type null answer null if type JmsMessageType Text answer answer TextMessage answer null else if type JmsMessageType Bytes answer answer BytesMessage answer null else if type JmsMessageType Map answer answer MapMessage answer null else if type JmsMessageType Object answer answer ObjectMessage answer null else if type Stream answer answer StreamMessage answer null if answer null if cause null
else if headerName equals jmsMessage setJMSType ExchangeHelper convertToType exchange String class headerValue else if headerName equals jmsMessage setJMSPriority ExchangeHelper convertToType exchange Integer class headerValue else if headerName equals JmsMessageHelper setJMSDeliveryMode exchange jmsMessage headerValue else if headerName equals jmsMessage setJMSExpiration ExchangeHelper convertToType exchange Long class headerValue else LOG trace headerName headerValue else if shouldOutputHeader in headerName headerValue exchange Object value getValidJMSHeaderValue headerName headerValue if value null endpoint null endpoint getConfiguration getAllowAdditionalHeaders null Iterator it ObjectHelper createIterator endpoint getConfiguration getAllowAdditionalHeaders while it hasNext
public void startListenerContainer LOG trace listenerContainer getDestinationName listenerContainer start
public void configureListenerContainer AbstractMessageListenerContainer listenerContainer JmsConsumer consumer if destinationName null listenerContainer setDestinationName destinationName
LOG debug destinationName listenerContainer else if destination null listenerContainer setDestination destination LOG debug destinationName listenerContainer else DestinationResolver resolver getDestinationResolver if resolver null listenerContainer setDestinationResolver resolver else throw new IllegalArgumentException LOG debug resolver listenerContainer listenerContainer setPubSubDomain pubSubDomain String consumerName getThreadName if configuration getTaskExecutor null if LOG isDebugEnabled
listenerContainer setDestinationResolver resolver else throw new IllegalArgumentException LOG debug resolver listenerContainer listenerContainer setPubSubDomain pubSubDomain String consumerName getThreadName if configuration getTaskExecutor null if LOG isDebugEnabled LOG debug configuration getTaskExecutor listenerContainer setContainerTaskExecutor listenerContainer configuration getTaskExecutor if configuration getTaskExecutor ExecutorService consumer setListenerContainerExecutorService ExecutorService configuration getTaskExecutor false else if listenerContainer DefaultJmsMessageListenerContainer configuration getDefaultTaskExecutorType null ExecutorService executor getCamelContext getExecutorServiceManager newCachedThreadPool consumer consumerName setContainerTaskExecutor listenerContainer executor
if started get synchronized this if started get return ClassLoader oldClassLoader Thread currentThread getContextClassLoader ClassLoader ac endpoint getCamelContext getApplicationContextClassLoader try if ac null Thread currentThread setContextClassLoader ac if endpoint getReplyToType null if endpoint getReplyTo null endpoint getReplyToType equals ReplyToType Temporary name throw new IllegalArgumentException ReplyToType Temporary endpoint getReplyTo if endpoint getReplyTo null replyManager createReplyManager endpoint getReplyTo if LOG isDebugEnabled
return ClassLoader oldClassLoader Thread currentThread getContextClassLoader ClassLoader ac endpoint getCamelContext getApplicationContextClassLoader try if ac null Thread currentThread setContextClassLoader ac if endpoint getReplyToType null if endpoint getReplyTo null endpoint getReplyToType equals ReplyToType Temporary name throw new IllegalArgumentException ReplyToType Temporary endpoint getReplyTo if endpoint getReplyTo null replyManager createReplyManager endpoint getReplyTo if LOG isDebugEnabled LOG debug replyManager endpoint getReplyTo else replyManager createReplyManager
protected void unInitReplyManager try if replyManager null if LOG isDebugEnabled
JmsMessageHelper setJMSReplyTo answer null else if jmsReplyTo null jmsReplyTo exchange getIn getHeader String class if jmsReplyTo null jmsReplyTo endpoint getReplyTo if jmsReplyTo null endpoint isPreserveMessageQos endpoint isExplicitQosEnabled if LOG isDebugEnabled LOG debug new Object jmsReplyTo to endpoint jmsReplyTo null if jmsReplyTo String String replyTo String jmsReplyTo jmsReplyTo resolveOrCreateDestination replyTo session Destination replyTo null String replyToOverride endpoint getConfiguration getReplyToOverride
protected Destination resolveOrCreateDestination String destinationName Session session throws JMSException Destination dest null boolean isPubSub isTopicPrefix destinationName isQueuePrefix destinationName endpoint isPubSubDomain if endpoint getDestinationResolver null dest endpoint getDestinationResolver resolveDestinationName session destinationName isPubSub if LOG isDebugEnabled LOG debug new Object destinationName endpoint getDestinationResolver isPubSub dest if dest null String before destinationName destinationName normalizeDestinationName destinationName LOG trace before destinationName if isPubSub LOG debug destinationName dest session createTopic destinationName else
protected void testConnectionOnStartup throws FailedToCreateProducerException try CamelJmsTemplate template CamelJmsTemplate getInOnlyTemplate if LOG isDebugEnabled
ReplyToType type endpoint getConfiguration getReplyToType if type null type ReplyToType Shared if ReplyToType Shared type String replyToSelectorName endpoint getReplyToDestinationSelectorName if replyToSelectorName null replyToSelectorValue new BigInteger new Random toString String fixedMessageSelector replyToSelectorName replyToSelectorValue answer new SharedQueueMessageListenerContainer endpoint fixedMessageSelector answer setCacheLevel DefaultMessageListenerContainer CACHE_CONSUMER log debug endpoint getReplyTo fixedMessageSelector answer else dynamicMessageSelector new MessageSelectorCreator correlation answer new SharedQueueMessageListenerContainer endpoint dynamicMessageSelector answer setCacheLevel DefaultMessageListenerContainer CACHE_SESSION
String replyToSelectorName endpoint getReplyToDestinationSelectorName if replyToSelectorName null replyToSelectorValue new BigInteger new Random toString String fixedMessageSelector replyToSelectorName replyToSelectorValue answer new SharedQueueMessageListenerContainer endpoint fixedMessageSelector answer setCacheLevel DefaultMessageListenerContainer CACHE_CONSUMER log debug endpoint getReplyTo fixedMessageSelector answer else dynamicMessageSelector new MessageSelectorCreator correlation answer new SharedQueueMessageListenerContainer endpoint dynamicMessageSelector answer setCacheLevel DefaultMessageListenerContainer CACHE_SESSION log debug endpoint getReplyTo answer log warn endpoint else if ReplyToType Exclusive type answer new ExclusiveQueueMessageListenerContainer endpoint
log debug endpoint getReplyTo fixedMessageSelector answer else dynamicMessageSelector new MessageSelectorCreator correlation answer new SharedQueueMessageListenerContainer endpoint dynamicMessageSelector answer setCacheLevel DefaultMessageListenerContainer CACHE_SESSION log debug endpoint getReplyTo answer log warn endpoint else if ReplyToType Exclusive type answer new ExclusiveQueueMessageListenerContainer endpoint answer setCacheLevel DefaultMessageListenerContainer CACHE_CONSUMER log debug endpoint getReplyTo answer else throw new IllegalArgumentException type String replyToCacheLevelName endpoint getConfiguration getReplyToCacheLevelName if replyToCacheLevelName null
answer setMessageListener this answer setPubSubDomain false answer setSubscriptionDurable false answer setConcurrentConsumers endpoint getReplyToConcurrentConsumers if endpoint getReplyToMaxConcurrentConsumers answer setMaxConcurrentConsumers endpoint getReplyToMaxConcurrentConsumers answer setConnectionFactory endpoint getConfiguration getOrCreateConnectionFactory String clientId endpoint getClientId if clientId null clientId answer setClientId clientId answer setSessionTransacted false if endpoint getExceptionListener null answer setExceptionListener endpoint getExceptionListener if endpoint getErrorHandler null
answer setConnectionFactory endpoint getConfiguration getOrCreateConnectionFactory String clientId endpoint getClientId if clientId null clientId answer setClientId clientId answer setSessionTransacted false if endpoint getExceptionListener null answer setExceptionListener endpoint getExceptionListener if endpoint getErrorHandler null answer setErrorHandler endpoint getErrorHandler else answer setErrorHandler new DefaultSpringErrorHandler endpoint getCamelContext QueueReplyManager class endpoint getErrorHandlerLoggingLevel endpoint isErrorHandlerLogStackTrace if endpoint getReceiveTimeout answer setReceiveTimeout endpoint getReceiveTimeout if endpoint getRecoveryInterval
try Exchange exchange holder getExchange boolean timeout holder isTimeout if timeout if log isWarnEnabled log warn holder getRequestTimeout holder getCorrelationId replyTo ExchangeHelper logIds exchange String msg holder getCorrelationId replyTo exchange setException new ExchangeTimedOutException exchange holder getRequestTimeout msg else Message message holder getMessage Session session holder getSession JmsMessage response new JmsMessage exchange message session endpoint getBinding exchange setOut response Object body response getBody if endpoint isTransferException body Exception
if timeout if log isWarnEnabled log warn holder getRequestTimeout holder getCorrelationId replyTo ExchangeHelper logIds exchange String msg holder getCorrelationId replyTo exchange setException new ExchangeTimedOutException exchange holder getRequestTimeout msg else Message message holder getMessage Session session holder getSession JmsMessage response new JmsMessage exchange message session endpoint getBinding exchange setOut response Object body response getBody if endpoint isTransferException body Exception log debug body exchange setException Exception body else
Override protected void doStart throws Exception ObjectHelper notNull executorService this ObjectHelper notNull scheduledExecutorService this ObjectHelper notNull endpoint this log trace endpoint getRequestTimeoutCheckerInterval correlation new CorrelationTimeoutMap scheduledExecutorService endpoint getRequestTimeoutCheckerInterval executorService ServiceHelper startService correlation listenerContainer createListenerContainer listenerContainer afterPropertiesSet
else answer setCacheLevel DefaultMessageListenerContainer CACHE_CONSUMER String clientId endpoint getClientId if clientId null clientId answer setClientId clientId answer setSessionTransacted false answer setExceptionListener new TemporaryReplyQueueExceptionListener destResolver endpoint getExceptionListener if endpoint getErrorHandler null answer setErrorHandler endpoint getErrorHandler else answer setErrorHandler new DefaultSpringErrorHandler endpoint getCamelContext TemporaryQueueReplyManager class endpoint getErrorHandlerLoggingLevel endpoint isErrorHandlerLogStackTrace if endpoint getReceiveTimeout answer setReceiveTimeout endpoint getReceiveTimeout if endpoint getRecoveryInterval
protected void assertCorrectBytesReceived Exchange exchange endpoint getReceivedExchanges get assertNotNull ExchangeHelper getBinding exchange JmsBinding class JmsMessage in JmsMessage exchange getIn assertNotNull in byte bytes exchange getIn getBody byte class
protected void assertCorrectMapReceived Exchange exchange endpoint getReceivedExchanges get assertNotNull ExchangeHelper getBinding exchange JmsBinding class JmsMessage in JmsMessage exchange getIn assertNotNull in Map map exchange getIn getBody Map class
Test public void testThreadPoolTaskExecutor throws Exception context getRouteController startRoute Long beforeThreadCount currentThreadCount getMockEndpoint expectedMessageCount doSendMessages DefaultTaskExecutorType ThreadPool Thread sleep doSendMessages DefaultTaskExecutorType ThreadPool assertMockEndpointsSatisfied Long numberThreadsCreated currentThreadCount beforeThreadCount
Test public void testSimpleAsyncTaskExecutor throws Exception context getRouteController startRoute Long beforeThreadCount currentThreadCount getMockEndpoint expectedMessageCount doSendMessages DefaultTaskExecutorType SimpleAsync Thread sleep doSendMessages DefaultTaskExecutorType SimpleAsync assertMockEndpointsSatisfied Long numberThreadsCreated currentThreadCount beforeThreadCount
Test public void testDefaultTaskExecutor throws Exception context getRouteController startRoute Long beforeThreadCount currentThreadCount getMockEndpoint expectedMessageCount doSendMessages null Thread sleep doSendMessages null assertMockEndpointsSatisfied Long numberThreadsCreated currentThreadCount beforeThreadCount
Test public void testDefaultTaskExecutorThreadPoolAtComponentConfig throws Exception context getComponent JmsComponent class getConfiguration setDefaultTaskExecutorType DefaultTaskExecutorType ThreadPool context getRouteController startRoute Long beforeThreadCount currentThreadCount getMockEndpoint expectedMessageCount doSendMessages DefaultTaskExecutorType ThreadPool Thread sleep doSendMessages DefaultTaskExecutorType ThreadPool assertMockEndpointsSatisfied Long numberThreadsCreated currentThreadCount beforeThreadCount
Test public void testJmsRequestReplyExclusiveFixedReplyTo throws Exception StopWatch watch new StopWatch ExecutorService executor Executors newFixedThreadPool for int i i size i final Integer num i executor submit String reply template requestBody num String class
Test public void testJmsRequestReplyExclusiveFixedReplyTo throws Exception StopWatch watch new StopWatch ExecutorService executor Executors newFixedThreadPool for int i i size i final Integer num i executor submit String reply template requestBody num String class LOG info num num reply assertNotNull reply assertEquals num reply latch countDown LOG info size assertTrue latch await TimeUnit SECONDS long delta watch taken
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder public void configure throws Exception from componentName process exchange assertEquals exchange getIn getBody myReplyTo exchange getIn getHeader String class
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder public void configure throws Exception from getQueueEndpointName process exchange exchange setPattern ExchangePattern InOnly Message in exchange getIn assertEquals in getBody replyDestination in getHeader Destination class cid in getHeader String class
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder public void configure throws Exception from getQueueEndpointName process exchange exchange setPattern ExchangePattern InOnly Message in exchange getIn assertEquals in getBody replyDestination in getHeader Destination class cid in getHeader String class LOG info replyDestination
Override public boolean process final Exchange exchange final AsyncCallback callback executor submit LOG info getEndpoint getDelay Thread sleep getEndpoint getDelay int count counter incrementAndGet if getEndpoint getFailFirstAttempts count
public void onEvent Map String Object heartbeat String key String heartbeat get
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder public void configure throws Exception from recipientList header to from transform body prepend process exchange String replyTo exchange getIn getHeader String class String cid exchange getIn getHeader String class
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder public void configure throws Exception from recipientList header to from transform body prepend process exchange String replyTo exchange getIn getHeader String class String cid exchange getIn getHeader String class log info replyTo
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder public void configure throws Exception from recipientList header to from transform body prepend process exchange String replyTo exchange getIn getHeader String class String cid exchange getIn getHeader String class log info replyTo log info cid if replyTo null cid null Thread sleep
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder public void configure throws Exception from to to from transform body prepend process exchange String replyTo exchange getIn getHeader String class String cid exchange getIn getHeader String class
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder public void configure throws Exception from to to from transform body prepend process exchange String replyTo exchange getIn getHeader String class String cid exchange getIn getHeader String class log info replyTo
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder public void configure throws Exception from to to from transform body prepend process exchange String replyTo exchange getIn getHeader String class String cid exchange getIn getHeader String class log info replyTo log info cid if replyTo null cid null Thread sleep
Test public void testSendToAlotOfMessageToQueues throws Exception int size
Test public void testSendToAlotOfMessageToQueues throws Exception int size LOG info size for int i i size i if i i
Test public void testForwardingJmsMessageIgnoresHeadersMQDoesntLike throws Exception MockEndpoint endpoint getMockEndpoint endpoint expectedMessageCount Map String Object headers new HashMap headers put template sendBodyAndHeaders headers endpoint assertIsSatisfied Exchange exchange endpoint getReceivedExchanges get Message in exchange getIn assertMessageHeader in null
Override public String say String name
getMockEndpoint expectedMessageCount size getMockEndpoint expectsNoDuplicates body getMockEndpoint expectedMessageCount size size getMockEndpoint expectedMessageCount size for int i i size i String type if i type else if i type else type template sendBodyAndHeader i type assertMockEndpointsSatisfied long delta System currentTimeMillis start
long start System currentTimeMillis getMockEndpoint expectedMessageCount size getMockEndpoint expectsNoDuplicates body getMockEndpoint expectedMinimumMessageCount size size getMockEndpoint expectedMinimumMessageCount size for int i i size i String type if i type else if i type else type template sendBodyAndHeader i type assertMockEndpointsSatisfied
protected void addNotificationListener throws Exception JMXEndpoint ep getEndpoint NotificationFilter nf ep getNotificationFilter if nf null ep getObservedAttribute null
protected JAXBContext createContext String contextPath throws JAXBException ClassLoader cl NotificationXmlFormatter class getClassLoader try
private synchronized JoltTransform getTransform throws Exception if transform null if log isDebugEnabled String path getResourceUri
public JoltEndpoint findOrCreateEndpoint String uri String newResourceUri String newUri uri replace getResourceUri newResourceUri
Override protected void doInit throws Exception super doInit if entityManagerFactory null Map String EntityManagerFactory map getCamelContext getRegistry findByTypeWithName EntityManagerFactory class if map null if map size entityManagerFactory map values iterator next
if entityManagerFactory null Map String EntityManagerFactory map getCamelContext getRegistry findByTypeWithName EntityManagerFactory class if map null if map size entityManagerFactory map values iterator next LOG info map keySet iterator next entityManagerFactory else LOG debug map size else LOG info entityManagerFactory if transactionManager null Map String PlatformTransactionManager map getCamelContext getRegistry findByTypeWithName PlatformTransactionManager class if map null if map size transactionManager map values iterator next
if map null if map size entityManagerFactory map values iterator next LOG info map keySet iterator next entityManagerFactory else LOG debug map size else LOG info entityManagerFactory if transactionManager null Map String PlatformTransactionManager map getCamelContext getRegistry findByTypeWithName PlatformTransactionManager class if map null if map size transactionManager map values iterator next LOG info map keySet iterator next transactionManager else
entityManagerFactory map values iterator next LOG info map keySet iterator next entityManagerFactory else LOG debug map size else LOG info entityManagerFactory if transactionManager null Map String PlatformTransactionManager map getCamelContext getRegistry findByTypeWithName PlatformTransactionManager class if map null if map size transactionManager map values iterator next LOG info map keySet iterator next transactionManager else LOG debug map size else
else LOG info entityManagerFactory if transactionManager null Map String PlatformTransactionManager map getCamelContext getRegistry findByTypeWithName PlatformTransactionManager class if map null if map size transactionManager map values iterator next LOG info map keySet iterator next transactionManager else LOG debug map size else LOG info transactionManager if transactionManager null Map String TransactionTemplate map getCamelContext getRegistry findByTypeWithName TransactionTemplate class if map null
else LOG info entityManagerFactory if transactionManager null Map String PlatformTransactionManager map getCamelContext getRegistry findByTypeWithName PlatformTransactionManager class if map null if map size transactionManager map values iterator next LOG info map keySet iterator next transactionManager else LOG debug map size else LOG info transactionManager if transactionManager null Map String TransactionTemplate map getCamelContext getRegistry findByTypeWithName TransactionTemplate class if map null
Override public int processBatch Queue Object exchanges throws Exception int total exchanges size if maxMessagesPerPoll total maxMessagesPerPoll
int total exchanges size if maxMessagesPerPoll total maxMessagesPerPoll LOG debug maxMessagesPerPoll total total maxMessagesPerPoll for int index index total isBatchAllowed index DataHolder holder org apache camel util ObjectHelper cast DataHolder class exchanges poll EntityManager entityManager holder manager Exchange exchange holder exchange Object result holder result exchange setProperty Exchange BATCH_INDEX index exchange setProperty Exchange BATCH_SIZE total exchange setProperty Exchange BATCH_COMPLETE index total pendingExchanges total index if lockEntity result entityManager createPreDeleteHandler deleteObject entityManager result exchange
Query query getQueryFactory createQuery entityManager configureParameters query if getEndpoint isConsumeLockEntity query setLockMode getLockModeType LOG trace query Object answer try List results query getResultList if results null results size answer results get else answer results LOG debug entityManager flush entityManager clear
Object managedEntity for Object entity collection if getEndpoint isRemove managedEntity save entity else managedEntity remove entity managedCollection add managedEntity if getEndpoint isUsePersist exchange getIn setBody managedCollection else Object managedEntity if getEndpoint isRemove managedEntity save values else managedEntity remove values
managedCollection add managedEntity if getEndpoint isUsePersist exchange getIn setBody managedCollection else Object managedEntity if getEndpoint isRemove managedEntity save values else managedEntity remove values if getEndpoint isUsePersist exchange getIn setBody managedEntity if getEndpoint isFlushOnSend entityManager flush return null private Object save final Object entity
entityManager joinTransaction try List list query entityManager messageId if list isEmpty MessageProcessed processed new MessageProcessed processed setProcessorName processorName processed setMessageId messageId processed setCreatedAt new Date entityManager persist processed entityManager flush entityManager close return Boolean TRUE else return Boolean FALSE catch Exception ex
try List list query entityManager messageId if list isEmpty return Boolean FALSE else return Boolean TRUE catch Exception ex LOG error ex getMessage ex throw new PersistenceException ex finally try if entityManager isOpen entityManager close catch Exception e
Boolean rc transactionTemplate execute new TransactionCallback Boolean public Boolean doInTransaction TransactionStatus status if isJoinTransaction entityManager joinTransaction try List list query entityManager messageId if list isEmpty return Boolean FALSE else MessageProcessed processed MessageProcessed list get entityManager remove processed entityManager flush entityManager close return Boolean TRUE catch Exception ex
Override public boolean confirm final Exchange exchange String messageId
transactionTemplate execute new TransactionCallback Boolean public Boolean doInTransaction TransactionStatus status if isJoinTransaction entityManager joinTransaction try List list queryClear entityManager if list isEmpty Iterator it list iterator while it hasNext Object item it next entityManager remove item entityManager flush entityManager close return Boolean TRUE catch Exception ex
List results entityManager createQuery queryText getResultList assertEquals results size results template send Customer class getName new Processor public void process Exchange exchange Customer customer new Customer customer setName exchange getIn setBody customer results entityManager createQuery queryText getResultList assertEquals results size results Customer customer Customer results get assertEquals customer getName consumer endpoint createConsumer new Processor public void process Exchange e
entityManager persist dummy return null List results entityManager createQuery queryText getResultList assertEquals results size results template send MultiSteps class getName new Processor public void process Exchange exchange exchange getIn setBody new MultiSteps results entityManager createQuery queryText getResultList assertEquals results size results MultiSteps mail MultiSteps results get assertEquals mail getAddress consumer endpoint createConsumer new Processor public void process Exchange e
getMockEndpoint assertNoDuplicates body ExecutorService executor Executors newFixedThreadPool poolSize Map Integer Future SendEmail responses new HashMap for int i i files i final int index i Future SendEmail out executor submit new Callable SendEmail public SendEmail call throws Exception return template requestBody new SendEmail index SendEmail class responses put index out assertMockEndpointsSatisfied TimeUnit SECONDS assertEquals files responses size for Future SendEmail future responses values SendEmail sendEmail future get assertNotNull sendEmail
userKnownHostFile System getProperty LOG info userKnownHostFile knownHostsFile userKnownHostFile if ObjectHelper isNotEmpty knownHostsFile if knownHostsFile startsWith knownHostsFile knownHostsFile try InputStream is ResourceHelper resolveMandatoryResourceAsInputStream endpoint getCamelContext knownHostsFile jsch setKnownHosts is catch Exception e throw new GenericFileOperationFailedException knownHostsFile e else jsch setKnownHosts String null session jsch getSession config getUsername config getHost config getPort session setTimeout config getTimeout
sshd setKeyPairProvider new FileKeyPairProvider Paths get sshd setSubsystemFactories Arrays asList new SftpSubsystemFactory sshd setCommandFactory new ScpCommandFactory sshd setPasswordAuthenticator new PasswordAuthenticator Override public boolean authenticate String username String password ServerSession session return username null username equals password sshd setPublickeyAuthenticator new PublickeyAuthenticator Override public boolean authenticate String username PublicKey key ServerSession session return true try sshd start return true catch IOException e
private synchronized Expression getTransform Message msg throws Exception if transform null if log isDebugEnabled String path getResourceUri
public JsltEndpoint findOrCreateEndpoint String uri String newResourceUri String newUri uri replace getResourceUri newResourceUri
SuppressWarnings public Object read Exchange exchange throws Exception Object answer if path null Expression exp exchange getContext resolveLanguage createExpression expression String text exp evaluate exchange String class JsonPath path JsonPath compile text
private void doInitAdapter Exchange exchange if initJsonAdapter try LOG debug JACKSON_JSON_ADAPTER Class clazz exchange getContext getClassResolver resolveClass JACKSON_JSON_ADAPTER if clazz null Object obj exchange getContext getInjector newInstance clazz if obj JsonPathAdapter adapter JsonPathAdapter obj adapter init exchange getContext
public void init String exp expression if predicate isAllowEasyPredicate EasyPredicateParser parser new EasyPredicateParser exp parser parse expression if exp equals expression
Test public void testExpressionArray throws Exception Exchange exchange new DefaultExchange context exchange getIn setBody new File Language lan context resolveLanguage Expression exp lan createExpression List authors exp evaluate exchange List class
Override protected void doShutdown throws Exception super doShutdown if connectionPool null
if policy JtaTransactionPolicy throw new RuntimeCamelException definition getPolicyRef policy getClass getName JtaTransactionPolicy class getName transactionPolicy JtaTransactionPolicy policy if transactionPolicy null LOG debug Map String TransactedPolicy mapPolicy findByTypeWithName TransactedPolicy class if mapPolicy null mapPolicy size TransactedPolicy policy mapPolicy values iterator next if policy JtaTransactionPolicy transactionPolicy JtaTransactionPolicy policy if transactionPolicy null TransactedPolicy policy lookupByNameAndType PROPAGATION_REQUIRED TransactedPolicy class if policy JtaTransactionPolicy transactionPolicy JtaTransactionPolicy policy if transactionPolicy null
Override public Processor wrap Route route Processor processor JtaTransactionErrorHandler answer RouteDefinition routeDefinition RouteDefinition route getRoute ErrorHandlerBuilder builder ErrorHandlerBuilder routeDefinition getErrorHandlerFactory if builder ErrorHandlerBuilderRef ErrorHandlerBuilderRef builderRef ErrorHandlerBuilderRef builder String ref builderRef getRef if ErrorHandlerReifier isErrorHandlerFactoryConfigured ref
doInTransactionTemplate exchange logTransactionCommit redelivered ids catch TransactionRolledbackException e logTransactionRollback redelivered ids null true catch Throwable e exchange setException e logTransactionRollback redelivered ids e false finally exchange getUnitOfWork endTransactedBy transactionKey boolean onlyLast exchange isRollbackOnlyLast exchange setRollbackOnlyLast false if onlyLast if LOG isDebugEnabled Exception cause exchange getException if cause null
catch TransactionRolledbackException e logTransactionRollback redelivered ids null true catch Throwable e exchange setException e logTransactionRollback redelivered ids e false finally exchange getUnitOfWork endTransactedBy transactionKey boolean onlyLast exchange isRollbackOnlyLast exchange setRollbackOnlyLast false if onlyLast if LOG isDebugEnabled Exception cause exchange getException if cause null LOG debug transactionKey redelivered ids cause else
private void logTransactionBegin String redelivered String ids if LOG isDebugEnabled
private void logTransactionCommit String redelivered String ids if equals redelivered if rollbackLoggingLevel LoggingLevel INFO rollbackLoggingLevel LoggingLevel WARN rollbackLoggingLevel LoggingLevel ERROR
private void logTransactionRollback String redelivered String ids Throwable e boolean rollbackOnly if rollbackLoggingLevel LoggingLevel OFF return else if rollbackLoggingLevel LoggingLevel ERROR LOG isErrorEnabled if rollbackOnly LOG error transactionKey redelivered ids else LOG error transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel WARN LOG isWarnEnabled if rollbackOnly LOG warn transactionKey redelivered ids else LOG warn transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel INFO LOG isInfoEnabled if rollbackOnly
return else if rollbackLoggingLevel LoggingLevel ERROR LOG isErrorEnabled if rollbackOnly LOG error transactionKey redelivered ids else LOG error transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel WARN LOG isWarnEnabled if rollbackOnly LOG warn transactionKey redelivered ids else LOG warn transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel INFO LOG isInfoEnabled if rollbackOnly LOG info transactionKey redelivered ids else
if rollbackOnly LOG error transactionKey redelivered ids else LOG error transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel WARN LOG isWarnEnabled if rollbackOnly LOG warn transactionKey redelivered ids else LOG warn transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel INFO LOG isInfoEnabled if rollbackOnly LOG info transactionKey redelivered ids else LOG info transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel DEBUG LOG isDebugEnabled
else LOG error transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel WARN LOG isWarnEnabled if rollbackOnly LOG warn transactionKey redelivered ids else LOG warn transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel INFO LOG isInfoEnabled if rollbackOnly LOG info transactionKey redelivered ids else LOG info transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel DEBUG LOG isDebugEnabled if rollbackOnly LOG debug transactionKey redelivered ids
Override protected void doStart throws Exception LOG info endpoint getConfiguration getTopic endpoint getConfiguration isBreakOnFirstError super doStart StateRepository String String repo endpoint getConfiguration getOffsetRepository if repo ServiceSupport boolean started ServiceSupport repo isStarted if started stopOffsetRepo true
Override protected void doStop throws Exception LOG info endpoint getConfiguration getTopic if executor null if getEndpoint null getEndpoint getCamelContext null int timeout getEndpoint getConfiguration getShutdownTimeout
LOG info endpoint getConfiguration getTopic if executor null if getEndpoint null getEndpoint getCamelContext null int timeout getEndpoint getConfiguration getShutdownTimeout LOG debug timeout getEndpoint getCamelContext getExecutorServiceManager shutdownGraceful executor timeout else executor shutdownNow if executor isTerminated tasks forEach KafkaFetchRecords :: shutdown executor shutdownNow tasks clear executor null if stopOffsetRepo StateRepository String String repo endpoint getConfiguration getOffsetRepository
public void updateClassProperties Properties props try if getCamelContext null ClassResolver resolver getCamelContext getClassResolver replaceWithClass props ProducerConfig KEY_SERIALIZER_CLASS_CONFIG resolver Serializer class replaceWithClass props ProducerConfig VALUE_SERIALIZER_CLASS_CONFIG resolver Serializer class replaceWithClass props ConsumerConfig KEY_DESERIALIZER_CLASS_CONFIG resolver Deserializer class replaceWithClass props ConsumerConfig VALUE_DESERIALIZER_CLASS_CONFIG resolver Deserializer class try Field f ProducerConfig class getDeclaredField if f null loadParitionerClass resolver props catch NoSuchFieldException e catch SecurityException e catch Throwable t
Override protected void doStop throws Exception if kafkaProducer null closeKafkaProducer
SuppressWarnings protected Iterator KeyValueHolder Object ProducerRecord createRecorder Exchange exchange throws Exception String topic endpoint getConfiguration getTopic Object overrideTopic exchange getIn removeHeader KafkaConstants OVERRIDE_TOPIC if overrideTopic null
Override SuppressWarnings public boolean process Exchange exchange AsyncCallback callback try Iterator KeyValueHolder Object ProducerRecord c createRecorder exchange KafkaProducerCallBack cb new KafkaProducerCallBack exchange callback while c hasNext cb increment KeyValueHolder Object ProducerRecord exrec c next ProducerRecord rec exrec getValue if LOG isDebugEnabled
Override SuppressWarnings protected void doStart throws Exception ObjectHelper notNull camelContext StringHelper notEmpty topic this cache LRUCacheFactory newLRUCache maxCacheSize if consumerConfig null consumerConfig new Properties StringHelper notEmpty bootstrapServers consumerConfig put ConsumerConfig BOOTSTRAP_SERVERS_CONFIG bootstrapServers if producerConfig null producerConfig new Properties StringHelper notEmpty bootstrapServers producerConfig put ProducerConfig BOOTSTRAP_SERVERS_CONFIG bootstrapServers ObjectHelper notNull consumerConfig ObjectHelper notNull producerConfig String groupId UUID randomUUID toString
private void broadcastAction String key CacheAction action try
Override ManagedOperation description public boolean contains String key
private static KubernetesClient createKubernetesClient KubernetesConfiguration configuration
Override public List ServiceDefinition getServices String name
Override public List ServiceDefinition getServices String name LOG debug this namespace name Endpoints endpoints client endpoints inNamespace this namespace withName name get List ServiceDefinition result new ArrayList if endpoints null if LOG isDebugEnabled
Override public List ServiceDefinition getServices String name try final String query cache computeIfAbsent name this :: computeQueryString final DirContext ctx new InitialDirContext ENV final NamingEnumeration resolved ctx getAttributes query ATTRIBUTE_IDS get getAll if resolved hasMore List ServiceDefinition servers new LinkedList while resolved hasMore String record String resolved next String items record split String host items trim String port items trim if ObjectHelper isEmpty host ObjectHelper isEmpty port continue if LOGGER isDebugEnabled
return false else if members contains this lockConfiguration getPodName LOG warn logPrefix latestLeaderInfo getMembers return false LeaderInfo newLeaderInfo new LeaderInfo this lockConfiguration getGroupName this lockConfiguration getPodName new Date members if configMap null LOG debug logPrefix ConfigMap newConfigMap ConfigMapLockUtils createNewConfigMap this lockConfiguration getConfigMapName newLeaderInfo try kubernetesClient configMaps inNamespace this lockConfiguration getKubernetesResourcesNamespaceOrDefault kubernetesClient create newConfigMap LOG debug logPrefix this lockConfiguration getConfigMapName updateLatestLeaderInfo newConfigMap members return true catch Exception ex LOG warn logPrefix
catch Exception ex LOG warn logPrefix LOG debug logPrefix ex return false else LOG debug logPrefix LeaderInfo leaderInfo ConfigMapLockUtils getLeaderInfo configMap members this lockConfiguration getGroupName boolean canAcquire leaderInfo hasValidLeader if canAcquire try ConfigMap updatedConfigMap ConfigMapLockUtils getConfigMapWithNewLeader configMap newLeaderInfo kubernetesClient configMaps inNamespace this lockConfiguration getKubernetesResourcesNamespaceOrDefault kubernetesClient withName this lockConfiguration getConfigMapName lockResourceVersion configMap getMetadata getResourceVersion replace updatedConfigMap LOG debug logPrefix this lockConfiguration getConfigMapName updateLatestLeaderInfo updatedConfigMap members return true
long version try lock lock this currentLeader leader this currentMembers members this timestamp timestamp this lease lease version changeCounter finally lock unlock LOG debug leader version this executor execute checkAndNotify version if leader isPresent long time System currentTimeMillis long delay Math max timestamp lease FIXED_DELAY time FIXED_DELAY
try lock lock if version this changeCounter return leader this currentLeader members this currentMembers if leader isPresent long time System currentTimeMillis if time this timestamp this lease leader Optional empty finally lock unlock final Optional String newLeader leader if newLeader equals lastCommunicatedLeader lastCommunicatedLeader newLeader
finally lock unlock final Optional String newLeader leader if newLeader equals lastCommunicatedLeader lastCommunicatedLeader newLeader LOG info newLeader try handler onKubernetesClusterEvent new KubernetesClusterEvent KubernetesClusterLeaderChangedEvent Override public Optional String getData return newLeader catch Throwable t LOG warn t final Set String newMembers members if newMembers equals lastCommunicatedMembers
Override public void leadershipChanged CamelClusterView view Optional CamelClusterMember leader
else if ResourceHelper hasScheme script is ResourceHelper resolveMandatoryResourceAsInputStream getEndpoint getCamelContext script else if EndpointHelper isReferenceParameter script String ref script substring is ResourceHelper resolveMandatoryResourceAsInputStream getEndpoint getCamelContext ref if is null getEndpoint isBinary try script getEndpoint getCamelContext getTypeConverter convertTo String class exchange is finally IOHelper close is if script null exp getEndpoint getLanguage createExpression script getEndpoint setContentResolvedFromResource true if getEndpoint isCacheScript getEndpoint setExpression exp
public static DirectoryService createDS CreateDS dsBuilder throws Exception
dauth setDelegateTlsTrustManagerFQCN createAuthenticator delegateTlsTrustManagerFQCN authenticators add auth authenticationInterceptor setAuthenticators authenticators authenticationInterceptor init service service setInterceptors interceptorList SchemaManager schemaManager service getSchemaManager for LoadSchema loadedSchema dsBuilder loadedSchemas String schemaName loadedSchema name Boolean enabled loadedSchema enabled boolean isLoaded schemaManager isSchemaLoaded schemaName if isLoaded try isLoaded schemaManager load schemaName catch LdapUnwillingToPerformException lutpe LOG error lutpe getMessage
authenticationInterceptor setAuthenticators authenticators authenticationInterceptor init service service setInterceptors interceptorList SchemaManager schemaManager service getSchemaManager for LoadSchema loadedSchema dsBuilder loadedSchemas String schemaName loadedSchema name Boolean enabled loadedSchema enabled boolean isLoaded schemaManager isSchemaLoaded schemaName if isLoaded try isLoaded schemaManager load schemaName catch LdapUnwillingToPerformException lutpe LOG error lutpe getMessage continue if isLoaded
service setInterceptors interceptorList SchemaManager schemaManager service getSchemaManager for LoadSchema loadedSchema dsBuilder loadedSchemas String schemaName loadedSchema name Boolean enabled loadedSchema enabled boolean isLoaded schemaManager isSchemaLoaded schemaName if isLoaded try isLoaded schemaManager load schemaName catch LdapUnwillingToPerformException lutpe LOG error lutpe getMessage continue if isLoaded if enabled schemaManager enable schemaName
ApplyLdifs applyLdifs desc getAnnotation ApplyLdifs class if applyLdifs null applyLdifs value null String ldifs applyLdifs value String dnStart StringBuilder sb new StringBuilder for int i i ldifs length String s ldifs i trim if s startsWith dnStart sb append s append while i ldifs length s ldifs i if s startsWith dnStart sb append s append else break
List String result null exchange setOut exchange getIn if ObjectHelper isEmpty body exchange getOut setBody else if body startsWith LDIF_HEADER LOG debug result processLdif new StringReader body else URL loc try loc new URL body LOG debug loc result processLdif new InputStreamReader loc openStream catch MalformedURLException e if LOG isDebugEnabled
private String processLdifEntry LdapConnection conn LdifEntry ldifEntry try if ldifEntry isChangeAdd ldifEntry isLdifContent if LOG isDebugEnabled
try if ldifEntry isChangeAdd ldifEntry isLdifContent if LOG isDebugEnabled LOG debug ldifEntry conn add ldifEntry getEntry else if ldifEntry isChangeModify if LOG isDebugEnabled LOG debug ldifEntry conn modify ldifEntry getDn ldifEntry getModificationArray else if ldifEntry isChangeDelete if LOG isDebugEnabled LOG debug ldifEntry conn delete ldifEntry getDn else if ldifEntry isChangeModDn if LOG isDebugEnabled
conn add ldifEntry getEntry else if ldifEntry isChangeModify if LOG isDebugEnabled LOG debug ldifEntry conn modify ldifEntry getDn ldifEntry getModificationArray else if ldifEntry isChangeDelete if LOG isDebugEnabled LOG debug ldifEntry conn delete ldifEntry getDn else if ldifEntry isChangeModDn if LOG isDebugEnabled LOG debug ldifEntry conn moveAndRename ldifEntry getDn new Dn ldifEntry getNewRdn ldifEntry getNewSuperior ldifEntry isDeleteOldRdn else if ldifEntry isChangeModRdn if LOG isDebugEnabled
public static DirectoryService createDS CreateDS dsBuilder throws Exception
dauth setDelegateTlsTrustManagerFQCN createAuthenticator delegateTlsTrustManagerFQCN authenticators add auth authenticationInterceptor setAuthenticators authenticators authenticationInterceptor init service service setInterceptors interceptorList SchemaManager schemaManager service getSchemaManager for LoadSchema loadedSchema dsBuilder loadedSchemas String schemaName loadedSchema name Boolean enabled loadedSchema enabled boolean isLoaded schemaManager isSchemaLoaded schemaName if isLoaded try isLoaded schemaManager load schemaName catch LdapUnwillingToPerformException lutpe LOG error lutpe getMessage
authenticationInterceptor setAuthenticators authenticators authenticationInterceptor init service service setInterceptors interceptorList SchemaManager schemaManager service getSchemaManager for LoadSchema loadedSchema dsBuilder loadedSchemas String schemaName loadedSchema name Boolean enabled loadedSchema enabled boolean isLoaded schemaManager isSchemaLoaded schemaName if isLoaded try isLoaded schemaManager load schemaName catch LdapUnwillingToPerformException lutpe LOG error lutpe getMessage continue if isLoaded
service setInterceptors interceptorList SchemaManager schemaManager service getSchemaManager for LoadSchema loadedSchema dsBuilder loadedSchemas String schemaName loadedSchema name Boolean enabled loadedSchema enabled boolean isLoaded schemaManager isSchemaLoaded schemaName if isLoaded try isLoaded schemaManager load schemaName catch LdapUnwillingToPerformException lutpe LOG error lutpe getMessage continue if isLoaded if enabled schemaManager enable schemaName
ApplyLdifs applyLdifs desc getAnnotation ApplyLdifs class if applyLdifs null applyLdifs value null String ldifs applyLdifs value String dnStart StringBuilder sb new StringBuilder for int i i ldifs length String s ldifs i trim if s startsWith dnStart sb append s append while i ldifs length s ldifs i if s startsWith dnStart sb append s append else break
Override public Exchange add final CamelContext camelContext final String key final Exchange exchange
Override public void remove final CamelContext camelContext final String key final Exchange exchange
Override public void confirm final CamelContext camelContext final String exchangeId
String keyBuffer try String prefix getRepositoryNameCompleted for it seek keyBuilder getRepositoryNameCompleted it hasNext it next keyBuffer asString it peekNext getKey if keyBuffer startsWith prefix break String exchangeId keyBuffer substring prefix length LOG trace exchangeId answer add exchangeId finally IOHelper close it if answer size LOG trace else
Override public void stop File file getFile
Test public void testLoadAndRecoverLevelDBAggregate throws Exception MockEndpoint mock getMockEndpoint mock expectedMessageCount SIZE mock setResultWaitTime
Test public void testLoadAndRecoverLevelDBAggregate throws Exception MockEndpoint mock getMockEndpoint mock expectedMessageCount SIZE mock setResultWaitTime LOG info SIZE for int i i SIZE i final int value char id Map String Object headers new HashMap headers put id headers put i
Test public void testLoadTestLevelDBAggregate throws Exception MockEndpoint mock getMockEndpoint mock expectedMessageCount mock setResultWaitTime ExecutorService executor Executors newFixedThreadPool LOG info SIZE for int i i SIZE i final int value final int key i executor submit new Callable Object public Object call throws Exception char id KEYS key
Test public void testLoadTestLevelDBAggregate throws Exception MockEndpoint mock getMockEndpoint mock expectedMinimumMessageCount mock setResultWaitTime LOG info SIZE for int i i SIZE i final int value char id
Test public void testLoadTestLevelDBAggregate throws Exception MockEndpoint mock getMockEndpoint mock expectedMinimumMessageCount mock setResultWaitTime LOG info SIZE for int i i SIZE i final int value HeaderDto headerDto new HeaderDto char id
Test public void testBigPayload throws Exception log info TIME Thread sleep File file new File assertTrue file exists file long size file length
Test public void testPutAndGetNotFound LevelDBAggregationRepository repo new LevelDBAggregationRepository repo setLevelDBFile levelDBFile repo setRepositoryName Exchange exchange new DefaultExchange context exchange getIn setBody
Test public void testPutAndGetNotFound LevelDBAggregationRepository repo new LevelDBAggregationRepository repo setLevelDBFile levelDBFile repo setRepositoryName Exchange exchange new DefaultExchange context exchange getIn setBody log info exchange getExchangeId repo add context exchange getExchangeId exchange Exchange out repo get context exchange getExchangeId assertNotNull out Exchange exchange2 new DefaultExchange context exchange2 getIn setBody
Override protected Endpoint createEndpoint String uri String remaining Map String Object parameters throws Exception LoggingLevel level getLoggingLevel parameters Logger providedLogger getLogger parameters if providedLogger null Map String Logger availableLoggers getCamelContext getRegistry findByTypeWithName Logger class if availableLoggers size providedLogger availableLoggers values iterator next
public void index Exchange exchange throws Exception
Test public void testLucenePhraseQueryProducer throws Exception MockEndpoint mockSearchEndpoint getMockEndpoint context stop context addRoutes new RouteBuilder public void configure from setHeader constant to to from process new Processor public void process Exchange exchange throws Exception Hits hits exchange getIn getBody Hits class printResults hits private void printResults Hits hits LOG debug hits getNumberOfHits for int i i hits getNumberOfHits i LOG debug i hits getHit get i getHitLocation LOG debug i hits getHit get i getScore
Test public void testLuceneWildcardQueryProducer throws Exception MockEndpoint mockSearchEndpoint getMockEndpoint context stop context addRoutes new RouteBuilder public void configure from setHeader constant to to from process new Processor public void process Exchange exchange throws Exception Hits hits exchange getIn getBody Hits class printResults hits private void printResults Hits hits LOG debug hits getNumberOfHits for int i i hits getNumberOfHits i LOG debug i hits getHit get i getHitLocation LOG debug i hits getHit get i getScore
Test public void testReturnLuceneDocsQueryProducer throws Exception MockEndpoint mockSearchEndpoint getMockEndpoint context stop context addRoutes new RouteBuilder public void configure from setHeader constant setHeader constant to to from process new Processor public void process Exchange exchange throws Exception Hits hits exchange getIn getBody Hits class printResults hits private void printResults Hits hits throws Exception LOG debug hits getNumberOfHits for int i i hits getNumberOfHits i LOG debug i hits getHit get i getHitLocation LOG debug i hits getHit get i getScore
Test public void testPhraseSearcher throws Exception final StandardAnalyzer analyzer new StandardAnalyzer MockEndpoint mockSearchEndpoint getMockEndpoint context stop context addRoutes new RouteBuilder public void configure try from setHeader constant process new LuceneQueryProcessor analyzer null to catch Exception e e printStackTrace from process new Processor public void process Exchange exchange throws Exception Hits hits exchange getIn getBody Hits class printResults hits private void printResults Hits hits
MockEndpoint mockSearchEndpoint getMockEndpoint context stop context addRoutes new RouteBuilder public void configure try from setHeader constant process new LuceneQueryProcessor analyzer null to catch Exception e e printStackTrace from process new Processor public void process Exchange exchange throws Exception Hits hits exchange getIn getBody Hits class printResults hits private void printResults Hits hits LOG debug hits getNumberOfHits for int i i hits getNumberOfHits i
context stop context addRoutes new RouteBuilder public void configure try from setHeader constant process new LuceneQueryProcessor analyzer null to catch Exception e e printStackTrace from process new Processor public void process Exchange exchange throws Exception Hits hits exchange getIn getBody Hits class printResults hits private void printResults Hits hits LOG debug hits getNumberOfHits for int i i hits getNumberOfHits i LOG debug i hits getHit get i getHitLocation
context addRoutes new RouteBuilder public void configure try from setHeader constant process new LuceneQueryProcessor analyzer null to catch Exception e e printStackTrace from process new Processor public void process Exchange exchange throws Exception Hits hits exchange getIn getBody Hits class printResults hits private void printResults Hits hits LOG debug hits getNumberOfHits for int i i hits getNumberOfHits i LOG debug i hits getHit get i getHitLocation LOG debug i hits getHit get i getScore
Test public void testWildcardSearcher throws Exception final WhitespaceAnalyzer analyzer new WhitespaceAnalyzer MockEndpoint mockSearchEndpoint getMockEndpoint context stop context addRoutes new RouteBuilder public void configure try from setHeader constant process new LuceneQueryProcessor analyzer null to catch Exception e e printStackTrace from process new Processor public void process Exchange exchange throws Exception Hits hits exchange getIn getBody Hits class printResults hits private void printResults Hits hits
MockEndpoint mockSearchEndpoint getMockEndpoint context stop context addRoutes new RouteBuilder public void configure try from setHeader constant process new LuceneQueryProcessor analyzer null to catch Exception e e printStackTrace from process new Processor public void process Exchange exchange throws Exception Hits hits exchange getIn getBody Hits class printResults hits private void printResults Hits hits LOG debug hits getNumberOfHits for int i i hits getNumberOfHits i
context stop context addRoutes new RouteBuilder public void configure try from setHeader constant process new LuceneQueryProcessor analyzer null to catch Exception e e printStackTrace from process new Processor public void process Exchange exchange throws Exception Hits hits exchange getIn getBody Hits class printResults hits private void printResults Hits hits LOG debug hits getNumberOfHits for int i i hits getNumberOfHits i LOG debug i hits getHit get i getHitLocation
context addRoutes new RouteBuilder public void configure try from setHeader constant process new LuceneQueryProcessor analyzer null to catch Exception e e printStackTrace from process new Processor public void process Exchange exchange throws Exception Hits hits exchange getIn getBody Hits class printResults hits private void printResults Hits hits LOG debug hits getNumberOfHits for int i i hits getNumberOfHits i LOG debug i hits getHit get i getHitLocation LOG debug i hits getHit get i getScore
int frameVersion in readUnsignedByte sessionHandler versionRead frameVersion int frameType in readUnsignedByte LOG debug char frameType switch frameType case TYPE_JSON frameDecoded handleJsonFrame in out break case TYPE_DATA frameDecoded handleDataFrame in out break case TYPE_WINDOW frameDecoded handleWindowFrame in break case TYPE_COMPRESS frameDecoded handleCompressedFrame ctx in out break default throw new RuntimeException frameType finally
Override public void exceptionCaught ChannelHandlerContext ctx Throwable cause throws Exception if cause IOException
public void start throws InterruptedException LOG info host port bossGroup new NioEventLoopGroup workerGroup new NioEventLoopGroup WORKER_THREADS executorService new DefaultEventExecutorGroup WORKER_THREADS threadFactory ChannelHandler initializer new LumberjackChannelInitializer sslContext executorService messageProcessor ServerBootstrap serverBootstrap new ServerBootstrap group bossGroup workerGroup channel NioServerSocketChannel class option ChannelOption SO_BACKLOG childHandler initializer channel serverBootstrap bind host port sync channel
void windowSizeRead int windowSize
LOG trace i part if part isMimeType LOG trace i extractAttachmentsFromMultipart Multipart part getContent map else String disposition part getDisposition String fileName FileUtil stripPath part getFileName if LOG isTraceEnabled LOG trace i disposition LOG trace i part getDescription LOG trace i part getContentType LOG trace i fileName LOG trace i part getSize LOG trace i part getLineCount if validDisposition disposition fileName fileName null
try int count folder getMessageCount if count List KeyValueHolder String Message messages retrieveMessages if getEndpoint getConfiguration isPeek for KeyValueHolder String Message entry messages Message message entry getValue peekMessage message polledMessages processBatch CastUtils cast createExchanges messages final MailBoxPostProcessAction postProcessor getEndpoint getPostProcessAction if postProcessor null postProcessor process folder else if count throw new MessagingException folder getFullName catch Exception e
for KeyValueHolder String Message entry messages Message message entry getValue peekMessage message polledMessages processBatch CastUtils cast createExchanges messages final MailBoxPostProcessAction postProcessor getEndpoint getPostProcessAction if postProcessor null postProcessor process folder else if count throw new MessagingException folder getFullName catch Exception e handleException e finally if getEndpoint getConfiguration isCloseFolder getEndpoint getConfiguration isDisconnect if LOG isDebugEnabled LOG debug folder getName getEndpoint getConfiguration getMailStoreLogInformation
postProcessor process folder else if count throw new MessagingException folder getFullName catch Exception e handleException e finally if getEndpoint getConfiguration isCloseFolder getEndpoint getConfiguration isDisconnect if LOG isDebugEnabled LOG debug folder getName getEndpoint getConfiguration getMailStoreLogInformation try if folder isOpen folder close true catch Exception e LOG debug folder getName e boolean disconnect getEndpoint getConfiguration isDisconnect
else if searchTerm null messages folder search searchTerm retrieveAllMessages else messages retrieveAllMessages if sortTerm null MailSorter sortMessages messages sortTerm int maxMessage getMaxNumberOfMessages boolean hasMessageLimit hasMessageLimit maxMessage for Message message messages if hasMessageLimit answer size maxMessage break String key getEndpoint getMailUidGenerator generateUuid getEndpoint message if isValidMessage key message answer add new KeyValueHolder key message
Exchange exchange getEndpoint createExchange message if getEndpoint getConfiguration isMapMailMessage LOG trace i exchange getIn getBody exchange getIn getHeaders try Map String Attachment att new HashMap getEndpoint getBinding extractAttachmentsFromMail message att if att isEmpty exchange getIn AttachmentMessage class setAttachmentObjects att catch MessagingException IOException e throw new RuntimeCamelException e getMessage e exchange setProperty MAIL_MESSAGE_UID key answer add exchange else
exchange getIn getBody exchange getIn getHeaders try Map String Attachment att new HashMap getEndpoint getBinding extractAttachmentsFromMail message att if att isEmpty exchange getIn AttachmentMessage class setAttachmentObjects att catch MessagingException IOException e throw new RuntimeCamelException e getMessage e exchange setProperty MAIL_MESSAGE_UID key answer add exchange else if LOG isDebugEnabled LOG debug MailUtils dumpMessage message catch Exception e
protected void processExchange Exchange exchange throws Exception if LOG isDebugEnabled MailMessage msg MailMessage exchange getIn
if store null store isConnected connected true catch Exception e LOG debug getEndpoint getConfiguration getMailStoreLogInformation e getMessage e if connected store null folder null if LOG isDebugEnabled LOG debug getEndpoint getConfiguration getMailStoreLogInformation store sender getSession getStore config getProtocol PasswordAuthentication passwordAuth config getPasswordAuthentication store connect config getHost config getPort passwordAuth getUserName passwordAuth getPassword serverCanSort hasSortCapability store if folder null if LOG isDebugEnabled
Override public boolean process Exchange exchange AsyncCallback callback JavaMailSender mailSender getSender exchange ClassLoader tccl Thread currentThread getContextClassLoader try ClassLoader applicationClassLoader getEndpoint getCamelContext getApplicationContextClassLoader if applicationClassLoader null Thread currentThread setContextClassLoader applicationClassLoader MimeMessage mimeMessage final Object body exchange getIn getBody if body MimeMessage mimeMessage MimeMessage body else mimeMessage new MimeMessage mailSender getSession getEndpoint getBinding populateMailMessage getEndpoint mimeMessage exchange if LOG isDebugEnabled
String text in getBody String class assertEquals body text Object to in getHeader Iterator String it CastUtils cast ObjectHelper createIterator to int i while it hasNext if i assertEquals it next trim else assertEquals it next trim i Enumeration Header iter CastUtils cast inMessage getAllHeaders while iter hasMoreElements Header header iter nextElement String value message getHeader header getName
private synchronized void onLeadershipLost throws Exception ServiceHelper stopAndShutdownServices delegatedConsumer ServiceHelper stopAndShutdownServices delegatedEndpoint delegatedConsumer null
service setId id service setRoot service setAcquireLockDelay TimeUnit SECONDS service setAcquireLockInterval TimeUnit SECONDS DefaultCamelContext context new DefaultCamelContext context disableJMX context setName id context addService service context addRoutes new RouteBuilder Override public void configure throws Exception from routeId id log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt context start contextLatch await
Override protected Endpoint createEndpoint String uri String remaining Map String Object parameters throws Exception String metricsName getMetricsName remaining MetricsType metricsType getMetricsType remaining
static MetricRegistry getOrCreateMetricRegistry Registry camelRegistry String registryName
static MetricRegistry getOrCreateMetricRegistry Registry camelRegistry String registryName LOG debug registryName MetricRegistry result getMetricRegistryFromCamelRegistry camelRegistry registryName if result null
getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount for int i i i if i template sendBody i else template sendBody i assertMockEndpointsSatisfied assertEquals registry getNames size MetricsMessageHistoryService service context hasService MetricsMessageHistoryService class assertNotNull service String json service dumpStatisticsAsJson assertNotNull json
getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount for int i i i if i template sendBody i else template sendBody i assertMockEndpointsSatisfied assertEquals metricRegistry getNames size Set ObjectName set getMBeanServer queryNames new ObjectName null assertEquals set size String name String format context getManagementName ObjectName on ObjectName getInstance name String json String getMBeanServer invoke on null null assertNotNull json
assertEquals metricRegistry getNames size Set ObjectName set getMBeanServer queryNames new ObjectName null assertEquals set size String name String format context getManagementName ObjectName on ObjectName getInstance name String json String getMBeanServer invoke on null null assertNotNull json log info json assertTrue json contains assertTrue json contains assertTrue json contains getMBeanServer invoke on null null resetMocks getMockEndpoint expectedMessageCount template sendBody
Test public void testMetricsHistory throws Exception getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount for int i i i if i template sendBody i else template sendBody i assertMockEndpointsSatisfied assertEquals registry getNames size MetricsMessageHistoryService service context hasService MetricsMessageHistoryService class assertNotNull service String json service dumpStatisticsAsJson assertNotNull json
getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount for int i i i if i template sendBody i else template sendBody i assertMockEndpointsSatisfied MetricRegistry registry context getRegistry findByType MetricRegistry class iterator next assertEquals registry getNames size MetricsMessageHistoryService service context hasService MetricsMessageHistoryService class assertNotNull service String json service dumpStatisticsAsJson assertNotNull json
Test public void testMetricsRoutePolicy throws Exception getMockEndpoint expectedMessageCount for int i i i if i template sendBody i else template sendBody i assertMockEndpointsSatisfied assertEquals metricRegistry getNames size Set ObjectName set getMBeanServer queryNames new ObjectName null assertEquals set size String name String format context getManagementName ObjectName on ObjectName getInstance name String json String getMBeanServer invoke on null null assertNotNull json
public static MeterRegistry getOrCreateMeterRegistry Registry camelRegistry String registryName
public static MeterRegistry getOrCreateMeterRegistry Registry camelRegistry String registryName LOG debug registryName MeterRegistry result getMeterRegistryFromCamelRegistry camelRegistry registryName if result null
getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount for int i i i if i template sendBody i else template sendBody i assertMockEndpointsSatisfied assertEquals registry getMeters size MicrometerMessageHistoryService service context hasService MicrometerMessageHistoryService class assertNotNull service String json service dumpStatisticsAsJson assertNotNull json
if i template sendBody i else template sendBody i assertMockEndpointsSatisfied assertEquals meterRegistry getMeters size Set ObjectName set getMBeanServer queryNames new ObjectName null assertEquals set size ObjectName fooMBean set stream filter on on getCanonicalName contains findFirst orElseThrow new AssertionError Long testCount Long getMBeanServer getAttribute fooMBean assertEquals count testCount longValue String name String format context getManagementName ObjectName on ObjectName getInstance name String json String getMBeanServer invoke on null null assertNotNull json
template sendBody i else template sendBody i assertMockEndpointsSatisfied assertEquals registry getMeters size Timer fooTimer registry find DEFAULT_CAMEL_MESSAGE_HISTORY_METER_NAME tag NODE_ID_TAG timer assertEquals count fooTimer count Timer barTimer registry find DEFAULT_CAMEL_MESSAGE_HISTORY_METER_NAME tag NODE_ID_TAG timer assertEquals count barTimer count Timer bazTimer registry find DEFAULT_CAMEL_MESSAGE_HISTORY_METER_NAME tag NODE_ID_TAG timer assertEquals count bazTimer count MicrometerMessageHistoryService service context hasService MicrometerMessageHistoryService class assertNotNull service String json service dumpStatisticsAsJson assertNotNull json
else template sendBody i assertMockEndpointsSatisfied MeterRegistry registry context getRegistry findByType MeterRegistry class iterator next assertEquals registry getMeters size Timer fooTimer registry find DEFAULT_CAMEL_MESSAGE_HISTORY_METER_NAME tag NODE_ID_TAG timer assertEquals count fooTimer count Timer barTimer registry find DEFAULT_CAMEL_MESSAGE_HISTORY_METER_NAME tag NODE_ID_TAG timer assertEquals count barTimer count Timer bazTimer registry find DEFAULT_CAMEL_MESSAGE_HISTORY_METER_NAME tag NODE_ID_TAG timer assertEquals count bazTimer count MicrometerMessageHistoryService service context hasService MicrometerMessageHistoryService class assertNotNull service String json service dumpStatisticsAsJson assertNotNull json
Test public void testMetricsRoutePolicy throws Exception int count getMockEndpoint expectedMessageCount count for int i i count i if i template sendBody i else template sendBody i assertMockEndpointsSatisfied List Meter meters meterRegistry getMeters assertEquals meters size String name String format context getManagementName ObjectName on ObjectName getInstance name String json String getMBeanServer invoke on null null assertNotNull json
Test public void testSlowLoop throws Exception for int i i i try
Test public void testSlowLoop throws Exception for int i i i try
private synchronized MiloClientEndpoint doCreateEndpoint final String uri final MiloClientConfiguration configuration final Map String Object parameters throws Exception final MiloClientEndpoint endpoint new MiloClientEndpoint uri this configuration getEndpointUri endpoint setConfiguration configuration setProperties endpoint parameters final String cacheId configuration toCacheId MiloClientConnection connection this cache get cacheId if connection null
private void handleValueUpdate final DataValue value
final Connected connected performConnect LOG debug synchronized this if this disposed return try LOG debug this subscriptions size connected putSubscriptions this subscriptions LOG debug this connected connected final Connected oldConnected this connected this connected connected if oldConnected null LOG debug oldConnected dispose catch final Exception e
return try LOG debug this subscriptions size connected putSubscriptions this subscriptions LOG debug this connected connected final Connected oldConnected this connected this connected connected if oldConnected null LOG debug oldConnected dispose catch final Exception e LOG info e connected dispose throw e catch final Exception e
final URI uri URI create getEndpointDiscoveryUri final String user uri getUserInfo if user null user isEmpty discoveryUri discoveryUri replaceFirst user LOG debug discoveryUri final EndpointDescription endpoint DiscoveryClient getEndpoints discoveryUri thenApply endpoints if LOG isDebugEnabled LOG debug for final EndpointDescription ep endpoints LOG debug ep try return findEndpoint endpoints catch final URISyntaxException e throw new RuntimeException e get
LOG debug discoveryUri final EndpointDescription endpoint DiscoveryClient getEndpoints discoveryUri thenApply endpoints if LOG isDebugEnabled LOG debug for final EndpointDescription ep endpoints LOG debug ep try return findEndpoint endpoints catch final URISyntaxException e throw new RuntimeException e get LOG debug endpoint final List IdentityProvider providers new LinkedList if user null user isEmpty final String creds user split
private synchronized void triggerReconnect final boolean immediate
final String pwd userMap get challenge getUsername if pwd null return false return pwd equals challenge getPassword serverConfig setIdentityValidator identityValidator final List UserTokenPolicy tokenPolicies new LinkedList if allowAnonymous tokenPolicies add OpcUaServerConfig USER_TOKEN_POLICY_ANONYMOUS if userMap isEmpty tokenPolicies add getUsernamePolicy serverConfig setEndpoints createEndpointConfigurations tokenPolicies else serverConfig setEndpoints createEndpointConfigurations null securityPolicies if certificateValidator null
return pwd equals challenge getPassword serverConfig setIdentityValidator identityValidator final List UserTokenPolicy tokenPolicies new LinkedList if allowAnonymous tokenPolicies add OpcUaServerConfig USER_TOKEN_POLICY_ANONYMOUS if userMap isEmpty tokenPolicies add getUsernamePolicy serverConfig setEndpoints createEndpointConfigurations tokenPolicies else serverConfig setEndpoints createEndpointConfigurations null securityPolicies if certificateValidator null LOG debug certificateValidator if certificateValidator Closeable runOnStop
Override protected Variant invoke InvocationContext invocationContext Variant inputValues
protected void setDataValue final DataValue value
Override protected void doStart throws Exception super doStart if configuration isClientMode configuration getProtocol equals connector setHandler new ReceiveHandler ConnectFuture future connector connect address future awaitUninterruptibly session future getSession
if configuration isTextline Charset charset getEncodingParameter type configuration LineDelimiter delimiter getLineDelimiterParameter configuration getTextlineDelimiter MinaTextLineCodecFactory codecFactory new MinaTextLineCodecFactory charset delimiter if configuration getEncoderMaxLineLength codecFactory setEncoderMaxLineLength configuration getEncoderMaxLineLength if configuration getDecoderMaxLineLength codecFactory setDecoderMaxLineLength configuration getDecoderMaxLineLength addCodecFactory service codecFactory if LOG isDebugEnabled LOG debug new Object type codecFactory charset configuration getTextlineDelimiter delimiter LOG debug codecFactory getEncoderMaxLineLength codecFactory getDecoderMaxLineLength else ObjectSerializationCodecFactory codecFactory new ObjectSerializationCodecFactory addCodecFactory service codecFactory
protected void configureDataGramCodecFactory final String type final IoService service final MinaConfiguration configuration ProtocolCodecFactory codecFactory configuration getCodec if codecFactory null codecFactory new MinaUdpProtocolCodecFactory this getEndpoint getCamelContext if LOG isDebugEnabled
private Charset getEncodingParameter String type MinaConfiguration configuration String encoding configuration getEncoding if encoding null encoding Charset defaultCharset name configuration setEncoding encoding
if getEndpoint getConfiguration getCharsetName null exchange setProperty Exchange CHARSET_NAME IOHelper normalizeCharset getEndpoint getConfiguration getCharsetName Object body MinaPayloadHelper getIn getEndpoint exchange if body null noReplyLogger log exchange return if getEndpoint getConfiguration isTextline body getEndpoint getCamelContext getTypeConverter mandatoryConvertTo String class exchange body if sync responseLatch new CountDownLatch handler reset if LOG isDebugEnabled Object out body if body byte out exchange getContext getTypeConverter convertTo String class body
protected void configureDefaultCodecFactory String type IoService service if configuration isTextline Charset charset getEncodingParameter type configuration LineDelimiter delimiter getLineDelimiterParameter configuration getTextlineDelimiter MinaTextLineCodecFactory codecFactory new MinaTextLineCodecFactory charset delimiter if configuration getEncoderMaxLineLength codecFactory setEncoderMaxLineLength configuration getEncoderMaxLineLength if configuration getDecoderMaxLineLength codecFactory setDecoderMaxLineLength configuration getDecoderMaxLineLength addCodecFactory service codecFactory LOG debug type codecFactory charset configuration getTextlineDelimiter delimiter LOG debug codecFactory getEncoderMaxLineLength codecFactory getDecoderMaxLineLength else ObjectSerializationCodecFactory codecFactory new ObjectSerializationCodecFactory addCodecFactory service codecFactory
protected void configureDataGramCodecFactory final String type final IoService service final MinaConfiguration configuration ProtocolCodecFactory codecFactory configuration getCodec if codecFactory null codecFactory new MinaUdpProtocolCodecFactory this getEndpoint getCamelContext if LOG isDebugEnabled
private Charset getEncodingParameter String type MinaConfiguration configuration String encoding configuration getEncoding if encoding null encoding Charset defaultCharset name configuration setEncoding encoding
Override protected RouteBuilder createRouteBuilder return new RouteBuilder Override public void configure String minioEndpoint String minioEndpoint1 from to minioEndpoint from to minioEndpoint1 process exchange InputStream minioPartialObject exchange getIn getBody InputStream class
catch Exception charsetEx LOG warn exchangeCharsetName charsetEx if hasCharsetName try if Charset isSupported charsetName return Charset forName charsetName LOG warn charsetName catch Exception charsetEx LOG warn charsetName charsetEx String msh18 Hl7Util findMsh18 hl7Bytes if msh18 null msh18 isEmpty if MllpProtocolConstants MSH18_VALUES containsKey msh18 return MllpProtocolConstants MSH18_VALUES get msh18 try if Charset isSupported msh18
LOG warn exchangeCharsetName charsetEx if hasCharsetName try if Charset isSupported charsetName return Charset forName charsetName LOG warn charsetName catch Exception charsetEx LOG warn charsetName charsetEx String msh18 Hl7Util findMsh18 hl7Bytes if msh18 null msh18 isEmpty if MllpProtocolConstants MSH18_VALUES containsKey msh18 return MllpProtocolConstants MSH18_VALUES get msh18 try if Charset isSupported msh18 return Charset forName msh18
public void doConnectionClose Socket socket boolean reset Logger log String ignoringCallLogFormat if socket null if log null
if socket isConnected if log null log debug ignoringCallLogFormat reset localSocketAddress remoteSocketAddress else if socket isClosed if log null log debug ignoringCallLogFormat reset localSocketAddress remoteSocketAddress else this updateLastConnectionTerminatedTicks final String ignoringExceptionStringFormat if socket isInputShutdown if log null log trace localSocketAddress remoteSocketAddress try socket shutdownInput catch Exception ioEx
else this updateLastConnectionTerminatedTicks final String ignoringExceptionStringFormat if socket isInputShutdown if log null log trace localSocketAddress remoteSocketAddress try socket shutdownInput catch Exception ioEx if log null log isDebugEnabled String logMessage String format ignoringExceptionStringFormat ioEx getClass getSimpleName localSocketAddress remoteSocketAddress log debug logMessage ioEx if socket isOutputShutdown if log null log trace localSocketAddress remoteSocketAddress
if log null log isDebugEnabled String logMessage String format ignoringExceptionStringFormat ioEx getClass getSimpleName localSocketAddress remoteSocketAddress log debug logMessage ioEx if socket isOutputShutdown if log null log trace localSocketAddress remoteSocketAddress try socket shutdownOutput catch IOException ioEx if log null log isDebugEnabled String logMessage String format ignoringExceptionStringFormat ioEx getClass getSimpleName localSocketAddress remoteSocketAddress log debug logMessage ioEx if reset final boolean on true final int linger
log trace localSocketAddress remoteSocketAddress try socket shutdownOutput catch IOException ioEx if log null log isDebugEnabled String logMessage String format ignoringExceptionStringFormat ioEx getClass getSimpleName localSocketAddress remoteSocketAddress log debug logMessage ioEx if reset final boolean on true final int linger if log null log trace linger localSocketAddress remoteSocketAddress try socket setSoLinger on linger catch IOException ioEx
if cachedRemoteAddress null message setHeader MllpConstants MLLP_REMOTE_ADDRESS cachedRemoteAddress byte hl7MessageBytes null Object messageBody message getBody if messageBody null String exceptionMessage String format exchange getExchangeId socket exchange setException new MllpInvalidMessageException exceptionMessage hl7MessageBytes return else if messageBody byte hl7MessageBytes byte messageBody else if messageBody String String stringBody String messageBody hl7MessageBytes stringBody getBytes getConfiguration getCharset exchange if getConfiguration hasCharsetName exchange setProperty Exchange CHARSET_NAME getConfiguration getCharsetName
Object messageBody message getBody if messageBody null String exceptionMessage String format exchange getExchangeId socket exchange setException new MllpInvalidMessageException exceptionMessage hl7MessageBytes return else if messageBody byte hl7MessageBytes byte messageBody else if messageBody String String stringBody String messageBody hl7MessageBytes stringBody getBytes getConfiguration getCharset exchange if getConfiguration hasCharsetName exchange setProperty Exchange CHARSET_NAME getConfiguration getCharsetName log debug exchange getExchangeId socket try mllpBuffer setEnvelopedMessage hl7MessageBytes
log debug exchange getExchangeId socket try mllpBuffer setEnvelopedMessage hl7MessageBytes mllpBuffer writeTo socket catch MllpSocketException writeEx log debug exchange getExchangeId socket writeEx try checkConnection log trace exchange getExchangeId socket try mllpBuffer writeTo socket catch MllpSocketException retryWriteEx String exceptionMessage String format exchange getExchangeId socket log warn exceptionMessage retryWriteEx exchange setException new MllpWriteException exceptionMessage mllpBuffer toByteArrayAndReset retryWriteEx
catch MllpSocketException writeEx log debug exchange getExchangeId socket writeEx try checkConnection log trace exchange getExchangeId socket try mllpBuffer writeTo socket catch MllpSocketException retryWriteEx String exceptionMessage String format exchange getExchangeId socket log warn exceptionMessage retryWriteEx exchange setException new MllpWriteException exceptionMessage mllpBuffer toByteArrayAndReset retryWriteEx catch IOException reconnectEx String exceptionMessage String format exchange getExchangeId socket log warn exceptionMessage reconnectEx exchange setException new MllpWriteException exceptionMessage mllpBuffer toByteArrayAndReset writeEx
mllpBuffer writeTo socket catch MllpSocketException writeRetryEx String exceptionMessage String format exchange getExchangeId socket log warn exceptionMessage writeRetryEx exchange setException new MllpWriteException exceptionMessage hl7MessageBytes receiveAckEx if exchange getException null log trace exchange getExchangeId socket try mllpBuffer reset mllpBuffer readFrom socket catch MllpSocketException secondReceiveEx String exceptionMessageFormat mllpBuffer isEmpty String exceptionMessage String format exceptionMessageFormat exchange getExchangeId socket log warn exceptionMessage secondReceiveEx exchange setException new MllpAcknowledgementReceiveException exceptionMessage hl7MessageBytes mllpBuffer toByteArrayAndReset receiveAckEx
mllpBuffer readFrom socket catch MllpSocketException secondReceiveEx String exceptionMessageFormat mllpBuffer isEmpty String exceptionMessage String format exceptionMessageFormat exchange getExchangeId socket log warn exceptionMessage secondReceiveEx exchange setException new MllpAcknowledgementReceiveException exceptionMessage hl7MessageBytes mllpBuffer toByteArrayAndReset receiveAckEx catch SocketTimeoutException secondReadTimeoutEx String exceptionMessageFormat mllpBuffer isEmpty String exceptionMessage String format exceptionMessageFormat exchange getExchangeId socket log warn exceptionMessage secondReadTimeoutEx exchange setException new MllpAcknowledgementTimeoutException exceptionMessage hl7MessageBytes mllpBuffer toByteArrayAndReset receiveAckEx mllpBuffer resetSocket socket catch SocketTimeoutException timeoutEx String exceptionMessageFormat mllpBuffer isEmpty String exceptionMessage String format exceptionMessageFormat exchange getExchangeId socket
log warn exceptionMessage secondReadTimeoutEx exchange setException new MllpAcknowledgementTimeoutException exceptionMessage hl7MessageBytes mllpBuffer toByteArrayAndReset receiveAckEx mllpBuffer resetSocket socket catch SocketTimeoutException timeoutEx String exceptionMessageFormat mllpBuffer isEmpty String exceptionMessage String format exceptionMessageFormat exchange getExchangeId socket log warn exceptionMessage timeoutEx exchange setException new MllpAcknowledgementTimeoutException exceptionMessage hl7MessageBytes mllpBuffer toByteArrayAndReset timeoutEx mllpBuffer resetSocket socket if exchange getException null if mllpBuffer hasCompleteEnvelope byte acknowledgementBytes mllpBuffer toMllpPayload log debug exchange getExchangeId socket message setHeader MllpConstants MLLP_ACKNOWLEDGEMENT acknowledgementBytes if acknowledgementBytes null acknowledgementBytes length
Socket newSocket new Socket if getConfiguration hasKeepAlive newSocket setKeepAlive getConfiguration getKeepAlive if getConfiguration hasTcpNoDelay newSocket setTcpNoDelay getConfiguration getTcpNoDelay if getConfiguration hasReceiveBufferSize newSocket setReceiveBufferSize getConfiguration getReceiveBufferSize if getConfiguration hasSendBufferSize newSocket setSendBufferSize getConfiguration getSendBufferSize if getConfiguration hasReuseAddress newSocket setReuseAddress getConfiguration getReuseAddress newSocket setSoLinger false InetSocketAddress socketAddress if null getEndpoint getHostname socketAddress new InetSocketAddress getEndpoint getPort
newSocket setReuseAddress getConfiguration getReuseAddress newSocket setSoLinger false InetSocketAddress socketAddress if null getEndpoint getHostname socketAddress new InetSocketAddress getEndpoint getPort else socketAddress new InetSocketAddress getEndpoint getHostname getEndpoint getPort newSocket connect socketAddress getConfiguration getConnectTimeout log info newSocket getEndpoint updateLastConnectionEstablishedTicks socket newSocket SocketAddress localSocketAddress socket getLocalSocketAddress if localSocketAddress null cachedLocalAddress localSocketAddress toString SocketAddress remoteSocketAddress socket getRemoteSocketAddress
Override public synchronized void run if getConfiguration hasIdleTimeout if null socket socket isClosed socket isConnected if getEndpoint hasLastConnectionActivityTicks long idleTime System currentTimeMillis getEndpoint getLastConnectionActivityTicks if log isDebugEnabled
ManagedOperation description public void closeConnections for TcpSocketConsumerRunnable consumerRunnable consumerRunnables keySet if consumerRunnable null
ManagedOperation description public void resetConnections for TcpSocketConsumerRunnable consumerRunnable consumerRunnables keySet if consumerRunnable null
public void validateConsumer Socket clientSocket MllpSocketBuffer mllpBuffer new MllpSocketBuffer getEndpoint TcpServerConsumerValidationRunnable client new TcpServerConsumerValidationRunnable this clientSocket mllpBuffer try
public void startConsumer Socket clientSocket MllpSocketBuffer mllpBuffer TcpSocketConsumerRunnable client new TcpSocketConsumerRunnable this clientSocket mllpBuffer consumerRunnables put client System currentTimeMillis try
public void processMessage byte hl7MessageBytes TcpSocketConsumerRunnable consumerRunnable long now System currentTimeMillis getEndpoint updateLastConnectionActivityTicks now consumerRunnables put consumerRunnable now
if consumerRunnable hasLocalAddress message setHeader MllpConstants MLLP_LOCAL_ADDRESS consumerRunnable getLocalAddress if consumerRunnable hasRemoteAddress message setHeader MllpConstants MLLP_REMOTE_ADDRESS consumerRunnable getRemoteAddress if getConfiguration isValidatePayload String exceptionMessage Hl7Util generateInvalidPayloadExceptionMessage hl7MessageBytes if exceptionMessage null exchange setException new MllpInvalidMessageException exceptionMessage hl7MessageBytes populateHl7DataHeaders exchange message hl7MessageBytes if getConfiguration isStringPayload if hl7MessageBytes null hl7MessageBytes length message setBody new String hl7MessageBytes getConfiguration getCharset exchange hl7MessageBytes else message setBody String class else
final byte bR final byte fieldSeparator originalHl7MessageBytes for int i i originalHl7MessageBytes length i if MllpProtocolConstants SEGMENT_DELIMITER i if i originalHl7MessageBytes length bM originalHl7MessageBytes i bS originalHl7MessageBytes i bA originalHl7MessageBytes i fieldSeparator originalHl7MessageBytes i if fieldSeparator originalHl7MessageBytes i log warn byte acknowledgmentTypeBytes new byte acknowledgmentTypeBytes originalHl7MessageBytes i acknowledgmentTypeBytes originalHl7MessageBytes i try acknowledgementMessageType new String acknowledgmentTypeBytes ExchangeHelper getCharsetName exchange catch IOException ioEx throw new RuntimeException ioEx if bA acknowledgmentTypeBytes
catch IOException ioEx throw new RuntimeException ioEx if bA acknowledgmentTypeBytes switch acknowledgementMessageBytes case bA case bR case bE break default log warn acknowledgementMessageType String acknowledgementTypeProperty exchange getProperty MllpConstants MLLP_ACKNOWLEDGEMENT_TYPE String class if null acknowledgementTypeProperty acknowledgementTypeProperty equals acknowledgementMessageType log warn acknowledgementMessageType MllpConstants MLLP_ACKNOWLEDGEMENT_TYPE acknowledgementTypeProperty Message message exchange getMessage if acknowledgementMessageType null acknowledgementMessageType isEmpty message setHeader MllpConstants MLLP_ACKNOWLEDGEMENT_TYPE acknowledgementMessageType Charset charset getConfiguration getCharset exchange if consumerRunnable getMllpBuffer hasCompleteEnvelope message setHeader MllpConstants MLLP_ACKNOWLEDGEMENT consumerRunnable getMllpBuffer toMllpPayload
void doSocketClose Socket socket String logMessage boolean reset if socket null socket isConnected socket isClosed if logMessage null logMessage isEmpty
MDC put UnitOfWork MDC_ROUTE_ID route getId log info serverSocket try while running null serverSocket serverSocket isBound serverSocket isClosed Socket socket null try socket serverSocket accept catch SocketTimeoutException timeoutEx log debug continue catch SocketException socketEx if serverSocket isBound try serverSocket close catch Exception ex
socket serverSocket accept catch SocketTimeoutException timeoutEx log debug continue catch SocketException socketEx if serverSocket isBound try serverSocket close catch Exception ex log debug ex continue catch IOException ioEx log error ioEx if serverSocket isBound try
catch Exception ex log debug ex continue catch IOException ioEx log error ioEx if serverSocket isBound try serverSocket close catch Exception ex log debug ex continue if MllpSocketBuffer isConnectionValid socket consumer validateConsumer socket finally log info
serverSocket setReuseAddress consumer getConfiguration getReuseAddress serverSocket setSoTimeout consumer getConfiguration getAcceptTimeout InetSocketAddress socketAddress if null consumer getEndpoint getHostname socketAddress new InetSocketAddress consumer getEndpoint getPort else socketAddress new InetSocketAddress consumer getEndpoint getHostname consumer getEndpoint getPort log debug socketAddress long startTicks System currentTimeMillis do try if consumer getConfiguration hasBacklog serverSocket bind socketAddress consumer getConfiguration getBacklog else serverSocket bind socketAddress
else socketAddress new InetSocketAddress consumer getEndpoint getHostname consumer getEndpoint getPort log debug socketAddress long startTicks System currentTimeMillis do try if consumer getConfiguration hasBacklog serverSocket bind socketAddress consumer getConfiguration getBacklog else serverSocket bind socketAddress consumer startAcceptThread serverSocket catch BindException bindException if System currentTimeMillis startTicks consumer getConfiguration getBindTimeout log error socketAddress consumer getConfiguration getBindTimeout bindException break
do try if consumer getConfiguration hasBacklog serverSocket bind socketAddress consumer getConfiguration getBacklog else serverSocket bind socketAddress consumer startAcceptThread serverSocket catch BindException bindException if System currentTimeMillis startTicks consumer getConfiguration getBindTimeout log error socketAddress consumer getConfiguration getBindTimeout bindException break else log warn socketAddress consumer getConfiguration getBindRetryInterval try Thread sleep consumer getConfiguration getBindRetryInterval
Override public void run String originalThreadName Thread currentThread getName Thread currentThread setName createThreadName clientSocket MDC put UnitOfWork MDC_CAMEL_CONTEXT_ID consumer getEndpoint getCamelContext getName Route route consumer getRoute if route null String routeId route getId if routeId null MDC put UnitOfWork MDC_ROUTE_ID route getId log debug combinedAddress try mllpBuffer readFrom clientSocket Math min consumer getConfiguration getReceiveTimeout consumer getConfiguration getReadTimeout if mllpBuffer hasCompleteEnvelope mllpBuffer hasStartOfBlock consumer startConsumer clientSocket mllpBuffer else if mllpBuffer isEmpty
MDC put UnitOfWork MDC_ROUTE_ID route getId log debug this getClass getSimpleName combinedAddress try byte hl7MessageBytes null if mllpBuffer hasCompleteEnvelope hl7MessageBytes mllpBuffer toMllpPayload mllpBuffer reset consumer processMessage hl7MessageBytes this while running null clientSocket clientSocket isConnected clientSocket isClosed log debug try mllpBuffer readFrom clientSocket if mllpBuffer hasCompleteEnvelope hl7MessageBytes mllpBuffer toMllpPayload if log isDebugEnabled
Test public void testLoopbackWithMultipleMessages throws Exception int messageCount acknowledged expectedMessageCount messageCount for int i i messageCount i
protected void runNthMessageContainingEmbeddedStartOfBlock throws Exception int messageCount expectedCompleteCount messageCount expectedInvalidCount setExpectedCounts for int i i messageCount i String message i messageCount Hl7TestMessageGenerator generateMessage i replaceFirst MllpProtocolConstants START_OF_BLOCK Hl7TestMessageGenerator generateMessage i
Override public void run String threadName Thread currentThread getName
Override public void run String threadName Thread currentThread getName log info threadName id int currentRun started true try while started currentRun runCount Thread sleep SLEEP_MILLIS
if null outputStream throw new MllpJUnitResourceException clientSocket setSoTimeout timout StringBuilder acknowledgement new StringBuilder try int firstByte inputStream read if START_OF_BLOCK firstByte if isConnected if END_OF_STREAM firstByte log warn try clientSocket close catch Exception ex log warn return
Override public void process Exchange exchange throws Exception String message exchange getIn getBody String class if null message String msh message substring message indexOf
Test public void testSocketReadOnClosedConnection throws Exception final Thread acceptThread new Thread Logger log LoggerFactory getLogger Override public void run try Socket echoSocket serverSocket accept
Logger log LoggerFactory getLogger Override public void run try Socket echoSocket serverSocket accept log info echoSocket getInetAddress echoSocket setSoTimeout while echoSocket isConnected echoSocket isClosed StringBuilder responseBuilder new StringBuilder InputStream reader echoSocket getInputStream OutputStream writer echoSocket getOutputStream do int readByte int available try available reader available
echoSocket setSoTimeout while echoSocket isConnected echoSocket isClosed StringBuilder responseBuilder new StringBuilder InputStream reader echoSocket getInputStream OutputStream writer echoSocket getOutputStream do int readByte int available try available reader available log info available readByte reader read log trace readByte switch readByte case if echoSocket isConnected echoSocket isClosed
log info reader available log warn try echoSocket close catch Exception ex log warn ex break case log info byte response responseBuilder toString getBytes responseBuilder setLength writer write response response length writer write break default responseBuilder append char readByte catch SocketTimeoutException timeoutEx
echoSocket close catch Exception ex log warn ex break case log info byte response responseBuilder toString getBytes responseBuilder setLength writer write response response length writer write break default responseBuilder append char readByte catch SocketTimeoutException timeoutEx log info available while echoSocket isConnected echoSocket isClosed catch IOException ioEx
break case log info byte response responseBuilder toString getBytes responseBuilder setLength writer write response response length writer write break default responseBuilder append char readByte catch SocketTimeoutException timeoutEx log info available while echoSocket isConnected echoSocket isClosed catch IOException ioEx log error ioEx finally try
finally try serverSocket close catch IOException ioEx log error ioEx log info acceptThread start clientSocket new Socket clientSocket setSoTimeout clientSocket connect serverSocket getLocalSocketAddress clientSocket setTcpNoDelay true log info byte message getBytes BufferedReader reader
Test public void testAvailableOnClosedConnection throws Exception final Thread acceptThread new Thread Logger log LoggerFactory getLogger Override public void run try Socket echoSocket serverSocket accept
Logger log LoggerFactory getLogger Override public void run try Socket echoSocket serverSocket accept log info echoSocket getInetAddress echoSocket setSoTimeout while echoSocket isConnected echoSocket isClosed StringBuilder responseBuilder new StringBuilder InputStream reader echoSocket getInputStream OutputStream writer echoSocket getOutputStream do int readByte int available try available reader available
echoSocket setSoTimeout while echoSocket isConnected echoSocket isClosed StringBuilder responseBuilder new StringBuilder InputStream reader echoSocket getInputStream OutputStream writer echoSocket getOutputStream do int readByte int available try available reader available log info available readByte reader read log trace readByte switch readByte case if echoSocket isConnected echoSocket isClosed
echoSocket close break case log info byte response responseBuilder toString getBytes responseBuilder setLength writer write response response length writer write break default responseBuilder append char readByte catch SocketTimeoutException timeoutEx log info available while echoSocket isConnected echoSocket isClosed catch IOException ioEx log error ioEx finally
finally try serverSocket close catch IOException ioEx log error ioEx log info acceptThread start clientSocket new Socket clientSocket setSoTimeout clientSocket connect serverSocket getLocalSocketAddress clientSocket setTcpNoDelay true log info byte message getBytes BufferedReader reader
public void assertIsSatisfied long timeoutForEmptyEndpoints throws InterruptedException LOG info this doAssertIsSatisfied timeoutForEmptyEndpoints if assertPeriod Thread sleep assertPeriod
protected void doAssertIsSatisfied long timeoutForEmptyEndpoints throws InterruptedException if expectedCount if timeoutForEmptyEndpoints
reporter process exchange Exchange copy exchange if copyOnExchange copy ExchangeHelper createCopy exchange true performAssertions exchange copy if failFast int index getReceivedCounter for Runnable test tests if test AssertionTask AssertionTask task AssertionTask test try LOG debug index task task assertOnIndex index catch AssertionError e failFastAssertionError e
protected void waitForCompleteLatch long timeout throws InterruptedException long waitTime timeout 10000L timeout
protected void fail Object message if LOG isDebugEnabled List Exchange list getReceivedExchanges int index for Exchange exchange list
else if rightValue null otherDate Date rightValue else otherDate Date leftValue if otherDate null return true Time current new Time currentDate getTime TimeUnit MILLISECONDS Time other new Time otherDate getTime TimeUnit MILLISECONDS long delta Math abs other toMillis current toMillis was delta if timeFrom null long from timeFrom toMillis answer delta from if answer
Override protected void doInit throws Exception mongoConnection CamelContextHelper mandatoryLookup getCamelContext connectionBean MongoClient class
Override public void start super start Document d MongoClients create getConnectionURI getDatabase runCommand new Document new Document
OperationType operationType dbObj getOperationType exchange getIn setHeader MongoDbConstants STREAM_OPERATION_TYPE operationType getValue exchange getIn setHeader MongoDbConstants MONGO_ID documentId if operationType OperationType DELETE exchange getIn setBody new Document MONGO_ID documentId try if log isTraceEnabled log trace exchange dbObj getFullDocument get MONGO_ID consumer getProcessor process exchange catch Exception ignored this resumeToken dbObj getResumeToken catch MongoException e if keepRunning throw e else
public void ensureIndex MongoCollection Document aCollection List Bson dynamicIndex if dynamicIndex null dynamicIndex isEmpty for Bson index dynamicIndex
Override protected void doStart throws Exception if mongoConnection null mongoConnection CamelContextHelper mandatoryLookup getCamelContext connectionBean MongoClient class
Override public void process Exchange exchange throws Exception MongoDbOperation operation endpoint getOperation Object header exchange getIn getHeader OPERATION_HEADER if header null
String dynamicCollection exchange getIn getHeader COLLECTION String class SuppressWarnings List Bson dynamicIndex exchange getIn getHeader COLLECTION_INDEX List class MongoCollection Document dbCol if dynamicDB null dynamicCollection null dbCol endpoint getMongoCollection withWriteConcern endpoint getWriteConcernBean else MongoDatabase db calculateDb exchange if dynamicCollection null dbCol db getCollection endpoint getCollection Document class else dbCol db getCollection dynamicCollection Document class if dynamicIndex null endpoint ensureIndex dbCol endpoint createIndex else endpoint ensureIndex dbCol dynamicIndex
Override protected void doRun try while cursor hasNext keepRunning Document dbObj Document cursor next Exchange exchange endpoint createMongoDbExchange dbObj try if log isTraceEnabled log trace exchange dbObj get MONGO_ID consumer getProcessor process exchange catch Exception e tailTracking setLastVal dbObj catch MongoCursorNotFoundException e if keepRunning log debug e catch IllegalStateException e
Override public Optional MetaData meta Map String Object parameters Map String String textParameters cast parameters
Override public Optional MetaData meta Map String Object parameters Map String String textParameters cast parameters LOGGER debug textParameters ConnectionParamsConfiguration mongoConf new ConnectionParamsConfiguration textParameters ConnectionString connectionString new ConnectionString mongoConf getMongoClientURI JsonNode collectionInfoRoot try MongoClient mongoConnection MongoClients create connectionString Document collectionInfo mongoConnection getDatabase textParameters get listCollections filter Filters eq textParameters get first
Override public Optional MetaData meta Map String Object parameters Map String String textParameters cast parameters LOGGER debug textParameters ConnectionParamsConfiguration mongoConf new ConnectionParamsConfiguration textParameters ConnectionString connectionString new ConnectionString mongoConf getMongoClientURI JsonNode collectionInfoRoot try MongoClient mongoConnection MongoClients create connectionString Document collectionInfo mongoConnection getDatabase textParameters get listCollections filter Filters eq textParameters get first LOGGER debug collectionInfo if collectionInfo null
Override public Optional MetaData meta Map String Object parameters Map String String textParameters cast parameters LOGGER debug textParameters ConnectionParamsConfiguration mongoConf new ConnectionParamsConfiguration textParameters ConnectionString connectionString new ConnectionString mongoConf getMongoClientURI JsonNode collectionInfoRoot try MongoClient mongoConnection MongoClients create connectionString Document collectionInfo mongoConnection getDatabase textParameters get listCollections filter Filters eq textParameters get first LOGGER debug collectionInfo if collectionInfo null LOGGER error textParameters get textParameters get return Optional empty String collectionInfoJson collectionInfo toJson collectionInfoRoot objectMapper readTree collectionInfoJson replace catch IOException e
private void verifyCredentials ResultBuilder builder Map String Object parameters ConnectionParamsConfiguration mongoConf new ConnectionParamsConfiguration cast parameters MongoClientSettings Builder optionsBuilder MongoClientSettings builder optionsBuilder applyToSocketSettings socketBuilder socketBuilder connectTimeout CONNECTION_TIMEOUT TimeUnit MILLISECONDS optionsBuilder applyToConnectionPoolSettings connectionPoolBuilder connectionPoolBuilder maxWaitTime CONNECTION_TIMEOUT TimeUnit MILLISECONDS optionsBuilder applyToClusterSettings clusterBuilder clusterBuilder serverSelectionTimeout CONNECTION_TIMEOUT TimeUnit MILLISECONDS ConnectionString connectionString new ConnectionString mongoConf getMongoClientURI optionsBuilder applyConnectionString connectionString
Override public void start super start Document d MongoClients create getConnectionURI getDatabase runCommand new Document new Document
Override protected void onExchange Exchange exchange throws Exception String path getResourceUri ObjectHelper notNull path if allowTemplateFromHeader String newResourceUri exchange getIn getHeader MvelConstants MVEL_RESOURCE_URI String class if newResourceUri null exchange getIn removeHeader MvelConstants MVEL_RESOURCE_URI
String newResourceUri exchange getIn getHeader MvelConstants MVEL_RESOURCE_URI String class if newResourceUri null exchange getIn removeHeader MvelConstants MVEL_RESOURCE_URI log debug MvelConstants MVEL_RESOURCE_URI newResourceUri MvelEndpoint newEndpoint findOrCreateEndpoint getEndpointUri newResourceUri newEndpoint onExchange exchange return CompiledTemplate compiled ParserContext mvelContext ParserContext create Map String Object variableMap ExchangeHelper createVariableMap exchange isAllowContextMapAll String content null if allowTemplateFromHeader content exchange getIn getHeader MvelConstants MVEL_TEMPLATE String class if content null if log isDebugEnabled
public MvelEndpoint findOrCreateEndpoint String uri String newResourceUri String newUri uri replace getResourceUri newResourceUri
Override public void process Exchange exchange throws Exception SqlSession session ExecutorType executorType endpoint getExecutorType if executorType null session endpoint getSqlSessionFactory openSession else session endpoint getSqlSessionFactory openSession executorType LOG debug session try doProcess exchange session session commit catch Exception e session rollback throw e finally
Override public int processBatch Queue Object exchanges throws Exception final MyBatisEndpoint endpoint getEndpoint int total exchanges size if maxMessagesPerPoll total maxMessagesPerPoll
Override public void notify CamelEvent eventObject throws Exception String message eventObject toString Level level determineLevel eventObject MessagePayload payload new MessagePayload getHostName level getServiceName message if LOG isInfoEnabled
if ObjectHelper isEmpty configuration getHost throw new IllegalArgumentException configuration LOG debug configuration configuration setProtocol channelFactory new HttpServerMultiplexChannelHandler channelFactory init configuration getPort ChannelInitializer Channel pipelineFactory new HttpServerSharedInitializerFactory configuration channelFactory camelContext String port Matcher quoteReplacement configuration getPort String pattern threadPattern pattern pattern replaceFirst port ThreadFactory tf new CamelThreadFactory pattern true bootstrapFactory new HttpServerBootstrapFactory channelFactory false bootstrapFactory init tf configuration pipelineFactory ServiceHelper startService channelFactory if startServer
Override protected void initChannel Channel ch throws Exception ChannelPipeline pipeline ch pipeline SslHandler sslHandler configureClientSSLOnDemand if sslHandler null
Override public void init CamelContext camelContext NettyServerBootstrapConfiguration configuration ChannelInitializer Channel pipelineFactory super init camelContext configuration pipelineFactory this port configuration getPort this bootstrapConfiguration configuration
Override protected void initChannel Channel ch throws Exception ChannelPipeline pipeline ch pipeline SslHandler sslHandler configureServerSSLOnDemand if sslHandler null
else config new NettyHttpConfiguration HeaderFilterStrategy headerFilterStrategy resolveAndRemoveReferenceParameter parameters HeaderFilterStrategy class NettyServerBootstrapConfiguration bootstrapConfiguration resolveAndRemoveReferenceParameter parameters NettyServerBootstrapConfiguration class if bootstrapConfiguration null Map String Object options new HashMap BeanIntrospection beanIntrospection getCamelContext adapt ExtendedCamelContext class getBeanIntrospection if beanIntrospection getProperties bootstrapConfiguration options null false PropertyBindingSupport bindProperties getCamelContext config options NettyHttpSecurityConfiguration securityConfiguration resolveAndRemoveReferenceParameter parameters NettyHttpSecurityConfiguration class Map String Object securityOptions PropertiesHelper extractProperties parameters NettyHttpBinding bindingFromUri resolveAndRemoveReferenceParameter parameters NettyHttpBinding class int sharedPort NettySharedHttpServer shared resolveAndRemoveReferenceParameter parameters NettySharedHttpServer class if shared null
NettyHttpSecurityConfiguration securityConfiguration resolveAndRemoveReferenceParameter parameters NettyHttpSecurityConfiguration class Map String Object securityOptions PropertiesHelper extractProperties parameters NettyHttpBinding bindingFromUri resolveAndRemoveReferenceParameter parameters NettyHttpBinding class int sharedPort NettySharedHttpServer shared resolveAndRemoveReferenceParameter parameters NettySharedHttpServer class if shared null LOG debug shared shared getPort sharedPort shared getPort boolean hasProtocol remaining null remaining startsWith remaining startsWith remaining startsWith remaining startsWith remaining startsWith remaining startsWith if hasProtocol remaining remaining boolean hasSlash remaining startsWith remaining startsWith remaining startsWith if hasSlash if remaining startsWith remaining remaining substring
Override public Consumer createConsumer Processor processor throws Exception NettyHttpConsumer answer new NettyHttpConsumer this processor getConfiguration configureConsumer answer if nettySharedHttpServer null answer setNettyServerBootstrapFactory nettySharedHttpServer getServerBootstrapFactory
Override protected void doInit throws Exception super doInit ObjectHelper notNull nettyHttpBinding this ObjectHelper notNull headerFilterStrategy this if securityConfiguration null StringHelper notEmpty securityConfiguration getRealm securityConfiguration StringHelper notEmpty securityConfiguration getConstraint securityConfiguration if securityConfiguration getSecurityAuthenticator null JAASSecurityAuthenticator jaas new JAASSecurityAuthenticator jaas setName securityConfiguration getRealm
else request InboundStreamHttpRequest msg getHttpRequest LOG debug request DecoderResult decoderResult request decoderResult if decoderResult null decoderResult cause null if getConsumer getConfiguration isLogWarnOnBadRequest LOG warn decoderResult cause getMessage if LOG isDebugEnabled LOG debug decoderResult cause HttpResponse response new DefaultHttpResponse HTTP_1_1 BAD_REQUEST response headers set Exchange CONTENT_TYPE response headers set Exchange CONTENT_LENGTH ctx writeAndFlush response ctx channel close return
String target uri getPath String path consumer getConfiguration getPath if path null target startsWith path path path toLowerCase Locale US String match target toLowerCase Locale US if match startsWith path target target substring path length String roles if security getSecurityConstraint null roles security getSecurityConstraint restricted target else roles if roles null HttpPrincipal principal extractBasicAuthSubject request Subject subject null
if path null target startsWith path path path toLowerCase Locale US String match target toLowerCase Locale US if match startsWith path target target substring path length String roles if security getSecurityConstraint null roles security getSecurityConstraint restricted target else roles if roles null HttpPrincipal principal extractBasicAuthSubject request Subject subject null boolean inRole true if principal null
roles security getSecurityConstraint restricted target else roles if roles null HttpPrincipal principal extractBasicAuthSubject request Subject subject null boolean inRole true if principal null subject authenticate security getSecurityAuthenticator security getLoginDeniedLoggingLevel principal if subject null String userRoles security getSecurityAuthenticator getUserRoles subject inRole matchesRoles roles userRoles if principal null subject null inRole if principal null LOG debug url
protected static HttpPrincipal extractBasicAuthSubject HttpRequest request String auth request headers get if auth null String constraint StringHelper before auth if constraint null if equalsIgnoreCase constraint trim String decoded StringHelper after auth ByteBuf buf NettyConverter toByteBuffer decoded getBytes ByteBuf out Base64 decode buf try String userAndPw out toString Charset defaultCharset String username StringHelper before userAndPw String password StringHelper after userAndPw HttpPrincipal principal new HttpPrincipal username password
Test public void testApi throws Exception String out template requestBody null String class assertNotNull out
Test public void testApi throws Exception String out template requestBody null String class assertNotNull out
protected void startServerBootstrap throws Exception EventLoopGroup wg configuration getWorkerGroup if wg null workerGroup new NettyWorkerPoolBuilder withNativeTransport configuration isNativeTransport withWorkerCount configuration getWorkerCount withName build wg workerGroup clientBootstrap new Bootstrap if configuration isNativeTransport clientBootstrap channel EpollSocketChannel class else clientBootstrap channel NioSocketChannel class clientBootstrap group wg clientBootstrap option ChannelOption SO_KEEPALIVE configuration isKeepAlive clientBootstrap option ChannelOption TCP_NODELAY configuration isTcpNoDelay clientBootstrap option ChannelOption SO_REUSEADDR configuration isReuseAddress clientBootstrap option ChannelOption CONNECT_TIMEOUT_MILLIS configuration getConnectTimeout
clientBootstrap new Bootstrap if configuration isNativeTransport clientBootstrap channel EpollSocketChannel class else clientBootstrap channel NioSocketChannel class clientBootstrap group wg clientBootstrap option ChannelOption SO_KEEPALIVE configuration isKeepAlive clientBootstrap option ChannelOption TCP_NODELAY configuration isTcpNoDelay clientBootstrap option ChannelOption SO_REUSEADDR configuration isReuseAddress clientBootstrap option ChannelOption CONNECT_TIMEOUT_MILLIS configuration getConnectTimeout LOG debug clientBootstrap clientBootstrap handler pipelineFactory ChannelFuture channelFuture clientBootstrap connect new InetSocketAddress configuration getHost configuration getPort if LOG isDebugEnabled LOG debug new Object configuration getHost configuration getPort clientBootstrap
protected Channel openChannel final ChannelFuture channelFuture throws Exception if LOG isTraceEnabled LOG trace channelFuture configuration getConnectTimeout channelFuture awaitUninterruptibly if channelFuture isDone channelFuture isSuccess if configuration isReconnect scheduleReconnect channelFuture return null else ConnectException cause new ConnectException configuration getAddress if channelFuture cause null cause initCause channelFuture cause throw cause Channel answer channelFuture channel if LOG isDebugEnabled
Override protected void initChannel Channel ch throws Exception ChannelPipeline channelPipeline ch pipeline SslHandler sslHandler configureClientSSLOnDemand if sslHandler null
Override protected void initChannel Channel ch throws Exception ChannelPipeline channelPipeline ch pipeline SslHandler sslHandler configureServerSSLOnDemand if sslHandler null
Override protected void doStart throws Exception if configuration isUsingExecutorService executorService null int netty SystemPropertyUtil getInt NettyRuntime availableProcessors int threads Math max maximumPoolSize netty executorService NettyHelper createExecutorGroup getCamelContext threads
ServerInitializerFactory pipelineFactory ServerInitializerFactory factory configuration getServerInitializerFactory if factory null pipelineFactory factory createPipelineFactory this else pipelineFactory new DefaultServerInitializerFactory this if isTcp if configuration isClientMode nettyServerBootstrapFactory new ClientModeTCPNettyServerBootstrapFactory else nettyServerBootstrapFactory new SingleTCPNettyServerBootstrapFactory else nettyServerBootstrapFactory new SingleUDPNettyServerBootstrapFactory nettyServerBootstrapFactory init context configuration pipelineFactory ServiceHelper startService nettyServerBootstrapFactory
Override protected void doStop throws Exception LOG debug configuration getAddress ServiceHelper stopService nettyServerBootstrapFactory
public static void writeBodyAsync Logger log Channel channel SocketAddress remoteAddress Object body Exchange exchange ChannelFutureListener listener ChannelFuture future if remoteAddress null if log isDebugEnabled
Override protected void doStart throws Exception if configuration isProducerPoolEnabled GenericObjectPool Config config new GenericObjectPool Config config maxActive configuration getProducerPoolMaxActive config minIdle configuration getProducerPoolMinIdle config maxIdle configuration getProducerPoolMaxIdle config testOnBorrow true config testWhileIdle true config timeBetweenEvictionRunsMillis 1000L config minEvictableIdleTimeMillis configuration getProducerPoolMinEvictableIdle config whenExhaustedAction GenericObjectPool WHEN_EXHAUSTED_FAIL pool new GenericObjectPool new NettyProducerPoolableObjectFactory this config if LOG isDebugEnabled
GenericObjectPool Config config new GenericObjectPool Config config maxActive configuration getProducerPoolMaxActive config minIdle configuration getProducerPoolMinIdle config maxIdle configuration getProducerPoolMaxIdle config testOnBorrow true config testWhileIdle true config timeBetweenEvictionRunsMillis 1000L config minEvictableIdleTimeMillis configuration getProducerPoolMinEvictableIdle config whenExhaustedAction GenericObjectPool WHEN_EXHAUSTED_FAIL pool new GenericObjectPool new NettyProducerPoolableObjectFactory this config if LOG isDebugEnabled LOG debug config maxActive config minIdle config maxIdle config minEvictableIdleTimeMillis pool else pool new SharedSingletonObjectPool new NettyProducerPoolableObjectFactory this if LOG isDebugEnabled
ChannelFuture answer if isTcp Bootstrap clientBootstrap new Bootstrap if configuration isNativeTransport clientBootstrap channel EpollSocketChannel class else clientBootstrap channel NioSocketChannel class clientBootstrap group getWorkerGroup clientBootstrap option ChannelOption SO_KEEPALIVE configuration isKeepAlive clientBootstrap option ChannelOption TCP_NODELAY configuration isTcpNoDelay clientBootstrap option ChannelOption SO_REUSEADDR configuration isReuseAddress clientBootstrap option ChannelOption CONNECT_TIMEOUT_MILLIS configuration getConnectTimeout clientBootstrap handler pipelineFactory answer clientBootstrap connect new InetSocketAddress configuration getHost configuration getPort if LOG isDebugEnabled
else Bootstrap connectionlessClientBootstrap new Bootstrap if configuration isNativeTransport connectionlessClientBootstrap channel EpollDatagramChannel class else connectionlessClientBootstrap channel NioDatagramChannel class connectionlessClientBootstrap group getWorkerGroup connectionlessClientBootstrap option ChannelOption CONNECT_TIMEOUT_MILLIS configuration getConnectTimeout connectionlessClientBootstrap option ChannelOption SO_BROADCAST configuration isBroadcast connectionlessClientBootstrap option ChannelOption SO_SNDBUF configuration getSendBufferSize connectionlessClientBootstrap option ChannelOption SO_RCVBUF configuration getReceiveBufferSize connectionlessClientBootstrap handler pipelineFactory if configuration isUdpConnectionlessSending answer connectionlessClientBootstrap connect new InetSocketAddress configuration getHost configuration getPort else
Override public synchronized T borrowObject throws Exception NoSuchElementException IllegalStateException if t null if factory validateObject t invalidateObject t
serverBootstrap childOption ChannelOption SO_KEEPALIVE configuration isKeepAlive serverBootstrap childOption ChannelOption TCP_NODELAY configuration isTcpNoDelay serverBootstrap option ChannelOption SO_REUSEADDR configuration isReuseAddress serverBootstrap childOption ChannelOption SO_REUSEADDR configuration isReuseAddress serverBootstrap childOption ChannelOption CONNECT_TIMEOUT_MILLIS configuration getConnectTimeout if configuration getBacklog serverBootstrap option ChannelOption SO_BACKLOG configuration getBacklog Map String Object options configuration getOptions if options null for Map Entry String Object entry options entrySet String value entry getValue toString ChannelOption Object option ChannelOption valueOf entry getKey if EndpointHelper isReferenceParameter value String name value substring Object o CamelContextHelper mandatoryLookup camelContext name
serverBootstrap childOption ChannelOption TCP_NODELAY configuration isTcpNoDelay serverBootstrap option ChannelOption SO_REUSEADDR configuration isReuseAddress serverBootstrap childOption ChannelOption SO_REUSEADDR configuration isReuseAddress serverBootstrap childOption ChannelOption CONNECT_TIMEOUT_MILLIS configuration getConnectTimeout if configuration getBacklog serverBootstrap option ChannelOption SO_BACKLOG configuration getBacklog Map String Object options configuration getOptions if options null for Map Entry String Object entry options entrySet String value entry getValue toString ChannelOption Object option ChannelOption valueOf entry getKey if EndpointHelper isReferenceParameter value String name value substring Object o CamelContextHelper mandatoryLookup camelContext name serverBootstrap option option o
bootstrap option ChannelOption SO_BROADCAST configuration isBroadcast bootstrap option ChannelOption CONNECT_TIMEOUT_MILLIS configuration getConnectTimeout if configuration getReceiveBufferSizePredictor bootstrap option ChannelOption RCVBUF_ALLOCATOR new FixedRecvByteBufAllocator configuration getReceiveBufferSizePredictor if configuration getBacklog bootstrap option ChannelOption SO_BACKLOG configuration getBacklog Map String Object options configuration getOptions if options null for Map Entry String Object entry options entrySet String value entry getValue toString ChannelOption Object option ChannelOption valueOf entry getKey if EndpointHelper isReferenceParameter value String name value substring Object o CamelContextHelper mandatoryLookup camelContext name bootstrap option option o
for Map Entry String Object entry options entrySet String value entry getValue toString ChannelOption Object option ChannelOption valueOf entry getKey if EndpointHelper isReferenceParameter value String name value substring Object o CamelContextHelper mandatoryLookup camelContext name bootstrap option option o else bootstrap option option value LOG debug bootstrap bootstrap handler pipelineFactory InetSocketAddress hostAddress new InetSocketAddress configuration getHost configuration getPort SubnetUtils multicastSubnet new SubnetUtils MULTICAST_SUBNET if multicastSubnet getInfo isInRange configuration getHost ChannelFuture channelFuture bootstrap bind configuration getPort sync
String name value substring Object o CamelContextHelper mandatoryLookup camelContext name bootstrap option option o else bootstrap option option value LOG debug bootstrap bootstrap handler pipelineFactory InetSocketAddress hostAddress new InetSocketAddress configuration getHost configuration getPort SubnetUtils multicastSubnet new SubnetUtils MULTICAST_SUBNET if multicastSubnet getInfo isInRange configuration getHost ChannelFuture channelFuture bootstrap bind configuration getPort sync channel channelFuture channel DatagramChannel datagramChannel DatagramChannel channel String networkInterface configuration getNetworkInterface null LOOPBACK_INTERFACE configuration getNetworkInterface multicastNetworkInterface NetworkInterface getByName networkInterface
Override public void channelInactive ChannelHandlerContext ctx throws Exception if LOG isTraceEnabled LOG trace ctx channel NettyCamelState state getState ctx null Exchange exchange state null state getExchange null AsyncCallback callback state null state getCallback null producer getCorrelationManager removeState ctx ctx channel producer getAllChannels remove ctx channel if exchange null boolean doneUoW exchange getUnitOfWork null NettyConfiguration configuration producer getConfiguration if configuration isSync doneUoW messageReceived exceptionHandled exceptionHandled true String address configuration getAddress if LOG isDebugEnabled
protected Message getResponseMessage Exchange exchange ChannelHandlerContext ctx Object message throws Exception Object body message if LOG isDebugEnabled
Override protected void channelRead0 ChannelHandlerContext ctx Object msg throws Exception Object in msg if LOG isDebugEnabled
private void doSendMessages int files int poolSize throws Exception StopWatch watch new StopWatch NotifyBuilder notify new NotifyBuilder context whenDone files create ExecutorService executor Executors newFixedThreadPool poolSize Map Integer Future String responses new HashMap for int i i files i final int index i Future String out executor submit new Callable String public String call throws Exception String reply template requestBody index String class
StopWatch watch new StopWatch NotifyBuilder notify new NotifyBuilder context whenDone files create ExecutorService executor Executors newFixedThreadPool poolSize Map Integer Future String responses new HashMap for int i i files i final int index i Future String out executor submit new Callable String public String call throws Exception String reply template requestBody index String class LOG debug index reply assertEquals index reply return reply responses put index out notify matches TimeUnit SECONDS
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure throws Exception from id process new Processor public void process final Exchange exchange
new Thread new Runnable Override public void run try acceptReplyAcceptClose acceptReplyAcceptClose catch IOException e LOG error e getMessage e start String response1 template requestBody PORT String class LOG info response1 try template requestBody PORT String class catch Exception e assertStringContains e getCause getMessage String response2 template requestBody PORT String class
Test public void testSSLInOutWithNettyConsumer throws Exception assumeFalse isJavaVendor context addRoutes new RouteBuilder public void configure from process new Processor public void process Exchange exchange throws Exception SSLSession session exchange getIn getHeader NettyConstants NETTY_SSL_SESSION SSLSession class if session null javax security cert X509Certificate cert session getPeerCertificateChain Principal principal cert getSubjectDN
Override protected RouteBuilder createRouteBuilder return new RouteBuilder public void configure from process new Processor public void process Exchange exchange throws Exception String s exchange getIn getBody String class
Test public void testSharedThreadPool throws Exception int delta Thread activeCount before
byte data1 new byte byte data2 new byte Arrays fill data1 byte 0x38 Arrays fill data2 byte 0x39 byte body1 new String LENGTH_HEADER new String data1 getBytes byte body2 new String LENGTH_HEADER new String data2 getBytes MockEndpoint mock getMockEndpoint mock expectedBodiesReceived new String data2 Socket client1 getSocket port Socket client2 getSocket port try sendBuffer body2 client2 sendBuffer body1 client1 sendBuffer new String getBytes client2 catch Exception e
byte sPort1 new byte byte sPort2 new byte Arrays fill sPort1 byte 0x38 Arrays fill sPort2 byte 0x39 byte bodyPort1 new String LENGTH_HEADER new String sPort1 getBytes byte bodyPort2 new String LENGTH_HEADER new String sPort2 getBytes MockEndpoint mock getMockEndpoint mock expectedBodiesReceived new String sPort2 Socket server1 getSocket port1 Socket server2 getSocket port2 try sendSopBuffer bodyPort2 server2 sendSopBuffer bodyPort1 server1 sendSopBuffer new String getBytes server2 catch Exception e
Override public void process Exchange exchange throws Exception String topic exchange getIn getHeader NsqConstants NSQ_MESSAGE_TOPIC configuration getTopic String class
if identifier null builder addParameter identifier if token null builder addParameter token else if metadataPrefix null builder addParameter metadataPrefix if set null builder addParameter set if from null builder addParameter from if until null builder addParameter until HttpGet httpget new HttpGet builder build RequestLine requestLine httpget getRequestLine
https addCustomizer new SecureRequestCustomizer SslContextFactory sslContextFactory new SslContextFactory sslContextFactory setKeyStorePath JettyTestServer class getResource toExternalForm sslContextFactory setKeyStorePassword PASSWORD sslContextFactory setKeyManagerPassword PASSWORD ServerConnector sslConnector new ServerConnector server new SslConnectionFactory sslContextFactory new HttpConnectionFactory https sslConnector setPort PORT_SSL server setConnectors new Connector connector sslConnector ServletContextHandler servletContext new ServletContextHandler ServletContextHandler SESSIONS servletContext setContextPath server setHandler servletContext servletContext addServlet new ServletHolder new MyHttpServlet this context try server start catch Exception ex
exchange getOut setHeaders exchange getIn getHeaders exchange getOut setHeader Olingo2Constants PROPERTY_PREFIX RESPONSE_HTTP_HEADERS responseHeaders interceptResult response exchange callback done false Override public void onException Exception ex exchange setException ex callback done false Override public void onCanceled exchange setException new RuntimeCamelException callback done false final ApiMethod method findMethod exchange properties if method null callback done true return true
Test public void testServiceDocument throws Exception final TestOlingo2ResponseHandler ServiceDocument responseHandler new TestOlingo2ResponseHandler olingoApp read null null null responseHandler final ServiceDocument serviceDocument responseHandler await final List Collection collections serviceDocument getAtomInfo getWorkspaces get getCollections assertEquals collections size
Test public void testServiceDocument throws Exception final TestOlingo2ResponseHandler ServiceDocument responseHandler new TestOlingo2ResponseHandler olingoApp read null null null responseHandler final ServiceDocument serviceDocument responseHandler await final List Collection collections serviceDocument getAtomInfo getWorkspaces get getCollections assertEquals collections size LOG info collections final List EdmEntitySetInfo entitySetsInfo serviceDocument getEntitySetsInfo assertEquals entitySetsInfo size
Test public void testReadFeed throws Exception final TestOlingo2ResponseHandler ODataFeed responseHandler new TestOlingo2ResponseHandler olingoApp read edm MANUFACTURERS null null responseHandler final ODataFeed dataFeed responseHandler await assertNotNull dataFeed
Test public void testReadUnparsedFeed throws Exception final TestOlingo2ResponseHandler InputStream responseHandler new TestOlingo2ResponseHandler olingoApp uread edm MANUFACTURERS null null responseHandler final InputStream rawfeed responseHandler await assertNotNull rawfeed final ODataFeed dataFeed EntityProvider readFeed TEST_FORMAT_STRING edmEntitySetMap get MANUFACTURERS rawfeed EntityProviderReadProperties init build
Test public void testReadEntry throws Exception final TestOlingo2ResponseHandler ODataEntry responseHandler new TestOlingo2ResponseHandler olingoApp read edm TEST_MANUFACTURER null null responseHandler ODataEntry entry responseHandler await
Test public void testReadEntry throws Exception final TestOlingo2ResponseHandler ODataEntry responseHandler new TestOlingo2ResponseHandler olingoApp read edm TEST_MANUFACTURER null null responseHandler ODataEntry entry responseHandler await LOG info prettyPrint entry responseHandler reset olingoApp read edm TEST_CAR null null responseHandler entry responseHandler await
Test public void testReadEntry throws Exception final TestOlingo2ResponseHandler ODataEntry responseHandler new TestOlingo2ResponseHandler olingoApp read edm TEST_MANUFACTURER null null responseHandler ODataEntry entry responseHandler await LOG info prettyPrint entry responseHandler reset olingoApp read edm TEST_CAR null null responseHandler entry responseHandler await LOG info prettyPrint entry responseHandler reset final Map String String queryParams new HashMap queryParams put SystemQueryOption $expand toString CARS olingoApp read edm TEST_MANUFACTURER queryParams null responseHandler ODataEntry entryExpanded responseHandler await
Test public void testReadUnparsedEntry throws Exception final TestOlingo2ResponseHandler InputStream responseHandler new TestOlingo2ResponseHandler olingoApp uread edm TEST_MANUFACTURER null null responseHandler InputStream rawentry responseHandler await ODataEntry entry EntityProvider readEntry TEST_FORMAT_STRING edmEntitySetMap get MANUFACTURERS rawentry EntityProviderReadProperties init build
Test public void testReadUnparsedEntry throws Exception final TestOlingo2ResponseHandler InputStream responseHandler new TestOlingo2ResponseHandler olingoApp uread edm TEST_MANUFACTURER null null responseHandler InputStream rawentry responseHandler await ODataEntry entry EntityProvider readEntry TEST_FORMAT_STRING edmEntitySetMap get MANUFACTURERS rawentry EntityProviderReadProperties init build LOG info prettyPrint entry responseHandler reset olingoApp uread edm TEST_CAR null null responseHandler rawentry responseHandler await entry EntityProvider readEntry TEST_FORMAT_STRING edmEntitySetMap get CARS rawentry EntityProviderReadProperties init build
olingoApp uread edm TEST_MANUFACTURER null null responseHandler InputStream rawentry responseHandler await ODataEntry entry EntityProvider readEntry TEST_FORMAT_STRING edmEntitySetMap get MANUFACTURERS rawentry EntityProviderReadProperties init build LOG info prettyPrint entry responseHandler reset olingoApp uread edm TEST_CAR null null responseHandler rawentry responseHandler await entry EntityProvider readEntry TEST_FORMAT_STRING edmEntitySetMap get CARS rawentry EntityProviderReadProperties init build LOG info prettyPrint entry responseHandler reset final Map String String queryParams new HashMap queryParams put SystemQueryOption $expand toString CARS olingoApp uread edm TEST_MANUFACTURER queryParams null responseHandler rawentry responseHandler await ODataEntry entryExpanded EntityProvider readEntry TEST_FORMAT_STRING edmEntitySetMap get MANUFACTURERS rawentry EntityProviderReadProperties init build
Test public void testReadUpdateProperties throws Exception final TestOlingo2ResponseHandler Map String Object propertyHandler new TestOlingo2ResponseHandler olingoApp read edm TEST_MANUFACTURER_FOUNDED_PROPERTY null null propertyHandler Calendar founded Calendar propertyHandler await get FOUNDED_PROPERTY
Test public void testReadUpdateProperties throws Exception final TestOlingo2ResponseHandler Map String Object propertyHandler new TestOlingo2ResponseHandler olingoApp read edm TEST_MANUFACTURER_FOUNDED_PROPERTY null null propertyHandler Calendar founded Calendar propertyHandler await get FOUNDED_PROPERTY LOG info founded final TestOlingo2ResponseHandler Calendar valueHandler new TestOlingo2ResponseHandler olingoApp read edm TEST_MANUFACTURER_FOUNDED_VALUE null null valueHandler founded valueHandler await
final TestOlingo2ResponseHandler Calendar valueHandler new TestOlingo2ResponseHandler olingoApp read edm TEST_MANUFACTURER_FOUNDED_VALUE null null valueHandler founded valueHandler await LOG info founded final TestOlingo2ResponseHandler HttpStatusCodes statusHandler new TestOlingo2ResponseHandler final HashMap String Object properties new HashMap properties put FOUNDED_PROPERTY new Date olingoApp update edm TEST_MANUFACTURER_FOUNDED_PROPERTY null new Date statusHandler LOG info statusHandler await getStatusCode statusHandler reset olingoApp update edm TEST_MANUFACTURER_FOUNDED_VALUE null new Date statusHandler LOG info statusHandler await getStatusCode propertyHandler reset olingoApp read edm TEST_MANUFACTURER_ADDRESS_PROPERTY null null propertyHandler final Map String Object address propertyHandler await
Test public void testReadDeleteCreateLinks throws Exception final TestOlingo2ResponseHandler List String linksHandler new TestOlingo2ResponseHandler olingoApp read edm TEST_MANUFACTURER_LINKS_CARS null null linksHandler final List String links linksHandler await assertFalse links isEmpty
Test public void testReadDeleteCreateLinks throws Exception final TestOlingo2ResponseHandler List String linksHandler new TestOlingo2ResponseHandler olingoApp read edm TEST_MANUFACTURER_LINKS_CARS null null linksHandler final List String links linksHandler await assertFalse links isEmpty LOG info links final TestOlingo2ResponseHandler String linkHandler new TestOlingo2ResponseHandler olingoApp read edm TEST_CAR_LINK_MANUFACTURER null null linkHandler final String link linkHandler await
Test public void testReadCount throws Exception final TestOlingo2ResponseHandler Long countHandler new TestOlingo2ResponseHandler olingoApp read edm MANUFACTURERS COUNT_OPTION null null countHandler
Test public void testReadCount throws Exception final TestOlingo2ResponseHandler Long countHandler new TestOlingo2ResponseHandler olingoApp read edm MANUFACTURERS COUNT_OPTION null null countHandler LOG info countHandler await countHandler reset olingoApp read edm TEST_MANUFACTURER COUNT_OPTION null null countHandler
Test public void testReadCount throws Exception final TestOlingo2ResponseHandler Long countHandler new TestOlingo2ResponseHandler olingoApp read edm MANUFACTURERS COUNT_OPTION null null countHandler LOG info countHandler await countHandler reset olingoApp read edm TEST_MANUFACTURER COUNT_OPTION null null countHandler LOG info countHandler await countHandler reset olingoApp read edm TEST_MANUFACTURER_LINKS_CARS COUNT_OPTION null null countHandler
Test public void testReadCount throws Exception final TestOlingo2ResponseHandler Long countHandler new TestOlingo2ResponseHandler olingoApp read edm MANUFACTURERS COUNT_OPTION null null countHandler LOG info countHandler await countHandler reset olingoApp read edm TEST_MANUFACTURER COUNT_OPTION null null countHandler LOG info countHandler await countHandler reset olingoApp read edm TEST_MANUFACTURER_LINKS_CARS COUNT_OPTION null null countHandler LOG info countHandler await countHandler reset olingoApp read edm TEST_CAR_LINK_MANUFACTURER COUNT_OPTION null null countHandler
Test public void testCreateUpdateDeleteEntry throws Exception final TestOlingo2ResponseHandler ODataEntry entryHandler new TestOlingo2ResponseHandler olingoApp create edm MANUFACTURERS null getEntityData entryHandler ODataEntry createdEntry entryHandler await
LOG info prettyPrint createdEntry Map String Object data getEntityData SuppressWarnings Map String Object address Map String Object data get ADDRESS data put address put final TestOlingo2ResponseHandler HttpStatusCodes statusHandler new TestOlingo2ResponseHandler olingoApp update edm TEST_CREATE_MANUFACTURER null data statusHandler statusHandler await statusHandler reset data put olingoApp patch edm TEST_CREATE_MANUFACTURER null data statusHandler statusHandler await entryHandler reset olingoApp read edm TEST_CREATE_MANUFACTURER null null entryHandler ODataEntry updatedEntry entryHandler await
address put final TestOlingo2ResponseHandler HttpStatusCodes statusHandler new TestOlingo2ResponseHandler olingoApp update edm TEST_CREATE_MANUFACTURER null data statusHandler statusHandler await statusHandler reset data put olingoApp patch edm TEST_CREATE_MANUFACTURER null data statusHandler statusHandler await entryHandler reset olingoApp read edm TEST_CREATE_MANUFACTURER null null entryHandler ODataEntry updatedEntry entryHandler await LOG info prettyPrint updatedEntry statusHandler reset olingoApp delete TEST_CREATE_MANUFACTURER null statusHandler HttpStatusCodes statusCode statusHandler await
entryHandler reset olingoApp read edm TEST_CREATE_MANUFACTURER null null entryHandler ODataEntry updatedEntry entryHandler await LOG info prettyPrint updatedEntry statusHandler reset olingoApp delete TEST_CREATE_MANUFACTURER null statusHandler HttpStatusCodes statusCode statusHandler await LOG info statusCode getStatusCode statusCode getInfo try LOG info entryHandler reset olingoApp read edm TEST_CREATE_MANUFACTURER null null entryHandler entryHandler await fail catch Exception e
batchParts add Olingo2BatchChangeRequest resourcePath MANUFACTURERS contentId TEST_RESOURCE_CONTENT_ID operation Operation CREATE body data build final Map String Object updateData new HashMap data SuppressWarnings Map String Object address Map String Object updateData get ADDRESS updateData put address put batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE operation Operation UPDATE body updateData build batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE operation Operation DELETE build final TestOlingo2ResponseHandler List Olingo2BatchResponse responseHandler new TestOlingo2ResponseHandler batchParts add Olingo2BatchQueryRequest resourcePath TEST_CREATE_MANUFACTURER build olingoApp batch edm null batchParts responseHandler final List Olingo2BatchResponse responseParts responseHandler await TimeUnit MINUTES assertEquals responseParts size assertNotNull responseParts get getBody final ODataFeed feed ODataFeed responseParts get getBody assertNotNull feed
updateData put address put batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE operation Operation UPDATE body updateData build batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE operation Operation DELETE build final TestOlingo2ResponseHandler List Olingo2BatchResponse responseHandler new TestOlingo2ResponseHandler batchParts add Olingo2BatchQueryRequest resourcePath TEST_CREATE_MANUFACTURER build olingoApp batch edm null batchParts responseHandler final List Olingo2BatchResponse responseParts responseHandler await TimeUnit MINUTES assertEquals responseParts size assertNotNull responseParts get getBody final ODataFeed feed ODataFeed responseParts get getBody assertNotNull feed LOG info prettyPrint feed ODataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry
batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE operation Operation DELETE build final TestOlingo2ResponseHandler List Olingo2BatchResponse responseHandler new TestOlingo2ResponseHandler batchParts add Olingo2BatchQueryRequest resourcePath TEST_CREATE_MANUFACTURER build olingoApp batch edm null batchParts responseHandler final List Olingo2BatchResponse responseParts responseHandler await TimeUnit MINUTES assertEquals responseParts size assertNotNull responseParts get getBody final ODataFeed feed ODataFeed responseParts get getBody assertNotNull feed LOG info prettyPrint feed ODataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info prettyPrint dataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry
olingoApp batch edm null batchParts responseHandler final List Olingo2BatchResponse responseParts responseHandler await TimeUnit MINUTES assertEquals responseParts size assertNotNull responseParts get getBody final ODataFeed feed ODataFeed responseParts get getBody assertNotNull feed LOG info prettyPrint feed ODataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info prettyPrint dataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info prettyPrint dataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry
LOG info prettyPrint feed ODataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info prettyPrint dataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info prettyPrint dataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info prettyPrint dataEntry assertEquals HttpStatusCodes NO_CONTENT getStatusCode responseParts get getStatusCode assertEquals HttpStatusCodes NO_CONTENT getStatusCode responseParts get getStatusCode assertEquals HttpStatusCodes NOT_FOUND getStatusCode responseParts get getStatusCode final Exception exception Exception responseParts get getBody assertNotNull exception
Test public void testRead throws Exception final Map String Object headers new HashMap final ServiceDocument document requestBodyAndHeaders null headers assertNotNull document assertFalse document getEntitySetsInfo isEmpty LOG info document getEntitySetsInfo size final HashMap String String queryParams new HashMap queryParams put SystemQueryOption $top name headers put queryParams final ODataFeed manufacturers requestBodyAndHeaders null headers assertNotNull manufacturers final List ODataEntry manufacturersEntries manufacturers getEntries assertFalse manufacturersEntries isEmpty
LOG info document getEntitySetsInfo size final HashMap String String queryParams new HashMap queryParams put SystemQueryOption $top name headers put queryParams final ODataFeed manufacturers requestBodyAndHeaders null headers assertNotNull manufacturers final List ODataEntry manufacturersEntries manufacturers getEntries assertFalse manufacturersEntries isEmpty LOG info manufacturersEntries size headers clear headers put Olingo2Constants PROPERTY_PREFIX final ODataEntry manufacturer requestBodyAndHeaders null headers assertNotNull manufacturer final Map String Object properties manufacturer getProperties assertEquals properties get ID_PROPERTY
Test public void testCreateUpdateDelete throws Exception final Map String Object data getEntityData Map String Object address final ODataEntry manufacturer requestBody data assertNotNull manufacturer final Map String Object properties manufacturer getProperties assertEquals TEST_CREATE_MANUFACTURER_ID properties get ID_PROPERTY
Test public void testCreateUpdateDelete throws Exception final Map String Object data getEntityData Map String Object address final ODataEntry manufacturer requestBody data assertNotNull manufacturer final Map String Object properties manufacturer getProperties assertEquals TEST_CREATE_MANUFACTURER_ID properties get ID_PROPERTY LOG info properties data put address Map String Object data get address put HttpStatusCodes status requestBody data assertNotNull status assertEquals HttpStatusCodes NO_CONTENT getStatusCode status getStatusCode
LOG info properties data put address Map String Object data get address put HttpStatusCodes status requestBody data assertNotNull status assertEquals HttpStatusCodes NO_CONTENT getStatusCode status getStatusCode LOG info status final Map String Object headers new HashMap headers put Olingo2Constants PROPERTY_PREFIX String format TEST_CREATE_MANUFACTURER_ID final ODataEntry updatedManufacturer requestBodyAndHeaders null headers assertNotNull updatedManufacturer final Map String Object updatedProperties updatedManufacturer getProperties assertEquals TEST_CREATE_MANUFACTURER_ID updatedProperties get ID_PROPERTY assertEquals updatedProperties get
HttpStatusCodes status requestBody data assertNotNull status assertEquals HttpStatusCodes NO_CONTENT getStatusCode status getStatusCode LOG info status final Map String Object headers new HashMap headers put Olingo2Constants PROPERTY_PREFIX String format TEST_CREATE_MANUFACTURER_ID final ODataEntry updatedManufacturer requestBodyAndHeaders null headers assertNotNull updatedManufacturer final Map String Object updatedProperties updatedManufacturer getProperties assertEquals TEST_CREATE_MANUFACTURER_ID updatedProperties get ID_PROPERTY assertEquals updatedProperties get LOG info updatedProperties status requestBody null assertNotNull status assertEquals HttpStatusCodes NO_CONTENT getStatusCode status getStatusCode
Test public void testCreateMerge throws Exception final Map String Object data getEntityData data put ID_PROPERTY TEST_MERGE_MANUFACTURER_ID final ODataEntry manufacturer requestBody data assertNotNull manufacturer final Map String Object properties manufacturer getProperties assertEquals TEST_MERGE_MANUFACTURER_ID properties get ID_PROPERTY
Test public void testCreateMerge throws Exception final Map String Object data getEntityData data put ID_PROPERTY TEST_MERGE_MANUFACTURER_ID final ODataEntry manufacturer requestBody data assertNotNull manufacturer final Map String Object properties manufacturer getProperties assertEquals TEST_MERGE_MANUFACTURER_ID properties get ID_PROPERTY LOG info properties final Map String Object propertiesToUpdate new HashMap propertiesToUpdate put ID_PROPERTY TEST_MERGE_MANUFACTURER_ID propertiesToUpdate put HttpStatusCodes status requestBody propertiesToUpdate assertNotNull status assertEquals HttpStatusCodes NO_CONTENT getStatusCode status getStatusCode
final Map String Object propertiesToUpdate new HashMap propertiesToUpdate put ID_PROPERTY TEST_MERGE_MANUFACTURER_ID propertiesToUpdate put HttpStatusCodes status requestBody propertiesToUpdate assertNotNull status assertEquals HttpStatusCodes NO_CONTENT getStatusCode status getStatusCode LOG info status final Map String Object headers new HashMap headers put Olingo2Constants PROPERTY_PREFIX String format TEST_MERGE_MANUFACTURER_ID final ODataEntry mergedManufacturer requestBodyAndHeaders null headers assertNotNull mergedManufacturer final Map String Object mergedProperties mergedManufacturer getProperties assertEquals TEST_MERGE_MANUFACTURER_ID mergedProperties get ID_PROPERTY assertEquals mergedProperties get assertNotNull mergedProperties get
final Map String Object data getEntityData batchParts add Olingo2BatchChangeRequest resourcePath MANUFACTURERS contentId TEST_RESOURCE_CONTENT_ID operation Operation CREATE body data build final Map String Object updateData new HashMap data Map String Object address Map String Object updateData get ADDRESS address put batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE_ADDRESS operation Operation UPDATE body address build updateData put batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE operation Operation UPDATE body updateData build batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE operation Operation DELETE build batchParts add Olingo2BatchQueryRequest resourcePath TEST_CREATE_MANUFACTURER build final List Olingo2BatchResponse responseParts requestBody batchParts assertNotNull responseParts assertEquals responseParts size final Edm edm Edm responseParts get getBody assertNotNull edm
Map String Object address Map String Object updateData get ADDRESS address put batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE_ADDRESS operation Operation UPDATE body address build updateData put batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE operation Operation UPDATE body updateData build batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE operation Operation DELETE build batchParts add Olingo2BatchQueryRequest resourcePath TEST_CREATE_MANUFACTURER build final List Olingo2BatchResponse responseParts requestBody batchParts assertNotNull responseParts assertEquals responseParts size final Edm edm Edm responseParts get getBody assertNotNull edm LOG info edm getEntitySets final ODataFeed feed ODataFeed responseParts get getBody assertNotNull feed
updateData put batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE operation Operation UPDATE body updateData build batchParts add Olingo2BatchChangeRequest resourcePath TEST_RESOURCE operation Operation DELETE build batchParts add Olingo2BatchQueryRequest resourcePath TEST_CREATE_MANUFACTURER build final List Olingo2BatchResponse responseParts requestBody batchParts assertNotNull responseParts assertEquals responseParts size final Edm edm Edm responseParts get getBody assertNotNull edm LOG info edm getEntitySets final ODataFeed feed ODataFeed responseParts get getBody assertNotNull feed LOG info feed getEntries ODataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry
batchParts add Olingo2BatchQueryRequest resourcePath TEST_CREATE_MANUFACTURER build final List Olingo2BatchResponse responseParts requestBody batchParts assertNotNull responseParts assertEquals responseParts size final Edm edm Edm responseParts get getBody assertNotNull edm LOG info edm getEntitySets final ODataFeed feed ODataFeed responseParts get getBody assertNotNull feed LOG info feed getEntries ODataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info dataEntry getProperties dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry
assertEquals responseParts size final Edm edm Edm responseParts get getBody assertNotNull edm LOG info edm getEntitySets final ODataFeed feed ODataFeed responseParts get getBody assertNotNull feed LOG info feed getEntries ODataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info dataEntry getProperties dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info dataEntry getProperties dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry
LOG info edm getEntitySets final ODataFeed feed ODataFeed responseParts get getBody assertNotNull feed LOG info feed getEntries ODataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info dataEntry getProperties dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info dataEntry getProperties dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info dataEntry getProperties int statusCode responseParts get getStatusCode assertEquals HttpStatusCodes NO_CONTENT getStatusCode statusCode
LOG info feed getEntries ODataEntry dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info dataEntry getProperties dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info dataEntry getProperties dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info dataEntry getProperties int statusCode responseParts get getStatusCode assertEquals HttpStatusCodes NO_CONTENT getStatusCode statusCode LOG info statusCode statusCode responseParts get getStatusCode assertEquals HttpStatusCodes NO_CONTENT getStatusCode statusCode
LOG info dataEntry getProperties dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info dataEntry getProperties dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info dataEntry getProperties int statusCode responseParts get getStatusCode assertEquals HttpStatusCodes NO_CONTENT getStatusCode statusCode LOG info statusCode statusCode responseParts get getStatusCode assertEquals HttpStatusCodes NO_CONTENT getStatusCode statusCode LOG info statusCode statusCode responseParts get getStatusCode assertEquals HttpStatusCodes NO_CONTENT getStatusCode statusCode
dataEntry ODataEntry responseParts get getBody assertNotNull dataEntry LOG info dataEntry getProperties int statusCode responseParts get getStatusCode assertEquals HttpStatusCodes NO_CONTENT getStatusCode statusCode LOG info statusCode statusCode responseParts get getStatusCode assertEquals HttpStatusCodes NO_CONTENT getStatusCode statusCode LOG info statusCode statusCode responseParts get getStatusCode assertEquals HttpStatusCodes NO_CONTENT getStatusCode statusCode LOG info statusCode assertEquals HttpStatusCodes NOT_FOUND getStatusCode responseParts get getStatusCode final Exception exception Exception responseParts get getBody assertNotNull exception
Test public void testServiceDocument throws Exception final TestOlingo4ResponseHandler ClientServiceDocument responseHandler new TestOlingo4ResponseHandler olingoApp read null null null responseHandler final ClientServiceDocument serviceDocument responseHandler await final Map String URI entitySets serviceDocument getEntitySets assertEquals entitySets size
Test public void testReadEntitySet throws Exception final TestOlingo4ResponseHandler ClientEntitySet responseHandler new TestOlingo4ResponseHandler olingoApp read edm PEOPLE null null responseHandler final ClientEntitySet entitySet responseHandler await assertNotNull entitySet assertEquals entitySet getEntities size
Test public void testReadUnparsedEntitySet throws Exception final TestOlingo4ResponseHandler InputStream responseHandler new TestOlingo4ResponseHandler olingoApp uread edm PEOPLE null null responseHandler final InputStream rawEntitySet responseHandler await assertNotNull rawEntitySet final ClientEntitySet entitySet reader readEntitySet rawEntitySet TEST_FORMAT assertEquals entitySet getEntities size
Test public void testReadEntity throws Exception final TestOlingo4ResponseHandler ClientEntity responseHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRLINE null null responseHandler ClientEntity entity responseHandler await assertEquals entity getProperty getValue toString
Test public void testReadEntity throws Exception final TestOlingo4ResponseHandler ClientEntity responseHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRLINE null null responseHandler ClientEntity entity responseHandler await assertEquals entity getProperty getValue toString LOG info prettyPrint entity responseHandler reset olingoApp read edm TEST_PEOPLE null null responseHandler entity responseHandler await assertEquals entity getProperty getValue toString
final TestOlingo4ResponseHandler ClientEntity responseHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRLINE null null responseHandler ClientEntity entity responseHandler await assertEquals entity getProperty getValue toString LOG info prettyPrint entity responseHandler reset olingoApp read edm TEST_PEOPLE null null responseHandler entity responseHandler await assertEquals entity getProperty getValue toString LOG info prettyPrint entity responseHandler reset final Map String String queryParams new HashMap queryParams put SystemQueryOptionKind EXPAND toString TRIPS olingoApp read edm TEST_PEOPLE queryParams null responseHandler ClientEntity entityExpanded responseHandler await
Test public void testReadUnparsedEntity throws Exception final TestOlingo4ResponseHandler InputStream responseHandler new TestOlingo4ResponseHandler olingoApp uread edm TEST_AIRLINE null null responseHandler InputStream rawEntity responseHandler await assertNotNull rawEntity ClientEntity entity reader readEntity rawEntity TEST_FORMAT assertEquals entity getProperty getValue toString
Test public void testReadUnparsedEntity throws Exception final TestOlingo4ResponseHandler InputStream responseHandler new TestOlingo4ResponseHandler olingoApp uread edm TEST_AIRLINE null null responseHandler InputStream rawEntity responseHandler await assertNotNull rawEntity ClientEntity entity reader readEntity rawEntity TEST_FORMAT assertEquals entity getProperty getValue toString LOG info prettyPrint entity responseHandler reset olingoApp uread edm TEST_PEOPLE null null responseHandler rawEntity responseHandler await entity reader readEntity rawEntity TEST_FORMAT assertEquals entity getProperty getValue toString
ClientEntity entity reader readEntity rawEntity TEST_FORMAT assertEquals entity getProperty getValue toString LOG info prettyPrint entity responseHandler reset olingoApp uread edm TEST_PEOPLE null null responseHandler rawEntity responseHandler await entity reader readEntity rawEntity TEST_FORMAT assertEquals entity getProperty getValue toString LOG info prettyPrint entity responseHandler reset final Map String String queryParams new HashMap queryParams put SystemQueryOptionKind EXPAND toString TRIPS olingoApp uread edm TEST_PEOPLE queryParams null responseHandler rawEntity responseHandler await entity reader readEntity rawEntity TEST_FORMAT
Test public void testReadUpdateProperties throws Exception final TestOlingo4ResponseHandler ClientPrimitiveValue propertyHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRPORTS_SIMPLE_PROPERTY null null propertyHandler ClientPrimitiveValue name propertyHandler await assertEquals name toString
Test public void testReadUpdateProperties throws Exception final TestOlingo4ResponseHandler ClientPrimitiveValue propertyHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRPORTS_SIMPLE_PROPERTY null null propertyHandler ClientPrimitiveValue name propertyHandler await assertEquals name toString LOG info name asPrimitive final TestOlingo4ResponseHandler ClientPrimitiveValue valueHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRPORTS_SIMPLE_PROPERTY_VALUE null null valueHandler ClientPrimitiveValue nameValue valueHandler await assertEquals name toString
olingoApp read edm TEST_AIRPORTS_SIMPLE_PROPERTY null null propertyHandler ClientPrimitiveValue name propertyHandler await assertEquals name toString LOG info name asPrimitive final TestOlingo4ResponseHandler ClientPrimitiveValue valueHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRPORTS_SIMPLE_PROPERTY_VALUE null null valueHandler ClientPrimitiveValue nameValue valueHandler await assertEquals name toString LOG info nameValue TestOlingo4ResponseHandler HttpStatusCode statusHandler new TestOlingo4ResponseHandler ClientEntity clientEntity objFactory newEntity null clientEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString olingoApp update edm TEST_PEOPLE null clientEntity statusHandler HttpStatusCode statusCode statusHandler await assertEquals HttpStatusCode NO_CONTENT statusCode
olingoApp read edm TEST_AIRPORTS_SIMPLE_PROPERTY_VALUE null null valueHandler ClientPrimitiveValue nameValue valueHandler await assertEquals name toString LOG info nameValue TestOlingo4ResponseHandler HttpStatusCode statusHandler new TestOlingo4ResponseHandler ClientEntity clientEntity objFactory newEntity null clientEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString olingoApp update edm TEST_PEOPLE null clientEntity statusHandler HttpStatusCode statusCode statusHandler await assertEquals HttpStatusCode NO_CONTENT statusCode LOG info statusCode getStatusCode final TestOlingo4ResponseHandler ClientEntity responseHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_PEOPLE null null responseHandler ClientEntity entity responseHandler await assertEquals entity getProperty getValue toString
Test public void testReadCount throws Exception final TestOlingo4ResponseHandler Long countHandler new TestOlingo4ResponseHandler olingoApp read edm PEOPLE COUNT_OPTION null null countHandler Long count countHandler await assertEquals count intValue
Test public void testDeleteOptimisticConcurrency throws Exception final TestOlingo4ResponseHandler ClientEntity entityHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRLINE_TO_DELETE null null entityHandler ClientEntity airline entityHandler await assertNotNull airline assertNotNull airline getETag TestOlingo4ResponseHandler HttpStatusCode statusHandler new TestOlingo4ResponseHandler olingoApp delete TEST_AIRLINE_TO_DELETE null statusHandler HttpStatusCode statusCode statusHandler await assertEquals HttpStatusCode NO_CONTENT statusCode
Test public void testDeleteOptimisticConcurrency throws Exception final TestOlingo4ResponseHandler ClientEntity entityHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRLINE_TO_DELETE null null entityHandler ClientEntity airline entityHandler await assertNotNull airline assertNotNull airline getETag TestOlingo4ResponseHandler HttpStatusCode statusHandler new TestOlingo4ResponseHandler olingoApp delete TEST_AIRLINE_TO_DELETE null statusHandler HttpStatusCode statusCode statusHandler await assertEquals HttpStatusCode NO_CONTENT statusCode LOG info TEST_AIRLINE_TO_DELETE final TestOlingo4ResponseHandler HttpStatusCode responseHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRLINE_TO_DELETE null null responseHandler statusCode statusHandler await assertEquals HttpStatusCode NO_CONTENT statusCode
Test public void testPatchOptimisticConcurrency throws Exception final TestOlingo4ResponseHandler ClientEntity entityHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRLINE_TO_UPDATE null null entityHandler ClientEntity airline entityHandler await assertNotNull airline assertNotNull airline getETag TestOlingo4ResponseHandler HttpStatusCode statusHandler new TestOlingo4ResponseHandler ClientEntity clientEntity objFactory newEntity null String newAirlineName clientEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString newAirlineName olingoApp patch edm TEST_AIRLINE_TO_UPDATE null clientEntity statusHandler HttpStatusCode statusCode statusHandler await assertEquals HttpStatusCode NO_CONTENT statusCode
ClientEntity airline entityHandler await assertNotNull airline assertNotNull airline getETag TestOlingo4ResponseHandler HttpStatusCode statusHandler new TestOlingo4ResponseHandler ClientEntity clientEntity objFactory newEntity null String newAirlineName clientEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString newAirlineName olingoApp patch edm TEST_AIRLINE_TO_UPDATE null clientEntity statusHandler HttpStatusCode statusCode statusHandler await assertEquals HttpStatusCode NO_CONTENT statusCode LOG info statusCode getStatusCode final TestOlingo4ResponseHandler ClientEntity responseHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRLINE_TO_UPDATE null null responseHandler ClientEntity entity responseHandler await assertEquals newAirlineName entity getProperty getValue toString
Test public void testUpdateOptimisticConcurrency throws Exception final TestOlingo4ResponseHandler ClientEntity entityHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRLINE_TO_UPDATE null null entityHandler ClientEntity airline entityHandler await assertNotNull airline assertNotNull airline getETag TestOlingo4ResponseHandler HttpStatusCode statusHandler new TestOlingo4ResponseHandler ClientEntity clientEntity objFactory newEntity null String newAirlineName clientEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString newAirlineName olingoApp update edm TEST_AIRLINE_TO_UPDATE null clientEntity statusHandler HttpStatusCode statusCode statusHandler await assertEquals HttpStatusCode NO_CONTENT statusCode
ClientEntity airline entityHandler await assertNotNull airline assertNotNull airline getETag TestOlingo4ResponseHandler HttpStatusCode statusHandler new TestOlingo4ResponseHandler ClientEntity clientEntity objFactory newEntity null String newAirlineName clientEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString newAirlineName olingoApp update edm TEST_AIRLINE_TO_UPDATE null clientEntity statusHandler HttpStatusCode statusCode statusHandler await assertEquals HttpStatusCode NO_CONTENT statusCode LOG info statusCode getStatusCode final TestOlingo4ResponseHandler ClientEntity responseHandler new TestOlingo4ResponseHandler olingoApp read edm TEST_AIRLINE_TO_UPDATE null null responseHandler ClientEntity entity responseHandler await assertEquals newAirlineName entity getProperty getValue toString
Test public void testCreateUpdateDeleteEntity throws Exception final TestOlingo4ResponseHandler ClientEntity entryHandler new TestOlingo4ResponseHandler olingoApp create edm PEOPLE null createEntity entryHandler ClientEntity createdEntity entryHandler await
ClientEntity createdEntity entryHandler await LOG info prettyPrint createdEntity final TestOlingo4ResponseHandler HttpStatusCode statusHandler new TestOlingo4ResponseHandler ClientEntity updateEntity createEntity updateEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString olingoApp update edm TEST_CREATE_PEOPLE null updateEntity statusHandler statusHandler await statusHandler reset updateEntity createEntity updateEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString olingoApp patch edm TEST_CREATE_PEOPLE null updateEntity statusHandler statusHandler await entryHandler reset olingoApp read edm TEST_CREATE_PEOPLE null null entryHandler ClientEntity updatedEntity entryHandler await
updateEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString olingoApp update edm TEST_CREATE_PEOPLE null updateEntity statusHandler statusHandler await statusHandler reset updateEntity createEntity updateEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString olingoApp patch edm TEST_CREATE_PEOPLE null updateEntity statusHandler statusHandler await entryHandler reset olingoApp read edm TEST_CREATE_PEOPLE null null entryHandler ClientEntity updatedEntity entryHandler await LOG info prettyPrint updatedEntity statusHandler reset olingoApp delete TEST_CREATE_PEOPLE null statusHandler HttpStatusCode statusCode statusHandler await
entryHandler reset olingoApp read edm TEST_CREATE_PEOPLE null null entryHandler ClientEntity updatedEntity entryHandler await LOG info prettyPrint updatedEntity statusHandler reset olingoApp delete TEST_CREATE_PEOPLE null statusHandler HttpStatusCode statusCode statusHandler await LOG info statusCode getStatusCode statusCode getInfo try LOG info entryHandler reset olingoApp read edm TEST_CREATE_PEOPLE null null entryHandler entryHandler await fail catch Exception e
queryParams put SystemQueryOptionKind EXPAND toString TRIPS batchParts add Olingo4BatchQueryRequest resourcePath TEST_PEOPLE queryParams queryParams resourceUri TEST_SERVICE_BASE_URL build final ClientEntity clientEntity createEntity batchParts add Olingo4BatchChangeRequest resourcePath PEOPLE resourceUri TEST_SERVICE_BASE_URL contentId TEST_CREATE_RESOURCE_CONTENT_ID operation Operation CREATE body clientEntity build clientEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString batchParts add Olingo4BatchChangeRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL contentId TEST_UPDATE_RESOURCE_CONTENT_ID operation Operation UPDATE body clientEntity build batchParts add Olingo4BatchChangeRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL operation Operation DELETE build batchParts add Olingo4BatchQueryRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL build final TestOlingo4ResponseHandler List Olingo4BatchResponse responseHandler new TestOlingo4ResponseHandler olingoApp batch edm null batchParts responseHandler final List Olingo4BatchResponse responseParts responseHandler await TimeUnit MINUTES assertEquals responseParts size assertNotNull responseParts get getBody final ClientEntitySet clientEntitySet ClientEntitySet responseParts get getBody assertNotNull clientEntitySet
batchParts add Olingo4BatchChangeRequest resourcePath PEOPLE resourceUri TEST_SERVICE_BASE_URL contentId TEST_CREATE_RESOURCE_CONTENT_ID operation Operation CREATE body clientEntity build clientEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString batchParts add Olingo4BatchChangeRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL contentId TEST_UPDATE_RESOURCE_CONTENT_ID operation Operation UPDATE body clientEntity build batchParts add Olingo4BatchChangeRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL operation Operation DELETE build batchParts add Olingo4BatchQueryRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL build final TestOlingo4ResponseHandler List Olingo4BatchResponse responseHandler new TestOlingo4ResponseHandler olingoApp batch edm null batchParts responseHandler final List Olingo4BatchResponse responseParts responseHandler await TimeUnit MINUTES assertEquals responseParts size assertNotNull responseParts get getBody final ClientEntitySet clientEntitySet ClientEntitySet responseParts get getBody assertNotNull clientEntitySet LOG info prettyPrint clientEntitySet ClientEntity returnClientEntity ClientEntity responseParts get getBody assertNotNull returnClientEntity
batchParts add Olingo4BatchChangeRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL operation Operation DELETE build batchParts add Olingo4BatchQueryRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL build final TestOlingo4ResponseHandler List Olingo4BatchResponse responseHandler new TestOlingo4ResponseHandler olingoApp batch edm null batchParts responseHandler final List Olingo4BatchResponse responseParts responseHandler await TimeUnit MINUTES assertEquals responseParts size assertNotNull responseParts get getBody final ClientEntitySet clientEntitySet ClientEntitySet responseParts get getBody assertNotNull clientEntitySet LOG info prettyPrint clientEntitySet ClientEntity returnClientEntity ClientEntity responseParts get getBody assertNotNull returnClientEntity LOG info prettyPrint returnClientEntity returnClientEntity ClientEntity responseParts get getBody assertNotNull returnClientEntity
final List Olingo4BatchResponse responseParts responseHandler await TimeUnit MINUTES assertEquals responseParts size assertNotNull responseParts get getBody final ClientEntitySet clientEntitySet ClientEntitySet responseParts get getBody assertNotNull clientEntitySet LOG info prettyPrint clientEntitySet ClientEntity returnClientEntity ClientEntity responseParts get getBody assertNotNull returnClientEntity LOG info prettyPrint returnClientEntity returnClientEntity ClientEntity responseParts get getBody assertNotNull returnClientEntity LOG info prettyPrint returnClientEntity ClientEntity createdClientEntity ClientEntity responseParts get getBody assertNotNull createdClientEntity assertEquals TEST_CREATE_RESOURCE_CONTENT_ID responseParts get getContentId
exchange getOut setHeaders exchange getIn getHeaders exchange getOut setHeader Olingo4Constants PROPERTY_PREFIX Olingo4Constants RESPONSE_HTTP_HEADERS responseHeaders interceptResult response exchange callback done false Override public void onException Exception ex exchange setException ex callback done false Override public void onCanceled exchange setException new RuntimeCamelException callback done false final ApiMethod method findMethod exchange properties if method null callback done true return true
Test public void testRead throws Exception final Map String Object headers new HashMap final Edm metadata Edm requestBodyAndHeaders null headers assertNotNull metadata assertEquals metadata getSchemas size final ClientServiceDocument document ClientServiceDocument requestBodyAndHeaders null headers assertNotNull document assertTrue document getEntitySets size LOG info document getEntitySets size final ClientEntitySet entities ClientEntitySet requestBodyAndHeaders null headers assertNotNull entities assertEquals entities getEntities size final Long count Long requestBodyAndHeaders null headers assertEquals count intValue final ClientPrimitiveValue value ClientPrimitiveValue requestBodyAndHeaders null headers
Test public void testCreateUpdateDelete throws Exception final ClientEntity clientEntity createEntity ClientEntity entity requestBody clientEntity assertNotNull entity assertEquals entity getProperty getValue toString assertEquals entity getProperty getValue toString clientEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString HttpStatusCode status requestBody clientEntity assertNotNull status assertEquals HttpStatusCode NO_CONTENT getStatusCode status getStatusCode
Test public void testCreateUpdateDelete throws Exception final ClientEntity clientEntity createEntity ClientEntity entity requestBody clientEntity assertNotNull entity assertEquals entity getProperty getValue toString assertEquals entity getProperty getValue toString clientEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString HttpStatusCode status requestBody clientEntity assertNotNull status assertEquals HttpStatusCode NO_CONTENT getStatusCode status getStatusCode LOG info status status requestBody null assertNotNull status assertEquals HttpStatusCode NO_CONTENT getStatusCode status getStatusCode
Test public void testCreateUpdateDeleteFromJson throws Exception ClientEntity entity requestBody TEST_CREATE_JSON assertNotNull entity assertEquals entity getProperty getValue toString assertEquals entity getProperty getValue toString assertEquals entity getProperty getValue toString assertEquals entity getProperty getValue toString HttpStatusCode status requestBody TEST_UPDATE_JSON assertNotNull status assertEquals HttpStatusCode NO_CONTENT getStatusCode status getStatusCode
Test public void testCreateUpdateDeleteFromJson throws Exception ClientEntity entity requestBody TEST_CREATE_JSON assertNotNull entity assertEquals entity getProperty getValue toString assertEquals entity getProperty getValue toString assertEquals entity getProperty getValue toString assertEquals entity getProperty getValue toString HttpStatusCode status requestBody TEST_UPDATE_JSON assertNotNull status assertEquals HttpStatusCode NO_CONTENT getStatusCode status getStatusCode LOG info status status requestBody null assertNotNull status assertEquals HttpStatusCode NO_CONTENT getStatusCode status getStatusCode
batchParts add Olingo4BatchQueryRequest resourcePath PEOPLE resourceUri TEST_SERVICE_BASE_URL queryParams queryParams build ClientEntity clientEntity createEntity batchParts add Olingo4BatchChangeRequest resourcePath PEOPLE resourceUri TEST_SERVICE_BASE_URL contentId TEST_CREATE_RESOURCE_CONTENT_ID operation Operation CREATE body clientEntity build clientEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString batchParts add Olingo4BatchChangeRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL contentId TEST_UPDATE_RESOURCE_CONTENT_ID operation Operation UPDATE body clientEntity build batchParts add Olingo4BatchChangeRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL operation Operation DELETE build batchParts add Olingo4BatchQueryRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL build final List Olingo4BatchResponse responseParts requestBody batchParts assertNotNull responseParts assertEquals responseParts size final Edm edm Edm responseParts get getBody assertNotNull edm LOG info edm getEntityContainer getEntitySets ClientEntitySet entitySet ClientEntitySet responseParts get getBody assertNotNull entitySet
clientEntity getProperties add objFactory newPrimitiveProperty objFactory newPrimitiveValueBuilder buildString batchParts add Olingo4BatchChangeRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL contentId TEST_UPDATE_RESOURCE_CONTENT_ID operation Operation UPDATE body clientEntity build batchParts add Olingo4BatchChangeRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL operation Operation DELETE build batchParts add Olingo4BatchQueryRequest resourcePath TEST_CREATE_PEOPLE resourceUri TEST_SERVICE_BASE_URL build final List Olingo4BatchResponse responseParts requestBody batchParts assertNotNull responseParts assertEquals responseParts size final Edm edm Edm responseParts get getBody assertNotNull edm LOG info edm getEntityContainer getEntitySets ClientEntitySet entitySet ClientEntitySet responseParts get getBody assertNotNull entitySet LOG info entitySet getEntities clientEntity ClientEntity responseParts get getBody assertNotNull clientEntity
final List Olingo4BatchResponse responseParts requestBody batchParts assertNotNull responseParts assertEquals responseParts size final Edm edm Edm responseParts get getBody assertNotNull edm LOG info edm getEntityContainer getEntitySets ClientEntitySet entitySet ClientEntitySet responseParts get getBody assertNotNull entitySet LOG info entitySet getEntities clientEntity ClientEntity responseParts get getBody assertNotNull clientEntity LOG info clientEntity getProperties ClientEntitySet entitySetWithTop ClientEntitySet responseParts get getBody assertNotNull entitySetWithTop assertEquals entitySetWithTop getEntities size
final Edm edm Edm responseParts get getBody assertNotNull edm LOG info edm getEntityContainer getEntitySets ClientEntitySet entitySet ClientEntitySet responseParts get getBody assertNotNull entitySet LOG info entitySet getEntities clientEntity ClientEntity responseParts get getBody assertNotNull clientEntity LOG info clientEntity getProperties ClientEntitySet entitySetWithTop ClientEntitySet responseParts get getBody assertNotNull entitySetWithTop assertEquals entitySetWithTop getEntities size LOG info entitySet getEntities clientEntity ClientEntity responseParts get getBody assertNotNull clientEntity
ClientEntitySet entitySet ClientEntitySet responseParts get getBody assertNotNull entitySet LOG info entitySet getEntities clientEntity ClientEntity responseParts get getBody assertNotNull clientEntity LOG info clientEntity getProperties ClientEntitySet entitySetWithTop ClientEntitySet responseParts get getBody assertNotNull entitySetWithTop assertEquals entitySetWithTop getEntities size LOG info entitySet getEntities clientEntity ClientEntity responseParts get getBody assertNotNull clientEntity LOG info clientEntity getProperties int statusCode responseParts get getStatusCode assertEquals HttpStatusCode NO_CONTENT getStatusCode statusCode
clientEntity ClientEntity responseParts get getBody assertNotNull clientEntity LOG info clientEntity getProperties ClientEntitySet entitySetWithTop ClientEntitySet responseParts get getBody assertNotNull entitySetWithTop assertEquals entitySetWithTop getEntities size LOG info entitySet getEntities clientEntity ClientEntity responseParts get getBody assertNotNull clientEntity LOG info clientEntity getProperties int statusCode responseParts get getStatusCode assertEquals HttpStatusCode NO_CONTENT getStatusCode statusCode LOG info statusCode statusCode responseParts get getStatusCode assertEquals HttpStatusCode NO_CONTENT getStatusCode statusCode
assertNotNull entitySetWithTop assertEquals entitySetWithTop getEntities size LOG info entitySet getEntities clientEntity ClientEntity responseParts get getBody assertNotNull clientEntity LOG info clientEntity getProperties int statusCode responseParts get getStatusCode assertEquals HttpStatusCode NO_CONTENT getStatusCode statusCode LOG info statusCode statusCode responseParts get getStatusCode assertEquals HttpStatusCode NO_CONTENT getStatusCode statusCode LOG info statusCode assertEquals HttpStatusCode NOT_FOUND getStatusCode responseParts get getStatusCode final ODataError error ODataError responseParts get getBody assertNotNull error
OasDocument loadOpenApiModel CamelContext camelContext String apiDoc throws Exception InputStream is resolveMandatoryResourceAsInputStream camelContext apiDoc final ObjectMapper mapper new ObjectMapper try final JsonNode node mapper readTree is
private Producer createHttpProducer CamelContext camelContext OasDocument openApi OasOperation operation String host String verb String path String queryParameters String consumes String produces String componentName Map String Object parameters throws Exception
private Producer createHttpProducer CamelContext camelContext OasDocument openApi OasOperation operation String host String verb String path String queryParameters String consumes String produces String componentName Map String Object parameters throws Exception LOG debug operation verb path RestProducerFactory factory RestProducerFactory parameters remove if factory null
support renderCamelContexts exchange getContext adapter contextId contextIdPattern json yaml configuration else String name if contextIdListing ObjectHelper isNotEmpty route if route startsWith route route substring name route split if route startsWith contextId route route substring name length else name exchange getContext getName route boolean match true if contextIdPattern null if equals contextIdPattern
Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setVersion RestOpenApiReader reader new RestOpenApiReader OasDocument openApi null openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
Test public void testReaderReadV3 throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath RestOpenApiReader reader new RestOpenApiReader OasDocument openApi null openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setVersion RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
Test public void testReaderReadV3 throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl config setVersion RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setVersion config setLicenseUrl RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl config setVersion RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl config setVersion RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setVersion config setLicenseUrl RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
Override Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setVersion config setHost RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
Override Test public void testReaderReadV3 throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setHost RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setVersion RestOpenApiReader reader new RestOpenApiReader RestOpenApiSupport support new RestOpenApiSupport List RestDefinition rests support getRestDefinitions context OasDocument openApi reader read context rests null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath Oas20Info info new Oas20Info config setInfo info config setVersion RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
Test public void testReaderReadV3 throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath Oas30Info info new Oas30Info config setInfo info RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl config setVersion RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl RestOpenApiReader reader new RestOpenApiReader OasDocument openApi reader read context context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull openApi ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL Object dump Library writeNode openApi String json mapper writeValueAsString dump
SuppressWarnings Override public synchronized void process Exchange exchange throws Exception final Object body exchange getIn getMandatoryBody final String solverId getSolverId exchange if body getClass isAnnotationPresent PlanningSolution class body Solution if isAsync exchange
SuppressWarnings Override public synchronized void process Exchange exchange throws Exception final Object body exchange getIn getMandatoryBody final String solverId getSolverId exchange if body getClass isAnnotationPresent PlanningSolution class body Solution if isAsync exchange LOGGER debug body solverId final Solver Object solver endpoint getOrCreateSolver solverId executor submit new Runnable Override public void run try solver solve body catch Throwable e LOGGER error solverId e else
executor submit new Runnable Override public void run try solver solve body catch Throwable e LOGGER error solverId e else LOGGER debug body solverId Solver Object solver endpoint getSolver solverId if solver null solver endpoint createSolver solver solve body populateResult exchange solver else if body ProblemFactChange
else LOGGER debug body solverId Solver Object solver endpoint getSolver solverId if solver null solver endpoint createSolver solver solve body populateResult exchange solver else if body ProblemFactChange LOGGER debug body solverId Solver Object solver endpoint getOrCreateSolver solverId solver addProblemFactChange ProblemFactChange Object body if isAsync exchange while solver isEveryProblemFactChangeProcessed Thread sleep OptaPlannerConstants IS_EVERY_PROBLEM_FACT_CHANGE_DELAY
connectOptions PahoEndpoint createMqttConnectOptions getEndpoint getConfiguration if client null clientId getEndpoint getConfiguration getClientId if clientId null clientId MqttClient generateClientId stopClient true client new MqttClient getEndpoint getConfiguration getBrokerUrl clientId PahoEndpoint createMqttClientPersistence getEndpoint getConfiguration LOG debug clientId getEndpoint getConfiguration getBrokerUrl client connect connectOptions client setCallback new MqttCallbackExtended Override public void connectComplete boolean reconnect String serverURI if reconnect try client subscribe getEndpoint getTopic getEndpoint getConfiguration getQos catch MqttException e
clientId getEndpoint getConfiguration getClientId if clientId null clientId MqttClient generateClientId stopClient true client new MqttClient getEndpoint getConfiguration getBrokerUrl clientId PahoEndpoint createMqttClientPersistence getEndpoint getConfiguration LOG debug clientId getEndpoint getConfiguration getBrokerUrl client connect connectOptions client setCallback new MqttCallbackExtended Override public void connectComplete boolean reconnect String serverURI if reconnect try client subscribe getEndpoint getTopic getEndpoint getConfiguration getQos catch MqttException e LOG error e getMessage e Override public void connectionLost Throwable cause
clientId MqttClient generateClientId stopClient true client new MqttClient getEndpoint getConfiguration getBrokerUrl clientId PahoEndpoint createMqttClientPersistence getEndpoint getConfiguration LOG debug clientId getEndpoint getConfiguration getBrokerUrl client connect connectOptions client setCallback new MqttCallbackExtended Override public void connectComplete boolean reconnect String serverURI if reconnect try client subscribe getEndpoint getTopic getEndpoint getConfiguration getQos catch MqttException e LOG error e getMessage e Override public void connectionLost Throwable cause LOG debug cause getMessage cause Override public void messageArrived String topic MqttMessage message throws Exception
Override protected void doStop throws Exception super doStop if stopClient client null client isConnected String topic getEndpoint getTopic if getEndpoint getConfiguration isCleanSession
Override public void process Exchange exchange throws Exception String topic exchange getIn getHeader PahoConstants CAMEL_PAHO_OVERRIDE_TOPIC getEndpoint getTopic String class int qos exchange getIn getHeader PahoConstants CAMEL_PAHO_MSG_QOS getEndpoint getConfiguration getQos Integer class boolean retained exchange getIn getHeader PahoConstants CAMEL_PAHO_MSG_RETAINED getEndpoint getConfiguration isRetained Boolean class byte payload exchange getIn getBody byte class MqttMessage message new MqttMessage payload message setQos qos message setRetained retained
this payload new byte length System arraycopy source offset this payload length catch SQLException e if e getCause SocketException LOG info this connect throw e Exchange exchange this endpoint createExchange exchange setExchangeId stream getLastReceiveLSN asString Message message exchange getIn message setBody this payload final long delay this endpoint getStatusInterval ScheduledFuture scheduledFuture this scheduledExecutor scheduleAtFixedRate try LOG debug
protected final void parseUri String uri
Override public void notification int processId String channel String payload if LOG isDebugEnabled
for FileUpload upload uploads final String name upload name final String fileName upload fileName LOGGER trace name fileName boolean accepted true if fileNameExtWhitelist null String ext FileUtil onlyExt fileName if ext null ext ext toLowerCase Locale US if fileNameExtWhitelist equals fileNameExtWhitelist contains ext accepted false if accepted final File localFile new File upload uploadedFileName uploadAttacher attachUpload localFile fileName message else
private int findPrinter PrintService services String printer int position printer printer toLowerCase Locale US printer printer replace for int i i services length i String printerName services i getName
Override public boolean process final Exchange exchange final AsyncCallback callback Operation operation getOperation exchange
private void doGetHistory Exchange exchange AsyncCallback callback endpoint getPubnub history channel getChannel exchange async new PNCallback PNHistoryResult Override public void onResponse PNHistoryResult result PNStatus status
private void doGetState Exchange exchange AsyncCallback callback endpoint getPubnub getPresenceState channels Arrays asList getChannel exchange uuid getUUID exchange async new PNCallback PNGetStateResult Override public void onResponse PNGetStateResult result PNStatus status
private void doHereNow Exchange exchange AsyncCallback callback endpoint getPubnub hereNow channels Arrays asList getChannel exchange includeState true includeUUIDs true async new PNCallback PNHereNowResult Override public void onResponse PNHereNowResult result PNStatus status
private void doWhereNow Exchange exchange AsyncCallback callback endpoint getPubnub whereNow uuid getUUID exchange async new PNCallback PNWhereNowResult Override public void onResponse PNWhereNowResult result PNStatus status
Override public void execute JobExecutionContext context throws JobExecutionException Exchange exchange null try if LOG isDebugEnabled
CamelContext camelContext getCamelContext context QuartzEndpoint endpoint lookupQuartzEndpoint camelContext context exchange endpoint createExchange exchange setIn new QuartzMessage exchange context AsyncProcessor processor endpoint getProcessor try if processor null processor process exchange else LOG debug catch Throwable e exchange setException e if exchange getException null throw new JobExecutionException exchange getException catch Exception e
exchange endpoint createExchange exchange setIn new QuartzMessage exchange context AsyncProcessor processor endpoint getProcessor try if processor null processor process exchange else LOG debug catch Throwable e exchange setException e if exchange getException null throw new JobExecutionException exchange getException catch Exception e if exchange null LOG error CamelExchangeException createExceptionMessage exchange e
protected QuartzEndpoint lookupQuartzEndpoint CamelContext camelContext JobExecutionContext quartzContext throws JobExecutionException TriggerKey triggerKey quartzContext getTrigger getKey JobDetail jobDetail quartzContext getJobDetail JobKey jobKey jobDetail getKey if LOG isDebugEnabled
endpoint DelegateEndpoint endpoint getEndpoint if endpoint QuartzEndpoint QuartzEndpoint quartzEndpoint QuartzEndpoint endpoint TriggerKey checkTriggerKey quartzEndpoint getTriggerKey if LOG isTraceEnabled LOG trace quartzEndpoint checkTriggerKey if triggerKey equals checkTriggerKey jobDetail requestsRecovery jobKey getGroup equals checkTriggerKey getGroup jobKey getName equals checkTriggerKey getName return quartzEndpoint String endpointUri quartzContext getMergedJobDataMap getString QuartzConstants QUARTZ_ENDPOINT_URI QuartzEndpoint result if camelContext hasEndpoint endpointUri null if LOG isDebugEnabled LOG debug result camelContext getEndpoint endpointUri QuartzEndpoint class else if result searchForEndpointMatch camelContext endpointUri null
prop new Properties try prop load is catch IOException e throw new SchedulerException e finally IOHelper close is if isPrefixInstanceName String instName createInstanceName prop prop setProperty StdSchedulerFactory PROP_SCHED_INSTANCE_NAME instName prop put prop put if isInterruptJobsOnShutdown prop setProperty StdSchedulerFactory PROP_SCHED_INTERRUPT_JOBS_ON_SHUTDOWN if enableJmx prop containsKey
private SchedulerContext storeCamelContextInQuartzContext throws SchedulerException SchedulerContext quartzContext scheduler getContext String camelContextName QuartzHelper getQuartzContextName getCamelContext
if scheduler null createAndInitScheduler else storeCamelContextInQuartzContext for SchedulerInitTask task schedulerInitTasks task initializeTask scheduler schedulerInitTasks clear schedulerInitTasksDone true if autoStartScheduler LOG info else if startDelayedSeconds if scheduler isStarted LOG warn else
Trigger trigger createTrigger jobDetail QuartzHelper updateJobDataMap getCamelContext jobDetail getEndpointUri isUsingFixedCamelContextName if triggerExisted if hasTriggerChanged oldTrigger trigger scheduler rescheduleJob triggerKey trigger else try scheduler scheduleJob jobDetail trigger catch ObjectAlreadyExistsException ex if getComponent isClustered throw ex else trigger scheduler getTrigger triggerKey if trigger null throw new SchedulerException
LOG debug int repeat SimpleTrigger REPEAT_INDEFINITELY String repeatString String copy get if repeatString null repeat EndpointHelper resolveParameter getCamelContext repeatString Integer class copy put repeat long interval String intervalString String copy get if intervalString null interval EndpointHelper resolveParameter getCamelContext intervalString Long class copy put interval TriggerBuilder SimpleTrigger triggerBuilder if ObjectHelper isNotEmpty customCalendar triggerBuilder TriggerBuilder newTrigger withIdentity triggerKey startAt startTime withSchedule simpleSchedule withMisfireHandlingInstructionFireNow withRepeatCount repeat withIntervalInMilliseconds interval modifiedByCalendar QuartzConstants QUARTZ_CAMEL_CUSTOM_CALENDAR else
private JobDetail createJobDetail throws Exception String name triggerKey getName String group triggerKey getGroup Class extends Job jobClass stateful StatefulCamelJob class CamelJob class
Override public void unscheduleTask if trigger null
CronTrigger existingTrigger null TriggerKey triggerKey null if triggerId null triggerGroup null triggerKey new TriggerKey triggerId triggerGroup existingTrigger CronTrigger quartzScheduler getTrigger triggerKey if existingTrigger null JobDataMap map new JobDataMap if routeId null map put routeId else map put runnable map put QuartzConstants QUARTZ_TRIGGER_TYPE map put QuartzConstants QUARTZ_TRIGGER_CRON_EXPRESSION getCron map put QuartzConstants QUARTZ_TRIGGER_CRON_TIMEZONE getTimeZone getID job JobBuilder newJob QuartzScheduledPollConsumerJob class usingJobData map build
existingTrigger CronTrigger quartzScheduler getTrigger triggerKey if existingTrigger null JobDataMap map new JobDataMap if routeId null map put routeId else map put runnable map put QuartzConstants QUARTZ_TRIGGER_TYPE map put QuartzConstants QUARTZ_TRIGGER_CRON_EXPRESSION getCron map put QuartzConstants QUARTZ_TRIGGER_CRON_TIMEZONE getTimeZone getID job JobBuilder newJob QuartzScheduledPollConsumerJob class usingJobData map build QuartzHelper updateJobDataMap getCamelContext job null trigger TriggerBuilder newTrigger withIdentity id triggerGroup withSchedule CronScheduleBuilder cronSchedule getCron inTimeZone getTimeZone build LOG debug job trigger getKey quartzScheduler scheduleJob job trigger
else map put runnable map put QuartzConstants QUARTZ_TRIGGER_TYPE map put QuartzConstants QUARTZ_TRIGGER_CRON_EXPRESSION getCron map put QuartzConstants QUARTZ_TRIGGER_CRON_TIMEZONE getTimeZone getID job JobBuilder newJob QuartzScheduledPollConsumerJob class usingJobData map build QuartzHelper updateJobDataMap getCamelContext job null trigger TriggerBuilder newTrigger withIdentity id triggerGroup withSchedule CronScheduleBuilder cronSchedule getCron inTimeZone getTimeZone build LOG debug job trigger getKey quartzScheduler scheduleJob job trigger else checkTriggerIsNonConflicting existingTrigger LOG debug triggerKey job quartzScheduler getJobDetail existingTrigger getJobKey JobDataMap jobData job getJobDataMap
map put QuartzConstants QUARTZ_TRIGGER_TYPE map put QuartzConstants QUARTZ_TRIGGER_CRON_EXPRESSION getCron map put QuartzConstants QUARTZ_TRIGGER_CRON_TIMEZONE getTimeZone getID job JobBuilder newJob QuartzScheduledPollConsumerJob class usingJobData map build QuartzHelper updateJobDataMap getCamelContext job null trigger TriggerBuilder newTrigger withIdentity id triggerGroup withSchedule CronScheduleBuilder cronSchedule getCron inTimeZone getTimeZone build LOG debug job trigger getKey quartzScheduler scheduleJob job trigger else checkTriggerIsNonConflicting existingTrigger LOG debug triggerKey job quartzScheduler getJobDetail existingTrigger getJobKey JobDataMap jobData job getJobDataMap jobData put QuartzConstants QUARTZ_TRIGGER_CRON_EXPRESSION getCron jobData put QuartzConstants QUARTZ_TRIGGER_CRON_TIMEZONE getTimeZone getID
map put QuartzConstants QUARTZ_TRIGGER_CRON_TIMEZONE getTimeZone getID job JobBuilder newJob QuartzScheduledPollConsumerJob class usingJobData map build QuartzHelper updateJobDataMap getCamelContext job null trigger TriggerBuilder newTrigger withIdentity id triggerGroup withSchedule CronScheduleBuilder cronSchedule getCron inTimeZone getTimeZone build LOG debug job trigger getKey quartzScheduler scheduleJob job trigger else checkTriggerIsNonConflicting existingTrigger LOG debug triggerKey job quartzScheduler getJobDetail existingTrigger getJobKey JobDataMap jobData job getJobDataMap jobData put QuartzConstants QUARTZ_TRIGGER_CRON_EXPRESSION getCron jobData put QuartzConstants QUARTZ_TRIGGER_CRON_TIMEZONE getTimeZone getID QuartzHelper updateJobDataMap getCamelContext job null LOG debug jobData
jobData put QuartzConstants QUARTZ_TRIGGER_CRON_EXPRESSION getCron jobData put QuartzConstants QUARTZ_TRIGGER_CRON_TIMEZONE getTimeZone getID QuartzHelper updateJobDataMap getCamelContext job null LOG debug jobData trigger existingTrigger getTriggerBuilder withSchedule CronScheduleBuilder cronSchedule getCron inTimeZone getTimeZone build if hasTriggerChanged existingTrigger trigger LOG debug job trigger getKey quartzScheduler rescheduleJob triggerKey trigger else LOG debug job trigger getKey try quartzScheduler scheduleJob job trigger catch ObjectAlreadyExistsException ex QuartzComponent quartz getCamelContext getComponent QuartzComponent class if quartz isClustered
Override protected void doStop throws Exception if trigger null deleteJob boolean isClustered quartzScheduler getMetaData isJobStoreClustered if quartzScheduler isShutdown isClustered
Override public void execute JobExecutionContext jobExecutionContext throws JobExecutionException
protected void onJobExecute Action action Route route throws Exception
public void pauseRouteTrigger Action action String routeId throws SchedulerException TriggerKey triggerKey retrieveTriggerKey action routeId getScheduler pauseTrigger triggerKey
public void resumeRouteTrigger Action action String routeId throws SchedulerException TriggerKey triggerKey retrieveTriggerKey action routeId getScheduler resumeTrigger triggerKey
Test public void testQuartz throws Exception resultEndpoint getMockEndpoint resultEndpoint expectedMessageCount resultEndpoint message header isEqualTo resultEndpoint message header isEqualTo resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges for Exchange exchange list Message in exchange getIn
private void startQuickfixjEngine QuickfixjEngine engine throws Exception if engine isLazy
private void sendOutMessage Exchange exchange throws QFJException Message camelMessage exchange getMessage quickfix Message quickfixjMessage camelMessage getBody quickfix Message class
void sendMessage Exchange exchange org apache camel Message camelMessage throws Exception Message message camelMessage getBody Message class
LOG info context start if logonLatch await 5L TimeUnit SECONDS throw new IllegalStateException URL orderStatusUrl new URL orderStatusServiceUrl URLConnection connection orderStatusUrl openConnection BufferedReader orderStatusReply IOHelper buffered new InputStreamReader connection getInputStream String line orderStatusReply readLine if line equals throw new Exception else StringBuilder sb new StringBuilder while line null sb append line sb append
public String route Exchange exchange Message message exchange getIn getBody Message class if message null SessionID destinationSession getDestinationSessionID message if destinationSession null String destinationUri String format engineUri destinationSession
final SessionID sessionID MessageUtils getSessionID message try if message quickfix fix40 NewOrderSingle onMessage quickfix fix40 NewOrderSingle message sessionID else if message quickfix fix41 NewOrderSingle onMessage quickfix fix41 NewOrderSingle message sessionID else if message quickfix fix42 NewOrderSingle onMessage quickfix fix42 NewOrderSingle message sessionID else if message quickfix fix43 NewOrderSingle onMessage quickfix fix43 NewOrderSingle message sessionID else if message quickfix fix44 NewOrderSingle onMessage quickfix fix44 NewOrderSingle message sessionID else if message quickfix fix50 NewOrderSingle onMessage quickfix fix50 NewOrderSingle message sessionID catch Exception e
DataDictionaryProvider provider session getDataDictionaryProvider if provider null try ApplVerID applVerID getApplVerID session message DataDictionary appDataDictionary provider getApplicationDataDictionary applVerID appDataDictionary validate message true catch Exception e LogUtil logThrowable sessionID e getMessage e return for QuickfixjMessageListener listener listeners try listener onMessage sessionID message catch Throwable e LogUtil logThrowable sessionID e catch SessionNotFound e
Override protected Endpoint createEndpoint String uri String remaining Map String Object parameters throws Exception synchronized endpoints Endpoint endpoint endpoints get uri if endpoint null endpoint new TradeExecutorEndpoint uri new TradeExecutor endpoints put uri TradeExecutorEndpoint endpoint
public void print Exchange exchange
private Channel openChannel Connection conn throws IOException LOG trace Channel channel conn createChannel
private void openConnection throws IOException TimeoutException LOG trace this conn getEndpoint connect executor
Override protected void doStart throws Exception executor endpoint createExecutor
final Object contentEncoding msg removeHeader RabbitMQConstants CONTENT_ENCODING if contentEncoding null properties contentEncoding contentEncoding toString final Object expiration msg removeHeader RabbitMQConstants EXPIRATION if expiration null properties expiration expiration toString final Object appId msg removeHeader RabbitMQConstants APP_ID if appId null properties appId appId toString final Object timestamp msg removeHeader RabbitMQConstants TIMESTAMP if timestamp null properties timestamp convertTimestamp timestamp final Map String Object headers msg getHeaders Map String Object filteredHeaders new HashMap for Map Entry String Object header headers entrySet
properties contentEncoding contentEncoding toString final Object expiration msg removeHeader RabbitMQConstants EXPIRATION if expiration null properties expiration expiration toString final Object appId msg removeHeader RabbitMQConstants APP_ID if appId null properties appId appId toString final Object timestamp msg removeHeader RabbitMQConstants TIMESTAMP if timestamp null properties timestamp convertTimestamp timestamp final Map String Object headers msg getHeaders Map String Object filteredHeaders new HashMap for Map Entry String Object header headers entrySet Object value getValidRabbitMQHeaderValue header getKey header getValue if value null isAllowNullHeaders header getKey equals RabbitMQConstants EXCHANGE_OVERRIDE_NAME
final Object expiration msg removeHeader RabbitMQConstants EXPIRATION if expiration null properties expiration expiration toString final Object appId msg removeHeader RabbitMQConstants APP_ID if appId null properties appId appId toString final Object timestamp msg removeHeader RabbitMQConstants TIMESTAMP if timestamp null properties timestamp convertTimestamp timestamp final Map String Object headers msg getHeaders Map String Object filteredHeaders new HashMap for Map Entry String Object header headers entrySet Object value getValidRabbitMQHeaderValue header getKey header getValue if value null isAllowNullHeaders header getKey equals RabbitMQConstants EXCHANGE_OVERRIDE_NAME boolean filteredHeader
private synchronized void openConnectionAndChannelPool throws Exception LOG trace this conn getEndpoint connect executorService
if started get return LOG debug ClassLoader current Thread currentThread getContextClassLoader ClassLoader ac getEndpoint getCamelContext getApplicationContextClassLoader try if ac null Thread currentThread setContextClassLoader ac if getEndpoint getReplyToType null if getEndpoint getReplyTo null getEndpoint getReplyToType equals ReplyToType Temporary name throw new IllegalArgumentException ReplyToType Temporary getEndpoint getReplyTo if getEndpoint getReplyTo null throw new IllegalArgumentException getEndpoint getReplyTo else replyManager createReplyManager
protected void unInitReplyManager try if replyManager null if LOG isDebugEnabled
protected ReplyManager createReplyManager throws Exception ReplyManager replyManager new TemporaryQueueReplyManager getEndpoint getCamelContext replyManager setEndpoint getEndpoint String name getEndpoint getExchangeName ScheduledExecutorService replyManagerExecutorService getEndpoint getCamelContext getExecutorServiceManager newSingleThreadScheduledExecutor name name replyManager setScheduledExecutorService replyManagerExecutorService
Override public void setReplyTo String replyTo
Override protected void doStart throws Exception ObjectHelper notNull executorService this ObjectHelper notNull endpoint this messageConverter setAllowNullHeaders endpoint isAllowNullHeaders
Override protected void doStart throws Exception ObjectHelper notNull executorService this ObjectHelper notNull endpoint this messageConverter setAllowNullHeaders endpoint isAllowNullHeaders LOG debug endpoint getRequestTimeoutCheckerInterval correlation new CorrelationTimeoutMap executorService endpoint getRequestTimeoutCheckerInterval ServiceHelper startService correlation listenerContainer createListenerContainer
Override protected void doStop throws Exception ServiceHelper stopService correlation if listenerContainer null
Override public void onReply String correlationId AMQP BasicProperties properties byte reply
Override public void onTimeout String correlationId
Override public void request long l
LinkedList Exchange sendingQueue null try mutex lock if this terminated return int amount int Math min requested buffer size if amount this requested amount sendingQueue new LinkedList while amount sendingQueue add buffer removeFirst amount finally mutex unlock if sendingQueue null
Test public void testSlowLoop throws Exception for int i i i try
Test public void testSlowLoop throws Exception for int i i i try
if ObjectHelper isEmpty host throw new IllegalArgumentException method path RestProducerFactory apiDocFactory null RestProducerFactory factory null if apiDoc null LOG debug apiDoc FactoryFinder finder null try finder getCamelContext adapt ExtendedCamelContext class getFactoryFinder RESOURCE_PATH apiDocFactory finder newInstance DEFAULT_API_COMPONENT_NAME RestProducerFactory class orElse null if apiDocFactory null throw new NoFactoryAvailableException parameters put apiDoc catch NoFactoryAvailableException e try
if pname null getConsumerComponentName null String cname getConsumerComponentName Object comp getCamelContext getRegistry lookupByName cname if comp RestProducerFactory factory RestProducerFactory comp pname cname else comp setupComponent cname getCamelContext Map String Object parameters get if comp RestProducerFactory factory RestProducerFactory comp pname cname if factory null Set RestProducerFactory factories getCamelContext getRegistry findByType RestProducerFactory class if factories null factories size factory factories iterator next
for String name getCamelContext getComponentNames Component comp getCamelContext getComponent name if comp RestConsumerFactory factory RestConsumerFactory comp cname name break if factory null Set RestConsumerFactory factories getCamelContext getRegistry findByType RestConsumerFactory class if factories null factories size factory factories iterator next if factory null RestConsumerFactory found null String foundName null for String name DEFAULT_REST_CONSUMER_COMPONENTS Object comp getCamelContext getComponent name true
Override public void process Exchange exchange throws Exception ResteasyEndpoint resteasyEndpoint ObjectHelper cast ResteasyEndpoint class getEndpoint Map String String parameters getParameters exchange resteasyEndpoint String query exchange getIn getHeader Exchange HTTP_QUERY String class String uri resteasyEndpoint buildUri if query null
Override public void process Exchange exchange throws Exception ResteasyEndpoint resteasyEndpoint ObjectHelper cast ResteasyEndpoint class getEndpoint Map String String parameters getParameters exchange resteasyEndpoint String query exchange getIn getHeader Exchange HTTP_QUERY String class String uri resteasyEndpoint buildUri if query null LOG debug query uri uri addQueryToUri uri query
ArrayList headerParams exchange getIn getHeader ResteasyConstants RESTEASY_PROXY_METHOD_PARAMS ArrayList class if headerParams null Object args new Object headerParams size Class paramsClasses new Class headerParams size for int i i headerParams size i paramsClasses i headerParams get i getClass args i headerParams get i Method m simple getClass getMethod parameters get RESTEASY_PROXY_METHOD_NAME_OPTION paramsClasses object m invoke simple args else Method m simple getClass getMethod parameters get RESTEASY_PROXY_METHOD_NAME_OPTION object m invoke simple catch ClassNotFoundException InvocationTargetException NoSuchMethodException IllegalAccessException e exchange getMessage getHeaders put ResteasyConstants RESTEASY_PROXY_PRODUCER_EXCEPTION e exchange getMessage setBody e
private Response createResponse Exchange exchange ResteasyEndpoint resteasyEndpoint Map String String parameters WebTarget target String body exchange getIn getBody String class
private Response createResponse Exchange exchange ResteasyEndpoint resteasyEndpoint Map String String parameters WebTarget target String body exchange getIn getBody String class LOG debug body String mediaType exchange getIn getHeader Exchange CONTENT_TYPE String class
private Response createResponse Exchange exchange ResteasyEndpoint resteasyEndpoint Map String String parameters WebTarget target String body exchange getIn getBody String class LOG debug body String mediaType exchange getIn getHeader Exchange CONTENT_TYPE String class LOG debug body mediaType Invocation Builder builder if mediaType null builder target request mediaType else builder target request for Map Entry String Object entry exchange getIn getHeaders entrySet String key entry getKey Object value entry getValue if resteasyEndpoint getHeaderFilterStrategy null resteasyEndpoint getHeaderFilterStrategy applyFilterToCamelHeaders key value exchange builder header key value
public void doWriteResponse Exchange exchange Response response HeaderFilterStrategy headerFilterStrategy int responseCode response getStatus Map String Object headers new HashMap headers put Exchange HTTP_RESPONSE_CODE responseCode for String key response getHeaders keySet Object value response getHeaders get key if headerFilterStrategy null headerFilterStrategy applyFilterToExternalHeaders key value exchange headers put key value
SuppressWarnings Override public void init ServletConfig servletConfig throws ServletException super init servletConfig String name servletConfig getServletName if httpRegistry null httpRegistry DefaultHttpRegistry getHttpRegistry name HttpRegistryProvider existing httpRegistry getCamelServlet name if existing null
if existing null LOG info name existing this toString httpRegistry register this for Map Entry String HttpConsumer entry consumers entrySet String proxyClasses ResteasyComponent getServletEndpoint entry getValue getComponent getProxyConsumersClasses if proxyClasses null String classes proxyClasses split LOG debug Arrays asList classes for String clazz classes try Class realClazz Class forName clazz InvocationHandler handler new ResteasyInvocationHandler Object proxy Proxy newProxyInstance realClazz getClassLoader new Class realClazz handler getDispatcher getRegistry addSingletonResource proxy catch ClassNotFoundException e
public void disconnect HttpConsumer consumer
GET Path Produces MediaType TEXT_PLAIN public Response test Min PathParam int param
Override protected void doStart throws Exception ObjectHelper notNull configuration ObjectHelper notNull camelContext if serviceDiscovery null
private ZoneAwareLoadBalancer RibbonServiceDefinition createLoadBalancer String serviceName IClientConfig config configuration getClientName null IClientConfig Builder newBuilder configuration getClientName build IClientConfig Builder newBuilder build if configuration getProperties null for Map Entry String String entry configuration getProperties entrySet IClientConfigKey key CommonClientConfigKey valueOf entry getKey String value entry getValue
generatedArguments addListToArguments Arrays asList configuration getExcludes null configuration getExcludes split generatedArguments addListToArguments Arrays asList configuration getCriticalTags null configuration getCriticalTags split generatedArguments addListToArguments Arrays asList configuration getNonCriticalTags null configuration getNonCriticalTags split List String variables RobotFrameworkCamelUtils createRobotVariablesFromCamelExchange exchange isAllowContextMapAll exchange getIn setHeader RobotFrameworkCamelConstants CAMEL_ROBOT_VARIABLES variables generatedArguments addListToArguments variables generatedArguments addListToArguments Arrays asList configuration getVariableFiles null configuration getVariableFiles split generatedArguments addListToArguments Arrays asList configuration getTagStatIncludes null configuration getTagStatIncludes split generatedArguments addListToArguments Arrays asList configuration getTagStatExcludes null configuration getTagStatExcludes split generatedArguments addListToArguments Arrays asList configuration getCombinedTagStats null configuration getCombinedTagStats split generatedArguments addListToArguments Arrays asList configuration getTagDocs null configuration getTagDocs split generatedArguments addListToArguments Arrays asList configuration getTagStatLinks null configuration getTagStatLinks split generatedArguments addListToArguments Arrays asList configuration getListeners null configuration getListeners split String path getResourceUri ObjectHelper notNull path
generatedArguments addListToArguments Arrays asList configuration getVariableFiles null configuration getVariableFiles split generatedArguments addListToArguments Arrays asList configuration getTagStatIncludes null configuration getTagStatIncludes split generatedArguments addListToArguments Arrays asList configuration getTagStatExcludes null configuration getTagStatExcludes split generatedArguments addListToArguments Arrays asList configuration getCombinedTagStats null configuration getCombinedTagStats split generatedArguments addListToArguments Arrays asList configuration getTagDocs null configuration getTagDocs split generatedArguments addListToArguments Arrays asList configuration getTagStatLinks null configuration getTagStatLinks split generatedArguments addListToArguments Arrays asList configuration getListeners null configuration getListeners split String path getResourceUri ObjectHelper notNull path log debug path String newResourceUri null if getConfiguration isAllowTemplateFromHeader newResourceUri exchange getIn getHeader RobotFrameworkCamelConstants CAMEL_ROBOT_RESOURCE_URI String class if newResourceUri null exchange getIn removeHeader RobotFrameworkCamelConstants CAMEL_ROBOT_RESOURCE_URI
Override public boolean isValidEntry FeedEndpoint endpoint Object feed Object entry Date updated SyndEntry entry getUpdatedDate if updated null updated SyndEntry entry getPublishedDate if updated null LOG debug entry return true if lastUpdate null if lastUpdate after updated LOG debug lastUpdate entry return false else Integer hash entry hashCode if lastUpdate equals updated if entriesForLastUpdate containsKey hash
Test public void testUriIssue throws Exception String uri PollingConsumer consumer context getEndpoint uri createPollingConsumer consumer start Exchange exchange consumer receive
Override protected Endpoint createEndpoint String uri String remaining Map String Object parameters throws Exception OperationName operationName null String topicName null String apexUrl null try
Override protected void doStart throws Exception super doStart if loginConfig null loginConfig new SalesforceLoginConfig loginConfig setInstanceUrl instanceUrl loginConfig setClientId clientId loginConfig setClientSecret clientSecret loginConfig setKeystore keystore loginConfig setLazyLogin lazyLogin loginConfig setLoginUrl loginUrl loginConfig setPassword password loginConfig setRefreshToken refreshToken loginConfig setType authenticationType loginConfig setUserName userName
super doStart if loginConfig null loginConfig new SalesforceLoginConfig loginConfig setInstanceUrl instanceUrl loginConfig setClientId clientId loginConfig setClientSecret clientSecret loginConfig setKeystore keystore loginConfig setLazyLogin lazyLogin loginConfig setLoginUrl loginUrl loginConfig setPassword password loginConfig setRefreshToken refreshToken loginConfig setType authenticationType loginConfig setUserName userName LOG debug loginConfig else
public void processMessage final ClientSessionChannel channel final Message message if LOG isDebugEnabled
void createPushTopicMessage final Message message final org apache camel Message in setHeaders in message final Map String Object data message getDataAsMap SuppressWarnings final Map String Object event Map String Object data get EVENT_PROPERTY final Object eventType event get TYPE_PROPERTY final Object createdDate event get CREATED_DATE_PROPERTY final Object replayId event get REPLAY_ID_PROPERTY in setHeader topicName in setHeader eventType in setHeader createdDate if replayId null in setHeader replayId SuppressWarnings final Map String Object sObject Map String Object data get SOBJECT_PROPERTY try final String sObjectString objectMapper writeValueAsString sObject
public Request getLoginRequest HttpConversation conversation final String loginUrl instanceUrl null config getLoginUrl instanceUrl OAUTH2_TOKEN_PATH
String tmp aliases nextElement if keystore isKeyEntry tmp if alias null alias tmp else throw new IllegalArgumentException keyStoreParameters getResource PrivateKey key PrivateKey keystore getKey alias keyStoreParameters getPassword toCharArray Signature signature Signature getInstance JWT_SIGNATURE_ALGORITHM signature initSign key signature update token toString getBytes StandardCharsets UTF_8 byte signed signature sign token append append Base64 getUrlEncoder encodeToString signed try key destroy catch javax security auth DestroyFailedException ex
private void processApexCall final Exchange exchange final AsyncCallback callback throws SalesforceException final String apexUrl getApexUrl exchange String apexMethod getParameter APEX_METHOD exchange IGNORE_BODY IS_OPTIONAL if apexMethod null apexMethod
int start while matcher find result append apexUrl start matcher start start matcher end final String parameterName matcher group final Object value exchange getIn getHeader parameterName if value null throw new IllegalArgumentException parameterName try result append URLEncoder encode String valueOf value replace catch UnsupportedEncodingException e throw new SalesforceException e getMessage e if start result append apexUrl start apexUrl length final String resolvedUrl result toString
private void updateTopic String topicId throws CamelException final String query config getSObjectQuery
Override protected void doStart throws Exception this client createClient component handshakeError null handshakeException null connectError null connectException null if handshakeListener null handshakeListener new ClientSessionChannel MessageListener public void onMessage ClientSessionChannel channel Message message
session logout catch SalesforceException e LOG warn e getMessage e restartClient else if listenerMap isEmpty reconnecting true client getChannel META_HANDSHAKE addListener handshakeListener if connectListener null connectListener new ClientSessionChannel MessageListener public void onMessage ClientSessionChannel channel Message message LOG debug message if message isSuccessful LOG warn message connectError String message get ERROR_FIELD
final SalesforceHttpClient httpClient component getConfig getHttpClient httpClient getExecutor execute new Runnable Override public void run LOG info boolean abort false LOG debug while client isDisconnected try Thread sleep DISCONNECT_INTERVAL catch InterruptedException e LOG error abort true if abort final long backoff restartBackoff getAndAdd backoffIncrement if backoff maxBackoff
LOG info boolean abort false LOG debug while client isDisconnected try Thread sleep DISCONNECT_INTERVAL catch InterruptedException e LOG error abort true if abort final long backoff restartBackoff getAndAdd backoffIncrement if backoff maxBackoff LOG error maxBackoff abort true else
if abort final long backoff restartBackoff getAndAdd backoffIncrement if backoff maxBackoff LOG error maxBackoff abort true else LOG debug backoff try Thread sleep backoff catch InterruptedException e LOG error abort true if abort Exception lastError new SalesforceException null try
else LOG debug backoff try Thread sleep backoff catch InterruptedException e LOG error abort true if abort Exception lastError new SalesforceException null try doStop doStart catch Exception e LOG error e getMessage e lastError e
public void subscribe final String topicName final SalesforceConsumer consumer final String channelName getChannelName topicName setupReplay SalesforceEndpoint consumer getEndpoint
public void subscribe final String topicName final SalesforceConsumer consumer final String channelName getChannelName topicName setupReplay SalesforceEndpoint consumer getEndpoint LOG info channelName final ClientSessionChannel MessageListener listener new ClientSessionChannel MessageListener Override public void onMessage ClientSessionChannel channel Message message
final String subscribedChannelName message get SUBSCRIPTION_FIELD toString if channelName equals subscribedChannelName if message isSuccessful String error String message get ERROR_FIELD if error null error Exception failure getFailure message String msg String format topicName failure null failure getMessage error boolean abort true if isTemporaryError message LOG warn msg final long backoff restartBackoff getAndAdd backoffIncrement if backoff maxBackoff LOG error maxBackoff else
void setupReplay final SalesforceEndpoint endpoint final String topicName endpoint getTopicName final Optional Long replayId determineReplayIdFor endpoint topicName if replayId isPresent final String channelName getChannelName topicName final Long replayIdValue replayId get
public void unsubscribe String topicName SalesforceConsumer consumer throws CamelException final String channelName getChannelName topicName final CountDownLatch latch new CountDownLatch final String unsubscribeError null final Exception unsubscribeFailure null final ClientSessionChannel MessageListener unsubscribeListener new ClientSessionChannel MessageListener public void onMessage ClientSessionChannel channel Message message
final String channelName getChannelName topicName final CountDownLatch latch new CountDownLatch final String unsubscribeError null final Exception unsubscribeFailure null final ClientSessionChannel MessageListener unsubscribeListener new ClientSessionChannel MessageListener public void onMessage ClientSessionChannel channel Message message LOG debug message Object subscription message get SUBSCRIPTION_FIELD if subscription null String unsubscribedChannelName subscription toString if channelName equals unsubscribedChannelName if message isSuccessful unsubscribeError String message get ERROR_FIELD unsubscribeFailure getFailure message else
Object subscription message get SUBSCRIPTION_FIELD if subscription null String unsubscribedChannelName subscription toString if channelName equals unsubscribedChannelName if message isSuccessful unsubscribeError String message get ERROR_FIELD unsubscribeFailure getFailure message else LOG info unsubscribedChannelName latch countDown client getChannel META_UNSUBSCRIBE addListener unsubscribeListener try final ClientSessionChannel MessageListener listener listenerMap remove consumer if listener null
Test public void testGetRecentReports throws Exception final List recentReports template requestBody null List class assertNotNull recentReports assertFalse recentReports isEmpty
ParameterizedTest MethodSource public void testReport String reportName throws Exception
ParameterizedTest MethodSource public void testReport String reportName throws Exception LOG info reportName final QueryRecordsReport reports template requestBody reportName QueryRecordsReport class assertNotNull reports final List Report reportsRecords reports getRecords assertFalse reportsRecords isEmpty final String testReportId reportsRecords get getId assertNotNull testReportId final ReportDescription reportDescription template requestBody testReportId ReportDescription class assertNotNull reportDescription
ParameterizedTest MethodSource public void testReport String reportName throws Exception LOG info reportName final QueryRecordsReport reports template requestBody reportName QueryRecordsReport class assertNotNull reports final List Report reportsRecords reports getRecords assertFalse reportsRecords isEmpty final String testReportId reportsRecords get getId assertNotNull testReportId final ReportDescription reportDescription template requestBody testReportId ReportDescription class assertNotNull reportDescription LOG debug reportDescription final ReportMetadata testReportMetadata reportDescription getReportMetadata SyncReportResults reportResults template requestBodyAndHeader testReportId SalesforceEndpointConfig INCLUDE_DETAILS Boolean TRUE SyncReportResults class assertNotNull reportResults
LOG debug reportDescription final ReportMetadata testReportMetadata reportDescription getReportMetadata SyncReportResults reportResults template requestBodyAndHeader testReportId SalesforceEndpointConfig INCLUDE_DETAILS Boolean TRUE SyncReportResults class assertNotNull reportResults LOG debug reportResults final Map String Object headers new HashMap headers put SalesforceEndpointConfig INCLUDE_DETAILS Boolean FALSE Object body if bodyMetadata headers put SalesforceEndpointConfig REPORT_METADATA testReportMetadata body testReportId else body testReportMetadata reportResults template requestBodyAndHeaders body headers SyncReportResults class assertNotNull reportResults
assertNotNull reportResults LOG debug reportResults final Map String Object headers new HashMap headers put SalesforceEndpointConfig INCLUDE_DETAILS Boolean FALSE Object body if bodyMetadata headers put SalesforceEndpointConfig REPORT_METADATA testReportMetadata body testReportId else body testReportMetadata reportResults template requestBodyAndHeaders body headers SyncReportResults class assertNotNull reportResults LOG debug reportResults ReportInstance reportInstance template requestBodyAndHeader testReportId SalesforceEndpointConfig INCLUDE_DETAILS true ReportInstance class assertNotNull reportInstance
reportResults template requestBodyAndHeaders body headers SyncReportResults class assertNotNull reportResults LOG debug reportResults ReportInstance reportInstance template requestBodyAndHeader testReportId SalesforceEndpointConfig INCLUDE_DETAILS true ReportInstance class assertNotNull reportInstance LOG debug reportInstance headers clear headers put SalesforceEndpointConfig INCLUDE_DETAILS if bodyMetadata headers put SalesforceEndpointConfig REPORT_METADATA testReportMetadata body testReportId bodyMetadata true else body testReportMetadata bodyMetadata false
LOG debug reportInstance headers clear headers put SalesforceEndpointConfig INCLUDE_DETAILS if bodyMetadata headers put SalesforceEndpointConfig REPORT_METADATA testReportMetadata body testReportId bodyMetadata true else body testReportMetadata bodyMetadata false reportInstance template requestBodyAndHeaders body headers ReportInstance class assertNotNull reportInstance LOG debug reportInstance final String testReportInstanceId reportInstance getId final List reportInstances template requestBody testReportId List class
LOG debug reportInstance final String testReportInstanceId reportInstance getId final List reportInstances template requestBody testReportId List class assertNotNull reportInstances assertFalse reportInstances isEmpty LOG debug reportInstances boolean done false int tries AsyncReportResults asyncReportResults null while done asyncReportResults template requestBodyAndHeader testReportId SalesforceEndpointConfig INSTANCE_ID testReportInstanceId AsyncReportResults class done asyncReportResults null asyncReportResults getAttributes getStatus ReportStatusEnum Success asyncReportResults getAttributes getStatus ReportStatusEnum Error if done Thread sleep RETRY_DELAY if tries REPORT_RESULT_RETRIES
if done Thread sleep RETRY_DELAY if tries REPORT_RESULT_RETRIES final long retrySeconds TimeUnit SECONDS convert tries RETRY_DELAY TimeUnit MILLISECONDS fail retrySeconds assertNotNull asyncReportResults assertEquals ReportStatusEnum Success asyncReportResults getAttributes getStatus LOG debug asyncReportResults String convertResults template requestBody asyncReportResults String class assertNotNull convertResults LOG debug convertResults LOG debug convertResults final boolean values new boolean NUM_OPTIONS final int nIterations int Math pow NUM_OPTIONS for int i i nIterations i
assertNotNull asyncReportResults assertEquals ReportStatusEnum Success asyncReportResults getAttributes getStatus LOG debug asyncReportResults String convertResults template requestBody asyncReportResults String class assertNotNull convertResults LOG debug convertResults LOG debug convertResults final boolean values new boolean NUM_OPTIONS final int nIterations int Math pow NUM_OPTIONS for int i i nIterations i for int j j NUM_OPTIONS j if i POWERS j values j values j LOG debug REPORT_OPTIONS values headers clear
ParameterizedTest MethodSource public void testBatchLifecycle BatchTest request throws Exception
ParameterizedTest MethodSource public void testJobLifecycle JobInfo jobInfo String operationName throws Exception
ParameterizedTest EnumSource names public void testQueryLifecycle ContentType contentType throws Exception
account setBillingStreet account setBillingLatitude account setBillingLongitude account setShippingCity account setShippingCountry account setShippingPostalCode account setShippingState account setShippingStreet account setShippingLatitude account setShippingLongitude account setShipping_Location__Latitude__s account setShipping_Location__Longitude__s CreateSObjectResult result template requestBody suffix account CreateSObjectResult class assertNotNull result assertTrue result getSuccess
account setShippingStreet account setShippingLatitude account setShippingLongitude account setShipping_Location__Latitude__s account setShipping_Location__Longitude__s CreateSObjectResult result template requestBody suffix account CreateSObjectResult class assertNotNull result assertTrue result getSuccess LOG debug result try account template requestBody suffix result getId Account class assertNotNull account assertNotNull account getBillingAddress assertNotNull account getShippingAddress assertNotNull account getShippingAddress
ConnectHandler connectHandler new ConnectHandler Override protected boolean handleAuthentication HttpServletRequest request HttpServletResponse response String address final String header request getHeader PROXY_AUTHORIZATION toString if authenticationString equals header LOG warn PROXY_AUTHORIZATION response setHeader PROXY_AUTHENTICATE toString String format HTTP_PROXY_REALM return false LOG info PROXY_AUTHORIZATION WENT_THROUGH_PROXY set true return true server setHandler connectHandler LOG info server start httpProxyPort connector getLocalPort
rawPayloadMock expectedMessageCount rawPayloadMock expectedHeaderReceived rawPayloadMock expectedHeaderReceived Merchandise__c merchandise new Merchandise__c merchandise setName merchandise setDescription__c ZonedDateTime now toString merchandise setPrice__c merchandise setTotal_Inventory__c CreateSObjectResult result template requestBody merchandise CreateSObjectResult class assertTrue result null result getSuccess try mock assertIsSatisfied final Message in mock getExchanges get getIn merchandise in getMandatoryBody Merchandise__c class assertNotNull merchandise
Test public void getBasicApiJsonSchema throws Exception LOG info String basicApiJsonSchema JsonUtils getBasicApiJsonSchema
Test public void getSObjectJsonSchema throws Exception SObjectDescription description new Account description LOG info String sObjectJsonSchema JsonUtils getSObjectJsonSchema description
Test public void testLogin throws Exception final SslContextFactory sslContextFactory new SslContextFactory Client sslContextFactory setSslContext new SSLContextParameters createSSLContext new DefaultCamelContext final SalesforceHttpClient httpClient new SalesforceHttpClient sslContextFactory httpClient setConnectTimeout TIMEOUT final SalesforceSession session new SalesforceSession new DefaultCamelContext httpClient TIMEOUT LoginConfigHelper getLoginConfig session addListener this httpClient setSession session httpClient start try String loginToken session login session getAccessToken
Test public void testLogin throws Exception final SslContextFactory sslContextFactory new SslContextFactory Client sslContextFactory setSslContext new SSLContextParameters createSSLContext new DefaultCamelContext final SalesforceHttpClient httpClient new SalesforceHttpClient sslContextFactory httpClient setConnectTimeout TIMEOUT final SalesforceSession session new SalesforceSession new DefaultCamelContext httpClient TIMEOUT LoginConfigHelper getLoginConfig session addListener this httpClient setSession session httpClient start try String loginToken session login session getAccessToken LOG info loginToken assertTrue onLoginTriggered onLoginTriggered false loginToken session login loginToken
excludedNames add name Pattern incPattern if includePattern null includePattern trim isEmpty incPattern Pattern compile includePattern trim else if includedNames isEmpty incPattern Defaults MATCH_EVERYTHING_PATTERN else incPattern Defaults MATCH_NOTHING_PATTERN Pattern excPattern if excludePattern null excludePattern trim isEmpty excPattern Pattern compile excludePattern trim else excPattern Defaults MATCH_NOTHING_PATTERN final Set String acceptedNames new HashSet for final String name objectNames
Override protected void doStart throws Exception String url getEndpoint getUrl getEndpoint getUsername getEndpoint getPassword if LOG isInfoEnabled
public Object evaluate Exchange exchange try
public List evaluateAsList Exchange exchange throws Exception
public Object evaluateAsStringSource Exchange exchange throws Exception
public Object evaluateAsBytesSource Exchange exchange throws Exception
public Node evaluateAsDOM Exchange exchange throws Exception
public byte evaluateAsBytes Exchange exchange throws Exception
public String evaluateAsString Exchange exchange throws Exception
Override public boolean matches Exchange exchange
protected synchronized void initialize Exchange exchange throws XPathException IOException if initialized get LOG debug this if configuration null configuration new Configuration configuration getParseOptions setSpaceStrippingRule isStripsAllWhiteSpace AllElementsSpaceStrippingRule getInstance IgnorableSpaceStrippingRule getInstance
LOG debug configuration else LOG debug configuration if configurationProperties null configurationProperties isEmpty for Map Entry String Object entry configurationProperties entrySet configuration setConfigurationProperty entry getKey entry getValue staticQueryContext getConfiguration newStaticQueryContext if moduleURIResolver null staticQueryContext setModuleURIResolver moduleURIResolver Set Map Entry String String entries namespacePrefixes entrySet for Map Entry String String entry entries String prefix entry getKey String uri entry getValue boolean invalid equals prefix equals prefix if invalid
Test Disabled public void testXPathPerformanceRoute throws Exception NotifyBuilder notify new NotifyBuilder context whenDone size create boolean matches notify matches TimeUnit SECONDS
watch restart split xpath streaming choice when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num tiny incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num
split xpath streaming choice when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num tiny incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num
if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml
log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num med incrementAndGet
String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num med incrementAndGet if num log info num log debug xml otherwise process new Processor
assertTrue xml contains xml int num small incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num med incrementAndGet if num log info num log debug xml otherwise process new Processor public void process Exchange exchange throws Exception
Override protected void doStart throws Exception super doStart if transformerFactory null createTransformerFactory if rules null try LOG debug path InputStream schRules ResourceHelper resolveMandatoryResourceAsInputStream getCamelContext path rules TemplatesFactory newInstance getTemplates schRules transformerFactory catch Exception classPathException LOG debug path try InputStream schRules FileUtils openInputStream new File path rules TemplatesFactory newInstance getTemplates schRules transformerFactory catch FileNotFoundException e
createTransformerFactory if rules null try LOG debug path InputStream schRules ResourceHelper resolveMandatoryResourceAsInputStream getCamelContext path rules TemplatesFactory newInstance getTemplates schRules transformerFactory catch Exception classPathException LOG debug path try InputStream schRules FileUtils openInputStream new File path rules TemplatesFactory newInstance getTemplates schRules transformerFactory catch FileNotFoundException e LOG debug path throw classPathException if rules null
private void createTransformerFactory throws ClassNotFoundException Class TransformerFactory factoryClass getCamelContext getClassResolver resolveMandatoryClass SAXON_TRANSFORMER_FACTORY_CLASS_NAME TransformerFactory class SchematronComponent class getClassLoader
Override public void process Exchange exchange throws Exception final SchematronProcessor schematronProcessor SchematronProcessorFactory newSchematronEngine endpoint getRules final Object payload exchange getIn getBody final String report if payload Source
final SchematronProcessor schematronProcessor SchematronProcessorFactory newSchematronEngine endpoint getRules final Object payload exchange getIn getBody final String report if payload Source LOG debug payload report schematronProcessor validate Source payload else if payload String LOG debug payload report schematronProcessor validate String payload else String stringPayload exchange getIn getBody String class LOG debug stringPayload report schematronProcessor validate stringPayload LOG debug report String status getValidationStatus report
Test public void testValidXML throws Exception String payload IOUtils toString ClassLoader getSystemResourceAsStream
Test public void testValidXML throws Exception String payload IOUtils toString ClassLoader getSystemResourceAsStream logger info payload String result getProcessor null validate payload
Test public void testInvalidXMLWithClientResolver throws Exception String payload IOUtils toString ClassLoader getSystemResourceAsStream
Test public void testInvalidXMLWithClientResolver throws Exception String payload IOUtils toString ClassLoader getSystemResourceAsStream logger info payload String result getProcessor new ClientUriResolver validate payload
Test public void testInValidXML throws Exception String payload IOUtils toString ClassLoader getSystemResourceAsStream
Test public void testInValidXML throws Exception String payload IOUtils toString ClassLoader getSystemResourceAsStream logger info payload String result getProcessor null validate payload
public synchronized BlockingQueue Exchange getQueue if queue null if getComponent null Integer size getSize Integer MAX_VALUE getSize SedaConstants QUEUE_SIZE null getSize QueueReference ref getComponent getOrCreateQueue this size isMultipleConsumers queueFactory queue ref getQueue String key getComponent getQueueKey getEndpointUri
Override protected void doStart throws Exception super doStart final ServiceEndpoint endpoint ServiceEndpoint getEndpoint final ServiceDefinition definition endpoint getServiceDefinition
public ServiceNowClient query Class model if model null String name String value for ServiceNowSysParm parm model getAnnotationsByType ServiceNowSysParm class name parm name value parm value if ObjectHelper isNotEmpty name ObjectHelper isNotEmpty value
private Optional MetaData tableDefinition MetaContext context throws Exception final List String names getObjectHierarchy context final ObjectNode root context getConfiguration getOrCreateMapper createObjectNode final String baseUrn String context getParameters getOrDefault root put root put String format baseUrn context getObjectName root put root put false root putObject root putArray loadProperties context for String name names context getStack push name
Optional JsonNode response context getClient reset types MediaType APPLICATION_JSON_TYPE path path context getConfiguration getApiVersion path path query query query trasform HttpMethod GET this :: findResultNode if response isPresent final JsonNode node response get final JsonNode sysId node findValue response context getClient reset types MediaType APPLICATION_JSON_TYPE path path context getConfiguration getApiVersion path path query query trasform HttpMethod GET this :: findResultNode if response isPresent final ObjectNode root context getConfiguration getOrCreateMapper createObjectNode processResult response get n final JsonNode superClass n findValue final JsonNode name n findValue final JsonNode label n findValue if superClass null final String impId sysId null sysId textValue null final String superId superClass textValue if impId null superId null ObjectHelper equal impId superId
String excludeKey context getObjectName String fields String context getParameters get includeKey String exclude String context getParameters get excludeKey boolean included true if ObjectHelper isNotEmpty fields ObjectHelper isNotEmpty exclude boolean isIncluded Stream of fields split map StringHelper :: trimToNull filter Objects :: nonNull anyMatch id :: equalsIgnoreCase boolean isExcluded Pattern compile exclude matcher id matches included isIncluded isExcluded else if ObjectHelper isNotEmpty fields included Stream of fields split map StringHelper :: trimToNull filter Objects :: nonNull anyMatch id :: equalsIgnoreCase else if ObjectHelper isNotEmpty exclude included Pattern compile exclude matcher id matches if included return context getStack push id
private synchronized void getOrRefreshAccessToken if token null LOGGER debug token OAuthClientUtils getAccessToken WebClient create configuration getOauthTokenUrl new Consumer configuration getOauthClientId configuration getOauthClientSecret new ResourceOwnerGrant configuration getUserName configuration getPassword true
MockEndpoint mock getMockEndpoint mock reset mock expectedMessageCount incident new Incident incident setDescription incident setShortDescription incident setSeverity incident setImpact template sendBodyAndHeaders incident kvBuilder put ServiceNowConstants RESOURCE put ServiceNowConstants ACTION ServiceNowConstants ACTION_CREATE put ServiceNowParams PARAM_TABLE_NAME build mock assertIsSatisfied incident mock getExchanges get getIn getBody Incident class sysId incident getId number incident getNumber LOGGER info LOGGER info
mock reset mock expectedMessageCount incident new Incident incident setDescription incident setShortDescription incident setSeverity incident setImpact template sendBodyAndHeaders incident kvBuilder put ServiceNowConstants RESOURCE put ServiceNowConstants ACTION ServiceNowConstants ACTION_CREATE put ServiceNowParams PARAM_TABLE_NAME build mock assertIsSatisfied incident mock getExchanges get getIn getBody Incident class sysId incident getId number incident getNumber LOGGER info LOGGER info LOGGER info sysId
incident new Incident incident setDescription incident setShortDescription incident setSeverity incident setImpact template sendBodyAndHeaders incident kvBuilder put ServiceNowConstants RESOURCE put ServiceNowConstants ACTION ServiceNowConstants ACTION_CREATE put ServiceNowParams PARAM_TABLE_NAME build mock assertIsSatisfied incident mock getExchanges get getIn getBody Incident class sysId incident getId number incident getNumber LOGGER info LOGGER info LOGGER info sysId LOGGER info number LOGGER info
number incident getNumber LOGGER info LOGGER info LOGGER info sysId LOGGER info number LOGGER info LOGGER info sysId mock reset mock expectedMessageCount template sendBodyAndHeaders null kvBuilder put ServiceNowConstants RESOURCE put ServiceNowConstants ACTION ServiceNowConstants ACTION_RETRIEVE put ServiceNowParams PARAM_TABLE_NAME put ServiceNowParams SYSPARM_QUERY number build mock assertIsSatisfied List Incident incidents mock getExchanges get getIn getBody List class assertEquals incidents size assertEquals number incidents get getNumber assertEquals sysId incidents get getId
assertEquals number incidents get getNumber assertEquals sysId incidents get getId LOGGER info sysId mock reset mock expectedMessageCount incident new Incident incident setDescription incident setShortDescription incident setSeverity incident setImpact template sendBodyAndHeaders incident kvBuilder put ServiceNowConstants RESOURCE put ServiceNowConstants ACTION ServiceNowConstants ACTION_MODIFY put ServiceNowParams PARAM_TABLE_NAME put ServiceNowParams PARAM_SYS_ID sysId build mock assertIsSatisfied incident mock getExchanges get getIn getBody Incident class assertEquals number incident getNumber assertEquals incident getSeverity
template sendBodyAndHeaders incident kvBuilder put ServiceNowConstants RESOURCE put ServiceNowConstants ACTION ServiceNowConstants ACTION_MODIFY put ServiceNowParams PARAM_TABLE_NAME put ServiceNowParams PARAM_SYS_ID sysId build mock assertIsSatisfied incident mock getExchanges get getIn getBody Incident class assertEquals number incident getNumber assertEquals incident getSeverity assertEquals incident getImpact assertEquals incident getShortDescription LOGGER info sysId mock reset mock expectedMessageCount template sendBodyAndHeaders null kvBuilder put ServiceNowConstants RESOURCE put ServiceNowConstants ACTION ServiceNowConstants ACTION_RETRIEVE put ServiceNowParams PARAM_TABLE_NAME put ServiceNowParams SYSPARM_QUERY number build mock assertIsSatisfied List Incident incidents mock getExchanges get getIn getBody List class assertEquals incidents size assertEquals number incidents get getNumber
mock reset mock expectedMessageCount template sendBodyAndHeaders null kvBuilder put ServiceNowConstants RESOURCE put ServiceNowConstants ACTION ServiceNowConstants ACTION_RETRIEVE put ServiceNowParams PARAM_TABLE_NAME put ServiceNowParams SYSPARM_QUERY number build mock assertIsSatisfied List Incident incidents mock getExchanges get getIn getBody List class assertEquals incidents size assertEquals number incidents get getNumber assertEquals sysId incidents get getId assertEquals incidents get getSeverity assertEquals incidents get getImpact assertEquals incidents get getShortDescription LOGGER info sysId mock reset mock expectedMessageCount template sendBodyAndHeaders null kvBuilder put ServiceNowConstants RESOURCE put ServiceNowConstants ACTION ServiceNowConstants ACTION_RETRIEVE put ServiceNowParams PARAM_TABLE_NAME put ServiceNowParams PARAM_SYS_ID sysId build
assertEquals incidents size assertEquals number incidents get getNumber assertEquals sysId incidents get getId assertEquals incidents get getSeverity assertEquals incidents get getImpact assertEquals incidents get getShortDescription LOGGER info sysId mock reset mock expectedMessageCount template sendBodyAndHeaders null kvBuilder put ServiceNowConstants RESOURCE put ServiceNowConstants ACTION ServiceNowConstants ACTION_RETRIEVE put ServiceNowParams PARAM_TABLE_NAME put ServiceNowParams PARAM_SYS_ID sysId build mock assertIsSatisfied incident mock getExchanges get getIn getBody Incident class assertEquals incident getSeverity assertEquals incident getImpact assertEquals incident getShortDescription
Test public void testDateTimeWithDefaults throws Exception final ServiceNowConfiguration configuration new ServiceNowConfiguration ObjectMapper mapper configuration getOrCreateMapper DateTimeBean bean new DateTimeBean String serialized mapper writeValueAsString bean
Test public void testDateTimeWithCustomFormats throws Exception final ServiceNowConfiguration configuration new ServiceNowConfiguration configuration setDateFormat configuration setTimeFormat ObjectMapper mapper configuration getOrCreateMapper DateTimeBean bean new DateTimeBean String serialized mapper writeValueAsString bean
String ext FileUtil onlyExt fileName if ext null ext ext toLowerCase Locale US String whiteList getFileNameExtWhitelist toLowerCase Locale US if whiteList equals whiteList contains ext accepted false if accepted DataSource ds new PartDataSource part Attachment attachment new DefaultAttachment ds for String headerName part getHeaderNames for String headerValue part getHeaders headerName attachment addHeader headerName headerValue AttachmentMessage am message getExchange getMessage AttachmentMessage class am addAttachmentObject part getName attachment else
ignoreDuplicateServletName bool else String msg ignore LOG error msg throw new ServletException msg String name config getServletName String contextPath config getServletContext getContextPath if httpRegistry null httpRegistry DefaultHttpRegistry getHttpRegistry name HttpRegistryProvider existing httpRegistry getCamelServlet name if existing null String msg name existing this toString if isIgnoreDuplicateServletName LOG warn msg else
LOG error msg throw new ServletException msg String name config getServletName String contextPath config getServletContext getContextPath if httpRegistry null httpRegistry DefaultHttpRegistry getHttpRegistry name HttpRegistryProvider existing httpRegistry getCamelServlet name if existing null String msg name existing this toString if isIgnoreDuplicateServletName LOG warn msg else LOG error msg throw new ServletException msg httpRegistry register this
Override public Processor wrap Route route final Processor processor if LOG isDebugEnabled
authorized true break else if policy getRolesList isEmpty if policy isAllRolesRequired authorized currentUser hasAllRoles policy getRolesList else for String role policy getRolesList if currentUser hasRole role authorized true break else LOG trace authorized true if authorized throw new CamelAuthorizationException exchange
Override public void processRequest RequestEvent requestEvent Request request requestEvent getRequest ServerTransaction serverTransactionId requestEvent getServerTransaction
Override public void processRequest RequestEvent requestEvent Request request requestEvent getRequest ServerTransaction serverTransactionId requestEvent getServerTransaction LOG debug request getMethod
private void processPublish RequestEvent requestEvent ServerTransaction serverTransactionId try Request request requestEvent getRequest LOG debug
public void processSubscribe RequestEvent requestEvent ServerTransaction serverTransaction SipProvider sipProvider SipProvider requestEvent getSource Request request requestEvent getRequest try LOG debug
if st null st sipProvider getNewServerTransaction request boolean isInitial requestEvent getDialog null if isInitial String toTag UUID randomUUID toString response sipPresenceAgent getConfiguration getMessageFactory createResponse request ToHeader toHeader ToHeader response getHeader ToHeader NAME toHeader setTag toTag this dialog st getDialog this dialog terminateOnBye false else response sipPresenceAgent getConfiguration getMessageFactory createResponse request response addHeader sipPresenceAgent getConfiguration getContactHeader response addHeader sipPresenceAgent getConfiguration getExpiresHeader st sendResponse response
Override public synchronized void processResponse ResponseEvent responseReceivedEvent Response response responseReceivedEvent getResponse Integer statusCode response getStatusCode if SIP_MESSAGE_CODES containsKey statusCode
Override public void processRequest RequestEvent requestReceivedEvent Request request requestReceivedEvent getRequest ServerTransaction serverTransactionId requestReceivedEvent getServerTransaction String viaBranch ViaHeader request getHeaders ViaHeader NAME next getParameter
Override public void processRequest RequestEvent requestReceivedEvent Request request requestReceivedEvent getRequest ServerTransaction serverTransactionId requestReceivedEvent getServerTransaction String viaBranch ViaHeader request getHeaders ViaHeader NAME next getParameter LOG debug request getMethod
Override public void processRequest RequestEvent requestReceivedEvent Request request requestReceivedEvent getRequest ServerTransaction serverTransactionId requestReceivedEvent getServerTransaction String viaBranch ViaHeader request getHeaders ViaHeader NAME next getParameter LOG debug request getMethod LOG debug serverTransactionId
if serverTransactionId null LOG info serverTransactionId provider getNewServerTransaction notify Dialog dialog serverTransactionId getDialog if dialog subscriberDialog forkedDialog dialog dispatchExchange notify getContent Response response sipSubscriber getConfiguration getMessageFactory createResponse notify response addHeader sipSubscriber getConfiguration getContactHeader serverTransactionId sendResponse response SubscriptionStateHeader subscriptionState SubscriptionStateHeader notify getHeader SubscriptionStateHeader NAME if subscriptionState getState equalsIgnoreCase SubscriptionStateHeader TERMINATED LOG info dialog delete catch Exception e
Override public void processResponse ResponseEvent responseReceivedEvent LOG debug Response response responseReceivedEvent getResponse Transaction clientTransactionId responseReceivedEvent getClientTransaction
ExceptionListener exceptionListener conn getExceptionListener ReconnectExceptionListener reconnectExceptionListener new ReconnectExceptionListener conn if exceptionListener null exceptionListener reconnectExceptionListener else exceptionListener new AggregatedExceptionListener exceptionListener reconnectExceptionListener conn setExceptionListener exceptionListener answer new MessageConsumerResources session messageConsumer consumers compute conn key oldValue if oldValue null oldValue new ArrayList oldValue add answer return oldValue catch Exception e
private boolean refillPool BackOffTimer Task task LOG debug try fillConsumersPool
Override public boolean process final Exchange exchange final AsyncCallback callback if LOG isDebugEnabled
if producer null exchange setException new Exception else if isSynchronous if LOG isDebugEnabled LOG debug exchange getIn getBody getExecutor execute new Runnable Override public void run try sendMessage exchange callback producer releaseProducerCallback catch Exception e RuntimeCamelException wrapRuntimeCamelException e else if LOG isDebugEnabled
else if isSynchronous if LOG isDebugEnabled LOG debug exchange getIn getBody getExecutor execute new Runnable Override public void run try sendMessage exchange callback producer releaseProducerCallback catch Exception e RuntimeCamelException wrapRuntimeCamelException e else if LOG isDebugEnabled LOG debug exchange getIn getBody sendMessage exchange callback producer releaseProducerCallback
Override public void onMessage Message message RuntimeCamelException rce null try final Exchange exchange getEndpoint createExchange message getSession
finally lock writeLock unlock MessageHandlerAsyncCallback callback new MessageHandlerAsyncCallback exchange messageProducer if exchange isFailed return else if isTransacted isSynchronous log debug exchange getIn getBody getEndpoint getEndpointUri try getProcessor process exchange catch Exception e exchange setException e finally callback done true else
public Message makeJmsMessage Exchange exchange Object body Map headers Session session Exception cause throws JMSException Message answer null if answer null if cause null
Object responseObject null Exchanger Object messageExchanger new Exchanger JmsMessageHelper setCorrelationId request correlationId EXCHANGERS put correlationId messageExchanger MessageConsumerResources consumer consumers borrowObject JmsMessageHelper setJMSReplyTo request consumer getReplyToDestination consumers returnObject consumer producer getMessageProducer send request try releaseProducerCallback release producer catch Exception exception try responseObject messageExchanger exchange null getResponseTimeOut TimeUnit MILLISECONDS EXCHANGERS remove correlationId catch InterruptedException e
JmsMessageHelper setCorrelationId request correlationId EXCHANGERS put correlationId messageExchanger MessageConsumerResources consumer consumers borrowObject JmsMessageHelper setJMSReplyTo request consumer getReplyToDestination consumers returnObject consumer producer getMessageProducer send request try releaseProducerCallback release producer catch Exception exception try responseObject messageExchanger exchange null getResponseTimeOut TimeUnit MILLISECONDS EXCHANGERS remove correlationId catch InterruptedException e LOG debug e exchange setException e
Override public void onFailure Exchange exchange try lock readLock lock if commitStrategy rollback exchange if LOG isDebugEnabled
Override public void onComplete Exchange exchange try lock readLock lock if commitStrategy commit exchange if LOG isDebugEnabled
Override public void onFailure Exchange exchange try if commitStrategy rollback exchange
Override public void onComplete Exchange exchange try if commitStrategy commit exchange
int completionSize fromF queueName completionTimeout completionSize consumerCount routeId startupOrder autoStartup false split body to context start MockEndpoint mockBefore getMockEndpoint mockBefore setExpectedMessageCount messageCount MockEndpoint mockSplit getMockEndpoint mockSplit setExpectedMessageCount messageCount LOG info template sendBody generateStrings messageCount LOG info StopWatch stopWatch new StopWatch context getRouteController startRoute assertMockEndpointsSatisfied long time stopWatch taken
fromF queueName completionTimeout completionSize consumerCount routeId startupOrder autoStartup false split body to context start MockEndpoint mockBefore getMockEndpoint mockBefore setExpectedMessageCount messageCount MockEndpoint mockSplit getMockEndpoint mockSplit setExpectedMessageCount messageCount LOG info template sendBody generateStrings messageCount LOG info StopWatch stopWatch new StopWatch context getRouteController startRoute assertMockEndpointsSatisfied long time stopWatch taken LOG info messageCount time
Override public boolean process final Exchange exchange final AsyncCallback callback executor submit LOG info getEndpoint getDelay Thread sleep getEndpoint getDelay int count counter incrementAndGet if getEndpoint getFailFirstAttempts count
Override public void onMessage Message message String messageText null try if message TextMessage TextMessage textMessage TextMessage message messageText textMessage getText
private int getMbeanCount final String name throws MalformedObjectNameException MBeanServer mbs ManagementFactory getPlatformMBeanServer Set ObjectInstance mbeans mbs queryMBeans new ObjectName null
private int getMbeanCount final String name throws MalformedObjectNameException MBeanServer mbs ManagementFactory getPlatformMBeanServer Set ObjectInstance mbeans mbs queryMBeans new ObjectName null LOGGER debug mbeans size int count for ObjectInstance mbean mbeans
private void dumpThreads ThreadMXBean threadMXBean ManagementFactory getThreadMXBean for ThreadInfo threadInfo threadMXBean getThreadInfo threadMXBean getAllThreadIds Integer MAX_VALUE if Thread State BLOCKED equals threadInfo getThreadState
Test public void test throws Exception CamelContext context new DefaultCamelContext context addRoutes createRouteBuilder SjmsComponent component context getComponent SjmsComponent class component setConnectionFactory CamelJmsTestHelper createConnectionFactory FailedToStartRouteException t assertThrows FailedToStartRouteException class context :: start assertEquals IllegalArgumentException class t getCause getCause getClass
Object value entry getValue try if value null optParam new OptionalParameter Null key else if value byte optParam new OptionalParameter OctetString key byte value else if value String optParam new OptionalParameter COctetString key String value else if value Byte optParam new OptionalParameter Byte key Byte value else if value Integer optParam new OptionalParameter Int key Integer value else if value Short optParam new OptionalParameter Short key Short value else
else if value byte optParam new OptionalParameter OctetString key byte value else if value String optParam new OptionalParameter COctetString key String value else if value Byte optParam new OptionalParameter Byte key Byte value else if value Integer optParam new OptionalParameter Int key Integer value else if value Short optParam new OptionalParameter Short key Short value else log info value value getClass continue optParams add optParam catch Exception e
if superclass Object class ancestorClasses add superclass getSuperclass if ancestorClasses contains OctetString class optParam OptionalParameter type getConstructor byte class newInstance value getBytes else if ancestorClasses contains OptionalParameter Byte class Byte byteValue value null Byte valueOf value optParam OptionalParameter type getConstructor byte class newInstance byteValue else if ancestorClasses contains OptionalParameter Int class Integer intValue value null Integer valueOf value optParam OptionalParameter type getConstructor int class newInstance intValue else if ancestorClasses contains OptionalParameter Short class Short shortValue value null Short valueOf value optParam OptionalParameter type getConstructor short class newInstance shortValue optParams add optParam catch Exception e
Override public void onAcceptAlertNotification AlertNotification alertNotification
Override public void onAcceptDeliverSm DeliverSm deliverSm throws ProcessRequestException
Override public DataSmResult onAcceptDataSm DataSm dataSm Session session throws ProcessRequestException
Tag valueOfTag OptionalParameter Tag valueOf optPara tag if valueOfTag null if COctetString class isInstance optPara optParams put valueOfTag toString COctetString optPara getValueAsString else if org jsmpp bean OptionalParameter OctetString class isInstance optPara optParams put valueOfTag toString OctetString optPara getValueAsString else if org jsmpp bean OptionalParameter Byte class isInstance optPara optParams put valueOfTag toString Byte valueOf org jsmpp bean OptionalParameter Byte optPara getValue else if org jsmpp bean OptionalParameter Short class isInstance optPara optParams put valueOfTag toString Short valueOf org jsmpp bean OptionalParameter Short optPara getValue else if org jsmpp bean OptionalParameter Int class isInstance optPara optParams put valueOfTag toString Integer valueOf org jsmpp bean OptionalParameter Int optPara getValue else if Null class isInstance optPara optParams put valueOfTag toString null else
if COctetString class isInstance optPara optParams put valueOfTag toString COctetString optPara getValueAsString else if org jsmpp bean OptionalParameter OctetString class isInstance optPara optParams put valueOfTag toString OctetString optPara getValueAsString else if org jsmpp bean OptionalParameter Byte class isInstance optPara optParams put valueOfTag toString Byte valueOf org jsmpp bean OptionalParameter Byte optPara getValue else if org jsmpp bean OptionalParameter Short class isInstance optPara optParams put valueOfTag toString Short valueOf org jsmpp bean OptionalParameter Short optPara getValue else if org jsmpp bean OptionalParameter Int class isInstance optPara optParams put valueOfTag toString Integer valueOf org jsmpp bean OptionalParameter Int optPara getValue else if Null class isInstance optPara optParams put valueOfTag toString null else LOG debug optPara tag catch IllegalArgumentException e
Override public void execute Exchange exchange throws SmppException CancelSm cancelSm createCancelSm exchange if log isDebugEnabled
private void reconnect final long initialReconnectDelay if reconnectLock tryLock try Runnable r new Runnable public void run boolean reconnected false
Override public void execute Exchange exchange throws SmppException DataSm dataSm createDataSm exchange if log isDebugEnabled
Override protected Object createBody if command MessageRequest MessageRequest msgRequest MessageRequest command byte shortMessage msgRequest getShortMessage if shortMessage null shortMessage length return null Alphabet alphabet Alphabet parseDataCoding msgRequest getDataCoding if SmppUtils is8Bit alphabet return shortMessage String encoding ExchangeHelper getCharsetName getExchange false if ObjectHelper isEmpty encoding Charset isSupported encoding encoding configuration getEncoding try return new String shortMessage encoding catch UnsupportedEncodingException e
nliMessage this languageIdentifier System arraycopy message nliMessage message length return new byte nliMessage int segmentLength getSegmentLength int segmentNum message length segmentLength int messageLength message length if segmentNum MAX_SEG_COUNT segmentNum MAX_SEG_COUNT messageLength segmentNum segmentLength if messageLength segmentLength segmentNum byte segments new byte segmentNum int lengthOfData byte refNum getReferenceNumber for int i i segmentNum i
int messageLength message length if segmentNum MAX_SEG_COUNT segmentNum MAX_SEG_COUNT messageLength segmentNum segmentLength if messageLength segmentLength segmentNum byte segments new byte segmentNum int lengthOfData byte refNum getReferenceNumber for int i i segmentNum i logger debug i if segmentNum i lengthOfData messageLength i segmentLength else lengthOfData segmentLength
if segmentNum MAX_SEG_COUNT segmentNum MAX_SEG_COUNT messageLength segmentNum segmentLength if messageLength segmentLength segmentNum byte segments new byte segmentNum int lengthOfData byte refNum getReferenceNumber for int i i segmentNum i logger debug i if segmentNum i lengthOfData messageLength i segmentLength else lengthOfData segmentLength logger debug lengthOfData
Override public void process Exchange exchange throws Exception if session null if this configuration isLazySessionCreation if connectLock tryLock try if session null Message in exchange getIn String systemId in getHeader SmppConstants SYSTEM_ID String class String password in getHeader SmppConstants PASSWORD String class if systemId null password null
private void reconnect final long initialReconnectDelay if connectLock tryLock try Runnable r new Runnable public void run boolean reconnected false
Override public void execute Exchange exchange throws SmppException QuerySm querySm createQuerySm exchange if log isDebugEnabled
Override public void execute Exchange exchange throws SmppException byte message getShortMessage exchange getIn ReplaceSm replaceSm createReplaceSmTempate exchange replaceSm setShortMessage message if log isDebugEnabled
Override public void execute Exchange exchange throws SmppException SubmitMulti submitMulties createSubmitMulti exchange List SubmitMultiResult results new ArrayList submitMulties length for SubmitMulti submitMulti submitMulties SubmitMultiResult result if log isDebugEnabled
Override public void execute Exchange exchange throws SmppException SubmitSm submitSms createSubmitSm exchange List String messageIDs new ArrayList submitSms length for int i i submitSms length i SubmitSm submitSm submitSms i String messageID if log isDebugEnabled
UsmUser user new UsmUser convertToOctetString endpoint getSecurityName authProtocol authPwd privProtocol privPwd usm addUser convertToOctetString endpoint getSecurityName user ScopedPDU scopedPDU new ScopedPDU if endpoint getSnmpContextEngineId null scopedPDU setContextEngineID new OctetString endpoint getSnmpContextEngineId if endpoint getSnmpContextName null scopedPDU setContextName new OctetString endpoint getSnmpContextName this pdu scopedPDU else CommunityTarget communityTarget new CommunityTarget communityTarget setCommunity convertToOctetString endpoint getSnmpCommunity communityTarget setAddress targetAddress communityTarget setRetries endpoint getRetries communityTarget setTimeout endpoint getTimeout communityTarget setVersion endpoint getSnmpVersion
if endpoint getSnmpContextEngineId null scopedPDU setContextEngineID new OctetString endpoint getSnmpContextEngineId if endpoint getSnmpContextName null scopedPDU setContextName new OctetString endpoint getSnmpContextName this pdu scopedPDU else CommunityTarget communityTarget new CommunityTarget communityTarget setCommunity convertToOctetString endpoint getSnmpCommunity communityTarget setAddress targetAddress communityTarget setRetries endpoint getRetries communityTarget setTimeout endpoint getTimeout communityTarget setVersion endpoint getSnmpVersion this target communityTarget this pdu new PDU if LOG isDebugEnabled
Override protected void doStop throws Exception if this transport null this transport isListening LOG info targetAddress this transport close
int type this getPduType this endpoint getType this pdu setType type if endpoint isTreeList for OID oid this endpoint getOids this pdu add new VariableBinding oid else TreeUtils treeUtils new TreeUtils snmp new DefaultPDUFactory for OID oid this endpoint getOids List events treeUtils getSubtree target new OID oid for Object eventObj events TreeEvent event TreeEvent eventObj if event null LOG warn continue if event isError
Override public void onResponse ResponseEvent event Snmp event getSource cancel event getRequest this if event getRequest null event getResponse null
public void processPDU PDU pdu if LOG isDebugEnabled
Override protected void doStart throws Exception super doStart this targetAddress GenericAddress parse this endpoint getAddress
if LOG isInfoEnabled LOG info this endpoint getAddress this listenGenericAddress GenericAddress parse this endpoint getAddress if equals endpoint getProtocol this transport new DefaultTcpTransportMapping TcpAddress this listenGenericAddress else if equals endpoint getProtocol this transport new DefaultUdpTransportMapping UdpAddress this listenGenericAddress else throw new IllegalArgumentException endpoint getProtocol this snmp new Snmp transport this snmp addCommandResponder this if LOG isDebugEnabled LOG debug endpoint getAddress endpoint getProtocol this transport listen if LOG isInfoEnabled
public void processPDU PDU pdu CommandResponderEvent event if LOG isDebugEnabled
Override protected void doStart throws Exception super doStart this targetAddress GenericAddress parse this endpoint getAddress
Test public void testSendReceiveTraps throws Exception PDU trap new PDU trap setType PDU TRAP OID oid new OID trap add new VariableBinding SnmpConstants snmpTrapOID oid trap add new VariableBinding SnmpConstants sysUpTime new TimeTicks trap add new VariableBinding SnmpConstants sysDescr new OctetString Variable var new OctetString trap add new VariableBinding oid var
Producer producer endpoint createProducer producer process exchange synchronized this Thread sleep MockEndpoint mock getMockEndpoint mock expectedMessageCount mock assertIsSatisfied List Exchange exchanges mock getExchanges SnmpMessage msg SnmpMessage exchanges get getIn PDU receivedTrap msg getSnmpMessage assertEquals trap receivedTrap if LOG isInfoEnabled LOG info Vector extends VariableBinding variableBindings receivedTrap getVariableBindings for VariableBinding vb variableBindings
ServiceInterfaceStrategy strategy new ServiceInterfaceStrategy CustomerService class true QName elName strategy findQNameForSoapActionOrType GetCustomersByName class assertEquals elName getNamespaceURI assertEquals elName getLocalPart QName elName2 strategy findQNameForSoapActionOrType GetCustomersByName class assertEquals elName2 getNamespaceURI assertEquals elName2 getLocalPart QName elName3 strategy findQNameForSoapActionOrType null assertNull elName3 QName elName4 strategy findQNameForSoapActionOrType null assertNull elName4 try elName strategy findQNameForSoapActionOrType Class class fail catch RuntimeCamelException e
private void shutdownServer SolrClient server throws IOException if server null
public static void putConfig String confName SolrZkClient zkClient File solrhome final String srcName String destName throws Exception File file new File solrhome File separator File separator srcName if file exists
static void createSolrFixtures throws Exception solrHttpsRunner JettySolrFactory createJettyTestFixture true httpsPort solrHttpsRunner getLocalPort
static void createSolrFixtures throws Exception solrHttpsRunner JettySolrFactory createJettyTestFixture true httpsPort solrHttpsRunner getLocalPort log info solrHttpsRunner getBaseUrl solrHttpsServer new HttpSolrClient Builder httpsPort withConnectionTimeout build solrRunner JettySolrFactory createJettyTestFixture false port solrRunner getLocalPort solrServer new HttpSolrClient Builder port build
Request request new Request Builder url SoroushService get generateUrl endpoint getAuthorizationToken SoroushAction getMessage null build OkHttpClient client new OkHttpClient Builder connectTimeout endpoint getConnectionTimeout TimeUnit MILLISECONDS writeTimeout 0L TimeUnit MILLISECONDS readTimeout 0L TimeUnit MILLISECONDS build connection new ReconnectableEventSourceListener client request endpoint getMaxConnectionRetry Override protected boolean onBeforeConnect int connectionRetry getConnectionRetry try endpoint waitBeforeRetry connectionRetry catch InterruptedException e return false if shutdown if connectionRetry if LOG isInfoEnabled LOG info else if LOG isInfoEnabled
private UploadFileResponse uploadToServer InputStream inputStream SoroushMessage message String fileType throws SoroushException InterruptedException javax ws rs core Response response for int count count maxConnectionRetry count waitBeforeRetry count MultiPart multipart new MultiPart multipart setMediaType MediaType MULTIPART_FORM_DATA_TYPE multipart bodyPart new StreamDataBodyPart inputStream null MediaType APPLICATION_OCTET_STREAM_TYPE try if LOG isDebugEnabled
InputStream file message getFile if file null message getFileUrl null forceUpload if LOG isDebugEnabled LOG debug message UploadFileResponse response uploadToServer file message message setFileUrl response getFileUrl if LOG isDebugEnabled LOG debug response getFileUrl message InputStream thumbnail message getThumbnail if thumbnail null message getThumbnailUrl null if LOG isDebugEnabled LOG debug message UploadFileResponse response uploadToServer thumbnail message message setThumbnailUrl response getFileUrl if LOG isDebugEnabled
public void handleDownloadFiles SoroushMessage message throws SoroushException if message getFileUrl null message getFile null forceDownload if LOG isDebugEnabled
private InputStream downloadFromServer String fileUrl SoroushMessage message String type throws SoroushException Response response null for int i i maxConnectionRetry i WebTarget target getDownloadFileTarget fileUrl if LOG isDebugEnabled if i
private void sendMessage SoroushMessage message throws SoroushException MaximumConnectionRetryReachedException InterruptedException Response response for int count count endpoint getMaxConnectionRetry count endpoint waitBeforeRetry count try if LOG isDebugEnabled
while true Runnable task synchronized queue while queue isEmpty try queue wait catch InterruptedException e log error e getMessage Thread currentThread interrupt task queue poll if task null continue try task run catch RuntimeException e
if port args setPort port if scheme null args setScheme scheme if app null args setApp app if owner null args setOwner owner args setUsername username args setPassword password if isUseSunHttpsHandler String sunHandlerClassName Class URLStreamHandler clazz camelContext getClassResolver resolveClass sunHandlerClassName URLStreamHandler class if clazz null URLStreamHandler handler camelContext getInjector newInstance clazz
private void createWriter ProducerType producerType switch producerType case TCP LOG debug dataWriter new TcpDataWriter endpoint buildSplunkArgs TcpDataWriter dataWriter setPort endpoint getConfiguration getTcpReceiverPort
LOG debug dataWriter new TcpDataWriter endpoint buildSplunkArgs TcpDataWriter dataWriter setPort endpoint getConfiguration getTcpReceiverPort LOG debug endpoint break case SUBMIT LOG debug dataWriter new SubmitDataWriter endpoint buildSplunkArgs SubmitDataWriter dataWriter setIndex endpoint getConfiguration getIndex LOG debug endpoint break case STREAM LOG debug dataWriter new StreamDataWriter endpoint buildSplunkArgs StreamDataWriter dataWriter setIndex endpoint getConfiguration getIndex
private List SplunkEvent runQuery JobArgs queryArgs boolean realtime SplunkResultProcessor callback throws Exception Service service endpoint getService Job job service getJobs create getSearch queryArgs
protected synchronized void doWrite String event throws IOException
JobParametersBuilder parametersBuilder new JobParametersBuilder for Map Entry String Object headerEntry headers entrySet String headerKey headerEntry getKey Object headerValue headerEntry getValue if headerValue Date parametersBuilder addDate headerKey Date headerValue else if headerValue Long parametersBuilder addLong headerKey Long headerValue else if headerValue Double parametersBuilder addDouble headerKey Double headerValue else if headerValue null parametersBuilder addString headerKey headerValue toString else parametersBuilder addString headerKey null JobParameters jobParameters parametersBuilder toJobParameters
Override SuppressWarnings public O process I i throws Exception
Override SuppressWarnings public I read throws Exception LOG debug I item I consumerTemplate receiveBody endpointUri
Override public void write List extends I items throws Exception for I item items
Override public void beforeJob JobExecution jobExecution
Override public void afterJob JobExecution jobExecution
return if getEndpoint isInOut MessageChannel reply null Object returnAddress siInMessage getHeaders getReplyChannel if returnAddress null if returnAddress String reply context getApplicationContext getBean String returnAddress MessageChannel class else if returnAddress MessageChannel reply MessageChannel returnAddress else reply outputChannel if reply null throw new IllegalArgumentException getEndpoint if reply null throw new IllegalArgumentException siInMessage
Override public void onApplicationEvent ContextRefreshedEvent event ApplicationContext applicationContext event getApplicationContext if this applicationContext equals applicationContext CamelContext camelContext event getApplicationContext getBean CamelContext class if camelContext getStatus isStopped
Override public void onApplicationEvent ContextRefreshedEvent event ApplicationContext applicationContext event getApplicationContext if this applicationContext equals applicationContext CamelContext camelContext event getApplicationContext getBean CamelContext class if camelContext getStatus isStopped LOG debug camelContext getName for RoutesBuilder routesBuilder configuration routes boolean abs Modifier isAbstract routesBuilder getClass getModifiers if abs try
Override protected void doStop throws Exception try if additionalApplicationContext null
else return new FileSystemXmlApplicationContext args String args getApplicationContextUri split if parentContext null return new ClassPathXmlApplicationContext args parentContext else if mainConfigurationProperties getRoutesBuilderClasses null AnnotationConfigApplicationContext ac new AnnotationConfigApplicationContext ac register SpringCamelContext class Set String packages new LinkedHashSet String classes mainConfigurationProperties getRoutesBuilderClasses split for String clazz classes if clazz contains String packageName clazz substring clazz lastIndexOf packages add packageName
protected AbstractApplicationContext createAdditionalLocationsFromClasspath throws IOException Set String locations new LinkedHashSet findLocations locations Main class getClassLoader if locations isEmpty
private Authentication authenticateIfRequired Authentication authentication if authentication isAuthenticated alwaysReauthenticate
private void addConsumerConfiguration String remaining Map String Object parameters SpringWebserviceConfiguration configuration EndpointMappingType type EndpointMappingType getTypeFromUriPrefix remaining if type null
default throw new RuntimeCamelException if compositeOrSimpleKey null key getLookupKey equals compositeOrSimpleKey LOG debug key return endpoints get key for EndpointMappingKey key endpoints keySet String simpleKey null switch key getType case ACTION if map getAction null simpleKey map getAction toString break case TO if map getTo null simpleKey map getTo toString break default throw new RuntimeCamelException if simpleKey null key getLookupKey equals simpleKey
private TransformerFactory getTransformerFactory CamelContext context TransformerFactory transformerFactory null if saxon transformerFactory getSaxonTransformerFactory context else transformerFactory TransformerFactory newInstance if transformerFactory null throw new IllegalStateException try transformerFactory setFeature XMLConstants FEATURE_SECURE_PROCESSING Boolean TRUE catch TransformerConfigurationException ex transformerFactory setErrorListener new ErrorListener Override public void warning TransformerException exception throws TransformerException LOG warn SOAP_HEADER_TRANSFORMATION_PROBLEM exception Override public void fatalError TransformerException exception throws TransformerException
if saxon transformerFactory getSaxonTransformerFactory context else transformerFactory TransformerFactory newInstance if transformerFactory null throw new IllegalStateException try transformerFactory setFeature XMLConstants FEATURE_SECURE_PROCESSING Boolean TRUE catch TransformerConfigurationException ex transformerFactory setErrorListener new ErrorListener Override public void warning TransformerException exception throws TransformerException LOG warn SOAP_HEADER_TRANSFORMATION_PROBLEM exception Override public void fatalError TransformerException exception throws TransformerException LOG error SOAP_HEADER_TRANSFORMATION_PROBLEM exception Override public void error TransformerException exception throws TransformerException
Override public void afterPropertiesSet throws Exception StopWatch watch new StopWatch super afterPropertiesSet Boolean shutdownEager CamelContextHelper parseBoolean getContext getShutdownEager if shutdownEager null
Override protected void initCustomRegistry SpringCamelContext context Registry registry getBeanForType Registry class if registry null
Override protected void initPropertyPlaceholder throws Exception super initPropertyPlaceholder Map String BridgePropertyPlaceholderConfigurer beans applicationContext getBeansOfType BridgePropertyPlaceholderConfigurer class if beans size BridgePropertyPlaceholderConfigurer configurer beans values iterator next String id beans keySet iterator next
public void appendBuilders List RoutesBuilder list Map String RoutesBuilder beans applicationContext getBeansOfType RoutesBuilder class includeNonSingletons true for Entry String RoutesBuilder entry beans entrySet Object bean entry getValue Object key entry getKey LOG trace key bean if shouldIgnoreBean bean
public void appendBuilders List RoutesBuilder list throws IllegalAccessException InstantiationException Set Class classes resolver findImplementations RoutesBuilder class packages for Class aClass classes LOG trace aClass if shouldIgnoreBean aClass
Override public void onApplicationEvent ApplicationEvent event
if node getNodeType Node ELEMENT_NODE Document doc node getOwnerDocument if node getNamespaceURI startsWith SPRING_NS doc renameNode node SPRING_NS node getNodeName NamedNodeMap map node getAttributes for int i i map getLength i Node att map item i if att getNodeName equals att getNodeName endsWith final String value att getNodeValue String before StringHelper before value String after StringHelper after value if before null after null String changed after replaceAll if after equals changed String newAtr before trim changed trim
if child Element Element childElement Element child String localName childElement getLocalName if equals localName template true else if equals localName fluentTemplate true else if equals localName consumerTemplate true if template boolean existing autoRegisterMap get null boolean inUse false try inUse parserContext getRegistry isBeanNameInUse catch BeanCreationException e
if template boolean existing autoRegisterMap get null boolean inUse false try inUse parserContext getRegistry isBeanNameInUse catch BeanCreationException e LOG debug e if inUse existing String id Element templateElement element getOwnerDocument createElement templateElement setAttribute id BeanDefinitionParser parser parserMap get BeanDefinition definition parser parse templateElement parserContext autoRegisterBeanDefinition id definition parserContext contextId if fluentTemplate
BeanDefinition definition parser parse templateElement parserContext autoRegisterBeanDefinition id definition parserContext contextId if fluentTemplate boolean existing autoRegisterMap get null boolean inUse false try inUse parserContext getRegistry isBeanNameInUse catch BeanCreationException e LOG debug e if inUse existing String id Element templateElement element getOwnerDocument createElement templateElement setAttribute id BeanDefinitionParser parser parserMap get BeanDefinition definition parser parse templateElement parserContext
private void autoRegisterBeanDefinition String id BeanDefinition definition ParserContext parserContext String contextId BeanDefinition existing autoRegisterMap get id if existing null autoRegisterMap put id definition parserContext registerComponent new BeanComponentDefinition definition id if LOG isDebugEnabled
private void registerEndpoint Element childElement ParserContext parserContext String contextId String id childElement getAttribute if ObjectHelper isNotEmpty id if id startsWith
Override public Processor wrap Route route Processor processor TransactionErrorHandler answer RouteDefinition routeDefinition RouteDefinition route getRoute ErrorHandlerBuilder builder ErrorHandlerBuilder routeDefinition getErrorHandlerFactory if builder ErrorHandlerBuilderRef ErrorHandlerBuilderRef builderRef ErrorHandlerBuilderRef builder String ref builderRef getRef if ErrorHandlerReifier isErrorHandlerFactoryConfigured ref
Override public Processor wrap Route route Processor processor TransactionErrorHandler answer RouteDefinition routeDefinition RouteDefinition route getRoute ErrorHandlerBuilder builder ErrorHandlerBuilder routeDefinition getErrorHandlerFactory if builder ErrorHandlerBuilderRef ErrorHandlerBuilderRef builderRef ErrorHandlerBuilderRef builder String ref builderRef getRef if ErrorHandlerReifier isErrorHandlerFactoryConfigured ref LOG debug ref builder ErrorHandlerBuilder ErrorHandlerReifier lookupErrorHandlerFactory route ref if builder null builder supportTransacted LOG debug builder answer createTransactionErrorHandler route processor builder else if builder null
doInTransactionTemplate exchange logTransactionCommit redelivered ids catch TransactionRollbackException e logTransactionRollback redelivered ids null true catch Throwable e exchange setException e logTransactionRollback redelivered ids e false finally if exchange getUnitOfWork null exchange getUnitOfWork endTransactedBy transactionKey boolean onlyLast exchange isRollbackOnlyLast exchange setRollbackOnlyLast false if onlyLast if LOG isDebugEnabled Exception cause exchange getException
catch TransactionRollbackException e logTransactionRollback redelivered ids null true catch Throwable e exchange setException e logTransactionRollback redelivered ids e false finally if exchange getUnitOfWork null exchange getUnitOfWork endTransactedBy transactionKey boolean onlyLast exchange isRollbackOnlyLast exchange setRollbackOnlyLast false if onlyLast if LOG isDebugEnabled Exception cause exchange getException if cause null LOG debug transactionKey redelivered ids cause
private void logTransactionBegin String redelivered String ids if LOG isDebugEnabled
private void logTransactionCommit String redelivered String ids if equals redelivered if rollbackLoggingLevel LoggingLevel INFO rollbackLoggingLevel LoggingLevel WARN rollbackLoggingLevel LoggingLevel ERROR
private void logTransactionRollback String redelivered String ids Throwable e boolean rollbackOnly if rollbackLoggingLevel LoggingLevel OFF return else if rollbackLoggingLevel LoggingLevel ERROR LOG isErrorEnabled if rollbackOnly LOG error transactionKey redelivered ids else LOG error transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel WARN LOG isWarnEnabled if rollbackOnly LOG warn transactionKey redelivered ids else LOG warn transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel INFO LOG isInfoEnabled if rollbackOnly
return else if rollbackLoggingLevel LoggingLevel ERROR LOG isErrorEnabled if rollbackOnly LOG error transactionKey redelivered ids else LOG error transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel WARN LOG isWarnEnabled if rollbackOnly LOG warn transactionKey redelivered ids else LOG warn transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel INFO LOG isInfoEnabled if rollbackOnly LOG info transactionKey redelivered ids else
if rollbackOnly LOG error transactionKey redelivered ids else LOG error transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel WARN LOG isWarnEnabled if rollbackOnly LOG warn transactionKey redelivered ids else LOG warn transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel INFO LOG isInfoEnabled if rollbackOnly LOG info transactionKey redelivered ids else LOG info transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel DEBUG LOG isDebugEnabled
else LOG error transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel WARN LOG isWarnEnabled if rollbackOnly LOG warn transactionKey redelivered ids else LOG warn transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel INFO LOG isInfoEnabled if rollbackOnly LOG info transactionKey redelivered ids else LOG info transactionKey redelivered ids e getMessage else if rollbackLoggingLevel LoggingLevel DEBUG LOG isDebugEnabled if rollbackOnly LOG debug transactionKey redelivered ids
if mapPolicy null mapPolicy size TransactedPolicy policy mapPolicy values iterator next if policy SpringTransactionPolicy transactionTemplate SpringTransactionPolicy policy getTransactionTemplate if transactionTemplate null TransactedPolicy policy lookup PROPAGATION_REQUIRED TransactedPolicy class if policy SpringTransactionPolicy transactionTemplate SpringTransactionPolicy policy getTransactionTemplate if transactionTemplate null Map String TransactionTemplate mapTemplate findByTypeWithName TransactionTemplate class if mapTemplate null mapTemplate isEmpty LOG trace else if mapTemplate size transactionTemplate mapTemplate values iterator next else
if policy SpringTransactionPolicy transactionTemplate SpringTransactionPolicy policy getTransactionTemplate if transactionTemplate null Map String TransactionTemplate mapTemplate findByTypeWithName TransactionTemplate class if mapTemplate null mapTemplate isEmpty LOG trace else if mapTemplate size transactionTemplate mapTemplate values iterator next else LOG debug mapTemplate size if transactionTemplate null Map String PlatformTransactionManager mapManager findByTypeWithName PlatformTransactionManager class if mapManager null mapManager isEmpty LOG trace else if mapManager size
if transactionTemplate null Map String TransactionTemplate mapTemplate findByTypeWithName TransactionTemplate class if mapTemplate null mapTemplate isEmpty LOG trace else if mapTemplate size transactionTemplate mapTemplate values iterator next else LOG debug mapTemplate size if transactionTemplate null Map String PlatformTransactionManager mapManager findByTypeWithName PlatformTransactionManager class if mapManager null mapManager isEmpty LOG trace else if mapManager size transactionTemplate new TransactionTemplate mapManager values iterator next else
Test public void testSendingCamelExchangeToEndpointResultsInValidApplicationEventAfterTheRefreshEvent throws Exception MockEndpoint result resolveMandatoryEndpoint MockEndpoint class result expectedMessageCount template sendBodyAndHeader uri expectedBody result assertIsSatisfied Exchange exchange result getReceivedExchanges get Object body exchange getIn getBody ContextRefreshedEvent class
Test public void testSendingCamelExchangeToEndpointResultsInValidApplicationEventAfterTheRefreshEvent throws Exception MockEndpoint result resolveMandatoryEndpoint MockEndpoint class result expectedMessageCount template sendBodyAndHeader uri expectedBody result assertIsSatisfied Exchange exchange result getReceivedExchanges get Object body exchange getIn getBody ContextRefreshedEvent class log info body assertNotNull body exchange result getReceivedExchanges get body exchange getIn getBody
protected void assertValidContext SpringCamelContext context assertNotNull context List Route routes context getRoutes assertNotNull routes assertEquals routes size Route route routes get
Test public void testDumpModelAsXml throws Exception assertEquals context getRoutes get getId ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testEndpointConfiguration throws Exception Endpoint endpoint getMandatoryBean Endpoint class assertEquals endpoint getEndpointUri DummyBean dummyBean getMandatoryBean DummyBean class assertNotNull dummyBean getEndpoint assertEquals dummyBean getEndpoint getEndpointUri
Test public void testEndpointConfigurationAfterEnsuringThatTheStatementRouteBuilderWasCreated throws Exception String names applicationContext getBeanDefinitionNames for String name names
Test public void testInjectionPoints throws Exception log info bean getFieldInjectedEndpoint
Test public void testInjectionPoints throws Exception log info bean getFieldInjectedEndpoint log info bean getPropertyInjectedEndpoint
Test public void testInjectionPoints throws Exception log info bean getFieldInjectedEndpoint log info bean getPropertyInjectedEndpoint log info bean getFieldInjectedProducer
Test public void testInjectionPoints throws Exception log info bean getFieldInjectedEndpoint log info bean getPropertyInjectedEndpoint log info bean getFieldInjectedProducer log info bean getPropertyInjectedProducer
Test public void testInjectionPoints throws Exception log info bean getFieldInjectedEndpoint log info bean getPropertyInjectedEndpoint log info bean getFieldInjectedProducer log info bean getPropertyInjectedProducer log info bean getFieldInjectedCamelTemplate
Test public void testSendingToProcessorEndpoint throws Exception ProcessorStub processor getMandatoryBean ProcessorStub class template sendBody body List Exchange list processor getExchanges assertEquals list size list
Test public void testXMLRouteLoading throws Exception applicationContext new ClassPathXmlApplicationContext CamelContext context applicationContext getBean CamelContext class assertNotNull context List Route routes context getRoutes
Test public void testEndpointCreatedWithCorrectUri throws Exception assertNotNull endpoint assertEquals endpoint getEndpointUri
protected void assertValidContext CamelContext context assertNotNull context List RouteDefinition routes ModelCamelContext context getRouteDefinitions
Consume public void doSomething String body ObjectHelper notNull destination
Consume public void doSomething String body Exchange exchange ObjectHelper notNull destination ObjectHelper notNull exchange ObjectHelper notNull exchange getContext
Override public Processor wrapProcessorInInterceptors final CamelContext context final NamedNode definition final Processor target final Processor nextTarget throws Exception return new Processor public void process Exchange exchange throws Exception count
Test public void testCamelContextModel throws Exception JAXBContext jaxbContext new SpringModelJAXBContextFactory newJAXBContext Unmarshaller unmarshaller jaxbContext createUnmarshaller Object obj unmarshaller unmarshal new File assertNotNull obj CamelContextFactoryBean context CamelContextFactoryBean obj assertEquals context getId assertEquals context getErrorHandlerRef assertEquals context getRoutes size Marshaller marshaller jaxbContext createMarshaller StringWriter writer new StringWriter marshaller marshal context writer String s writer getBuffer toString
Override Test public void testDualCamelContextManaged throws Exception MBeanServer mbeanServer context getManagementStrategy getManagementAgent getMBeanServer Set ObjectName set mbeanServer queryNames new ObjectName null assertEquals set size Iterator ObjectName it set iterator ObjectName on1 it next ObjectName on2 it next assertTrue on1 getCanonicalName contains on2 getCanonicalName contains assertTrue on1 getCanonicalName contains on2 getCanonicalName contains set mbeanServer queryNames new ObjectName null assertTrue set size set size Set String ids1 new TreeSet Set String ids2 new TreeSet for ObjectName on set String name on getCanonicalName
Test public void testJmxDumpCBRRoutesAsXml throws Exception MBeanServer mbeanServer getMBeanServer ObjectName on ObjectName getInstance String xml String mbeanServer invoke on null null assertNotNull xml
Test public void testJmxDumpRoutesAsXml throws Exception MBeanServer mbeanServer getMBeanServer ObjectName on ObjectName getInstance String xml String mbeanServer invoke on null null assertNotNull xml
Test public void testJmxDumpRoutesAsXml throws Exception MBeanServer mbeanServer getMBeanServer ObjectName on ObjectName getInstance String xml String mbeanServer invoke on null null assertNotNull xml
Override public boolean postProcessAfterInstantiation final Object bean final String beanName throws BeansException ReflectionUtils doWithFields bean getClass new ReflectionUtils FieldCallback public void doWith Field field throws IllegalArgumentException IllegalAccessException MagicAnnotation annotation field getAnnotation MagicAnnotation class if annotation null field getType String class
protected void log N number
Override public int processBatch Queue Object exchanges throws Exception int total exchanges size if maxMessagesPerPoll total maxMessagesPerPoll
SqlNamedProcessingStrategy namedProcessingStrategy SqlNamedProcessingStrategy sqlProcessingStrategy updateCount namedProcessingStrategy commit getEndpoint exchange data namedJdbcTemplate parameterSource sql else updateCount sqlProcessingStrategy commit getEndpoint exchange data jdbcTemplate sql if expectedUpdateCount updateCount expectedUpdateCount String msg expectedUpdateCount updateCount sql throw new SQLException msg catch Exception e if breakBatchOnConsumeFail throw e else handleException sql e try if onConsumeBatchComplete null int updateCount
Override public Exchange add final CamelContext camelContext final String correlationId final Exchange exchange return transactionTemplate execute new TransactionCallback Exchange public Exchange doInTransaction TransactionStatus status Exchange result null final String key correlationId try
Override public Exchange add final CamelContext camelContext final String correlationId final Exchange exchange return transactionTemplate execute new TransactionCallback Exchange public Exchange doInTransaction TransactionStatus status Exchange result null final String key correlationId try LOG debug key boolean present jdbcTemplate queryForObject getRepositoryName ID Integer class key if isReturnOldExchange present result get key getRepositoryName camelContext if present long version exchange getProperty VERSION_PROPERTY Long class LOG debug key version update camelContext correlationId exchange getRepositoryName version else
Override public Exchange get final CamelContext camelContext final String correlationId final String key correlationId Exchange result get key getRepositoryName camelContext
Override public void remove final CamelContext camelContext final String correlationId final Exchange exchange transactionTemplate execute new TransactionCallbackWithoutResult protected void doInTransactionWithoutResult TransactionStatus status final String key correlationId final String confirmKey exchange getExchangeId final long version exchange getProperty VERSION_PROPERTY Long class try
Override public void confirm final CamelContext camelContext final String exchangeId transactionTemplate execute new TransactionCallbackWithoutResult protected void doInTransactionWithoutResult TransactionStatus status
Override public Exchange recover CamelContext camelContext String exchangeId final String key exchangeId Exchange answer get key getRepositoryNameCompleted camelContext
Override protected void doStart throws Exception super doStart int current getKeys size int completed scan null size if current
public static int subnumbers int val1 int val2
public static void subnumbers int val1 int val2 int ret
public static void batchfn String val1
Test public void testLoadTestJdbcAggregate throws Exception MockEndpoint mock getMockEndpoint mock expectedMessageCount mock setResultWaitTime ExecutorService executor Executors newFixedThreadPool LOG info SIZE for int i i SIZE i final int value final int key i executor submit new Callable Object public Object call throws Exception char id KEYS key
Test public void testLoadTestJdbcAggregate throws Exception MockEndpoint mock getMockEndpoint mock expectedMinimumMessageCount mock setResultWaitTime LOG info SIZE for int i i SIZE i final int value char id
Test public void testLoadTestJdbcAggregate throws Exception MockEndpoint mock getMockEndpoint mock expectedMinimumMessageCount mock setResultWaitTime LOG info SIZE for int i i SIZE i final int value HeaderDto headerDto new HeaderDto
Test public void testPutAndGetNotFound Exchange exchange new DefaultExchange context exchange getIn setBody
Test public void testPutAndGetNotFound Exchange exchange new DefaultExchange context exchange getIn setBody LOG info exchange getExchangeId repo add context exchange getExchangeId exchange Exchange out repo get context exchange getExchangeId assertNotNull out Exchange exchange2 new DefaultExchange context exchange2 getIn setBody
Object userNameHeaderObj headers get SshConstants USERNAME_HEADER if userNameHeaderObj String userName String headers get SshConstants USERNAME_HEADER ConnectFuture connectFuture client connect userName configuration getHost configuration getPort connectFuture await configuration getTimeout if connectFuture isDone connectFuture isConnected throw new RuntimeCamelException configuration getHost configuration getPort configuration getTimeout LOG debug configuration getHost configuration getPort ClientChannel channel null ClientSession session null try AuthFuture authResult session connectFuture getSession KeyPairProvider keyPairProvider final String certResource configuration getCertResource
keyPairProvider new ResourceHelperKeyPairProvider new String certResource endpoint getCamelContext else keyPairProvider configuration getKeyPairProvider if keyPairProvider null LOG debug userName KeyPair pair null if configuration getKeyType null Iterator KeyPair iterator keyPairProvider loadKeys iterator if iterator hasNext pair iterator next else pair keyPairProvider loadKey configuration getKeyType session addPublicKeyIdentity pair else String password configuration getPassword
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure errorHandler deadLetterChannel maximumRedeliveries redeliveryDelay 0L onRedelivery new Processor Override public void process Exchange exchange throws Exception final Message in exchange getIn final int count in getHeader Exchange REDELIVERY_COUNTER Integer class final int maxCount in getHeader Exchange REDELIVERY_MAX_COUNTER Integer class
Test public void testXPathSTaXPerformanceRoute throws Exception NotifyBuilder notify new NotifyBuilder context whenDone size create boolean matches notify matches TimeUnit SECONDS
watch restart split stax Order class streaming choice when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num tiny incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num
split stax Order class streaming choice when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num tiny incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num
if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml
log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num med incrementAndGet
String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num med incrementAndGet if num log info num log debug xml otherwise process new Processor
assertTrue xml contains xml int num small incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num med incrementAndGet if num log info num log debug xml otherwise process new Processor public void process Exchange exchange throws Exception
private InputStream resolveStreamFromFile throws IOException String fileName endpoint getFileName StringHelper notEmpty fileName FileInputStream fileStream file new File fileName if LOG isDebugEnabled
Charset loadCharset if encoding null encoding Charset defaultCharset name
private OutputStream resolveStreamFromFile throws IOException String fileName endpoint getFileName StringHelper notEmpty fileName
Object body exchange getIn getBody if body null LOG debug return if body String byte bytes exchange getIn getBody byte class if bytes null LOG debug bytes outputStream outputStream write bytes return String s exchange getIn getMandatoryBody String class Charset charset endpoint getCharset Writer writer new OutputStreamWriter outputStream charset BufferedWriter bw IOHelper buffered writer if LOG isDebugEnabled
if contextIdListing ObjectHelper isEmpty route route equals support renderCamelContexts adapter contextId contextIdPattern json yaml configuration else String name if ObjectHelper isNotEmpty route if route startsWith route route substring name route split if route startsWith contextId route route substring name length else name exchange getContext getName boolean match true if contextIdPattern null if equals contextIdPattern
Swagger loadSwaggerModel CamelContext camelContext String apiDoc throws Exception InputStream is resolveMandatoryResourceAsInputStream camelContext apiDoc try SwaggerParser parser new SwaggerParser String json camelContext getTypeConverter mandatoryConvertTo String class is
private Producer createHttpProducer CamelContext camelContext Swagger swagger Operation operation String host String verb String path String queryParameters String consumes String produces String componentName Map String Object parameters throws Exception
private Producer createHttpProducer CamelContext camelContext Swagger swagger Operation operation String host String verb String path String queryParameters String consumes String produces String componentName Map String Object parameters throws Exception LOG debug operation verb path RestProducerFactory factory RestProducerFactory parameters remove if factory null
Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath RestSwaggerReader reader new RestSwaggerReader Swagger swagger reader read context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull swagger ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL String json mapper writeValueAsString swagger
Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath RestSwaggerReader reader new RestSwaggerReader Swagger swagger reader read context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull swagger ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL String json mapper writeValueAsString swagger
Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl RestSwaggerReader reader new RestSwaggerReader Swagger swagger reader read context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull swagger ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL String json mapper writeValueAsString swagger
Test public void testEnableVendorExtension throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl RestSwaggerReader reader new RestSwaggerReader Swagger swagger reader read context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull swagger ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL String json mapper writeValueAsString swagger
Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl RestSwaggerReader reader new RestSwaggerReader Swagger swagger reader read context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull swagger ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL String json mapper writeValueAsString swagger
Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl RestSwaggerReader reader new RestSwaggerReader Swagger swagger reader read context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull swagger ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL String json mapper writeValueAsString swagger
Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl RestSwaggerReader reader new RestSwaggerReader Swagger swagger reader read context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull swagger ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL String json mapper writeValueAsString swagger
Override Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setHost RestSwaggerReader reader new RestSwaggerReader Swagger swagger reader read context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull swagger ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL String json mapper writeValueAsString swagger
Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath RestSwaggerReader reader new RestSwaggerReader RestSwaggerSupport support new RestSwaggerSupport List RestDefinition rests support getRestDefinitions context Swagger swagger reader read rests null config context getName new DefaultClassResolver assertNotNull swagger ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL String json mapper writeValueAsString swagger
Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath RestSwaggerReader reader new RestSwaggerReader Swagger swagger reader read context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull swagger ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL String json mapper writeValueAsString swagger
Test public void testReaderRead throws Exception BeanConfig config new BeanConfig config setHost config setSchemes new String config setBasePath config setTitle config setLicense config setLicenseUrl RestSwaggerReader reader new RestSwaggerReader Swagger swagger reader read context getRestDefinitions null config context getName new DefaultClassResolver assertNotNull swagger ObjectMapper mapper new ObjectMapper mapper enable SerializationFeature INDENT_OUTPUT mapper setSerializationInclusion JsonInclude Include NON_NULL String json mapper writeValueAsString swagger
Test public void testUnMarshalToStringOfXml throws Exception MockEndpoint resultEndpoint resolveMandatoryEndpoint MockEndpoint class resultEndpoint expectedMessageCount String badHtml TidyMarkupTestSupport loadFileAsString new File String evilHtml TidyMarkupTestSupport loadFileAsString new File template sendBody badHtml template sendBody evilHtml resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges for Exchange exchange list Message in exchange getIn String response in getBody String class
Test public void testUnMarshalToStringOfXml throws Exception MockEndpoint resultEndpoint resolveMandatoryEndpoint MockEndpoint class resultEndpoint expectedMessageCount String badHtml TidyMarkupTestSupport loadFileAsString new File String evilHtml TidyMarkupTestSupport loadFileAsString new File template sendBody badHtml template sendBody evilHtml resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges for Exchange exchange list try Message in exchange getIn Node tidyMarkup in getBody Node class
private void processUpdates List Update updates throws Exception for Update update updates
Override protected void doStart throws Exception super doStart if client null DefaultAsyncHttpClientConfig Builder builder clientConfig null new DefaultAsyncHttpClientConfig Builder clientConfig new DefaultAsyncHttpClientConfig Builder if configuration null ObjectHelper isNotEmpty configuration getProxyHost ObjectHelper isNotEmpty configuration getProxyPort
Override public boolean process Exchange exchange AsyncCallback callback if exchange getIn getBody null LOG debug callback done true return true TelegramConfiguration config endpoint getConfiguration OutgoingMessage message exchange getIn getBody OutgoingMessage class if message null throw new IllegalArgumentException if message getChatId null LOG debug String chatId resolveChatId config message exchange LOG debug chatId message setChatId chatId final TelegramService service endpoint getTelegramService
private static int probePort int port try ServerSocket ss new ServerSocket ss setReuseAddress true ss bind new InetSocketAddress InetAddress null port int probedPort ss getLocalPort
public void dump ManagedCamelContextMBean managedCamelContext ModelCamelContext context String dumpDir String dumpFilename String testClass String testName long testTimeTaken throws Exception logCoverageSummary managedCamelContext context String routeCoverageAsXml managedCamelContext dumpRoutesCoverageAsXml String combined gatherTestDetailsAsXml testClass testName testTimeTaken routeCoverageAsXml File dumpFile new File dumpDir dumpFile mkdirs dumpFile new File dumpDir dumpFilename
routesSummary append append route getId append append managedRoute getExchangesTotal append append routeCoveragePercentage append if server null List ManagedProcessorMBean processors processorsForRoute get route getId if processors null for ManagedProcessorMBean managedProcessor processors String processorId managedProcessor getProcessorId long processorExchangesTotal managedProcessor getExchangesTotal long processorCoveragePercentage Math round double processorExchangesTotal contextExchangesTotal routesSummary append append processorId append append processorExchangesTotal append append processorCoveragePercentage append int used routes uncoveredRoutes size long contextPercentage Math round double used routes builder append append used append append routes append append contextPercentage append builder append append managedCamelContext getCamelId append append contextExchangesTotal append if uncoveredRoutes size builder append append uncoveredRoutes stream collect Collectors joining append
if ignore null pc setIgnoreMissingLocation ignore String include getRouteFilterIncludePattern String exclude getRouteFilterExcludePattern if include null exclude null LOG info include exclude context getExtension Model class setRouteFilterPattern include exclude postProcessTest if isUseRouteBuilder RoutesBuilder builders createRouteBuilders for RoutesBuilder builder builders LOG debug builder context addRoutes builder replaceFromEndpoints boolean skip equalsIgnoreCase System getProperty
String include getRouteFilterIncludePattern String exclude getRouteFilterExcludePattern if include null exclude null LOG info include exclude context getExtension Model class setRouteFilterPattern include exclude postProcessTest if isUseRouteBuilder RoutesBuilder builders createRouteBuilders for RoutesBuilder builder builders LOG debug builder context addRoutes builder replaceFromEndpoints boolean skip equalsIgnoreCase System getProperty if skip LOG info
AfterEach public void tearDown throws Exception long time watch taken LOG info LOG info currentTestName getClass getName
AfterAll public static void shouldTearDown Runnable r try StopWatch watch new StopWatch while watch taken LOG debug if POST_TEAR_DOWN get LATCH countDown break else try Thread sleep catch InterruptedException e break finally
Override protected void debugBefore Exchange exchange Processor processor ProcessorDefinition definition String id String shortName
Override protected void debugBefore Exchange exchange Processor processor ProcessorDefinition definition String id String shortName
Override protected void debugBefore Exchange exchange Processor processor ProcessorDefinition definition String id String shortName
else if Modifier isStatic method getModifiers throw new IllegalArgumentException method getName else if Modifier isPublic method getModifiers throw new IllegalArgumentException method getName try breakpoints add Breakpoint method invoke null catch Exception e throw new RuntimeException method getName e if breakpoints size CamelSpringTestHelper doToSpringCamelContexts context new CamelSpringTestHelper DoToSpringCamelContextsStrategy public void execute String contextName SpringCamelContext camelContext throws Exception Debugger debugger camelContext getDebugger if debugger null debugger new DefaultDebugger camelContext setDebugger debugger
public static void handleMockEndpoints ConfigurableApplicationContext context Class testClass throws Exception if testClass isAnnotationPresent MockEndpoints class final String mockEndpoints testClass getAnnotation MockEndpoints class value CamelSpringTestHelper doToSpringCamelContexts context new CamelSpringTestHelper DoToSpringCamelContextsStrategy public void execute String contextName SpringCamelContext camelContext throws Exception
public static void handleMockEndpointsAndSkip ConfigurableApplicationContext context Class testClass throws Exception if testClass isAnnotationPresent MockEndpointsAndSkip class final String mockEndpoints testClass getAnnotation MockEndpointsAndSkip class value CamelSpringTestHelper doToSpringCamelContexts context new CamelSpringTestHelper DoToSpringCamelContextsStrategy public void execute String contextName SpringCamelContext camelContext throws Exception String mockEndpointsValue camelContext resolvePropertyPlaceholders mockEndpoints
else if Modifier isStatic method getModifiers throw new IllegalArgumentException method getName else if Modifier isPublic method getModifiers throw new IllegalArgumentException method getName try properties add Properties method invoke null catch Exception e throw new RuntimeException method getName e Properties extra new Properties for Properties prop properties extra putAll prop if extra isEmpty context addBeanFactoryPostProcessor beanFactory beanFactory addBeanPostProcessor new BeanPostProcessor Override public Object postProcessBeforeInitialization Object bean String beanName if bean PropertiesComponent
public static void handleCamelContextStartup ConfigurableApplicationContext context Class testClass throws Exception boolean skip equalsIgnoreCase System getProperty if skip LOGGER info else if testClass isAnnotationPresent UseAdviceWith class if testClass getAnnotation UseAdviceWith class value LOGGER info skip true else LOGGER info skip false if skip CamelSpringTestHelper doToSpringCamelContexts context new CamelSpringTestHelper DoToSpringCamelContextsStrategy public void execute String contextName SpringCamelContext camelContext throws Exception if camelContext isStarted
LOGGER info else if testClass isAnnotationPresent UseAdviceWith class if testClass getAnnotation UseAdviceWith class value LOGGER info skip true else LOGGER info skip false if skip CamelSpringTestHelper doToSpringCamelContexts context new CamelSpringTestHelper DoToSpringCamelContextsStrategy public void execute String contextName SpringCamelContext camelContext throws Exception if camelContext isStarted LOGGER info contextName camelContext start else
Override public void prepareTestInstance TestContext testContext throws Exception
Override public void beforeTestMethod TestContext testContext throws Exception
Override public void afterTestMethod TestContext testContext throws Exception
Override public ApplicationContext loadContext MergedContextConfiguration mergedConfig throws Exception Class testClass getTestClass if LOG isDebugEnabled
Override public ApplicationContext loadContext String locations throws Exception Class testClass getTestClass if LOG isDebugEnabled
Override public void afterTestMethod TestContext testContext throws Exception StopWatch watch threadStopWatch get if watch null long time watch taken Logger log LoggerFactory getLogger testContext getTestClass log info log info testContext getTestMethod getName testContext getTestClass getName
Override protected void debugBefore Exchange exchange Processor processor ProcessorDefinition definition String id String shortName
else if Modifier isStatic method getModifiers throw new IllegalArgumentException method getName else if Modifier isPublic method getModifiers throw new IllegalArgumentException method getName try breakpoints add Breakpoint method invoke null catch Exception e throw new RuntimeException method getName e if breakpoints size CamelSpringTestHelper doToSpringCamelContexts context new CamelSpringTestHelper DoToSpringCamelContextsStrategy public void execute String contextName SpringCamelContext camelContext throws Exception Debugger debugger camelContext getDebugger if debugger null debugger new DefaultDebugger camelContext setDebugger debugger
public static void handleMockEndpoints ConfigurableApplicationContext context Class testClass throws Exception if testClass isAnnotationPresent MockEndpoints class final String mockEndpoints testClass getAnnotation MockEndpoints class value CamelSpringTestHelper doToSpringCamelContexts context new CamelSpringTestHelper DoToSpringCamelContextsStrategy public void execute String contextName SpringCamelContext camelContext throws Exception
public static void handleMockEndpointsAndSkip ConfigurableApplicationContext context Class testClass throws Exception if testClass isAnnotationPresent MockEndpointsAndSkip class final String mockEndpoints testClass getAnnotation MockEndpointsAndSkip class value CamelSpringTestHelper doToSpringCamelContexts context new CamelSpringTestHelper DoToSpringCamelContextsStrategy public void execute String contextName SpringCamelContext camelContext throws Exception String mockEndpointsValue camelContext resolvePropertyPlaceholders mockEndpoints
else if Modifier isStatic method getModifiers throw new IllegalArgumentException method getName else if Modifier isPublic method getModifiers throw new IllegalArgumentException method getName try properties add Properties method invoke null catch Exception e throw new RuntimeException method getName e Properties extra new Properties for Properties prop properties extra putAll prop if extra isEmpty context addBeanFactoryPostProcessor beanFactory beanFactory addBeanPostProcessor new BeanPostProcessor Override public Object postProcessBeforeInitialization Object bean String beanName if bean PropertiesComponent
public static void handleCamelContextStartup ConfigurableApplicationContext context Class testClass throws Exception boolean skip equalsIgnoreCase System getProperty if skip LOGGER info else if testClass isAnnotationPresent UseAdviceWith class if testClass getAnnotation UseAdviceWith class value LOGGER info skip true else LOGGER info skip false if skip CamelSpringTestHelper doToSpringCamelContexts context new CamelSpringTestHelper DoToSpringCamelContextsStrategy public void execute String contextName SpringCamelContext camelContext throws Exception if camelContext isStarted
LOGGER info else if testClass isAnnotationPresent UseAdviceWith class if testClass getAnnotation UseAdviceWith class value LOGGER info skip true else LOGGER info skip false if skip CamelSpringTestHelper doToSpringCamelContexts context new CamelSpringTestHelper DoToSpringCamelContextsStrategy public void execute String contextName SpringCamelContext camelContext throws Exception if camelContext isStarted LOGGER info contextName camelContext start else
Override public ApplicationContext loadContext MergedContextConfiguration mergedConfig throws Exception Class testClass getTestClass if logger isDebugEnabled
Override public ApplicationContext loadContext MergedContextConfiguration mergedConfig throws Exception Class testClass getTestClass if LOG isDebugEnabled
Override public ApplicationContext loadContext String locations throws Exception Class testClass getTestClass if LOG isDebugEnabled
Override public void afterTestMethod TestContext testContext throws Exception StopWatch watch threadStopWatch get if watch null long time watch taken Logger log LoggerFactory getLogger testContext getTestClass log info log info testContext getTestMethod getName testContext getTestClass getName
Override protected void debugBefore Exchange exchange Processor processor ProcessorDefinition definition String id String shortName
private static int probePort int port try ServerSocket ss new ServerSocket ss setReuseAddress true ss bind new InetSocketAddress InetAddress null port int probedPort ss getLocalPort
if ignore null pc setIgnoreMissingLocation ignore String include getRouteFilterIncludePattern String exclude getRouteFilterExcludePattern if include null exclude null LOG info include exclude context getExtension Model class setRouteFilterPattern include exclude postProcessTest if isUseRouteBuilder RoutesBuilder builders createRouteBuilders for RoutesBuilder builder builders LOG debug builder context addRoutes builder replaceFromEndpoints boolean skip equalsIgnoreCase System getProperty
String include getRouteFilterIncludePattern String exclude getRouteFilterExcludePattern if include null exclude null LOG info include exclude context getExtension Model class setRouteFilterPattern include exclude postProcessTest if isUseRouteBuilder RoutesBuilder builders createRouteBuilders for RoutesBuilder builder builders LOG debug builder context addRoutes builder replaceFromEndpoints boolean skip equalsIgnoreCase System getProperty if skip LOG info
After public void tearDown throws Exception long time watch taken LOG info LOG info getTestMethodName getClass getName
if isRouteCoverageEnabled String className this getClass getSimpleName String dir String name className getTestMethodName ManagedCamelContext mc context null context getExtension ManagedCamelContext class null ManagedCamelContextMBean managedCamelContext mc null mc getManagedCamelContext null if managedCamelContext null LOG warn else logCoverageSummary managedCamelContext String xml managedCamelContext dumpRoutesCoverageAsXml String combined gatherTestDetailsAsXml xml File file new File dir file mkdirs file new File dir name
routesSummary append append route getId append append managedRoute getExchangesTotal append append routeCoveragePercentage append if server null List ManagedProcessorMBean processors processorsForRoute get route getId if processors null for ManagedProcessorMBean managedProcessor processors String processorId managedProcessor getProcessorId long processorExchangesTotal managedProcessor getExchangesTotal long processorCoveragePercentage Math round double processorExchangesTotal contextExchangesTotal routesSummary append append processorId append append processorExchangesTotal append append processorCoveragePercentage append int used routes uncoveredRoutes size long contextPercentage Math round double used routes builder append append used append append routes append append contextPercentage append builder append append managedCamelContext getCamelId append append contextExchangesTotal append if uncoveredRoutes size builder append append uncoveredRoutes stream collect Collectors joining append
AfterClass public static void shouldTearDown throws Exception Runnable r try StopWatch watch new StopWatch while watch taken LOG debug if POST_TEAR_DOWN get LATCH countDown break else try Thread sleep catch InterruptedException e break finally
Override protected void debugBefore Exchange exchange Processor processor ProcessorDefinition definition String id String shortName
Override protected void debugBefore Exchange exchange Processor processor ProcessorDefinition definition String id String shortName
Override protected void debugBefore Exchange exchange Processor processor ProcessorDefinition definition String id String shortName
TSSLTransportFactory TSSLTransportParameters sslParams sslParams new TSSLTransportFactory TSSLTransportParameters sslParameters getSecureSocketProtocol sslParameters getCipherSuites null null sslParameters getCipherSuites getCipherSuite stream toArray String :: new if ObjectHelper isNotEmpty sslParameters getKeyManagers getKeyStore getProvider ObjectHelper isNotEmpty sslParameters getKeyManagers getKeyStore getType sslParams setKeyStore ResourceHelper resolveResourceAsInputStream classResolver sslParameters getKeyManagers getKeyStore getResource sslParameters getKeyManagers getKeyStore getPassword sslParameters getKeyManagers getKeyStore getProvider sslParameters getKeyManagers getKeyStore getType else sslParams setKeyStore ResourceHelper resolveResourceAsInputStream classResolver sslParameters getKeyManagers getKeyStore getResource sslParameters getKeyManagers getKeyStore getPassword try syncServerTransport TSSLTransportFactory getServerSocket configuration getPort configuration getClientTimeout InetAddress getByName configuration getHost sslParams catch UnknownHostException e throw new IllegalArgumentException configuration getHost ThriftThreadPoolServer Args args new ThriftThreadPoolServer Args syncServerTransport args processor TProcessor serverProcessor args executorService getEndpoint getCamelContext getExecutorServiceManager newThreadPool this getEndpoint getEndpointUri configuration getPoolSize configuration getMaxPoolSize args startThreadPool getEndpoint getCamelContext getExecutorServiceManager newSingleThreadExecutor this getEndpoint getEndpointUri args context endpoint getCamelContext
sslParams setKeyStore ResourceHelper resolveResourceAsInputStream classResolver sslParameters getKeyManagers getKeyStore getResource sslParameters getKeyManagers getKeyStore getPassword sslParameters getKeyManagers getKeyStore getProvider sslParameters getKeyManagers getKeyStore getType else sslParams setKeyStore ResourceHelper resolveResourceAsInputStream classResolver sslParameters getKeyManagers getKeyStore getResource sslParameters getKeyManagers getKeyStore getPassword try syncServerTransport TSSLTransportFactory getServerSocket configuration getPort configuration getClientTimeout InetAddress getByName configuration getHost sslParams catch UnknownHostException e throw new IllegalArgumentException configuration getHost ThriftThreadPoolServer Args args new ThriftThreadPoolServer Args syncServerTransport args processor TProcessor serverProcessor args executorService getEndpoint getCamelContext getExecutorServiceManager newThreadPool this getEndpoint getEndpointUri configuration getPoolSize configuration getMaxPoolSize args startThreadPool getEndpoint getCamelContext getExecutorServiceManager newSingleThreadExecutor this getEndpoint getEndpointUri args context endpoint getCamelContext server new ThriftThreadPoolServer args else if configuration getCompressionType ThriftCompressionType ZLIB endpoint isSynchronous if ObjectHelper isNotEmpty configuration getHost ObjectHelper isNotEmpty configuration getPort
args executorService getEndpoint getCamelContext getExecutorServiceManager newThreadPool this getEndpoint getEndpointUri configuration getPoolSize configuration getMaxPoolSize args startThreadPool getEndpoint getCamelContext getExecutorServiceManager newSingleThreadExecutor this getEndpoint getEndpointUri args context endpoint getCamelContext server new ThriftThreadPoolServer args else if configuration getCompressionType ThriftCompressionType ZLIB endpoint isSynchronous if ObjectHelper isNotEmpty configuration getHost ObjectHelper isNotEmpty configuration getPort LOG debug configuration getHost configuration getPort syncServerTransport new TServerSocket new InetSocketAddress configuration getHost configuration getPort configuration getClientTimeout else if ObjectHelper isEmpty configuration getHost ObjectHelper isNotEmpty configuration getPort LOG debug configuration getPort syncServerTransport new TServerSocket configuration getPort configuration getClientTimeout else throw new IllegalArgumentException ThriftThreadPoolServer Args args new ThriftThreadPoolServer Args syncServerTransport args processor TProcessor serverProcessor
server new ThriftThreadPoolServer args else if configuration getCompressionType ThriftCompressionType ZLIB endpoint isSynchronous if ObjectHelper isNotEmpty configuration getHost ObjectHelper isNotEmpty configuration getPort LOG debug configuration getHost configuration getPort syncServerTransport new TServerSocket new InetSocketAddress configuration getHost configuration getPort configuration getClientTimeout else if ObjectHelper isEmpty configuration getHost ObjectHelper isNotEmpty configuration getPort LOG debug configuration getPort syncServerTransport new TServerSocket configuration getPort configuration getClientTimeout else throw new IllegalArgumentException ThriftThreadPoolServer Args args new ThriftThreadPoolServer Args syncServerTransport args processor TProcessor serverProcessor args transportFactory new TZlibTransport Factory args executorService getEndpoint getCamelContext getExecutorServiceManager newThreadPool this getEndpoint getEndpointUri configuration getPoolSize configuration getMaxPoolSize args startThreadPool getEndpoint getCamelContext getExecutorServiceManager newSingleThreadExecutor this getEndpoint getEndpointUri
protected void initializeSyncTransport throws TTransportException if ObjectHelper isEmpty configuration getHost ObjectHelper isEmpty configuration getPort
protected void initializeAsyncTransport throws IOException TTransportException if ObjectHelper isEmpty configuration getHost ObjectHelper isEmpty configuration getPort
BeforeAll SuppressWarnings public static void startThriftServer throws Exception processor new Calculator Processor new CalculatorSyncServerImpl serverTransport new TNonblockingServerSocket THRIFT_TEST_PORT server new THsHaServer new Args serverTransport processor processor Runnable simple new Runnable public void run
BeforeAll SuppressWarnings public static void startThriftServer throws Exception processor new Calculator Processor new CalculatorSyncServerImpl TSSLTransportFactory TSSLTransportParameters sslParams new TSSLTransportFactory TSSLTransportParameters sslParams setKeyStore KEY_STORE_SOURCE SECURITY_STORE_PASSWORD serverTransport TSSLTransportFactory getServerSocket THRIFT_TEST_PORT THRIFT_CLIENT_TIMEOUT InetAddress getByName sslParams TThreadPoolServer Args args new TThreadPoolServer Args serverTransport args processor processor server new TThreadPoolServer args Runnable simple new Runnable public void run
BeforeAll SuppressWarnings public static void startThriftServer throws Exception processor new Calculator Processor new CalculatorSyncServerImpl serverTransport new TServerSocket new InetSocketAddress InetAddress getByName THRIFT_TEST_PORT THRIFT_CLIENT_TIMEOUT TThreadPoolServer Args args new TThreadPoolServer Args serverTransport args processor processor args protocolFactory new TBinaryProtocol Factory args transportFactory new TZlibTransport Factory server new TThreadPoolServer args Runnable simple new Runnable public void run
BeforeEach SuppressWarnings public void startThriftServer throws Exception processor new Calculator Processor new CalculatorSyncServerImpl TSSLTransportFactory TSSLTransportParameters sslParams new TSSLTransportFactory TSSLTransportParameters sslParams setKeyStore KEY_STORE_PATH SECURITY_STORE_PASSWORD serverTransport TSSLTransportFactory getServerSocket THRIFT_TEST_PORT THRIFT_CLIENT_TIMEOUT InetAddress getByName sslParams ThriftThreadPoolServer Args args new ThriftThreadPoolServer Args serverTransport args processor processor args executorService this context getExecutorServiceManager newThreadPool this args startThreadPool this context getExecutorServiceManager newSingleThreadExecutor this args context this context server new ThriftThreadPoolServer args server serve
Override public void doInit throws Exception if endpoint getDelay task new TimerTask private final AtomicLong counter new AtomicLong Override public void run if isTaskRunAllowed
Test public void testFetcher throws Exception final Account result requestBody null assertNotNull result assertNotNull result getSid
Test public void testFetcherWithPathSid throws Exception final Account result requestBodyAndHeaders null headers TwilioComponent context getComponent getAccountSid assertNotNull result assertNotNull result getSid
Test public void testReader throws Exception final ResourceSet Account result requestBody null assertNotNull result result forEach account assertNotNull account
Test public void testReaderWithStatusActive throws Exception final ResourceSet Account result requestBodyAndHeaders null headers assertNotNull result result forEach account assertEquals Account Status ACTIVE account getStatus
Override public List Exchange pollConsume throws TwitterException String keywords this keywords Query query if keywords null keywords trim length query new Query keywords
private Status updateStatus StatusUpdate status throws Exception Status response endpoint getProperties getTwitter updateStatus status
private Status updateStatus StatusUpdate status throws Exception Status response endpoint getProperties getTwitter updateStatus status LOG debug status
private Status updateStatus String status throws Exception Status response endpoint getProperties getTwitter updateStatus status
private Status updateStatus String status throws Exception Status response endpoint getProperties getTwitter updateStatus status LOG debug status
Test public void testDirectMessage throws Exception Date now new Date String tweet now toString
Test public void testPostStatusUpdateRequestResponse throws Exception Date now new Date String tweet now toString
Test public void testPostStatusUpdateRequestResponse throws Exception Date now new Date String tweet now toString
void setupResponseListener final ClientExchange clientExchange clientExchange setResponseListener on ClientExchange response LOG trace clientExchange try storeCookies clientExchange final UndertowHttpBinding binding endpoint getUndertowHttpBinding final Message result binding toCamelMessage clientExchange exchange final int code clientExchange getResponse getResponseCode
public VelocityEndpoint findOrCreateEndpoint String uri String newResourceUri String newUri uri replace getResourceUri newResourceUri
Override protected void onExchange Exchange exchange throws Exception String path getResourceUri ObjectHelper notNull path if allowTemplateFromHeader String newResourceUri exchange getIn getHeader VelocityConstants VELOCITY_RESOURCE_URI String class if newResourceUri null exchange getIn removeHeader VelocityConstants VELOCITY_RESOURCE_URI
if allowTemplateFromHeader String newResourceUri exchange getIn getHeader VelocityConstants VELOCITY_RESOURCE_URI String class if newResourceUri null exchange getIn removeHeader VelocityConstants VELOCITY_RESOURCE_URI log debug VelocityConstants VELOCITY_RESOURCE_URI newResourceUri VelocityEndpoint newEndpoint findOrCreateEndpoint getEndpointUri newResourceUri newEndpoint onExchange exchange return Reader reader String content null if allowTemplateFromHeader content exchange getIn getHeader VelocityConstants VELOCITY_TEMPLATE String class if content null reader new StringReader content if log isDebugEnabled
exchange getIn removeHeader VelocityConstants VELOCITY_TEMPLATE else if log isDebugEnabled log debug getResourceUri path getEndpointUri reader getEncoding null new InputStreamReader getResourceAsInputStream getEncoding new InputStreamReader getResourceAsInputStream StringWriter buffer new StringWriter String logTag getClass getName Context velocityContext null if allowTemplateFromHeader velocityContext exchange getIn getHeader VelocityConstants VELOCITY_CONTEXT Context class if velocityContext null Map String Object variableMap ExchangeHelper createVariableMap exchange isAllowContextMapAll if allowTemplateFromHeader SuppressWarnings Map String Object supplementalMap exchange getIn getHeader VelocityConstants VELOCITY_SUPPLEMENTAL_CONTEXT Map class if supplementalMap null
public void connect VertxWebsocketConsumer consumer VertxWebsocketEndpoint endpoint consumer getEndpoint VertxWebsocketConfiguration configuration endpoint getConfiguration
VertxWebsocketConfiguration configuration endpoint getConfiguration LOG info configuration getPath Router router hostConfiguration getRouter Route route router route configuration getPath if ObjectHelper isEmpty configuration getAllowedOriginPattern CorsHandler corsHandler CorsHandler create configuration getAllowedOriginPattern route handler corsHandler route handler routingContext HttpServerRequest request routingContext request ServerWebSocket webSocket request upgrade SocketAddress socketAddress webSocket localAddress String connectionKey UUID randomUUID toString connectedPeers put connectionKey webSocket if LOG isDebugEnabled if socketAddress null
route handler routingContext HttpServerRequest request routingContext request ServerWebSocket webSocket request upgrade SocketAddress socketAddress webSocket localAddress String connectionKey UUID randomUUID toString connectedPeers put connectionKey webSocket if LOG isDebugEnabled if socketAddress null LOG debug connectionKey socketAddress host webSocket textMessageHandler message consumer onMessage connectionKey message webSocket binaryMessageHandler message consumer onMessage connectionKey message getBytes webSocket exceptionHandler exception consumer onException connectionKey exception webSocket closeHandler closeEvent if LOG isDebugEnabled if socketAddress null
public void disconnect String path
HttpServerOptions options hostConfiguration getServerOptions SSLContextParameters sslContextParameters hostConfiguration getSslContextParameters if sslContextParameters null if options null options new HttpServerOptions VertxWebsocketHelper setupSSLOptions sslContextParameters options if options null server vertx createHttpServer options else server vertx createHttpServer CompletableFuture Void future new CompletableFuture server requestHandler router listen hostKey getPort hostKey getHost result if result failed port result result actualPort future complete null
super doStart if vertx null if vertxFactory null vertxFactory new VertxFactoryImpl if vertxOptions null vertxOptions new VertxOptions if ObjectHelper isNotEmpty host vertxOptions setClusterHost host vertxOptions setClustered true if port vertxOptions setClusterPort port vertxOptions setClustered true createdVertx true final CountDownLatch latch new CountDownLatch if vertxOptions isClustered
vertxOptions setClustered true createdVertx true final CountDownLatch latch new CountDownLatch if vertxOptions isClustered LOG info vertxOptions getClusterHost vertxOptions getClusterPort vertxFactory clusteredVertx vertxOptions new Handler AsyncResult Vertx Override public void handle AsyncResult Vertx event if event cause null LOG warn host port event cause getMessage event cause else if event succeeded vertx event result LOG info vertx latch countDown else
Override protected void doStop throws Exception super doStop if createdVertx vertx null
protected void onEventBusEvent final Message event
protected void onEventBusEvent final Message event LOG debug event final boolean reply event replyAddress null final Exchange exchange endpoint createExchange reply ExchangePattern InOut ExchangePattern InOnly exchange getIn setBody event body try getAsyncProcessor process exchange new AsyncCallback Override public void done boolean doneSync if reply Object body exchange getMessage getBody if body null
if eventBus null exchange setException new IllegalStateException callback done true return true String address getEndpoint getAddress boolean reply ExchangeHelper isOutCapable exchange boolean pubSub getEndpoint isPubSub Object body exchange getMessage getBody if body null if reply LOG debug address body eventBus request address body new CamelReplyHandler exchange callback return false else if pubSub
return true String address getEndpoint getAddress boolean reply ExchangeHelper isOutCapable exchange boolean pubSub getEndpoint isPubSub Object body exchange getMessage getBody if body null if reply LOG debug address body eventBus request address body new CamelReplyHandler exchange callback return false else if pubSub LOG debug address body eventBus publish address body else
Test public void testVertxMessages throws Exception resultEndpoint context getEndpoint resultUri MockEndpoint class resultEndpoint expectedBodiesReceivedInAnyOrder body1 body2 template sendBody startUri body1 template sendBody startUri body2 resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges for Exchange exchange list
Test public void testVertxMessages throws Exception resultEndpoint context getEndpoint resultUri MockEndpoint class resultEndpoint expectedBodiesReceivedInAnyOrder body1 body2 template sendBody startUri body1 template sendBody startUri body2 resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges for Exchange exchange list
protected void checkWeatherContent String weather
Override protected void checkWeatherContent String weather
Override protected void checkWeatherContent String weather
Override protected void checkWeatherContent String weather
private void ethBlockHashObservable String x
private void ethPendingTransactionHashObservable String x
private void blockObservable EthBlock x EthBlock Block block x getBlock
private void processTransaction Transaction x
private void ethLogObservable Log x
public void processEvent Exchange exchange
private void processDone String operation
private void processError Throwable throwable String operation
private Web3j buildService String clientAddress Web3jConfiguration configuration
private void setRequestId Message message Request request final Long id message getHeader Web3jConstants ID Long class
Override protected void doStart throws Exception super doStart ServiceHelper startService delegateEndpoint if configuration isWebhookAutoRegister
Override protected void doStop throws Exception super doStop if configuration isWebhookAutoRegister delegateEndpoint null
Override public void onOpen final Session session final EndpointConfig endpointConfig this session session
Override public void onClose final Session session final CloseReason closeReason
private Session doConnect try final Session session container connectToServer new Endpoint Override public void onOpen final Session session final EndpointConfig endpointConfig
private Session doConnect try final Session session container connectToServer new Endpoint Override public void onOpen final Session session final EndpointConfig endpointConfig log debug session getId Override public void onClose final Session session final CloseReason closeReason sessions remove session log debug session getId Override public void onError final Session session final Throwable throwable if session isOpen try session close new CloseReason CloseReason CloseCodes CLOSED_ABNORMALLY catch final IOException e log debug session getId e sessions remove session
OnWebSocketMessage public void onMessage String message
else connector setPort port if endpoint getHost null connector setHost endpoint getHost else connector setHost host server addConnector connector LOG trace connector getName ServletContextHandler context createContext server connector endpoint getHandlers setWebSocketComponentServletInitialParameter context endpoint server setHandler context applyCrossOriginFiltering endpoint context if endpoint getStaticResources null server createStaticResourcesServer server context endpoint getStaticResources MemoryWebsocketStore memoryStore new MemoryWebsocketStore
protected WebsocketComponentServlet addServlet NodeSynchronization sync WebsocketProducerConsumer prodcon String resourceUri throws Exception WebsocketEndpoint endpoint prodcon getEndpoint String key getConnectorKey endpoint ConnectorRef connectorRef getConnectors get key WebsocketComponentServlet servlet if connectorRef null String pathSpec createPathSpec resourceUri servlet servlets get pathSpec if servlet null ServletContextHandler context ServletContextHandler connectorRef server getHandler servlet createServlet sync pathSpec servlets context connectorRef servlet servlet
Override protected void doStart throws Exception super doStart if staticResources null StringHelper notEmpty host this ObjectHelper notNull port this
public void connect WebsocketConsumer consumer
public void disconnect WebsocketConsumer consumer
public DefaultWebsocket doWebSocketConnect ServletUpgradeRequest request String protocol String protocolKey protocol if protocol null socketFactory containsKey protocol
void sendToAll WebsocketStore store Object message Exchange exchange throws Exception
else if websocket getPathSpec equals WebsocketComponent createPathSpec endpoint getResourceUri isOkToSendMessage true if isOkToSendMessage try Future Void future sendMessage websocket message if future null futures add future catch Exception e if exception null exception new WebsocketSendException exchange e StopWatch watch new StopWatch int timeout endpoint getSendTimeout while futures isEmpty watch taken timeout futures removeIf future future isDone future isCancelled if futures isEmpty
Dataset handleModelCmd Exchange exchange throws Exception Dataset dataset assertDatasetBody exchange String dsname getConfiguration getDsname boolean crossValidate getConfiguration isXval String buildSpec getConfiguration getBuild String loadFrom getConfiguration getLoadFrom String saveTo getConfiguration getSaveTo if loadFrom null Classifier cl dataset loadClassifier new ModelLoader loadFrom getClassifier AssertState notNull cl loadFrom
Classifier cl dataset loadClassifier new ModelLoader loadFrom getClassifier AssertState notNull cl loadFrom LOG debug cl else if buildSpec null dataset buildClassifier buildSpec if crossValidate int seed getConfiguration getSeed int folds getConfiguration getFolds dataset crossValidateModel folds seed else if dsname null dataset pop dsname dataset evaluateModel Classifier cl dataset getClassifier AssertState notNull cl
LOG debug cl else if buildSpec null dataset buildClassifier buildSpec if crossValidate int seed getConfiguration getSeed int folds getConfiguration getFolds dataset crossValidateModel folds seed else if dsname null dataset pop dsname dataset evaluateModel Classifier cl dataset getClassifier AssertState notNull cl LOG debug cl Evaluation ev dataset getEvaluation
Override public void configureAuthentication Object api if isCredentialsSet final String authorizationHeader String format Base64Utility encode String format this username this password getBytes
Override public List Page list PageSearchCriteria c
Override public Page retrieve Integer pageId Context context String password
Override public List Post list PostSearchCriteria criteria
Override public Post retrieve Integer postId Context context String password
Override public void handle HttpRequest request HttpResponse response HttpContext context throws HttpException IOException
protected void checkSearchValueNotNull Input input throws Exception
private void setBaseUri XMLCryptoContext context if getConfiguration getBaseUri null context setBaseURI getConfiguration getBaseUri
boolean isDetached getXpathToIdAttributes message size if isEnveloped isDetached if getConfiguration getParentLocalName null throw new XmlSignatureException getConfiguration getParentLocalName else throw new XmlSignatureException getConfiguration getParentXpath getXPath SignatureType result if isEnveloped result SignatureType enveloped else if isDetached if getSchemaResourceUri message null throw new XmlSignatureException result SignatureType detached else result SignatureType enveloping
catch XPathExpressionException e throw new XmlSignatureException xp getXPath e NodeList list NodeList exp evaluate messageBodyNode XPathConstants NODESET if list null LOG warn xp getXPath continue int length list getLength for int i i length i Node node list item i if node getNodeType Node ATTRIBUTE_NODE Attr attr Attr node String value attr getValue Element element messageBodyNode getOwnerDocument getElementById value if element null throw new XmlSignatureException xp getXPath value
List AlgorithmMethod configuredTrafos getConfiguration getTransformMethods if SignatureType enveloped sigType if configuredTrafos size if containsEnvelopedTransform configuredTrafos configuredTrafos new ArrayList configuredTrafos size configuredTrafos add XmlSignatureHelper getEnvelopedTransform configuredTrafos addAll getConfiguration getTransformMethods else configuredTrafos new ArrayList configuredTrafos add XmlSignatureHelper getEnvelopedTransform configuredTrafos add XmlSignatureHelper getCanonicalizationMethod CanonicalizationMethod INCLUSIVE List Transform transforms new ArrayList configuredTrafos size for AlgorithmMethod trafo configuredTrafos Transform transform fac newTransform trafo getAlgorithm TransformParameterSpec trafo getParameterSpec transforms add transform
configuredTrafos new ArrayList configuredTrafos add XmlSignatureHelper getEnvelopedTransform configuredTrafos add XmlSignatureHelper getCanonicalizationMethod CanonicalizationMethod INCLUSIVE List Transform transforms new ArrayList configuredTrafos size for AlgorithmMethod trafo configuredTrafos Transform transform fac newTransform trafo getAlgorithm TransformParameterSpec trafo getParameterSpec transforms add transform LOG debug trafo getAlgorithm return transforms else LOG debug XmlSignatureConstants HEADER_TRANSFORM_METHODS transformMethodsHeaderValue String transformAlgorithms transformMethodsHeaderValue split List Transform transforms new ArrayList transformAlgorithms length for String transformAlgorithm transformAlgorithms transformAlgorithm transformAlgorithm trim
String signatureAlgorithm getConfiguration getSignatureAlgorithm if signatureAlgorithm null if signatureAlgorithm contains SHA1 result DigestMethod SHA1 else if signatureAlgorithm contains SHA224 result HTTP_WWW_W3_ORG_2001_04_XMLDSIG_MORE_SHA224 else if signatureAlgorithm contains SHA256 result DigestMethod SHA256 else if signatureAlgorithm contains SHA384 result HTTP_WWW_W3_ORG_2001_04_XMLDSIG_MORE_SHA384 else if signatureAlgorithm contains SHA512 result DigestMethod SHA512 else if signatureAlgorithm contains RIPEMD160 return DigestMethod RIPEMD160 if result null
List XMLObject collectedObjects new ArrayList List Reference collectedReferences new ArrayList int totalCount signatureNodes getLength for int i i totalCount i Element signatureNode Element signatureNodes item i valContext setNode signatureNode final XMLSignature signature fac unmarshalXMLSignature valContext if getConfiguration getXmlSignatureChecker null XmlSignatureChecker Input checkerInput new CheckerInputBuilder message out messageBodyDocument doc keyInfo signature getKeyInfo currentCountOfSignatures i currentSignatureElement signatureNode objects signature getObjects signatureValue signature getSignatureValue signedInfo signature getSignedInfo totalCountOfSignatures totalCount xmlSchemaValidationExecuted getSchemaResourceUri out null build getConfiguration getXmlSignatureChecker checkBeforeCoreValidation checkerInput boolean coreValidity try coreValidity signature validate valContext catch XMLSignatureException se throw getConfiguration getValidationFailedHandler onXMLSignatureException se
for Reference ref List Reference signature getSignedInfo getReferences boolean refValid ref validate valContext if refValid handler referenceValidationFailed ref if Boolean TRUE equals valContext getProperty for XMLObject xo List XMLObject signature getObjects List XMLStructure content xo getContent for XMLStructure xs content if xs Manifest Manifest man Manifest xs for Reference ref List Reference man getReferences boolean refValid ref validate valContext if refValid handler manifestReferenceValidationFailed ref boolean goon handler ignoreCoreValidationFailure
else if xmlCipherAlgorithm equals XMLCipher SEED_128 keyEncryptionKey generateKeyEncryptionKey dataEncryptionKey generateDataEncryptionKey else if xmlCipherAlgorithm contains keyEncryptionKey generateKeyEncryptionKey dataEncryptionKey generateDataEncryptionKey else keyEncryptionKey generateKeyEncryptionKey dataEncryptionKey generateDataEncryptionKey XMLCipher keyCipher XMLCipher getInstance generateXmlCipherAlgorithmKeyWrap keyCipher init XMLCipher WRAP_MODE keyEncryptionKey encrypt exchange document stream dataEncryptionKey keyCipher keyEncryptionKey try dataEncryptionKey destroy catch javax security auth DestroyFailedException ex
else if xmlCipherAlgorithm contains keyEncryptionKey generateKeyEncryptionKey dataEncryptionKey generateDataEncryptionKey else keyEncryptionKey generateKeyEncryptionKey dataEncryptionKey generateDataEncryptionKey XMLCipher keyCipher XMLCipher getInstance generateXmlCipherAlgorithmKeyWrap keyCipher init XMLCipher WRAP_MODE keyEncryptionKey encrypt exchange document stream dataEncryptionKey keyCipher keyEncryptionKey try dataEncryptionKey destroy catch javax security auth DestroyFailedException ex LOG debug ex getMessage try keyEncryptionKey destroy
if xmlCipherAlgorithm equals XMLCipher TRIPLEDES keyEncryptionKey generateKeyEncryptionKey else keyEncryptionKey generateKeyEncryptionKey Object ret null try ret decode exchange encodedDocument keyEncryptionKey true catch org apache xml security encryption XMLEncryptionException ex if ex getMessage equals ret decode exchange encodedDocument keyEncryptionKey false else throw ex try keyEncryptionKey destroy catch javax security auth DestroyFailedException ex
keyStorePassword keyOrTrustStoreParameters getPassword if this keyStore null throw new IllegalStateException PrivateKey keyEncryptionKey getPrivateKey this keyStore this recipientKeyAlias this keyPassword null this keyPassword this keyStorePassword Object ret null try ret decode exchange encodedDocument keyEncryptionKey true catch org apache xml security encryption XMLEncryptionException ex if ex getMessage equals ret decode exchange encodedDocument keyEncryptionKey false else throw ex try keyEncryptionKey destroy catch javax security auth DestroyFailedException ex
protected void sendText final String fragment CamelContext context throws Exception ProducerTemplate template context createProducerTemplate template start template send new Processor public void process Exchange exchange throws Exception exchange setProperty Exchange CHARSET_NAME Message in exchange getIn in setBody fragment
protected void testDecryptionNoEncryptedKey CamelContext context throws Exception MockEndpoint resultEndpoint context getEndpoint MockEndpoint class resultEndpoint setExpectedMessageCount context start resultEndpoint assertIsSatisfied Exchange exchange resultEndpoint getExchanges get Document inDoc getDocumentForInMessage exchange XmlConverter converter new XmlConverter String xmlStr converter toString inDoc exchange
private void logMessage Exchange exchange Document inDoc throws Exception XmlConverter converter new XmlConverter String xmlStr converter toString inDoc exchange
String name entry getKey Object value entry getValue if headerFilterStrategy applyFilterToCamelHeaders name value exchange if equalsIgnoreCase name String subject exchange getContext getTypeConverter convertTo String class value message setSubject subject else if equalsIgnoreCase name String language exchange getContext getTypeConverter convertTo String class value message setLanguage language else try JivePropertiesManager addProperty message name value LOG trace name value catch IllegalArgumentException iae if LOG isDebugEnabled
public void populateXmppStanza Stanza stanza Exchange exchange Set Map Entry String Object entries exchange getIn getHeaders entrySet for Map Entry String Object entry entries String name entry getKey Object value entry getValue if headerFilterStrategy applyFilterToCamelHeaders name value exchange try JivePropertiesManager addProperty stanza name value
Override protected Endpoint createEndpoint String uri String remaining Map String Object parameters throws Exception String cacheKey extractCacheKeyFromUri uri if endpointCache containsKey cacheKey
chatManager ChatManager getInstanceFor connection chatManager addIncomingListener this OrFilter pubsubPacketFilter new OrFilter if endpoint isPubsub pubsubPacketFilter addFilter MessageTypeFilter HEADLINE pubsubPacketFilter addFilter MessageTypeFilter NORMAL connection addSyncStanzaListener this pubsubPacketFilter if endpoint getRoom null privateChat chatManager chatWith JidCreate entityBareFrom endpoint resolveParticipant connection else final AndFilter packetFilter new AndFilter new StanzaTypeFilter Presence class connection addSyncStanzaListener this packetFilter String roomPassword endpoint getRoomPassword MultiUserChatManager mucm MultiUserChatManager getInstanceFor connection muc mucm getMultiUserChat JidCreate entityBareFrom endpoint resolveRoom connection
private void checkConnection throws Exception if connection isConnected
private void checkConnection throws Exception if connection isConnected LOG info XmppEndpoint getConnectionMessage connection try connection connect
public void processMessage Chat chat Message message if LOG isDebugEnabled
public void processMessage Chat chat Message message if LOG isDebugEnabled LOG debug endpoint getUser endpoint getParticipant message getBody Exchange exchange endpoint createExchange message if endpoint isDoc exchange getIn setHeader XmppConstants DOC_HEADER message try getProcessor process exchange catch Exception e exchange setException e finally if muc null try muc pollMessage catch MultiUserChatException MucNotJoinedException e
if newConnection isAuthenticated if user null if LOG isDebugEnabled LOG debug user getConnectionMessage newConnection if password null LOG warn user getConnectionMessage newConnection if createAccount AccountManager accountManager AccountManager getInstance newConnection accountManager createAccount Localpart from user password if login if resource null newConnection login user password Resourcepart from resource else newConnection login user password else
LOG debug user getConnectionMessage newConnection if password null LOG warn user getConnectionMessage newConnection if createAccount AccountManager accountManager AccountManager getInstance newConnection accountManager createAccount Localpart from user password if login if resource null newConnection login user password Resourcepart from resource else newConnection login user password else if LOG isDebugEnabled LOG debug getConnectionMessage newConnection newConnection login
catch Exception e throw new RuntimeExchangeException exchange e if chat null try initializeChat catch Exception e throw new RuntimeExchangeException exchange e Message message chat createMessage try message setTo JidCreate from room message setFrom JidCreate from endpoint getUser endpoint getBinding populateXmppMessage message exchange if connection isConnected this reconnect if LOG isDebugEnabled
private synchronized void reconnect throws InterruptedException IOException SmackException XMPPException if connection isConnected if LOG isDebugEnabled
catch Exception e throw new RuntimeException e String participant endpoint getParticipant String thread endpoint getChatId if participant null participant getParticipant else thread participant endpoint getUser Message message new Message try message setTo JidCreate from participant message setThread thread message setType Message Type normal ChatManager chatManager ChatManager getInstanceFor connection Chat chat getOrCreateChat chatManager participant
private synchronized void reconnect throws InterruptedException IOException SmackException XMPPException if connection isConnected if LOG isDebugEnabled
BeforeEach public void setUp throws Exception client new DefaultProducerTemplate context String uriPrefix getUriPrefix final String uri1 uriPrefix final String uri2 uriPrefix final String uri3 uriPrefix
BeforeEach public void setUp throws Exception client new DefaultProducerTemplate context String uriPrefix getUriPrefix final String uri1 uriPrefix final String uri2 uriPrefix final String uri3 uriPrefix LOG info uri1 uri2 endpoint context getEndpoint uri1 assertNotNull endpoint context addRoutes new RouteBuilder public void configure from uri1 to uri2 from uri3 process new Processor public void process Exchange e
String localPart name getLocalPart Object answer null Message in exchange get getIn if uri null uri length answer variables get localPart if answer null Message message in if message null answer message getHeader localPart if answer null answer exchange get getProperty localPart else if uri equals SYSTEM_PROPERTIES_NAMESPACE try answer System getProperty localPart catch Exception e
protected synchronized XPathFactory createXPathFactory throws XPathFactoryConfigurationException if objectModelUri null String xpathFactoryClassName factoryClassName if objectModelUri equals SAXON_OBJECT_MODEL_URI xpathFactoryClassName null SAXON_FACTORY_CLASS_NAME equals xpathFactoryClassName try if camelContext null Class XPathFactory clazz camelContext getClassResolver resolveClass SAXON_FACTORY_CLASS_NAME XPathFactory class if clazz null
protected synchronized XPathFactory createXPathFactory throws XPathFactoryConfigurationException if objectModelUri null String xpathFactoryClassName factoryClassName if objectModelUri equals SAXON_OBJECT_MODEL_URI xpathFactoryClassName null SAXON_FACTORY_CLASS_NAME equals xpathFactoryClassName try if camelContext null Class XPathFactory clazz camelContext getClassResolver resolveClass SAXON_FACTORY_CLASS_NAME XPathFactory class if clazz null LOG debug clazz xpathFactory camelContext getInjector newInstance clazz
protected synchronized XPathFactory createXPathFactory throws XPathFactoryConfigurationException if objectModelUri null String xpathFactoryClassName factoryClassName if objectModelUri equals SAXON_OBJECT_MODEL_URI xpathFactoryClassName null SAXON_FACTORY_CLASS_NAME equals xpathFactoryClassName try if camelContext null Class XPathFactory clazz camelContext getClassResolver resolveClass SAXON_FACTORY_CLASS_NAME XPathFactory class if clazz null LOG debug clazz xpathFactory camelContext getInjector newInstance clazz LOG info xpathFactory catch Throwable e LOG warn SAXON_FACTORY_CLASS_NAME LOG debug e if xpathFactory null
String xpathFactoryClassName factoryClassName if objectModelUri equals SAXON_OBJECT_MODEL_URI xpathFactoryClassName null SAXON_FACTORY_CLASS_NAME equals xpathFactoryClassName try if camelContext null Class XPathFactory clazz camelContext getClassResolver resolveClass SAXON_FACTORY_CLASS_NAME XPathFactory class if clazz null LOG debug clazz xpathFactory camelContext getInjector newInstance clazz LOG info xpathFactory catch Throwable e LOG warn SAXON_FACTORY_CLASS_NAME LOG debug e if xpathFactory null LOG debug objectModelUri xpathFactory ObjectHelper isEmpty xpathFactoryClassName XPathFactory newInstance objectModelUri XPathFactory newInstance objectModelUri xpathFactoryClassName null
protected static XPathFactory createDefaultXPathFactory throws XPathFactoryConfigurationException XPathFactory factory null Properties properties System getProperties for Map Entry Object Object prop properties entrySet String key String prop getKey if key startsWith XPathFactory DEFAULT_PROPERTY_NAME String uri StringHelper after key if uri null factory XPathFactory newInstance uri
final XsltSaxonBuilder xslt injector newInstance XsltSaxonBuilder class TransformerFactory factory getTransformerFactory if factory null if getTransformerFactoryClass null factory new TransformerFactoryImpl else Class TransformerFactory factoryClass resolver resolveMandatoryClass getTransformerFactoryClass TransformerFactory class XsltSaxonComponent class getClassLoader LOG debug factoryClass factory injector newInstance factoryClass if factory TransformerFactoryImpl TransformerFactoryImpl tf TransformerFactoryImpl factory XsltSaxonHelper registerSaxonConfiguration tf saxonConfiguration XsltSaxonHelper registerSaxonConfigurationProperties tf saxonConfigurationProperties XsltSaxonHelper registerSaxonExtensionFunctions tf saxonExtensionFunctions if factory null
XMLReader xmlReader XMLReaderFactory createXMLReader for Map Entry String Object entry this saxonReaderProperties entrySet String key entry getKey Object value entry getValue try URI uri new URI key if value null value toString equals value toString equals xmlReader setFeature uri toString Boolean valueOf value toString else if value null xmlReader setProperty uri toString value catch URISyntaxException e LOG debug key InputSource inputSource SAXSource sourceToInputSource source return new SAXSource xmlReader inputSource catch SAXException e
public static void registerSaxonExtensionFunctions TransformerFactoryImpl factory List Object saxonExtensionFunctions throws Exception if saxonExtensionFunctions null saxonExtensionFunctions isEmpty factory setFeature XMLConstants FEATURE_SECURE_PROCESSING true for Object extensionFunction saxonExtensionFunctions if extensionFunction ExtensionFunctionDefinition
protected XsltBuilder createXsltBuilder throws Exception final CamelContext ctx getCamelContext final ClassResolver resolver ctx getClassResolver final Injector injector ctx getInjector LOG debug this resourceUri final XsltBuilder xslt injector newInstance XsltBuilder class TransformerFactory factory transformerFactory if factory null final String trFactoryClass transformerFactoryClass null transformerFactoryClass XsltComponent getComponent getTransformerFactoryClass if trFactoryClass null Class TransformerFactory factoryClass resolver resolveMandatoryClass trFactoryClass TransformerFactory class XsltComponent class getClassLoader
final ClassResolver resolver ctx getClassResolver final Injector injector ctx getInjector LOG debug this resourceUri final XsltBuilder xslt injector newInstance XsltBuilder class TransformerFactory factory transformerFactory if factory null final String trFactoryClass transformerFactoryClass null transformerFactoryClass XsltComponent getComponent getTransformerFactoryClass if trFactoryClass null Class TransformerFactory factoryClass resolver resolveMandatoryClass trFactoryClass TransformerFactory class XsltComponent class getClassLoader LOG debug factoryClass factory injector newInstance factoryClass final TransformerFactoryConfigurationStrategy tfConfigStrategy transformerFactoryConfigurationStrategy null transformerFactoryConfigurationStrategy XsltComponent getComponent getTransformerFactoryConfigurationStrategy if tfConfigStrategy null tfConfigStrategy configure factory this if factory null
Override public void error TransformerException e throws TransformerException
Override public void fatalError TransformerException e throws TransformerException
Test public void testSendXmlAndUnmarshal throws Exception MockEndpoint resultEndpoint resolveMandatoryEndpoint MockEndpoint class resultEndpoint expectedMessageCount PurchaseOrder expectedBody new PurchaseOrder expectedBody setAmount expectedBody setName expectedBody setPrice template sendBody expectedBody resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges Exchange exchange list get Object actualBody exchange getIn getBody
private String send Verb verb String params throws Exception String url apiUrl params null params OAuthRequest request new OAuthRequest verb url request addQuerystringParameter OAuthConstants ACCESS_TOKEN apiAccessToken StringBuilder sb new StringBuilder sb append sb append apiAccessToken request addHeader sb toString if LOG isDebugEnabled
Test public void testGetTickets throws Exception final Iterable result requestBody null assertNotNull result int count for Object ticket result
camelContext getManagementStrategy addEventNotifier eventNotifier if camelContext getRoutePolicyFactories contains this camelContext addRoutePolicyFactory this if spanReporter null if endpoint null LOG info endpoint spanReporter AsyncReporter create URLConnectionSender create endpoint else if hostName null port LOG info hostName port LibthriftSender sender LibthriftSender newBuilder host hostName port port build spanReporter AsyncReporter create sender else String host ServiceHostFunction apply ZIPKIN_COLLECTOR_HTTP_SERVICE String port ServicePortFunction apply ZIPKIN_COLLECTOR_HTTP_SERVICE if ObjectHelper isNotEmpty host ObjectHelper isNotEmpty port
else if hostName null port LOG info hostName port LibthriftSender sender LibthriftSender newBuilder host hostName port port build spanReporter AsyncReporter create sender else String host ServiceHostFunction apply ZIPKIN_COLLECTOR_HTTP_SERVICE String port ServicePortFunction apply ZIPKIN_COLLECTOR_HTTP_SERVICE if ObjectHelper isNotEmpty host ObjectHelper isNotEmpty port LOG info host port int num camelContext getTypeConverter mandatoryConvertTo Integer class port String implicitEndpoint host num spanReporter AsyncReporter create URLConnectionSender create implicitEndpoint else host ServiceHostFunction apply ZIPKIN_COLLECTOR_THRIFT_SERVICE port ServicePortFunction apply ZIPKIN_COLLECTOR_THRIFT_SERVICE
private Tracing getTracing String serviceName Tracing brave null if serviceName null brave braves get serviceName if brave null useFallbackServiceNames
Span Kind spanKind getProducerComponentSpanKind event getEndpoint span kind spanKind start ZipkinClientRequestAdapter parser new ZipkinClientRequestAdapter this event getEndpoint CamelRequest request new CamelRequest event getExchange getIn spanKind INJECTOR inject span context request parser onRequest event getExchange span customizer state pushClientSpan span TraceContext context span context String traceId context traceIdString String spanId context spanId String parentId context parentId null context parentId null if camelContext isUseMDCLogging MDC put traceId MDC put spanId MDC put parentId
span kind spanKind start ZipkinClientRequestAdapter parser new ZipkinClientRequestAdapter this event getEndpoint CamelRequest request new CamelRequest event getExchange getIn spanKind INJECTOR inject span context request parser onRequest event getExchange span customizer state pushClientSpan span TraceContext context span context String traceId context traceIdString String spanId context spanId String parentId context parentId null context parentId null if camelContext isUseMDCLogging MDC put traceId MDC put spanId MDC put parentId if LOG isDebugEnabled
span state popClientSpan if span null ZipkinClientResponseAdaptor parser new ZipkinClientResponseAdaptor this event getEndpoint parser onResponse event getExchange span customizer span finish TraceContext context span context String traceId context traceIdString String spanId context spanId String parentId context parentId null context parentId null if camelContext isUseMDCLogging MDC put traceId MDC put spanId MDC put parentId if LOG isDebugEnabled if parentId null
if span null ZipkinClientResponseAdaptor parser new ZipkinClientResponseAdaptor this event getEndpoint parser onResponse event getExchange span customizer span finish TraceContext context span context String traceId context traceIdString String spanId context spanId String parentId context parentId null context parentId null if camelContext isUseMDCLogging MDC put traceId MDC put spanId MDC put parentId if LOG isDebugEnabled if parentId null LOG debug String format serviceName traceId spanId parentId
else span brave tracer nextSpan sampleFlag span kind spanKind start ZipkinServerRequestAdapter parser new ZipkinServerRequestAdapter this exchange parser onRequest exchange span customizer state pushServerSpan span TraceContext context span context String traceId context traceIdString String spanId context spanId String parentId context parentId null context parentId null if camelContext isUseMDCLogging MDC put traceId MDC put spanId MDC put parentId if LOG isDebugEnabled
span brave tracer nextSpan sampleFlag span kind spanKind start ZipkinServerRequestAdapter parser new ZipkinServerRequestAdapter this exchange parser onRequest exchange span customizer state pushServerSpan span TraceContext context span context String traceId context traceIdString String spanId context spanId String parentId context parentId null context parentId null if camelContext isUseMDCLogging MDC put traceId MDC put spanId MDC put parentId if LOG isDebugEnabled if parentId null
span state popServerSpan if span null ZipkinServerResponseAdapter parser new ZipkinServerResponseAdapter this exchange parser onResponse exchange span customizer span finish TraceContext context span context String traceId context traceIdString String spanId context spanId String parentId context parentId null context parentId null if camelContext isUseMDCLogging MDC put traceId MDC put spanId MDC put parentId if LOG isDebugEnabled if parentId null
if span null ZipkinServerResponseAdapter parser new ZipkinServerResponseAdapter this exchange parser onResponse exchange span customizer span finish TraceContext context span context String traceId context traceIdString String spanId context spanId String parentId context parentId null context parentId null if camelContext isUseMDCLogging MDC put traceId MDC put spanId MDC put parentId if LOG isDebugEnabled if parentId null LOG debug String format serviceName traceId spanId parentId
Override public void report S span
Override protected void doStart throws Exception super doStart String path endpoint getComponent getCamelClusterPath endpoint getGroupName this groupListener new ZookeeperGroupListenerSupport path endpoint onLockOwned onDisconnected this groupListener setCamelContext endpoint getCamelContext this groupListener setZooKeeperUrl endpoint getComponent getZooKeeperUrl this groupListener setZooKeeperPassword endpoint getComponent getZooKeeperPassword this groupListener setCurator endpoint getComponent getCurator this groupListener setMaximumConnectionTimeout endpoint getComponent getMaximumConnectionTimeout ServiceHelper startService groupListener
protected Runnable onLockOwned return if delegate null try LOG info endpoint getConsumerEndpoint ServiceHelper startService endpoint getConsumerEndpoint delegate endpoint getConsumerEndpoint createConsumer processor delegateService null if delegate SuspendableService delegateService SuspendableService delegate thisNodeState createNodeState thisNodeState setStarted true groupListener updateState thisNodeState ServiceHelper startService delegate catch Exception e
Override protected void doStart throws Exception ObjectHelper notNull camelContext if curator null try CuratorFramework aCurator getCamelContext getRegistry lookupByNameAndType CuratorFramework class if aCurator null
if connectString null String zkHost System getenv ZOOKEEPER_HOST_ENV if zkHost null String zkPort System getenv ZOOKEEPER_PORT_ENV connectString zkHost zkPort null zkPort if connectString null connectString System getProperty ZOOKEEPER_URL String password getZooKeeperPassword if password null System getProperty ZOOKEEPER_PASSWORD LOG info connectString CuratorFrameworkFactory Builder builder CuratorFrameworkFactory builder connectString connectString retryPolicy new RetryOneTime connectionTimeoutMs getMaximumConnectionTimeout if password null password isEmpty builder authorization password getBytes curator builder build
Override public void stateChanged CuratorFramework client ConnectionState newState
private void prunePartialState final T ourState final String pathId throws Exception if ourState uuid null clearAndRefresh true true List ChildData T children new ArrayList currentData values for ChildData T child children if ourState uuid equals child getNode uuid child getPath equals pathId
protected void handleException Throwable e if e IllegalStateException equals e getMessage
Override protected void doStart throws Exception super doStart ObjectHelper notNull camelContext StringHelper notEmpty groupName String path getCamelClusterPath groupName this groupListener new ZookeeperGroupListenerSupport path route getEndpoint onLockOwned onDisconnected this groupListener setCamelContext camelContext this groupListener setCurator curator this groupListener setMaximumConnectionTimeout maximumConnectionTimeout this groupListener setZooKeeperUrl zooKeeperUrl this groupListener setZooKeeperPassword zooKeeperPassword ServiceHelper startService groupListener
Override public CuratorFramework getObject throws Exception LOG debug connectString CuratorFrameworkFactory Builder builder CuratorFrameworkFactory builder connectString connectString retryPolicy new ExponentialBackoffRetry connectionTimeoutMs getTimeout this curator builder build
protected void assertMessageReceived MockEndpoint masterEndpoint MockEndpoint standbyEndpoint throws InterruptedException masterEndpoint reset standbyEndpoint reset String expectedBody createNextExpectedBody masterEndpoint expectedBodiesReceived expectedBody standbyEndpoint expectedMessageCount template sendBody expectedBody
String groupNode System currentTimeMillis curator create creatingParentsIfNeeded forPath groupNode curator getZookeeperClient blockUntilConnectedOrTimedOut final ZooKeeperGroup NodeState group new ZooKeeperGroup curator groupNode NodeState class group add listener group start GroupCondition groupCondition new GroupCondition group add groupCondition group update new NodeState assertTrue groupCondition waitForConnected TimeUnit SECONDS assertTrue groupCondition waitForMaster TimeUnit SECONDS ChildData currentData group getCurrentData get final int version currentData getStat getVersion NodeState lastState group getLastState String json lastState toString
group update new NodeState assertTrue groupCondition waitForConnected TimeUnit SECONDS assertTrue groupCondition waitForMaster TimeUnit SECONDS ChildData currentData group getCurrentData get final int version currentData getStat getVersion NodeState lastState group getLastState String json lastState toString LOGGER info json String newValWithNewField json substring json lastIndexOf curator getZookeeperClient getZooKeeper setData group getId newValWithNewField getBytes version assertTrue group isMaster int attempts while attempts version group getCurrentData get getStat getVersion TimeUnit SECONDS sleep assertNotEquals version group getCurrentData get getStat getVersion
private void initializeDataConsumer String node if shuttingDown if LOG isDebugEnabled
private void initializeChildListingConsumer String node if shuttingDown if LOG isDebugEnabled
if connection null connection this zkm getConnection ProductionContext context new ProductionContext connection exchange String operation exchange getIn getHeader ZooKeeperMessage ZOOKEEPER_OPERATION String class boolean isDelete ZK_OPERATION_DELETE equals operation if ExchangeHelper isOutCapable exchange if isDelete if LOG isDebugEnabled LOG debug format context node OperationResult result synchronouslyDelete context if configuration isListChildren result listChildren context updateExchangeWithResult context result else if LOG isDebugEnabled
private void asynchronouslyDeleteNode ZooKeeper connection ProductionContext context if LOG isDebugEnabled
private void asynchronouslySetDataOnNode ZooKeeper connection ProductionContext context if LOG isDebugEnabled
Override protected void doStart throws Exception if curator null ObjectHelper notNull getCamelContext ObjectHelper notNull configuration getBasePath
Override protected void doStart throws Exception if curator null ObjectHelper notNull getCamelContext ObjectHelper notNull configuration getBasePath
private CuratorFramework getOrCreateCurator throws Exception if curator null curator configuration getCuratorFramework if curator null managedInstance true
Override public OperationResult String getResult try ZooKeeperHelper mkdirs connection node false CreateMode PERSISTENT String created connection create node data permissions createMode if LOG isDebugEnabled
Override public void process WatchedEvent event this event event EventType received event getType if LOG isDebugEnabled
service setId id service setNodes connectString service setBasePath DefaultCamelContext context new DefaultCamelContext context disableJMX context setName id context addService service context addRoutePolicyFactory ClusteredRoutePolicyFactory forNamespace context addRoutes new RouteBuilder Override public void configure throws Exception from routeId id log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt context start contextLatch await
ZooKeeperClusterService service new ZooKeeperClusterService service setId id service setNodes connectString service setBasePath DefaultCamelContext context new DefaultCamelContext context disableJMX context setName id context addService service context addRoutes new RouteBuilder Override public void configure throws Exception from routeId id routePolicy ClusteredRoutePolicy forNamespace log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt context start contextLatch await
ZooKeeperClusterService service new ZooKeeperClusterService service setId id service setNodes connectString service setBasePath DefaultCamelContext context new DefaultCamelContext context disableJMX context setName id context addService service context addRoutes new RouteBuilder Override public void configure throws Exception from routeId id log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt context start contextLatch await
protected void configureSSLContext SSLContext context throws GeneralSecurityException LOG trace context if this getSessionTimeout null
enabledCipherSuitePatterns this getCipherSuitesFilter getPatterns else enabledCipherSuitePatterns null final List String enabledSecureSocketProtocols this getSecureSocketProtocols null null this parsePropertyValues this getSecureSocketProtocols getSecureSocketProtocol final Patterns enabledSecureSocketProtocolsPatterns final Patterns defaultEnabledSecureSocketProtocolsPatterns this getDefaultSecureSocketProcotolFilter getPatterns if this getSecureSocketProtocolsFilter null enabledSecureSocketProtocolsPatterns this getSecureSocketProtocolsFilter getPatterns else enabledSecureSocketProtocolsPatterns null final boolean allowPassthrough getAllowPassthrough Configurer SSLEngine sslEngineConfigurer new Configurer SSLEngine Override public SSLEngine configure SSLEngine engine Collection String filteredCipherSuites BaseSSLContextParameters this filter enabledCipherSuites Arrays asList engine getSSLParameters getCipherSuites Arrays asList engine getEnabledCipherSuites enabledCipherSuitePatterns defaultEnabledCipherSuitePatterns allowPassthrough if LOG isDebugEnabled
final List String enabledSecureSocketProtocols this getSecureSocketProtocols null null this parsePropertyValues this getSecureSocketProtocols getSecureSocketProtocol final Patterns enabledSecureSocketProtocolsPatterns final Patterns defaultEnabledSecureSocketProtocolsPatterns this getDefaultSecureSocketProcotolFilter getPatterns if this getSecureSocketProtocolsFilter null enabledSecureSocketProtocolsPatterns this getSecureSocketProtocolsFilter getPatterns else enabledSecureSocketProtocolsPatterns null final boolean allowPassthrough getAllowPassthrough Configurer SSLEngine sslEngineConfigurer new Configurer SSLEngine Override public SSLEngine configure SSLEngine engine Collection String filteredCipherSuites BaseSSLContextParameters this filter enabledCipherSuites Arrays asList engine getSSLParameters getCipherSuites Arrays asList engine getEnabledCipherSuites enabledCipherSuitePatterns defaultEnabledCipherSuitePatterns allowPassthrough if LOG isDebugEnabled LOG debug SSL_ENGINE_CIPHER_SUITE_LOG_MSG engine enabledCipherSuites enabledCipherSuitePatterns engine getSSLParameters getCipherSuites engine getEnabledCipherSuites defaultEnabledCipherSuitePatterns filteredCipherSuites engine setEnabledCipherSuites filteredCipherSuites toArray new String filteredCipherSuites size Collection String filteredSecureSocketProtocols BaseSSLContextParameters this filter enabledSecureSocketProtocols Arrays asList engine getSSLParameters getProtocols Arrays asList engine getEnabledProtocols enabledSecureSocketProtocolsPatterns defaultEnabledSecureSocketProtocolsPatterns allowPassthrough
final List String enabledSecureSocketProtocols this getSecureSocketProtocols null null this parsePropertyValues this getSecureSocketProtocols getSecureSocketProtocol final Patterns enabledSecureSocketProtocolsPatterns final Patterns defaultEnabledSecureSocketProtocolsPatterns this getDefaultSecureSocketProcotolFilter getPatterns if this getSecureSocketProtocolsFilter null enabledSecureSocketProtocolsPatterns this getSecureSocketProtocolsFilter getPatterns else enabledSecureSocketProtocolsPatterns null final boolean allowPassthrough getAllowPassthrough Configurer SSLSocket sslSocketConfigurer new Configurer SSLSocket Override public SSLSocket configure SSLSocket socket if getSNIHostNames isEmpty SSLParameters sslParameters socket getSSLParameters sslParameters setServerNames getSNIHostNames socket setSSLParameters sslParameters Collection String filteredCipherSuites BaseSSLContextParameters this filter enabledCipherSuites Arrays asList socket getSSLParameters getCipherSuites Arrays asList socket getEnabledCipherSuites enabledCipherSuitePatterns defaultEnabledCipherSuitePatterns allowPassthrough
if this getSecureSocketProtocolsFilter null enabledSecureSocketProtocolsPatterns this getSecureSocketProtocolsFilter getPatterns else enabledSecureSocketProtocolsPatterns null final boolean allowPassthrough getAllowPassthrough Configurer SSLSocket sslSocketConfigurer new Configurer SSLSocket Override public SSLSocket configure SSLSocket socket if getSNIHostNames isEmpty SSLParameters sslParameters socket getSSLParameters sslParameters setServerNames getSNIHostNames socket setSSLParameters sslParameters Collection String filteredCipherSuites BaseSSLContextParameters this filter enabledCipherSuites Arrays asList socket getSSLParameters getCipherSuites Arrays asList socket getEnabledCipherSuites enabledCipherSuitePatterns defaultEnabledCipherSuitePatterns allowPassthrough if LOG isDebugEnabled LOG debug SSL_SOCKET_CIPHER_SUITE_LOG_MSG socket enabledCipherSuites enabledCipherSuitePatterns socket getSSLParameters getCipherSuites socket getEnabledCipherSuites defaultEnabledCipherSuitePatterns filteredCipherSuites socket setEnabledCipherSuites filteredCipherSuites toArray new String filteredCipherSuites size
enabledCipherSuitePatterns this getCipherSuitesFilter getPatterns else enabledCipherSuitePatterns null final List String enabledSecureSocketProtocols this getSecureSocketProtocols null null this parsePropertyValues this getSecureSocketProtocols getSecureSocketProtocol final Patterns enabledSecureSocketProtocolsPatterns final Patterns defaultEnabledSecureSocketProtocolsPatterns this getDefaultSecureSocketProcotolFilter getPatterns if this getSecureSocketProtocolsFilter null enabledSecureSocketProtocolsPatterns this getSecureSocketProtocolsFilter getPatterns else enabledSecureSocketProtocolsPatterns null final boolean allowPassthrough getAllowPassthrough Configurer SSLServerSocket sslServerSocketConfigurer new Configurer SSLServerSocket Override public SSLServerSocket configure SSLServerSocket socket Collection String filteredCipherSuites BaseSSLContextParameters this filter enabledCipherSuites Arrays asList socket getSupportedCipherSuites Arrays asList socket getEnabledCipherSuites enabledCipherSuitePatterns defaultEnabledCipherSuitePatterns allowPassthrough if LOG isDebugEnabled
final List String enabledSecureSocketProtocols this getSecureSocketProtocols null null this parsePropertyValues this getSecureSocketProtocols getSecureSocketProtocol final Patterns enabledSecureSocketProtocolsPatterns final Patterns defaultEnabledSecureSocketProtocolsPatterns this getDefaultSecureSocketProcotolFilter getPatterns if this getSecureSocketProtocolsFilter null enabledSecureSocketProtocolsPatterns this getSecureSocketProtocolsFilter getPatterns else enabledSecureSocketProtocolsPatterns null final boolean allowPassthrough getAllowPassthrough Configurer SSLServerSocket sslServerSocketConfigurer new Configurer SSLServerSocket Override public SSLServerSocket configure SSLServerSocket socket Collection String filteredCipherSuites BaseSSLContextParameters this filter enabledCipherSuites Arrays asList socket getSupportedCipherSuites Arrays asList socket getEnabledCipherSuites enabledCipherSuitePatterns defaultEnabledCipherSuitePatterns allowPassthrough if LOG isDebugEnabled LOG debug SSL_SERVER_SOCKET_CIPHER_SUITE_LOG_MSG socket enabledCipherSuites enabledCipherSuitePatterns socket getSupportedCipherSuites socket getEnabledCipherSuites defaultEnabledCipherSuitePatterns filteredCipherSuites socket setEnabledCipherSuites filteredCipherSuites toArray new String filteredCipherSuites size Collection String filteredSecureSocketProtocols BaseSSLContextParameters this filter enabledSecureSocketProtocols Arrays asList socket getSupportedProtocols Arrays asList socket getEnabledProtocols enabledSecureSocketProtocolsPatterns defaultEnabledSecureSocketProtocolsPatterns allowPassthrough
protected InputStream resolveResource String resource throws IOException InputStream is null try LOG trace resource is new FileInputStream resource
protected InputStream resolveResource String resource throws IOException InputStream is null try LOG trace resource is new FileInputStream resource LOG debug resource catch FileNotFoundException e LOG trace resource e if is null this context null LOG trace context getClassResolver try is context getClassResolver loadResourceAsStream resource if is null LOG trace resource context getClassResolver else
if is null this context null LOG trace context getClassResolver try is context getClassResolver loadResourceAsStream resource if is null LOG trace resource context getClassResolver else LOG debug resource this getClass getClassLoader catch Throwable e LOG trace resource e if is null Thread currentThread getContextClassLoader null LOG trace resource Thread currentThread getContextClassLoader is Thread currentThread getContextClassLoader getResourceAsStream resource if is null LOG trace resource Thread currentThread getContextClassLoader
else LOG debug resource this getClass getClassLoader catch Throwable e LOG trace resource e if is null Thread currentThread getContextClassLoader null LOG trace resource Thread currentThread getContextClassLoader is Thread currentThread getContextClassLoader getResourceAsStream resource if is null LOG trace resource Thread currentThread getContextClassLoader else LOG debug resource Thread currentThread getContextClassLoader if is null LOG trace resource this getClass getClassLoader is this getClass getResourceAsStream resource if is null
catch Throwable e LOG trace resource e if is null Thread currentThread getContextClassLoader null LOG trace resource Thread currentThread getContextClassLoader is Thread currentThread getContextClassLoader getResourceAsStream resource if is null LOG trace resource Thread currentThread getContextClassLoader else LOG debug resource Thread currentThread getContextClassLoader if is null LOG trace resource this getClass getClassLoader is this getClass getResourceAsStream resource if is null LOG trace resource this getClass getClassLoader else
String kmfAlgorithm this parsePropertyValue this getAlgorithm if kmfAlgorithm null kmfAlgorithm KeyManagerFactory getDefaultAlgorithm KeyManagerFactory kmf if this getProvider null kmf KeyManagerFactory getInstance kmfAlgorithm else kmf KeyManagerFactory getInstance kmfAlgorithm this parsePropertyValue this getProvider LOG debug new Object kmf this kmf getProvider kmf getAlgorithm char kmfPassword null if this getKeyPassword null kmfPassword this parsePropertyValue this getKeyPassword toCharArray KeyStore ks this getKeyStore null null this getKeyStore createKeyStore kmf init ks kmfPassword keyManagers kmf getKeyManagers
Override protected void configureSSLContext SSLContext context throws GeneralSecurityException LOG trace context if this getSessionTimeout null
serverParameters setCamelContext camelContext LOG trace this LOG info Security getProviders KeyManager keyManagers this keyManagers null null this keyManagers createKeyManagers TrustManager trustManagers this trustManagers null null this trustManagers createTrustManagers SecureRandom secureRandom this secureRandom null null this secureRandom createSecureRandom SSLContext context if this getProvider null context SSLContext getInstance this parsePropertyValue this getSecureSocketProtocol else context SSLContext getInstance this parsePropertyValue this getSecureSocketProtocol this parsePropertyValue this getProvider if this getCertAlias null keyManagers null for int idx idx keyManagers length idx if keyManagers idx X509KeyManager try
Override protected void configureSSLContext SSLContext context throws GeneralSecurityException LOG trace context if this getSessionTimeout null
LOG trace this TrustManager trustManagers null if this getKeyStore null String tmfAlgorithm this parsePropertyValue this getAlgorithm if tmfAlgorithm null tmfAlgorithm TrustManagerFactory getDefaultAlgorithm TrustManagerFactory tmf if this getProvider null tmf TrustManagerFactory getInstance tmfAlgorithm else tmf TrustManagerFactory getInstance tmfAlgorithm this parsePropertyValue this getProvider LOG debug new Object tmf tmf getProvider tmf getAlgorithm KeyStore ks this getKeyStore null null this getKeyStore createKeyStore tmf init ks trustManagers tmf getTrustManagers
public static boolean resumeService Object service if service Suspendable service SuspendableService SuspendableService ss SuspendableService service if ss isSuspended
if environmentVariableMode ENVIRONMENT_VARIABLES_MODE_NEVER environmentVariableMode ENVIRONMENT_VARIABLES_MODE_FALLBACK environmentVariableMode ENVIRONMENT_VARIABLES_MODE_OVERRIDE throw new IllegalArgumentException environmentVariableMode if propertiesParser DefaultPropertiesParser DefaultPropertiesParser propertiesParser setPropertiesComponent this if isAutoDiscoverPropertiesSources try for PropertiesSource source getCamelContext getRegistry findByType PropertiesSource class addPropertiesSource source LOG info source FactoryFinder factoryFinder getCamelContext adapt ExtendedCamelContext class getFactoryFinder Class type factoryFinder findClass orElse null if type null Object obj getCamelContext getInjector newInstance type false if obj PropertiesSource PropertiesSource ps PropertiesSource obj
private List PropertiesLocation parseLocations List PropertiesLocation locations List PropertiesLocation answer new ArrayList for PropertiesLocation location locations LOG trace location try String path FilePathResolver resolvePath location getPath
LOG trace META_INF_SERVICES try packageNames findPackageNames if packageNames null packageNames length LOG debug return catch Exception e throw new TypeConverterLoaderException e if packageNames length equals packageNames LOG debug return packageNames filterUnwantedPackage packageNames Set Class classes new HashSet packageNames filterPackageNamesOnly resolver packageNames classes if classes isEmpty
catch Exception e throw new TypeConverterLoaderException e if packageNames length equals packageNames LOG debug return packageNames filterUnwantedPackage packageNames Set Class classes new HashSet packageNames filterPackageNamesOnly resolver packageNames classes if classes isEmpty LOG debug classes size if packageNames null packageNames length if LOG isTraceEnabled LOG trace String join packageNames Set Class scannedClasses resolver findAnnotated Converter class packageNames if scannedClasses isEmpty
protected void findPackages Set String packages ClassLoader classLoader throws IOException Enumeration URL resources classLoader getResources META_INF_SERVICES while resources hasMoreElements URL url resources nextElement String path url getPath if visitedURIs contains path visitedURIs add path
if method getAnnotation Converter class null allowNull method getAnnotation Converter class allowNull boolean fallback method getAnnotation Converter class fallback if fallback injector handleHasFallbackConverterAnnotation registry type injector method allowNull else injector handleHasConverterAnnotation registry type injector method allowNull Class superclass type getSuperclass if superclass null superclass equals Object class loadConverterMethods registry superclass catch NoClassDefFoundError e boolean ignore false if ObjectHelper hasAnnotation type Converter class true if type getAnnotation Converter class null ignore type getAnnotation Converter class ignoreOnLoadError
public void loadCoreAndFastTypeConverters throws Exception Collection String names findTypeConverterLoaderClasses for String name names
Collection String names findTypeConverterLoaderClasses for String name names LOG debug name Class clazz null for ClassLoader loader getResolver getClassLoaders try clazz loader loadClass name catch Throwable e if clazz null break if clazz null throw new ClassNotFoundException name Object obj getInjector newInstance clazz false if obj TypeConverterLoader TypeConverterLoader loader TypeConverterLoader obj
protected Collection String findTypeConverterLoaderClasses throws IOException Set String loaders new LinkedHashSet Collection URL loaderResources getLoaderUrls for URL url loaderResources
protected Collection String findFallbackTypeConverterClasses throws IOException Set String loaders new LinkedHashSet Collection URL loaderResources getFallbackUrls for URL url loaderResources
protected void loadFallbackTypeConverters throws IOException ClassNotFoundException Collection String names findFallbackTypeConverterClasses for String name names
protected void loadFallbackTypeConverters throws IOException ClassNotFoundException Collection String names findFallbackTypeConverterClasses for String name names LOG debug name Class clazz getResolver getClassLoaders stream map cl ObjectHelper loadClass name cl filter Objects :: nonNull findAny orElseThrow new ClassNotFoundException name Object obj getInjector newInstance clazz false if obj TypeConverter TypeConverter fb TypeConverter obj
return rc else if converter allowNull return null if type isPrimitive Class primitiveType ObjectHelper convertPrimitiveTypeToWrapperType type if primitiveType type Class fromType value getClass TypeConverter tc getOrFindTypeConverter primitiveType fromType if tc null addTypeConverter type fromType tc Object rc if tryConvert rc tc tryConvertTo primitiveType exchange value else rc tc convertTo primitiveType exchange value
Override protected void doInit throws Exception StopWatch watch new StopWatch super doInit loadCoreAndFastTypeConverters String time TimeUtils printDuration watch taken
Override public void scanTypeConverters throws Exception StopWatch watch new StopWatch if loadTypeConvertersDone loadTypeConvertersDone true if resolver null typeConverterLoaders add new AnnotationTypeConverterLoader resolver int fast typeMappings size loadTypeConverters int additional typeMappings size fast if additional LOG info fast additional LOG warn additional if resolver null resolver clearCache String time TimeUtils printDuration watch taken
private Component initComponent String name boolean autoCreateComponents Component component null if autoCreateComponents try if LOG isDebugEnabled
if answer null try scheme StringHelper before uri if scheme null answer getRegistry lookupByNameAndType uri Endpoint class if answer null return answer else throw new NoSuchEndpointException uri LOG trace uri scheme Component component getComponent scheme ServiceHelper initService component if component null LOG trace uri component if component useRawUri
if answer null try scheme StringHelper before uri if scheme null answer getRegistry lookupByNameAndType uri Endpoint class if answer null return answer else throw new NoSuchEndpointException uri LOG trace uri scheme Component component getComponent scheme ServiceHelper initService component if component null LOG trace uri component if component useRawUri
Override public void addRoutes final RoutesBuilder builder throws Exception try LifecycleHelper helper new LifecycleHelper build
if routeService null if getRouteStatus routeId isStopped try routeService setRemovingRoutes true shutdownRouteService routeService routeServices remove routeId routeStartupOrder removeIf order order getRoute getId equals routeId Set Endpoint toRemove new LinkedHashSet for Endpoint endpoint endpointsInUse get routeId int count for Set Endpoint endpoints endpointsInUse values if endpoints contains endpoint count if count toRemove add endpoint
public String getEipParameterJsonSchema String eipName throws IOException String subPackages new String for String sub subPackages String path CamelContextHelper MODEL_DOCUMENTATION_PREFIX sub eipName ClassResolver resolver getClassResolver InputStream inputStream resolver loadResourceAsStream path if inputStream null
Override public String resolvePropertyPlaceholders String text if text null text contains PropertiesComponent PREFIX_TOKEN String answer getPropertiesComponent parseUri text
List RouteStartupOrder orders new ArrayList for Map Entry String RouteService entry suspendedRouteServices entrySet Route route entry getValue getRoute Integer order route getStartupOrder if order null order defaultRouteStartupOrder orders add new DefaultRouteStartupOrder order route entry getValue getShutdownStrategy suspend this orders for RouteService service suspendedRouteServices values if routeSupportsSuspension service getId service suspend else service stop watch taken if LOG isInfoEnabled
doNotStartRoutesOnFirstStart firstStartDone isAutoStartup if firstStartDone isAutoStartup isStarted try internalRouteStartupManager doStartOrResumeRoutes routeServices true true false true catch Exception e throw RuntimeCamelException wrapRuntimeException e try firstStartDone true doStartCamel catch Exception e VetoCamelContextStartException veto ObjectHelper getException VetoCamelContextStartException class e if veto null vetoed veto return else
firstStartDone true doStartCamel catch Exception e VetoCamelContextStartException veto ObjectHelper getException VetoCamelContextStartException class e if veto null vetoed veto return else LOG error getName e getMessage e throw RuntimeCamelException wrapRuntimeException e if LOG isInfoEnabled int started for Route route getRoutes ServiceStatus status getRouteStatus route getId if status null status isStarted
catch Exception e VetoCamelContextStartException veto ObjectHelper getException VetoCamelContextStartException class e if veto null vetoed veto return else LOG error getName e getMessage e throw RuntimeCamelException wrapRuntimeException e if LOG isInfoEnabled int started for Route route getRoutes ServiceStatus status getRouteStatus route getId if status null status isStarted started final Collection Route controlledRoutes getRouteController getControlledRoutes
Override protected void doStop throws Exception stopWatch restart LOG info getVersion getName EventHelper notifyCamelContextStopping this EventHelper notifyCamelContextRoutesStopping this ServiceHelper stopAndShutdownService this routeController try if shutdownStrategy null shutdownStrategy shutdownForced this getRouteStartupOrder catch Throwable e LOG warn e shutdownServices asyncProcessorAwaitManager for RouteService routeService routeServices values boolean found routeStartupOrder stream anyMatch o o getRoute getId equals routeService getId if found
protected void logRouteState Route route String state if LOG isInfoEnabled if route getConsumer null String uri route getEndpoint getEndpointBaseUri uri URISupport sanitizeUri uri
Override public void setDefaultThreadPoolProfile ThreadPoolProfile defaultThreadPoolProfile threadPoolProfiles remove defaultThreadPoolProfileId defaultThreadPoolProfile addDefaults defaultProfile
Override public ExecutorService newThreadPool Object source String name ThreadPoolProfile profile String sanitizedName URISupport sanitizeUri name ObjectHelper notNull profile ThreadPoolProfile defaultProfile getDefaultThreadPoolProfile profile addDefaults defaultProfile ThreadFactory threadFactory createThreadFactory sanitizedName true ExecutorService executorService threadPoolFactory newThreadPool profile threadFactory onThreadPoolCreated executorService source profile getId if LOG isDebugEnabled
Override public ExecutorService newCachedThreadPool Object source String name String sanitizedName URISupport sanitizeUri name ExecutorService answer threadPoolFactory newCachedThreadPool createThreadFactory sanitizedName true onThreadPoolCreated answer source null if LOG isDebugEnabled
Override public ScheduledExecutorService newScheduledThreadPool Object source String name ThreadPoolProfile profile String sanitizedName URISupport sanitizeUri name profile addDefaults getDefaultThreadPoolProfile ScheduledExecutorService answer threadPoolFactory newScheduledThreadPool profile createThreadFactory sanitizedName true onThreadPoolCreated answer source null if LOG isDebugEnabled
StopWatch watch new StopWatch LOG trace executorService shutdownAwaitTermination executorService shutdown if shutdownAwaitTermination try if awaitTermination executorService shutdownAwaitTermination warned true LOG warn executorService executorService shutdownNow if awaitTermination executorService shutdownAwaitTermination LOG warn executorService catch InterruptedException e warned true LOG warn executorService executorService shutdownNow
executorService shutdown if shutdownAwaitTermination try if awaitTermination executorService shutdownAwaitTermination warned true LOG warn executorService executorService shutdownNow if awaitTermination executorService shutdownAwaitTermination LOG warn executorService catch InterruptedException e warned true LOG warn executorService executorService shutdownNow if warned LOG info executorService executorService isShutdown executorService isTerminated TimeUtils printDuration watch taken
Override protected void doShutdown throws Exception Set ExecutorService forced new LinkedHashSet if executorServices isEmpty
public void consumerInjection Method method Object bean String beanName Consume consume method getAnnotation Consume class if consume null
if endpoint null boolean multipleConsumer false if endpoint MultipleConsumersSupport multipleConsumer MultipleConsumersSupport endpoint isMultipleConsumersSupported try SubscribeMethodProcessor processor getConsumerProcessor endpoint if multipleConsumer processor null processor new SubscribeMethodProcessor endpoint endpoint getCamelContext addService processor true processor addMethod bean method endpoint predicate Consumer consumer endpoint createConsumer processor startService consumer endpoint getCamelContext bean beanName else processor addMethod bean method endpoint predicate if predicate null
if endpoint MultipleConsumersSupport multipleConsumer MultipleConsumersSupport endpoint isMultipleConsumersSupported try SubscribeMethodProcessor processor getConsumerProcessor endpoint if multipleConsumer processor null processor new SubscribeMethodProcessor endpoint endpoint getCamelContext addService processor true processor addMethod bean method endpoint predicate Consumer consumer endpoint createConsumer processor startService consumer endpoint getCamelContext bean beanName else processor addMethod bean method endpoint predicate if predicate null LOG debug method endpoint predicate else
try Class type classLoader loadClass externalName log trace type classLoader if test matches type log trace type classLoader classes add type found true break catch ClassNotFoundException e if log isTraceEnabled log trace fqn classLoader e getMessage e catch NoClassDefFoundError e if log isTraceEnabled log trace fqn classLoader e getMessage e if found
if url toString startsWith urlPath startsWith log trace url continue if urlPath indexOf urlPath urlPath substring urlPath indexOf log trace urlPath subPattern File file new File urlPath if file isDirectory log trace file loadImplementationsInDirectory subPattern packageName file resources else InputStream stream if urlPath startsWith urlPath startsWith urlPath startsWith isAcceptableScheme urlPath log trace urlPath URL urlStream new URL urlPath
JarEntry entry while entry jarStream getNextJarEntry null String name entry getName if name null name name trim if entry isDirectory name endsWith if name startsWith packageName entries add name catch IOException ioe log warn urlPath ioe getMessage ioe finally IOHelper close jarStream urlPath log for String name entries String shortName name substring packageName length boolean match PATH_MATCHER match subPattern shortName
private void loadImplementationsInDirectory String subPattern String parent File location Set KeyValueHolder String InputStream resources throws FileNotFoundException File files location listFiles if files null files length return StringBuilder builder for File file files builder new StringBuilder String name file getName name name trim builder append parent append append name String packageOrClass parent null name builder toString if file isDirectory loadImplementationsInDirectory subPattern packageOrClass file resources else if file isFile file exists name endsWith boolean match PATH_MATCHER match subPattern name
if statistics null statistics onHit endpoint getEndpointUri if producer StatefulService StatefulService ss StatefulService producer if ss isStarting LOG trace producer StopWatch watch new StopWatch boolean done false while done done ss isStarting watch taken ACQUIRE_WAIT_TIME if done Thread sleep if LOG isTraceEnabled LOG trace watch taken producer ss getStatus if LOG isDebugEnabled
protected boolean asyncDispatchExchange Endpoint endpoint AsyncProducer producer Processor resultProcessor Exchange exchange AsyncCallback callback
catch Exception e timeoutOccurred set true currentShutdownTaskFuture cancel true this forceShutdown forceShutdown if forceShutdown abortAfterTimeout LOG warn logInflightExchanges context routes isLogInflightExchangesOnTimeout return false else if forceShutdown shutdownNowOnTimeout LOG warn logInflightExchanges context routes isLogInflightExchangesOnTimeout shutdownRoutesNow routesOrdered for RouteStartupOrder order routes for Service service order getServices
protected void shutdownRoutesNow List RouteStartupOrder routes for RouteStartupOrder order routes ShutdownRunningTask current order getRoute getShutdownRunningTask if current ShutdownRunningTask CompleteCurrentTaskOnly
return Set String routeIds new HashSet for RouteStartupOrder route routes routeIds add route getRoute getId Collection InflightRepository InflightExchange filtered new ArrayList for InflightRepository InflightExchange inflight inflights String routeId inflight getExchange getFromRouteId if routeIds contains routeId filtered add inflight size filtered size if size return StringBuilder sb new StringBuilder size for InflightRepository InflightExchange inflight filtered sb append append inflight getExchange getExchangeId append append inflight getExchange getFromRouteId append append inflight getAtRouteId append append inflight getNodeId append append inflight getElapsed append append inflight getDuration append
Set String routeIds new HashSet for RouteStartupOrder route routes routeIds add route getRoute getId Collection InflightRepository InflightExchange filtered new ArrayList for InflightRepository InflightExchange inflight inflights String routeId inflight getExchange getFromRouteId if routeIds contains routeId filtered add inflight size filtered size if size return StringBuilder sb new StringBuilder size for InflightRepository InflightExchange inflight filtered sb append append inflight getExchange getExchangeId append append inflight getExchange getFromRouteId append append inflight getAtRouteId append append inflight getNodeId append append inflight getElapsed append append inflight getDuration append if infoLevel
if enabled spoolRules isEmpty return false boolean all true boolean any false for SpoolRule rule spoolRules boolean result rule shouldSpoolCache length if result all false if anySpoolRules break else any true if anySpoolRules break boolean answer anySpoolRules any all
return if spoolUsedHeapMemoryThreshold throw new IllegalArgumentException spoolUsedHeapMemoryThreshold if spoolThreshold spoolUsedHeapMemoryThreshold if spoolDirectory null spoolDirectoryName null throw new IllegalArgumentException if spoolDirectory null String name resolveSpoolDirectory spoolDirectoryName if name null spoolDirectory new File name spoolDirectoryName null else throw new IllegalStateException spoolDirectoryName if spoolDirectory exists if spoolDirectory isDirectory
if spoolDirectory null String name resolveSpoolDirectory spoolDirectoryName if name null spoolDirectory new File name spoolDirectoryName null else throw new IllegalStateException spoolDirectoryName if spoolDirectory exists if spoolDirectory isDirectory LOG debug spoolDirectory else LOG warn spoolDirectory else boolean created spoolDirectory mkdirs if created
if spoolDirectory exists if spoolDirectory isDirectory LOG debug spoolDirectory else LOG warn spoolDirectory else boolean created spoolDirectory mkdirs if created LOG warn spoolDirectory else LOG debug spoolDirectory if spoolThreshold spoolRules add new FixedThresholdSpoolRule if spoolUsedHeapMemoryThreshold if spoolUsedHeapMemoryLimit null
if spoolDirectory exists if spoolDirectory isDirectory LOG debug spoolDirectory else LOG warn spoolDirectory else boolean created spoolDirectory mkdirs if created LOG warn spoolDirectory else LOG debug spoolDirectory if spoolThreshold spoolRules add new FixedThresholdSpoolRule if spoolUsedHeapMemoryThreshold if spoolUsedHeapMemoryLimit null
Override protected void doStop throws Exception if spoolThreshold spoolDirectory null isRemoveSpoolDirectoryWhenStopping
protected void dumpTrace String out
private Runnable createTask boolean maxMessagesHit return try String tail if maxMessagesHit tail getMaxMessages else tail getMaxSeconds if action Action STOP_CAMEL_CONTEXT LOG info tail camelContext stop else if action Action STOP_ROUTE LOG info routeId tail camelContext getRouteController stopRoute routeId else if action Action SUSPEND_ROUTE
String tail if maxMessagesHit tail getMaxMessages else tail getMaxSeconds if action Action STOP_CAMEL_CONTEXT LOG info tail camelContext stop else if action Action STOP_ROUTE LOG info routeId tail camelContext getRouteController stopRoute routeId else if action Action SUSPEND_ROUTE LOG info routeId tail camelContext getRouteController suspendRoute routeId else if action Action SUSPEND_ALL_ROUTES
private void appendToStore String key String value if LOG isDebugEnabled
protected void loadStore throws IOException if fileStore exists
Override public boolean process Exchange exchange AsyncCallback callback if LOG isDebugEnabled
return doneSync boolean shouldSkip skip Boolean whenMatches Boolean exchange removeProperty Exchange INTERCEPT_SEND_TO_ENDPOINT_WHEN_MATCHED if whenMatches null shouldSkip skip whenMatches if shouldSkip if exchange hasOut exchange setIn exchange getOut exchange setOut null boolean s producer process exchange ds callback done doneSync ds return doneSync s else if LOG isDebugEnabled
void doWarmUpRoutes Map Integer DefaultRouteStartupOrder inputs boolean autoStartup throws FailedToStartRouteException for Map Entry Integer DefaultRouteStartupOrder entry inputs entrySet RouteService routeService entry getValue getRouteService try
for Consumer consumer routeService getInputs values Endpoint endpoint consumer getEndpoint if doCheckMultipleConsumerSupportClash endpoint routeInputs throw new FailedToStartRouteException routeService getId endpoint List Endpoint existingEndpoints new ArrayList for Route existingRoute abstractCamelContext getRoutes if route getId equals existingRoute getId continue Endpoint existing existingRoute getEndpoint ServiceStatus status abstractCamelContext getRouteStatus existingRoute getId if status null status isStarted status isStarting existingEndpoints add existing if doCheckMultipleConsumerSupportClash endpoint existingEndpoints throw new FailedToStartRouteException routeService getId endpoint LOG debug route getId route
if doCheckMultipleConsumerSupportClash endpoint routeInputs throw new FailedToStartRouteException routeService getId endpoint List Endpoint existingEndpoints new ArrayList for Route existingRoute abstractCamelContext getRoutes if route getId equals existingRoute getId continue Endpoint existing existingRoute getEndpoint ServiceStatus status abstractCamelContext getRouteStatus existingRoute getId if status null status isStarted status isStarting existingEndpoints add existing if doCheckMultipleConsumerSupportClash endpoint existingEndpoints throw new FailedToStartRouteException routeService getId endpoint LOG debug route getId route if resumeOnly LOG debug order route getId
Override public void transform Message message DataType from DataType to throws Exception Exchange exchange message getExchange CamelContext context exchange getContext if to null to isJavaType from equals getFrom from getModel equals getModel LOG debug dataFormat Object answer dataFormat unmarshal exchange message getBody InputStream class if to null to getName null Class toClass context getClassResolver resolveClass to getName if toClass isAssignableFrom answer getClass
CamelContext context exchange getContext if to null to isJavaType from equals getFrom from getModel equals getModel LOG debug dataFormat Object answer dataFormat unmarshal exchange message getBody InputStream class if to null to getName null Class toClass context getClassResolver resolveClass to getName if toClass isAssignableFrom answer getClass LOG debug toClass getName answer context getTypeConverter mandatoryConvertTo toClass answer message setBody answer else if from null from isJavaType to equals getTo to getModel equals getModel Object input message getBody if from null from getName null Class fromClass context getClassResolver resolveClass from getName if fromClass isAssignableFrom input getClass
Object answer dataFormat unmarshal exchange message getBody InputStream class if to null to getName null Class toClass context getClassResolver resolveClass to getName if toClass isAssignableFrom answer getClass LOG debug toClass getName answer context getTypeConverter mandatoryConvertTo toClass answer message setBody answer else if from null from isJavaType to equals getTo to getModel equals getModel Object input message getBody if from null from getName null Class fromClass context getClassResolver resolveClass from getName if fromClass isAssignableFrom input getClass LOG debug fromClass getName input context getTypeConverter mandatoryConvertTo fromClass input OutputStreamBuilder osb OutputStreamBuilder withExchange exchange
Override public void transform Message message DataType from DataType to throws Exception Exchange exchange message getExchange CamelContext context exchange getContext if from isJavaType Object input message getBody Class fromClass context getClassResolver resolveClass from getName if fromClass isAssignableFrom input getClass
Class fromClass context getClassResolver resolveClass from getName if fromClass isAssignableFrom input getClass LOG debug fromClass getName input context getTypeConverter mandatoryConvertTo fromClass input message setBody input LOG debug processor Exchange transformExchange new DefaultExchange exchange transformExchange setIn message transformExchange adapt ExtendedExchange class setProperties exchange getProperties processor process transformExchange Message answer transformExchange getMessage if to isJavaType Object answerBody answer getBody Class toClass context getClassResolver resolveClass to getName if toClass isAssignableFrom answerBody getClass
ClaimCheckRepository repo exchange getProperty Exchange CLAIM_CHECK_REPOSITORY ClaimCheckRepository class if repo null repo new DefaultClaimCheckRepository exchange setProperty Exchange CLAIM_CHECK_REPOSITORY repo try String claimKey keyExpression evaluate exchange String class if equals operation Exchange copy ExchangeHelper createCorrelatedCopy exchange false boolean addedNew repo add claimKey copy if addedNew LOG debug claimKey copy else LOG debug claimKey copy else if equals operation Exchange copy repo get claimKey
if equals operation Exchange copy ExchangeHelper createCorrelatedCopy exchange false boolean addedNew repo add claimKey copy if addedNew LOG debug claimKey copy else LOG debug claimKey copy else if equals operation Exchange copy repo get claimKey LOG debug claimKey exchange if copy null Exchange result aggregationStrategy aggregate exchange copy if result null ExchangeHelper copyResultsPreservePattern exchange result else if equals operation
else if equals operation Exchange copy repo get claimKey LOG debug claimKey exchange if copy null Exchange result aggregationStrategy aggregate exchange copy if result null ExchangeHelper copyResultsPreservePattern exchange result else if equals operation Exchange copy repo getAndRemove claimKey LOG debug claimKey exchange if copy null ExchangeHelper prepareAggregation exchange copy Exchange result aggregationStrategy aggregate exchange copy if result null ExchangeHelper copyResultsPreservePattern exchange result
LOG debug claimKey exchange if copy null Exchange result aggregationStrategy aggregate exchange copy if result null ExchangeHelper copyResultsPreservePattern exchange result else if equals operation Exchange copy repo getAndRemove claimKey LOG debug claimKey exchange if copy null ExchangeHelper prepareAggregation exchange copy Exchange result aggregationStrategy aggregate exchange copy if result null ExchangeHelper copyResultsPreservePattern exchange result else if equals operation Exchange copy ExchangeHelper createCorrelatedCopy exchange false
private boolean convertIfRequired Message message DataType type throws Exception if type null type isJavaType type getName null message null message getBody null CamelContext context message getExchange getContext Class typeJava getClazz type getName context if typeJava isAssignableFrom message getBody getClass
private boolean applyTransformer Transformer transformer Message message DataType from DataType to throws Exception if transformer null
private boolean applyTransformerChain Message message DataType from DataType to throws Exception CamelContext context message getExchange getContext Transformer fromTransformer context resolveTransformer from getModel Transformer toTransformer context resolveTransformer to getModel if fromTransformer null toTransformer null
private boolean applyTransformerChain Message message DataType from DataType to throws Exception CamelContext context message getExchange getContext Transformer fromTransformer context resolveTransformer from getModel Transformer toTransformer context resolveTransformer to getModel if fromTransformer null toTransformer null LOG debug from to fromTransformer fromTransformer transform message from new DataType Object class
private void doValidate Message message DataType type throws ValidationException Validator validator message getExchange getContext resolveValidator type if validator null
return true else delayedCount incrementAndGet ProcessCall call new ProcessCall exchange callback try if LOG isTraceEnabled LOG trace delay exchange getExchangeId executorService schedule call delay TimeUnit MILLISECONDS return false catch RejectedExecutionException e delayedCount decrementAndGet if isCallerRunsWhenRejected if isRunAllowed exchange setException new RejectedExecutionException else
Object recipient null boolean prototype cacheSize try recipient expression evaluate exchange Object class recipient prepareRecipient exchange recipient Endpoint existing getExistingEndpoint exchange recipient if existing null endpoint resolveEndpoint exchange recipient prototype else endpoint existing prototype false producer producerCache acquireProducer endpoint catch Throwable e if isIgnoreInvalidEndpoint if LOG isDebugEnabled
public boolean matches Exchange exchange boolean matches predicate matches exchange
ExtendedExchange ee ExtendedExchange exchange if ee isFailed ee isRollbackOnly ee isRollbackOnlyLast ee isErrorHandlerHandled if log isDebugEnabled StringBuilder sb new StringBuilder sb append append message append append exchange if exchange isRollbackOnly exchange isRollbackOnlyLast sb append if exchange getException null sb append append exchange getException if ee isErrorHandlerHandled sb append log debug sb toString return false if ee isRouteStop if log isDebugEnabled
PollingConsumer consumer Endpoint endpoint Object recipient null boolean prototype cacheSize try recipient destination null destination expression evaluate exchange Object class recipient prepareRecipient exchange recipient Endpoint existing getExistingEndpoint camelContext recipient if existing null endpoint resolveEndpoint camelContext recipient prototype else endpoint existing prototype false consumer consumerCache acquirePollingConsumer endpoint catch Throwable e
catch Throwable e if isIgnoreInvalidEndpoint if LOG isDebugEnabled LOG debug recipient e else exchange setException e callback done true return true Consumer delegate consumer if consumer EventDrivenPollingConsumer delegate EventDrivenPollingConsumer consumer getDelegateConsumer boolean bridgeErrorHandler false if delegate DefaultConsumer ExceptionHandler handler DefaultConsumer delegate getExceptionHandler if handler BridgeExceptionHandlerToErrorHandler
if LOG isDebugEnabled LOG debug recipient e else exchange setException e callback done true return true Consumer delegate consumer if consumer EventDrivenPollingConsumer delegate EventDrivenPollingConsumer consumer getDelegateConsumer boolean bridgeErrorHandler false if delegate DefaultConsumer ExceptionHandler handler DefaultConsumer delegate getExceptionHandler if handler BridgeExceptionHandlerToErrorHandler bridgeErrorHandler true Exchange resourceExchange
else exchange setException e callback done true return true Consumer delegate consumer if consumer EventDrivenPollingConsumer delegate EventDrivenPollingConsumer consumer getDelegateConsumer boolean bridgeErrorHandler false if delegate DefaultConsumer ExceptionHandler handler DefaultConsumer delegate getExceptionHandler if handler BridgeExceptionHandlerToErrorHandler bridgeErrorHandler true Exchange resourceExchange try if timeout
return true Consumer delegate consumer if consumer EventDrivenPollingConsumer delegate EventDrivenPollingConsumer consumer getDelegateConsumer boolean bridgeErrorHandler false if delegate DefaultConsumer ExceptionHandler handler DefaultConsumer delegate getExceptionHandler if handler BridgeExceptionHandlerToErrorHandler bridgeErrorHandler true Exchange resourceExchange try if timeout LOG debug consumer resourceExchange consumer receive else if timeout
Override protected void doStart throws Exception if consumerCache null consumerCache new DefaultConsumerCache this camelContext cacheSize
Override protected void doStart throws Exception if producerCache null if cacheSize producerCache new EmptyProducerCache this camelContext
Producer producer ExchangePattern pattern try recipient prepareRecipient exchange recipient Endpoint existing getExistingEndpoint exchange recipient if existing null endpoint resolveEndpoint exchange recipient prototype else endpoint existing prototype false pattern resolveExchangePattern recipient producer producerCache acquireProducer endpoint catch Exception e if isIgnoreInvalidEndpoints if LOG isDebugEnabled
endpoint existing prototype false if endpoint null continue catch Exception e current setException e break boolean sync processExchange endpoint current exchange originalCallback iter prototype current prepareExchangeForRoutingSlip current endpoint if sync if LOG isTraceEnabled LOG trace exchange getExchangeId return false if LOG isTraceEnabled LOG trace exchange getExchangeId
ex setProperty Exchange TO_ENDPOINT endpoint getEndpointUri ex setProperty Exchange SLIP_ENDPOINT endpoint getEndpointUri ex setProperty Exchange SLIP_PRODUCER p return target process ex new AsyncCallback public void done boolean doneSync ex removeProperty Exchange SLIP_PRODUCER if doneSync if prototype ServiceHelper stopAndShutdownService endpoint cb done true return try Exchange current prepareExchangeForRoutingSlip ex endpoint while iter hasNext current if isIgnoreInvalidEndpoints
Override protected void doStart throws Exception if producerCache null if cacheSize producerCache new EmptyProducerCache this camelContext
String staticUri null boolean prototype cacheSize try recipient expression evaluate exchange Object class if dynamicAware null String originalUri uri String uri resolveUri exchange recipient String scheme resolveScheme exchange uri if dynamicAware getScheme equals scheme SendDynamicAware DynamicAwareEntry entry dynamicAware prepare exchange uri originalUri if entry null staticUri dynamicAware resolveStaticUri exchange entry preAwareProcessor dynamicAware createPreProcessor exchange entry postAwareProcessor dynamicAware createPostProcessor exchange entry if staticUri null
Object targetRecipient staticUri null staticUri recipient targetRecipient prepareRecipient exchange targetRecipient if targetRecipient null if LOG isDebugEnabled LOG debug callback done true return true Endpoint existing getExistingEndpoint exchange targetRecipient if existing null endpoint resolveEndpoint exchange targetRecipient prototype else endpoint existing prototype false destinationExchangePattern EndpointHelper resolveExchangePatternFromUrl endpoint getEndpointUri catch Throwable e
prototype false destinationExchangePattern EndpointHelper resolveExchangePatternFromUrl endpoint getEndpointUri catch Throwable e if isIgnoreInvalidEndpoint if LOG isDebugEnabled LOG debug recipient e else exchange setException e callback done true return true final Processor preProcessor preAwareProcessor final Processor postProcessor postAwareProcessor final ExchangePattern pattern destinationExchangePattern null destinationExchangePattern this pattern final boolean stopEndpoint prototype return producerCache doInAsyncProducer endpoint exchange callback p e c
Override protected void doInit throws Exception expression init camelContext if isAllowOptimisedComponents isAutoStartupComponents uri null String u camelContext resolvePropertyPlaceholders uri scheme ExchangeHelper resolveScheme u if isAllowOptimisedComponents uri null try if scheme null SendDynamicAwareResolver resolver new SendDynamicAwareResolver dynamicAware resolver resolve camelContext scheme if dynamicAware null if LOG isDebugEnabled LOG debug scheme URISupport sanitizeUri uri catch Throwable e if LOG isDebugEnabled
if sending watch new StopWatch else watch null AsyncCallback ac callback boolean newCallback watch null existingPattern target getPattern if newCallback ac doneSync try target setPattern existingPattern if watch null long timeTaken watch taken EventHelper notifyExchangeSent target getContext target destination timeTaken finally callback done doneSync
try target setPattern existingPattern if watch null long timeTaken watch taken EventHelper notifyExchangeSent target getContext target destination timeTaken finally callback done doneSync try LOG debug destination exchange return producer process exchange ac catch Throwable throwable exchange setException throwable callback done true return true
protected boolean continueProcessing Exchange exchange AsyncProcessor processor if exchange isRouteStop
boolean doneSync state State SYNC state State ASYNC_REJECTED try if isRunAllowed throw new RejectedExecutionException String key DEFAULT_KEY if correlationExpression null key correlationExpression evaluate exchange String class ThrottlingState throttlingState states computeIfAbsent key ThrottlingState :: new throttlingState calculateAndSetMaxRequestsPerPeriod exchange ThrottlePermit permit throttlingState poll if permit null if isRejectExecution throw new ThrottlerRejectedExecutionException throttlingState getThrottleRate timePeriodMillis else if isAsyncDelayed exchange isTransacted state State SYNC
protected boolean continueRouting Iterator Processor it Exchange exchange if exchange isRouteStop
else if isEagerCheckCompletion newExchange setProperty Exchange AGGREGATED_SIZE size complete isCompleted key newExchange if complete null trackTimeout key newExchange newExchange removeProperty Exchange AGGREGATED_SIZE if preCompletion complete null doAggregationComplete complete list key originalExchange oldExchange false complete null oldExchange null originalExchange null size trackTimeout key newExchange boolean aggregateFailed false try
original setProperty Exchange AGGREGATED_CORRELATION_KEY key aggregated setProperty Exchange AGGREGATED_CORRELATION_KEY key if original null aggregationRepository remove aggregated getContext key original if fromTimeout timeoutMap null LOG trace key timeoutMap remove key if closedCorrelationKeys null closedCorrelationKeys put key key if fromTimeout long timeout getCompletionTimeout getCompletionTimeout aggregationStrategy timeout aggregated timeout Exchange answer if fromTimeout isDiscardOnCompletionTimeout discarded incrementAndGet
if fromTimeout timeoutMap null LOG trace key timeoutMap remove key if closedCorrelationKeys null closedCorrelationKeys put key key if fromTimeout long timeout getCompletionTimeout getCompletionTimeout aggregationStrategy timeout aggregated timeout Exchange answer if fromTimeout isDiscardOnCompletionTimeout discarded incrementAndGet LOG debug key aggregated aggregationRepository confirm aggregated getContext aggregated getExchangeId redeliveryState remove aggregated getExchangeId answer null
private void onSubmitCompletion final String key final Exchange exchange
else LOG info closedCorrelationKeys new ConcurrentHashMap if aggregationRepository null aggregationRepository new MemoryAggregationRepository optimisticLocking LOG info if optimisticLocking if aggregationRepository OptimisticLockingAggregationRepository throw new IllegalArgumentException LOG info ServiceHelper startService aggregationStrategy processor aggregationRepository if aggregationRepository RecoverableAggregationRepository RecoverableAggregationRepository recoverable RecoverableAggregationRepository aggregationRepository if recoverable isUseRecovery long interval recoverable getRecoveryIntervalInMillis
aggregationRepository new MemoryAggregationRepository optimisticLocking LOG info if optimisticLocking if aggregationRepository OptimisticLockingAggregationRepository throw new IllegalArgumentException LOG info ServiceHelper startService aggregationStrategy processor aggregationRepository if aggregationRepository RecoverableAggregationRepository RecoverableAggregationRepository recoverable RecoverableAggregationRepository aggregationRepository if recoverable isUseRecovery long interval recoverable getRecoveryIntervalInMillis if interval throw new IllegalArgumentException interval recoverService camelContext getExecutorServiceManager newScheduledThreadPool this Runnable recoverTask new RecoverTask recoverable
int total lock lock try Exchange exchange aggregationRepository get camelContext key if exchange null total LOG trace key exchange setProperty Exchange AGGREGATED_COMPLETED_BY COMPLETED_BY_FORCE Exchange answer onCompletion key exchange exchange false false if answer null onSubmitCompletion key answer finally lock unlock LOG trace key if total
if keys null keys isEmpty lock lock total keys size try for String key keys Exchange exchange aggregationRepository get camelContext key if exchange null LOG trace key exchange setProperty Exchange AGGREGATED_COMPLETED_BY COMPLETED_BY_FORCE Exchange answer onCompletion key exchange exchange false false if answer null onSubmitCompletion key answer finally lock unlock LOG trace
LOG trace Set String keys aggregationRepository getKeys int total if keys null keys isEmpty lock lock total keys size try for String key keys Exchange exchange aggregationRepository get camelContext key if exchange null LOG trace key onCompletion key exchange exchange false true finally lock unlock LOG trace
protected long determineRedeliveryDelay Exchange exchange RedeliveryPolicy redeliveryPolicy long redeliveryDelay int redeliveryCounter Message message exchange getIn Long delay message getHeader Exchange REDELIVERY_DELAY Long class if delay null delay redeliveryPolicy calculateRedeliveryDelay redeliveryDelay redeliveryCounter
public void sleep long redeliveryDelay throws InterruptedException
return true catch Exception e exchange setException e callback done true return true try boolean newKey if eager newKey idempotentRepository add exchange messageId else newKey idempotentRepository contains exchange messageId if newKey exchange setProperty Exchange DUPLICATE_MESSAGE Boolean TRUE onDuplicate exchange messageId if skipDuplicate
protected void onFailedMessage Exchange exchange String messageId if removeOnFailure idempotentRepository remove exchange messageId
public void setKeepOpen boolean keepOpen
public static void warmUp if INIT compareAndSet false true Runnable task StopWatch watch new StopWatch LOG debug new CaffeineLRUCache
private boolean execute ServiceDefinition service Exchange exchange AsyncCallback callback throws Exception final Message message exchange getIn final String host service getHost final int port service getPort final Map String String meta service getMetadata
Override protected void doStart throws Exception ObjectHelper notNull camelContext ObjectHelper notNull serviceDiscovery ObjectHelper notNull serviceChooser ObjectHelper notNull serviceFilter
if endpoint DiscoverableService final DiscoverableService service DiscoverableService endpoint properties putAll service getServiceProperties for Map Entry String Object entry route getProperties entrySet if entry getKey startsWith ServiceDefinition SERVICE_META_PREFIX continue final String key entry getKey final String val camelContext getTypeConverter convertTo String class entry getValue properties put key val String serviceName properties get ServiceDefinition SERVICE_META_NAME if serviceName null serviceName route getGroup if serviceName null properties put ServiceDefinition SERVICE_META_NAME serviceName if ObjectHelper isEmpty serviceName
Iterator ProcessorDefinition it AdviceWithTasks createMatchByIterator route matchBy selectFirst selectLast selectFrom selectTo maxDeep boolean match false while it hasNext ProcessorDefinition output it next if matchBy match output List ProcessorDefinition outputs getOutputs output route if outputs null int index outputs indexOf output if index match true ProcessorDefinition flattern flatternOutput replace outputs add index flattern Object old outputs remove index ProcessorDefinition parent output getParent null output getParent route flattern setParent parent
private static AdviceWithTask doRemove final RouteDefinition route final MatchBy matchBy boolean selectFirst boolean selectLast int selectFrom int selectTo int maxDeep return new AdviceWithTask public void task throws Exception boolean match false Iterator ProcessorDefinition it AdviceWithTasks createMatchByIterator route matchBy selectFirst selectLast selectFrom selectTo maxDeep while it hasNext ProcessorDefinition output it next if matchBy match output List ProcessorDefinition outputs getOutputs output route if outputs null int index outputs indexOf output if index match true Object old outputs remove index
boolean match false Iterator ProcessorDefinition it AdviceWithTasks createMatchByIterator route matchBy selectFirst selectLast selectFrom selectTo maxDeep while it hasNext ProcessorDefinition output it next if matchBy match output List ProcessorDefinition outputs getOutputs output route if outputs null int index outputs indexOf output if index match true ProcessorDefinition flattern flatternOutput before Object existing outputs get index outputs add index flattern ProcessorDefinition parent output getParent null output getParent route flattern setParent parent
boolean match false Iterator ProcessorDefinition it AdviceWithTasks createMatchByIterator route matchBy selectFirst selectLast selectFrom selectTo maxDeep while it hasNext ProcessorDefinition output it next if matchBy match output List ProcessorDefinition outputs getOutputs output route if outputs null int index outputs indexOf output if index match true ProcessorDefinition flattern flatternOutput after Object existing outputs get index outputs add index flattern ProcessorDefinition parent output getParent null output getParent route flattern setParent parent
public static AdviceWithTask replaceFromWith final RouteDefinition route final String uri return new AdviceWithTask public void task throws Exception FromDefinition from route getInput
public static AdviceWithTask replaceFrom final RouteDefinition route final Endpoint endpoint return new AdviceWithTask public void task throws Exception FromDefinition from route getInput
if camelContext null throw new IllegalArgumentException getRestCollection setCamelContext camelContext if restConfiguration null restConfiguration asRestConfiguration getContext camelContext getRestConfiguration camelContext getExtension Model class addRestDefinitions getRestCollection getRests false RestConfiguration config camelContext getRestConfiguration if config getApiContextPath null boolean hasRestApi false for RouteDefinition route camelContext getExtension Model class getRouteDefinitions FromDefinition from route getInput if from getEndpointUri null from getEndpointUri startsWith hasRestApi true if hasRestApi RouteDefinition route RestDefinition asRouteApiDefinition camelContext config
Override protected void bindDataFormats throws Exception for Map Entry String DataFormatDefinition e model getDataFormats entrySet String id e getKey DataFormatDefinition def e getValue
Override public Boolean apply RouteDefinition route String id route getId String uri route getInput null route getInput getEndpointUri null boolean answer filter route id uri
if type null Map String types findByTypeWithName type if types size Object found types values iterator next if type isInstance found return type cast found if type TransactedPolicy class answer lookup PROPAGATION_REQUIRED TransactedPolicy class if answer null type TransactedPolicy class Class tmClazz camelContext getClassResolver resolveClass if tmClazz null Map String maps findByTypeWithName tmClazz if maps size Object transactionManager maps values iterator next LOG debug transactionManager
Logger logger definition getLogger if logger null ObjectHelper isNotEmpty definition getLoggerRef logger mandatoryLookup definition getLoggerRef Logger class if logger null Map String Logger availableLoggers findByTypeWithName Logger class if availableLoggers size logger availableLoggers values iterator next log debug logger else if availableLoggers size log debug Logger class getName if logger null String name parseString definition getLogName if name null name camelContext getGlobalOption Exchange LOG_EIP_NAME if name null
if logger null Map String Logger availableLoggers findByTypeWithName Logger class if availableLoggers size logger availableLoggers values iterator next log debug logger else if availableLoggers size log debug Logger class getName if logger null String name parseString definition getLogName if name null name camelContext getGlobalOption Exchange LOG_EIP_NAME if name null log debug name if name null name route getRouteId
if builder getRouteCollection getRoutes isEmpty throw new IllegalArgumentException if builder getRouteCollection getErrorHandlerFactory null ecc getErrorHandlerFactory builder getRouteCollection getErrorHandlerFactory throw new IllegalArgumentException String beforeAsXml null if logRoutesAsXml log isInfoEnabled try beforeAsXml ecc getModelToXMLDumper dumpModelAsXml camelContext definition catch Throwable e model removeRouteDefinition definition if builder AdviceWithRouteBuilder List AdviceWithTask tasks AdviceWithRouteBuilder builder getAdviceWithTasks for AdviceWithTask task tasks task task RouteDefinition merged routes route definition
throw new IllegalArgumentException String beforeAsXml null if logRoutesAsXml log isInfoEnabled try beforeAsXml ecc getModelToXMLDumper dumpModelAsXml camelContext definition catch Throwable e model removeRouteDefinition definition if builder AdviceWithRouteBuilder List AdviceWithTask tasks AdviceWithRouteBuilder builder getAdviceWithTasks for AdviceWithTask task tasks task task RouteDefinition merged routes route definition model getRouteDefinitions add merged if log isInfoEnabled log info merged
if endpoint null EndpointConsumerBuilder def definition getInput getEndpointConsumerBuilder if def null endpoint def resolve camelContext else endpoint resolveEndpoint definition getInput getEndpointUri String id definition idOrCreate camelContext adapt ExtendedCamelContext class getNodeIdFactory String desc RouteDefinitionHelper getRouteMessage definition toString DefaultRoute route new DefaultRoute camelContext definition id desc endpoint route setErrorHandlerFactory definition getErrorHandlerFactory if definition getTrace null Boolean isTrace parseBoolean definition getTrace if isTrace null route setTracing isTrace if isTrace
endpoint resolveEndpoint definition getInput getEndpointUri String id definition idOrCreate camelContext adapt ExtendedCamelContext class getNodeIdFactory String desc RouteDefinitionHelper getRouteMessage definition toString DefaultRoute route new DefaultRoute camelContext definition id desc endpoint route setErrorHandlerFactory definition getErrorHandlerFactory if definition getTrace null Boolean isTrace parseBoolean definition getTrace if isTrace null route setTracing isTrace if isTrace log debug definition getId if definition getMessageHistory null Boolean isMessageHistory parseBoolean definition getMessageHistory if isMessageHistory null route setMessageHistory isMessageHistory
route setErrorHandlerFactory definition getErrorHandlerFactory if definition getTrace null Boolean isTrace parseBoolean definition getTrace if isTrace null route setTracing isTrace if isTrace log debug definition getId if definition getMessageHistory null Boolean isMessageHistory parseBoolean definition getMessageHistory if isMessageHistory null route setMessageHistory isMessageHistory if isMessageHistory log debug definition getId if definition getLogMask null Boolean isLogMask parseBoolean definition getLogMask
log debug definition getId if definition getMessageHistory null Boolean isMessageHistory parseBoolean definition getMessageHistory if isMessageHistory null route setMessageHistory isMessageHistory if isMessageHistory log debug definition getId if definition getLogMask null Boolean isLogMask parseBoolean definition getLogMask if isLogMask null route setLogMask isLogMask if isLogMask log debug definition getId if definition getStreamCache null Boolean isStreamCache parseBoolean definition getStreamCache
if isMessageHistory null route setMessageHistory isMessageHistory if isMessageHistory log debug definition getId if definition getLogMask null Boolean isLogMask parseBoolean definition getLogMask if isLogMask null route setLogMask isLogMask if isLogMask log debug definition getId if definition getStreamCache null Boolean isStreamCache parseBoolean definition getStreamCache if isStreamCache null route setStreamCaching isStreamCache if isStreamCache
if isMessageHistory log debug definition getId if definition getLogMask null Boolean isLogMask parseBoolean definition getLogMask if isLogMask null route setLogMask isLogMask if isLogMask log debug definition getId if definition getStreamCache null Boolean isStreamCache parseBoolean definition getStreamCache if isStreamCache null route setStreamCaching isStreamCache if isStreamCache log debug definition getId if definition getDelayer null
if definition getLogMask null Boolean isLogMask parseBoolean definition getLogMask if isLogMask null route setLogMask isLogMask if isLogMask log debug definition getId if definition getStreamCache null Boolean isStreamCache parseBoolean definition getStreamCache if isStreamCache null route setStreamCaching isStreamCache if isStreamCache log debug definition getId if definition getDelayer null Long delayer parseDuration definition getDelayer if delayer null
log debug definition getId if definition getStreamCache null Boolean isStreamCache parseBoolean definition getStreamCache if isStreamCache null route setStreamCaching isStreamCache if isStreamCache log debug definition getId if definition getDelayer null Long delayer parseDuration definition getDelayer if delayer null route setDelayer delayer if delayer log debug delayer definition getId else log debug definition getId
if isStreamCache null route setStreamCaching isStreamCache if isStreamCache log debug definition getId if definition getDelayer null Long delayer parseDuration definition getDelayer if delayer null route setDelayer delayer if delayer log debug delayer definition getId else log debug definition getId if definition getRoutePolicies null definition getRoutePolicies isEmpty for RoutePolicy policy definition getRoutePolicies log debug policy definition getId
if definition getDelayer null Long delayer parseDuration definition getDelayer if delayer null route setDelayer delayer if delayer log debug delayer definition getId else log debug definition getId if definition getRoutePolicies null definition getRoutePolicies isEmpty for RoutePolicy policy definition getRoutePolicies log debug policy definition getId route getRoutePolicyList add policy if definition getRoutePolicyRef null StringTokenizer policyTokens new StringTokenizer definition getRoutePolicyRef while policyTokens hasMoreTokens
Long delayer parseDuration definition getDelayer if delayer null route setDelayer delayer if delayer log debug delayer definition getId else log debug definition getId if definition getRoutePolicies null definition getRoutePolicies isEmpty for RoutePolicy policy definition getRoutePolicies log debug policy definition getId route getRoutePolicyList add policy if definition getRoutePolicyRef null StringTokenizer policyTokens new StringTokenizer definition getRoutePolicyRef while policyTokens hasMoreTokens String ref policyTokens nextToken trim
for ProcessorDefinition output list try ProcessorReifier reifier route output addRoutes catch Exception e throw new FailedToCreateRouteException definition getId definition toString output toString e List Processor eventDrivenProcessors route getEventDrivenProcessors if eventDrivenProcessors isEmpty return null Map String Object routeProperties computeRouteProperties Processor target new Pipeline camelContext eventDrivenProcessors CamelInternalProcessor internal new CamelInternalProcessor camelContext target internal addAdvice new CamelInternalProcessor UnitOfWorkProcessorAdvice route camelContext List RoutePolicy routePolicyList route getRoutePolicyList if routePolicyList null routePolicyList isEmpty for RoutePolicy policy routePolicyList
private PropertyConfigurer findPropertyConfigurer DataFormat dataFormat PropertyConfigurer configurer null String name getDataFormatName LOG trace name if dataFormat PropertyConfigurerAware configurer PropertyConfigurerAware dataFormat getPropertyConfigurer dataFormat if LOG isDebugEnabled configurer null
Override public void init if cacheExpression null cachePredicate null getCamelContext null int maxSize CamelContextHelper getMaximumSimpleCacheSize getCamelContext if maxSize cacheExpression LRUCacheFactory newLRUCache maxSize false cachePredicate LRUCacheFactory newLRUCache maxSize false
Override public void stop if cachePredicate LRUCache if LOG isDebugEnabled LRUCache cache LRUCache cachePredicate
if unitOfWorkFactory null LOG info unitOfWorkFactory getContext adapt ExtendedCamelContext class setUnitOfWorkFactory unitOfWorkFactory RuntimeEndpointRegistry runtimeEndpointRegistry getBeanForType RuntimeEndpointRegistry class if runtimeEndpointRegistry null LOG info runtimeEndpointRegistry getContext setRuntimeEndpointRegistry runtimeEndpointRegistry HeadersMapFactory headersMapFactory getBeanForType HeadersMapFactory class if headersMapFactory null LOG info headersMapFactory getContext adapt ExtendedCamelContext class setHeadersMapFactory headersMapFactory Map String TypeConverters typeConverters getContext getRegistry findByTypeWithName TypeConverters class if typeConverters null typeConverters isEmpty for Entry String TypeConverters entry typeConverters entrySet TypeConverters converter entry getValue
LOG info headersMapFactory getContext adapt ExtendedCamelContext class setHeadersMapFactory headersMapFactory Map String TypeConverters typeConverters getContext getRegistry findByTypeWithName TypeConverters class if typeConverters null typeConverters isEmpty for Entry String TypeConverters entry typeConverters entrySet TypeConverters converter entry getValue LOG info entry getKey converter getContext getTypeConverterRegistry addTypeConverters converter Map String EventNotifier eventNotifiers getContext getRegistry findByTypeWithName EventNotifier class if eventNotifiers null eventNotifiers isEmpty for Entry String EventNotifier entry eventNotifiers entrySet EventNotifier notifier entry getValue if getContext getManagementStrategy getEventNotifiers contains notifier LOG info entry getKey notifier getContext getManagementStrategy addEventNotifier notifier
LOG info entry getKey converter getContext getTypeConverterRegistry addTypeConverters converter Map String EventNotifier eventNotifiers getContext getRegistry findByTypeWithName EventNotifier class if eventNotifiers null eventNotifiers isEmpty for Entry String EventNotifier entry eventNotifiers entrySet EventNotifier notifier entry getValue if getContext getManagementStrategy getEventNotifiers contains notifier LOG info entry getKey notifier getContext getManagementStrategy addEventNotifier notifier Map String EndpointStrategy endpointStrategies getContext getRegistry findByTypeWithName EndpointStrategy class if endpointStrategies null endpointStrategies isEmpty for Entry String EndpointStrategy entry endpointStrategies entrySet EndpointStrategy strategy entry getValue LOG info entry getKey strategy getContext adapt ExtendedCamelContext class registerEndpointCallback strategy
if getContext getManagementStrategy getEventNotifiers contains notifier LOG info entry getKey notifier getContext getManagementStrategy addEventNotifier notifier Map String EndpointStrategy endpointStrategies getContext getRegistry findByTypeWithName EndpointStrategy class if endpointStrategies null endpointStrategies isEmpty for Entry String EndpointStrategy entry endpointStrategies entrySet EndpointStrategy strategy entry getValue LOG info entry getKey strategy getContext adapt ExtendedCamelContext class registerEndpointCallback strategy ShutdownStrategy shutdownStrategy getBeanForType ShutdownStrategy class if shutdownStrategy null LOG info shutdownStrategy getContext setShutdownStrategy shutdownStrategy Map String InterceptStrategy interceptStrategies getContext getRegistry findByTypeWithName InterceptStrategy class if interceptStrategies null interceptStrategies isEmpty
if interceptStrategies null interceptStrategies isEmpty for Entry String InterceptStrategy entry interceptStrategies entrySet InterceptStrategy strategy entry getValue if getContext adapt ExtendedCamelContext class getInterceptStrategies contains strategy LOG info entry getKey strategy getContext adapt ExtendedCamelContext class addInterceptStrategy strategy Map String LifecycleStrategy lifecycleStrategies getContext getRegistry findByTypeWithName LifecycleStrategy class if lifecycleStrategies null lifecycleStrategies isEmpty for Entry String LifecycleStrategy entry lifecycleStrategies entrySet LifecycleStrategy strategy entry getValue if getContext getLifecycleStrategies contains strategy LOG info entry getKey strategy getContext addLifecycleStrategy strategy Map String ModelLifecycleStrategy modelLifecycleStrategies getContext getRegistry findByTypeWithName ModelLifecycleStrategy class if modelLifecycleStrategies null modelLifecycleStrategies isEmpty
LOG info entry getKey strategy mcc addModelLifecycleStrategy strategy Map String CamelClusterService clusterServices getContext getRegistry findByTypeWithName CamelClusterService class if clusterServices null clusterServices isEmpty for Entry String CamelClusterService entry clusterServices entrySet CamelClusterService service entry getValue LOG info service getId service getContext addService service Map String ServiceRegistry serviceRegistries getContext getRegistry findByTypeWithName ServiceRegistry class if serviceRegistries null serviceRegistries isEmpty for Map Entry String ServiceRegistry entry serviceRegistries entrySet ServiceRegistry service entry getValue if service getId null service setId getContext getUuidGenerator generateUuid LOG info service getId service
initRouteTemplateRefs initRouteRefs initRestRefs initTransformers initValidators getContext addRestDefinitions getRests false RestConfiguration config getContext getRestConfiguration if config getApiContextPath null boolean hasRestApi false for RouteDefinition route getContext getRouteDefinitions FromDefinition from route getInput if from getUri null from getUri startsWith hasRestApi true if hasRestApi RouteDefinition route RestDefinition asRouteApiDefinition getContext config
protected void initRouteController throws Exception RouteController routeController getBeanForType RouteController class if routeController null
protected void initRouteRefs throws Exception if getRouteRefs null for RouteContextRefDefinition ref getRouteRefs List RouteDefinition defs ref lookupRoutes getContext for RouteDefinition def defs
protected void initRouteTemplateRefs throws Exception if getRouteTemplateRefs null for RouteTemplateContextRefDefinition ref getRouteTemplateRefs List RouteTemplateDefinition defs ref lookupRouteTemplates getContext for RouteTemplateDefinition def defs
protected void initRestRefs throws Exception if getRestRefs null for RestContextRefDefinition ref getRestRefs List RestDefinition defs ref lookupRests getContext for RestDefinition def defs
protected void initThreadPoolProfiles T context throws Exception Set String defaultIds new HashSet Map String ThreadPoolProfile profiles context getRegistry findByTypeWithName ThreadPoolProfile class if profiles null profiles isEmpty for Entry String ThreadPoolProfile entry profiles entrySet ThreadPoolProfile profile entry getValue if profile isDefaultProfile
Set String defaultIds new HashSet Map String ThreadPoolProfile profiles context getRegistry findByTypeWithName ThreadPoolProfile class if profiles null profiles isEmpty for Entry String ThreadPoolProfile entry profiles entrySet ThreadPoolProfile profile entry getValue if profile isDefaultProfile LOG info entry getKey profile context getExecutorServiceManager setDefaultThreadPoolProfile profile defaultIds add entry getKey else context getExecutorServiceManager registerThreadPoolProfile profile if getThreadPoolProfiles null getThreadPoolProfiles isEmpty for ThreadPoolProfileDefinition definition getThreadPoolProfiles Boolean defaultProfile CamelContextHelper parseBoolean getContext definition getDefaultProfile if defaultProfile null defaultProfile
private void setupCustomServices ModelJAXBContextFactory modelJAXBContextFactory getBeanForType ModelJAXBContextFactory class if modelJAXBContextFactory null
private void setupCustomServices ModelJAXBContextFactory modelJAXBContextFactory getBeanForType ModelJAXBContextFactory class if modelJAXBContextFactory null LOG info modelJAXBContextFactory getContext adapt ExtendedCamelContext class setModelJAXBContextFactory modelJAXBContextFactory ClassResolver classResolver getBeanForType ClassResolver class if classResolver null LOG info classResolver getContext setClassResolver classResolver FactoryFinderResolver factoryFinderResolver getBeanForType FactoryFinderResolver class if factoryFinderResolver null LOG info factoryFinderResolver getContext adapt ExtendedCamelContext class setFactoryFinderResolver factoryFinderResolver ExecutorServiceManager executorServiceStrategy getBeanForType ExecutorServiceManager class if executorServiceStrategy null
getContext adapt ExtendedCamelContext class setModelJAXBContextFactory modelJAXBContextFactory ClassResolver classResolver getBeanForType ClassResolver class if classResolver null LOG info classResolver getContext setClassResolver classResolver FactoryFinderResolver factoryFinderResolver getBeanForType FactoryFinderResolver class if factoryFinderResolver null LOG info factoryFinderResolver getContext adapt ExtendedCamelContext class setFactoryFinderResolver factoryFinderResolver ExecutorServiceManager executorServiceStrategy getBeanForType ExecutorServiceManager class if executorServiceStrategy null LOG info executorServiceStrategy getContext setExecutorServiceManager executorServiceStrategy ThreadPoolFactory threadPoolFactory getBeanForType ThreadPoolFactory class if threadPoolFactory null
LOG info classResolver getContext setClassResolver classResolver FactoryFinderResolver factoryFinderResolver getBeanForType FactoryFinderResolver class if factoryFinderResolver null LOG info factoryFinderResolver getContext adapt ExtendedCamelContext class setFactoryFinderResolver factoryFinderResolver ExecutorServiceManager executorServiceStrategy getBeanForType ExecutorServiceManager class if executorServiceStrategy null LOG info executorServiceStrategy getContext setExecutorServiceManager executorServiceStrategy ThreadPoolFactory threadPoolFactory getBeanForType ThreadPoolFactory class if threadPoolFactory null LOG info threadPoolFactory getContext getExecutorServiceManager setThreadPoolFactory threadPoolFactory ProcessorFactory processorFactory getBeanForType ProcessorFactory class
Override BeforeEach public void setUp throws Exception super setUp System setProperty CamelContext c2 createCamelContext if c2 ModelCamelContext context ModelCamelContext c2 else throw new Exception assertValidContext context context build template context createProducerTemplate consumer context createConsumerTemplate if isUseRouteBuilder RouteBuilder builders createRouteBuilders for RouteBuilder builder builders
RouteBuilder builder new RouteBuilder public void configure errorHandler deadLetterChannel from to List Route list getRouteListWithCurrentContext builder assertEquals list size list for Route route list Endpoint key route getEndpoint assertEquals key getEndpointUri DefaultRoute consumerRoute assertIsInstanceOf DefaultRoute class route Processor processor consumerRoute getProcessor Channel channel unwrapChannel processor assertIsInstanceOf DeadLetterChannel class channel getErrorHandler SendProcessor sendProcessor assertIsInstanceOf SendProcessor class channel getNextProcessor
Override public void process Exchange exchange throws Exception
Override public void process Exchange exchange throws Exception LOG debug exchange super process exchange
Override public void process Exchange exchange
Test public void testSimpleRouteWithHeaderPredicate throws Exception List Route routes buildSimpleRouteWithHeaderPredicate
Test public void testSimpleRouteWithChoice throws Exception List Route routes buildSimpleRouteWithChoice
protected List Route buildCustomProcessor throws Exception myProcessor new Processor public void process Exchange exchange
Test public void testCustomProcessorWithFilter throws Exception List Route routes buildCustomProcessorWithFilter
Test public void testWireTap throws Exception List Route routes buildWireTap
Test public void testRouteWithInterceptor throws Exception List Route routes buildRouteWithInterceptor
Test public void testRouteDynamicReceipentList throws Exception List Route routes buildDynamicRecipientList
Test public void testSplitter throws Exception List Route routes buildSplitter
Test public void testIdempotentConsumer throws Exception List Route routes buildIdempotentConsumer
Test public void testThreads throws Exception List Route routes buildThreads
protected void assertMethodPattern BeanInfo info String methodName ExchangePattern expectedPattern throws NoSuchMethodException Class type info getType Method method type getMethod methodName assertNotNull method methodName MethodInfo methodInfo info getMethodInfo method assertNotNull methodInfo method ExchangePattern actualPattern methodInfo getPattern assertEquals expectedPattern actualPattern method
Test public void testListEndpoints throws Exception template sendBody body1 template sendBody body2 Collection Endpoint list context getEndpoints assertEquals list size for Endpoint endpoint list List Exchange exchanges BrowseEndpoint endpoint getExchanges
Test public void testPerformance throws Exception StopWatch watch new StopWatch MockEndpoint endpoint getMockEndpoint uri endpoint expectedMessageCount int dataSet getSize endpoint expectedHeaderReceived MockEndpoint assertIsSatisfied context TimeUnit SECONDS
sb append i LS template sendBodyAndHeader sb toString Exchange FILE_NAME MockEndpoint mock getMockEndpoint mock expectedMessageCount size mock expectsNoDuplicates body mock setResultWaitTime Thread sleep context getRouteController startRoute assertMockEndpointsSatisfied String txt context getTypeConverter convertTo String class new File assertNotNull txt String lines txt split LS assertEquals size lines length size Set String rows new LinkedHashSet Arrays asList lines assertEquals size rows size size
MockEndpoint mock getMockEndpoint mock expectedMessageCount number mock expectsNoDuplicates body createManyFiles number context getRouteController startRoute mock setResultWaitTime mock assertIsSatisfied context stop int found log info log info for Map Entry String Integer ent duplicate entrySet Integer count ent getValue if count found
Test public void testPollFileWhileSlowFileIsBeingWritten throws Exception MockEndpoint mock getMockEndpoint mock expectedMessageCount template sendBody mock assertIsSatisfied String body mock getReceivedExchanges get getIn getBody String class
Override BeforeEach public void setUp throws Exception utf getBytes deleteDirectory createDirectory log debug new String utf Charset forName for byte b utf
Override BeforeEach public void setUp throws Exception utf getBytes iso getBytes deleteDirectory createDirectory log debug new String utf Charset forName log debug new String iso Charset forName for byte b utf
Override BeforeEach public void setUp throws Exception utf getBytes iso getBytes deleteDirectory createDirectory log debug new String utf Charset forName log debug new String iso Charset forName for byte b utf
Test public void testFileProducerCharsetUTFtoISOConvertBodyTo throws Exception oneExchangeDone matchesMockWaitTime File file new File assertTrue file exists InputStream fis Files newInputStream Paths get file getAbsolutePath byte buffer new byte int len fis read buffer assertTrue len len byte data new byte len System arraycopy buffer data len fis close for byte b data
Override BeforeEach public void setUp throws Exception utf getBytes iso getBytes deleteDirectory createDirectory log debug new String utf Charset forName log debug new String iso Charset forName for byte b utf
Override BeforeEach public void setUp throws Exception utf getBytes deleteDirectory createDirectory log debug new String utf Charset forName for byte b utf
service setRoot service setAcquireLockDelay TimeUnit SECONDS service setAcquireLockInterval TimeUnit SECONDS DefaultCamelContext context new DefaultCamelContext context disableJMX context setName id context addService service context addRoutePolicyFactory ClusteredRoutePolicyFactory forNamespace context addRoutes new RouteBuilder Override public void configure throws Exception from routeId id log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt context start contextLatch await
service setId id service setRoot service setAcquireLockDelay TimeUnit SECONDS service setAcquireLockInterval TimeUnit SECONDS DefaultCamelContext context new DefaultCamelContext context disableJMX context setName id context addService service context addRoutes new RouteBuilder Override public void configure throws Exception from routeId id routePolicy ClusteredRoutePolicy forNamespace log process e contextLatch countDown Thread sleep ThreadLocalRandom current nextInt context start contextLatch await
private void writeSlowFile throws Exception LOG debug FileOutputStream fos new FileOutputStream for int i i i fos write i LS getBytes
private void writeSlowFile throws Exception LOG debug FileOutputStream fos new FileOutputStream for int i i i fos write i LS getBytes
private void writeFiles throws Exception LOG debug FileOutputStream fos new FileOutputStream FileOutputStream fos2 new FileOutputStream for int i i i fos write i LS getBytes fos2 write i LS getBytes
Test public void testInOut throws Exception getMockEndpoint expectedBodiesReceived String out template requestBody String class assertEquals out
Test public void testSedaQueue throws Exception final CountDownLatch latch new CountDownLatch CamelContext context new DefaultCamelContext context addRoutes new RouteBuilder public void configure from to from process new Processor public void process Exchange e
Test public void testThatShowsEndpointResolutionIsNotConsistent throws Exception final CountDownLatch latch new CountDownLatch CamelContext context new DefaultCamelContext context addRoutes new RouteBuilder public void configure from to from process new Processor public void process Exchange e
Test public void testConvertStringToAndFromByteArray throws Exception byte array converter convertTo byte class assertNotNull array
Test public void testConvertStringToAndFromCharArray throws Exception char array converter convertTo char class assertNotNull array
Test public void testCollectionToPrimitiveArrayConversion throws Exception List Integer list new ArrayList list add list add Integer integerArray converter convertTo Integer class list assertEquals integerArray length int intArray converter convertTo int class list assertEquals intArray length long longArray converter convertTo long class intArray assertEquals longArray length List resultList converter convertTo List class intArray assertEquals resultList size
Test public void testConvertToDocument throws Exception Document document converter convertTo Document class assertNotNull document
Test public void testConvertToSource throws Exception Source source converter convertTo Source class assertNotNull source
Test public void testStreamSourceToDomSource throws Exception StreamSource streamSource new StreamSource new StringReader DOMSource domSource converter convertTo DOMSource class streamSource assertNotNull domSource
Test public void testNodeToSourceThenToInputStream throws Exception Document document converter convertTo Document class Element element document getDocumentElement Source source converter convertTo Source class element assertNotNull source
Test public void testPropertyEditorTypeConverter throws Exception MyBean bean new MyBean bean setBar StopWatch watch new StopWatch for int i i i String s context getTypeConverter convertTo String class bean
Test public void testPerformance DefaultUuidGenerator uuidGenerator new DefaultUuidGenerator StopWatch watch new StopWatch
Test public void testPerformance SimpleUuidGenerator uuidGenerator new SimpleUuidGenerator StopWatch watch new StopWatch
public void disbledtestPerformance throws Exception Document dom context getTypeConverter convertTo Document class assertNotNull dom StopWatch watch new StopWatch latch new CountDownLatch size executorService Executors newFixedThreadPool pool for int i i size i executorService submit new Runnable Override public void run for int j j inner j Document dom context getTypeConverter convertTo Document class assertNotNull dom latch countDown assertTrue latch await TimeUnit MINUTES
Test public void testPerformance UuidGenerator uuidGenerator new VanillaUuidGenerator StopWatch watch new StopWatch
Test public void testExchangeCompleted throws Exception getMockEndpoint expectedMessageCount template sendBody assertMockEndpointsSatisfied assertEquals events size ExchangeCompletedEvent event ExchangeCompletedEvent events get assertNotNull event getExchange assertNotNull event getExchange getFromEndpoint assertEquals event getExchange getFromEndpoint getEndpointUri long created event getExchange getCreated assertTrue created Date now new Date long elapsed now getTime created assertTrue elapsed elapsed
protected void assertErrorHandlingWorks String route throws Exception MockEndpoint resultEndpoint getMockEndpoint MockEndpoint exceptionEndpoint getMockEndpoint resultEndpoint expectedMessageCount exceptionEndpoint expectedBodiesReceived try template sendBodyAndHeader route fail catch RuntimeCamelException e boolean b e getCause IllegalArgumentException assertTrue b assertEquals e getCause getMessage assertMockEndpointsSatisfied List Exchange list exceptionEndpoint getReceivedExchanges Exchange exchange list get
Override protected RouteBuilder createRouteBuilder throws Exception final Processor exceptionThrower new Processor public void process Exchange exchange throws Exception
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure throws Exception from log split body tokenize new UseLatestAggregationStrategy parallelProcessing streaming process new Processor Override public void process Exchange exchange throws Exception int num exchange getIn getBody int class final long sleep num delay
Method method TypeConverterConcurrencyIssueTest class getMethod String class assertNotNull method context getTypeConverterRegistry addTypeConverter MyCamelBean class String class new StaticMethodTypeConverter method false ExecutorService pool context getExecutorServiceManager newThreadPool this final CountDownLatch latch new CountDownLatch size StopWatch watch new StopWatch for int i i size i pool submit new Runnable Override public void run try context getTypeConverter mandatoryConvertTo MyCamelBean class latch countDown catch NoTypeConversionAvailableException e assertTrue latch await TimeUnit MINUTES
public void xxxtestTokenPairPerformanceRoute throws Exception NotifyBuilder notify new NotifyBuilder context whenDone size create boolean matches notify matches TimeUnit MINUTES
watch restart split tokenizeXML streaming choice when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num tiny incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num
split tokenizeXML streaming choice when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num tiny incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num xml
if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num xml log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml
log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num xml log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num med incrementAndGet
String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num xml log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num med incrementAndGet if num log info num log debug xml otherwise process new Processor
assertTrue xml contains xml int num small incrementAndGet if num log info num xml log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num med incrementAndGet if num log info num log debug xml otherwise process new Processor public void process Exchange exchange throws Exception
private void doSendMessages int messageCount throws Exception
getMockEndpoint setResultWaitTime getMockEndpoint setResultWaitTime getMockEndpoint expectedMessageCount forResult getMockEndpoint expectedMessageCount forOther for int i i messageCount i switch i case template sendBody XMLTEST1 break case template sendBody XMLTEST2 break case template sendBody XMLTEST3 break default break LOG info messageCount System currentTimeMillis now assertMockEndpointsSatisfied
public void xxTestXPatPerformanceRoute throws Exception NotifyBuilder notify new NotifyBuilder context whenDone size create boolean matches notify matches TimeUnit SECONDS
watch restart split xpath streaming choice when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num tiny incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num
split xpath streaming choice when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num tiny incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num
if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml
log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num med incrementAndGet
String xml exchange getIn getBody String class assertTrue xml contains xml int num small incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num med incrementAndGet if num log info num log debug xml otherwise process new Processor
assertTrue xml contains xml int num small incrementAndGet if num log info num log debug xml when xpath process new Processor public void process Exchange exchange throws Exception String xml exchange getIn getBody String class assertTrue xml contains xml int num med incrementAndGet if num log info num log debug xml otherwise process new Processor public void process Exchange exchange throws Exception
Test public void testCreateRouteFromCamelContext throws Exception List RouteDefinition list context getRouteDefinitions assertEquals list size list RouteDefinition routeType list get
protected void dump Object object throws Exception JAXBContext jaxbContext XmlTestSupport createJaxbContext Marshaller marshaller jaxbContext createMarshaller marshaller setProperty Marshaller JAXB_FORMATTED_OUTPUT Boolean TRUE StringWriter buffer new StringWriter marshaller marshal object buffer
protected void dump RouteContainer context throws Exception Marshaller marshaller jaxbContext createMarshaller marshaller setProperty Marshaller JAXB_FORMATTED_OUTPUT Boolean TRUE StringWriter buffer new StringWriter marshaller marshal context buffer
if clazz RouteDefinition class continue for Field field clazz getDeclaredFields LOG debug clazz getName field getName boolean attribute field getAnnotation XmlAttribute class null boolean element field getAnnotation XmlElement class null boolean elementRef field getAnnotation XmlElementRef class null if attribute element attribute elementRef element elementRef fail clazz getName field getName if attribute element elementRef Method getter IntrospectionSupport getPropertyGetter clazz field getName Method setter IntrospectionSupport getPropertySetter clazz field getName assertNotNull getter field getName clazz getName assertNotNull setter field getName clazz getName for Method method clazz getDeclaredMethods
protected void assertChildTo String message ProcessorDefinition route String uri ProcessorDefinition processor assertOneElement route getOutputs ToDefinition value assertIsInstanceOf ToDefinition class processor String text message
protected void assertTo String message ProcessorDefinition processor String uri ToDefinition value assertIsInstanceOf ToDefinition class processor String text message
protected RouteContainer assertParseAsJaxb String uri throws JAXBException Object value parseUri uri RouteContainer context assertIsInstanceOf RouteContainer class value
protected RestContainer assertParseRestAsJaxb String uri throws JAXBException Object value parseUri uri RestContainer context assertIsInstanceOf RestContainer class value
Override public void notify CamelEvent event throws Exception if event ExchangeSentEvent ExchangeSentEvent sent ExchangeSentEvent event
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure throws Exception errorHandler defaultErrorHandler maximumRedeliveries redeliveryDelay from to to process new Processor public void process Exchange exchange throws Exception
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure throws Exception errorHandler defaultErrorHandler maximumRedeliveries redeliveryDelay asyncDelayedRedelivery from to to process new Processor public void process Exchange exchange throws Exception
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure throws Exception errorHandler defaultErrorHandler maximumRedeliveries redeliveryDelay asyncDelayedRedelivery from to to process new Processor public void process Exchange exchange throws Exception
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure throws Exception onException IllegalArgumentException class maximumRedeliveries redeliveryDelay from to to process new Processor public void process Exchange exchange throws Exception
Test public void testUsingCustomExceptionHandlerAndOneRedelivery throws Exception a expectedMessageCount sendBody MockEndpoint assertIsSatisfied a b List Exchange list a getReceivedExchanges boolean b1 list isEmpty assertTrue b1 Exchange exchange list get Message in exchange getIn
Test public void testUsingCustomExceptionHandlerWithNoRedeliveries throws Exception b expectedMessageCount sendBody MockEndpoint assertIsSatisfied a b List Exchange list b getReceivedExchanges boolean b1 list isEmpty assertTrue b1 Exchange exchange list get Message in exchange getIn
Test public void testSplitAndAggregateInOut throws Exception MockEndpoint mock getMockEndpoint mock expectedBodiesReceived expectedBody Object out template requestBody assertEquals expectedBody out
public void xxxtestAggregateSimpleExpression throws Exception int files int rows int batches rows int total files files rows files batches
int rows int batches rows int total files files rows files batches LOG info total NotifyBuilder notify new NotifyBuilder context whenDone total create LOG info for int i i files i Writer out IOHelper buffered new FileWriter new File i for int j j rows j out write DATA out close StopWatch watch new StopWatch context getRouteController startRoute LOG info boolean matches notify matches TimeUnit MINUTES
int batches rows int total files files rows files batches LOG info total NotifyBuilder notify new NotifyBuilder context whenDone total create LOG info for int i i files i Writer out IOHelper buffered new FileWriter new File i for int j j rows j out write DATA out close StopWatch watch new StopWatch context getRouteController startRoute LOG info boolean matches notify matches TimeUnit MINUTES LOG info matches
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder public void configure throws Exception from uri aggregate constant true new AggregationStrategy public Exchange aggregate Exchange oldExchange Exchange newExchange Exchange answer oldExchange null oldExchange newExchange COUNTER getAndIncrement Integer newIndex newExchange getIn getHeader Integer class int total SUM addAndGet newIndex answer getIn setHeader total
public Exchange aggregate Exchange oldExchange Exchange newExchange debugIn oldExchange newExchange Exchange answer newExchange if oldExchange null Map String List brothers oldExchange getIn getBody Map class brothers put newExchange getIn getHeader SURNAME_HEADER String class newExchange getIn getBody List class answer oldExchange else Map String List brothers new HashMap brothers put newExchange getIn getHeader SURNAME_HEADER String class newExchange getIn getBody List class newExchange getIn setBody brothers debugOut answer return answer private void debugIn String stringId Exchange oldExchange Exchange newExchange
public Exchange aggregate Exchange oldExchange Exchange newExchange debugIn oldExchange newExchange Exchange answer newExchange if oldExchange null Map String List brothers oldExchange getIn getBody Map class brothers put newExchange getIn getHeader SURNAME_HEADER String class newExchange getIn getBody List class answer oldExchange else Map String List brothers new HashMap brothers put newExchange getIn getHeader SURNAME_HEADER String class newExchange getIn getBody List class newExchange getIn setBody brothers debugOut answer return answer private void debugIn String stringId Exchange oldExchange Exchange newExchange
Exchange answer newExchange if oldExchange null Map String List brothers oldExchange getIn getBody Map class brothers put newExchange getIn getHeader SURNAME_HEADER String class newExchange getIn getBody List class answer oldExchange else Map String List brothers new HashMap brothers put newExchange getIn getHeader SURNAME_HEADER String class newExchange getIn getBody List class newExchange getIn setBody brothers debugOut answer return answer private void debugIn String stringId Exchange oldExchange Exchange newExchange if oldExchange null log debug stringId oldExchange getIn getHeaders
if oldExchange null Map String List brothers oldExchange getIn getBody Map class brothers put newExchange getIn getHeader SURNAME_HEADER String class newExchange getIn getBody List class answer oldExchange else Map String List brothers new HashMap brothers put newExchange getIn getHeader SURNAME_HEADER String class newExchange getIn getBody List class newExchange getIn setBody brothers debugOut answer return answer private void debugIn String stringId Exchange oldExchange Exchange newExchange if oldExchange null log debug stringId oldExchange getIn getHeaders log debug stringId oldExchange getIn getBody
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure throws Exception from split tokenize streaming to process e if e getProperty Exchange SPLIT_INDEX int class int frames int Stream of Thread currentThread getStackTrace filter st st getClassName startsWith count count set frames
Test public void testSplitParallelBigFile throws Exception StopWatch watch new StopWatch NotifyBuilder builder new NotifyBuilder context whenDone lines create boolean done builder matches TimeUnit SECONDS
Test public void testSenderXmlData throws Exception MockEndpoint result getMockEndpoint result reset result expectedMessageCount template sendBody xmlData assertMockEndpointsSatisfied for Exchange exchange result getExchanges String message exchange getIn getBody String class
private void assertThrottlerTiming final long elapsedTimeMs final int throttle final int intervalMs final int messageCount long minimum calculateMinimum intervalMs throttle messageCount long maximum calculateMaximum intervalMs throttle messageCount maximum
private void assertThrottlerTiming final long elapsedTimeMs final int throttle final int intervalMs final int messageCount long minimum calculateMinimum intervalMs throttle messageCount long maximum calculateMaximum intervalMs throttle messageCount maximum
Test public void testTransform throws Exception long noop context getTypeConverterRegistry getStatistics getNoopCounter long attempt context getTypeConverterRegistry getStatistics getAttemptCounter long failed context getTypeConverterRegistry getStatistics getFailedCounter long hit context getTypeConverterRegistry getStatistics getHitCounter long miss context getTypeConverterRegistry getStatistics getMissCounter getMockEndpoint expectedMessageCount size for int i i size i template sendBody assertMockEndpointsSatisfied long noop2 context getTypeConverterRegistry getStatistics getNoopCounter long attempt2 context getTypeConverterRegistry getStatistics getAttemptCounter long failed2 context getTypeConverterRegistry getStatistics getFailedCounter long hit2 context getTypeConverterRegistry getStatistics getHitCounter long miss2 context getTypeConverterRegistry getStatistics getMissCounter
long noop context getTypeConverterRegistry getStatistics getNoopCounter long attempt context getTypeConverterRegistry getStatistics getAttemptCounter long failed context getTypeConverterRegistry getStatistics getFailedCounter long hit context getTypeConverterRegistry getStatistics getHitCounter long miss context getTypeConverterRegistry getStatistics getMissCounter getMockEndpoint expectedMessageCount size for int i i size i template sendBody assertMockEndpointsSatisfied long noop2 context getTypeConverterRegistry getStatistics getNoopCounter long attempt2 context getTypeConverterRegistry getStatistics getAttemptCounter long failed2 context getTypeConverterRegistry getStatistics getFailedCounter long hit2 context getTypeConverterRegistry getStatistics getHitCounter long miss2 context getTypeConverterRegistry getStatistics getMissCounter log info noop noop2 noop2 noop
long attempt context getTypeConverterRegistry getStatistics getAttemptCounter long failed context getTypeConverterRegistry getStatistics getFailedCounter long hit context getTypeConverterRegistry getStatistics getHitCounter long miss context getTypeConverterRegistry getStatistics getMissCounter getMockEndpoint expectedMessageCount size for int i i size i template sendBody assertMockEndpointsSatisfied long noop2 context getTypeConverterRegistry getStatistics getNoopCounter long attempt2 context getTypeConverterRegistry getStatistics getAttemptCounter long failed2 context getTypeConverterRegistry getStatistics getFailedCounter long hit2 context getTypeConverterRegistry getStatistics getHitCounter long miss2 context getTypeConverterRegistry getStatistics getMissCounter log info noop noop2 noop2 noop log info attempt attempt2 attempt2 attempt
long failed context getTypeConverterRegistry getStatistics getFailedCounter long hit context getTypeConverterRegistry getStatistics getHitCounter long miss context getTypeConverterRegistry getStatistics getMissCounter getMockEndpoint expectedMessageCount size for int i i size i template sendBody assertMockEndpointsSatisfied long noop2 context getTypeConverterRegistry getStatistics getNoopCounter long attempt2 context getTypeConverterRegistry getStatistics getAttemptCounter long failed2 context getTypeConverterRegistry getStatistics getFailedCounter long hit2 context getTypeConverterRegistry getStatistics getHitCounter long miss2 context getTypeConverterRegistry getStatistics getMissCounter log info noop noop2 noop2 noop log info attempt attempt2 attempt2 attempt log info failed failed2 failed2 failed
long hit context getTypeConverterRegistry getStatistics getHitCounter long miss context getTypeConverterRegistry getStatistics getMissCounter getMockEndpoint expectedMessageCount size for int i i size i template sendBody assertMockEndpointsSatisfied long noop2 context getTypeConverterRegistry getStatistics getNoopCounter long attempt2 context getTypeConverterRegistry getStatistics getAttemptCounter long failed2 context getTypeConverterRegistry getStatistics getFailedCounter long hit2 context getTypeConverterRegistry getStatistics getHitCounter long miss2 context getTypeConverterRegistry getStatistics getMissCounter log info noop noop2 noop2 noop log info attempt attempt2 attempt2 attempt log info failed failed2 failed2 failed log info hit hit2 hit2 hit
Override protected RouteBuilder createRouteBuilder return new RouteBuilder public void configure from to from process new Processor public void process Exchange exchange throws Exception
Test public void testSuccess throws Exception sendMessage assertTrue doneLatch await TimeUnit SECONDS assertNull failed assertNotNull completed assertEquals foo assertNull baz
Test public void testException throws Exception sendMessage assertTrue doneLatch await TimeUnit SECONDS assertNull completed assertNotNull failed assertEquals baz assertNull foo
Override protected RouteBuilder createRouteBuilder return new RouteBuilder public void configure from to from process new Processor public void process Exchange exchange throws Exception
Test public void testAsyncEndpointEventNotifier throws Exception getMockEndpoint expectedBodiesReceived getMockEndpoint expectedBodiesReceived String reply template requestBody String class assertEquals reply assertMockEndpointsSatisfied assertTrue latch await TimeUnit SECONDS long delta time get
Override public void configure throws Exception context addComponent new MyAsyncComponent errorHandler defaultErrorHandler maximumRedeliveries redeliveryDelay asyncDelayedRedelivery from to to process new Processor public void process Exchange exchange throws Exception beforeThreadName Thread currentThread getName to process new Processor public void process Exchange exchange throws Exception LOG info attempt exchange String body exchange getIn getBody String class if body contains if attempt LOG info throw new IllegalArgumentException exchange getIn setBody body
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure throws Exception context addComponent new MyAsyncComponent errorHandler defaultErrorHandler maximumRedeliveries redeliveryDelay asyncDelayedRedelivery from to to process new Processor public void process Exchange exchange throws Exception
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure throws Exception context addComponent new MyAsyncComponent from routeId to to id to process new Processor Override public void process Exchange exchange throws Exception int size context adapt ExtendedCamelContext class getAsyncProcessorAwaitManager size
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure throws Exception context addComponent new MyAsyncComponent from routeId to to id to process new Processor Override public void process Exchange exchange throws Exception int size context adapt ExtendedCamelContext class getAsyncProcessorAwaitManager size
Override protected RouteBuilder createRouteBuilder throws Exception return new RouteBuilder Override public void configure throws Exception context addComponent new MyAsyncComponent from routeId to to id to process new Processor Override public void process Exchange exchange throws Exception int size context adapt ExtendedCamelContext class getAsyncProcessorAwaitManager size log info size assertEquals size Collection AsyncProcessorAwaitManager AwaitThread threads context adapt ExtendedCamelContext class getAsyncProcessorAwaitManager browse AsyncProcessorAwaitManager AwaitThread thread threads iterator next long wait thread getWaitDuration
Override public boolean process final Exchange exchange final AsyncCallback callback executor submit new Callable Object public Object call throws Exception LOG info getEndpoint getDelay Thread sleep getEndpoint getDelay int count counter incrementAndGet if getEndpoint getFailFirstAttempts count
private void testIteration int i throws Exception MockEndpoint me context getEndpoint MockEndpoint class me reset me expectedMessageCount
private void testIteration int i throws Exception MockEndpoint me context getEndpoint MockEndpoint class me reset me expectedMessageCount LOG info i template sendBody template sendBody template sendBody template sendBody assertMockEndpointsSatisfied String a me getExchanges get getIn getBody String class String b me getExchanges get getIn getBody String class String c me getExchanges get getIn getBody String class String d me getExchanges get getIn getBody String class String line a b c d
list add i Random random new Random System currentTimeMillis StringBuilder sb new StringBuilder sb append long millis System currentTimeMillis for int i input i i int r random nextInt i int next list remove r sb append next append resequencer insert next log info sb toString sb delete sb length sb append for int i i input i sb append buffer take append
Random random new Random System currentTimeMillis StringBuilder sb new StringBuilder sb append long millis System currentTimeMillis for int i input i i int r random nextInt i int next list remove r sb append next append resequencer insert next log info sb toString sb delete sb length sb append for int i i input i sb append buffer take append millis System currentTimeMillis millis
Test public void testDumpModelAsXml throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXml throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXmAl throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXml throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXmAl throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXml throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXml throws Exception assertEquals context getRoutes get getId ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXml throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXmlXPath throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXmlHeader throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXmlBean throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXml throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXmlXPath throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXmlHeader throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXmlBean throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXml throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteTemplateDefinition assertNotNull xml
Test public void testDumpModelAsXml throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXml throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXml throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXml throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
Test public void testDumpModelAsXml throws Exception ExtendedCamelContext ecc context adapt ExtendedCamelContext class String xml ecc getModelToXMLDumper dumpModelAsXml context context getRouteDefinition assertNotNull xml
final long interval conf getInterval final int threshold conf getFailureThreshold int invocationCount Integer meta getOrDefault INVOCATION_COUNT int failureCount Integer meta getOrDefault FAILURE_COUNT String invocationTime now format DateTimeFormatter ISO_ZONED_DATE_TIME boolean call true meta put INVOCATION_ATTEMPT_TIME invocationTime if enabled LOGGER debug getGroup getId builder message builder detail CHECK_ENABLED false return builder unknown build if lastResult null lastInvocation null interval Duration elapsed Duration between lastInvocation now if elapsed compareTo Duration ofMillis interval
LOGGER debug getGroup getId builder message builder detail CHECK_ENABLED false return builder unknown build if lastResult null lastInvocation null interval Duration elapsed Duration between lastInvocation now if elapsed compareTo Duration ofMillis interval LOGGER debug getGroup getId elapsed lastInvocation call false if call LOGGER debug getGroup getId doCall builder options ObjectHelper notNull builder state if builder state State DOWN if failureCount threshold
return false boolean result checks add healthCheck if result if obj CamelContextAware CamelContextAware obj setCamelContext camelContext LOG debug healthCheck getId return result else HealthCheckRepository repository HealthCheckRepository obj if getRepository repository getId isPresent return false boolean result this repositories add repository if result if repository CamelContextAware CamelContextAware repository setCamelContext camelContext
rc PropertyBindingSupport build withMandatory failIfNotSet withRemoveParameters true withConfigurer configurer withIgnoreCase ignoreCase bind context target properties for Map Entry String Object entry backup entrySet if entry getValue null properties containsKey entry getKey String prefix optionPrefix if prefix null prefix endsWith prefix prefix LOG debug prefix entry getKey entry getValue target autoConfiguredProperties put prefix entry getKey entry getValue toString catch PropertyBindingException e String key e getOptionKey if key null String prefix e getOptionPrefix if prefix null prefix endsWith prefix prefix key prefix null prefix e getPropertyName e getPropertyName
doConfigureCamelContextFromMainConfiguration camelContext mainConfigurationProperties autoConfiguredProperties loadConfigurations camelContext if mainConfigurationProperties isAutowireComponentProperties mainConfigurationProperties isAutowireComponentPropertiesDeep autowireConfigurationFromRegistry camelContext mainConfigurationProperties isAutowireComponentPropertiesNonNullOnly mainConfigurationProperties isAutowireComponentPropertiesDeep if mainConfigurationProperties isAutoConfigurationEnabled autoConfigurationFromProperties camelContext autoConfiguredProperties if mainConfigurationProperties isAutowireComponentProperties mainConfigurationProperties isAutowireComponentPropertiesDeep autowireWildcardProperties camelContext if camelContext isTracing mainConfigurationProperties isTracing camelContext setTracing Boolean FALSE if mainConfigurationProperties isAutoConfigurationLogSummary autoConfiguredProperties isEmpty LOG info autoConfiguredProperties forEach k v boolean sensitive SENSITIVE_KEYS contains k toLowerCase Locale ENGLISH if sensitive
loadConfigurations camelContext if mainConfigurationProperties isAutowireComponentProperties mainConfigurationProperties isAutowireComponentPropertiesDeep autowireConfigurationFromRegistry camelContext mainConfigurationProperties isAutowireComponentPropertiesNonNullOnly mainConfigurationProperties isAutowireComponentPropertiesDeep if mainConfigurationProperties isAutoConfigurationEnabled autoConfigurationFromProperties camelContext autoConfiguredProperties if mainConfigurationProperties isAutowireComponentProperties mainConfigurationProperties isAutowireComponentPropertiesDeep autowireWildcardProperties camelContext if camelContext isTracing mainConfigurationProperties isTracing camelContext setTracing Boolean FALSE if mainConfigurationProperties isAutoConfigurationLogSummary autoConfiguredProperties isEmpty LOG info autoConfiguredProperties forEach k v boolean sensitive SENSITIVE_KEYS contains k toLowerCase Locale ENGLISH if sensitive LOG info k
protected void autoConfigurationFailFast CamelContext camelContext Map String String autoConfiguredProperties throws Exception Properties prop camelContext getPropertiesComponent loadProperties name name startsWith LOG debug for String key prop stringPropertyNames
for String key prop stringPropertyNames LOG debug key prop getProperty key Object envEnabled prop remove if envEnabled null envEnabled prop remove if envEnabled null PropertyBindingSupport build withMandatory true withIgnoreCase true bind camelContext mainConfigurationProperties envEnabled autoConfiguredProperties put envEnabled toString Properties propENV null if mainConfigurationProperties isAutoConfigurationEnvironmentVariablesEnabled propENV loadEnvironmentVariablesAsProperties new String if propENV isEmpty prop putAll propENV LOG debug for String key propENV stringPropertyNames
protected void autoConfigurationPropertiesComponent CamelContext camelContext Map String String autoConfiguredProperties throws Exception Properties prop camelContext getPropertiesComponent loadProperties name name startsWith if mainConfigurationProperties isAutoConfigurationEnvironmentVariablesEnabled Properties propENV loadEnvironmentVariablesAsProperties new String if propENV isEmpty prop putAll propENV Map String Object properties new LinkedHashMap for String key prop stringPropertyNames if key startsWith int dot key indexOf String option dot key substring dot String value prop getProperty key validateOptionAndValue key option value properties put optionKey option value if properties isEmpty
if mainConfigurationProperties isAutoConfigurationEnvironmentVariablesEnabled Properties propENV loadEnvironmentVariablesAsProperties new String propENV remove INITIAL_PROPERTIES_LOCATION replace propENV remove OVERRIDE_PROPERTIES_LOCATION replace propENV remove PROPERTY_PLACEHOLDER_LOCATION replace if propENV isEmpty prop putAll propENV Map String Object properties new LinkedHashMap for String key prop stringPropertyNames if key startsWith String value prop getProperty key String option key substring validateOptionAndValue key option value properties put optionKey option value if properties isEmpty
protected void autoConfigurationFromProperties CamelContext camelContext Map String String autoConfiguredProperties throws Exception Properties prop new OrderedProperties try InputStream is camelContext getClassResolver loadResourceAsStream if is null prop load is if prop isEmpty
protected void autoConfigurationFromProperties CamelContext camelContext Map String String autoConfiguredProperties throws Exception Properties prop new OrderedProperties try InputStream is camelContext getClassResolver loadResourceAsStream if is null prop load is if prop isEmpty LOG info prop size if LOG isDebugEnabled LOG debug for String key prop stringPropertyNames
for String key wildcardProperties stringPropertyNames prop remove key for String key prop stringPropertyNames computeProperties key prop properties name Component target camelContext getComponent name if target null throw new IllegalArgumentException key name return Collections singleton target computeProperties key prop properties name DataFormat target camelContext resolveDataFormat name if target null throw new IllegalArgumentException key name return Collections singleton target
protected void autowireConfigurationFromRegistry CamelContext camelContext boolean bindNullOnly boolean deepNesting throws Exception camelContext addLifecycleStrategy new LifecycleStrategySupport Override public void onComponentAdd String name Component component PropertyBindingSupport autowireSingletonPropertiesFromRegistry camelContext component bindNullOnly deepNesting obj propertyName type value
Map PropertyOptionKey Map String Object properties new LinkedHashMap Map String String autoConfiguredProperties new LinkedHashMap String match name toLowerCase Locale ENGLISH for String key wildcardProperties stringPropertyNames String mKey key substring key indexOf toLowerCase Locale ENGLISH if match startsWith mKey computeProperties key wildcardProperties properties s Collections singleton component try for Map Entry PropertyOptionKey Map String Object entry properties entrySet setPropertiesOnTarget camelContext entry getKey getInstance entry getValue entry getKey getOptionPrefix mainConfigurationProperties isAutoConfigurationFailFast true autoConfiguredProperties if mainConfigurationProperties isAutoConfigurationLogSummary autoConfiguredProperties isEmpty LOG info name autoConfiguredProperties forEach k v boolean sensitive SENSITIVE_KEYS contains k toLowerCase Locale ENGLISH if sensitive
String match name toLowerCase Locale ENGLISH for String key wildcardProperties stringPropertyNames String mKey key substring key indexOf toLowerCase Locale ENGLISH if match startsWith mKey computeProperties key wildcardProperties properties s Collections singleton component try for Map Entry PropertyOptionKey Map String Object entry properties entrySet setPropertiesOnTarget camelContext entry getKey getInstance entry getValue entry getKey getOptionPrefix mainConfigurationProperties isAutoConfigurationFailFast true autoConfiguredProperties if mainConfigurationProperties isAutoConfigurationLogSummary autoConfiguredProperties isEmpty LOG info name autoConfiguredProperties forEach k v boolean sensitive SENSITIVE_KEYS contains k toLowerCase Locale ENGLISH if sensitive LOG info k else
private static void initThreadPoolProfiles Registry registry CamelContext camelContext Set String defaultIds new HashSet Map String ThreadPoolProfile profiles registry findByTypeWithName ThreadPoolProfile class if profiles null profiles isEmpty for Map Entry String ThreadPoolProfile entry profiles entrySet ThreadPoolProfile profile entry getValue if profile isDefaultProfile
LOG trace if main getCamelContext null final CountDownLatch latch new CountDownLatch CamelContextTracker tracker new CamelContextTracker Override public void contextDestroyed CamelContext camelContext latch countDown tracker open long max main getCamelContext getShutdownStrategy getTimeUnit toMillis main getCamelContext getShutdownStrategy getTimeout int waits boolean done false StopWatch watch new StopWatch while main getCamelContext isStopped done watch taken max String msg TimeUtils printDuration watch taken if waits
String name routesBuilder getClass getName name name replace boolean match equals includePattern if match ObjectHelper isNotEmpty excludePattern String parts excludePattern split for String part parts match matcher match part name log trace name part match if match break if match ObjectHelper isNotEmpty includePattern String parts includePattern split for String part parts match matcher match part name log trace name part match
Override public List RouteTemplatesDefinition collectXmlRouteTemplatesFromDirectory CamelContext camelContext String directory throws Exception ExtendedCamelContext ecc camelContext adapt ExtendedCamelContext class PackageScanResourceResolver resolver ecc getPackageScanResourceResolver List RouteTemplatesDefinition answer new ArrayList StopWatch watch new StopWatch int count String parts directory split for String part parts
Override public List RouteTemplatesDefinition collectXmlRouteTemplatesFromDirectory CamelContext camelContext String directory throws Exception ExtendedCamelContext ecc camelContext adapt ExtendedCamelContext class PackageScanResourceResolver resolver ecc getPackageScanResourceResolver List RouteTemplatesDefinition answer new ArrayList StopWatch watch new StopWatch int count String parts directory split for String part parts log debug part try Set InputStream set resolver findResources part for InputStream is set
StopWatch watch new StopWatch int count String parts directory split for String part parts log debug part try Set InputStream set resolver findResources part for InputStream is set log debug part RouteTemplatesDefinition templates RouteTemplatesDefinition ecc getXMLRoutesDefinitionLoader loadRouteTemplatesDefinition ecc is if templates null answer add templates IOHelper close is count templates getRouteTemplates size catch FileNotFoundException e
log debug part try Set InputStream set resolver findResources part for InputStream is set log debug part RouteTemplatesDefinition templates RouteTemplatesDefinition ecc getXMLRoutesDefinitionLoader loadRouteTemplatesDefinition ecc is if templates null answer add templates IOHelper close is count templates getRouteTemplates size catch FileNotFoundException e log debug part catch Exception e throw RuntimeCamelException wrapRuntimeException e if count
Set InputStream set resolver findResources part for InputStream is set log debug part RouteTemplatesDefinition templates RouteTemplatesDefinition ecc getXMLRoutesDefinitionLoader loadRouteTemplatesDefinition ecc is if templates null answer add templates IOHelper close is count templates getRouteTemplates size catch FileNotFoundException e log debug part catch Exception e throw RuntimeCamelException wrapRuntimeException e if count log info count watch taken directory else
Override public List RoutesDefinition collectXmlRoutesFromDirectory CamelContext camelContext String directory ExtendedCamelContext ecc camelContext adapt ExtendedCamelContext class PackageScanResourceResolver resolver ecc getPackageScanResourceResolver List RoutesDefinition answer new ArrayList StopWatch watch new StopWatch int count String parts directory split for String part parts
Override public List RoutesDefinition collectXmlRoutesFromDirectory CamelContext camelContext String directory ExtendedCamelContext ecc camelContext adapt ExtendedCamelContext class PackageScanResourceResolver resolver ecc getPackageScanResourceResolver List RoutesDefinition answer new ArrayList StopWatch watch new StopWatch int count String parts directory split for String part parts log debug part try Set InputStream set resolver findResources part for InputStream is set
StopWatch watch new StopWatch int count String parts directory split for String part parts log debug part try Set InputStream set resolver findResources part for InputStream is set log debug part RoutesDefinition routes RoutesDefinition ecc getXMLRoutesDefinitionLoader loadRoutesDefinition ecc is if routes null answer add routes IOHelper close is count routes getRoutes size catch FileNotFoundException e
log debug part try Set InputStream set resolver findResources part for InputStream is set log debug part RoutesDefinition routes RoutesDefinition ecc getXMLRoutesDefinitionLoader loadRoutesDefinition ecc is if routes null answer add routes IOHelper close is count routes getRoutes size catch FileNotFoundException e log debug part catch Exception e throw RuntimeCamelException wrapRuntimeException e if count
Set InputStream set resolver findResources part for InputStream is set log debug part RoutesDefinition routes RoutesDefinition ecc getXMLRoutesDefinitionLoader loadRoutesDefinition ecc is if routes null answer add routes IOHelper close is count routes getRoutes size catch FileNotFoundException e log debug part catch Exception e throw RuntimeCamelException wrapRuntimeException e if count log info count watch taken directory else
Override public List RestsDefinition collectXmlRestsFromDirectory CamelContext camelContext String directory ExtendedCamelContext ecc camelContext adapt ExtendedCamelContext class PackageScanResourceResolver resolver camelContext adapt ExtendedCamelContext class getPackageScanResourceResolver List RestsDefinition answer new ArrayList StopWatch watch new StopWatch int count String parts directory split for String part parts
Override public List RestsDefinition collectXmlRestsFromDirectory CamelContext camelContext String directory ExtendedCamelContext ecc camelContext adapt ExtendedCamelContext class PackageScanResourceResolver resolver camelContext adapt ExtendedCamelContext class getPackageScanResourceResolver List RestsDefinition answer new ArrayList StopWatch watch new StopWatch int count String parts directory split for String part parts log debug part try Set InputStream set resolver findResources part for InputStream is set
StopWatch watch new StopWatch int count String parts directory split for String part parts log debug part try Set InputStream set resolver findResources part for InputStream is set log debug part RestsDefinition rests RestsDefinition ecc getXMLRoutesDefinitionLoader loadRoutesDefinition ecc is if rests null answer add rests IOHelper close is count rests getRests size catch FileNotFoundException e
log debug part try Set InputStream set resolver findResources part for InputStream is set log debug part RestsDefinition rests RestsDefinition ecc getXMLRoutesDefinitionLoader loadRoutesDefinition ecc is if rests null answer add rests IOHelper close is count rests getRests size catch FileNotFoundException e log debug part catch Exception e throw RuntimeCamelException wrapRuntimeException e if count
Set InputStream set resolver findResources part for InputStream is set log debug part RestsDefinition rests RestsDefinition ecc getXMLRoutesDefinitionLoader loadRoutesDefinition ecc is if rests null answer add rests IOHelper close is count rests getRests size catch FileNotFoundException e log debug part catch Exception e throw RuntimeCamelException wrapRuntimeException e if count log info count watch taken directory else
Override public void onContextStopping CamelContext context
protected void waitUntilCompleted while shutdownStrategy isRunAllowed try int idle mainConfigurationProperties getDurationMaxIdleSeconds int max mainConfigurationProperties getDurationMaxMessages long sec mainConfigurationProperties getDurationMaxSeconds if sec
protected void waitUntilCompleted while shutdownStrategy isRunAllowed try int idle mainConfigurationProperties getDurationMaxIdleSeconds int max mainConfigurationProperties getDurationMaxMessages long sec mainConfigurationProperties getDurationMaxSeconds if sec LOG info sec shutdownStrategy await sec TimeUnit SECONDS exitCode compareAndSet UNINITIALIZED_EXIT_CODE mainConfigurationProperties getDurationHitExitCode shutdownStrategy shutdown else if idle max if idle max LOG info idle max else if idle
try int idle mainConfigurationProperties getDurationMaxIdleSeconds int max mainConfigurationProperties getDurationMaxMessages long sec mainConfigurationProperties getDurationMaxSeconds if sec LOG info sec shutdownStrategy await sec TimeUnit SECONDS exitCode compareAndSet UNINITIALIZED_EXIT_CODE mainConfigurationProperties getDurationHitExitCode shutdownStrategy shutdown else if idle max if idle max LOG info idle max else if idle LOG info idle else
public void configureRoutes CamelContext camelContext DefaultConfigurationProperties config if config isRoutesCollectorEnabled try LOG debug routesCollector final List RoutesBuilder routes routesCollector collectRoutesFromRegistry camelContext config getJavaRoutesExcludePattern config getJavaRoutesIncludePattern routesBuilders addAll routes routesBuilders sort OrderedComparator get for RoutesBuilder builder routesBuilders
routesBuilders addAll routes routesBuilders sort OrderedComparator get for RoutesBuilder builder routesBuilders LOG debug builder camelContext addRoutes builder boolean scan config getXmlRoutes equals if scan List RoutesDefinition defs routesCollector collectXmlRoutesFromDirectory camelContext config getXmlRoutes for RoutesDefinition def defs LOG debug config getXmlRoutes camelContext getExtension Model class addRouteDefinitions def getRoutes boolean scanTemplates config getXmlRouteTemplates equals if scanTemplates List RouteTemplatesDefinition defs routesCollector collectXmlRouteTemplatesFromDirectory camelContext config getXmlRouteTemplates for RouteTemplatesDefinition def defs
boolean scan config getXmlRoutes equals if scan List RoutesDefinition defs routesCollector collectXmlRoutesFromDirectory camelContext config getXmlRoutes for RoutesDefinition def defs LOG debug config getXmlRoutes camelContext getExtension Model class addRouteDefinitions def getRoutes boolean scanTemplates config getXmlRouteTemplates equals if scanTemplates List RouteTemplatesDefinition defs routesCollector collectXmlRouteTemplatesFromDirectory camelContext config getXmlRouteTemplates for RouteTemplatesDefinition def defs LOG debug config getXmlRouteTemplates camelContext getExtension Model class addRouteTemplateDefinitions def getRouteTemplates boolean scanRests config getXmlRests equals if scanRests List RestsDefinition defs routesCollector collectXmlRestsFromDirectory camelContext config getXmlRests
Override public void await long timeout TimeUnit unit throws InterruptedException
mask Boolean getBoolean JmxSystemPropertyKeys MASK values put JmxSystemPropertyKeys MASK mask if System getProperty JmxSystemPropertyKeys INCLUDE_HOST_NAME null includeHostName Boolean getBoolean JmxSystemPropertyKeys INCLUDE_HOST_NAME values put JmxSystemPropertyKeys INCLUDE_HOST_NAME includeHostName if System getProperty JmxSystemPropertyKeys LOAD_STATISTICS_ENABLED null loadStatisticsEnabled Boolean getBoolean JmxSystemPropertyKeys LOAD_STATISTICS_ENABLED values put JmxSystemPropertyKeys LOAD_STATISTICS_ENABLED loadStatisticsEnabled if System getProperty JmxSystemPropertyKeys ENDPOINT_RUNTIME_STATISTICS_ENABLED null endpointRuntimeStatisticsEnabled Boolean getBoolean JmxSystemPropertyKeys ENDPOINT_RUNTIME_STATISTICS_ENABLED values put JmxSystemPropertyKeys ENDPOINT_RUNTIME_STATISTICS_ENABLED endpointRuntimeStatisticsEnabled if System getProperty JmxSystemPropertyKeys STATISTICS_LEVEL null statisticsLevel camelContext getTypeConverter mandatoryConvertTo ManagementStatisticsLevel class System getProperty JmxSystemPropertyKeys STATISTICS_LEVEL values put JmxSystemPropertyKeys STATISTICS_LEVEL statisticsLevel if System getProperty JmxSystemPropertyKeys MANAGEMENT_NAME_PATTERN null
Override public void unregister ObjectName name throws JMException if isRegistered name ObjectName on mbeansRegistered remove name server unregisterMBean on
private void registerMBeanWithServer Object obj ObjectName name boolean forceRegistration throws JMException boolean exists isRegistered name if exists if forceRegistration
Override public void notify CamelEvent event throws Exception
Override public void notify CamelEvent event throws Exception if isStarted
Override public void restart long delay throws Exception stop if delay try
public String slip String body ExchangeProperties Map String Object properties
enabled Boolean mbeanServer getAttribute on assertEquals Boolean TRUE enabled mbeanServer invoke on new Object new String MockEndpoint mock getMockEndpoint mock expectedMessageCount mock setSleepForEmptyTest template sendBody assertMockEndpointsSatisfied await atMost TimeUnit SECONDS untilAsserted Set String suspended Set String mbeanServer invoke on null null assertNotNull suspended assertEquals suspended size assertEquals suspended iterator next String xml String mbeanServer invoke on new Object new String
assertMockEndpointsSatisfied Set String nodes Set String mbeanServer invoke on null null assertNotNull nodes assertEquals nodes size assertEquals nodes iterator next mbeanServer invoke on new Object new String mbeanServer invoke on new Object new String mbeanServer invoke on new Object new String await atMost TimeUnit SECONDS untilAsserted Set String suspended Set String mbeanServer invoke on null null assertNotNull suspended assertEquals suspended size assertEquals suspended iterator next String xml String mbeanServer invoke on new Object new String
assertMockEndpointsSatisfied Set String nodes Set String mbeanServer invoke on null null assertNotNull nodes assertEquals nodes size assertEquals nodes iterator next mbeanServer invoke on new Object new String mbeanServer invoke on new Object new String mbeanServer invoke on new Object new String await atMost TimeUnit SECONDS untilAsserted Set String suspended Set String mbeanServer invoke on null null assertNotNull suspended assertEquals suspended size assertEquals suspended iterator next String xml String mbeanServer invoke on new Object new String
assertMockEndpointsSatisfied Set String nodes Set String mbeanServer invoke on null null assertNotNull nodes assertEquals nodes size assertEquals nodes iterator next mbeanServer invoke on new Object new String mbeanServer invoke on new Object new String mbeanServer invoke on new Object new String await atMost TimeUnit SECONDS untilAsserted Set String suspended Set String mbeanServer invoke on null null assertNotNull suspended assertEquals suspended size assertEquals suspended iterator next String xml String mbeanServer invoke on new Object new String
mbeanServer invoke on null null enabled Boolean mbeanServer getAttribute on assertEquals Boolean TRUE enabled mbeanServer invoke on new Object new String MockEndpoint mock getMockEndpoint mock expectedMessageCount template sendBody template sendBody template sendBody assertMockEndpointsSatisfied Set String nodes Set String mbeanServer invoke on null null assertNotNull nodes assertEquals nodes size assertEquals nodes iterator next String xml String mbeanServer invoke on new Object new String
template sendBody assertMockEndpointsSatisfied Set String nodes Set String mbeanServer invoke on null null assertNotNull nodes assertEquals nodes size resetMocks mock expectedMessageCount mock setSleepForEmptyTest template sendBody assertMockEndpointsSatisfied nodes Set String mbeanServer invoke on null null assertNotNull nodes assertEquals nodes size assertEquals nodes iterator next String xml String mbeanServer invoke on new Object new String
ObjectName on new ObjectName assertNotNull on mbeanServer isRegistered on Boolean enabled Boolean mbeanServer getAttribute on assertEquals Boolean FALSE enabled Integer size Integer mbeanServer getAttribute on assertEquals size intValue mbeanServer setAttribute on new Attribute Boolean TRUE getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount template sendBody template sendBody assertMockEndpointsSatisfied String events String mbeanServer invoke on new Object new String assertNotNull events
Test public void testBacklogTracerEventMessageDumpAllAsXml throws Exception MBeanServer mbeanServer getMBeanServer ObjectName on new ObjectName assertNotNull on mbeanServer isRegistered on Boolean enabled Boolean mbeanServer getAttribute on assertEquals Boolean FALSE enabled mbeanServer setAttribute on new Attribute Boolean TRUE getMockEndpoint expectedMessageCount getMockEndpoint expectedMessageCount template sendBody template sendBody assertMockEndpointsSatisfied String events String mbeanServer invoke on null null assertNotNull events
template sendBody template sendBodyAndHeader template sendBodyAndHeader template sendBodyAndHeader template sendBodyAndHeader true Map String Object headers new HashMap headers put false headers put headers put template sendBodyAndHeaders headers assertMockEndpointsSatisfied List Exchange exchanges getMockEndpoint getReceivedExchanges MBeanServer mbeanServer getMBeanServer ObjectName name ObjectName getInstance String out String mbeanServer invoke name new Object true new String
template sendBodyAndHeader true Map String Object headers new HashMap headers put false headers put headers put template sendBodyAndHeaders headers assertMockEndpointsSatisfied List Exchange exchanges getMockEndpoint getReceivedExchanges MBeanServer mbeanServer getMBeanServer ObjectName name ObjectName getInstance String out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String
headers put template sendBodyAndHeaders headers assertMockEndpointsSatisfied List Exchange exchanges getMockEndpoint getReceivedExchanges MBeanServer mbeanServer getMBeanServer ObjectName name ObjectName getInstance String out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String
MBeanServer mbeanServer getMBeanServer ObjectName name ObjectName getInstance String out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String
log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String
log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String
log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object true new String
if isPlatform return getMockEndpoint expectedMessageCount template sendBodyAndHeader template sendBodyAndHeader assertMockEndpointsSatisfied List Exchange exchanges getMockEndpoint getReceivedExchanges MBeanServer mbeanServer getMBeanServer ObjectName name ObjectName getInstance String out String mbeanServer invoke name new Object false new String assertNotNull out log info out assertEquals exchanges get getExchangeId out out String mbeanServer invoke name new Object false new String assertNotNull out
result expectedMessageCount CountDownLatch latch1 new CountDownLatch CountDownLatch latch2 new CountDownLatch template asyncSendBody latch1 Thread sleep template asyncSendBody latch2 await atMost TimeUnit SECONDS until Long num Long mbeanServer getAttribute on return num null num inflight Long mbeanServer getAttribute on assertEquals inflight longValue ts Long mbeanServer getAttribute on assertNotNull ts id String mbeanServer getAttribute on
Long num Long mbeanServer getAttribute on return num null num inflight Long mbeanServer getAttribute on assertEquals inflight longValue ts Long mbeanServer getAttribute on assertNotNull ts id String mbeanServer getAttribute on assertNotNull id log info id ts latch1 countDown Thread sleep Long ts2 Long mbeanServer getAttribute on assertNotNull ts2 String id2 String mbeanServer getAttribute on
Test public void testManagedResource throws Exception if isPlatform return final ManagementAgent managementAgent context getManagementStrategy getManagementAgent assertNotNull managementAgent final MBeanServer mBeanServer managementAgent getMBeanServer assertNotNull mBeanServer final String mBeanServerDefaultDomain managementAgent getMBeanServerDefaultDomain assertEquals mBeanServerDefaultDomain final String managementName context getManagementName assertNotNull managementName LOG info managementName ObjectName onContext ObjectName getInstance mBeanServerDefaultDomain managementName context getName assertTrue mBeanServer isRegistered onContext ObjectName onManagedBean ObjectName getInstance mBeanServerDefaultDomain managementName
MBeanServer mbeanServer getMBeanServer ObjectName on ObjectName getInstance CUSTOM_DOMAIN_NAME getMockEndpoint expectedMessageCount template asyncSendBody assertMockEndpointsSatisfied String xml String mbeanServer invoke on new Object false true new String log info xml Document doc context getTypeConverter convertTo Document class xml assertNotNull doc int processors doc getDocumentElement getElementsByTagName getLength assertEquals processors int exchangeCompleted Integer parseInt doc getDocumentElement getElementsByTagName item getAttributes getNamedItem getNodeValue assertEquals exchangeCompleted mbeanServer invoke on new Object true new String xml String mbeanServer invoke on new Object false true new String
assertEquals myRoutePolicy getStop getMockEndpoint expectedMessageCount template sendBody assertMockEndpointsSatisfied MBeanServer mbeanServer getMBeanServer Set ObjectName set mbeanServer queryNames new ObjectName null assertEquals set size ObjectName on set iterator next boolean registered mbeanServer isRegistered on assertEquals true registered String uri String mbeanServer getAttribute on assertEquals uri String state String mbeanServer getAttribute on assertEquals ServiceStatus Started name state String uptime String mbeanServer getAttribute on
getMockEndpoint expectedMessageCount template sendBody assertMockEndpointsSatisfied MBeanServer mbeanServer getMBeanServer Set ObjectName set mbeanServer queryNames new ObjectName null assertEquals set size ObjectName on set iterator next boolean registered mbeanServer isRegistered on assertEquals true registered String uri String mbeanServer getAttribute on assertEquals uri String state String mbeanServer getAttribute on assertEquals ServiceStatus Started name state String uptime String mbeanServer getAttribute on assertNotNull uptime
Integer current Integer mbeanServer getAttribute on assertEquals current intValue current Integer mbeanServer getAttribute on assertEquals current intValue current Integer mbeanServer getAttribute on assertEquals current intValue String source String mbeanServer getAttribute on assertTrue source startsWith assertTrue source endsWith TabularData data TabularData mbeanServer invoke on null null for Object row data values CompositeData composite CompositeData row String scheme String composite get String from String composite get String to String composite get
public static int getNextAvailable try ServerSocket ss new ServerSocket ss setReuseAddress true ss bind new InetSocketAddress InetAddress null int port ss getLocalPort
String query int idx uri indexOf if idx query uri substring idx else query u getRawQuery parameters URISupport parseQuery query true else parameters URISupport parseParameters u if properties null parameters putAll properties parameters remove URISupport resolveRawParameterValues parameters validateURI uri path parameters if LOG isTraceEnabled
Map String Object parameters if useRawUri String query int idx uri indexOf if idx query uri substring idx else query u getRawQuery parameters URISupport parseQuery query true else parameters URISupport parseParameters u URISupport resolveRawParameterValues parameters uri useRawUri uri encodedUri validateURI uri path parameters if LOG isTraceEnabled
long currentInitialDelay if initialDelay currentInitialDelay timeUnit convert DEFAULT_INITIAL_DELAY TimeUnit MILLISECONDS else currentInitialDelay initialDelay long currentDelay if delay currentDelay timeUnit convert DEFAULT_DELAY TimeUnit MILLISECONDS if currentDelay currentDelay else currentDelay delay if futures size if isUseFixedDelay if LOG isDebugEnabled
currentInitialDelay initialDelay long currentDelay if delay currentDelay timeUnit convert DEFAULT_DELAY TimeUnit MILLISECONDS if currentDelay currentDelay else currentDelay delay if futures size if isUseFixedDelay if LOG isDebugEnabled LOG debug currentInitialDelay currentDelay getTimeUnit name toLowerCase Locale ENGLISH consumer getEndpoint for int i i concurrentTasks i futures add scheduledExecutorService scheduleWithFixedDelay task currentInitialDelay currentDelay getTimeUnit else
private void bind InvokeOnHeader handler final Method method if handler null method getParameterCount final Class type method getParameterTypes
public static void clearCache if LOG isDebugEnabled CACHE LRUCache LRUCache localCache LRUCache IntrospectionSupport CACHE
LOG trace try ClassLoader classLoader LRUCacheFactory class getClassLoader URL url classLoader getResource FACTORY if url null Properties props new Properties try InputStream is url openStream props load is String clazzName props getProperty if clazzName null LOG trace clazzName Class clazz classLoader loadClass clazzName LOG trace clazzName Object factory clazz getDeclaredConstructor newInstance LOG trace factory
public static Set Path findInFileSystem Path root String pattern throws Exception try Stream Path path Files walk root return path filter Files :: isRegularFile filter entry Path relative root relativize entry String str relative toString replaceAll Pattern quote File separator AntPathMatcher DEFAULT_PATH_SEPARATOR boolean match AntPathMatcher INSTANCE match pattern str
if backoffMultiplier idleCounter backoffIdleThreshold backoffIdleThreshold Integer MAX_VALUE errorCounter backoffErrorThreshold backoffErrorThreshold Integer MAX_VALUE if backoffCounter backoffMultiplier if idleCounter LOG debug idleCounter backoffCounter backoffMultiplier else LOG debug errorCounter backoffCounter backoffMultiplier return else idleCounter errorCounter backoffCounter LOG trace long count counter incrementAndGet boolean stopFire repeatCount count repeatCount if stopFire
LOG trace long count counter incrementAndGet boolean stopFire repeatCount count repeatCount if stopFire LOG debug getEndpoint repeatCount scheduler unscheduleTask return int retryCounter boolean done false Throwable cause null int polledMessages while done try cause null done true
cause null done true if isPollAllowed if retryCounter LOG trace this getEndpoint else LOG debug retryCounter this getEndpoint polling true try boolean begin pollStrategy begin this getEndpoint if begin retryCounter polledMessages poll LOG trace polledMessages if polledMessages isSendEmptyMessageWhenIdle
public void addTimerListener TimerListener listener listeners add listener
public void removeTimerListener TimerListener listener listeners remove listener
Override protected void doStart throws Exception ObjectHelper notNull camelContext this executorService camelContext getExecutorServiceManager newSingleThreadScheduledExecutor this task executorService scheduleAtFixedRate this interval interval TimeUnit MILLISECONDS
Override public void startView String namespace throws Exception LockHelper doWithWriteLockT lock ViewHolder T holder views get namespace if holder null
Override public void stopView String namespace throws Exception LockHelper doWithWriteLockT lock ViewHolder T holder views get namespace if holder null
final HashMap String Object properties new HashMap getPropertiesHelper getEndpointProperties getCamelContext configuration properties this endpointProperties Collections unmodifiableMap properties final Set String arguments new HashSet endpointPropertyNames if inBody null arguments add inBody interceptPropertyNames arguments candidates new ArrayList candidates addAll methodHelper getCandidateMethods methodName arguments candidates Collections unmodifiableList candidates if candidates isEmpty throw new IllegalArgumentException String format apiName getName methodName arguments if log isDebugEnabled final Set String missing methodHelper getMissingProperties methodName arguments if missing isEmpty
if methods null if aliasesMap containsKey name methods new ArrayList for String method aliasesMap get name methods addAll methodMap get method if methods null LOG debug name return Collections emptyList int nArgs argNames null argNames size if nArgs LOG debug methods size name return Collections unmodifiableList methods else final List ApiMethod filteredSet filterMethods methods MatchType SUBSET argNames if LOG isDebugEnabled
public static Object invokeMethod Object proxy ApiMethod method Map String Object properties throws RuntimeCamelException if LOG isDebugEnabled
public void getEndpointProperties CamelContext context Object endpointConfiguration Map String Object properties PropertyConfigurer configurer context adapt ExtendedCamelContext class getConfigurerResolver resolvePropertyConfigurer endpointConfiguration getClass getName context if configurer PropertyConfigurerGetter PropertyConfigurerGetter getter PropertyConfigurerGetter configurer Set String all getter getAllOptions endpointConfiguration keySet for String name all Object value getter getOptionValue endpointConfiguration name true if value null String key Character toLowerCase name charAt name substring properties put key value else context adapt ExtendedCamelContext class getBeanIntrospection getProperties endpointConfiguration properties null false for String key componentConfigFields properties remove key if LOG isDebugEnabled
Override public void stop if cache null if LOG isDebugEnabled cache LRUCache LRUCache cache LRUCache this cache
Override public void process Exchange exchange throws Exception boolean matches predicate matches exchange if LOG isDebugEnabled
Override public void doStart throws Exception if groupInterval null ObjectHelper notNull camelContext this logSchedulerService camelContext getExecutorServiceManager newSingleThreadScheduledExecutor this Runnable scheduledLogTask new ScheduledLogTask
protected void appendToStore final String key
protected void appendToStore final String key LOG debug key fileStore FileOutputStream fos null try File storeParentDirectory fileStore getParentFile if storeParentDirectory null storeParentDirectory exists
protected void appendToStore final String key LOG debug key fileStore FileOutputStream fos null try File storeParentDirectory fileStore getParentFile if storeParentDirectory null storeParentDirectory exists LOG info fileStore if fileStore getParentFile mkdirs
protected synchronized void removeFromStore String key
protected synchronized void removeFromStore String key LOG debug key fileStore List String lines new ArrayList boolean found false try try Scanner scanner new Scanner fileStore null STORE_DELIMITER while scanner hasNext String line scanner next if key equals line found true else lines add line catch IOException e throw RuntimeCamelException wrapRuntimeCamelException e if found
if fileStore null fileStore exists return LOG debug dropOldestFileStore fileStore List String lines new ArrayList int count try try Scanner scanner new Scanner fileStore null STORE_DELIMITER while scanner hasNext String line scanner next count if count dropOldestFileStore lines add line catch IOException e throw RuntimeCamelException wrapRuntimeCamelException e if lines isEmpty
lines add line catch IOException e throw RuntimeCamelException wrapRuntimeCamelException e if lines isEmpty LOG debug fileStore lines size FileOutputStream fos null try fos new FileOutputStream fileStore for String line lines fos write line getBytes fos write STORE_DELIMITER getBytes catch IOException e throw RuntimeCamelException wrapRuntimeCamelException e finally IOHelper close fos LOG
protected void loadStore throws IOException if fileStore exists
public static boolean renameFile File from File to boolean copyAndDeleteOnRenameFail throws IOException if from exists return false boolean renamed false int count while renamed count if LOG isDebugEnabled count LOG debug count from to renamed from renameTo to if renamed count try Thread sleep catch InterruptedException e count if renamed copyAndDeleteOnRenameFail
boolean renamed false int count while renamed count if LOG isDebugEnabled count LOG debug count from to renamed from renameTo to if renamed count try Thread sleep catch InterruptedException e count if renamed copyAndDeleteOnRenameFail LOG debug from to renamed renameFileUsingCopy from to if LOG isDebugEnabled count
public static Class loadClass String name ClassLoader loader boolean needToWarn name StringHelper normalizeClassName name if org apache camel util ObjectHelper isEmpty name return null Class clazz loadSimpleType name if clazz null clazz doLoadClass name Thread currentThread getContextClassLoader if clazz null clazz doLoadClass name loader if clazz null clazz doLoadClass name ObjectHelper class getClassLoader if clazz null if needToWarn LOG warn name else
if idx StringBuilder buffer new StringBuilder value substring idx int i idx for int size value length i size i char ch value charAt i if Character isDigit ch buffer append ch value buffer toString if ObjectHelper isNotEmpty value double number Double parseDouble value return number minimumVersion else LOG debug packageName catch Exception e if LOG isDebugEnabled
Override public void error TransformerException e throws TransformerException
Override public void fatalError TransformerException e throws TransformerException
Override public void warning SAXParseException e throws SAXException if LOG isDebugEnabled
Override public void error SAXParseException e throws SAXException if LOG isDebugEnabled
Override public void fatalError SAXParseException e throws SAXException if LOG isDebugEnabled
private static void exportScr Analyzer analyzer Jar jar File scrLocation BuildContext buildContext Log log throws Exception
private static void writeSCR Resource resource File destination BuildContext buildContext Log log throws Exception
else if Charset isSupported this encoding throw new MojoExecutionException this encoding getLog info this encoding List File files new ArrayList if this directories null for File directory this directories if directory exists directory isDirectory files addAll addCollectionFiles directory else if this sourceDirectory null this sourceDirectory exists this sourceDirectory isDirectory files addAll addCollectionFiles this sourceDirectory if this testSourceDirectory null this testSourceDirectory exists this testSourceDirectory isDirectory files addAll addCollectionFiles this testSourceDirectory int numberOfFiles files size
if this testSourceDirectory null this testSourceDirectory exists this testSourceDirectory isDirectory files addAll addCollectionFiles this testSourceDirectory int numberOfFiles files size Log log getLog log info numberOfFiles if numberOfFiles createCodeFormatter ResultCollector rc new ResultCollector Properties hashCache readFileHashCacheFile String basedirPath getBasedirPath for int i n files size i n i File file files get i if file exists if file canWrite formatFile file rc hashCache basedirPath
if this testSourceDirectory null this testSourceDirectory exists this testSourceDirectory isDirectory files addAll addCollectionFiles this testSourceDirectory int numberOfFiles files size Log log getLog log info numberOfFiles if numberOfFiles createCodeFormatter ResultCollector rc new ResultCollector Properties hashCache readFileHashCacheFile String basedirPath getBasedirPath for int i n files size i n i File file files get i if file exists if file canWrite formatFile file rc hashCache basedirPath
files addAll addCollectionFiles this testSourceDirectory int numberOfFiles files size Log log getLog log info numberOfFiles if numberOfFiles createCodeFormatter ResultCollector rc new ResultCollector Properties hashCache readFileHashCacheFile String basedirPath getBasedirPath for int i n files size i n i File file files get i if file exists if file canWrite formatFile file rc hashCache basedirPath else
int numberOfFiles files size Log log getLog log info numberOfFiles if numberOfFiles createCodeFormatter ResultCollector rc new ResultCollector Properties hashCache readFileHashCacheFile String basedirPath getBasedirPath for int i n files size i n i File file files get i if file exists if file canWrite formatFile file rc hashCache basedirPath else rc readOnlyCount
protected void doFormatFile File file ResultCollector rc Properties hashCache String basedirPath boolean dryRun throws IOException BadLocationException MojoFailureException MojoExecutionException Log log getLog
result Result SKIPPED else formattedCode this htmlFormatter formatFile file originalCode this lineEnding else if file getName endsWith xmlFormatter isInitialized if skipXmlFormatting getLog info result Result SKIPPED else formattedCode this xmlFormatter formatFile file originalCode this lineEnding else if file getName endsWith jsonFormatter isInitialized if skipJsonFormatting getLog info result Result SKIPPED else formattedCode this jsonFormatter formatFile file originalCode this lineEnding
Override public boolean process final Exchange exchange final AsyncCallback callback executor submit new Callable Object public Object call throws Exception LOG info getEndpoint getDelay Thread sleep getEndpoint getDelay int count counter incrementAndGet if getEndpoint getFailFirstAttempts count
Test void testDocumentation throws Exception try CamelContext context new DefaultCamelContext String json context adapt CatalogCamelContext class getEipParameterJsonSchema
Test void testSplitDocumentation throws Exception try CamelContext context new DefaultCamelContext String json context adapt CatalogCamelContext class getEipParameterJsonSchema
Test void testSimpleDocumentation throws Exception try CamelContext context new DefaultCamelContext String json context adapt CatalogCamelContext class getEipParameterJsonSchema
Test void testFailOverDocumentation throws Exception try CamelContext context new DefaultCamelContext String json context adapt CatalogCamelContext class getEipParameterJsonSchema
Test void testLanguageJsonSchema throws Exception try CamelContext context new DefaultCamelContext String json context adapt CatalogCamelContext class getLanguageParameterJsonSchema assertNotNull json
Test void testLanguageJsonSchema throws Exception try CamelContext context new DefaultCamelContext String json context adapt CatalogCamelContext class getLanguageParameterJsonSchema assertNotNull json
Test void testDataFormatJsonSchema throws Exception try CamelContext context new DefaultCamelContext String json context adapt CatalogCamelContext class getDataFormatParameterJsonSchema assertNotNull json
Override public void process Exchange exchange List String params new ArrayList params add exchange getIn getBody String class exchange getMessage setBody params String operation String exchange getIn getHeader CxfConstants OPERATION_NAME
private void sendAndVerifyMessages String endpointUri throws Exception resultEndpoint expectedBodiesReceived sendBodyAndHeader endpointUri 4L sendBodyAndHeader endpointUri 1L sendBodyAndHeader endpointUri 3L sendBodyAndHeader endpointUri 2L sendBodyAndHeader endpointUri 6L sendBodyAndHeader endpointUri 5L resultEndpoint assertIsSatisfied List Exchange list resultEndpoint getReceivedExchanges for Exchange exchange list
Disabled Test void testConcurrent throws Exception int size ExecutorService executor Executors newFixedThreadPool Map Integer Future String responses new HashMap for int i i size i final int index i Future String out executor submit new Callable String public String call throws Exception String reply template requestBody port index String class
public String greetMe String me LOG info LOG info
public void greetMeOneWay String me LOG info LOG info
public void pingMe String messageIn throws PingMeFault FaultDetail faultDetail new FaultDetail faultDetail setMajor short faultDetail setMinor short
final String argTypes typeArgs split final int nTypes argTypes length int i for String argType argTypes if argType charAt argType argType substring if equals argType parameterizedType append else if equals argType parameterizedType append else try parameterizedType append getCanonicalName getProjectClassLoader loadClass argType catch ClassNotFoundException e try
Override public List SignatureModel getSignatureList throws MojoExecutionException Map String SignatureModel result new LinkedHashMap final Pattern packagePatterns Pattern compile excludePackages final Pattern classPatterns excludeClasses null Pattern compile excludeClasses null final Pattern includeMethodPatterns includeMethods null Pattern compile includeMethods null final Pattern excludeMethodPatterns excludeMethods null Pattern compile excludeMethods null for Class aClass getProxyType aClass null packagePatterns matcher aClass getPackage getName matches classPatterns null classPatterns matcher aClass getSimpleName matches aClass aClass getSuperclass
Map String SignatureModel result new LinkedHashMap final Pattern packagePatterns Pattern compile excludePackages final Pattern classPatterns excludeClasses null Pattern compile excludeClasses null final Pattern includeMethodPatterns includeMethods null Pattern compile includeMethods null final Pattern excludeMethodPatterns excludeMethods null Pattern compile excludeMethods null for Class aClass getProxyType aClass null packagePatterns matcher aClass getPackage getName matches classPatterns null classPatterns matcher aClass getSimpleName matches aClass aClass getSuperclass log debug aClass getName String sourcePath aClass getName int pos sourcePath indexOf if pos sourcePath sourcePath substring pos sourcePath sourcePath replace log debug sourcePath try InputStream inputStream getProjectClassLoader getResourceAsStream sourcePath if inputStream null
Override public List SignatureModel getSignatureList throws MojoExecutionException Map String SignatureModel result new LinkedHashMap final Pattern packagePatterns Pattern compile excludePackages final Pattern classPatterns excludeClasses null Pattern compile excludeClasses null final Pattern includeMethodPatterns includeMethods null Pattern compile includeMethods null final Pattern excludeMethodPatterns excludeMethods null Pattern compile excludeMethods null for Class aClass getProxyType aClass null packagePatterns matcher aClass getPackage getName matches classPatterns null classPatterns matcher aClass getSimpleName matches aClass aClass getSuperclass
Override public List SignatureModel getSignatureList throws MojoExecutionException Map String SignatureModel result new LinkedHashMap final Pattern packagePatterns Pattern compile excludePackages final Pattern classPatterns excludeClasses null Pattern compile excludeClasses null final Pattern includeMethodPatterns includeMethods null Pattern compile includeMethods null final Pattern excludeMethodPatterns excludeMethods null Pattern compile excludeMethods null for Class aClass getProxyType aClass null packagePatterns matcher aClass getPackage getName matches classPatterns null classPatterns matcher aClass getSimpleName matches aClass aClass getSuperclass log debug aClass getName final String javaDocPath aClass getName replace replace try InputStream inputStream getProjectClassLoader getResourceAsStream javaDocPath if inputStream null
model setArtifactId artifactId if description null model getDescription null model setDescription description if model getGroupId null model getArtifactId null model getVersion null models add model Collections sort models o1 o2 o1 getArtifactId compareToIgnoreCase o2 getArtifactId log info models size if models isEmpty outDir mkdirs File out new File outDir FileOutputStream fos new FileOutputStream out false String top fos write top getBytes for ArchetypeModel model models fos write getBytes
f new File f if f exists f isDirectory File files f listFiles if files null for File file files if file isDirectory continue String name file getName if name charAt count if buffer length buffer append buffer append name if count String names Stream of buffer toString split sorted collect Collectors joining
if core null for Map Entry String String entry javaTypes entrySet String name entry getKey String javaType entry getValue String modelName asModelName name String json PackageHelper loadText new File core modelName PackageHelper JSON_SUFIX Class clazz loadClass javaType Metadata metadata clazz getAnnotation Metadata class String included String excluded if metadata null included metadata includeProperties excluded metadata excludeProperties DataFormatModel dataFormatModel extractDataFormatModel project json name clazz included excluded if log isDebugEnabled
log debug schema Path out schemaOutDir toPath resolve schemaSubDirectory dataFormatModel getJavaType resolve name PackageHelper JSON_SUFIX updateResource schemaOutDir toPath schemaSubDirectory dataFormatModel getJavaType name PackageHelper JSON_SUFIX schema if log isDebugEnabled log debug out name String cn javaType substring javaType lastIndexOf String pn javaType substring javaType length cn length Set String names dataFormatModel getOptions stream map DataFormatOptionModel :: getName collect Collectors toSet List DataFormatOptionModel options parseConfigurationSource project javaType options removeIf o names contains o getName names removeAll options stream map DataFormatOptionModel :: getName collect Collectors toList names removeAll Arrays asList if names isEmpty log warn String join names updateResource configurerSourceOutDir toPath pn replace cn generatePropertyConfigurer pn cn cn options
boolean apacheCamel equals project getGroupId try if apacheCamel count File core PackageHelper findCamelCoreDirectory project getBasedir if core null for Map Entry String String entry javaTypes entrySet String name entry getKey Class javaType loadClass entry getValue String modelName asModelName name String json PackageHelper loadText new File core modelName PackageHelper JSON_SUFIX LanguageModel languageModel extractLanguageModel project json name javaType if log isDebugEnabled log debug languageModel String schema JsonMapper createParameterJsonSchema languageModel if log isDebugEnabled
model setArtifactId project getArtifactId model setVersion project getVersion model setDescription project getDescription model setDeprecated project getName null project getName contains model setDeprecatedSince project getProperties getProperty model setFirstVersion project getProperties getProperty model setLabel project getProperties getProperty String title project getProperties getProperty if title null title Strings camelDashToTitle name model setTitle title String level project getProperties getProperty if level null model setSupportLevel SupportLevel safeValueOf level else
model setFirstVersion project getProperties getProperty model setLabel project getProperties getProperty String title project getProperties getProperty if title null title Strings camelDashToTitle name model setTitle title String level project getProperties getProperty if level null model setSupportLevel SupportLevel safeValueOf level else model setSupportLevel SupportLevelHelper defaultSupportLevel model getFirstVersion model getVersion if log isDebugEnabled log debug model String schema JsonMapper createJsonSchema model String fileName name PackageHelper JSON_SUFIX
model setTitle title String level project getProperties getProperty if level null model setSupportLevel SupportLevel safeValueOf level else model setSupportLevel SupportLevelHelper defaultSupportLevel model getFirstVersion model getVersion if log isDebugEnabled log debug model String schema JsonMapper createJsonSchema model String fileName name PackageHelper JSON_SUFIX updateResource schemaOutDir toPath fileName schema if log isDebugEnabled log debug fileName name catch Exception e throw new MojoExecutionException e e
