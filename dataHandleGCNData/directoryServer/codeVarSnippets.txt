try LOG debug I18n msg I18n MSG_13411_NEXT_CALLED nextTuple firstFetchedTuple fastReadLines try firstFetchedTuple parseDnAlone catch LdapLdifException ne error ne throw new NoSuchElementException ne getMessage catch LdapException le throw new NoSuchElementException le getMessage LOG debug nextTuple return null catch LdapLdifException ne ne printStackTrace
return Set DnTuple sortedDnSet null try long sortT0 System currentTimeMillis System out println sortedDnSet getDnTuples long sortT1 System currentTimeMillis totalEntries sortedDnSet size System out println totalEntries sortT1 sortT0 catch Exception e e printStackTrace LOG warn e return if sortedDnSet null sortedDnSet isEmpty String message
String componentName componentFactory getName if componentName contains componentName componentName substring componentName lastIndexOf String schemaDn ADSConstants ADS_USER_COMPONENTS_SCHEMA_DN String attribsDn schemaDn String ocsDn schemaDn List String ocAttribs new ArrayList String try String componentBaseOID ComponentOIDGenerator generateComponentOID for PropertyDescription prop componentFactory getComponentDescription getProperties String propname prop getName String proptype prop getType String propoid ComponentOIDGenerator generateAttribOID componentBaseOID String propdn propoid attribsDn if proptype equals proptype equals proptype equals
public static DirectoryService createDS CreateDS dsBuilder throws Exception if LOG isDebugEnabled
dauth setDelegateSslTrustManagerFQCN createAuthenticator delegateSslTrustManagerFQCN dauth setDelegateTlsTrustManagerFQCN createAuthenticator delegateTlsTrustManagerFQCN authenticators add auth authenticationInterceptor setAuthenticators authenticators authenticationInterceptor init service service setInterceptors interceptorList SchemaManager schemaManager service getSchemaManager for LoadSchema loadedSchema dsBuilder loadedSchemas String schemaName loadedSchema name Boolean enabled loadedSchema enabled boolean isLoaded schemaManager isSchemaLoaded schemaName if isLoaded try isLoaded schemaManager load schemaName catch LdapUnwillingToPerformException lutpe
authenticationInterceptor setAuthenticators authenticators authenticationInterceptor init service service setInterceptors interceptorList SchemaManager schemaManager service getSchemaManager for LoadSchema loadedSchema dsBuilder loadedSchemas String schemaName loadedSchema name Boolean enabled loadedSchema enabled boolean isLoaded schemaManager isSchemaLoaded schemaName if isLoaded try isLoaded schemaManager load schemaName catch LdapUnwillingToPerformException lutpe LOG error lutpe getMessage continue if isLoaded
authenticationInterceptor init service service setInterceptors interceptorList SchemaManager schemaManager service getSchemaManager for LoadSchema loadedSchema dsBuilder loadedSchemas String schemaName loadedSchema name Boolean enabled loadedSchema enabled boolean isLoaded schemaManager isSchemaLoaded schemaName if isLoaded try isLoaded schemaManager load schemaName catch LdapUnwillingToPerformException lutpe LOG error lutpe getMessage continue if isLoaded if enabled
injectLdifFiles applyLdifFiles clazz service applyLdifFiles value ApplyLdifs applyLdifs desc getAnnotation ApplyLdifs class if applyLdifs null applyLdifs value null String ldifs applyLdifs value StringBuilder sb new StringBuilder for int i i ldifs length String str ldifs i trim if isDn str sb append str append while i ldifs length str ldifs i if isDn str sb append str append else break
public void verifyInstallation LOG debug for File requiredDirectory requiredDirectories if requiredDirectory exists String message requiredDirectory
LOG error message throw new IllegalStateException message if requiredDirectory isFile String message requiredDirectory LOG error message throw new IllegalStateException message if requiredDirectory canWrite String message requiredDirectory System getProperty LOG error message throw new IllegalStateException message LOG debug LOG debug for File requiredFile requiredFiles if requiredFile exists String message requiredFile
String message requiredDirectory LOG error message throw new IllegalStateException message if requiredDirectory canWrite String message requiredDirectory System getProperty LOG error message throw new IllegalStateException message LOG debug LOG debug for File requiredFile requiredFiles if requiredFile exists String message requiredFile LOG error message throw new IllegalStateException message if requiredFile isDirectory
if requiredDirectory canWrite String message requiredDirectory System getProperty LOG error message throw new IllegalStateException message LOG debug LOG debug for File requiredFile requiredFiles if requiredFile exists String message requiredFile LOG error message throw new IllegalStateException message if requiredFile isDirectory String message requiredFile LOG error message throw new IllegalStateException message
Override public AddResponse add AddRequest addRequest throws LdapException if addRequest null String msg
Override public void add Entry entry throws LdapException if entry null String msg
Override public CompareResponse compare CompareRequest compareRequest throws LdapException if compareRequest null String msg
Override public DeleteResponse delete DeleteRequest deleteRequest throws LdapException if deleteRequest null String msg
Override public ModifyResponse modify ModifyRequest modRequest throws LdapException if modRequest null String msg
Override public ModifyDnResponse modifyDn ModifyDnRequest modDnRequest throws LdapException if modDnRequest null String msg
Override public void move Dn entryDn Dn newSuperiorDn throws LdapException if entryDn null String msg
Override public void move String entryDn String newSuperiorDn throws LdapException if entryDn null String msg
Override public void rename Dn entryDn Rdn newRdn boolean deleteOldRdn throws LdapException if entryDn null String msg
Override public void rename String entryDn String newRdn throws LdapException if entryDn null String msg
Override public SearchCursor search SearchRequest searchRequest throws LdapException if searchRequest null String msg
Override public ExtendedResponse extended ExtendedRequest extendedRequest throws LdapException if extendedRequest null String msg
Override public BindResponse bind BindRequest bindRequest throws LdapException if bindRequest null String msg
Override public void add Entry entry throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants ATTRIBUTE_TYPE checkOidIsUnique entry String schemaName getSchemaName dn AttributeType attributeType factory getAttributeType schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName if schema isEnabled attributeType isEnabled if schemaManager add attributeType
Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants ATTRIBUTE_TYPE checkOidIsUnique entry String schemaName getSchemaName dn AttributeType attributeType factory getAttributeType schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName if schema isEnabled attributeType isEnabled if schemaManager add attributeType LOG debug dn getName schemaName else String msg I18n err I18n ERR_345 entry getDn getName Strings listToString schemaManager getErrors LOG info msg throw new LdapUnwillingToPerformException ResultCodeEnum UNWILLING_TO_PERFORM msg else
Override public void delete Entry entry boolean cascade throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants ATTRIBUTE_TYPE String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled
Override public void delete Entry entry boolean cascade throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants ATTRIBUTE_TYPE String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled LOG debug dn getName schemaName return AttributeType attributeType AttributeType checkOidExists entry if schema isEnabled attributeType isEnabled if schemaManager delete attributeType LOG debug attributeType schemaName else String msg I18n err I18n ERR_346 entry getDn getName Strings listToString schemaManager getErrors
checkParent parentDn schemaManager SchemaConstants ATTRIBUTE_TYPE String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled LOG debug dn getName schemaName return AttributeType attributeType AttributeType checkOidExists entry if schema isEnabled attributeType isEnabled if schemaManager delete attributeType LOG debug attributeType schemaName else String msg I18n err I18n ERR_346 entry getDn getName Strings listToString schemaManager getErrors LOG info msg throw new LdapUnwillingToPerformException ResultCodeEnum UNWILLING_TO_PERFORM msg else
Override public void add Entry entry throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants COMPARATOR checkOidIsUniqueForComparator entry String schemaName getSchemaName dn LdapComparator comparator factory getLdapComparator schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName if schema isEnabled comparator isEnabled if schemaManager add comparator
Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants COMPARATOR checkOidIsUniqueForComparator entry String schemaName getSchemaName dn LdapComparator comparator factory getLdapComparator schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName if schema isEnabled comparator isEnabled if schemaManager add comparator LOG debug dn getName schemaName else String msg I18n err I18n ERR_350 entry getDn getName Strings listToString schemaManager getErrors LOG info msg throw new LdapUnwillingToPerformException ResultCodeEnum UNWILLING_TO_PERFORM msg else
Override public void delete Entry entry boolean cascade throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants COMPARATOR String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled
String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled LOG debug dn getName schemaName return LdapComparator comparator null try comparator checkComparatorOidExists entry catch LdapSchemaViolationException lsve comparator factory getLdapComparator schemaManager entry schemaManager getRegistries schemaName if schemaManager getRegistries contains comparator schemaManager getRegistries dissociateFromSchema comparator return else String msg I18n err I18n ERR_351 entry getDn getName
LdapComparator comparator null try comparator checkComparatorOidExists entry catch LdapSchemaViolationException lsve comparator factory getLdapComparator schemaManager entry schemaManager getRegistries schemaName if schemaManager getRegistries contains comparator schemaManager getRegistries dissociateFromSchema comparator return else String msg I18n err I18n ERR_351 entry getDn getName LOG info msg throw new LdapSchemaViolationException ResultCodeEnum UNWILLING_TO_PERFORM msg List Throwable errors new ArrayList if schema isEnabled comparator isEnabled if schemaManager delete comparator
comparator checkComparatorOidExists entry catch LdapSchemaViolationException lsve comparator factory getLdapComparator schemaManager entry schemaManager getRegistries schemaName if schemaManager getRegistries contains comparator schemaManager getRegistries dissociateFromSchema comparator return else String msg I18n err I18n ERR_351 entry getDn getName LOG info msg throw new LdapSchemaViolationException ResultCodeEnum UNWILLING_TO_PERFORM msg List Throwable errors new ArrayList if schema isEnabled comparator isEnabled if schemaManager delete comparator LOG debug dn getName schemaName else
comparator factory getLdapComparator schemaManager entry schemaManager getRegistries schemaName if schemaManager getRegistries contains comparator schemaManager getRegistries dissociateFromSchema comparator return else String msg I18n err I18n ERR_351 entry getDn getName LOG info msg throw new LdapSchemaViolationException ResultCodeEnum UNWILLING_TO_PERFORM msg List Throwable errors new ArrayList if schema isEnabled comparator isEnabled if schemaManager delete comparator LOG debug dn getName schemaName else String msg I18n err I18n ERR_352 entry getDn getName Strings listToString errors LOG info msg
Override public void add Entry entry throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants MATCHING_RULE checkOidIsUnique entry String schemaName getSchemaName dn MatchingRule matchingRule factory getMatchingRule schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName if schema isEnabled matchingRule isEnabled if schemaManager add matchingRule
Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants MATCHING_RULE checkOidIsUnique entry String schemaName getSchemaName dn MatchingRule matchingRule factory getMatchingRule schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName if schema isEnabled matchingRule isEnabled if schemaManager add matchingRule LOG debug dn getName schemaName else String msg I18n err I18n ERR_360 entry getDn getName Strings listToString schemaManager getErrors LOG info msg throw new LdapUnwillingToPerformException ResultCodeEnum UNWILLING_TO_PERFORM msg else
Override public void delete Entry entry boolean cascade throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants MATCHING_RULE String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled
Override public void delete Entry entry boolean cascade throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants MATCHING_RULE String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled LOG debug dn getName schemaName return MatchingRule matchingRule MatchingRule checkOidExists entry if schema isEnabled matchingRule isEnabled if schemaManager delete matchingRule LOG debug matchingRule schemaName else String msg I18n err I18n ERR_360 entry getDn getName Strings listToString schemaManager getErrors
checkParent parentDn schemaManager SchemaConstants MATCHING_RULE String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled LOG debug dn getName schemaName return MatchingRule matchingRule MatchingRule checkOidExists entry if schema isEnabled matchingRule isEnabled if schemaManager delete matchingRule LOG debug matchingRule schemaName else String msg I18n err I18n ERR_360 entry getDn getName Strings listToString schemaManager getErrors LOG info msg throw new LdapUnwillingToPerformException ResultCodeEnum UNWILLING_TO_PERFORM msg else
Override public void add Entry entry throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants NORMALIZER checkOidIsUniqueForNormalizer entry String schemaName getSchemaName dn Normalizer normalizer factory getNormalizer schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName List Throwable errors new ArrayList if schema isEnabled normalizer isEnabled if schemaManager add normalizer
Override public void delete Entry entry boolean cascade throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants NORMALIZER String schemaName getSchemaName entry getDn Normalizer normalizer factory getNormalizer schemaManager entry schemaManager getRegistries schemaName String oid normalizer getOid if isSchemaEnabled schemaName if schemaManager getRegistries isReferenced normalizer String msg I18n err I18n ERR_366 entry getDn getName getReferenced normalizer LOG warn msg throw new LdapUnwillingToPerformException ResultCodeEnum UNWILLING_TO_PERFORM msg deleteFromSchema normalizer schemaName if schemaManager getNormalizerRegistry contains oid schemaManager unregisterNormalizer oid
Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants NORMALIZER String schemaName getSchemaName entry getDn Normalizer normalizer factory getNormalizer schemaManager entry schemaManager getRegistries schemaName String oid normalizer getOid if isSchemaEnabled schemaName if schemaManager getRegistries isReferenced normalizer String msg I18n err I18n ERR_366 entry getDn getName getReferenced normalizer LOG warn msg throw new LdapUnwillingToPerformException ResultCodeEnum UNWILLING_TO_PERFORM msg deleteFromSchema normalizer schemaName if schemaManager getNormalizerRegistry contains oid schemaManager unregisterNormalizer oid LOG debug normalizer schemaName else
Override public void add Entry entry throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants OBJECT_CLASS checkOidIsUnique entry String schemaName getSchemaName dn ObjectClass objectClass factory getObjectClass schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName if schema isEnabled objectClass isEnabled if schemaManager add objectClass
Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants OBJECT_CLASS checkOidIsUnique entry String schemaName getSchemaName dn ObjectClass objectClass factory getObjectClass schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName if schema isEnabled objectClass isEnabled if schemaManager add objectClass LOG debug dn getName schemaName else String msg I18n err I18n ERR_373 entry getDn getName Strings listToString schemaManager getErrors LOG info msg throw new LdapUnwillingToPerformException ResultCodeEnum UNWILLING_TO_PERFORM msg else
Override public void delete Entry entry boolean cascade throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants OBJECT_CLASS String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled
Override public void delete Entry entry boolean cascade throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants OBJECT_CLASS String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled LOG debug dn getName schemaName return ObjectClass objectClass ObjectClass checkOidExists entry if schema isEnabled objectClass isEnabled if schemaManager delete objectClass LOG debug objectClass schemaName else String msg I18n err I18n ERR_374 entry getDn getName Strings listToString schemaManager getErrors
checkParent parentDn schemaManager SchemaConstants OBJECT_CLASS String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled LOG debug dn getName schemaName return ObjectClass objectClass ObjectClass checkOidExists entry if schema isEnabled objectClass isEnabled if schemaManager delete objectClass LOG debug objectClass schemaName else String msg I18n err I18n ERR_374 entry getDn getName Strings listToString schemaManager getErrors LOG info msg throw new LdapUnwillingToPerformException ResultCodeEnum UNWILLING_TO_PERFORM msg else
Attribute oc addContext getEntry get objectClassAT for Value value oc String oid schemaManager getObjectClassRegistry getOidByName value getString if objectClass2synchronizerMap containsKey oid RegistrySynchronizer synchronizer objectClass2synchronizerMap get oid Entry entry addContext getEntry synchronizer add entry return if oc contains MetaSchemaConstants META_SCHEMA_OC Entry entry addContext getEntry schemaSynchronizer add entry return if oc contains SchemaConstants ORGANIZATIONAL_UNIT_OC if addContext getDn size String msg I18n err I18n ERR_81
synchronizer add entry return if oc contains MetaSchemaConstants META_SCHEMA_OC Entry entry addContext getEntry schemaSynchronizer add entry return if oc contains SchemaConstants ORGANIZATIONAL_UNIT_OC if addContext getDn size String msg I18n err I18n ERR_81 LOG error msg throw new LdapInvalidDnException ResultCodeEnum NAMING_VIOLATION msg String ouValue addContext getDn getRdn getValue ouValue Strings toLowerCaseAscii Strings trim ouValue if VALID_OU_VALUES contains ouValue String msg I18n err I18n ERR_82 VALID_OU_VALUES
if oc contains MetaSchemaConstants META_SCHEMA_OC Entry entry addContext getEntry schemaSynchronizer add entry return if oc contains SchemaConstants ORGANIZATIONAL_UNIT_OC if addContext getDn size String msg I18n err I18n ERR_81 LOG error msg throw new LdapInvalidDnException ResultCodeEnum NAMING_VIOLATION msg String ouValue addContext getDn getRdn getValue ouValue Strings toLowerCaseAscii Strings trim ouValue if VALID_OU_VALUES contains ouValue String msg I18n err I18n ERR_82 VALID_OU_VALUES LOG error msg throw new LdapInvalidDnException ResultCodeEnum NAMING_VIOLATION msg
private boolean disableSchema String schemaName throws LdapException Schema schema schemaManager getLoadedSchema schemaName if schema null String msg I18n err I18n ERR_85 schemaName
Override public void add Entry entry throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants SYNTAX_CHECKER checkOidIsUniqueForSyntaxChecker entry String schemaName getSchemaName dn SyntaxChecker syntaxChecker factory getSyntaxChecker schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName if schema isEnabled syntaxChecker isEnabled if schemaManager add syntaxChecker
Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants SYNTAX_CHECKER checkOidIsUniqueForSyntaxChecker entry String schemaName getSchemaName dn SyntaxChecker syntaxChecker factory getSyntaxChecker schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName if schema isEnabled syntaxChecker isEnabled if schemaManager add syntaxChecker LOG debug dn getName schemaName else String msg I18n err I18n ERR_386 entry getDn getName Strings listToString schemaManager getErrors LOG info msg throw new LdapUnwillingToPerformException ResultCodeEnum UNWILLING_TO_PERFORM msg else
Override public void delete Entry entry boolean cascade throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants SYNTAX_CHECKER String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled
String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled LOG debug dn getName schemaName return SyntaxChecker syntaxChecker null try syntaxChecker checkSyntaxCheckerOidExists entry catch LdapSchemaViolationException lsve syntaxChecker factory getSyntaxChecker schemaManager entry schemaManager getRegistries schemaName if schemaManager getRegistries contains syntaxChecker schemaManager getRegistries dissociateFromSchema syntaxChecker return else String msg I18n err I18n ERR_387 entry getDn getName
return SyntaxChecker syntaxChecker null try syntaxChecker checkSyntaxCheckerOidExists entry catch LdapSchemaViolationException lsve syntaxChecker factory getSyntaxChecker schemaManager entry schemaManager getRegistries schemaName if schemaManager getRegistries contains syntaxChecker schemaManager getRegistries dissociateFromSchema syntaxChecker return else String msg I18n err I18n ERR_387 entry getDn getName LOG info msg throw new LdapSchemaViolationException ResultCodeEnum UNWILLING_TO_PERFORM msg if schema isEnabled syntaxChecker isEnabled if schemaManager delete syntaxChecker
try syntaxChecker checkSyntaxCheckerOidExists entry catch LdapSchemaViolationException lsve syntaxChecker factory getSyntaxChecker schemaManager entry schemaManager getRegistries schemaName if schemaManager getRegistries contains syntaxChecker schemaManager getRegistries dissociateFromSchema syntaxChecker return else String msg I18n err I18n ERR_387 entry getDn getName LOG info msg throw new LdapSchemaViolationException ResultCodeEnum UNWILLING_TO_PERFORM msg if schema isEnabled syntaxChecker isEnabled if schemaManager delete syntaxChecker LOG debug dn getName schemaName else
catch LdapSchemaViolationException lsve syntaxChecker factory getSyntaxChecker schemaManager entry schemaManager getRegistries schemaName if schemaManager getRegistries contains syntaxChecker schemaManager getRegistries dissociateFromSchema syntaxChecker return else String msg I18n err I18n ERR_387 entry getDn getName LOG info msg throw new LdapSchemaViolationException ResultCodeEnum UNWILLING_TO_PERFORM msg if schema isEnabled syntaxChecker isEnabled if schemaManager delete syntaxChecker LOG debug dn getName schemaName else String msg I18n err I18n ERR_386 entry getDn getName Strings listToString schemaManager getErrors LOG info msg
Override public void add Entry entry throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants SYNTAX checkOidIsUnique entry String schemaName getSchemaName dn LdapSyntax syntax factory getSyntax schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName if schema isEnabled syntax isEnabled if schemaManager add syntax
Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants SYNTAX checkOidIsUnique entry String schemaName getSchemaName dn LdapSyntax syntax factory getSyntax schemaManager entry schemaManager getRegistries schemaName Schema schema schemaManager getLoadedSchema schemaName if schema isEnabled syntax isEnabled if schemaManager add syntax LOG debug dn getName schemaName else String msg I18n err I18n ERR_399 entry getDn getName Strings listToString schemaManager getErrors LOG info msg throw new LdapUnwillingToPerformException ResultCodeEnum UNWILLING_TO_PERFORM msg else
Override public void delete Entry entry boolean cascade throws LdapException Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants SYNTAX String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled
Dn dn entry getDn Dn parentDn dn getParent checkParent parentDn schemaManager SchemaConstants SYNTAX String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled LOG debug dn getName schemaName return LdapSyntax syntax LdapSyntax checkOidExists entry List Throwable errors new ArrayList if schema isEnabled syntax isEnabled if schemaManager delete syntax LOG debug syntax schemaName else String msg I18n err I18n ERR_400 entry getDn getName Strings listToString errors
String schemaName getSchemaName entry getDn Schema schema schemaManager getLoadedSchema schemaName if schema isDisabled LOG debug dn getName schemaName return LdapSyntax syntax LdapSyntax checkOidExists entry List Throwable errors new ArrayList if schema isEnabled syntax isEnabled if schemaManager delete syntax LOG debug syntax schemaName else String msg I18n err I18n ERR_400 entry getDn getName Strings listToString errors LOG info msg throw new LdapUnwillingToPerformException ResultCodeEnum UNWILLING_TO_PERFORM msg else
private byte findClassInDIT List Dn searchContexts String name throws ClassNotFoundException LdapInvalidAttributeValueException BranchNode filter new AndNode AttributeType fqjcnAt directoryService getSchemaManager getAttributeType filter addNode new EqualityNode String fqjcnAt new Value fqjcnAt name filter addNode new EqualityNode String objectClassAT new Value objectClassAT ApacheSchemaConstants JAVA_CLASS_OC try for Dn base searchContexts Cursor Entry cursor null try cursor directoryService getAdminSession search base SearchScope SUBTREE filter AliasDerefMode DEREF_ALWAYS cursor beforeFirst if cursor next
Cursor Entry cursor null try cursor directoryService getAdminSession search base SearchScope SUBTREE filter AliasDerefMode DEREF_ALWAYS cursor beforeFirst if cursor next LOG debug name base Entry classEntry cursor get if cursor next Entry other cursor get LOG warn classEntry other return classEntry get getBytes finally if cursor null cursor close catch Exception e
try Entry configEntry null try configEntry directoryService getAdminSession lookup defaultSearchDn catch LdapException e LOG debug if configEntry null List Dn searchContexts new ArrayList Attribute attr configEntry get for Value val attr Dn dn directoryService getDnFactory create val getString searchContexts add dn try classBytes findClassInDIT searchContexts name if LOG isDebugEnabled
configEntry directoryService getAdminSession lookup defaultSearchDn catch LdapException e LOG debug if configEntry null List Dn searchContexts new ArrayList Attribute attr configEntry get for Value val attr Dn dn directoryService getDnFactory create val getString searchContexts add dn try classBytes findClassInDIT searchContexts name if LOG isDebugEnabled LOG debug name catch ClassNotFoundException e if LOG isDebugEnabled
if LOG isDebugEnabled LOG debug name catch ClassNotFoundException e if LOG isDebugEnabled LOG debug name if classBytes null List Dn namingContexts new ArrayList Set String suffixes directoryService getPartitionNexus listSuffixes for String suffix suffixes Dn suffixDn directoryService getDnFactory create suffix namingContexts add suffixDn classBytes findClassInDIT namingContexts name catch ClassNotFoundException e String msg I18n err I18n ERR_293 name LOG debug msg
Test public void testRemove ArrayTree Integer tree createTree tree insert tree insert tree insert
Test public void testRemove ArrayTree Integer tree createTree tree insert tree insert tree insert LOG debug getLinkedText tree tree remove
Test public void testRemove AvlTree Integer tree createTree tree insert tree insert tree insert
Test public void testRemove AvlTree Integer tree createTree tree insert tree insert tree insert LOG debug getLinkedText tree tree remove
Test public void testDIRSERVER_1118 throws Exception HashMap String Partition partitionMap new HashMap String Partition for Partition partition getService getPartitions
public void addLookupDelete String partitionSuffix throws Exception LdapContext rootDse getRootContext getService Attributes attrs new BasicAttributes true attrs put String entryDn partitionSuffix rootDse createSubcontext entryDn attrs
public void addLookupDelete String partitionSuffix throws Exception LdapContext rootDse getRootContext getService Attributes attrs new BasicAttributes true attrs put String entryDn partitionSuffix rootDse createSubcontext entryDn attrs LOG debug entryDn partitionSuffix Attributes reloaded rootDse getAttributes entryDn assertNotNull reloaded assertTrue reloaded get contains
LdapContext rootDse getRootContext getService Attributes attrs new BasicAttributes true attrs put String entryDn partitionSuffix rootDse createSubcontext entryDn attrs LOG debug entryDn partitionSuffix Attributes reloaded rootDse getAttributes entryDn assertNotNull reloaded assertTrue reloaded get contains LOG debug entryDn partitionSuffix rootDse destroySubcontext entryDn try rootDse getAttributes entryDn fail catch Exception e
public static void backupDeleted LdapContext ctx Name deletedEntryName Name operationPrincipal Attributes deletedEntry throws NamingException LOG info operationPrincipal deletedEntryName
private void deliverNamingExceptionEvent Exception e
Entry first null if unsortedEntries next first unsortedEntries get if unsortedEntries next unsortedEntries beforeFirst return unsortedEntries SortKey sk control getSortKeys get AttributeType at schemaManager getAttributeType sk getAttributeTypeDesc SortedEntryComparator comparator new SortedEntryComparator at sk getMatchingRuleId sk isReverseOrder schemaManager SortedEntrySerializer keySerializer new SortedEntrySerializer SortedEntrySerializer setSchemaManager schemaManager File file null try file Files createTempFile toFile catch IOException e
if dn trim length return Dn ROOT_DSE Dn cachedDn null if dnCache null cachedDn dnCache getIfPresent dn if cachedDn null LOG debug dn cachedDn new Dn schemaManager dn if dnCache null dnCache put dn cachedDn if enableStats missCount else if enableStats hitCount
return Dn ROOT_DSE Dn cachedDn null if dnCache null cachedDn dnCache getIfPresent dn if cachedDn null LOG debug dn cachedDn new Dn schemaManager dn if dnCache null dnCache put dn cachedDn if enableStats missCount else if enableStats hitCount LOG debug dn
Dn dn new Dn schemaManager dn readExternal in entry setDn dn int nbAttributes in readInt for int i i nbAttributes i String oid in readUTF try AttributeType attributeType schemaManager lookupAttributeTypeRegistry oid Attribute attribute new DefaultAttribute attributeType attribute readExternal in entry add attribute catch LdapException ne throw new ClassNotFoundException ne getMessage ne return entry catch ClassNotFoundException cnfe
public byte serialize Entry entry try ByteArrayOutputStream baos new ByteArrayOutputStream ObjectOutput out new ObjectOutputStream baos Dn dn entry getDn dn writeExternal out out writeInt entry getAttributes size for Attribute attribute entry getAttributes AttributeType attributeType attribute getAttributeType String oid attributeType getOid out writeUTF oid attribute writeExternal out out flush if IS_DEBUG LOG debug
Override public boolean hasEntry HasEntryOperationContext hasEntryContext throws LdapException Dn dn hasEntryContext getDn if IS_DEBUG
Override public synchronized void removeContextPartition String partitionDn throws LdapException Partition partition partitions get partitionDn if partition null String msg I18n err I18n ERR_34 partitionDn
LOG error msg throw new LdapNoSuchObjectException msg String partitionSuffix partition getSuffixDn getNormName Attribute namingContexts rootDse get SchemaConstants NAMING_CONTEXTS_AT if namingContexts null Value foundNC null for Value namingContext namingContexts String normalizedNC new Dn schemaManager namingContext getString getNormName if partitionSuffix equals normalizedNC foundNC namingContext break if foundNC null namingContexts remove foundNC else String msg I18n err I18n ERR_35 partitionDn
public void add AddOperationContext addContext throws LdapException if IS_DEBUG
public void bind BindOperationContext bindContext throws LdapException if IS_DEBUG
public boolean compare CompareOperationContext compareContext throws LdapException if IS_DEBUG
public void delete DeleteOperationContext deleteContext throws LdapException if IS_DEBUG
public Entry getRootDse GetRootDseOperationContext getRootDseContext throws LdapException if IS_DEBUG
public boolean hasEntry HasEntryOperationContext hasEntryContext throws LdapException if IS_DEBUG
public Entry lookup LookupOperationContext lookupContext throws LdapException if IS_DEBUG
public void modify ModifyOperationContext modifyContext throws LdapException if IS_DEBUG
public void move MoveOperationContext moveContext throws LdapException if IS_DEBUG
public void moveAndRename MoveAndRenameOperationContext moveAndRenameContext throws LdapException if IS_DEBUG
public void rename RenameOperationContext renameContext throws LdapException if IS_DEBUG
public EntryFilteringCursor search SearchOperationContext searchContext throws LdapException if IS_DEBUG
public void unbind UnbindOperationContext unbindContext throws LdapException if IS_DEBUG
Override public boolean engineContainsAlias String alias
Override public void engineDeleteEntry String alias throws KeyStoreException
Override public Certificate engineGetCertificate String alias
Override public String engineGetCertificateAlias Certificate cert
Override public Certificate engineGetCertificateChain String alias
Override public Certificate engineGetCertificateChain String alias LOG debug alias try Entry entry getTlsEntry
Override public Date engineGetCreationDate String alias
Override public Key engineGetKey String alias char password throws NoSuchAlgorithmException UnrecoverableKeyException
Override public boolean engineIsCertificateEntry String alias
Override public boolean engineIsKeyEntry String alias
Override public void engineLoad InputStream stream char password throws IOException NoSuchAlgorithmException CertificateException
Override public void engineSetCertificateEntry String alias Certificate cert throws KeyStoreException
Override public void engineSetKeyEntry String alias byte key Certificate chain throws KeyStoreException
Override public void engineSetKeyEntry String alias Key key char password Certificate chain throws KeyStoreException if LOG isDebugEnabled
else objectClass add TLS_KEY_INFO_OC SchemaConstants INET_ORG_PERSON_OC KeyPairGenerator generator null try generator KeyPairGenerator getInstance keyAlgo catch NoSuchAlgorithmException e LdapException ne new LdapException I18n err I18n ERR_291 ne initCause e throw ne generator initialize keySize KeyPair keypair generator genKeyPair entry put KEY_ALGORITHM_AT keyAlgo PrivateKey privateKey keypair getPrivate entry put PRIVATE_KEY_AT privateKey getEncoded entry put PRIVATE_KEY_FORMAT_AT privateKey getFormat
KeyPairGenerator generator null try generator KeyPairGenerator getInstance keyAlgo catch NoSuchAlgorithmException e LdapException ne new LdapException I18n err I18n ERR_291 ne initCause e throw ne generator initialize keySize KeyPair keypair generator genKeyPair entry put KEY_ALGORITHM_AT keyAlgo PrivateKey privateKey keypair getPrivate entry put PRIVATE_KEY_AT privateKey getEncoded entry put PRIVATE_KEY_FORMAT_AT privateKey getFormat LOG debug privateKey PublicKey publicKey keypair getPublic
Test public void testAll throws Exception Entry entry new DefaultEntry schemaManager new Dn schemaManager TlsKeyGenerator addKeyPair entry
public void start DirectoryService dirService throws Exception this dirService dirService XmlConfiguration jettyConf null if confFile null InputStream input Files newInputStream Paths get confFile jettyConf new XmlConfiguration input
log info archiveType if getTargetDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY getTargetDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage log info try createLayouts false MojoHelperUtils copyAsciiFile mojo filterProperties APACHE_BAT_FILE getClass getResourceAsStream APACHE_BAT_FILE new File getInstallationLayout getBinDirectory APACHE_BAT_FILE false MojoHelperUtils copyAsciiFile mojo filterProperties APACHE_SH_FILE getClass getResourceAsStream APACHE_SH_FILE new File getInstallationLayout getBinDirectory APACHE_SH_FILE false MojoHelperUtils copyAsciiFile mojo filterProperties CPAPPEND_BAT_FILE getClass getResourceAsStream CPAPPEND_BAT_FILE new File getInstallationLayout getBinDirectory CPAPPEND_BAT_FILE false FileUtils deleteDirectory getInstallationLayout getConfDirectory File wrapperConf new File getInstanceLayout getConfDirectory WRAPPER_INSTANCE_CONF_FILE if wrapperConf delete throw new IOException I18n err I18n ERR_113_COULD_NOT_DELETE_FILE_OR_DIRECTORY wrapperConf
case TAR_GZ File tarFile new File mojo getOutputDirectory target getId DOT_TAR createTarFile project tarFile GZip gzipTask new GZip gzipTask setProject project gzipTask setDestfile finalFile gzipTask setSrc tarFile gzipTask execute if tarFile delete Exception e new IOException I18n err I18n ERR_113_COULD_NOT_DELETE_FILE_OR_DIRECTORY tarFile log error e getLocalizedMessage throw new MojoFailureException e getMessage break case TAR_BZ2 tarFile new File mojo getOutputDirectory target getId DOT_TAR createTarFile project finalFile BZip2 bzip2Task new BZip2
gzipTask setDestfile finalFile gzipTask setSrc tarFile gzipTask execute if tarFile delete Exception e new IOException I18n err I18n ERR_113_COULD_NOT_DELETE_FILE_OR_DIRECTORY tarFile log error e getLocalizedMessage throw new MojoFailureException e getMessage break case TAR_BZ2 tarFile new File mojo getOutputDirectory target getId DOT_TAR createTarFile project finalFile BZip2 bzip2Task new BZip2 bzip2Task setProject project bzip2Task setDestfile finalFile bzip2Task setSrc tarFile bzip2Task execute
if tarFile delete Exception e new IOException I18n err I18n ERR_113_COULD_NOT_DELETE_FILE_OR_DIRECTORY tarFile log error e getLocalizedMessage throw new MojoFailureException e getMessage break case TAR_BZ2 tarFile new File mojo getOutputDirectory target getId DOT_TAR createTarFile project finalFile BZip2 bzip2Task new BZip2 bzip2Task setProject project bzip2Task setDestfile finalFile bzip2Task setSrc tarFile bzip2Task execute if tarFile delete Exception e new IOException I18n err I18n ERR_113_COULD_NOT_DELETE_FILE_OR_DIRECTORY tarFile log error e getLocalizedMessage
throw new MojoFailureException e getMessage log info try createInstallationLayout File instanceDirectory getInstanceDirectory if instanceDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY instanceDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLERS_PATH LOG4J_PROPERTIES_FILE getClass getResourceAsStream INSTALLERS_PATH LOG4J_PROPERTIES_FILE new File instanceDirectory LOG4J_PROPERTIES_FILE true MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLERS_PATH WRAPPER_INSTANCE_CONF_FILE getClass getResourceAsStream INSTALLERS_PATH WRAPPER_INSTANCE_CONF_FILE new File instanceDirectory WRAPPER_INSTANCE_CONF_FILE true MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLERS_PATH CONFIG_LDIF_FILE getClass getResourceAsStream INSTALLERS_PATH CONFIG_LDIF_FILE new File instanceDirectory CONFIG_LDIF_FILE false MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLERS_PATH ETC_INITD_SCRIPT getClass getResourceAsStream INSTALLERS_PATH ETC_INITD_SCRIPT new File instanceDirectory ETC_INITD_SCRIPT true File binShDirectory new File getBinInstallerDirectory if binShDirectory mkdirs
log error e getLocalizedMessage throw new MojoFailureException e getMessage MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLERS_PATH LOG4J_PROPERTIES_FILE getClass getResourceAsStream INSTALLERS_PATH LOG4J_PROPERTIES_FILE new File instanceDirectory LOG4J_PROPERTIES_FILE true MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLERS_PATH WRAPPER_INSTANCE_CONF_FILE getClass getResourceAsStream INSTALLERS_PATH WRAPPER_INSTANCE_CONF_FILE new File instanceDirectory WRAPPER_INSTANCE_CONF_FILE true MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLERS_PATH CONFIG_LDIF_FILE getClass getResourceAsStream INSTALLERS_PATH CONFIG_LDIF_FILE new File instanceDirectory CONFIG_LDIF_FILE false MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLERS_PATH ETC_INITD_SCRIPT getClass getResourceAsStream INSTALLERS_PATH ETC_INITD_SCRIPT new File instanceDirectory ETC_INITD_SCRIPT true File binShDirectory new File getBinInstallerDirectory if binShDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY binShDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage MojoHelperUtils copyAsciiFile mojo filterProperties getClass getResourceAsStream new File getBinInstallerDirectory true MojoHelperUtils copyAsciiFile mojo filterProperties getClass getResourceAsStream new File getBinInstallerDirectory true MojoHelperUtils copyAsciiFile mojo filterProperties getClass getResourceAsStream new File binShDirectory false MojoHelperUtils copyAsciiFile mojo filterProperties getClass getResourceAsStream new File binShDirectory false
log error e getLocalizedMessage throw new MojoFailureException e getMessage MojoHelperUtils copyAsciiFile mojo filterProperties getClass getResourceAsStream new File getBinInstallerDirectory true MojoHelperUtils copyAsciiFile mojo filterProperties getClass getResourceAsStream new File getBinInstallerDirectory true MojoHelperUtils copyAsciiFile mojo filterProperties getClass getResourceAsStream new File binShDirectory false MojoHelperUtils copyAsciiFile mojo filterProperties getClass getResourceAsStream new File binShDirectory false MojoHelperUtils copyAsciiFile mojo filterProperties getClass getResourceAsStream new File binShDirectory false catch Exception e log error e getMessage throw new MojoFailureException log info Execute createBinTask new Execute String cmd new String shUtility getAbsolutePath createBinTask setCommandline cmd createBinTask setWorkingDirectory getBinInstallerDirectory
if verifyTarget return log info File targetDirectory getTargetDirectory log info targetDirectory getAbsolutePath if getTargetDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY getTargetDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage log info try createLayouts File debEtcInitdDirectory new File getDebDirectory ETC_INITD if debEtcInitdDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY debEtcInitdDirectory
File targetDirectory getTargetDirectory log info targetDirectory getAbsolutePath if getTargetDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY getTargetDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage log info try createLayouts File debEtcInitdDirectory new File getDebDirectory ETC_INITD if debEtcInitdDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY debEtcInitdDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLERS_PATH ETC_INITD_SCRIPT getClass getResourceAsStream INSTALLERS_PATH ETC_INITD_SCRIPT new File debEtcInitdDirectory APACHEDS_DASH mojo getProject getVersion DASH_DEFAULT true
throw new MojoFailureException e getMessage log info try createLayouts File debEtcInitdDirectory new File getDebDirectory ETC_INITD if debEtcInitdDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY debEtcInitdDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLERS_PATH ETC_INITD_SCRIPT getClass getResourceAsStream INSTALLERS_PATH ETC_INITD_SCRIPT new File debEtcInitdDirectory APACHEDS_DASH mojo getProject getVersion DASH_DEFAULT true catch Exception e log error e getMessage throw new MojoFailureException File debDebianDirectory new File getDebDirectory DEBIAN_DIR if debDebianDirectory mkdirs
Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY debEtcInitdDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLERS_PATH ETC_INITD_SCRIPT getClass getResourceAsStream INSTALLERS_PATH ETC_INITD_SCRIPT new File debEtcInitdDirectory APACHEDS_DASH mojo getProject getVersion DASH_DEFAULT true catch Exception e log error e getMessage throw new MojoFailureException File debDebianDirectory new File getDebDirectory DEBIAN_DIR if debDebianDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY debDebianDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage try MojoHelperUtils copyAsciiFile mojo filterProperties CONTROL_FILE getClass getResourceAsStream CONTROL_FILE new File debDebianDirectory CONTROL_FILE true MojoHelperUtils copyAsciiFile mojo filterProperties POSTINST_FILE getClass getResourceAsStream POSTINST_FILE new File debDebianDirectory POSTINST_FILE true
throw new MojoFailureException e getMessage try MojoHelperUtils copyAsciiFile mojo filterProperties CONTROL_FILE getClass getResourceAsStream CONTROL_FILE new File debDebianDirectory CONTROL_FILE true MojoHelperUtils copyAsciiFile mojo filterProperties POSTINST_FILE getClass getResourceAsStream POSTINST_FILE new File debDebianDirectory POSTINST_FILE true MojoHelperUtils copyAsciiFile mojo filterProperties PRERM_FILE getClass getResourceAsStream PRERM_FILE new File debDebianDirectory PRERM_FILE true catch IOException e log error e getMessage throw new MojoFailureException MojoHelperUtils exec new String CHMOD RWX_RX_RX new File debDebianDirectory POSTINST_FILE toString debDebianDirectory false MojoHelperUtils exec new String CHMOD RWX_RX_RX new File debDebianDirectory PRERM_FILE toString debDebianDirectory false log info String finalName target getFinalName if finalName endsWith DOT_DEB_EXTENSION finalName finalName DOT_DEB_EXTENSION Execute createDebTask new Execute
MojoHelperUtils copyAsciiFile mojo filterProperties PRERM_FILE getClass getResourceAsStream PRERM_FILE new File debDebianDirectory PRERM_FILE true catch IOException e log error e getMessage throw new MojoFailureException MojoHelperUtils exec new String CHMOD RWX_RX_RX new File debDebianDirectory POSTINST_FILE toString debDebianDirectory false MojoHelperUtils exec new String CHMOD RWX_RX_RX new File debDebianDirectory PRERM_FILE toString debDebianDirectory false log info String finalName target getFinalName if finalName endsWith DOT_DEB_EXTENSION finalName finalName DOT_DEB_EXTENSION Execute createDebTask new Execute String cmd new String mojo getDpkgUtility getAbsolutePath getTargetDirectory getName getDebDirectory getName finalName StringBuilder antTask new StringBuilder for String command cmd antTask append command append
log info File targetDirectory getTargetDirectory if targetDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY targetDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage log info File pkgRootDirectory new File targetDirectory ROOT if pkgRootDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootUsrBinDirectory new File pkgRootDirectory USR_BIN if pkgRootUsrBinDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootUsrBinDirectory
log error e getLocalizedMessage throw new MojoFailureException e getMessage log info File pkgRootDirectory new File targetDirectory ROOT if pkgRootDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootUsrBinDirectory new File pkgRootDirectory USR_BIN if pkgRootUsrBinDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootUsrBinDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootUsrLocalApachedsDirectory new File pkgRootDirectory USR_LOCAL_APACHEDS mojo getProject getVersion if pkgRootUsrLocalApachedsDirectory mkdirs
if pkgRootDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootUsrBinDirectory new File pkgRootDirectory USR_BIN if pkgRootUsrBinDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootUsrBinDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootUsrLocalApachedsDirectory new File pkgRootDirectory USR_LOCAL_APACHEDS mojo getProject getVersion if pkgRootUsrLocalApachedsDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootUsrLocalApachedsDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDirectory new File pkgRootUsrLocalApachedsDirectory INSTANCES
File pkgRootUsrBinDirectory new File pkgRootDirectory USR_BIN if pkgRootUsrBinDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootUsrBinDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootUsrLocalApachedsDirectory new File pkgRootDirectory USR_LOCAL_APACHEDS mojo getProject getVersion if pkgRootUsrLocalApachedsDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootUsrLocalApachedsDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDirectory new File pkgRootUsrLocalApachedsDirectory INSTANCES if pkgRootInstancesDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage
File pkgRootUsrLocalApachedsDirectory new File pkgRootDirectory USR_LOCAL_APACHEDS mojo getProject getVersion if pkgRootUsrLocalApachedsDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootUsrLocalApachedsDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDirectory new File pkgRootUsrLocalApachedsDirectory INSTANCES if pkgRootInstancesDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultDirectory new File pkgRootInstancesDirectory DEFAULT if pkgRootInstancesDefaultDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage
throw new MojoFailureException e getMessage File pkgRootInstancesDirectory new File pkgRootUsrLocalApachedsDirectory INSTANCES if pkgRootInstancesDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultDirectory new File pkgRootInstancesDirectory DEFAULT if pkgRootInstancesDefaultDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultConfDirectory new File pkgRootInstancesDefaultDirectory InstanceLayout CONF_NAME if pkgRootInstancesDefaultConfDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultConfDirectory log error e getLocalizedMessage
log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultDirectory new File pkgRootInstancesDirectory DEFAULT if pkgRootInstancesDefaultDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultConfDirectory new File pkgRootInstancesDefaultDirectory InstanceLayout CONF_NAME if pkgRootInstancesDefaultConfDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultConfDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultDirectoryLog new File pkgRootInstancesDefaultDirectory InstanceLayout LOG_NAME if pkgRootInstancesDefaultDirectoryLog mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultDirectoryLog
Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultConfDirectory new File pkgRootInstancesDefaultDirectory InstanceLayout CONF_NAME if pkgRootInstancesDefaultConfDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultConfDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultDirectoryLog new File pkgRootInstancesDefaultDirectory InstanceLayout LOG_NAME if pkgRootInstancesDefaultDirectoryLog mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultDirectoryLog log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultDirectoryPartitions new File pkgRootInstancesDefaultDirectory InstanceLayout PARTITIONS_NAME if pkgRootInstancesDefaultDirectoryPartitions mkdirs
if pkgRootInstancesDefaultConfDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultConfDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultDirectoryLog new File pkgRootInstancesDefaultDirectory InstanceLayout LOG_NAME if pkgRootInstancesDefaultDirectoryLog mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultDirectoryLog log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultDirectoryPartitions new File pkgRootInstancesDefaultDirectory InstanceLayout PARTITIONS_NAME if pkgRootInstancesDefaultDirectoryPartitions mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultDirectoryPartitions log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultDirectoryRun new File pkgRootInstancesDefaultDirectory InstanceLayout RUN_NAME
throw new MojoFailureException e getMessage File pkgRootInstancesDefaultDirectoryPartitions new File pkgRootInstancesDefaultDirectory InstanceLayout PARTITIONS_NAME if pkgRootInstancesDefaultDirectoryPartitions mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultDirectoryPartitions log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultDirectoryRun new File pkgRootInstancesDefaultDirectory InstanceLayout RUN_NAME if pkgRootInstancesDefaultDirectoryRun mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultDirectoryRun log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootLibraryLaunchDaemons new File pkgRootDirectory LAUNCH_DAEMONS if pkgRootLibraryLaunchDaemons mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootLibraryLaunchDaemons log error e getLocalizedMessage
log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootInstancesDefaultDirectoryRun new File pkgRootInstancesDefaultDirectory InstanceLayout RUN_NAME if pkgRootInstancesDefaultDirectoryRun mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootInstancesDefaultDirectoryRun log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgRootLibraryLaunchDaemons new File pkgRootDirectory LAUNCH_DAEMONS if pkgRootLibraryLaunchDaemons mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootLibraryLaunchDaemons log error e getLocalizedMessage throw new MojoFailureException e getMessage try createLayouts MojoHelperUtils copyAsciiFile mojo filterProperties APACHEDS_USR_BIN_SH getClass getResourceAsStream APACHEDS_USR_BIN_SH new File pkgRootUsrBinDirectory APACHEDS true
File pkgRootLibraryLaunchDaemons new File pkgRootDirectory LAUNCH_DAEMONS if pkgRootLibraryLaunchDaemons mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgRootLibraryLaunchDaemons log error e getLocalizedMessage throw new MojoFailureException e getMessage try createLayouts MojoHelperUtils copyAsciiFile mojo filterProperties APACHEDS_USR_BIN_SH getClass getResourceAsStream APACHEDS_USR_BIN_SH new File pkgRootUsrBinDirectory APACHEDS true MojoHelperUtils copyAsciiFile mojo filterProperties ORG_APACHE_DIRECTORY_SERVER_PLIST getClass getResourceAsStream ORG_APACHE_DIRECTORY_SERVER_PLIST new File pkgRootLibraryLaunchDaemons ORG_APACHE_DIRECTORY_SERVER_PLIST true File pkgResourcesEnglishDirectory new File targetDirectory RESOURCES_EN_LPROJ if pkgResourcesEnglishDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgResourcesEnglishDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgScriptsDirectory new File targetDirectory SCRIPTS
MojoHelperUtils copyAsciiFile mojo filterProperties ORG_APACHE_DIRECTORY_SERVER_PLIST getClass getResourceAsStream ORG_APACHE_DIRECTORY_SERVER_PLIST new File pkgRootLibraryLaunchDaemons ORG_APACHE_DIRECTORY_SERVER_PLIST true File pkgResourcesEnglishDirectory new File targetDirectory RESOURCES_EN_LPROJ if pkgResourcesEnglishDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgResourcesEnglishDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage File pkgScriptsDirectory new File targetDirectory SCRIPTS if pkgScriptsDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgScriptsDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage MojoHelperUtils copyBinaryFile mojo PKG_BACKGROUND_TIFF getClass getResourceAsStream PKG_BACKGROUND_TIFF new File pkgResourcesEnglishDirectory BACKGROUND_TIFF MojoHelperUtils copyBinaryFile mojo LICENSE_RTF getClass getResourceAsStream LICENSE_RTF new File pkgResourcesEnglishDirectory LICENSE_RTF MojoHelperUtils copyBinaryFile mojo INFO_PLIST getClass getResourceAsStream INFO_PLIST new File targetDirectory INFO_PLIST MojoHelperUtils copyBinaryFile mojo PREFLIGHT getClass getResourceAsStream PREFLIGHT new File pkgScriptsDirectory PREFLIGHT
File pkgScriptsDirectory new File targetDirectory SCRIPTS if pkgScriptsDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY pkgScriptsDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage MojoHelperUtils copyBinaryFile mojo PKG_BACKGROUND_TIFF getClass getResourceAsStream PKG_BACKGROUND_TIFF new File pkgResourcesEnglishDirectory BACKGROUND_TIFF MojoHelperUtils copyBinaryFile mojo LICENSE_RTF getClass getResourceAsStream LICENSE_RTF new File pkgResourcesEnglishDirectory LICENSE_RTF MojoHelperUtils copyBinaryFile mojo INFO_PLIST getClass getResourceAsStream INFO_PLIST new File targetDirectory INFO_PLIST MojoHelperUtils copyBinaryFile mojo PREFLIGHT getClass getResourceAsStream PREFLIGHT new File pkgScriptsDirectory PREFLIGHT MojoHelperUtils copyBinaryFile mojo POSTFLIGHT getClass getResourceAsStream POSTFLIGHT new File pkgScriptsDirectory POSTFLIGHT catch Exception e log error e getMessage throw new MojoFailureException log info Execute createPkgTask new Execute
MojoHelperUtils copyBinaryFile mojo PKG_BACKGROUND_TIFF getClass getResourceAsStream PKG_BACKGROUND_TIFF new File pkgResourcesEnglishDirectory BACKGROUND_TIFF MojoHelperUtils copyBinaryFile mojo LICENSE_RTF getClass getResourceAsStream LICENSE_RTF new File pkgResourcesEnglishDirectory LICENSE_RTF MojoHelperUtils copyBinaryFile mojo INFO_PLIST getClass getResourceAsStream INFO_PLIST new File targetDirectory INFO_PLIST MojoHelperUtils copyBinaryFile mojo PREFLIGHT getClass getResourceAsStream PREFLIGHT new File pkgScriptsDirectory PREFLIGHT MojoHelperUtils copyBinaryFile mojo POSTFLIGHT getClass getResourceAsStream POSTFLIGHT new File pkgScriptsDirectory POSTFLIGHT catch Exception e log error e getMessage throw new MojoFailureException log info Execute createPkgTask new Execute String cmd new String mojo getPackageMakerUtility getAbsolutePath ROOT INFO_PLIST mojo getProject getVersion mojo getProject getVersion SCRIPTS createPkgTask setCommandline cmd createPkgTask setWorkingDirectory targetDirectory try createPkgTask execute
catch Exception e log error e getMessage throw new MojoFailureException log info Execute createPkgTask new Execute String cmd new String mojo getPackageMakerUtility getAbsolutePath ROOT INFO_PLIST mojo getProject getVersion mojo getProject getVersion SCRIPTS createPkgTask setCommandline cmd createPkgTask setWorkingDirectory targetDirectory try createPkgTask execute catch IOException e log error e getMessage throw new MojoFailureException e getMessage log info File dmgDirectory new File mojo getOutputDirectory target getId DASH_DMG
log info File dmgDirectory new File mojo getOutputDirectory target getId DASH_DMG if dmgDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY dmgDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage log info File dmgDmgBackgroundDirectory new File dmgDirectory DMG_DOT_BACKGROUND if dmgDmgBackgroundDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY dmgDmgBackgroundDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage try MojoHelperUtils copyBinaryFile mojo getClass getResourceAsStream new File dmgDirectory MojoHelperUtils copyBinaryFile mojo getClass getResourceAsStream new File dmgDirectory
File targetDirectory getTargetDirectory if targetDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY targetDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage log info File installerFile new File targetDirectory INSTALLER_NSI try createLayouts MojoHelperUtils copyBinaryFile mojo MANAGE_APACHEDS_EXE getClass getResourceAsStream MANAGE_APACHEDS_EXE new File getInstallationDirectory MANAGE_APACHEDS_EXE MojoHelperUtils copyBinaryFile mojo HEADER_BMP getClass getResourceAsStream HEADER_BMP new File targetDirectory HEADER_BMP MojoHelperUtils copyBinaryFile mojo WELCOME_BMP getClass getResourceAsStream WELCOME_BMP new File targetDirectory WELCOME_BMP MojoHelperUtils copyBinaryFile mojo INSTALLER_ICO getClass getResourceAsStream INSTALLER_ICO new File targetDirectory INSTALLER_ICO MojoHelperUtils copyBinaryFile mojo UNINSTALLER_ICO getClass getResourceAsStream UNINSTALLER_ICO new File targetDirectory UNINSTALLER_ICO MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLER_NSI getClass getResourceAsStream INSTALLER_NSI installerFile true
MojoHelperUtils copyBinaryFile mojo MANAGE_APACHEDS_EXE getClass getResourceAsStream MANAGE_APACHEDS_EXE new File getInstallationDirectory MANAGE_APACHEDS_EXE MojoHelperUtils copyBinaryFile mojo HEADER_BMP getClass getResourceAsStream HEADER_BMP new File targetDirectory HEADER_BMP MojoHelperUtils copyBinaryFile mojo WELCOME_BMP getClass getResourceAsStream WELCOME_BMP new File targetDirectory WELCOME_BMP MojoHelperUtils copyBinaryFile mojo INSTALLER_ICO getClass getResourceAsStream INSTALLER_ICO new File targetDirectory INSTALLER_ICO MojoHelperUtils copyBinaryFile mojo UNINSTALLER_ICO getClass getResourceAsStream UNINSTALLER_ICO new File targetDirectory UNINSTALLER_ICO MojoHelperUtils copyAsciiFile mojo filterProperties INSTALLER_NSI getClass getResourceAsStream INSTALLER_NSI installerFile true catch Exception e log error e getMessage throw new MojoFailureException log info Execute createPkgTask new Execute String cmd new String mojo getMakensisUtility getAbsolutePath installerFile getAbsolutePath createPkgTask setCommandline cmd createPkgTask setWorkingDirectory targetDirectory try
log info if getTargetDirectory mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY getTargetDirectory log error e getLocalizedMessage throw new MojoFailureException e getMessage log info try File rpmBuild new File getTargetDirectory BUILD if rpmBuild mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmBuild log error e getLocalizedMessage throw new MojoFailureException e getMessage File rpmRpms new File getTargetDirectory RPMS if rpmRpms mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmRpms
throw new MojoFailureException e getMessage log info try File rpmBuild new File getTargetDirectory BUILD if rpmBuild mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmBuild log error e getLocalizedMessage throw new MojoFailureException e getMessage File rpmRpms new File getTargetDirectory RPMS if rpmRpms mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmRpms log error e getLocalizedMessage throw new MojoFailureException e getMessage File rpmSources new File getTargetDirectory SOURCES if rpmSources mkdirs
if rpmBuild mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmBuild log error e getLocalizedMessage throw new MojoFailureException e getMessage File rpmRpms new File getTargetDirectory RPMS if rpmRpms mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmRpms log error e getLocalizedMessage throw new MojoFailureException e getMessage File rpmSources new File getTargetDirectory SOURCES if rpmSources mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmSources log error e getLocalizedMessage throw new MojoFailureException e getMessage File rpmSpecs new File getTargetDirectory SPECS
File rpmRpms new File getTargetDirectory RPMS if rpmRpms mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmRpms log error e getLocalizedMessage throw new MojoFailureException e getMessage File rpmSources new File getTargetDirectory SOURCES if rpmSources mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmSources log error e getLocalizedMessage throw new MojoFailureException e getMessage File rpmSpecs new File getTargetDirectory SPECS if rpmSpecs mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmSpecs log error e getLocalizedMessage throw new MojoFailureException e getMessage
if rpmSources mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmSources log error e getLocalizedMessage throw new MojoFailureException e getMessage File rpmSpecs new File getTargetDirectory SPECS if rpmSpecs mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmSpecs log error e getLocalizedMessage throw new MojoFailureException e getMessage File rpmSrpms new File getTargetDirectory SRPMS if rpmSrpms mkdirs Exception e new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY rpmSrpms log error e getLocalizedMessage throw new MojoFailureException e getMessage createLayouts
Dn normName addContext getDn Entry entry addContext getEntry if entry get userPasswordAT null entry get krb5PrincipalNameAT null LOG debug entry normName getName Value userPassword entry get userPasswordAT get String strUserPassword Strings utf8ToString userPassword getBytes String principalName entry get krb5PrincipalNameAT getString if LOG isDebugEnabled LOG debug principalName if LOG_KRB isDebugEnabled LOG_KRB debug principalName Map EncryptionType EncryptionKey keys generateKeys principalName strUserPassword entry put krb5KeyVersionNumberAT Attribute keyAttribute getKeyAttribute keys entry put keyAttribute
if entry get userPasswordAT null entry get krb5PrincipalNameAT null LOG debug entry normName getName Value userPassword entry get userPasswordAT get String strUserPassword Strings utf8ToString userPassword getBytes String principalName entry get krb5PrincipalNameAT getString if LOG isDebugEnabled LOG debug principalName if LOG_KRB isDebugEnabled LOG_KRB debug principalName Map EncryptionType EncryptionKey keys generateKeys principalName strUserPassword entry put krb5KeyVersionNumberAT Attribute keyAttribute getKeyAttribute keys entry put keyAttribute if LOG isDebugEnabled LOG debug entry normName getName
if LOG isDebugEnabled switch mod getOperation case ADD_ATTRIBUTE operation break case REMOVE_ATTRIBUTE operation break case REPLACE_ATTRIBUTE operation break default throw new IllegalArgumentException mod getOperation Attribute attr mod getAttribute if userPasswordAT equals attr getAttributeType Value firstValue attr get String password null if firstValue isHumanReadable password firstValue getString
switch mod getOperation case ADD_ATTRIBUTE operation break case REMOVE_ATTRIBUTE operation break case REPLACE_ATTRIBUTE operation break default throw new IllegalArgumentException mod getOperation Attribute attr mod getAttribute if userPasswordAT equals attr getAttributeType Value firstValue attr get String password null if firstValue isHumanReadable password firstValue getString LOG debug operation password
break default throw new IllegalArgumentException mod getOperation Attribute attr mod getAttribute if userPasswordAT equals attr getAttributeType Value firstValue attr get String password null if firstValue isHumanReadable password firstValue getString LOG debug operation password LOG_KRB debug operation password else password Strings utf8ToString firstValue getBytes subContext setUserPassword password if krb5PrincipalNameAT equals attr getAttributeType subContext setPrincipalName attr getString
default throw new IllegalArgumentException mod getOperation Attribute attr mod getAttribute if userPasswordAT equals attr getAttributeType Value firstValue attr get String password null if firstValue isHumanReadable password firstValue getString LOG debug operation password LOG_KRB debug operation password else password Strings utf8ToString firstValue getBytes subContext setUserPassword password if krb5PrincipalNameAT equals attr getAttributeType subContext setPrincipalName attr getString LOG debug subContext getPrincipalName
lookupContext setPartition modContext getPartition lookupContext setTransaction modContext getTransaction Entry userEntry directoryService getPartitionNexus lookup lookupContext if userEntry null throw new LdapAuthenticationException I18n err I18n ERR_512 principalDn if ClonedServerEntry userEntry getOriginalEntry contains directoryService getAtProvider getObjectClass SchemaConstants KRB5_PRINCIPAL_OC return else subContext isPrincipal true LOG debug principalDn getName LOG_KRB debug principalDn getName if subContext getPrincipalName null Attribute principalAttribute ClonedServerEntry userEntry getOriginalEntry get krb5PrincipalNameAT String principalName principalAttribute getString subContext setPrincipalName principalName
lookupContext setTransaction modContext getTransaction Entry userEntry directoryService getPartitionNexus lookup lookupContext if userEntry null throw new LdapAuthenticationException I18n err I18n ERR_512 principalDn if ClonedServerEntry userEntry getOriginalEntry contains directoryService getAtProvider getObjectClass SchemaConstants KRB5_PRINCIPAL_OC return else subContext isPrincipal true LOG debug principalDn getName LOG_KRB debug principalDn getName if subContext getPrincipalName null Attribute principalAttribute ClonedServerEntry userEntry getOriginalEntry get krb5PrincipalNameAT String principalName principalAttribute getString subContext setPrincipalName principalName LOG debug principalName
LOG debug principalDn getName LOG_KRB debug principalDn getName if subContext getPrincipalName null Attribute principalAttribute ClonedServerEntry userEntry getOriginalEntry get krb5PrincipalNameAT String principalName principalAttribute getString subContext setPrincipalName principalName LOG debug principalName LOG_KRB debug principalName Attribute keyVersionNumberAttr ClonedServerEntry userEntry getOriginalEntry get krb5KeyVersionNumberAT if keyVersionNumberAttr null subContext setNewKeyVersionNumber LOG debug LOG_KRB debug else int oldKeyVersionNumber Integer parseInt keyVersionNumberAttr getString
LOG_KRB debug principalDn getName if subContext getPrincipalName null Attribute principalAttribute ClonedServerEntry userEntry getOriginalEntry get krb5PrincipalNameAT String principalName principalAttribute getString subContext setPrincipalName principalName LOG debug principalName LOG_KRB debug principalName Attribute keyVersionNumberAttr ClonedServerEntry userEntry getOriginalEntry get krb5KeyVersionNumberAT if keyVersionNumberAttr null subContext setNewKeyVersionNumber LOG debug LOG_KRB debug else int oldKeyVersionNumber Integer parseInt keyVersionNumberAttr getString int newKeyVersionNumber oldKeyVersionNumber
void deriveKeys ModifyOperationContext modContext ModifySubContext subContext throws LdapException List Modification mods modContext getModItems String principalName subContext getPrincipalName String userPassword subContext getUserPassword int kvno subContext getNewKeyVersionNumber
void deriveKeys ModifyOperationContext modContext ModifySubContext subContext throws LdapException List Modification mods modContext getModItems String principalName subContext getPrincipalName String userPassword subContext getUserPassword int kvno subContext getNewKeyVersionNumber LOG debug principalName userPassword
String principalName subContext getPrincipalName String userPassword subContext getUserPassword int kvno subContext getNewKeyVersionNumber LOG debug principalName userPassword LOG_KRB debug principalName userPassword Map EncryptionType EncryptionKey keys generateKeys principalName userPassword List Modification newModsList new ArrayList for Modification mod mods newModsList add mod Modification krb5PrincipalName new DefaultModification ModificationOperation REPLACE_ATTRIBUTE new DefaultAttribute krb5PrincipalNameAT principalName newModsList add krb5PrincipalName Modification krb5KeyVersionNumber new DefaultModification ModificationOperation REPLACE_ATTRIBUTE new DefaultAttribute krb5KeyVersionNumberAT Integer toString kvno newModsList add krb5KeyVersionNumber Attribute attribute getKeyAttribute keys newModsList add new DefaultModification ModificationOperation REPLACE_ATTRIBUTE attribute
String userPassword subContext getUserPassword int kvno subContext getNewKeyVersionNumber LOG debug principalName userPassword LOG_KRB debug principalName userPassword Map EncryptionType EncryptionKey keys generateKeys principalName userPassword List Modification newModsList new ArrayList for Modification mod mods newModsList add mod Modification krb5PrincipalName new DefaultModification ModificationOperation REPLACE_ATTRIBUTE new DefaultAttribute krb5PrincipalNameAT principalName newModsList add krb5PrincipalName Modification krb5KeyVersionNumber new DefaultModification ModificationOperation REPLACE_ATTRIBUTE new DefaultAttribute krb5KeyVersionNumberAT Integer toString kvno newModsList add krb5KeyVersionNumber Attribute attribute getKeyAttribute keys newModsList add new DefaultModification ModificationOperation REPLACE_ATTRIBUTE attribute LOG debug krb5PrincipalName krb5KeyVersionNumber
private void checkAddRole Value role Attribute adminPoint Dn dn throws LdapException String roleStr Strings toLowerCaseAscii Strings trim role getString if ROLES contains roleStr String message role
private void checkAddRole Value role Attribute adminPoint Dn dn throws LdapException String roleStr Strings toLowerCaseAscii Strings trim role getString if ROLES contains roleStr String message role LOG error message throw new LdapUnwillingToPerformException message if isAutonomousAreaRole roleStr if adminPoint size String message adminPoint LOG error message throw new LdapUnwillingToPerformException message else return if adminPoint contains SchemaConstants AUTONOMOUS_AREA String message adminPoint
private void checkDelRole Value role Attribute adminPoint Dn dn throws LdapException String roleStr Strings toLowerCaseAscii Strings trim role getString if ROLES contains roleStr String message role
if isAutonomousAreaRole roleStr DnNode AccessControlAdministrativePoint acAps directoryService getAccessControlAPCache if acAps hasParent dn List AccessControlAdministrativePoint children acAps getDescendantElements dn for AccessControlAdministrativePoint child children if child isInner String message child getDn LOG error message throw new LdapUnwillingToPerformException message DnNode CollectiveAttributeAdministrativePoint caAps directoryService getCollectiveAttributeAPCache if acAps hasParent dn List CollectiveAttributeAdministrativePoint children caAps getDescendantElements dn for CollectiveAttributeAdministrativePoint child children if child isInner String message child getDn
LOG error message throw new LdapUnwillingToPerformException message DnNode CollectiveAttributeAdministrativePoint caAps directoryService getCollectiveAttributeAPCache if acAps hasParent dn List CollectiveAttributeAdministrativePoint children caAps getDescendantElements dn for CollectiveAttributeAdministrativePoint child children if child isInner String message child getDn LOG error message throw new LdapUnwillingToPerformException message DnNode TriggerExecutionAdministrativePoint teAps directoryService getTriggerExecutionAPCache if acAps hasParent dn List TriggerExecutionAdministrativePoint children teAps getDescendantElements dn for TriggerExecutionAdministrativePoint child children if child isInner
private void checkInnerSpecificMix String role Attribute adminPoint throws LdapUnwillingToPerformException if isAccessControlInnerRole role if hasAccessControlSpecificRole adminPoint String message adminPoint
String message adminPoint LOG error message throw new LdapUnwillingToPerformException message else return if isCollectiveAttributeInnerRole role if hasCollectiveAttributeSpecificRole adminPoint String message adminPoint LOG error message throw new LdapUnwillingToPerformException message else return if isTriggerExecutionInnerRole role if hasTriggerExecutionSpecificRole adminPoint String message adminPoint
private void checkIAPHasParent String role Attribute adminPoint Dn dn throws LdapUnwillingToPerformException if isAccessControlInnerRole role DnNode AccessControlAdministrativePoint acCache directoryService getAccessControlAPCache DnNode AccessControlAdministrativePoint parent acCache getNode dn if parent null String message adminPoint
String message adminPoint LOG error message throw new LdapUnwillingToPerformException message else if isCollectiveAttributeInnerRole role DnNode CollectiveAttributeAdministrativePoint caCache directoryService getCollectiveAttributeAPCache boolean hasAP caCache hasParentElement dn if hasAP String message adminPoint LOG error message throw new LdapUnwillingToPerformException message else if isTriggerExecutionInnerRole role DnNode TriggerExecutionAdministrativePoint caCache directoryService getTriggerExecutionAPCache DnNode TriggerExecutionAdministrativePoint parent caCache getNode dn if parent null String message adminPoint
else if isCollectiveAttributeInnerRole role DnNode CollectiveAttributeAdministrativePoint caCache directoryService getCollectiveAttributeAPCache boolean hasAP caCache hasParentElement dn if hasAP String message adminPoint LOG error message throw new LdapUnwillingToPerformException message else if isTriggerExecutionInnerRole role DnNode TriggerExecutionAdministrativePoint caCache directoryService getTriggerExecutionAPCache DnNode TriggerExecutionAdministrativePoint parent caCache getNode dn if parent null String message adminPoint LOG error message throw new LdapUnwillingToPerformException message else
if adminPoint null next addContext LOG debug return LOG debug dn adminPoint lockWrite try for Value role adminPoint checkAddRole role adminPoint dn next addContext String apUuid entry get directoryService getAtProvider getEntryUUID getString createAdministrativePoints adminPoint dn apUuid finally unlock if LOG isDebugEnabled
Override public void delete DeleteOperationContext deleteContext throws LdapException LOG debug Entry entry deleteContext getEntry Dn dn entry getDn Attribute adminPoint entry get directoryService getAtProvider getAdministrativeRole if adminPoint null next deleteContext LOG debug return LOG debug dn adminPoint lockWrite try for Value role adminPoint if isValidRole role getString String message role
LOG debug return LOG debug dn adminPoint lockWrite try for Value role adminPoint if isValidRole role getString String message role LOG error message throw new LdapUnwillingToPerformException message next deleteContext deleteAdminPointCache adminPoint deleteContext finally unlock if LOG isDebugEnabled
Attribute attribute modification getAttribute if attribute getAttributeType directoryService getAtProvider getAdministrativeRole switch modification getOperation case ADD_ATTRIBUTE for Value role attribute addRole role getString dn uuid acapCache caapCache teapCache ssapCache modifiedAdminRole add role break case REMOVE_ATTRIBUTE if attribute size for Value role modifiedAdminRole delRole role getString dn uuid acapCache caapCache teapCache ssapCache modifiedAdminRole clear break for Value value attribute if isValidRole value getString String msg value getString
break case REMOVE_ATTRIBUTE if attribute size for Value role modifiedAdminRole delRole role getString dn uuid acapCache caapCache teapCache ssapCache modifiedAdminRole clear break for Value value attribute if isValidRole value getString String msg value getString LOG error msg throw new LdapInvalidAttributeValueException ResultCodeEnum INVALID_ATTRIBUTE_SYNTAX msg if modifiedAdminRole contains value String msg value LOG error msg throw new LdapNoSuchAttributeException msg
Override public void add AddOperationContext addContext throws LdapException if IS_DEBUG
Override public void bind BindOperationContext bindContext throws LdapException if IS_DEBUG
PasswordPolicyException ppe null boolean isPPolicyReqCtrlPresent bindContext hasRequestControl PasswordPolicyRequest OID PasswordPolicyResponse pwdRespCtrl new PasswordPolicyResponseImpl boolean authenticated false Authenticator authenticator selectAuthenticator bindDn level try LdapPrincipal principal authenticator authenticate bindContext if principal null LdapPrincipal clonedPrincipal LdapPrincipal principal clone bindContext setCredentials null clonedPrincipal setUserPassword Strings EMPTY_BYTES CoreSession newSession new DefaultCoreSession clonedPrincipal directoryService bindContext setSession newSession authenticated true catch PasswordPolicyException e
boolean isPPolicyReqCtrlPresent bindContext hasRequestControl PasswordPolicyRequest OID PasswordPolicyResponse pwdRespCtrl new PasswordPolicyResponseImpl boolean authenticated false Authenticator authenticator selectAuthenticator bindDn level try LdapPrincipal principal authenticator authenticate bindContext if principal null LdapPrincipal clonedPrincipal LdapPrincipal principal clone bindContext setCredentials null clonedPrincipal setUserPassword Strings EMPTY_BYTES CoreSession newSession new DefaultCoreSession clonedPrincipal directoryService bindContext setSession newSession authenticated true catch PasswordPolicyException e ppe e
Override public boolean compare CompareOperationContext compareContext throws LdapException if IS_DEBUG
Override public void delete DeleteOperationContext deleteContext throws LdapException if IS_DEBUG
Override public Entry getRootDse GetRootDseOperationContext getRootDseContext throws LdapException if IS_DEBUG
Override public boolean hasEntry HasEntryOperationContext hasEntryContext throws LdapException if IS_DEBUG
Override public Entry lookup LookupOperationContext lookupContext throws LdapException if IS_DEBUG
Override public void modify ModifyOperationContext modifyContext throws LdapException if IS_DEBUG
private void checkOldPwdRequired ModifyOperationContext modifyContext PasswordPolicyConfiguration policyConfig PwdModDetailsHolder pwdModDetails boolean isPPolicyReqCtrlPresent throws LdapNoPermissionException if policyConfig isPwdSafeModify pwdModDetails isDelete pwdModDetails isAddOrReplace String msg
Override public void move MoveOperationContext moveContext throws LdapException if IS_DEBUG
Override public void moveAndRename MoveAndRenameOperationContext moveAndRenameContext throws LdapException if IS_DEBUG
Override public void rename RenameOperationContext renameContext throws LdapException if IS_DEBUG
Override public EntryFilteringCursor search SearchOperationContext searchContext throws LdapException if IS_DEBUG
private void checkAuthenticated OperationContext operation throws LdapException if operation getSession isAnonymous directoryService isAllowAnonymousAccess operation getDn isEmpty String msg I18n err I18n ERR_5 operation getName
Override public LdapPrincipal authenticate BindOperationContext bindContext throws LdapException LdapPrincipal principal null if IS_DEBUG
ldapConnection connect else connectionConfig new LdapConnectionConfig connectionConfig setLdapHost delegateHost connectionConfig setLdapPort delegatePort ldapConnection new LdapNetworkConnection delegateHost delegatePort ldapConnection connect ldapConnection setTimeOut 0L try try ldapConnection bind bindDn Strings utf8ToString bindContext getCredentials catch LdapException le String message I18n err I18n ERR_230 bindDn getName LOG info message throw new LdapAuthenticationException message
try ldapConnection bind bindDn Strings utf8ToString bindContext getCredentials catch LdapException le String message I18n err I18n ERR_230 bindDn getName LOG info message throw new LdapAuthenticationException message finally ldapConnection unBind if IS_DEBUG LOG debug bindContext getDn principal new LdapPrincipal getDirectoryService getSchemaManager bindDn AuthenticationLevel SIMPLE bindContext getCredentials IoSession session bindContext getIoSession if session null SocketAddress clientAddress session getRemoteAddress principal setClientAddress clientAddress
Override public LdapPrincipal authenticate BindOperationContext bindContext throws LdapException if IS_DEBUG
LdapPrincipal principal getStoredPassword bindContext IoSession session bindContext getIoSession if session null SocketAddress clientAddress session getRemoteAddress principal setClientAddress clientAddress SocketAddress serverAddress session getServiceAddress principal setServerAddress serverAddress byte storedPasswords principal getUserPasswords PasswordPolicyException ppe null try checkPwdPolicy bindContext getEntry catch PasswordPolicyException e ppe e for byte storedPassword storedPasswords if PasswordUtil compareCredentials credentials storedPassword
SocketAddress clientAddress session getRemoteAddress principal setClientAddress clientAddress SocketAddress serverAddress session getServiceAddress principal setServerAddress serverAddress byte storedPasswords principal getUserPasswords PasswordPolicyException ppe null try checkPwdPolicy bindContext getEntry catch PasswordPolicyException e ppe e for byte storedPassword storedPasswords if PasswordUtil compareCredentials credentials storedPassword if ppe null LOG debug bindContext getDn ppe getMessage throw ppe
private void protectCriticalEntries OperationContext opCtx Dn dn throws LdapException Dn principalDn getPrincipal opCtx getDn if dn isEmpty String msg I18n err I18n ERR_8
Dn parentDn dn getParent CoreSession session opContext getSession LookupOperationContext lookupContext new LookupOperationContext session parentDn SchemaConstants ALL_ATTRIBUTES_ARRAY lookupContext setPartition opContext getPartition lookupContext setTransaction opContext getTransaction Entry administrativeEntry ClonedServerEntry directoryService getPartitionNexus lookup lookupContext getOriginalEntry Attribute subentryAci administrativeEntry get directoryService getAtProvider getSubentryACI if subentryAci null return for Value value subentryAci String aciString value getString ACIItem item try item aciParser parse aciString catch ParseException e
if deleteContext getSession getDirectoryService isAccessControlEnabled next deleteContext return Dn dn deleteContext getDn if dn isEmpty String msg I18n err I18n ERR_12 LOG error msg throw new LdapNoPermissionException msg if dn equals adminGroupDn String msg I18n err I18n ERR_13 LOG error msg throw new LdapNoPermissionException msg Dn principalDn getPrincipal deleteContext getDn if dn equals adminSystemDn String msg I18n err I18n ERR_14 principalDn getName
if dn isEmpty String msg I18n err I18n ERR_12 LOG error msg throw new LdapNoPermissionException msg if dn equals adminGroupDn String msg I18n err I18n ERR_13 LOG error msg throw new LdapNoPermissionException msg Dn principalDn getPrincipal deleteContext getDn if dn equals adminSystemDn String msg I18n err I18n ERR_14 principalDn getName LOG error msg throw new LdapNoPermissionException msg if dn size isAnAdministrator principalDn if dn isDescendantOf adminSystemDn
if dn equals adminGroupDn String msg I18n err I18n ERR_13 LOG error msg throw new LdapNoPermissionException msg Dn principalDn getPrincipal deleteContext getDn if dn equals adminSystemDn String msg I18n err I18n ERR_14 principalDn getName LOG error msg throw new LdapNoPermissionException msg if dn size isAnAdministrator principalDn if dn isDescendantOf adminSystemDn String msg I18n err I18n ERR_15 principalDn getName dn getName LOG error msg throw new LdapNoPermissionException msg if dn isDescendantOf groupsBaseDn
throw new LdapNoPermissionException msg Dn principalDn getPrincipal deleteContext getDn if dn equals adminSystemDn String msg I18n err I18n ERR_14 principalDn getName LOG error msg throw new LdapNoPermissionException msg if dn size isAnAdministrator principalDn if dn isDescendantOf adminSystemDn String msg I18n err I18n ERR_15 principalDn getName dn getName LOG error msg throw new LdapNoPermissionException msg if dn isDescendantOf groupsBaseDn String msg I18n err I18n ERR_16 principalDn getName dn getName LOG error msg throw new LdapNoPermissionException msg
private void protectModifyAlterations OperationContext opCtx Dn dn throws LdapException Dn principalDn getPrincipal opCtx getDn if dn isEmpty String msg I18n err I18n ERR_17
Dn principalDn getPrincipal opCtx getDn if dn isEmpty String msg I18n err I18n ERR_17 LOG error msg throw new LdapNoPermissionException msg if isAnAdministrator principalDn if dn equals getPrincipal opCtx getDn return if dn equals adminSystemDn String msg I18n err I18n ERR_18 principalDn getName LOG error msg throw new LdapNoPermissionException msg if dn size if dn isDescendantOf adminSystemDn String msg I18n err I18n ERR_19 principalDn getName dn getName
throw new LdapNoPermissionException msg if isAnAdministrator principalDn if dn equals getPrincipal opCtx getDn return if dn equals adminSystemDn String msg I18n err I18n ERR_18 principalDn getName LOG error msg throw new LdapNoPermissionException msg if dn size if dn isDescendantOf adminSystemDn String msg I18n err I18n ERR_19 principalDn getName dn getName LOG error msg throw new LdapNoPermissionException msg if dn isDescendantOf groupsBaseDn String msg I18n err I18n ERR_20 principalDn getName dn getName
return if dn equals adminSystemDn String msg I18n err I18n ERR_18 principalDn getName LOG error msg throw new LdapNoPermissionException msg if dn size if dn isDescendantOf adminSystemDn String msg I18n err I18n ERR_19 principalDn getName dn getName LOG error msg throw new LdapNoPermissionException msg if dn isDescendantOf groupsBaseDn String msg I18n err I18n ERR_20 principalDn getName dn getName LOG error msg throw new LdapNoPermissionException msg if dn isDescendantOf usersBaseDn
private void protectDnAlterations OperationContext opCtx Dn dn throws LdapException Dn principalDn getPrincipal opCtx getDn if dn isEmpty String msg I18n err I18n ERR_234
if dn isEmpty String msg I18n err I18n ERR_234 LOG error msg throw new LdapNoPermissionException msg if dn equals adminGroupDn String msg I18n err I18n ERR_21 LOG error msg throw new LdapNoPermissionException msg if isTheAdministrator dn String msg I18n err I18n ERR_22 principalDn getName dn getName LOG error msg throw new LdapNoPermissionException msg if dn size isAnAdministrator principalDn if dn isDescendantOf adminSystemDn String msg I18n err I18n ERR_23 principalDn getName dn getName
if dn equals adminGroupDn String msg I18n err I18n ERR_21 LOG error msg throw new LdapNoPermissionException msg if isTheAdministrator dn String msg I18n err I18n ERR_22 principalDn getName dn getName LOG error msg throw new LdapNoPermissionException msg if dn size isAnAdministrator principalDn if dn isDescendantOf adminSystemDn String msg I18n err I18n ERR_23 principalDn getName dn getName LOG error msg throw new LdapNoPermissionException msg if dn isDescendantOf groupsBaseDn String msg I18n err I18n ERR_24 principalDn getName dn getName
throw new LdapNoPermissionException msg if isTheAdministrator dn String msg I18n err I18n ERR_22 principalDn getName dn getName LOG error msg throw new LdapNoPermissionException msg if dn size isAnAdministrator principalDn if dn isDescendantOf adminSystemDn String msg I18n err I18n ERR_23 principalDn getName dn getName LOG error msg throw new LdapNoPermissionException msg if dn isDescendantOf groupsBaseDn String msg I18n err I18n ERR_24 principalDn getName dn getName LOG error msg throw new LdapNoPermissionException msg if dn isDescendantOf usersBaseDn
if normalizedDn equals principalDn return String msg I18n err I18n ERR_25 normalizedDn getName principalDn getName LOG error msg throw new LdapNoPermissionException msg if normalizedDn isDescendantOf groupsBaseDn normalizedDn isDescendantOf usersBaseDn if normalizedDn equals principalDn return String msg I18n err I18n ERR_26 normalizedDn getName principalDn getName LOG error msg throw new LdapNoPermissionException msg if isTheAdministrator normalizedDn if normalizedDn equals principalDn return String msg I18n err I18n ERR_27 principalDn getName
try while results next Entry result results get Dn groupDn result getDn if groupDn isSchemaAware groupDn new Dn schemaManager groupDn Attribute members getMemberAttribute result if members null Set String memberSet new HashSet members size addMembers memberSet members groups put groupDn getNormName memberSet else LOG warn groupDn getName results close catch Exception e
if groupDn isSchemaAware groupDn new Dn schemaManager groupDn Attribute members getMemberAttribute result if members null Set String memberSet new HashSet members size addMembers memberSet members groups put groupDn getNormName memberSet else LOG warn groupDn getName results close catch Exception e LOG error e getCause throw new LdapOperationException e getMessage e adminSystemDn new Dn schemaManager ServerDNConstants ADMIN_SYSTEM_DN_NORMALIZED if IS_DEBUG
if oc contains SchemaConstants GROUP_OF_NAMES_OC memberAttr directoryService getAtProvider getMember members entry get memberAttr if oc contains SchemaConstants GROUP_OF_UNIQUE_NAMES_OC memberAttr directoryService getAtProvider getUniqueMember members entry get memberAttr if members null return for Modification modification mods if memberAttr getOid modification getAttribute getId Set String memberSet groups get name getNormName if memberSet null modify memberSet modification getOperation modification getAttribute break if IS_DEBUG
public boolean groupRenamed Dn oldName Dn newName Set String members groups get oldName getNormName if members null groups remove oldName getNormName groups put newName getNormName members if IS_DEBUG
Attribute collectiveAttributeSubentries ClonedServerEntry entry getOriginalEntry get directoryService getAtProvider getCollectiveAttributeSubentries if collectiveAttributeSubentries null return if LOG isDebugEnabled LOG debug entry getDn Attribute collectiveExclusions ClonedServerEntry entry getOriginalEntry get directoryService getAtProvider getCollectiveExclusions Set AttributeType exclusions new HashSet if collectiveExclusions null LOG debug collectiveExclusions if collectiveExclusions contains SchemaConstants EXCLUDE_ALL_COLLECTIVE_ATTRIBUTES_AT_OID collectiveExclusions contains SchemaConstants EXCLUDE_ALL_COLLECTIVE_ATTRIBUTES_AT LOG debug return for Value value collectiveExclusions AttributeType attrType schemaManager lookupAttributeTypeRegistry value getString exclusions add attrType
for Value value collectiveExclusions AttributeType attrType schemaManager lookupAttributeTypeRegistry value getString exclusions add attrType LOG debug attrType getName for Value value collectiveAttributeSubentries String subentryDnStr value getString Dn subentryDn dnFactory create subentryDnStr LOG debug subentryDn getName LookupOperationContext lookupContext new LookupOperationContext session subentryDn SchemaConstants ALL_ATTRIBUTES_ARRAY lookupContext setPartition opContext getPartition lookupContext setTransaction opContext getTransaction Entry subentry directoryService getPartitionNexus lookup lookupContext for Attribute attribute subentry getAttributes AttributeType attributeType attribute getAttributeType if attributeType isCollective
exclusions add attrType LOG debug attrType getName for Value value collectiveAttributeSubentries String subentryDnStr value getString Dn subentryDn dnFactory create subentryDnStr LOG debug subentryDn getName LookupOperationContext lookupContext new LookupOperationContext session subentryDn SchemaConstants ALL_ATTRIBUTES_ARRAY lookupContext setPartition opContext getPartition lookupContext setTransaction opContext getTransaction Entry subentry directoryService getPartitionNexus lookup lookupContext for Attribute attribute subentry getAttributes AttributeType attributeType attribute getAttributeType if attributeType isCollective continue if exclusions contains attributeType
LookupOperationContext lookupContext new LookupOperationContext session subentryDn SchemaConstants ALL_ATTRIBUTES_ARRAY lookupContext setPartition opContext getPartition lookupContext setTransaction opContext getTransaction Entry subentry directoryService getPartitionNexus lookup lookupContext for Attribute attribute subentry getAttributes AttributeType attributeType attribute getAttributeType if attributeType isCollective continue if exclusions contains attributeType LOG debug attributeType getName continue if opContext isAllUserAttributes opContext contains schemaManager attributeType LOG debug attributeType getName continue Attribute subentryColAttr subentry get attributeType
for Attribute at lst int stored incMap get at getId get at clear at add String valueOf stored next addContext ModifyOperationContext bindModCtx new ModifyOperationContext directoryService getAdminSession bindModCtx setDn numberHolder bindModCtx setPushToEvtInterceptor true List Modification mods new ArrayList for Attribute at lst AtomicInteger ai incMap get at getId ai set ai get Modification mod new DefaultModification mod setOperation ModificationOperation REPLACE_ATTRIBUTE mod setAttribute at
private boolean checkAddOperationalAttribute boolean isAdmin Entry entry AttributeType attribute throws LdapException if entry containsAttribute attribute if isAdmin String message I18n err I18n ERR_30 attribute
Override public void modify ModifyOperationContext modifyContext throws LdapException List Modification mods modifyContext getModItems boolean isAdmin modifyContext getSession getAuthenticatedPrincipal getDn equals adminDn boolean modifierAtPresent false boolean modifiedTimeAtPresent false boolean entryCsnAtPresent false Dn dn modifyContext getDn for Modification modification mods AttributeType attributeType modification getAttribute getAttributeType if attributeType equals directoryService getAtProvider getModifiersName if isAdmin String message I18n err I18n ERR_31
boolean modifiedTimeAtPresent false boolean entryCsnAtPresent false Dn dn modifyContext getDn for Modification modification mods AttributeType attributeType modification getAttribute getAttributeType if attributeType equals directoryService getAtProvider getModifiersName if isAdmin String message I18n err I18n ERR_31 LOG error message throw new LdapNoPermissionException message else modifierAtPresent true if attributeType equals directoryService getAtProvider getModifyTimestamp if isAdmin String message I18n err I18n ERR_30 attributeType
String message I18n err I18n ERR_31 LOG error message throw new LdapNoPermissionException message else modifierAtPresent true if attributeType equals directoryService getAtProvider getModifyTimestamp if isAdmin String message I18n err I18n ERR_30 attributeType LOG error message throw new LdapNoPermissionException message else modifiedTimeAtPresent true if attributeType equals directoryService getAtProvider getEntryCSN if isAdmin String message I18n err I18n ERR_30 attributeType
if attributeType equals directoryService getAtProvider getModifyTimestamp if isAdmin String message I18n err I18n ERR_30 attributeType LOG error message throw new LdapNoPermissionException message else modifiedTimeAtPresent true if attributeType equals directoryService getAtProvider getEntryCSN if isAdmin String message I18n err I18n ERR_30 attributeType LOG error message throw new LdapNoPermissionException message else entryCsnAtPresent true if PWD_POLICY_STATE_ATTRIBUTE_TYPES contains attributeType isAdmin
private static void checkRefAttributeValue Value value throws LdapException String refVal value getString LdapUrl ldapUrl new LdapUrl refVal if ldapUrl getScope SearchScope OBJECT String message I18n err I18n ERR_36
LdapUrl ldapUrl new LdapUrl refVal if ldapUrl getScope SearchScope OBJECT String message I18n err I18n ERR_36 LOG error message throw new LdapException message if Strings isEmpty ldapUrl getFilter String message I18n err I18n ERR_37 LOG error message throw new LdapException message if ldapUrl getAttributes null ldapUrl getAttributes isEmpty String message I18n err I18n ERR_38 LOG error message throw new LdapException message if ldapUrl getExtensions null ldapUrl getExtensions isEmpty String message I18n err I18n ERR_39
throw new LdapException message if Strings isEmpty ldapUrl getFilter String message I18n err I18n ERR_37 LOG error message throw new LdapException message if ldapUrl getAttributes null ldapUrl getAttributes isEmpty String message I18n err I18n ERR_38 LOG error message throw new LdapException message if ldapUrl getExtensions null ldapUrl getExtensions isEmpty String message I18n err I18n ERR_39 LOG error message throw new LdapException message if ldapUrl getExtensions null ldapUrl getExtensions isEmpty String message I18n err I18n ERR_40
throw new LdapException message if ldapUrl getAttributes null ldapUrl getAttributes isEmpty String message I18n err I18n ERR_38 LOG error message throw new LdapException message if ldapUrl getExtensions null ldapUrl getExtensions isEmpty String message I18n err I18n ERR_39 LOG error message throw new LdapException message if ldapUrl getExtensions null ldapUrl getExtensions isEmpty String message I18n err I18n ERR_40 LOG error message throw new LdapException message Dn dn ldapUrl getDn if dn null dn isEmpty
private void checkFilter ExprNode filter throws LdapException if filter null String message I18n err I18n ERR_49
private void checkModifyEntry ModifyOperationContext modifyContext throws LdapException Dn dn modifyContext getDn Entry currentEntry modifyContext getEntry List Modification mods modifyContext getModItems Entry tempEntry currentEntry clone for Modification mod mods Attribute attribute mod getAttribute AttributeType attributeType attribute getAttributeType assertAttributeIsModifyable modifyContext attributeType switch mod getOperation case ADD_ATTRIBUTE Attribute currentAttribute tempEntry get attributeType if currentAttribute null for Value value attribute if currentAttribute contains value String msg I18n err I18n ERR_54 value
AttributeType attributeType attribute getAttributeType assertAttributeIsModifyable modifyContext attributeType switch mod getOperation case ADD_ATTRIBUTE Attribute currentAttribute tempEntry get attributeType if currentAttribute null for Value value attribute if currentAttribute contains value String msg I18n err I18n ERR_54 value LOG error msg throw new LdapAttributeInUseException msg currentAttribute add value else Attribute newAttribute attribute clone if newAttribute size newAttribute isValid attributeType String msg I18n err I18n ERR_54 Object null
if currentAttribute contains value String msg I18n err I18n ERR_54 value LOG error msg throw new LdapAttributeInUseException msg currentAttribute add value else Attribute newAttribute attribute clone if newAttribute size newAttribute isValid attributeType String msg I18n err I18n ERR_54 Object null LOG error msg throw new LdapInvalidAttributeValueException ResultCodeEnum INVALID_ATTRIBUTE_SYNTAX msg tempEntry put newAttribute break case REMOVE_ATTRIBUTE if tempEntry containsAttribute attributeType String msg I18n err I18n ERR_55 attributeType
String msg I18n err I18n ERR_54 Object null LOG error msg throw new LdapInvalidAttributeValueException ResultCodeEnum INVALID_ATTRIBUTE_SYNTAX msg tempEntry put newAttribute break case REMOVE_ATTRIBUTE if tempEntry containsAttribute attributeType String msg I18n err I18n ERR_55 attributeType LOG error msg throw new LdapNoSuchAttributeException msg if attribute size tempEntry removeAttributes attributeType else currentAttribute tempEntry get attributeType for Value value attribute if currentAttribute contains value
if entry get MetaSchemaConstants M_TYPE_OBJECT_CLASS_AT null String type entry get MetaSchemaConstants M_TYPE_OBJECT_CLASS_AT getString ocType ObjectClassTypeEnum getClassType type for Value sup supOC try String supName sup getString ObjectClass superior schemaManager lookupObjectClassRegistry supName switch ocType case ABSTRACT if superior isAbstract String message I18n err I18n ERR_57 LOG error message throw new LdapSchemaViolationException ResultCodeEnum OBJECT_CLASS_VIOLATION message break case AUXILIARY if superior isAbstract superior isAuxiliary String message I18n err I18n ERR_58
ObjectClass superior schemaManager lookupObjectClassRegistry supName switch ocType case ABSTRACT if superior isAbstract String message I18n err I18n ERR_57 LOG error message throw new LdapSchemaViolationException ResultCodeEnum OBJECT_CLASS_VIOLATION message break case AUXILIARY if superior isAbstract superior isAuxiliary String message I18n err I18n ERR_58 LOG error message throw new LdapSchemaViolationException ResultCodeEnum OBJECT_CLASS_VIOLATION message break case STRUCTURAL break default throw new IllegalArgumentException ocType catch LdapException ne
Override public boolean compare CompareOperationContext compareContext throws LdapException if IS_DEBUG
Override public void modify ModifyOperationContext modifyContext throws LdapException Dn dn modifyContext getDn if dn equals subschemaSubentryDn
if oc isStructural structuralObjectClasses add oc if structuralObjectClasses isEmpty String message I18n err I18n ERR_60 dn LOG error message throw new LdapSchemaViolationException ResultCodeEnum OBJECT_CLASS_VIOLATION message Set ObjectClass remaining new HashSet structuralObjectClasses size remaining addAll structuralObjectClasses for ObjectClass oc structuralObjectClasses if oc getSuperiors null for ObjectClass superClass oc getSuperiors if superClass isStructural remaining remove superClass if remaining size String message I18n err I18n ERR_61 dn remaining
private void assertRdn Dn dn Entry entry throws LdapException for Ava atav dn getRdn Attribute attribute entry get atav getNormType if attribute null attribute contains atav getValue String message I18n err I18n ERR_62 dn atav getType
private void addLdifFile File source throws IOException
boolean first true LdifEntry ldifEntry null try while ldifReader hasNext if first ldifEntry ldifReader next if ldifEntry get SchemaConstants ENTRY_UUID_AT null UUID entryUuid UUID randomUUID ldifEntry addAttribute SchemaConstants ENTRY_UUID_AT entryUuid toString if ldifEntry get SchemaConstants ENTRY_CSN_AT null Csn csn csnFactory newInstance ldifEntry addAttribute SchemaConstants ENTRY_CSN_AT csn toString first false else String msg I18n err I18n ERR_16002_MORE_THAN_ONE_ENTRY source
try ss ssParser parse subtree catch Exception e LOG warn subentryDn continue Subentry newSubentry new Subentry newSubentry setAdministrativeRoles getSubentryAdminRoles subentry newSubentry setSubtreeSpecification ss directoryService getSubentryCache addSubentry subentryDn newSubentry catch Exception e throw new LdapOperationException e getMessage e finally try subentries close catch Exception e
break case REPLACE break default throw new IllegalArgumentException operation LOG debug candidate getDn opContext getDn ModifyOperationContext modifyContext new ModifyOperationContext opContext getSession candidateDn modifications modifyContext setPartition opContext getPartition modifyContext setTransaction opContext getTransaction nexus modify modifyContext subentries close catch Exception e throw new LdapOtherException e getMessage e finally try subentries close catch Exception e
private void checkAdministrativeRole OperationContext opContext Dn apDn throws LdapException CoreSession session opContext getSession LookupOperationContext lookupContext new LookupOperationContext session apDn SchemaConstants ALL_ATTRIBUTES_ARRAY lookupContext setPartition opContext getPartition lookupContext setTransaction opContext getTransaction Entry administrationPoint directoryService getPartitionNexus lookup lookupContext Attribute administrativeRole administrationPoint get directoryService getAtProvider getAdministrativeRole if administrativeRole null administrativeRole size
controls setSearchScope SearchControls SUBTREE_SCOPE SearchOperationContext searchOperationContext new SearchOperationContext opContext getSession name filter controls searchOperationContext setAliasDerefMode AliasDerefMode NEVER_DEREF_ALIASES searchOperationContext setTransaction opContext getTransaction searchOperationContext setPartition opContext getPartition EntryFilteringCursor aps nexus search searchOperationContext try if aps next return true catch Exception e throw new LdapOperationException e getMessage e finally try aps close catch Exception e
Modification subtreeMod null for Modification mod modifications if mod getAttribute getAttributeType equals directoryService getAtProvider getSubtreeSpecification isSubtreeSpecificationModification true subtreeMod mod break boolean containsSubentryOC entry contains directoryService getAtProvider getObjectClass SchemaConstants SUBENTRY_OC if containsSubentryOC isSubtreeSpecificationModification Subentry subentry directoryService getSubentryCache removeSubentry dn SubtreeSpecification ssOld subentry getSubtreeSpecification SubtreeSpecification ssNew try ssNew ssParser parse subtreeMod getAttribute getString catch Exception e String msg I18n err I18n ERR_71
searchOperationContext setPartition modifyContext getPartition searchOperationContext setTransaction modifyContext getTransaction EntryFilteringCursor subentries nexus search searchOperationContext try while subentries next Entry candidate subentries get Dn candidateDn candidate getDn if directoryService getEvaluator evaluate ssOld apName candidateDn candidate ModifyOperationContext newModifyContext new ModifyOperationContext modifyContext getSession candidateDn getOperationalModsForRemove dn candidate newModifyContext setPartition modifyContext getPartition newModifyContext setTransaction modifyContext getTransaction nexus modify newModifyContext subentries close catch Exception e throw new LdapOperationErrorException e getMessage e
catch Exception e LOG error I18n err I18n ERR_168 e subentry directoryService getSubentryCache getSubentry dn List Attribute operationalAttributes getSubentryOperationalAttributes dn subentry Dn newBaseDn apName newBaseDn newBaseDn add ssNew getBase searchOperationContext new SearchOperationContext modifyContext getSession newBaseDn filter controls searchOperationContext setAliasDerefMode AliasDerefMode NEVER_DEREF_ALIASES searchOperationContext setPartition modifyContext getPartition searchOperationContext setTransaction modifyContext getTransaction subentries nexus search searchOperationContext try while subentries next Entry candidate subentries get Dn candidateDn candidate getDn
while subentries next Entry candidate subentries get Dn dn candidate getDn if dn isSchemaAware dn new Dn schemaManager dn if directoryService getEvaluator evaluate ss apName dn candidate ModifyOperationContext newModifyContext new ModifyOperationContext moveContext getSession dn getOperationalModsForReplace oldDn newName subentry candidate newModifyContext setPartition moveContext getPartition newModifyContext setTransaction moveContext getTransaction nexus modify newModifyContext catch Exception e throw new LdapOperationException e getMessage e finally try subentries close
while subentries next Entry candidate subentries get Dn dn candidate getDn if dn isSchemaAware dn new Dn schemaManager dn if directoryService getEvaluator evaluate ss apName dn candidate ModifyOperationContext newModifyContext new ModifyOperationContext moveAndRenameContext getSession dn getOperationalModsForReplace oldDn newName subentry candidate newModifyContext setPartition moveAndRenameContext getPartition newModifyContext setTransaction moveAndRenameContext getTransaction nexus modify newModifyContext catch Exception e throw new LdapOperationException e getMessage e finally try subentries close
searchOperationContext setTransaction renameContext getTransaction EntryFilteringCursor subentries nexus search searchOperationContext try while subentries next Entry candidate subentries get Dn dn candidate getDn if dn isSchemaAware dn new Dn schemaManager dn if directoryService getEvaluator evaluate ss apName dn candidate nexus modify new ModifyOperationContext renameContext getSession dn getOperationalModsForReplace oldDn newName subentry candidate catch Exception e throw new LdapOperationException e getMessage e finally try subentries close
public byte serialize Object object throws IOException Dn dn Dn object try ByteArrayOutputStream baos new ByteArrayOutputStream ObjectOutput out new ObjectOutputStream baos dn writeExternal out out flush if IS_DEBUG LOG debug
if dn isEmpty out writeByte else out writeByte Rdn rdn dn getRdn rdn writeExternal out out writeInt entry getAttributes size for Attribute attribute entry getAttributes AttributeType attributeType attribute getAttributeType String oid attributeType getOid out writeUTF oid attribute writeExternal out out flush if IS_DEBUG LOG debug
Override public void init RecordManager recMan SchemaManager schemaManager AttributeType attributeType throws LdapException IOException
public void init RecordManager recMan SchemaManager schemaManager AttributeType attributeType throws LdapException IOException
else setOptimizer new DefaultOptimizer this EvaluatorBuilder evaluatorBuilder new EvaluatorBuilder this schemaManager CursorBuilder cursorBuilder new CursorBuilder this evaluatorBuilder setSearchEngine new DefaultSearchEngine this cursorBuilder evaluatorBuilder getOptimizer File partitionDir new File getPartitionPath if partitionDir exists partitionDir mkdirs throw new LdapOtherException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY partitionDir String path partitionDir getPath File separator id try base new BaseRecordManager path TransactionManager transactionManager base getTransactionManager transactionManager setMaximumTransactionsInLog String cacheSizeVal System getProperty int recCacheSize Integer parseInt cacheSizeVal
catch IOException ioe throw new LdapOtherException ioe getMessage ioe List String allIndices new ArrayList List Index String indexToBuild new ArrayList for Index String index getIndexedAttributes String oid schemaManager lookupAttributeTypeRegistry index getAttributeId getOid allIndices add oid try String forwardIndex oid if recMan getNamedObject forwardIndex indexToBuild add index catch IOException ioe throw new LdapOtherException ioe getMessage ioe super doInit if cacheSize
Override public void init RecordManager recMan SchemaManager schemaManager AttributeType attributeType throws LdapException IOException
Override SuppressWarnings public synchronized void put PartitionTxn transaction K key V value throws LdapException try if LOG isDebugEnabled
replaced V bt insert key value true if null replaced count if LOG isDebugEnabled LOG debug name key return DupsContainer V values getDupsContainer byte bt find key if values isArrayTree ArrayTree V set values getArrayTree replaced set insert value if replaced null return if set size numDupLimit BTree tree convertToBTree set BTreeRedirect redirect new BTreeRedirect tree getRecordId
if LOG isDebugEnabled LOG debug name key return DupsContainer V values getDupsContainer byte bt find key if values isArrayTree ArrayTree V set values getArrayTree replaced set insert value if replaced null return if set size numDupLimit BTree tree convertToBTree set BTreeRedirect redirect new BTreeRedirect tree getRecordId bt insert key V BTreeRedirectMarshaller INSTANCE serialize redirect true if LOG isDebugEnabled LOG debug name key
replaced set insert value if replaced null return if set size numDupLimit BTree tree convertToBTree set BTreeRedirect redirect new BTreeRedirect tree getRecordId bt insert key V BTreeRedirectMarshaller INSTANCE serialize redirect true if LOG isDebugEnabled LOG debug name key else bt insert key V marshaller serialize set true if LOG isDebugEnabled LOG debug name key count return
return if set size numDupLimit BTree tree convertToBTree set BTreeRedirect redirect new BTreeRedirect tree getRecordId bt insert key V BTreeRedirectMarshaller INSTANCE serialize redirect true if LOG isDebugEnabled LOG debug name key else bt insert key V marshaller serialize set true if LOG isDebugEnabled LOG debug name key count return BTree tree getBTree values getBTreeRedirect replaced V tree insert value Strings EMPTY_BYTES true
SuppressWarnings Override public synchronized void remove PartitionTxn transaction K key V value throws LdapException try if LOG isDebugEnabled
if allowsDuplicates V oldValue bt find key if oldValue null oldValue equals value bt remove key count if LOG isDebugEnabled LOG debug name key value return DupsContainer V values getDupsContainer byte bt find key if values isArrayTree ArrayTree V set values getArrayTree if set remove value null if set isEmpty bt remove key else
DupsContainer V values getDupsContainer byte bt find key if values isArrayTree ArrayTree V set values getArrayTree if set remove value null if set isEmpty bt remove key else bt insert key V marshaller serialize set true count if LOG isDebugEnabled LOG debug name key value return BTree tree getBTree values getBTreeRedirect if tree find value null tree remove value null if tree size numDupLimit
if values isArrayTree ArrayTree V set values getArrayTree if set remove value null if set isEmpty bt remove key else bt insert key V marshaller serialize set true count if LOG isDebugEnabled LOG debug name key value return BTree tree getBTree values getBTreeRedirect if tree find value null tree remove value null if tree size numDupLimit ArrayTree V avlTree convertToArrayTree tree
Override public synchronized void remove PartitionTxn transaction K key throws LdapException try if LOG isDebugEnabled
return Object returned bt remove key if null returned if LOG isDebugEnabled LOG debug name key return if allowsDuplicates this count if LOG isDebugEnabled LOG debug name key return byte serialized byte returned if BTreeRedirectMarshaller isRedirect serialized BTree tree getBTree BTreeRedirectMarshaller INSTANCE deserialize serialized this count tree size
return if allowsDuplicates this count if LOG isDebugEnabled LOG debug name key return byte serialized byte returned if BTreeRedirectMarshaller isRedirect serialized BTree tree getBTree BTreeRedirectMarshaller INSTANCE deserialize serialized this count tree size if LOG isDebugEnabled LOG debug name key recMan delete tree getRecordId duplicateBtrees remove tree getRecordId else
if allowsDuplicates this count if LOG isDebugEnabled LOG debug name key return byte serialized byte returned if BTreeRedirectMarshaller isRedirect serialized BTree tree getBTree BTreeRedirectMarshaller INSTANCE deserialize serialized this count tree size if LOG isDebugEnabled LOG debug name key recMan delete tree getRecordId duplicateBtrees remove tree getRecordId else ArrayTree V set marshaller deserialize serialized
ParentIdAndRdn parentIdAndRdn ParentIdAndRdn object try ByteArrayOutputStream baos new ByteArrayOutputStream ObjectOutput out new ObjectOutputStream baos Rdn rdns parentIdAndRdn getRdns if rdns null rdns length out writeByte else out writeByte rdns length for Rdn rdn rdns rdn writeExternal out out writeUTF parentIdAndRdn getParentId out writeInt parentIdAndRdn getNbChildren out writeInt parentIdAndRdn getNbDescendants out flush if IS_DEBUG LOG debug
else Rdn rdns new Rdn nbRdns for int i i nbRdns i Rdn rdn new Rdn schemaManager rdn readExternal in rdns i rdn parentIdAndRdn setRdns rdns String uuid in readUTF parentIdAndRdn setParentId uuid int nbChildren in readInt int nbDescendants in readInt parentIdAndRdn setNbChildren nbChildren parentIdAndRdn setNbDescendants nbDescendants return parentIdAndRdn catch ClassNotFoundException cnfe
int currentNonce nonceGenerator nextInt tgsReqBody setNonce currentNonce tgsReqBody setEType config getEncryptionTypes PrincipalName principalName new PrincipalName KdcClientUtil extractName serverPrincipal KerberosPrincipal KRB_NT_SRV_HST tgsReqBody setSName principalName TgsReq tgsReq new TgsReq tgsReq setKdcReqBody tgsReqBody PaData authnHeader new PaData authnHeader setPaDataType PaDataType PA_TGS_REQ authnHeader setPaDataValue getEncoded apReq tgsReq addPaData authnHeader try connect KerberosMessage kdcRep sendAndReceiveKrbMsg tgsReq if kdcRep null
authnHeader setPaDataType PaDataType PA_TGS_REQ authnHeader setPaDataValue getEncoded apReq tgsReq addPaData authnHeader try connect KerberosMessage kdcRep sendAndReceiveKrbMsg tgsReq if kdcRep null LOG error throw new KerberosException ErrorType KRB_ERR_GENERIC TIME_OUT_ERROR if kdcRep KrbError LOG debug kdcRep throw new KerberosException KrbError kdcRep TgsRep rep TgsRep kdcRep byte decryptedData cipherTextHandler decrypt sessionKey rep getEncPart KeyUsage TGS_REP_ENC_PART_TGS_SESS_KEY EncTgsRepPart encTgsRepPart KerberosDecoder decodeEncTgsRepPart decryptedData
public byte decrypt EncryptionKey key EncryptedData data KeyUsage usage throws KerberosException
public byte getDecryptedData EncryptionKey key EncryptedData data KeyUsage usage throws KerberosException
public static Object decode KerberosMessageContainer kerberosMessageContainer throws DecoderException ByteBuffer buf kerberosMessageContainer getStream if kerberosMessageContainer isTCP if buf remaining kerberosMessageContainer setTcpLength buf getInt buf mark else return null else buf mark while buf hasRemaining try Asn1Decoder decode buf kerberosMessageContainer if kerberosMessageContainer getState TLVStateEnum PDU_DECODED if IS_DEBUG
try int msgTypeValue IntegerDecoder parse value if msgType null if msgType getValue msgTypeValue LOG debug msgType return String message I18n err I18n ERR_05102_INVALID_MESSAGE_ID Strings dumpBytes value getData LOG error message throw new DecoderException message else KerberosMessageType messageType KerberosMessageType getTypeByValue msgTypeValue if container KdcReqContainer KdcReqContainer container getKdcReq getMessageType messageType return else if container KdcRepContainer KdcRepContainer container getKdcRep getMessageType messageType return
if msgType getValue msgTypeValue LOG debug msgType return String message I18n err I18n ERR_05102_INVALID_MESSAGE_ID Strings dumpBytes value getData LOG error message throw new DecoderException message else KerberosMessageType messageType KerberosMessageType getTypeByValue msgTypeValue if container KdcReqContainer KdcReqContainer container getKdcReq getMessageType messageType return else if container KdcRepContainer KdcRepContainer container getKdcRep getMessageType messageType return String message I18n err I18n ERR_05102_INVALID_MESSAGE_ID Strings dumpBytes value getData LOG error message throw new DecoderException message
public final void action E container throws DecoderException TLV tlv container getCurrentTLV if tlv getLength LOG error I18n err I18n ERR_01308_ZERO_LENGTH_TLV throw new DecoderException I18n err I18n ERR_01309_EMPTY_TLV BerValue value tlv getValue try int pvno IntegerDecoder parse value if pvno LOG error I18n err I18n ERR_01306_VALUE_NOT_IN_RANGE throw new DecoderException if IS_DEBUG LOG debug pvno setPvno pvno container catch IntegerDecoderException ide
public void action AsRepContainer asRepContainer throws DecoderException TLV tlv asRepContainer getCurrentTLV if tlv getLength LOG error I18n err I18n ERR_01308_ZERO_LENGTH_TLV throw new DecoderException I18n err I18n ERR_01309_EMPTY_TLV KdcRepContainer kdcRepContainer new KdcRepContainer asRepContainer getStream AsRep asRep new AsRep kdcRepContainer setKdcRep asRep Asn1Decoder decode asRepContainer getStream kdcRepContainer tlv setExpectedLength tlv getExpectedLength tlv getLength asRepContainer updateParent if asRep getMessageType KerberosMessageType AS_REP throw new DecoderException asRepContainer setAsRep asRep if IS_DEBUG
public void action AsReqContainer asReqContainer throws DecoderException TLV tlv asReqContainer getCurrentTLV if tlv getLength LOG error I18n err I18n ERR_01308_ZERO_LENGTH_TLV throw new DecoderException I18n err I18n ERR_01309_EMPTY_TLV KdcReqContainer kdcReqContainer new KdcReqContainer asReqContainer getStream AsReq asReq new AsReq kdcReqContainer setKdcReq asReq Asn1Decoder decode asReqContainer getStream kdcReqContainer tlv setExpectedLength tlv getExpectedLength tlv getLength asReqContainer updateParent if asReq getMessageType KerberosMessageType AS_REQ throw new DecoderException asReqContainer setAsReq asReq if IS_DEBUG
Override protected void setIntegerValue int value AuthorizationDataContainer authorizationDataContainer AuthorizationType authType AuthorizationType getTypeByValue value AuthorizationData authorizationData authorizationDataContainer getAuthorizationData authorizationData createNewAD authorizationData setCurrentAdType authType if IS_DEBUG
public void action EncAsRepPartContainer encAsRepPartContainer throws DecoderException TLV tlv encAsRepPartContainer getCurrentTLV if tlv getLength LOG error I18n err I18n ERR_01308_ZERO_LENGTH_TLV throw new DecoderException I18n err I18n ERR_01309_EMPTY_TLV EncKdcRepPartContainer encKdcRepPartContainer new EncKdcRepPartContainer encAsRepPartContainer getStream try Asn1Decoder decode encAsRepPartContainer getStream encKdcRepPartContainer catch DecoderException de throw de tlv setExpectedLength tlv getExpectedLength tlv getLength encAsRepPartContainer updateParent EncKdcRepPart encKdcRepPart encKdcRepPartContainer getEncKdcRepPart encAsRepPartContainer getEncAsRepPart setEncKdcRepPart encKdcRepPart if IS_DEBUG
public void action EncKrbCredPartContainer encKrbCredPartContainer throws DecoderException TLV tlv encKrbCredPartContainer getCurrentTLV if tlv getLength LOG error I18n err I18n ERR_01308_ZERO_LENGTH_TLV throw new DecoderException I18n err I18n ERR_01309_EMPTY_TLV KrbCredInfoContainer ticketInfoContainer new KrbCredInfoContainer ticketInfoContainer setStream encKrbCredPartContainer getStream encKrbCredPartContainer rewind Asn1Decoder decode encKrbCredPartContainer getStream ticketInfoContainer KrbCredInfo ticketInfo ticketInfoContainer getKrbCredInfo encKrbCredPartContainer getEncKrbCredPart addTicketInfo ticketInfo tlv setExpectedLength tlv getExpectedLength tlv getLength encKrbCredPartContainer updateParent encKrbCredPartContainer setGrammarEndAllowed true if IS_DEBUG
Override protected void setIntegerValue int value EncryptedDataContainer encryptedDataContainer EncryptionType encryptionType EncryptionType getTypeByValue value EncryptedData encryptedData encryptedDataContainer getEncryptedData encryptedData setEType encryptionType if IS_DEBUG
Override protected void setIntegerValue int value EncryptionKeyContainer encryptionKeyContainer EncryptionKey encKey encryptionKeyContainer getEncryptionKey EncryptionType encryptionType EncryptionType getTypeByValue value encKey setKeyType encryptionType if IS_DEBUG
TLV tlv eTypeInfo2EntryContainer getCurrentTLV if tlv getLength LOG error I18n err I18n ERR_01308_ZERO_LENGTH_TLV throw new DecoderException I18n err I18n ERR_01309_EMPTY_TLV BerValue value tlv getValue EncryptionType etype null ETypeInfo2Entry etypeInfo2Entry eTypeInfo2EntryContainer getETypeInfo2Entry try int eType IntegerDecoder parse value etype EncryptionType getTypeByValue eType etypeInfo2Entry setEType etype if IS_DEBUG LOG debug etype eTypeInfo2EntryContainer setGrammarEndAllowed true catch IntegerDecoderException ide
TLV tlv eTypeInfoEntryContainer getCurrentTLV if tlv getLength LOG error I18n err I18n ERR_01308_ZERO_LENGTH_TLV throw new DecoderException I18n err I18n ERR_01309_EMPTY_TLV BerValue value tlv getValue EncryptionType etype null ETypeInfoEntry etypeInfoEntry eTypeInfoEntryContainer getETypeInfoEntry try int eType IntegerDecoder parse value etype EncryptionType getTypeByValue eType etypeInfoEntry setEType etype if IS_DEBUG LOG debug etype eTypeInfoEntryContainer setGrammarEndAllowed true catch IntegerDecoderException ide
Override protected void setIntegerValue int value HostAddressContainer hostAddressContainer HostAddress hostAddressData hostAddressContainer getHostAddress HostAddrType hostAddrType HostAddrType getTypeByOrdinal value hostAddressData setAddrType hostAddrType if IS_DEBUG
Override protected void setOctetString byte data HostAddressContainer hostAddressContainer hostAddressContainer getHostAddress setAddress data hostAddressContainer setGrammarEndAllowed true if IS_DEBUG
public void action KdcRepContainer kdcRepContainer throws DecoderException TLV tlv kdcRepContainer getCurrentTLV if tlv getLength LOG error I18n err I18n ERR_01308_ZERO_LENGTH_TLV throw new DecoderException I18n err I18n ERR_01309_EMPTY_TLV PaDataContainer paDataContainer new PaDataContainer paDataContainer setStream kdcRepContainer getStream kdcRepContainer rewind Asn1Decoder decode kdcRepContainer getStream paDataContainer kdcRepContainer updateParent tlv setExpectedLength tlv getExpectedLength tlv getLength PaData paData paDataContainer getPaData KdcRep kdcRep kdcRepContainer getKdcRep kdcRep addPaData paData if IS_DEBUG
public void action KdcReqContainer kdcReqContainer throws DecoderException TLV tlv kdcReqContainer getCurrentTLV if tlv getLength LOG error I18n err I18n ERR_01308_ZERO_LENGTH_TLV throw new DecoderException I18n err I18n ERR_01309_EMPTY_TLV PaDataContainer paDataContainer new PaDataContainer paDataContainer setStream kdcReqContainer getStream kdcReqContainer rewind Asn1Decoder decode kdcReqContainer getStream paDataContainer kdcReqContainer updateParent tlv setExpectedLength tlv getExpectedLength tlv getLength PaData paData paDataContainer getPaData KdcReq kdcReq kdcReqContainer getKdcReq kdcReq addPaData paData if IS_DEBUG
public void action KdcReqBodyContainer kdcReqBodyContainer throws DecoderException TLV tlv kdcReqBodyContainer getCurrentTLV if tlv getLength LOG error I18n err I18n ERR_01308_ZERO_LENGTH_TLV throw new DecoderException I18n err I18n ERR_01309_EMPTY_TLV TicketContainer ticketContainer new TicketContainer kdcReqBodyContainer getStream kdcReqBodyContainer rewind Asn1Decoder decode kdcReqBodyContainer getStream ticketContainer tlv setExpectedLength tlv getExpectedLength tlv getLength kdcReqBodyContainer updateParent Ticket ticket ticketContainer getTicket KdcReqBody kdcReqBody kdcReqBodyContainer getKdcReqBody kdcReqBody addAdditionalTicket ticket kdcReqBodyContainer setGrammarEndAllowed true if IS_DEBUG
if tlv getLength LOG error I18n err I18n ERR_744_NULL_PDU_LENGTH throw new DecoderException I18n err I18n ERR_744_NULL_PDU_LENGTH PrincipalName principalName principalNameContainer getPrincipalName BerValue value tlv getValue if ALLOW_UTF8_NAMES KerberosUtils isKerberosString value getData String nameString Strings utf8ToString value getData principalName addName nameString principalNameContainer setGrammarEndAllowed true if IS_DEBUG LOG debug nameString else String valBytes Strings dumpBytes value getData String valStr Strings utf8ToString value getData String valAll valBytes valStr
Override protected void setIntegerValue int value PrincipalNameContainer principalNameContainer PrincipalName principalName principalNameContainer getPrincipalName PrincipalNameType principalNameType PrincipalNameType getTypeByValue value principalName setNameType principalNameType if IS_DEBUG
public void action TgsRepContainer tgsRepContainer throws DecoderException TLV tlv tgsRepContainer getCurrentTLV if tlv getLength LOG error I18n err I18n ERR_01308_ZERO_LENGTH_TLV throw new DecoderException I18n err I18n ERR_01309_EMPTY_TLV KdcRepContainer kdcRepContainer new KdcRepContainer tgsRepContainer getStream TgsRep tgsRep new TgsRep kdcRepContainer setKdcRep tgsRep Asn1Decoder decode tgsRepContainer getStream kdcRepContainer tlv setExpectedLength tlv getExpectedLength tlv getLength tgsRepContainer updateParent if tgsRep getMessageType KerberosMessageType TGS_REP throw new DecoderException tgsRepContainer setTgsRep tgsRep if IS_DEBUG
public void action TgsReqContainer tgsReqContainer throws DecoderException TLV tlv tgsReqContainer getCurrentTLV if tlv getLength LOG error I18n err I18n ERR_01308_ZERO_LENGTH_TLV throw new DecoderException I18n err I18n ERR_01309_EMPTY_TLV KdcReqContainer kdcReqContainer new KdcReqContainer tgsReqContainer getStream TgsReq tgsReq new TgsReq kdcReqContainer setKdcReq tgsReq Asn1Decoder decode tgsReqContainer getStream kdcReqContainer tlv setExpectedLength tlv getExpectedLength tlv getLength tgsReqContainer updateParent if tgsReq getMessageType KerberosMessageType TGS_REQ throw new DecoderException tgsReqContainer setTgsReq tgsReq if IS_DEBUG
if buffer null throw new EncoderException I18n err I18n ERR_148 try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes adAndOrSeqLength buffer put byte KerberosConstants AD_AND_OR_CONDITION_COUNT_TAG buffer put byte conditionCountTagLength BerValue encode buffer conditionCount buffer put byte KerberosConstants AD_AND_OR_ELEMENTS_TAG buffer put byte elementsTagLength elements encode buffer catch BufferOverflowException boe LOG error I18n err I18n ERR_139 TLV getNbBytes adAndOrSeqLength adAndOrSeqLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe if IS_DEBUG
buffer put byte adCheksumTagLength adChecksum encode buffer if irealm null buffer put byte KerberosConstants AD_KDC_ISSUED_I_REALM_TAG buffer put byte irealmTagLength buffer put UniversalTag GENERAL_STRING getValue buffer put byte irealmBytes length buffer put irealmBytes if isname null buffer put byte KerberosConstants AD_KDC_ISSUED_I_SNAME_TAG buffer put byte isnameTagLength isname encode buffer buffer put byte KerberosConstants AD_KDC_ISSUED_ELEMENTS_TAG buffer put byte elementsTagLength elements encode buffer
buffer put byte KerberosConstants AD_KDC_ISSUED_I_REALM_TAG buffer put byte irealmTagLength buffer put UniversalTag GENERAL_STRING getValue buffer put byte irealmBytes length buffer put irealmBytes if isname null buffer put byte KerberosConstants AD_KDC_ISSUED_I_SNAME_TAG buffer put byte isnameTagLength isname encode buffer buffer put byte KerberosConstants AD_KDC_ISSUED_ELEMENTS_TAG buffer put byte elementsTagLength elements encode buffer catch BufferOverflowException boe LOG error I18n err I18n ERR_139 TLV getNbBytes adKdcIssuedSeqLength adKdcIssuedSeqLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes authorizationDataSeqSeqLen int i for AuthorizationDataEntry ad authorizationData buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes authorizationDataSeqLen i buffer put byte KerberosConstants AUTHORIZATION_DATA_ADTYPE_TAG buffer put TLV getBytes adTypeTagLen i BerValue encode buffer ad getAdType getValue buffer put byte KerberosConstants AUTHORIZATION_DATA_ADDATA_TAG buffer put TLV getBytes adDataTagLen i BerValue encode buffer ad getAdDataRef i catch BufferOverflowException boe
buffer put TLV getBytes authorizationDataSeqSeqLen int i for AuthorizationDataEntry ad authorizationData buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes authorizationDataSeqLen i buffer put byte KerberosConstants AUTHORIZATION_DATA_ADTYPE_TAG buffer put TLV getBytes adTypeTagLen i BerValue encode buffer ad getAdType getValue buffer put byte KerberosConstants AUTHORIZATION_DATA_ADDATA_TAG buffer put TLV getBytes adDataTagLen i BerValue encode buffer ad getAdDataRef i catch BufferOverflowException boe LOG error I18n err I18n ERR_139 TLV getNbBytes authorizationDataSeqSeqLen authorizationDataSeqSeqLen buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
if buffer null throw new EncoderException I18n err I18n ERR_148 try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes checksumLength buffer put byte KerberosConstants CHECKSUM_TYPE_TAG buffer put TLV getBytes checksumTypeLength BerValue encode buffer cksumtype getValue buffer put byte KerberosConstants CHECKSUM_CHECKSUM_TAG buffer put TLV getBytes checksumBytesLength BerValue encode buffer checksum catch BufferOverflowException boe log error I18n err I18n ERR_140 TLV getNbBytes checksumLength checksumLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe if IS_DEBUG
buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes etypeInfo2EntrySeqLength buffer put byte KerberosConstants ETYPE_INFO2_ENTRY_ETYPE_TAG buffer put TLV getBytes etypeTagLength BerValue encode buffer etype getValue if salt null buffer put byte KerberosConstants ETYPE_INFO2_ENTRY_SALT_TAG buffer put TLV getBytes saltTagLength buffer put UniversalTag GENERAL_STRING getValue buffer put TLV getBytes saltBytes length buffer put saltBytes if s2kparams null buffer put byte KerberosConstants ETYPE_INFO2_ENTRY_S2KPARAMS_TAG buffer put TLV getBytes saltTagLength BerValue encode buffer s2kparams
buffer put TLV getBytes etypeTagLength BerValue encode buffer etype getValue if salt null buffer put byte KerberosConstants ETYPE_INFO2_ENTRY_SALT_TAG buffer put TLV getBytes saltTagLength buffer put UniversalTag GENERAL_STRING getValue buffer put TLV getBytes saltBytes length buffer put saltBytes if s2kparams null buffer put byte KerberosConstants ETYPE_INFO2_ENTRY_S2KPARAMS_TAG buffer put TLV getBytes saltTagLength BerValue encode buffer s2kparams catch BufferOverflowException boe LOG error I18n err I18n ERR_145 TLV getNbBytes etypeInfo2EntrySeqLength etypeInfo2EntrySeqLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
throw new EncoderException I18n err I18n ERR_148 try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes etypeInfoEntrySeqLength buffer put byte KerberosConstants ETYPE_INFO_ENTRY_ETYPE_TAG buffer put TLV getBytes etypeTagLength BerValue encode buffer etype getValue if salt null buffer put byte KerberosConstants ETYPE_INFO_ENTRY_SALT_TAG buffer put TLV getBytes saltTagLength BerValue encode buffer salt catch BufferOverflowException boe LOG error I18n err I18n ERR_145 TLV getNbBytes etypeInfoEntrySeqLength etypeInfoEntrySeqLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe if IS_DEBUG
buffer put byte KerberosConstants ENC_KDC_REP_PART_RENEW_TILL_TAG buffer put TLV getBytes 0x11 buffer put UniversalTag GENERALIZED_TIME getValue buffer put byte 0x0F buffer put renewTill getBytes buffer put byte KerberosConstants ENC_KDC_REP_PART_SREALM_TAG buffer put TLV getBytes srealmLength buffer put UniversalTag GENERAL_STRING getValue buffer put TLV getBytes srealmBytes length buffer put srealmBytes buffer put byte KerberosConstants ENC_KDC_REP_PART_SNAME_TAG buffer put TLV getBytes snameLength sname encode buffer if caddr null buffer put byte KerberosConstants ENC_KDC_REP_PART_CADDR_TAG
buffer put byte 0x0F buffer put renewTill getBytes buffer put byte KerberosConstants ENC_KDC_REP_PART_SREALM_TAG buffer put TLV getBytes srealmLength buffer put UniversalTag GENERAL_STRING getValue buffer put TLV getBytes srealmBytes length buffer put srealmBytes buffer put byte KerberosConstants ENC_KDC_REP_PART_SNAME_TAG buffer put TLV getBytes snameLength sname encode buffer if caddr null buffer put byte KerberosConstants ENC_KDC_REP_PART_CADDR_TAG buffer put TLV getBytes caddrLength caddr encode buffer catch BufferOverflowException boe
buffer put byte KerberosConstants ENC_KRB_CRED_PART_TIMESTAMP_TAG buffer put TLV getBytes timestampLen buffer put UniversalTag GENERALIZED_TIME getValue buffer put byte 0x0F buffer put timestampBytes if usec null buffer put byte KerberosConstants ENC_KRB_CRED_PART_USEC_TAG buffer put TLV getBytes usecLen BerValue encode buffer usec if senderAddress null buffer put byte KerberosConstants ENC_KRB_CRED_PART_SENDER_ADDRESS_TAG buffer put TLV getBytes senderAddressLen senderAddress encode buffer if recipientAddress null buffer put byte KerberosConstants ENC_KRB_CRED_PART_RECIPIENT_ADDRESS_TAG
buffer put byte 0x0F buffer put timestampBytes if usec null buffer put byte KerberosConstants ENC_KRB_CRED_PART_USEC_TAG buffer put TLV getBytes usecLen BerValue encode buffer usec if senderAddress null buffer put byte KerberosConstants ENC_KRB_CRED_PART_SENDER_ADDRESS_TAG buffer put TLV getBytes senderAddressLen senderAddress encode buffer if recipientAddress null buffer put byte KerberosConstants ENC_KRB_CRED_PART_RECIPIENT_ADDRESS_TAG buffer put TLV getBytes recipientAddressLen recipientAddress encode buffer catch BufferOverflowException boe
if usec null buffer put byte KerberosConstants KRB_SAFE_BODY_USEC_TAG buffer put TLV getBytes usecLen BerValue encode buffer usec if seqNumber null buffer put byte KerberosConstants KRB_SAFE_BODY_SEQ_NUMBER_TAG buffer put TLV getBytes seqNumberLen BerValue encode buffer seqNumber buffer put byte KerberosConstants KRB_SAFE_BODY_SENDER_ADDRESS_TAG buffer put TLV getBytes senderAddressLen senderAddress encode buffer if recipientAddress null buffer put byte KerberosConstants KRB_SAFE_BODY_RECIPIENT_ADDRESS_TAG buffer put TLV getBytes recipientAddressLen recipientAddress encode buffer
buffer put TLV getBytes usecLen BerValue encode buffer usec if seqNumber null buffer put byte KerberosConstants KRB_SAFE_BODY_SEQ_NUMBER_TAG buffer put TLV getBytes seqNumberLen BerValue encode buffer seqNumber buffer put byte KerberosConstants KRB_SAFE_BODY_SENDER_ADDRESS_TAG buffer put TLV getBytes senderAddressLen senderAddress encode buffer if recipientAddress null buffer put byte KerberosConstants KRB_SAFE_BODY_RECIPIENT_ADDRESS_TAG buffer put TLV getBytes recipientAddressLen recipientAddress encode buffer catch BufferOverflowException boe log error I18n err I18n ERR_735_CANNOT_ENCODE_KRBSAFEBODY TLV getNbBytes encKrbPrivPartLen encKrbPrivPartLen buffer capacity
buffer put byte 0x0F buffer put endTimeBytes if renewtill null buffer put byte KerberosConstants ENC_TICKET_PART_RENEWTILL_TAG buffer put TLV getBytes renewtillLen buffer put UniversalTag GENERALIZED_TIME getValue buffer put byte 0x0F buffer put renewtillBytes if clientAddresses null buffer put byte KerberosConstants ENC_TICKET_PART_CADDR_TAG buffer put TLV getBytes clientAddressesLen clientAddresses encode buffer if authorizationData null buffer put byte KerberosConstants ENC_TICKET_PART_AUTHORIZATION_DATA_TAG buffer put TLV getBytes authzDataLen
buffer put byte KerberosConstants ENC_TICKET_PART_RENEWTILL_TAG buffer put TLV getBytes renewtillLen buffer put UniversalTag GENERALIZED_TIME getValue buffer put byte 0x0F buffer put renewtillBytes if clientAddresses null buffer put byte KerberosConstants ENC_TICKET_PART_CADDR_TAG buffer put TLV getBytes clientAddressesLen clientAddresses encode buffer if authorizationData null buffer put byte KerberosConstants ENC_TICKET_PART_AUTHORIZATION_DATA_TAG buffer put TLV getBytes authzDataLen authorizationData encode buffer catch BufferOverflowException boe log error I18n err I18n ERR_742_CANNOT_ENCODE_ENC_TICKET_PART TLV getNbBytes encTikcetPartLen encTikcetPartLen buffer capacity
throw new EncoderException I18n err I18n ERR_148 try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes encryptedDataSeqLength buffer put byte 0xA0 buffer put TLV getBytes eTypeTagLength BerValue encode buffer eType getValue if hasKvno buffer put byte 0xA1 buffer put TLV getBytes kvnoTagLength BerValue encode buffer kvno buffer put byte 0xA2 buffer put TLV getBytes cipherTagLength BerValue encode buffer cipher catch BufferOverflowException boe
buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes encryptedDataSeqLength buffer put byte 0xA0 buffer put TLV getBytes eTypeTagLength BerValue encode buffer eType getValue if hasKvno buffer put byte 0xA1 buffer put TLV getBytes kvnoTagLength BerValue encode buffer kvno buffer put byte 0xA2 buffer put TLV getBytes cipherTagLength BerValue encode buffer cipher catch BufferOverflowException boe log error I18n err I18n ERR_141 TLV getNbBytes encryptedDataSeqLength encryptedDataSeqLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
if buffer null throw new EncoderException I18n err I18n ERR_148 try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes encryptionKeyLength buffer put byte KerberosConstants ENCRYPTION_KEY_TYPE_TAG buffer put TLV getBytes keyTypeLength BerValue encode buffer keyType getValue buffer put byte KerberosConstants ENCRYPTION_KEY_VALUE_TAG buffer put TLV getBytes keyValueLength BerValue encode buffer keyValue catch BufferOverflowException boe log error I18n err I18n ERR_142 TLV getNbBytes encryptionKeyLength encryptionKeyLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe if IS_DEBUG
if buffer null throw new EncoderException I18n err I18n ERR_148 try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes hostAddressLength buffer put byte 0xA0 buffer put TLV getBytes addrTypeLength BerValue encode buffer addrType getValue buffer put byte 0xA1 buffer put TLV getBytes addressLength BerValue encode buffer address catch BufferOverflowException boe LOG error I18n err I18n ERR_143 TLV getNbBytes hostAddressLength hostAddressLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe if IS_DEBUG
if renewtill null buffer put byte KerberosConstants KRB_CRED_INFO_RENEWTILL_TAG buffer put TLV getBytes renewtillLen buffer put UniversalTag GENERALIZED_TIME getValue buffer put byte 0x0F buffer put renewtillBytes if sRealm null buffer put byte KerberosConstants KRB_CRED_INFO_SREALM_TAG buffer put TLV getBytes sRealmLen buffer put UniversalTag GENERAL_STRING getValue buffer put TLV getBytes sRealmBytes length buffer put sRealmBytes if sName null buffer put byte KerberosConstants KRB_CRED_INFO_SNAME_TAG buffer put TLV getBytes sNameLen
buffer put TLV getBytes renewtillLen buffer put UniversalTag GENERALIZED_TIME getValue buffer put byte 0x0F buffer put renewtillBytes if sRealm null buffer put byte KerberosConstants KRB_CRED_INFO_SREALM_TAG buffer put TLV getBytes sRealmLen buffer put UniversalTag GENERAL_STRING getValue buffer put TLV getBytes sRealmBytes length buffer put sRealmBytes if sName null buffer put byte KerberosConstants KRB_CRED_INFO_SNAME_TAG buffer put TLV getBytes sNameLen sName encode buffer if clientAddresses null
if usec null buffer put byte KerberosConstants KRB_SAFE_BODY_USEC_TAG buffer put TLV getBytes usecLen BerValue encode buffer usec if seqNumber null buffer put byte KerberosConstants KRB_SAFE_BODY_SEQ_NUMBER_TAG buffer put TLV getBytes seqNumberLen BerValue encode buffer seqNumber buffer put byte KerberosConstants KRB_SAFE_BODY_SENDER_ADDRESS_TAG buffer put TLV getBytes senderAddressLen senderAddress encode buffer if recipientAddress null buffer put byte KerberosConstants KRB_SAFE_BODY_RECIPIENT_ADDRESS_TAG buffer put TLV getBytes recipientAddressLen recipientAddress encode buffer
buffer put TLV getBytes usecLen BerValue encode buffer usec if seqNumber null buffer put byte KerberosConstants KRB_SAFE_BODY_SEQ_NUMBER_TAG buffer put TLV getBytes seqNumberLen BerValue encode buffer seqNumber buffer put byte KerberosConstants KRB_SAFE_BODY_SENDER_ADDRESS_TAG buffer put TLV getBytes senderAddressLen senderAddress encode buffer if recipientAddress null buffer put byte KerberosConstants KRB_SAFE_BODY_RECIPIENT_ADDRESS_TAG buffer put TLV getBytes recipientAddressLen recipientAddress encode buffer catch BufferOverflowException boe log error I18n err I18n ERR_735_CANNOT_ENCODE_KRBSAFEBODY TLV getNbBytes krbSafeBodySeqLen krbSafeBodySeqLen buffer capacity
try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes lastReqSeqSeqLen int i for LastReqEntry lre lastReqs buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes lastReqSeqLen i buffer put byte KerberosConstants LAST_REQ_LR_TYPE_TAG buffer put TLV getBytes lrTypeTagLen i BerValue encode buffer lre getLrType getValue buffer put byte KerberosConstants LAST_REQ_LR_VALUE_TAG buffer put TLV getBytes lrValueTagLen i buffer put UniversalTag GENERALIZED_TIME getValue buffer put byte 0x0F buffer put lre getLrValue getBytes
int i for LastReqEntry lre lastReqs buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes lastReqSeqLen i buffer put byte KerberosConstants LAST_REQ_LR_TYPE_TAG buffer put TLV getBytes lrTypeTagLen i BerValue encode buffer lre getLrType getValue buffer put byte KerberosConstants LAST_REQ_LR_VALUE_TAG buffer put TLV getBytes lrValueTagLen i buffer put UniversalTag GENERALIZED_TIME getValue buffer put byte 0x0F buffer put lre getLrValue getBytes catch BufferOverflowException boe LOG error I18n err I18n ERR_139 TLV getNbBytes lastReqSeqSeqLen lastReqSeqSeqLen buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
if buffer null throw new EncoderException I18n err I18n ERR_148 try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes preAuthenticationDataSeqLength buffer put byte KerberosConstants PADATA_TYPE_TAG buffer put TLV getBytes paDataTypeTagLength BerValue encode buffer paDataType getValue buffer put byte KerberosConstants PADATA_VALUE_TAG buffer put TLV getBytes paDataValueTagLength BerValue encode buffer paDataValue catch BufferOverflowException boe log error I18n err I18n ERR_145 TLV getNbBytes preAuthenticationDataSeqLength preAuthenticationDataSeqLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe if IS_DEBUG
if buffer null throw new EncoderException I18n err I18n ERR_148 try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes paEncTsEncLength buffer put byte KerberosConstants PA_ENC_TS_ENC_PA_TIMESTAMP_TAG buffer put byte 0x11 buffer put UniversalTag GENERALIZED_TIME getValue buffer put byte 0x0F buffer put patimestamp getBytes if pausec null buffer put byte KerberosConstants PA_ENC_TS_ENC_PA_USEC_TAG buffer put TLV getBytes paUsecLength BerValue encode buffer pausec catch BufferOverflowException boe
try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes paEncTsEncLength buffer put byte KerberosConstants PA_ENC_TS_ENC_PA_TIMESTAMP_TAG buffer put byte 0x11 buffer put UniversalTag GENERALIZED_TIME getValue buffer put byte 0x0F buffer put patimestamp getBytes if pausec null buffer put byte KerberosConstants PA_ENC_TS_ENC_PA_USEC_TAG buffer put TLV getBytes paUsecLength BerValue encode buffer pausec catch BufferOverflowException boe log error I18n err I18n ERR_140 TLV getNbBytes paEncTsEncLength paEncTsEncLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
BerValue encode buffer nameType getValue buffer put byte 0xA1 buffer put TLV getBytes principalStringsTagLength buffer put UniversalTag SEQUENCE getValue if nameString null nameString isEmpty buffer put byte 0x00 else buffer put TLV getBytes principalStringsSeqLength for byte name nameBytes buffer put UniversalTag GENERAL_STRING getValue if name null name length buffer put byte 0x00 else buffer put TLV getBytes name length buffer put name
buffer put UniversalTag SEQUENCE getValue if nameString null nameString isEmpty buffer put byte 0x00 else buffer put TLV getBytes principalStringsSeqLength for byte name nameBytes buffer put UniversalTag GENERAL_STRING getValue if name null name length buffer put byte 0x00 else buffer put TLV getBytes name length buffer put name catch BufferOverflowException boe LOG error I18n err I18n ERR_146 TLV getNbBytes principalNameSeqLength principalNameSeqLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
if buffer null throw new EncoderException I18n err I18n ERR_148 try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes transitedEncodingLength buffer put byte KerberosConstants TRANSITED_ENCODING_TR_TYPE_TAG buffer put TLV getBytes trTypeLength BerValue encode buffer trType getValue buffer put byte KerberosConstants TRANSITED_ENCODING_CONTENTS_TAG buffer put TLV getBytes contentsLength BerValue encode buffer contents catch BufferOverflowException boe log error I18n err I18n ERR_147 TLV getNbBytes transitedEncodingLength transitedEncodingLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe if IS_DEBUG
try buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes typedDataSeqSeqLength int i for TD td typedDataList buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes typedDataSeqLength i buffer put byte KerberosConstants TYPED_DATA_TDTYPE_TAG buffer put TLV getBytes dataTypeTagLength i BerValue encode buffer td dataType if td dataValue null buffer put byte KerberosConstants TYPED_DATA_TDDATA_TAG buffer put TLV getBytes dataValueTagLength i BerValue encode buffer td dataValue i
int i for TD td typedDataList buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes typedDataSeqLength i buffer put byte KerberosConstants TYPED_DATA_TDTYPE_TAG buffer put TLV getBytes dataTypeTagLength i BerValue encode buffer td dataType if td dataValue null buffer put byte KerberosConstants TYPED_DATA_TDDATA_TAG buffer put TLV getBytes dataValueTagLength i BerValue encode buffer td dataValue i catch BufferOverflowException boe LOG error I18n err I18n ERR_743_CANNOT_ENCODE_TYPED_DATA TLV getNbBytes typedDataSeqSeqLength typedDataSeqSeqLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
try buffer put byte KerberosConstants AP_REP_TAG buffer put TLV getBytes apRepSeqLength buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes apRepLength buffer put byte KerberosConstants AP_REP_PVNO_TAG buffer put TLV getBytes pvnoLength BerValue encode buffer getProtocolVersionNumber buffer put byte KerberosConstants AP_REP_MSG_TYPE_TAG buffer put TLV getBytes msgTypeLength BerValue encode buffer getMessageType getValue buffer put byte KerberosConstants AP_REP_ENC_PART_TAG buffer put TLV getBytes encPartLength encPart encode buffer catch BufferOverflowException boe
buffer put TLV getBytes apRepSeqLength buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes apRepLength buffer put byte KerberosConstants AP_REP_PVNO_TAG buffer put TLV getBytes pvnoLength BerValue encode buffer getProtocolVersionNumber buffer put byte KerberosConstants AP_REP_MSG_TYPE_TAG buffer put TLV getBytes msgTypeLength BerValue encode buffer getMessageType getValue buffer put byte KerberosConstants AP_REP_ENC_PART_TAG buffer put TLV getBytes encPartLength encPart encode buffer catch BufferOverflowException boe LOG error I18n err I18n ERR_137 TLV getNbBytes apRepLength apRepLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
buffer put byte KerberosConstants AP_REQ_PVNO_TAG buffer put TLV getBytes pvnoLength BerValue encode buffer getProtocolVersionNumber buffer put byte KerberosConstants AP_REQ_MSG_TYPE_TAG buffer put TLV getBytes msgTypeLength BerValue encode buffer getMessageType getValue buffer put byte KerberosConstants AP_REQ_AP_OPTIONS_TAG buffer put TLV getBytes apOptionsLength BerValue encode buffer apOptions buffer put byte KerberosConstants AP_REQ_TICKET_TAG buffer put TLV getBytes ticketLength ticket encode buffer buffer put byte KerberosConstants AP_REQ_AUTHENTICATOR_TAG buffer put TLV getBytes authenticatorLength authenticator encode buffer
buffer put byte KerberosConstants AP_REQ_MSG_TYPE_TAG buffer put TLV getBytes msgTypeLength BerValue encode buffer getMessageType getValue buffer put byte KerberosConstants AP_REQ_AP_OPTIONS_TAG buffer put TLV getBytes apOptionsLength BerValue encode buffer apOptions buffer put byte KerberosConstants AP_REQ_TICKET_TAG buffer put TLV getBytes ticketLength ticket encode buffer buffer put byte KerberosConstants AP_REQ_AUTHENTICATOR_TAG buffer put TLV getBytes authenticatorLength authenticator encode buffer catch BufferOverflowException boe LOG error I18n err I18n ERR_137 TLV getNbBytes apReqLength apReqLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
buffer put TLV getBytes ctimeLength buffer put UniversalTag GENERALIZED_TIME getValue buffer put byte 0x0F buffer put ctime getBytes if subKey null buffer put byte KerberosConstants AUTHENTICATOR_SUBKEY_TAG buffer put TLV getBytes subkeyLength subKey encode buffer if seqNumber null buffer put byte KerberosConstants AUTHENTICATOR_SEQ_NUMBER_TAG buffer put TLV getBytes seqNumberLength BerValue encode buffer seqNumber if authorizationData null buffer put byte KerberosConstants AUTHENTICATOR_AUTHORIZATION_DATA_TAG buffer put TLV getBytes authorizationDataLength
buffer put ctime getBytes if subKey null buffer put byte KerberosConstants AUTHENTICATOR_SUBKEY_TAG buffer put TLV getBytes subkeyLength subKey encode buffer if seqNumber null buffer put byte KerberosConstants AUTHENTICATOR_SEQ_NUMBER_TAG buffer put TLV getBytes seqNumberLength BerValue encode buffer seqNumber if authorizationData null buffer put byte KerberosConstants AUTHENTICATOR_AUTHORIZATION_DATA_TAG buffer put TLV getBytes authorizationDataLength authorizationData encode buffer catch BufferOverflowException boe LOG error I18n err I18n ERR_139 TLV getNbBytes buffer capacity
buffer put byte 0x11 buffer put byte UniversalTag GENERALIZED_TIME getValue buffer put byte 0x0F buffer put ctime getBytes buffer put byte KerberosConstants ENC_AP_REP_PART_CUSEC_TAG buffer put TLV getBytes cusecLength BerValue encode buffer cusec if subkey null buffer put byte KerberosConstants ENC_AP_REP_PART_SUB_KEY_TAG buffer put TLV getBytes subKeyLength subkey encode buffer if seqNumber null buffer put byte KerberosConstants ENC_AP_REP_PART_SEQ_NUMBER_TAG buffer put TLV getBytes seqNumberLength BerValue encode buffer seqNumber
buffer put ctime getBytes buffer put byte KerberosConstants ENC_AP_REP_PART_CUSEC_TAG buffer put TLV getBytes cusecLength BerValue encode buffer cusec if subkey null buffer put byte KerberosConstants ENC_AP_REP_PART_SUB_KEY_TAG buffer put TLV getBytes subKeyLength subkey encode buffer if seqNumber null buffer put byte KerberosConstants ENC_AP_REP_PART_SEQ_NUMBER_TAG buffer put TLV getBytes seqNumberLength BerValue encode buffer seqNumber catch BufferOverflowException boe LOG error I18n err I18n ERR_139 TLV getNbBytes encApRepPartLength encApRepPartLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
buffer put byte KerberosConstants KRB_CRED_PVNO_TAG buffer put TLV getBytes pvnoLen BerValue encode buffer getProtocolVersionNumber buffer put byte KerberosConstants KRB_CRED_MSGTYPE_TAG buffer put TLV getBytes msgTypeLen BerValue encode buffer getMessageType getValue buffer put byte KerberosConstants KRB_CRED_TICKETS_TAG buffer put TLV getBytes ticketsLen buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes ticketsSeqLen for Ticket t tickets t encode buffer buffer put byte KerberosConstants KRB_CRED_ENCPART_TAG buffer put TLV getBytes encPartLen encPart encode buffer
buffer put byte KerberosConstants KRB_CRED_MSGTYPE_TAG buffer put TLV getBytes msgTypeLen BerValue encode buffer getMessageType getValue buffer put byte KerberosConstants KRB_CRED_TICKETS_TAG buffer put TLV getBytes ticketsLen buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes ticketsSeqLen for Ticket t tickets t encode buffer buffer put byte KerberosConstants KRB_CRED_ENCPART_TAG buffer put TLV getBytes encPartLen encPart encode buffer catch BufferOverflowException boe log error I18n err I18n ERR_741_CANNOT_ENCODE_KRB_CRED TLV getNbBytes krbCredLen krbCredLen buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
buffer put byte KerberosConstants KRB_ERROR_REALM_TAG buffer put TLV getBytes realmLength buffer put UniversalTag GENERAL_STRING getValue buffer put TLV getBytes realmBytes length buffer put realmBytes buffer put byte KerberosConstants KRB_ERROR_SNAME_TAG buffer put TLV getBytes sNameLength sName encode buffer if eText null buffer put byte KerberosConstants KRB_ERROR_ETEXT_TAG buffer put TLV getBytes eTextLength buffer put UniversalTag GENERAL_STRING getValue buffer put TLV getBytes eTextBytes length buffer put eTextBytes if eData null
buffer put UniversalTag GENERAL_STRING getValue buffer put TLV getBytes realmBytes length buffer put realmBytes buffer put byte KerberosConstants KRB_ERROR_SNAME_TAG buffer put TLV getBytes sNameLength sName encode buffer if eText null buffer put byte KerberosConstants KRB_ERROR_ETEXT_TAG buffer put TLV getBytes eTextLength buffer put UniversalTag GENERAL_STRING getValue buffer put TLV getBytes eTextBytes length buffer put eTextBytes if eData null buffer put byte KerberosConstants KRB_ERROR_EDATA_TAG buffer put TLV getBytes eDataLength
try buffer put byte KerberosConstants KRB_PRIV_TAG buffer put TLV getBytes krbPrivLen buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes krbPrivSeqLen buffer put byte KerberosConstants KRB_PRIV_PVNO_TAG buffer put TLV getBytes pvnoLen BerValue encode buffer getProtocolVersionNumber buffer put byte KerberosConstants KRB_PRIV_MSGTYPE_TAG buffer put TLV getBytes msgTypeLength BerValue encode buffer getMessageType getValue buffer put byte KerberosConstants KRB_PRIV_ENC_PART_TAG buffer put TLV getBytes encPartLen encPart encode buffer catch BufferOverflowException boe
buffer put TLV getBytes krbPrivLen buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes krbPrivSeqLen buffer put byte KerberosConstants KRB_PRIV_PVNO_TAG buffer put TLV getBytes pvnoLen BerValue encode buffer getProtocolVersionNumber buffer put byte KerberosConstants KRB_PRIV_MSGTYPE_TAG buffer put TLV getBytes msgTypeLength BerValue encode buffer getMessageType getValue buffer put byte KerberosConstants KRB_PRIV_ENC_PART_TAG buffer put TLV getBytes encPartLen encPart encode buffer catch BufferOverflowException boe log error I18n err I18n ERR_738_CANNOT_ENCODE_KRB_PRIV TLV getNbBytes krbPrivLen krbPrivLen buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
buffer put TLV getBytes krbSafeLen buffer put UniversalTag SEQUENCE getValue buffer put TLV getBytes krbSafeSeqLen buffer put byte KerberosConstants KRB_SAFE_PVNO_TAG buffer put TLV getBytes pvnoLen BerValue encode buffer getProtocolVersionNumber buffer put byte KerberosConstants KRB_SAFE_MSGTYPE_TAG buffer put TLV getBytes msgTypeLength BerValue encode buffer getMessageType getValue buffer put byte KerberosConstants KRB_SAFE_SAFE_BODY_TAG buffer put TLV getBytes krbSafeBodyLen krbSafeBody encode buffer buffer put byte KerberosConstants KRB_SAFE_CKSUM_TAG buffer put TLV getBytes checksumLen checksum encode buffer
buffer put byte KerberosConstants KRB_SAFE_PVNO_TAG buffer put TLV getBytes pvnoLen BerValue encode buffer getProtocolVersionNumber buffer put byte KerberosConstants KRB_SAFE_MSGTYPE_TAG buffer put TLV getBytes msgTypeLength BerValue encode buffer getMessageType getValue buffer put byte KerberosConstants KRB_SAFE_SAFE_BODY_TAG buffer put TLV getBytes krbSafeBodyLen krbSafeBody encode buffer buffer put byte KerberosConstants KRB_SAFE_CKSUM_TAG buffer put TLV getBytes checksumLen checksum encode buffer catch BufferOverflowException boe log error I18n err I18n ERR_736_CANNOT_ENCODE_KRBSAFE TLV getNbBytes krbSafeLen krbSafeLen buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
buffer put TLV getBytes ticketSeqLength buffer put byte KerberosConstants TICKET_TKT_VNO_TAG buffer put TLV getBytes tktvnoLength BerValue encode buffer getProtocolVersionNumber buffer put byte KerberosConstants TICKET_REALM_TAG buffer put TLV getBytes realmLength buffer put UniversalTag GENERAL_STRING getValue buffer put TLV getBytes realmBytes length buffer put realmBytes buffer put byte KerberosConstants TICKET_SNAME_TAG buffer put TLV getBytes sNameLength sName encode buffer buffer put byte KerberosConstants TICKET_ENC_PART_TAG buffer put TLV getBytes encPartLength encPart encode buffer
BerValue encode buffer getProtocolVersionNumber buffer put byte KerberosConstants TICKET_REALM_TAG buffer put TLV getBytes realmLength buffer put UniversalTag GENERAL_STRING getValue buffer put TLV getBytes realmBytes length buffer put realmBytes buffer put byte KerberosConstants TICKET_SNAME_TAG buffer put TLV getBytes sNameLength sName encode buffer buffer put byte KerberosConstants TICKET_ENC_PART_TAG buffer put TLV getBytes encPartLength encPart encode buffer catch BufferOverflowException boe LOG error I18n err I18n ERR_137 TLV getNbBytes ticketLength ticketLength buffer capacity throw new EncoderException I18n err I18n ERR_138 boe
Override protected void doInit throws LdapException if initialized File partitionDir new File getPartitionPath if suffixDn null suffixDn isEmpty String msg I18n err I18n ERR_150
String msg I18n err I18n ERR_150 LOG error msg throw new LdapInvalidDnException msg if suffixDn isSchemaAware suffixDn new Dn schemaManager suffixDn String suffixDirName getFileName suffixDn suffixDirectory new File partitionDir suffixDirName super doInit if suffixDirectory exists loadEntries partitionDir else try suffixDirectory mkdirs catch SecurityException se String msg I18n err I18n ERR_151 suffixDirectory getAbsolutePath se getLocalizedMessage
if suffixDn isSchemaAware suffixDn new Dn schemaManager suffixDn String suffixDirName getFileName suffixDn suffixDirectory new File partitionDir suffixDirName super doInit if suffixDirectory exists loadEntries partitionDir else try suffixDirectory mkdirs catch SecurityException se String msg I18n err I18n ERR_151 suffixDirectory getAbsolutePath se getLocalizedMessage LOG error msg throw se File contextEntryFile new File suffixDirectory CONF_FILE_EXTN
Override public Entry delete PartitionTxn partitionTxn String id throws LdapException Entry deletedEntry super delete partitionTxn id if deletedEntry null File ldifFile getFile deletedEntry getDn DELETE boolean deleted deleteFile ldifFile
Override public Entry delete PartitionTxn partitionTxn String id throws LdapException Entry deletedEntry super delete partitionTxn id if deletedEntry null File ldifFile getFile deletedEntry getDn DELETE boolean deleted deleteFile ldifFile LOG debug ldifFile getAbsoluteFile deleted File parentFile ldifFile getParentFile if parentFile listFiles length deleteFile parentFile
private void loadEntries File entryDir throws LdapException
private void loadEntries File entryDir throws LdapException LOG debug entryDir getName File entries entryDir listFiles entryFilter if entries null entries length LdifReader ldifReader new LdifReader schemaManager for File entry entries
public byte serialize Dn dn try ByteArrayOutputStream baos new ByteArrayOutputStream ObjectOutput out new ObjectOutputStream baos dn writeExternal out out flush if IS_DEBUG LOG debug
if in available Tuple Dn E tuple new Tuple tuple setKey new Dn in readUTF String tokens in readUTF split long offset Long parseLong tokens int length Integer parseInt tokens raf seek offset byte data new byte length raf read data length try LdifReader ldifReader new LdifReader LdifEntry ldifEntry ldifReader parseLdif new String data StandardCharsets UTF_8 get Entry entry new DefaultEntry schemaManager ldifEntry getEntry tuple setValue E entry return tuple catch Exception e
Override public void init SchemaManager schemaManager AttributeType attributeType throws LdapException IOException
if dn isEmpty out writeByte else out writeByte Rdn rdn dn getRdn rdn writeExternal out out writeInt entry getAttributes size for Attribute attribute entry getAttributes AttributeType attributeType attribute getAttributeType String oid attributeType getOid out writeUTF oid attribute writeExternal out out flush if IS_DEBUG LOG debug
public void init SchemaManager schemaManager AttributeType attributeType throws LdapException IOException
Rdn rdns rdns parentIdAndRdn getRdns if rdns null rdns length pos Serialize serialize buffer pos else pos Serialize serialize rdns length buffer pos for Rdn rdn rdns pos rdn serialize buffer pos String parentId parentIdAndRdn getParentId byte parentIdBytes Strings getBytesUtf8 parentId pos Serialize serialize parentIdBytes buffer pos pos Serialize serialize parentIdAndRdn getNbChildren buffer pos pos Serialize serialize parentIdAndRdn getNbDescendants buffer pos if IS_DEBUG LOG debug
if initialized if isOptimizerEnabled setOptimizer new NoOpOptimizer else setOptimizer new DefaultOptimizer this EvaluatorBuilder evaluatorBuilder new EvaluatorBuilder this schemaManager CursorBuilder cursorBuilder new CursorBuilder this evaluatorBuilder setSearchEngine new DefaultSearchEngine this cursorBuilder evaluatorBuilder getOptimizer File partitionDir new File getPartitionPath if partitionDir exists partitionDir mkdirs throw new LdapOtherException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY partitionDir if cacheSize cacheSize DEFAULT_CACHE_SIZE LOG debug cacheSize id else
private void buildUserIndex PartitionTxn partitionTxn List Index String userIndexes throws Exception Cursor Tuple String Entry cursor master cursor cursor beforeFirst while cursor next for Index index userIndexes AttributeType atType index getAttribute String attributeOid index getAttribute getOid
Override public void init SchemaManager schemaManager AttributeType attributeType throws LdapException IOException
return if bt isAllowDuplicates ValueCursor V valueCursor bt getValues key int size valueCursor size valueCursor close org apache directory mavibot btree Tuple K V returned bt delete key if null returned return count size else org apache directory mavibot btree Tuple K V returned bt delete key if null returned return count catch IOException KeyNotFoundException e
public byte serialize Dn dn try ByteArrayOutputStream baos new ByteArrayOutputStream ObjectOutput out new ObjectOutputStream baos dn writeExternal out out flush if IS_DEBUG LOG debug
if in available Tuple Dn E t new Tuple Dn E t setKey new Dn in readUTF String tokens in readUTF split long offset Long valueOf tokens int length Integer valueOf tokens raf seek offset byte data new byte length raf read data length LdifReader reader new LdifReader LdifEntry ldifEntry reader parseLdif new String data get Entry entry new DefaultEntry schemaManager ldifEntry getEntry t setValue E entry return t catch Exception e
public void init SchemaManager schemaManager AttributeType attributeType throws IOException
if dn isEmpty out writeByte else out writeByte Rdn rdn dn getRdn rdn writeExternal out out writeInt entry getAttributes size for Attribute attribute entry getAttributes AttributeType attributeType attribute getAttributeType String oid attributeType getOid out writeUTF oid attribute writeExternal out out flush if IS_DEBUG LOG debug
public void init SchemaManager schemaManager AttributeType attributeType throws IOException
catch NullPointerException npe throw npe if rdns null rdns length pos Serialize serialize buffer pos else pos Serialize serialize rdns length buffer pos for Rdn rdn rdns pos rdn serialize buffer pos String parentId parentIdAndRdn getParentId byte parentIdBytes Strings getBytesUtf8 parentId pos Serialize serialize parentIdBytes buffer pos pos Serialize serialize parentIdAndRdn getNbChildren buffer pos pos Serialize serialize parentIdAndRdn getNbDescendants buffer pos if IS_DEBUG LOG debug
if initialized if isOptimizerEnabled setOptimizer new NoOpOptimizer else setOptimizer new DefaultOptimizer Entry this EvaluatorBuilder evaluatorBuilder new EvaluatorBuilder this schemaManager CursorBuilder cursorBuilder new CursorBuilder this evaluatorBuilder setSearchEngine new DefaultSearchEngine this cursorBuilder evaluatorBuilder getOptimizer File partitionDir new File getPartitionPath if partitionDir exists partitionDir mkdirs throw new IOException I18n err I18n ERR_112_COULD_NOT_CREATE_DIRECTORY partitionDir if cacheSize cacheSize DEFAULT_CACHE_SIZE LOG debug cacheSize id else
private void buildUserIndex List Index String userIndexes throws Exception Cursor Tuple String Entry cursor master cursor cursor beforeFirst while cursor next for Index index userIndexes AttributeType atType index getAttribute String attributeOid index getAttribute getOid
public void init SchemaManager schemaManager AttributeType attributeType throws IOException
return if allowsDuplicates ValueCursor V valueCursor bt getValues MavibotWriteTxn transaction getWriteTransaction key int size valueCursor size valueCursor close org apache directory mavibot btree Tuple K V returned bt delete MavibotWriteTxn transaction getWriteTransaction key if null returned return count size else org apache directory mavibot btree Tuple K V returned bt delete MavibotWriteTxn transaction getWriteTransaction key if null returned return count catch IOException ioe
public void sessionCreated IoSession session throws Exception if log isDebugEnabled
public void sessionOpened IoSession session
public void sessionClosed IoSession session
public void sessionIdle IoSession session IdleStatus status
public void exceptionCaught IoSession session Throwable cause
public void messageReceived IoSession session Object message
changepwContext setClientAddress clientAddress changepwContext setRequest request session setAttribute getContextKey changepwContext ChangePasswordService execute session changepwContext session write changepwContext getReply catch KerberosException ke if log isDebugEnabled log warn ke getLocalizedMessage ke else log warn ke getLocalizedMessage KrbError errorMessage getErrorMessage config getServicePrincipal ke ChangePasswordErrorModifier modifier new ChangePasswordErrorModifier modifier setErrorMessage errorMessage session write modifier getChangePasswordError catch Exception e
public void messageSent IoSession session Object message if log isDebugEnabled
private static void processPasswordChange ChangePasswordContext changepwContext throws KerberosException PrincipalStore store changepwContext getStore Authenticator authenticator changepwContext getAuthenticator String newPassword changepwContext getPassword KerberosPrincipal clientPrincipal KerberosUtils getKerberosPrincipal authenticator getCName authenticator getCRealm try String principalName store changePassword clientPrincipal newPassword
private static void monitorRequest ChangePasswordContext changepwContext throws KerberosException try ChangePasswordRequest request ChangePasswordRequest changepwContext getRequest short versionNumber request getVersionNumber StringBuffer sb new StringBuffer sb append sb append versionNumber
sb append clockSkew sb append clientPrincipal sb append desiredPassword sb append clientAddress sb append clientAddresses sb append caddrContainsSender sb append ticket getServerPrincipal PrincipalStoreEntry ticketPrincipal changepwContext getServerEntry sb append ticketPrincipal getCommonName sb append ticketPrincipal getRealmName sb append ticketPrincipal getPrincipal sb append ticketPrincipal getSamType EncryptionType encryptionType ticket getEncPart getEType int keyVersion ticketPrincipal getKeyMap get encryptionType getKeyVersion sb append encryptionType
private static void monitorReply ChangePasswordContext changepwContext throws KerberosException try ChangePasswordReply reply ChangePasswordReply changepwContext getReply ApplicationReply appReply reply getApplicationReply PrivateMessage priv reply getPrivateMessage StringBuilder sb new StringBuilder sb append sb append appReply sb append priv
public void execute NextCommand next IoSession session Object message throws Exception ChangePasswordContext changepwContext ChangePasswordContext session getAttribute getContextKey ChangePasswordServer config changepwContext getConfig Authenticator authenticator changepwContext getAuthenticator KerberosPrincipal clientPrincipal KerberosUtils getKerberosPrincipal authenticator getCName authenticator getCRealm String password changepwContext getPassword String username clientPrincipal getName int passwordLength config getPasswordLengthPolicy int categoryCount config getCategoryCountPolicy int tokenSize config getTokenSizePolicy if isValid username password passwordLength categoryCount tokenSize String explanation buildErrorMessage username password passwordLength categoryCount tokenSize
Override public void sessionCreated IoSession session throws Exception
Override public void sessionOpened IoSession session
Override public void sessionClosed IoSession session
Override public void exceptionCaught IoSession session Throwable cause
Override public void messageReceived IoSession session Object message throws Exception if LOG isDebugEnabled
Override public void messageSent IoSession session Object message if LOG isDebugEnabled
protected DhcpMessage handleINFORM InetSocketAddress localAddress InetSocketAddress clientAddress DhcpMessage request if LOGGER isDebugEnabled
protected DhcpMessage handleRELEASE InetSocketAddress localAddress InetSocketAddress clientAddress DhcpMessage request throws DhcpException if LOGGER isDebugEnabled
protected DhcpMessage handleREQUEST InetSocketAddress localAddress InetSocketAddress clientAddress DhcpMessage request throws DhcpException if LOGGER isDebugEnabled
protected DhcpMessage handleDISCOVER InetSocketAddress localAddress InetSocketAddress clientAddress DhcpMessage request throws DhcpException if LOGGER isDebugEnabled
protected DhcpMessage handleOFFER InetSocketAddress localAddress InetSocketAddress clientAddress DhcpMessage request if LOGGER isDebugEnabled
protected void print DhcpMessage message
protected void print DhcpMessage message log debug String valueOf message getMessageType
protected void print DhcpMessage message log debug String valueOf message getMessageType log debug String valueOf message getHardwareAddress
protected void print DhcpMessage message log debug String valueOf message getMessageType log debug String valueOf message getHardwareAddress log debug String valueOf message getTransactionId
protected void print DhcpMessage message log debug String valueOf message getMessageType log debug String valueOf message getHardwareAddress log debug String valueOf message getTransactionId log debug String valueOf message getSeconds
protected void print DhcpMessage message log debug String valueOf message getMessageType log debug String valueOf message getHardwareAddress log debug String valueOf message getTransactionId log debug String valueOf message getSeconds log debug String valueOf message getFlags
protected void print DhcpMessage message log debug String valueOf message getMessageType log debug String valueOf message getHardwareAddress log debug String valueOf message getTransactionId log debug String valueOf message getSeconds log debug String valueOf message getFlags log debug String valueOf message getCurrentClientAddress
protected void print DhcpMessage message log debug String valueOf message getMessageType log debug String valueOf message getHardwareAddress log debug String valueOf message getTransactionId log debug String valueOf message getSeconds log debug String valueOf message getFlags log debug String valueOf message getCurrentClientAddress log debug String valueOf message getAssignedClientAddress
protected void print DhcpMessage message log debug String valueOf message getMessageType log debug String valueOf message getHardwareAddress log debug String valueOf message getTransactionId log debug String valueOf message getSeconds log debug String valueOf message getFlags log debug String valueOf message getCurrentClientAddress log debug String valueOf message getAssignedClientAddress log debug String valueOf message getNextServerAddress
protected void print DhcpMessage message log debug String valueOf message getMessageType log debug String valueOf message getHardwareAddress log debug String valueOf message getTransactionId log debug String valueOf message getSeconds log debug String valueOf message getFlags log debug String valueOf message getCurrentClientAddress log debug String valueOf message getAssignedClientAddress log debug String valueOf message getNextServerAddress log debug String valueOf message getRelayAgentAddress
protected void print DhcpMessage message log debug String valueOf message getMessageType log debug String valueOf message getHardwareAddress log debug String valueOf message getTransactionId log debug String valueOf message getSeconds log debug String valueOf message getFlags log debug String valueOf message getCurrentClientAddress log debug String valueOf message getAssignedClientAddress log debug String valueOf message getNextServerAddress log debug String valueOf message getRelayAgentAddress log debug String valueOf message getServerHostname
DnsMessageModifier modifier new DnsMessageModifier modifier setTransactionId in getUnsignedShort byte header in get modifier setMessageType decodeMessageType header modifier setOpCode decodeOpCode header modifier setAuthoritativeAnswer decodeAuthoritativeAnswer header modifier setTruncated decodeTruncated header modifier setRecursionDesired decodeRecursionDesired header header in get modifier setRecursionAvailable decodeRecursionAvailable header modifier setResponseCode decodeResponseCode header short questionCount in getShort short answerCount in getShort short authorityCount in getShort short additionalCount in getShort
byte header in get modifier setMessageType decodeMessageType header modifier setOpCode decodeOpCode header modifier setAuthoritativeAnswer decodeAuthoritativeAnswer header modifier setTruncated decodeTruncated header modifier setRecursionDesired decodeRecursionDesired header header in get modifier setRecursionAvailable decodeRecursionAvailable header modifier setResponseCode decodeResponseCode header short questionCount in getShort short answerCount in getShort short authorityCount in getShort short additionalCount in getShort logger debug questionCount modifier setQuestionRecords getQuestions in questionCount
modifier setOpCode decodeOpCode header modifier setAuthoritativeAnswer decodeAuthoritativeAnswer header modifier setTruncated decodeTruncated header modifier setRecursionDesired decodeRecursionDesired header header in get modifier setRecursionAvailable decodeRecursionAvailable header modifier setResponseCode decodeResponseCode header short questionCount in getShort short answerCount in getShort short authorityCount in getShort short additionalCount in getShort logger debug questionCount modifier setQuestionRecords getQuestions in questionCount logger debug answerCount modifier setAnswerRecords getRecords in answerCount
modifier setTruncated decodeTruncated header modifier setRecursionDesired decodeRecursionDesired header header in get modifier setRecursionAvailable decodeRecursionAvailable header modifier setResponseCode decodeResponseCode header short questionCount in getShort short answerCount in getShort short authorityCount in getShort short additionalCount in getShort logger debug questionCount modifier setQuestionRecords getQuestions in questionCount logger debug answerCount modifier setAnswerRecords getRecords in answerCount logger debug authorityCount modifier setAuthorityRecords getRecords in authorityCount
Override public void sessionCreated IoSession session throws Exception if LOG isDebugEnabled
Override public void sessionOpened IoSession session
Override public void sessionClosed IoSession session
Override public void sessionIdle IoSession session IdleStatus status
Override public void exceptionCaught IoSession session Throwable cause
Override public void messageReceived IoSession session Object message
Override public void messageSent IoSession session Object message
private static void monitorRequest DnsMessage request try if LOG isDebugEnabled
private static void monitorContext DnsContext dnsContext try RecordStore store dnsContext getStore List ResourceRecord records dnsContext getResourceRecords StringBuilder sb new StringBuilder sb append sb append store sb append records
private static void monitorReply DnsContext dnsContext try DnsMessage reply dnsContext getReply if LOG isDebugEnabled
public void execute NextCommand next IoSession session Object message throws Exception if LOG isDebugEnabled try DnsContext dnsContext DnsContext session getAttribute getContextKey RecordStore store dnsContext getStore List ResourceRecord records dnsContext getResourceRecords StringBuilder sb new StringBuilder sb append sb append store sb append records
public Set ResourceRecord getRecords QuestionRecord question throws DnsException try GetRecords getRecords new GetRecords question String baseDn catalog getBaseDn question getDomainName CoreSession session directoryService getSession DirContext dirContext new ServerLdapContext directoryService session new LdapName baseDn return getRecords execute dirContext null catch LdapNoSuchObjectException lnnfe LOG debug lnnfe throw new DnsException ResponseCode NAME_ERROR catch NamingException ne LOG error ne getLocalizedMessage ne String message I18n err I18n ERR_157 question getDomainName throw new ServiceConfigurationException message ne catch Exception e
Override public void sessionCreated IoSession session throws Exception if LOG isDebugEnabled
Override public void sessionOpened IoSession session
Override public void sessionClosed IoSession session
Override public void sessionIdle IoSession session IdleStatus status
Override public void exceptionCaught IoSession session Throwable cause
Override public void messageReceived IoSession session Object message
changepwContext setStore store changepwContext setClientAddress clientAddress changepwContext setRequest request changepwContext setReplayCache server getReplayCache session setAttribute getContextKey changepwContext ChangePasswordService execute session changepwContext session write changepwContext getReply catch KerberosException ke if LOG isDebugEnabled LOG warn ke getLocalizedMessage ke else LOG warn ke getLocalizedMessage KrbError errorMessage getErrorMessage server getConfig getServicePrincipal ke session write new ChangePasswordError request getVersionNumber errorMessage catch Exception e
Override public void messageSent IoSession session Object message if LOG isDebugEnabled
private static void monitorRequest ChangePasswordContext changepwContext try ChangePasswordRequest request ChangePasswordRequest changepwContext getRequest short versionNumber request getVersionNumber if LOG isDebugEnabled
sb append append clockSkew sb append append clientPrincipal sb append append changepwContext getPasswordData sb append append clientAddress sb append append clientAddresses sb append append caddrContainsSender sb append append ticket getSName PrincipalStoreEntry ticketPrincipal changepwContext getServerEntry sb append append ticketPrincipal getCommonName sb append append ticketPrincipal getRealmName sb append append ticketPrincipal getPrincipal sb append append ticketPrincipal getSamType EncryptionType encryptionType ticket getEncPart getEType int keyVersion ticketPrincipal getKeyMap get encryptionType getKeyVersion sb append append encryptionType
private static void monitorReply ChangePasswordContext changepwContext try ChangePasswordReply reply ChangePasswordReply changepwContext getReply ApRep appReply reply getApplicationReply KrbPriv priv reply getPrivateMessage
private static void selectEncryptionType AuthenticationContext authContext throws KerberosException LOG_KRB debug KdcContext kdcContext authContext KerberosConfig config kdcContext getConfig Set EncryptionType requestedTypes kdcContext getRequest getKdcReqBody getEType
private static void selectEncryptionType AuthenticationContext authContext throws KerberosException LOG_KRB debug KdcContext kdcContext authContext KerberosConfig config kdcContext getConfig Set EncryptionType requestedTypes kdcContext getRequest getKdcReqBody getEType LOG_KRB debug requestedTypes EncryptionType bestType KerberosUtils getBestEncryptionType requestedTypes config getEncryptionTypes
private static void getClientEntry AuthenticationContext authContext throws KerberosException LOG_KRB debug KdcReqBody kdcReqBody authContext getRequest getKdcReqBody KerberosPrincipal principal KerberosUtils getKerberosPrincipal kdcReqBody getCName kdcReqBody getRealm PrincipalStore store authContext getStore try PrincipalStoreEntry storeEntry KerberosUtils getEntry principal store ErrorType KDC_ERR_C_PRINCIPAL_UNKNOWN authContext setClientEntry storeEntry
private static void verifyPolicy AuthenticationContext authContext throws KerberosException LOG_KRB debug PrincipalStoreEntry entry authContext getClientEntry if entry isDisabled
private static void verifySam AuthenticationContext authContext throws KerberosException LOG_KRB debug KdcReq request authContext getRequest KerberosConfig config authContext getConfig PrincipalStoreEntry clientEntry authContext getClientEntry String clientName clientEntry getPrincipal getName EncryptionKey clientKey null if clientEntry getSamType null if LOG_KRB isDebugEnabled
String clientName clientEntry getPrincipal getName EncryptionKey clientKey null if clientEntry getSamType null if LOG_KRB isDebugEnabled LOG_KRB debug clientName List PaData preAuthData request getPaData if preAuthData null preAuthData isEmpty LOG_KRB debug throw new KerberosException ErrorType KDC_ERR_PREAUTH_REQUIRED preparePreAuthenticationError authContext getEncryptionType config getEncryptionTypes try for PaData paData preAuthData if paData getPaDataType equals PaDataType PA_ENC_TIMESTAMP KerberosKey samKey SamSubsystem getInstance verify clientEntry paData getPaDataValue clientKey new EncryptionKey EncryptionType getTypeByValue samKey getKeyType samKey getEncoded catch SamException se
private static void verifyEncryptedTimestamp AuthenticationContext authContext throws KerberosException LOG_KRB debug KerberosConfig config authContext getConfig KdcReq request authContext getRequest CipherTextHandler cipherTextHandler authContext getCipherTextHandler PrincipalStoreEntry clientEntry authContext getClientEntry String clientName clientEntry getPrincipal getName EncryptionKey clientKey null if clientEntry getSamType null
private static void verifyEncryptedTimestamp AuthenticationContext authContext throws KerberosException LOG_KRB debug KerberosConfig config authContext getConfig KdcReq request authContext getRequest CipherTextHandler cipherTextHandler authContext getCipherTextHandler PrincipalStoreEntry clientEntry authContext getClientEntry String clientName clientEntry getPrincipal getName EncryptionKey clientKey null if clientEntry getSamType null LOG_KRB debug clientName EncryptionType encryptionType authContext getEncryptionType clientKey clientEntry getKeyMap get encryptionType if clientKey null
private static void getServerEntry AuthenticationContext authContext throws KerberosException PrincipalName principal authContext getRequest getKdcReqBody getSName PrincipalStore store authContext getStore
private static void generateTicket AuthenticationContext authContext throws KerberosException KdcReq request authContext getRequest CipherTextHandler cipherTextHandler authContext getCipherTextHandler PrincipalName serverPrincipal request getKdcReqBody getSName
if request getKdcReqBody getKdcOptions get KdcOptions ALLOW_POSTDATE if config isPostdatedAllowed LOG_KRB error throw new KerberosException ErrorType KDC_ERR_POLICY ticketFlags setFlag TicketFlag MAY_POSTDATE KdcOptions kdcOptions request getKdcReqBody getKdcOptions if kdcOptions get KdcOptions RENEW kdcOptions get KdcOptions VALIDATE kdcOptions get KdcOptions PROXY kdcOptions get KdcOptions FORWARDED kdcOptions get KdcOptions ENC_TKT_IN_SKEY String msg if kdcOptions get KdcOptions RENEW msg if kdcOptions get KdcOptions VALIDATE msg if kdcOptions get KdcOptions PROXY msg if kdcOptions get KdcOptions FORWARDED
msg if kdcOptions get KdcOptions PROXY msg if kdcOptions get KdcOptions FORWARDED msg if kdcOptions get KdcOptions ENC_TKT_IN_SKEY msg if LOG_KRB isDebugEnabled LOG_KRB debug msg throw new KerberosException ErrorType KDC_ERR_BADOPTION msg EncryptionKey sessionKey RandomKeyFactory getRandomKey authContext getEncryptionType encTicketPart setKey sessionKey encTicketPart setCName request getKdcReqBody getCName encTicketPart setCRealm request getKdcReqBody getRealm encTicketPart setTransited new TransitedEncoding
if kdcOptions get KdcOptions FORWARDED msg if kdcOptions get KdcOptions ENC_TKT_IN_SKEY msg if LOG_KRB isDebugEnabled LOG_KRB debug msg throw new KerberosException ErrorType KDC_ERR_BADOPTION msg EncryptionKey sessionKey RandomKeyFactory getRandomKey authContext getEncryptionType encTicketPart setKey sessionKey encTicketPart setCName request getKdcReqBody getCName encTicketPart setCRealm request getKdcReqBody getRealm encTicketPart setTransited new TransitedEncoding String serverRealm request getKdcReqBody getRealm KerberosTime now new KerberosTime encTicketPart setAuthTime now
encTicketPart setTransited new TransitedEncoding String serverRealm request getKdcReqBody getRealm KerberosTime now new KerberosTime encTicketPart setAuthTime now KerberosTime startTime request getKdcReqBody getFrom if startTime null startTime lessThan now startTime isInClockSkew config getAllowableClockSkew request getKdcReqBody getKdcOptions get KdcOptions POSTDATED startTime now if startTime null startTime greaterThan now startTime isInClockSkew config getAllowableClockSkew request getKdcReqBody getKdcOptions get KdcOptions POSTDATED String msg LOG_KRB error msg throw new KerberosException ErrorType KDC_ERR_CANNOT_POSTDATE msg if request getKdcReqBody getKdcOptions get KdcOptions POSTDATED if config isPostdatedAllowed String msg LOG_KRB error msg
if startTime null startTime lessThan now startTime isInClockSkew config getAllowableClockSkew request getKdcReqBody getKdcOptions get KdcOptions POSTDATED startTime now if startTime null startTime greaterThan now startTime isInClockSkew config getAllowableClockSkew request getKdcReqBody getKdcOptions get KdcOptions POSTDATED String msg LOG_KRB error msg throw new KerberosException ErrorType KDC_ERR_CANNOT_POSTDATE msg if request getKdcReqBody getKdcOptions get KdcOptions POSTDATED if config isPostdatedAllowed String msg LOG_KRB error msg throw new KerberosException ErrorType KDC_ERR_POLICY msg ticketFlags setFlag TicketFlag POSTDATED ticketFlags setFlag TicketFlag INVALID encTicketPart setStartTime startTime long till
throw new KerberosException ErrorType KDC_ERR_CANNOT_POSTDATE msg if request getKdcReqBody getKdcOptions get KdcOptions POSTDATED if config isPostdatedAllowed String msg LOG_KRB error msg throw new KerberosException ErrorType KDC_ERR_POLICY msg ticketFlags setFlag TicketFlag POSTDATED ticketFlags setFlag TicketFlag INVALID encTicketPart setStartTime startTime long till if request getKdcReqBody getTill getTime till Long MAX_VALUE else till request getKdcReqBody getTill getTime long endTime Math min till startTime getTime config getMaximumTicketLifetime
ticketFlags setFlag TicketFlag POSTDATED ticketFlags setFlag TicketFlag INVALID encTicketPart setStartTime startTime long till if request getKdcReqBody getTill getTime till Long MAX_VALUE else till request getKdcReqBody getTill getTime long endTime Math min till startTime getTime config getMaximumTicketLifetime KerberosTime kerberosEndTime new KerberosTime endTime encTicketPart setEndTime kerberosEndTime if kerberosEndTime lessThan startTime String msg LOG_KRB error msg throw new KerberosException ErrorType KDC_ERR_NEVER_VALID msg
long endTime Math min till startTime getTime config getMaximumTicketLifetime KerberosTime kerberosEndTime new KerberosTime endTime encTicketPart setEndTime kerberosEndTime if kerberosEndTime lessThan startTime String msg LOG_KRB error msg throw new KerberosException ErrorType KDC_ERR_NEVER_VALID msg long ticketLifeTime Math abs startTime getTime kerberosEndTime getTime if ticketLifeTime config getMinimumTicketLifetime String msg LOG_KRB error msg throw new KerberosException ErrorType KDC_ERR_NEVER_VALID msg KerberosTime tempRtime request getKdcReqBody getRTime if request getKdcReqBody getKdcOptions get KdcOptions RENEWABLE_OK request getKdcReqBody getTill greaterThan kerberosEndTime if config isRenewableAllowed
sb append append SERVICE_NAME append sb append append request getMessageType sb append append request getProtocolVersionNumber sb append append clientAddress sb append append request getKdcReqBody getNonce sb append append request getKdcReqBody getKdcOptions sb append append request getKdcReqBody getCName sb append append request getKdcReqBody getSName sb append KerberosUtils getEncryptionTypesString request getKdcReqBody getEType sb append append request getKdcReqBody getRealm sb append append request getKdcReqBody getFrom sb append append request getKdcReqBody getTill sb append append request getKdcReqBody getRTime sb append append request getKdcReqBody getAddresses String message sb toString
sb append append request getProtocolVersionNumber sb append append clientAddress sb append append request getKdcReqBody getNonce sb append append request getKdcReqBody getKdcOptions sb append append request getKdcReqBody getCName sb append append request getKdcReqBody getSName sb append KerberosUtils getEncryptionTypesString request getKdcReqBody getEType sb append append request getKdcReqBody getRealm sb append append request getKdcReqBody getFrom sb append append request getKdcReqBody getTill sb append append request getKdcReqBody getRTime sb append append request getKdcReqBody getAddresses String message sb toString LOG_KRB debug message catch Exception e
sb append append clientEntry getSamType PrincipalName serverPrincipal authContext getRequest getKdcReqBody getSName PrincipalStoreEntry serverEntry authContext getServerEntry sb append append serverPrincipal sb append append serverEntry getCommonName sb append append serverEntry getRealmName sb append append serverEntry getPrincipal sb append append serverEntry getSamType EncryptionType encryptionType authContext getEncryptionType int clientKeyVersion clientEntry getKeyMap get encryptionType getKeyVersion int serverKeyVersion serverEntry getKeyMap get encryptionType getKeyVersion sb append append encryptionType sb append append clientKeyVersion sb append append serverKeyVersion String message sb toString
PrincipalStoreEntry serverEntry authContext getServerEntry sb append append serverPrincipal sb append append serverEntry getCommonName sb append append serverEntry getRealmName sb append append serverEntry getPrincipal sb append append serverEntry getSamType EncryptionType encryptionType authContext getEncryptionType int clientKeyVersion clientEntry getKeyMap get encryptionType getKeyVersion int serverKeyVersion serverEntry getKeyMap get encryptionType getKeyVersion sb append append encryptionType sb append append clientKeyVersion sb append append serverKeyVersion String message sb toString LOG_KRB debug message catch Exception e
StringBuilder sb new StringBuilder sb append append SERVICE_NAME append sb append append reply getMessageType sb append append reply getProtocolVersionNumber sb append append part getNonce sb append append reply getCName sb append append reply getCRealm sb append append part getSName sb append append part getSRealm sb append append part getAuthTime sb append append part getStartTime sb append append part getEndTime sb append append part getRenewTill sb append append part getClientAddresses String message sb toString
sb append append reply getMessageType sb append append reply getProtocolVersionNumber sb append append part getNonce sb append append reply getCName sb append append reply getCRealm sb append append part getSName sb append append part getSRealm sb append append part getAuthTime sb append append part getStartTime sb append append part getEndTime sb append append part getRenewTill sb append append part getClientAddresses String message sb toString LOG_KRB debug message catch Exception e
StringBuilder sb new StringBuilder sb append append SERVICE_NAME append sb append append request getMessageType sb append append request getProtocolVersionNumber sb append append clientAddress sb append append request getKdcReqBody getNonce sb append append request getKdcReqBody getKdcOptions sb append append request getKdcReqBody getCName sb append append request getKdcReqBody getSName sb append append KerberosUtils getEncryptionTypesString request getKdcReqBody getEType sb append append request getKdcReqBody getRealm sb append append request getKdcReqBody getFrom sb append append request getKdcReqBody getTill sb append append request getKdcReqBody getRTime sb append append request getKdcReqBody getAddresses
sb append append request getMessageType sb append append request getProtocolVersionNumber sb append append clientAddress sb append append request getKdcReqBody getNonce sb append append request getKdcReqBody getKdcOptions sb append append request getKdcReqBody getCName sb append append request getKdcReqBody getSName sb append append KerberosUtils getEncryptionTypesString request getKdcReqBody getEType sb append append request getKdcReqBody getRealm sb append append request getKdcReqBody getFrom sb append append request getKdcReqBody getTill sb append append request getKdcReqBody getRTime sb append append request getKdcReqBody getAddresses LOG_KRB debug sb toString catch Exception e
private static void selectEncryptionType TicketGrantingContext tgsContext throws Exception KdcContext kdcContext tgsContext KerberosConfig config kdcContext getConfig Set EncryptionType requestedTypes kdcContext getRequest getKdcReqBody getEType EncryptionType bestType KerberosUtils getBestEncryptionType requestedTypes config getEncryptionTypes
PrincipalStoreEntry requestPrincipal tgsContext getRequestPrincipalEntry sb append append requestServerPrincipal sb append append requestPrincipal getCommonName sb append append requestPrincipal getRealmName sb append append requestPrincipal getPrincipal sb append append requestPrincipal getSamType PrincipalName ticketServerPrincipal tgsContext getTgt getSName PrincipalStoreEntry ticketPrincipal tgsContext getTicketPrincipalEntry sb append append ticketServerPrincipal sb append append ticketPrincipal getCommonName sb append append ticketPrincipal getRealmName sb append append ticketPrincipal getPrincipal sb append append ticketPrincipal getSamType EncryptionType encryptionType tgsContext getTgt getEncPart getEType int keyVersion ticketPrincipal getKeyMap get encryptionType getKeyVersion
try StringBuilder sb new StringBuilder sb append append SERVICE_NAME append sb append append success getMessageType sb append append success getProtocolVersionNumber sb append append part getNonce sb append append success getCName sb append append success getCRealm sb append append part getSName sb append append part getSRealm sb append append part getAuthTime sb append append part getStartTime sb append append part getEndTime sb append append part getRenewTill sb append append part getClientAddresses
sb append append SERVICE_NAME append sb append append success getMessageType sb append append success getProtocolVersionNumber sb append append part getNonce sb append append success getCName sb append append success getCRealm sb append append part getSName sb append append part getSRealm sb append append part getAuthTime sb append append part getStartTime sb append append part getEndTime sb append append part getRenewTill sb append append part getClientAddresses LOG_KRB debug sb toString catch Exception e
Override public void sessionCreated IoSession session throws Exception if LOG isDebugEnabled
Override public void sessionOpened IoSession session if LOG isDebugEnabled
Override public void sessionClosed IoSession session if LOG isDebugEnabled
Override public void sessionIdle IoSession session IdleStatus status if LOG isDebugEnabled
Override public void exceptionCaught IoSession session Throwable cause
Override public void exceptionCaught IoSession session Throwable cause LOG error session getRemoteAddress cause
Override public void messageReceived IoSession session Object message if LOG isDebugEnabled
if message KdcReq LOG error I18n err I18n ERR_152 ErrorType KRB_AP_ERR_BADDIRECTION LOG_KRB error I18n err I18n ERR_152 ErrorType KRB_AP_ERR_BADDIRECTION session write getErrorMessage kdcServer getConfig getServicePrincipal new KerberosException ErrorType KRB_AP_ERR_BADDIRECTION return KdcReq request KdcReq message KerberosMessageType messageType request getMessageType try switch messageType case AS_REQ AuthenticationContext authContext new AuthenticationContext authContext setConfig kdcServer getConfig authContext setStore store if request getKdcReqBody getAddresses null authContext setClientAddress clientAddress authContext setRequest request
authContext setConfig kdcServer getConfig authContext setStore store if request getKdcReqBody getAddresses null authContext setClientAddress clientAddress authContext setRequest request session setAttribute CONTEXT_KEY authContext AuthenticationService execute authContext LOG_KRB debug authContext session write authContext getReply break case TGS_REQ TicketGrantingContext tgsContext new TicketGrantingContext tgsContext setConfig kdcServer getConfig tgsContext setReplayCache kdcServer getReplayCache tgsContext setStore store tgsContext setClientAddress clientAddress
Override public void messageSent IoSession session Object message if LOG isDebugEnabled
protected void logErrorMessage KrbError error try StringBuilder sb new StringBuilder sb append sb append error getEText sb append error getErrorCode sb append error getCName append append error getCRealm sb append error getCTime sb append error getSName append append error getRealm sb append error getSTime String message sb toString
protected void logErrorMessage KrbError error try StringBuilder sb new StringBuilder sb append sb append error getEText sb append error getErrorCode sb append error getCName append append error getCRealm sb append error getCTime sb append error getSName append append error getRealm sb append error getSTime String message sb toString LOG debug message
protected void logErrorMessage KrbError error try StringBuilder sb new StringBuilder sb append sb append error getEText sb append error getErrorCode sb append error getCName append append error getCRealm sb append error getCTime sb append error getSName append append error getRealm sb append error getSTime String message sb toString LOG debug message LOG_KRB debug message catch Exception e LOG error I18n err I18n ERR_155 e
else int totLen incomingBuf limit krbMsgContainer getStream position if totLen maxPduSize session removeAttribute KERBEROS_MESSAGE_CONTAINER String err err String format Locale ROOT err totLen maxPduSize throw new DecoderException err krbMsgContainer getStream put incomingBuf if krbMsgContainer isTCP int curLen krbMsgContainer getStream position if curLen krbMsgContainer getTcpLength return false try ByteBuffer stream krbMsgContainer getStream if stream position
Override public void event IoSession session FilterEvent event throws Exception if event SslEvent if SslEvent event SslEvent SECURED LdapSession ldapSession ldapServer getLdapSessionManager getLdapSession session
private void startNetwork Transport transport IoFilterChainBuilder chainBuilder throws Exception if transport getBackLog transport setBackLog chainBuilders add chainBuilder try SocketAcceptor acceptor getSocketAcceptor transport acceptor setCloseOnDeactivation false acceptor getSessionConfig setTcpNoDelay true acceptor setFilterChainBuilder chainBuilder acceptor setHandler getHandler AbstractSocketSessionConfig acceptor getSessionConfig setReadBufferSize AbstractSocketSessionConfig acceptor getSessionConfig setSendBufferSize acceptor bind started true if LOG isInfoEnabled
try SocketAcceptor acceptor getSocketAcceptor transport acceptor setCloseOnDeactivation false acceptor getSessionConfig setTcpNoDelay true acceptor setFilterChainBuilder chainBuilder acceptor setHandler getHandler AbstractSocketSessionConfig acceptor getSessionConfig setReadBufferSize AbstractSocketSessionConfig acceptor getSessionConfig setSendBufferSize acceptor bind started true if LOG isInfoEnabled LOG info transport getPort catch IOException e String msg I18n err I18n ERR_171 transport getPort LdapConfigurationException lce new LdapConfigurationException msg
while true if CONSUMER_LOG isDebugEnabled MDC put consumer getId LOG info consumer CONSUMER_LOG info consumer boolean isConnected consumer connect ReplicationConsumer NOW if isConnected pingerThread addConsumer consumer ReplicationStatusEnum status null do status consumer startSync while status ReplicationStatusEnum REFRESH_REQUIRED if status ReplicationStatusEnum STOPPED break catch Exception e
if CONSUMER_LOG isDebugEnabled MDC put consumer getId LOG info consumer CONSUMER_LOG info consumer boolean isConnected consumer connect ReplicationConsumer NOW if isConnected pingerThread addConsumer consumer ReplicationStatusEnum status null do status consumer startSync while status ReplicationStatusEnum REFRESH_REQUIRED if status ReplicationStatusEnum STOPPED break catch Exception e LOG error consumer
private void stopConsumers if replConsumers null for ReplicationConsumer consumer replConsumers
public AbandonableRequest abandonOutstandingRequest int messageId AbandonableRequest request null try outstandingLock lock request outstandingRequests remove messageId finally outstandingLock unlock try closeAllPagedSearches catch Exception e LOG error I18n err I18n ERR_172 e getLocalizedMessage if request null LOG warn messageId return null if request isAbandoned
request outstandingRequests remove messageId finally outstandingLock unlock try closeAllPagedSearches catch Exception e LOG error I18n err I18n ERR_172 e getLocalizedMessage if request null LOG warn messageId return null if request isAbandoned LOG info messageId return request request abandon if IS_DEBUG
Override public final void handleMessage IoSession session T message throws Exception LdapSession ldapSession ldapServer getLdapSessionManager getLdapSession session if ldapSession null
public final void handleMessage IoSession session T message throws Exception LdapSession ldapSession ldapServer getLdapSessionManager getLdapSession session if ldapSession null
public static void sendShutdownResponse IoSession requestor int messageId GracefulShutdownResponse msg new GracefulShutdownResponseImpl messageId ResultCodeEnum SUCCESS WriteFuture future requestor write msg future awaitUninterruptibly if future isWritten if LOG isInfoEnabled
pmrl addControl ppolicyControl ioSession write pmrl return if oldPassword null ModifyRequest modifyRequest new ModifyRequestImpl modifyRequest setName userDn Control ppolicyControl req getControl PasswordPolicyRequest OID if ppolicyControl null modifyRequest addControl ppolicyControl try Modification modification new DefaultModification ModificationOperation REPLACE_ATTRIBUTE userPassword getAttributeType newPassword modifyRequest addModification modification ResultCodeEnum errorCode null String errorMessage null try
modifyRequest addModification modification ResultCodeEnum errorCode null String errorMessage null try userSession modify modifyRequest if LOG isDebugEnabled LOG debug userDn PasswordModifyResponseImpl pmrl new PasswordModifyResponseImpl req getMessageId ResultCodeEnum SUCCESS ppolicyControl modifyRequest getResultResponse getControl PasswordPolicyRequest OID if ppolicyControl null pmrl addControl ppolicyControl ioSession write pmrl return catch LdapOperationException loe errorCode loe getResultCode
else modifiedPassword add value catch LdapInvalidAttributeValueException e if valid ModifyRequest modifyRequest new ModifyRequestImpl modifyRequest setName userDn Control ppolicyControl req getControl PasswordPolicyRequest OID if ppolicyControl null modifyRequest addControl ppolicyControl Modification modification new DefaultModification ModificationOperation REPLACE_ATTRIBUTE modifiedPassword modifyRequest addModification modification ResultCodeEnum errorCode null String errorMessage null try userSession modify modifyRequest
private void writeResult IoSession ioSession PasswordModifyRequest req ResultCodeEnum error String errorMessage
private void processAuthenticatedPasswordModify LdapSession requestor PasswordModifyRequest req Dn userDn byte oldPassword req getOldPassword byte newPassword req getNewPassword Entry modifiedEntry null Dn principalDn requestor getCoreSession getEffectivePrincipal getDn
public void setLdapServer LdapServer ldapServer LOG debug Provider provider Security getProvider
public void handle LdapSession session AddRequest addRequest
try bindDn new Dn directoryService getSchemaManager name bindRequest setDn bindDn catch LdapInvalidDnException e LOG debug bindContext setDn bindRequest getDn bindContext setCredentials bindRequest getCredentials bindContext setIoSession ldapSession getIoSession bindContext setInterceptors directoryService getInterceptors OperationEnum BIND LdapProtocolUtils setRequestControls bindContext bindRequest try Entry principalEntry null try principalEntry directoryService getAdminSession lookup bindRequest getDn SchemaConstants ALL_USER_ATTRIBUTES SchemaConstants ALL_OPERATIONAL_ATTRIBUTES catch Exception le
private boolean checkMechanism String saslMechanism if ldapServer getSupportedMechanisms contains saslMechanism
ldapSession putSaslProperty SaslConstants SASL_CREDS tokenBytes LdapPrincipal ldapPrincipal LdapPrincipal ldapSession getSaslProperty SaslConstants SASL_AUTHENT_USER if ldapPrincipal null DirectoryService ds ldapSession getLdapServer getDirectoryService String saslMechanism bindRequest getSaslMechanism byte password null if ldapPrincipal getUserPasswords null password ldapPrincipal getUserPasswords CoreSession userSession ds getSession ldapPrincipal getDn password saslMechanism null ldapSession setCoreSession userSession DefaultCoreSession userSession setIoSession ldapSession getIoSession ldapSession setAuthenticated MechanismHandler handler MechanismHandler ldapSession getSaslProperty SaslConstants SASL_MECH_HANDLER handler cleanup ldapSession sendBindSuccess ldapSession bindResponse tokenBytes
Override public void handle LdapSession ldapSession BindRequest bindRequest throws Exception
public void handle LdapSession session CompareRequest compareRequest
public void handle LdapSession session DeleteRequest deleteRequest
public void handle LdapSession session ModifyDnRequest modifyDnRequest ModifyDnResponse modifyDnResponse ModifyDnResponse modifyDnRequest getResultResponse LdapResult result modifyDnResponse getLdapResult
public void handle LdapSession session ModifyRequest modifyRequest
Override public final void handle LdapSession session SearchRequest req throws Exception if IS_DEBUG
private void writeResults LdapSession session SearchRequest req LdapResult ldapResult Cursor Entry cursor long sizeLimit throws Exception long count while count sizeLimit cursor next if session getIoSession isClosing if IS_DEBUG
private void writeResults LdapSession session SearchRequest req LdapResult ldapResult Cursor Entry cursor long sizeLimit throws Exception long count while count sizeLimit cursor next if session getIoSession isClosing if IS_DEBUG LOG debug req getMessageId break if req isAbandoned cursor close new OperationAbandonedException if IS_DEBUG LOG debug req getMessageId break Entry entry cursor get session getIoSession write generateResponse session req entry if IS_DEBUG
private void readPagedResults LdapSession session SearchRequest req LdapResult ldapResult Cursor Entry cursor long sizeLimit int pagedLimit PagedSearchContext pagedContext PagedResults pagedResultsControl throws Exception req addAbandonListener new SearchAbandonListener ldapServer cursor setTimeLimitsOnCursor req session cursor if IS_DEBUG
PagedSearchContext pagedContext null if pagedLimit 0L return abandonPagedSearch session req byte cookie pagedSearchControl getCookie LdapResult ldapResult req getResultResponse getLdapResult if Strings isEmpty cookie cursor session getCoreSession search req cursor beforeFirst if pagedLimit sizeLimit try writeResults session req ldapResult cursor sizeLimit finally try cursor close catch Exception e
for Value val ref String url val getString if url startsWith respRef getReferral addLdapUrl url LdapUrl ldapUrl null try ldapUrl new LdapUrl url ldapUrl setForceScopeRendering true switch req getScope case SUBTREE ldapUrl setScope SearchScope SUBTREE getScope break case ONELEVEL ldapUrl setScope SearchScope OBJECT getScope break default ldapUrl setScope SearchScope OBJECT getScope catch LdapURLEncodingException e
private void handleIgnoringReferrals LdapSession session SearchRequest req if IS_DEBUG
modifyFilter session req PersistentSearch psearch PersistentSearch req getControls get PersistentSearch OID if psearch null isPersistentSearch true handlePersistentSearch session req psearch return boolean isLogSearchTime SEARCH_TIME_LOG isDebugEnabled long t0 String filter null if isLogSearchTime t0 System nanoTime filter req getFilter toString SearchResultDone done doSimpleSearch session req session getIoSession write done if isLogSearchTime
DirectoryService directoryService session getCoreSession getDirectoryService ReferralManager referralManager directoryService getReferralManager Dn reqTargetDn req getBase if reqTargetDn isSchemaAware reqTargetDn new Dn directoryService getSchemaManager reqTargetDn req setBase reqTargetDn referralManager lockRead try isReferral referralManager isReferral reqTargetDn if isReferral isparentReferral referralManager hasParentReferral reqTargetDn finally referralManager unlock if isReferral isparentReferral if IS_DEBUG
referralManager lockRead try isReferral referralManager isReferral reqTargetDn if isReferral isparentReferral referralManager hasParentReferral reqTargetDn finally referralManager unlock if isReferral isparentReferral if IS_DEBUG LOG debug reqTargetDn handleIgnoringReferrals session req else try entry session getCoreSession lookup reqTargetDn if IS_DEBUG
try isReferral referralManager isReferral reqTargetDn if isReferral isparentReferral referralManager hasParentReferral reqTargetDn finally referralManager unlock if isReferral isparentReferral if IS_DEBUG LOG debug reqTargetDn handleIgnoringReferrals session req else try entry session getCoreSession lookup reqTargetDn if IS_DEBUG LOG debug reqTargetDn entry
referralManager unlock if isReferral isparentReferral if IS_DEBUG LOG debug reqTargetDn handleIgnoringReferrals session req else try entry session getCoreSession lookup reqTargetDn if IS_DEBUG LOG debug reqTargetDn entry catch LdapException e LOG debug reqTargetDn catch Exception e handleException session req e return
ReferralImpl referral new ReferralImpl result setReferral referral result setResultCode ResultCodeEnum REFERRAL result setDiagnosticMessage result setMatchedDn req getBase Attribute refAttr ClonedServerEntry entry getOriginalEntry get SchemaConstants REF_AT for Value refval refAttr String refstr refval getString if refstr startsWith referral addLdapUrl refstr continue LdapUrl ldapUrl null try ldapUrl new LdapUrl refstr catch LdapURLEncodingException e
if IS_DEBUG LOG debug Attribute refAttr ClonedServerEntry referralAncestor getOriginalEntry get SchemaConstants REF_AT Referral referral new ReferralImpl for Value value refAttr String ref value getString if IS_DEBUG LOG debug ref if ref startsWith referral addLdapUrl ref continue LdapUrl ldapUrl null try ldapUrl new LdapUrl ref catch LdapURLEncodingException e
if IS_DEBUG LOG debug Attribute refAttr ClonedServerEntry referralAncestor getOriginalEntry get SchemaConstants REF_AT Referral referral new ReferralImpl for Value value refAttr String ref value getString if IS_DEBUG LOG debug ref if ref startsWith referral addLdapUrl ref continue LdapUrl ldapUrl null try ldapUrl new LdapUrl ref catch LdapURLEncodingException e
Exception cause null ResultCodeEnum code if e CursorClosedException cause Exception CursorClosedException e getCause if cause null cause e else cause e if cause LdapOperationException code LdapOperationException cause getResultCode else code ResultCodeEnum getBestEstimate cause req getType result setResultCode code String msg code toString req cause getLocalizedMessage if IS_DEBUG
public static final Entry getFarthestReferralAncestor LdapSession session Dn target Entry entry Entry farthestReferralAncestor null Dn dn target dn dn getParent while dn isEmpty if IS_DEBUG
Entry entry Entry farthestReferralAncestor null Dn dn target dn dn getParent while dn isEmpty if IS_DEBUG LOG debug dn try entry session getCoreSession lookup dn boolean isReferral ClonedServerEntry entry getOriginalEntry contains SchemaConstants OBJECT_CLASS_AT SchemaConstants REFERRAL_OC if isReferral farthestReferralAncestor entry dn dn getParent catch LdapException e if IS_DEBUG
public void handle LdapSession session UnbindRequest unbindRequest throws Exception
public void handle LdapSession session AddResponse addResponse
public void handle LdapSession ldapSession BindResponse bindResponse throws Exception
public void handle LdapSession session CompareResponse compareResponse
public void handle LdapSession session DeleteResponse deleteResponse
public void handle LdapSession session ExtendedResponse extendedResponse throws Exception
public void handle LdapSession session IntermediateResponse intermediateResponse
public void handle LdapSession session ModifyDnResponse modifyDnResponse
public void handle LdapSession session ModifyResponse modifyResponse
public void handle LdapSession session SearchResultDone searchResultDone throws Exception
public void handle LdapSession session SearchResultEntry searchResultEntry throws Exception
public void handle LdapSession session SearchResultReference searchResultReference throws Exception
Override public void handle Callback callbacks for int i i callbacks length i Callback callback callbacks i if LOG isDebugEnabled
LOG debug nameCB getDefaultName username nameCB getDefaultName else if callback RealmCallback RealmCallback realmCB RealmCallback callback LOG debug realmCB getDefaultText realm realmCB getDefaultText else if callback PasswordCallback PasswordCallback passwordCB PasswordCallback callback Attribute userPassword lookupPassword getUsername getRealm if userPassword null byte password userPassword get getBytes String strPassword Strings utf8ToString password passwordCB setPassword strPassword toCharArray else if callback AuthorizeCallback AuthorizeCallback authorizeCB AuthorizeCallback callback
username nameCB getDefaultName else if callback RealmCallback RealmCallback realmCB RealmCallback callback LOG debug realmCB getDefaultText realm realmCB getDefaultText else if callback PasswordCallback PasswordCallback passwordCB PasswordCallback callback Attribute userPassword lookupPassword getUsername getRealm if userPassword null byte password userPassword get getBytes String strPassword Strings utf8ToString password passwordCB setPassword strPassword toCharArray else if callback AuthorizeCallback AuthorizeCallback authorizeCB AuthorizeCallback callback LOG debug authorizeCB getAuthenticationID
else if callback RealmCallback RealmCallback realmCB RealmCallback callback LOG debug realmCB getDefaultText realm realmCB getDefaultText else if callback PasswordCallback PasswordCallback passwordCB PasswordCallback callback Attribute userPassword lookupPassword getUsername getRealm if userPassword null byte password userPassword get getBytes String strPassword Strings utf8ToString password passwordCB setPassword strPassword toCharArray else if callback AuthorizeCallback AuthorizeCallback authorizeCB AuthorizeCallback callback LOG debug authorizeCB getAuthenticationID LOG debug authorizeCB getAuthorizationID
Override public void messageReceived NextFilter nextFilter IoSession session Object message throws SaslException
Override public void messageReceived NextFilter nextFilter IoSession session Object message throws SaslException LOG debug message String qop String saslServer getNegotiatedProperty Sasl QOP boolean hasSecurityLayer qop null qop equals SaslQoP AUTH_INT getValue qop equals SaslQoP AUTH_CONF getValue if hasSecurityLayer IoBuffer buf IoBuffer message int bufferLength buf getInt byte bufferBytes new byte bufferLength buf get bufferBytes
Override public void filterWrite NextFilter nextFilter IoSession session WriteRequest writeRequest throws SaslException
Override public void filterWrite NextFilter nextFilter IoSession session WriteRequest writeRequest throws SaslException LOG debug writeRequest if session containsAttribute DISABLE_SECURITY_LAYER_ONCE LOG debug session removeAttribute DISABLE_SECURITY_LAYER_ONCE nextFilter filterWrite session writeRequest return String qop String saslServer getNegotiatedProperty Sasl QOP boolean hasSecurityLayer qop null qop equals SaslQoP AUTH_INT getValue qop equals SaslQoP AUTH_CONF getValue IoBuffer saslLayerBuffer null if hasSecurityLayer IoBuffer buf IoBuffer writeRequest getMessage int bufferLength buf remaining byte bufferBytes new byte bufferLength buf get bufferBytes
String qop String saslServer getNegotiatedProperty Sasl QOP boolean hasSecurityLayer qop null qop equals SaslQoP AUTH_INT getValue qop equals SaslQoP AUTH_CONF getValue IoBuffer saslLayerBuffer null if hasSecurityLayer IoBuffer buf IoBuffer writeRequest getMessage int bufferLength buf remaining byte bufferBytes new byte bufferLength buf get bufferBytes LOG debug bufferLength byte saslLayer saslServer wrap bufferBytes bufferBytes length saslLayerBuffer IoBuffer allocate saslLayer length saslLayerBuffer putInt saslLayer length saslLayerBuffer put saslLayer saslLayerBuffer position saslLayerBuffer limit saslLayer length
Override public SaslServer handleMechanism LdapSession ldapSession BindRequest bindRequest throws Exception BindOperationContext bindContext new BindOperationContext null bindContext setDn bindRequest getDn bindContext setCredentials bindRequest getCredentials bindContext setInterceptors ldapSession getLdapServer getDirectoryService getInterceptors OperationEnum BIND LdapProtocolUtils setRequestControls bindContext bindRequest try CoreSession adminSession ldapSession getLdapServer getDirectoryService getAdminSession adminSession getDirectoryService getOperationManager bind bindContext ldapSession setCoreSession bindContext getSession BindResponse response BindResponse bindRequest getResultResponse response getLdapResult setResultCode ResultCodeEnum SUCCESS LdapProtocolUtils setResponseControls bindContext response ldapSession getIoSession write response
protected void authorize AuthorizeCallback authorizeCB throws Exception LOG debug String username authorizeCB getAuthorizationID GetPrincipal getPrincipal new GetPrincipal new KerberosPrincipal username PrincipalStoreEntry entry PrincipalStoreEntry getPrincipal execute adminSession new Dn ldapSession getLdapServer getSearchBaseDn String bindDn entry getDistinguishedName
connection addConnectionClosedEventListener this if connection connect CONSUMER_LOG info config getReplicaId config getProducer try connection bind config getReplUserDn Strings utf8ToString config getReplUserPassword disconnected false return true catch LdapException le CONSUMER_LOG warn config getProducer config getReplUserDn CONSUMER_LOG warn le disconnected true else CONSUMER_LOG warn config getReplicaId config getProducer disconnected true return false
private void prepareSyncSearchRequest throws LdapException String baseDn config getBaseDn searchRequest new SearchRequestImpl searchRequest setBase new Dn baseDn searchRequest setFilter config getFilter searchRequest setSizeLimit config getSearchSizeLimit searchRequest setTimeLimit config getSearchTimeout searchRequest setDerefAliases config getAliasDerefMode searchRequest setScope config getSearchScope searchRequest setTypesOnly false searchRequest addAttributes config getAttributes if config isChaseReferrals searchRequest addControl new ManageDsaITImpl if CONSUMER_LOG isDebugEnabled MDC put Integer toString config getReplicaId
private ResultCodeEnum handleSearchResultDone SearchResultDone searchDone CONSUMER_LOG debug SyncDoneValue ctrl SyncDoneValue searchDone getControls get SyncDoneValue OID if ctrl null ctrl getCookie null syncCookie ctrl getCookie
private void handleSearchResultEntry SearchResultEntry syncResult CONSUMER_LOG debug SyncStateValue syncStateCtrl SyncStateValue syncResult getControl SyncStateValue OID try Entry remoteEntry new DefaultEntry schemaManager syncResult getEntry String uuid remoteEntry get directoryService getAtProvider getEntryUUID getString Object lock getLockFor uuid synchronized lock int rid if syncStateCtrl getCookie null syncCookie syncStateCtrl getCookie rid LdapProtocolUtils getReplicaId Strings utf8ToString syncCookie
private void handleSearchResultEntry SearchResultEntry syncResult CONSUMER_LOG debug SyncStateValue syncStateCtrl SyncStateValue syncResult getControl SyncStateValue OID try Entry remoteEntry new DefaultEntry schemaManager syncResult getEntry String uuid remoteEntry get directoryService getAtProvider getEntryUUID getString Object lock getLockFor uuid synchronized lock int rid if syncStateCtrl getCookie null syncCookie syncStateCtrl getCookie rid LdapProtocolUtils getReplicaId Strings utf8ToString syncCookie CONSUMER_LOG debug Strings utf8ToString syncCookie SyncStateTypeEnum state syncStateCtrl getSyncStateType if CONSUMER_LOG isDebugEnabled
CONSUMER_LOG debug SyncStateValue syncStateCtrl SyncStateValue syncResult getControl SyncStateValue OID try Entry remoteEntry new DefaultEntry schemaManager syncResult getEntry String uuid remoteEntry get directoryService getAtProvider getEntryUUID getString Object lock getLockFor uuid synchronized lock int rid if syncStateCtrl getCookie null syncCookie syncStateCtrl getCookie rid LdapProtocolUtils getReplicaId Strings utf8ToString syncCookie CONSUMER_LOG debug Strings utf8ToString syncCookie SyncStateTypeEnum state syncStateCtrl getSyncStateType if CONSUMER_LOG isDebugEnabled CONSUMER_LOG debug state name
int rid if syncStateCtrl getCookie null syncCookie syncStateCtrl getCookie rid LdapProtocolUtils getReplicaId Strings utf8ToString syncCookie CONSUMER_LOG debug Strings utf8ToString syncCookie SyncStateTypeEnum state syncStateCtrl getSyncStateType if CONSUMER_LOG isDebugEnabled CONSUMER_LOG debug state name CONSUMER_LOG debug Strings uuidToString syncStateCtrl getEntryUUID Dn remoteDn remoteEntry getDn switch state case ADD boolean remoteDnExist false try remoteDnExist session exists remoteDn catch LdapNoSuchObjectException lnsoe
syncCookie syncStateCtrl getCookie rid LdapProtocolUtils getReplicaId Strings utf8ToString syncCookie CONSUMER_LOG debug Strings utf8ToString syncCookie SyncStateTypeEnum state syncStateCtrl getSyncStateType if CONSUMER_LOG isDebugEnabled CONSUMER_LOG debug state name CONSUMER_LOG debug Strings uuidToString syncStateCtrl getEntryUUID Dn remoteDn remoteEntry getDn switch state case ADD boolean remoteDnExist false try remoteDnExist session exists remoteDn catch LdapNoSuchObjectException lnsoe CONSUMER_LOG error lnsoe getMessage if remoteDnExist
rid LdapProtocolUtils getReplicaId Strings utf8ToString syncCookie CONSUMER_LOG debug Strings utf8ToString syncCookie SyncStateTypeEnum state syncStateCtrl getSyncStateType if CONSUMER_LOG isDebugEnabled CONSUMER_LOG debug state name CONSUMER_LOG debug Strings uuidToString syncStateCtrl getEntryUUID Dn remoteDn remoteEntry getDn switch state case ADD boolean remoteDnExist false try remoteDnExist session exists remoteDn catch LdapNoSuchObjectException lnsoe CONSUMER_LOG error lnsoe getMessage if remoteDnExist CONSUMER_LOG debug remoteDn
Dn remoteDn remoteEntry getDn switch state case ADD boolean remoteDnExist false try remoteDnExist session exists remoteDn catch LdapNoSuchObjectException lnsoe CONSUMER_LOG error lnsoe getMessage if remoteDnExist CONSUMER_LOG debug remoteDn CONSUMER_LOG debug remoteEntry toString AddOperationContext addContext new AddOperationContext session remoteEntry addContext setReplEvent true addContext setRid rid OperationManager operationManager directoryService getOperationManager operationManager add addContext
CONSUMER_LOG debug remoteDn CONSUMER_LOG debug remoteEntry toString AddOperationContext addContext new AddOperationContext session remoteEntry addContext setReplEvent true addContext setRid rid OperationManager operationManager directoryService getOperationManager operationManager add addContext else CONSUMER_LOG debug remoteDn modify remoteEntry rid break case MODIFY CONSUMER_LOG debug remoteEntry getDn getName modify remoteEntry rid break case MODDN String entryUuid Strings uuidToString syncStateCtrl getEntryUUID
CONSUMER_LOG debug config getProducer syncInfoValue int replicaId if cookie null if CONSUMER_LOG isDebugEnabled CONSUMER_LOG debug Strings utf8ToString cookie CONSUMER_LOG debug Strings utf8ToString cookie syncCookie cookie String cookieString Strings utf8ToString syncCookie replicaId LdapProtocolUtils getReplicaId cookieString CONSUMER_LOG info syncInfoValue isRefreshDeletes List byte uuidList syncInfoValue getSyncUUIDs if syncInfoValue isRefreshDeletes deleteEntries uuidList false replicaId else deleteEntries uuidList true replicaId
Override public void connectionClosed if CONSUMER_LOG isDebugEnabled MDC put Integer toString config getReplicaId
private ReplicationStatusEnum doSyncSearch SynchronizationModeEnum syncType boolean reloadHint throws Exception
private ReplicationStatusEnum doSyncSearch SynchronizationModeEnum syncType boolean reloadHint throws Exception CONSUMER_LOG debug syncType reloadHint SyncRequestValue syncReq new SyncRequestValueImpl syncReq setMode syncType syncReq setReloadHint reloadHint if syncCookie null
else CONSUMER_LOG debug config getProducer searchRequest addControl syncReq SearchFuture sf connection searchAsync searchRequest Response resp sf get CONSUMER_LOG debug config getProducer resp while resp SearchResultDone sf isCancelled disconnected if resp SearchResultEntry SearchResultEntry result SearchResultEntry resp handleSearchResultEntry result else if resp SearchResultReference handleSearchReference SearchResultReference resp else if resp IntermediateResponse handleSyncInfo IntermediateResponse resp resp sf get
CONSUMER_LOG debug config getProducer searchRequest addControl syncReq SearchFuture sf connection searchAsync searchRequest Response resp sf get CONSUMER_LOG debug config getProducer resp while resp SearchResultDone sf isCancelled disconnected if resp SearchResultEntry SearchResultEntry result SearchResultEntry resp handleSearchResultEntry result else if resp SearchResultReference handleSearchReference SearchResultReference resp else if resp IntermediateResponse handleSyncInfo IntermediateResponse resp resp sf get CONSUMER_LOG debug config getProducer resp
SearchFuture sf connection searchAsync searchRequest Response resp sf get CONSUMER_LOG debug config getProducer resp while resp SearchResultDone sf isCancelled disconnected if resp SearchResultEntry SearchResultEntry result SearchResultEntry resp handleSearchResultEntry result else if resp SearchResultReference handleSearchReference SearchResultReference resp else if resp IntermediateResponse handleSyncInfo IntermediateResponse resp resp sf get CONSUMER_LOG debug config getProducer resp if sf isCancelled CONSUMER_LOG debug config getProducer sf getCause
if resp SearchResultEntry SearchResultEntry result SearchResultEntry resp handleSearchResultEntry result else if resp SearchResultReference handleSearchReference SearchResultReference resp else if resp IntermediateResponse handleSyncInfo IntermediateResponse resp resp sf get CONSUMER_LOG debug config getProducer resp if sf isCancelled CONSUMER_LOG debug config getProducer sf getCause return ReplicationStatusEnum DISCONNECTED else if disconnected CONSUMER_LOG debug config getProducer return ReplicationStatusEnum DISCONNECTED
resp sf get CONSUMER_LOG debug config getProducer resp if sf isCancelled CONSUMER_LOG debug config getProducer sf getCause return ReplicationStatusEnum DISCONNECTED else if disconnected CONSUMER_LOG debug config getProducer return ReplicationStatusEnum DISCONNECTED else ResultCodeEnum resultCode handleSearchResultDone SearchResultDone resp CONSUMER_LOG debug config getProducer resultCode if resultCode ResultCodeEnum NO_SUCH_OBJECT CONSUMER_LOG warn config getBaseDn config getProducer CONSUMER_LOG warn config getProducer disconnect
return ReplicationStatusEnum DISCONNECTED else if disconnected CONSUMER_LOG debug config getProducer return ReplicationStatusEnum DISCONNECTED else ResultCodeEnum resultCode handleSearchResultDone SearchResultDone resp CONSUMER_LOG debug config getProducer resultCode if resultCode ResultCodeEnum NO_SUCH_OBJECT CONSUMER_LOG warn config getBaseDn config getProducer CONSUMER_LOG warn config getProducer disconnect return ReplicationStatusEnum DISCONNECTED else if resultCode ResultCodeEnum E_SYNC_REFRESH_REQUIRED CONSUMER_LOG warn config getProducer reload true
CONSUMER_LOG debug config getProducer return ReplicationStatusEnum DISCONNECTED else ResultCodeEnum resultCode handleSearchResultDone SearchResultDone resp CONSUMER_LOG debug config getProducer resultCode if resultCode ResultCodeEnum NO_SUCH_OBJECT CONSUMER_LOG warn config getBaseDn config getProducer CONSUMER_LOG warn config getProducer disconnect return ReplicationStatusEnum DISCONNECTED else if resultCode ResultCodeEnum E_SYNC_REFRESH_REQUIRED CONSUMER_LOG warn config getProducer reload true try CONSUMER_LOG debug config getBaseDn
private void disconnect disconnected true try if connection null connection isConnected connection unBind CONSUMER_LOG info config getProducer if CONSUMER_LOG isDebugEnabled MDC put Integer toString config getReplicaId
if syncCookie null return if lastSavedCookie null Arrays equals syncCookie lastSavedCookie return try Attribute attr cookieMod getAttribute attr clear attr add syncCookie String cookieString Strings utf8ToString syncCookie int replicaId LdapProtocolUtils getReplicaId cookieString Attribute ridAt ridMod getAttribute ridAt clear ridAt add String valueOf replicaId CONSUMER_LOG debug config getConfigEntryDn session modify config getConfigEntryDn cookieMod
return try Attribute attr cookieMod getAttribute attr clear attr add syncCookie String cookieString Strings utf8ToString syncCookie int replicaId LdapProtocolUtils getReplicaId cookieString Attribute ridAt ridMod getAttribute ridAt clear ridAt add String valueOf replicaId CONSUMER_LOG debug config getConfigEntryDn session modify config getConfigEntryDn cookieMod CONSUMER_LOG debug config getConfigEntryDn lastSavedCookie new byte syncCookie length System arraycopy syncCookie lastSavedCookie syncCookie length
private void readCookie try Entry entry session lookup config getConfigEntryDn SchemaConstants ADS_REPL_COOKIE if entry null Attribute attr entry get adsReplCookieAT if attr null syncCookie attr getBytes lastSavedCookie syncCookie String syncCookieString Strings utf8ToString syncCookie
private void readCookie try Entry entry session lookup config getConfigEntryDn SchemaConstants ADS_REPL_COOKIE if entry null Attribute attr entry get adsReplCookieAT if attr null syncCookie attr getBytes lastSavedCookie syncCookie String syncCookieString Strings utf8ToString syncCookie CONSUMER_LOG debug syncCookieString config getReplicaId else CONSUMER_LOG debug config getReplicaId else CONSUMER_LOG debug config getConfigEntryDn config getReplicaId catch Exception e
private void removeCookie try Attribute cookieAttr new DefaultAttribute adsReplCookieAT Modification deleteCookieMod new DefaultModification ModificationOperation REMOVE_ATTRIBUTE cookieAttr session modify config getConfigEntryDn deleteCookieMod
private void applyModDnOperation Entry remoteEntry String entryUuid int rid throws Exception
searchRequest setFilter filter searchRequest setScope SearchScope SUBTREE searchRequest addAttributes SchemaConstants ENTRY_UUID_AT SchemaConstants ENTRY_CSN_AT SchemaConstants ALL_USER_ATTRIBUTES Cursor Entry cursor session search searchRequest cursor beforeFirst Entry localEntry null if cursor next localEntry cursor get cursor close if localEntry null return if config isMmrMode Csn localCsn new Csn localEntry get SchemaConstants ENTRY_CSN_AT getString Csn remoteCsn new Csn remoteEntry get SchemaConstants ENTRY_CSN_AT getString if localCsn compareTo remoteCsn
if localEntry null return if config isMmrMode Csn localCsn new Csn localEntry get SchemaConstants ENTRY_CSN_AT getString Csn remoteCsn new Csn remoteEntry get SchemaConstants ENTRY_CSN_AT getString if localCsn compareTo remoteCsn CONSUMER_LOG debug remoteEntry getDn return Dn localDn localEntry getDn Dn remoteDn directoryService getDnFactory create remoteEntry getDn getName Dn localParentDn localDn getParent Dn remoteParentDn directoryService getDnFactory create remoteDn getParent getName Rdn localRdn localDn getRdn Rdn remoteRdn directoryService getDnFactory create remoteDn getRdn getName getRdn boolean deleteOldRdn remoteEntry contains localRdn getNormType localRdn getValue
if localCsn compareTo remoteCsn CONSUMER_LOG debug remoteEntry getDn return Dn localDn localEntry getDn Dn remoteDn directoryService getDnFactory create remoteEntry getDn getName Dn localParentDn localDn getParent Dn remoteParentDn directoryService getDnFactory create remoteDn getParent getName Rdn localRdn localDn getRdn Rdn remoteRdn directoryService getDnFactory create remoteDn getRdn getName getRdn boolean deleteOldRdn remoteEntry contains localRdn getNormType localRdn getValue if localRdn equals remoteRdn CONSUMER_LOG debug localDn remoteParentDn MoveOperationContext movCtx new MoveOperationContext session localDn remoteParentDn movCtx setReplEvent true movCtx setRid rid
Dn remoteDn directoryService getDnFactory create remoteEntry getDn getName Dn localParentDn localDn getParent Dn remoteParentDn directoryService getDnFactory create remoteDn getParent getName Rdn localRdn localDn getRdn Rdn remoteRdn directoryService getDnFactory create remoteDn getRdn getName getRdn boolean deleteOldRdn remoteEntry contains localRdn getNormType localRdn getValue if localRdn equals remoteRdn CONSUMER_LOG debug localDn remoteParentDn MoveOperationContext movCtx new MoveOperationContext session localDn remoteParentDn movCtx setReplEvent true movCtx setRid rid directoryService getOperationManager move movCtx else if localParentDn equals remoteParentDn CONSUMER_LOG debug localDn getName remoteRdn getName String valueOf deleteOldRdn RenameOperationContext renCtx new RenameOperationContext session localDn remoteRdn deleteOldRdn
else if isRefreshPresent filter new AndNode else filter new OrNode for int i i size i String uuid Strings uuidToString limitedUuidList get i ExprNode uuidEqNode new EqualityNode String SchemaConstants ENTRY_UUID_AT uuid if isRefreshPresent uuidEqNode new NotNode uuidEqNode AndNode filter addNode uuidEqNode else OrNode filter addNode uuidEqNode Dn dn new Dn schemaManager config getBaseDn if CONSUMER_LOG isDebugEnabled
private void deleteRecursive Dn rootDn int rid throws Exception
req addControl ctrl cursor session search req cursor beforeFirst OperationManager operationManager directoryService getOperationManager while cursor next Entry e cursor get DeleteOperationContext ctx new DeleteOperationContext session ctx setReplEvent true ctx setRid rid if reload ctx setGenerateNoReplEvt true ctx setDn e getDn operationManager delete ctx catch Exception e String msg rootDn getName
private void createConsumersBranch throws Exception if adminSession exists replConsumerDn LOG debug
Override public void run while stop for ReplicaEventLog log replicaLogMap values synchronized log try String lastSentCsn log getLastSentCsn if lastSentCsn null
continue long thresholdCount log getPurgeThresholdCount if log count thresholdCount continue LOG debug thresholdTime long deleteCount ReplicaJournalCursor cursor log getCursor null cursor skipQualifyingWhileFetching while cursor next ReplicaEventMessage message cursor get String csnVal message getEntry get SchemaConstants ENTRY_CSN_AT getString if csnVal compareTo lastSentCsn break Csn csn new Csn csnVal if now csn getTimestamp thresholdTime
public synchronized void removeEventLog ReplicaEventLog replicaEventLog directoryService getEventService removeListener replicaEventLog getPersistentListener String name replicaEventLog getName
public synchronized void removeEventLog ReplicaEventLog replicaEventLog directoryService getEventService removeListener replicaEventLog getPersistentListener String name replicaEventLog getName LOG debug name replicaLogMap remove replicaEventLog getId try replicaEventLog stop new File directoryService getInstanceLayout getReplDirectory name delete new File directoryService getInstanceLayout getReplDirectory name delete
private boolean isQualified String csn ReplicaEventMessage evtMsg throws LdapException
public void stop EventService evtSrv dirService getEventService evtSrv removeListener cledListener logJanitor stopCleaning logJanitor interrupt consumerInfoUpdateThread interrupt for ReplicaEventLog log replicaLogMap values try
public void handleSyncRequest LdapSession session SearchRequest request throws LdapException
request addAttributes SchemaConstants ALL_OPERATIONAL_ATTRIBUTES SyncRequestValue syncControl SyncRequestValue request getControls get SyncRequestValue OID byte cookieBytes syncControl getCookie if cookieBytes null PROVIDER_LOG debug doInitialRefresh session request else String cookieString Strings utf8ToString cookieBytes PROVIDER_LOG debug request cookieString if LdapProtocolUtils isValidCookie cookieString PROVIDER_LOG error cookieString session sendESyncRefreshRequired session request else ReplicaEventLog clientMsgLog getReplicaEventLog cookieString if clientMsgLog null
private void sendContentFromLog LdapSession session SearchRequest req ReplicaEventLog clientMsgLog String fromCsn throws Exception String lastSentCsn fromCsn ReplicaJournalCursor cursor clientMsgLog getCursor fromCsn
private void sendContentFromLog LdapSession session SearchRequest req ReplicaEventLog clientMsgLog String fromCsn throws Exception String lastSentCsn fromCsn ReplicaJournalCursor cursor clientMsgLog getCursor fromCsn PROVIDER_LOG debug clientMsgLog getId try while cursor next ReplicaEventMessage replicaEventMessage cursor get Entry entry replicaEventMessage getEntry
lastSentCsn entry get csnAT getString ChangeType changeType replicaEventMessage getChangeType SyncStateTypeEnum syncStateType null switch changeType case ADD syncStateType SyncStateTypeEnum ADD break case MODIFY syncStateType SyncStateTypeEnum MODIFY break case MODDN syncStateType SyncStateTypeEnum MODDN break case DELETE syncStateType SyncStateTypeEnum DELETE break default throw new IllegalStateException I18n err I18n ERR_686 sendSearchResultEntry session req entry syncStateType clientMsgLog setLastSentCsn lastSentCsn
private void doContentUpdate LdapSession session SearchRequest req ReplicaEventLog replicaLog String consumerCsn throws Exception synchronized replicaLog boolean refreshNPersist isRefreshNPersist req if refreshNPersist SyncReplSearchListener handler replicaLog getPersistentListener handler setSearchRequest req handler setSession session sendContentFromLog session req replicaLog consumerCsn String lastSentCsn replicaLog getLastSentCsn byte cookie LdapProtocolUtils createCookie replicaLog getId lastSentCsn if refreshNPersist SyncInfoValue syncInfoValue new SyncInfoValueImpl syncInfoValue setSyncInfoValueType SynchronizationInfoEnum NEW_COOKIE syncInfoValue setMessageId req getMessageId syncInfoValue setCookie cookie
String lastSentCsn replicaLog getLastSentCsn byte cookie LdapProtocolUtils createCookie replicaLog getId lastSentCsn if refreshNPersist SyncInfoValue syncInfoValue new SyncInfoValueImpl syncInfoValue setSyncInfoValueType SynchronizationInfoEnum NEW_COOKIE syncInfoValue setMessageId req getMessageId syncInfoValue setCookie cookie PROVIDER_LOG debug replicaLog getId syncInfoValue session getIoSession write syncInfoValue replicaLog getPersistentListener setPushInRealTime refreshNPersist else SearchResultDone searchDoneResp SearchResultDone req getResultResponse searchDoneResp getLdapResult setResultCode ResultCodeEnum SUCCESS SyncDoneValue syncDone new SyncDoneValueImpl syncDone setCookie cookie
InetSocketAddress address InetSocketAddress session getIoSession getRemoteAddress String hostName address getAddress getHostName ExprNode modifiedFilter modifyFilter session request Partition partition dirService getPartitionNexus getPartition request getBase String contextCsn try PartitionTxn partitionTxn partition beginReadTransaction contextCsn partition getContextCsn partitionTxn boolean refreshNPersist isRefreshNPersist request ReplicaEventLog replicaLog null try PartitionTxn partitionTxn partition beginReadTransaction replicaLog createReplicaEventLog partitionTxn hostName originalFilter replicaLog setRefreshNPersist refreshNPersist Value contexCsnValue new Value dirService getAtProvider getEntryCSN contextCsn GreaterEqNode csnGeNode new GreaterEqNode csnAT contexCsnValue ExprNode postInitContentFilter new AndNode modifiedFilter csnGeNode
criteria setEventMask EventType ALL_EVENT_TYPES_MASK replicaLog setSearchCriteria criteria dirService getEventService addListener replicationListener criteria LessEqNode csnNode new LessEqNode csnAT contexCsnValue ExprNode initialContentFilter new AndNode modifiedFilter csnNode request setFilter initialContentFilter SearchResultDone searchDoneResp doSimpleSearch session request replicaLog if searchDoneResp getLdapResult getResultCode ResultCodeEnum SUCCESS if replicaLog getLastSentCsn null replicaLog setLastSentCsn contextCsn if refreshNPersist PROVIDER_LOG debug sendContentFromLog session request replicaLog contextCsn byte cookie LdapProtocolUtils createCookie replicaLog getId replicaLog getLastSentCsn SyncInfoValue syncInfoValue new SyncInfoValueImpl
LessEqNode csnNode new LessEqNode csnAT contexCsnValue ExprNode initialContentFilter new AndNode modifiedFilter csnNode request setFilter initialContentFilter SearchResultDone searchDoneResp doSimpleSearch session request replicaLog if searchDoneResp getLdapResult getResultCode ResultCodeEnum SUCCESS if replicaLog getLastSentCsn null replicaLog setLastSentCsn contextCsn if refreshNPersist PROVIDER_LOG debug sendContentFromLog session request replicaLog contextCsn byte cookie LdapProtocolUtils createCookie replicaLog getId replicaLog getLastSentCsn SyncInfoValue syncInfoValue new SyncInfoValueImpl syncInfoValue setSyncInfoValueType SynchronizationInfoEnum NEW_COOKIE syncInfoValue setMessageId request getMessageId syncInfoValue setCookie cookie
if refreshNPersist PROVIDER_LOG debug sendContentFromLog session request replicaLog contextCsn byte cookie LdapProtocolUtils createCookie replicaLog getId replicaLog getLastSentCsn SyncInfoValue syncInfoValue new SyncInfoValueImpl syncInfoValue setSyncInfoValueType SynchronizationInfoEnum NEW_COOKIE syncInfoValue setMessageId request getMessageId syncInfoValue setCookie cookie PROVIDER_LOG info replicaLog syncInfoValue session getIoSession write syncInfoValue replicationListener setPushInRealTime refreshNPersist PROVIDER_LOG debug replicaLog else PROVIDER_LOG debug byte cookie LdapProtocolUtils createCookie replicaLog getId contextCsn
private SearchResultDone doSimpleSearch LdapSession session SearchRequest req ReplicaEventLog replicaLog throws Exception
private SearchResultDone doSimpleSearch LdapSession session SearchRequest req ReplicaEventLog replicaLog throws Exception PROVIDER_LOG debug req session SearchResultDone searchDoneResp SearchResultDone req getResultResponse LdapResult ldapResult searchDoneResp getLdapResult Cursor Entry cursor session getCoreSession search req cursor beforeFirst try long serverLimit getServerSizeLimit session req long requestLimit req getSizeLimit 0L Long MAX_VALUE req getSizeLimit req addAbandonListener new SearchAbandonListener ldapServer cursor setTimeLimitsOnCursor req session cursor
Cursor Entry cursor session getCoreSession search req cursor beforeFirst try long serverLimit getServerSizeLimit session req long requestLimit req getSizeLimit 0L Long MAX_VALUE req getSizeLimit req addAbandonListener new SearchAbandonListener ldapServer cursor setTimeLimitsOnCursor req session cursor PROVIDER_LOG debug requestLimit serverLimit long sizeLimit min requestLimit serverLimit readResults session req ldapResult cursor sizeLimit replicaLog finally if cursor null try cursor close catch Exception e
private void readResults LdapSession session SearchRequest req LdapResult ldapResult Cursor Entry cursor long sizeLimit ReplicaEventLog replicaLog throws Exception long count while count sizeLimit cursor next if session getIoSession isClosing
Attribute ref entry get SchemaConstants REF_AT boolean hasManageDsaItControl req getControls containsKey ManageDsaIT OID if ref null hasManageDsaItControl SearchResultReference respRef respRef new SearchResultReferenceImpl req getMessageId respRef setReferral new ReferralImpl for Value val ref String url val getString if url startsWith respRef getReferral addLdapUrl url LdapUrl ldapUrl null try ldapUrl new LdapUrl url ldapUrl setForceScopeRendering true catch LdapURLEncodingException e
private void storeReplicaInfo try for Map Entry Integer ReplicaEventLog e replicaLogMap entrySet ReplicaEventLog replica e getValue if replica isDirty
private void loadReplicaInfo try List ReplicaEventLog eventLogs replicaUtil getReplicaEventLogs Set String eventLogNames new HashSet if eventLogs isEmpty for ReplicaEventLog replica eventLogs
try List ReplicaEventLog eventLogs replicaUtil getReplicaEventLogs Set String eventLogNames new HashSet if eventLogs isEmpty for ReplicaEventLog replica eventLogs PROVIDER_LOG debug replica getId replicaLogMap put replica getId replica eventLogNames add replica getName if replicaCount get replica getId replicaCount set replica getId else PROVIDER_LOG debug for File f getAllReplJournalNames if eventLogNames contains f getName f delete
Set String eventLogNames new HashSet if eventLogs isEmpty for ReplicaEventLog replica eventLogs PROVIDER_LOG debug replica getId replicaLogMap put replica getId replica eventLogNames add replica getName if replicaCount get replica getId replicaCount set replica getId else PROVIDER_LOG debug for File f getAllReplJournalNames if eventLogNames contains f getName f delete PROVIDER_LOG info f catch Exception e
private void registerPersistentSearches throws Exception for Map Entry Integer ReplicaEventLog e replicaLogMap entrySet ReplicaEventLog log e getValue if log getSearchCriteria null
private ReplicaEventLog createReplicaEventLog PartitionTxn partitionTxn String hostName String filter throws Exception int replicaId replicaCount incrementAndGet
private void sendResult SearchResultEntry searchResultEntry Entry entry EventType eventType SyncStateValue syncStateValue searchResultEntry addControl syncStateValue
Entry entry moveContext getModifiedEntry if isConfigEntry entry isNotValidForReplication moveContext return try if moveContext getNewSuperior isDescendantOf consumerMsgLog getSearchCriteria getBase sendDeletedEntry moveContext getOriginalEntry return consumerMsgLog log new ReplicaEventMessage ChangeType MODDN entry if pushInRealTime SearchResultEntry resultEntry new SearchResultEntryImpl searchRequest getMessageId resultEntry setObjectName moveContext getDn resultEntry setEntry entry SyncStateValue syncModify createControl session getCoreSession getDirectoryService SyncStateTypeEnum MODDN entry sendResult resultEntry entry EventType MOVE syncModify catch Exception e
Entry entry moveAndRenameContext getModifiedEntry if isConfigEntry entry isNotValidForReplication moveAndRenameContext return try if moveAndRenameContext getNewSuperiorDn isDescendantOf consumerMsgLog getSearchCriteria getBase sendDeletedEntry entry return consumerMsgLog log new ReplicaEventMessage ChangeType MODDN entry if pushInRealTime SearchResultEntry resultEntry new SearchResultEntryImpl searchRequest getMessageId resultEntry setObjectName entry getDn resultEntry setEntry entry SyncStateValue syncModify createControl session getCoreSession getDirectoryService SyncStateTypeEnum MODDN entry sendResult resultEntry entry EventType MOVE_AND_RENAME syncModify catch Exception e
private void handleWriteFuture WriteFuture future Entry entry EventType event future awaitUninterruptibly 10000L if future isWritten LOG error new Object consumerMsgLog getId event entry getDn
private boolean isMmrConfiguredToReceiver AbstractChangeOperationContext ctx if ctx isReplEvent boolean skip ctx getRid consumerMsgLog getId if skip
Override public void exceptionCaught IoSession session Throwable cause
Override public void messageReceived IoSession session Object message if LOG isDebugEnabled
protected void print NtpMessage request
protected void print NtpMessage request log debug String valueOf request getLeapIndicator
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision log debug String valueOf request getRootDelay
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision log debug String valueOf request getRootDelay log debug String valueOf request getRootDispersion
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision log debug String valueOf request getRootDelay log debug String valueOf request getRootDispersion log debug String valueOf request getReferenceIdentifier
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision log debug String valueOf request getRootDelay log debug String valueOf request getRootDispersion log debug String valueOf request getReferenceIdentifier log debug String valueOf request getReferenceTimestamp
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision log debug String valueOf request getRootDelay log debug String valueOf request getRootDispersion log debug String valueOf request getReferenceIdentifier log debug String valueOf request getReferenceTimestamp log debug String valueOf request getOriginateTimestamp
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision log debug String valueOf request getRootDelay log debug String valueOf request getRootDispersion log debug String valueOf request getReferenceIdentifier log debug String valueOf request getReferenceTimestamp log debug String valueOf request getOriginateTimestamp log debug String valueOf request getReceiveTimestamp
protected void print NtpMessage request
protected void print NtpMessage request log debug String valueOf request getLeapIndicator
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision log debug String valueOf request getRootDelay
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision log debug String valueOf request getRootDelay log debug String valueOf request getRootDispersion
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision log debug String valueOf request getRootDelay log debug String valueOf request getRootDispersion log debug String valueOf request getReferenceIdentifier
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision log debug String valueOf request getRootDelay log debug String valueOf request getRootDispersion log debug String valueOf request getReferenceIdentifier log debug String valueOf request getReferenceTimestamp
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision log debug String valueOf request getRootDelay log debug String valueOf request getRootDispersion log debug String valueOf request getReferenceIdentifier log debug String valueOf request getReferenceTimestamp log debug String valueOf request getOriginateTimestamp
protected void print NtpMessage request log debug String valueOf request getLeapIndicator log debug String valueOf request getVersionNumber log debug String valueOf request getMode log debug String valueOf request getStratum log debug String valueOf request getPollInterval log debug String valueOf request getPrecision log debug String valueOf request getRootDelay log debug String valueOf request getRootDispersion log debug String valueOf request getReferenceIdentifier log debug String valueOf request getReferenceTimestamp log debug String valueOf request getOriginateTimestamp log debug String valueOf request getReceiveTimestamp
public static Entry findPrincipalEntry CoreSession session Dn searchBaseDn String principal throws Exception Cursor Entry cursor null try SchemaManager schemaManager session getDirectoryService getSchemaManager cursor session search searchBaseDn SearchScope SUBTREE getFilter schemaManager principal AliasDerefMode DEREF_ALWAYS SchemaConstants ALL_USER_ATTRIBUTES cursor beforeFirst if cursor next Entry entry cursor get
public static Entry findPrincipalEntry CoreSession session Dn searchBaseDn String principal throws Exception Cursor Entry cursor null try SchemaManager schemaManager session getDirectoryService getSchemaManager cursor session search searchBaseDn SearchScope SUBTREE getFilter schemaManager principal AliasDerefMode DEREF_ALWAYS SchemaConstants ALL_USER_ATTRIBUTES cursor beforeFirst if cursor next Entry entry cursor get LOG debug entry getDn principal
public static Entry findPrincipalEntry CoreSession session Dn searchBaseDn String principal throws Exception Cursor Entry cursor null try SchemaManager schemaManager session getDirectoryService getSchemaManager cursor session search searchBaseDn SearchScope SUBTREE getFilter schemaManager principal AliasDerefMode DEREF_ALWAYS SchemaConstants ALL_USER_ATTRIBUTES cursor beforeFirst if cursor next Entry entry cursor get LOG debug entry getDn principal LOG_KRB debug entry getDn principal while cursor next
try InputStream in getLdifStream for LdifEntry ldifEntry new LdifReader in Dn dn ldifEntry getDn if ldifEntry isEntry Entry entry ldifEntry getEntry boolean filterAccepted applyFilters dn entry if filterAccepted continue try coreSession lookup dn LOG info dn catch Exception e try coreSession add new DefaultEntry coreSession getDirectoryService getSchemaManager entry count
Dn dn ldifEntry getDn if ldifEntry isEntry Entry entry ldifEntry getEntry boolean filterAccepted applyFilters dn entry if filterAccepted continue try coreSession lookup dn LOG info dn catch Exception e try coreSession add new DefaultEntry coreSession getDirectoryService getSchemaManager entry count LOG info dn catch LdapException e1
continue try coreSession lookup dn LOG info dn catch Exception e try coreSession add new DefaultEntry coreSession getDirectoryService getSchemaManager entry count LOG info dn catch LdapException e1 LOG info entry e1 else List Modification items ldifEntry getModifications try coreSession modify dn items
try coreSession lookup dn LOG info dn catch Exception e try coreSession add new DefaultEntry coreSession getDirectoryService getSchemaManager entry count LOG info dn catch LdapException e1 LOG info entry e1 else List Modification items ldifEntry getModifications try coreSession modify dn items LOG info dn items
Set ObjectClass candidates new HashSet for Value ocValue objectClass String ocName ocValue getString String ocOid schemaManager getObjectClassRegistry getOidByName ocName ObjectClass oc schemaManager getObjectClassRegistry get ocOid if oc isStructural candidates add oc for Value ocValue objectClass String ocName ocValue getString String ocOid schemaManager getObjectClassRegistry getOidByName ocName ObjectClass oc schemaManager getObjectClassRegistry get ocOid for ObjectClass superior oc getSuperiors if oc isStructural candidates contains superior candidates remove superior ObjectClass result candidates toArray new ObjectClass
private AdsBaseBean createBean ObjectClass objectClass throws ConfigurationException String objectClassName objectClass getName String beanName this getClass getPackage getName Character toUpperCase objectClassName charAt ADS_PREFIX length objectClassName substring ADS_PREFIX length ADS_SUFFIX try Class clazz Class forName beanName Constructor constructor clazz getConstructor AdsBaseBean bean AdsBaseBean constructor newInstance
private AdsBaseBean createBean ObjectClass objectClass throws ConfigurationException String objectClassName objectClass getName String beanName this getClass getPackage getName Character toUpperCase objectClassName charAt ADS_PREFIX length objectClassName substring ADS_PREFIX length ADS_SUFFIX try Class clazz Class forName beanName Constructor constructor clazz getConstructor AdsBaseBean bean AdsBaseBean constructor newInstance LOG debug beanName objectClassName return bean catch ClassNotFoundException cnfe String message objectClassName LOG error message throw new ConfigurationException message catch SecurityException e String message beanName
Class clazz Class forName beanName Constructor constructor clazz getConstructor AdsBaseBean bean AdsBaseBean constructor newInstance LOG debug beanName objectClassName return bean catch ClassNotFoundException cnfe String message objectClassName LOG error message throw new ConfigurationException message catch SecurityException e String message beanName LOG error message throw new ConfigurationException message catch NoSuchMethodException nsme String message beanName
return bean catch ClassNotFoundException cnfe String message objectClassName LOG error message throw new ConfigurationException message catch SecurityException e String message beanName LOG error message throw new ConfigurationException message catch NoSuchMethodException nsme String message beanName LOG error message throw new ConfigurationException message catch InvocationTargetException ite String message beanName ite getMessage
LOG error message throw new ConfigurationException message catch SecurityException e String message beanName LOG error message throw new ConfigurationException message catch NoSuchMethodException nsme String message beanName LOG error message throw new ConfigurationException message catch InvocationTargetException ite String message beanName ite getMessage LOG error message throw new ConfigurationException message catch IllegalAccessException iae
String message beanName LOG error message throw new ConfigurationException message catch NoSuchMethodException nsme String message beanName LOG error message throw new ConfigurationException message catch InvocationTargetException ite String message beanName ite getMessage LOG error message throw new ConfigurationException message catch IllegalAccessException iae String message beanName LOG error message throw new ConfigurationException message
else beanField set bean Strings EMPTY_BYTES else if type int class beanField setInt bean Integer parseInt valueStr else if type long class beanField setLong bean Long parseLong valueStr else if type boolean class beanField setBoolean bean Boolean parseBoolean valueStr else if type Dn class try Dn dn new Dn valueStr beanField set bean dn catch LdapInvalidDnException lide String message valueStr fieldAttr getId LOG error message
else if type Dn class try Dn dn new Dn valueStr field set bean dn catch LdapInvalidDnException lide String message valueStr attribute getId LOG error message throw new ConfigurationException message else if type Set class type List class Type genericFieldType field getGenericType Class fieldArgClass null if genericFieldType ParameterizedType ParameterizedType parameterizedType ParameterizedType genericFieldType Type fieldArgTypes parameterizedType getActualTypeArguments for Type fieldArgType fieldArgTypes
catch LdapInvalidDnException lide String message valueStr attribute getId LOG error message throw new ConfigurationException message else if type Set class type List class Type genericFieldType field getGenericType Class fieldArgClass null if genericFieldType ParameterizedType ParameterizedType parameterizedType ParameterizedType genericFieldType Type fieldArgTypes parameterizedType getActualTypeArguments for Type fieldArgType fieldArgTypes fieldArgClass Class fieldArgType Method method bean getClass getMethod addMethodName Array newInstance fieldArgClass getClass method invoke bean new Object new String valueStr catch IllegalArgumentException IllegalAccessException e
throw new ConfigurationException message else if type Set class type List class Type genericFieldType field getGenericType Class fieldArgClass null if genericFieldType ParameterizedType ParameterizedType parameterizedType ParameterizedType genericFieldType Type fieldArgTypes parameterizedType getActualTypeArguments for Type fieldArgType fieldArgTypes fieldArgClass Class fieldArgType Method method bean getClass getMethod addMethodName Array newInstance fieldArgClass getClass method invoke bean new Object new String valueStr catch IllegalArgumentException IllegalAccessException e String message valueStr attribute getId LOG error message throw new ConfigurationException message
Type genericFieldType field getGenericType Class fieldArgClass null if genericFieldType ParameterizedType ParameterizedType parameterizedType ParameterizedType genericFieldType Type fieldArgTypes parameterizedType getActualTypeArguments for Type fieldArgType fieldArgTypes fieldArgClass Class fieldArgType Method method bean getClass getMethod addMethodName Array newInstance fieldArgClass getClass method invoke bean new Object new String valueStr catch IllegalArgumentException IllegalAccessException e String message valueStr attribute getId LOG error message throw new ConfigurationException message catch SecurityException e String message bean getClass getName
if attribute null if attribute size if isMultiple field getType readSingleValueField bean field attribute else readMultiValuedField bean field attribute else if attribute size readSingleValueField bean field attribute else if mandatory String message entry getDn attributeTypeName LOG error message throw new ConfigurationException message else if mandatory String message entry getDn attributeTypeName
public List AdsBaseBean read Dn baseDn String name SearchScope scope boolean mandatory throws ConfigurationException
cursor close String message baseDn name LOG error message throw new ConfigurationException message else return null do IndexEntry String String forwardEntry cursor get Entry entry configPartition fetch partitionTxn forwardEntry getId LOG debug entry AdsBaseBean bean readConfig entry beansList add bean while cursor next catch ConfigurationException ce throw ce
public ConfigBean readConfig Dn baseDn String objectClass throws ConfigurationException
public static void extract File outputDirectory boolean overwrite throws IOException if outputDirectory exists
private static void copyFile File source File destination throws IOException
else if configFile exists overwrite LOG warn return configFile getAbsolutePath try URL configUrl LdifConfigExtractor class getClassLoader getResource file LOG debug configUrl byte buf new byte try InputStream in configUrl openStream Writer writer Files newBufferedWriter configFile toPath StandardCharsets UTF_8 while true int read in read buf if read break String s Strings utf8ToString buf read writer write s
public static LdapContext getWiredContext LdapServer ldapServer String principalDn String password throws NamingException
public static LdapContext getWiredContext LdapServer ldapServer Control controls throws NamingException
public static LdapContext getWiredContextThrowOnRefferal LdapServer ldapServer throws NamingException
public static LdapContext getWiredContextRefferalIgnore LdapServer ldapServer throws NamingException
public static LdapContext getWiredContextFollowOnRefferal LdapServer ldapServer throws NamingException
public void setUserPreferences LdapContext context String userName Map String Object attributes int count throws NamingException LdapContext derivedContext context String bindOp userName try try
Test public void testRenameWithALotOfDummiesAndSomeCustomAttributesAPI throws LdapException CursorException IOException LdapConnection connection new LdapNetworkConnection Network LOOPBACK_HOSTNAME getLdapServer getPort connection bind Dn peopleDn new Dn BASE connection add new DefaultEntry peopleDn int dummyCount for int i i dummyCount i String dn i peopleDn connection add new DefaultEntry dn i i i i if i
Test Ignore public void testRenameWithALotOfDummiesAndSomeCustomAttributes CreateLdapConnectionPoolRule connectionPool new CreateLdapConnectionPoolRule LdapConnectionTemplate template connectionPool getLdapConnectionTemplate AddResponse response null final String peopleOu final String peopleRdn peopleOu final String peopleDnString peopleRdn BASE final Dn peopleDn template newDn peopleDnString template execute new ConnectionCallback Void Override public Void doWithConnection LdapConnection connection throws LdapException
Test Ignore public void testRenameWithALotOfDummiesAndSomeCustomAttributes CreateLdapConnectionPoolRule connectionPool new CreateLdapConnectionPoolRule LdapConnectionTemplate template connectionPool getLdapConnectionTemplate AddResponse response null final String peopleOu final String peopleRdn peopleOu final String peopleDnString peopleRdn BASE final Dn peopleDn template newDn peopleDnString template execute new ConnectionCallback Void Override public Void doWithConnection LdapConnection connection throws LdapException logger debug peopleDnString connection add new DefaultEntry peopleDn peopleOu int dummyCount
final String peopleOu final String peopleRdn peopleOu final String peopleDnString peopleRdn BASE final Dn peopleDn template newDn peopleDnString template execute new ConnectionCallback Void Override public Void doWithConnection LdapConnection connection throws LdapException logger debug peopleDnString connection add new DefaultEntry peopleDn peopleOu int dummyCount logger debug dummyCount for int i i dummyCount i String uid i String dn uid peopleDn connection add new DefaultEntry dn uid i i i if i
template execute new ConnectionCallback Void Override public Void doWithConnection LdapConnection connection throws LdapException logger debug peopleDnString connection add new DefaultEntry peopleDn peopleOu int dummyCount logger debug dummyCount for int i i dummyCount i String uid i String dn uid peopleDn connection add new DefaultEntry dn uid i i i if i logger debug i return null for int i i i
Test public void testModifyRdnWithLotsOfDummies throws Exception String base String people String ouPeople people String dnPeople ouPeople base try LdapConnection connection ServerIntegrationUtils getAdminConnection getLdapServer connection loadSchema
Test public void testModifyRdnWithLotsOfDummies throws Exception String base String people String ouPeople people String dnPeople ouPeople base try LdapConnection connection ServerIntegrationUtils getAdminConnection getLdapServer connection loadSchema logger debug dnPeople connection add new DefaultEntry dnPeople people int dummyCount
String base String people String ouPeople people String dnPeople ouPeople base try LdapConnection connection ServerIntegrationUtils getAdminConnection getLdapServer connection loadSchema logger debug dnPeople connection add new DefaultEntry dnPeople people int dummyCount logger debug dummyCount for int i i dummyCount i String uid i String dn uid dnPeople connection add new DefaultEntry dn uid i i i if i
if connection connect CONSUMER_LOG info config getReplicaId config getProducer try connection bind config getReplUserDn Strings utf8ToString config getReplUserPassword disconnected false return true catch LdapException le CONSUMER_LOG warn config getProducer config getReplUserDn LOG warn config getReplUserDn LOG warn le disconnected true else CONSUMER_LOG warn config getReplicaId config getProducer disconnected true return false
if connection connect CONSUMER_LOG info config getReplicaId config getProducer try connection bind config getReplUserDn Strings utf8ToString config getReplUserPassword disconnected false return true catch LdapException le CONSUMER_LOG warn config getProducer config getReplUserDn LOG warn config getReplUserDn LOG warn le disconnected true else CONSUMER_LOG warn config getReplicaId config getProducer disconnected true return false
public ResultCodeEnum handleSearchDone SearchResultDone searchDone LOG debug SyncDoneValue ctrl SyncDoneValue searchDone getControls get SyncDoneValue OID if ctrl null ctrl getCookie null syncCookie ctrl getCookie
public void handleSearchResult SearchResultEntry syncResult LOG debug SyncStateValue syncStateCtrl SyncStateValue syncResult getControl SyncStateValue OID try Entry remoteEntry syncResult getEntry if syncStateCtrl getCookie null syncCookie syncStateCtrl getCookie
public void handleSyncInfo SyncInfoValue syncInfoValue try LOG debug
public void handleSyncInfo SyncInfoValue syncInfoValue try LOG debug LOG debug syncInfoValue byte cookie syncInfoValue getCookie int replicaId if cookie null
int replicaId if cookie null LOG debug Strings utf8ToString cookie syncCookie cookie String cookieString Strings utf8ToString syncCookie replicaId LdapProtocolUtils getReplicaId cookieString LOG info syncInfoValue isRefreshDeletes List byte uuidList syncInfoValue getSyncUUIDs if syncInfoValue isRefreshDeletes deleteEntries uuidList false else deleteEntries uuidList true LOG info syncInfoValue isRefreshDone storeCookie catch Exception de
public void ping boolean connected disconnected if disconnected connected connect if connected CONSUMER_LOG debug config getReplicaId try Entry baseDn connection lookup config getBaseDn if baseDn null CONSUMER_LOG debug config getBaseDn config getReplicaId else CONSUMER_LOG debug config getBaseDn config getReplicaId catch LdapException le disconnect else
private ReplicationStatusEnum doSyncSearch SynchronizationModeEnum syncType boolean reloadHint throws Exception SyncRequestValue syncReq new SyncRequestValueImpl syncReq setMode syncType syncReq setReloadHint reloadHint if syncCookie null
if syncCookie null LOG debug Strings utf8ToString syncCookie syncReq setCookie syncCookie searchRequest addControl syncReq SearchFuture sf connection searchAsync searchRequest Response resp sf get while resp SearchResultDone sf isCancelled disconnected if resp SearchResultEntry handleSearchResult SearchResultEntry resp else if resp SearchResultReference handleSearchReference SearchResultReference resp else if resp IntermediateResponse handleSyncInfo SyncInfoValue resp resp sf get ResultCodeEnum resultCode handleSearchDone SearchResultDone resp
private void storeCookie if syncCookie null return if lastSavedCookie null Arrays equals syncCookie lastSavedCookie return try if cookieFile null cookieFile new File cookieDir String valueOf LdapProtocolUtils getReplicaId new String syncCookie StandardCharsets UTF_8 try FileOutputStream fout new FileOutputStream cookieFile fout write syncCookie length fout write syncCookie lastSavedCookie new byte syncCookie length System arraycopy syncCookie lastSavedCookie syncCookie length LOG debug catch Exception e
public void removeCookie if cookieFile exists cookieFile length boolean deleted cookieFile delete
private void applyModDnOperation Entry remoteEntry String entryUuid throws Exception
private void deleteRecursive Dn rootDn Map Dn EntryFilteringCursor cursorMap throws Exception
SchemaManager schemaManager directoryService getSchemaManager if directoryService isStarted Set extends Partition partitions directoryService getPartitions for Partition p partitions if p AbstractBTreePartition File partitionPath new File directoryService getInstanceLayout getPartitionsDirectory p getId AbstractBTreePartition p setPartitionPath partitionPath toURI if p getSchemaManager null LOG info p getSuffixDn p setSchemaManager schemaManager Partition sysPartition directoryService getSystemPartition if sysPartition AbstractBTreePartition File partitionPath new File directoryService getInstanceLayout getPartitionsDirectory sysPartition getId AbstractBTreePartition sysPartition setPartitionPath partitionPath toURI if sysPartition getSchemaManager null
public void setSynchPeriodMillis long synchPeriodMillis
public void setLdifDirectory File ldifDirectory
throw new LdapException ne getMessage ne else File ldifFiles ldifDirectory listFiles new FileFilter Override public boolean accept File pathname boolean isLdif Strings toLowerCaseAscii pathname getName endsWith return pathname isFile pathname canRead isLdif if ldifFiles null ldifFiles length LOG warn getCanonical ldifDirectory return Arrays sort ldifFiles new Comparator File Override public int compare File f1 File f2 return f1 getName compareTo f2 getName for File ldifFile ldifFiles
public static List LdifEntry readTestEntries String entryFilePath throws ConfigurationException List LdifEntry entries new ArrayList File file new File entryFilePath if file exists LOG warn entryFilePath else LOG debug entryFilePath try loadEntries file entries catch LdapLdifException e String message e getMessage LOG error message throw new ConfigurationException message catch IOException e String message entryFilePath
if saslMechHandlerBean null saslMechHandlerBean isDisabled return null String mechClassName saslMechHandlerBean getSaslMechClassName Class mechClass null try mechClass Class forName mechClassName catch ClassNotFoundException e String message mechClassName LOG error message throw new ConfigurationException message MechanismHandler handler null try handler MechanismHandler mechClass newInstance catch InstantiationException e String message mechClassName
Class mechClass null try mechClass Class forName mechClassName catch ClassNotFoundException e String message mechClassName LOG error message throw new ConfigurationException message MechanismHandler handler null try handler MechanismHandler mechClass newInstance catch InstantiationException e String message mechClassName LOG error message throw new ConfigurationException message catch IllegalAccessException e
try Class extendedOpClass Class forName extendedpHandlerBean getExtendedOpHandlerClass ExtendedOperationHandler ExtendedRequest ExtendedResponse extOpHandler ExtendedOperationHandler ExtendedRequest ExtendedResponse extendedOpClass newInstance ldapServer addExtendedOperationHandler extOpHandler catch Exception e String message extendedpHandlerBean getExtendedOpId e getMessage LOG error message throw new ConfigurationException message boolean replicationEnabled ldapServerBean isReplEnabled if replicationEnabled String fqcn ldapServerBean getReplReqHandler if fqcn null try Class replProvImplClz Class forName fqcn ReplicationRequestHandler rp ReplicationRequestHandler replProvImplClz newInstance
return if entry contains passwordPolicyObjectClassAttribute return if deleted LOG debug dn ppolicyConfigContainer removePolicyConfig dn return PasswordPolicyBean bean null try bean PasswordPolicyBean cpReader readConfig entry catch Exception e LOG warn dn LOG warn e return if bean isDisabled
LOG debug dn ppolicyConfigContainer removePolicyConfig dn return PasswordPolicyBean bean null try bean PasswordPolicyBean cpReader readConfig entry catch Exception e LOG warn dn LOG warn e return if bean isDisabled LOG debug dn ppolicyConfigContainer removePolicyConfig dn else PasswordPolicyConfiguration updated ServiceBuilder createPwdPolicyConfig bean
return PasswordPolicyBean bean null try bean PasswordPolicyBean cpReader readConfig entry catch Exception e LOG warn dn LOG warn e return if bean isDisabled LOG debug dn ppolicyConfigContainer removePolicyConfig dn else PasswordPolicyConfiguration updated ServiceBuilder createPwdPolicyConfig bean PasswordPolicyConfiguration existing ppolicyConfigContainer getPolicyConfig dn if existing null
public void start InstanceLayout instanceLayout throws Exception File partitionsDir instanceLayout getPartitionsDirectory if partitionsDir exists
Modification csnMod new DefaultModification ModificationOperation REPLACE_ATTRIBUTE csnAt mods add csnMod atType MANDATORY_ENTRY_ATOP_MAP get SchemaConstants CREATORS_NAME_AT getAttributeType Attribute creatorAt entry get atType String creator creatorAt null creatorAt getString trim if creator length Dn isValid creator creatorAt new DefaultAttribute atType adminDn Modification creatorMod new DefaultModification ModificationOperation REPLACE_ATTRIBUTE creatorAt mods add creatorMod atType MANDATORY_ENTRY_ATOP_MAP get SchemaConstants CREATE_TIMESTAMP_AT getAttributeType Attribute createdTimeAt entry get atType String createdTime createdTimeAt null null createdTimeAt getString if timeChecker isValidSyntax createdTime createdTimeAt new DefaultAttribute atType DateUtils getGeneralizedTime Modification createdMod new DefaultModification ModificationOperation REPLACE_ATTRIBUTE createdTimeAt
public void start InstanceLayout instanceLayout boolean startServers throws Exception File partitionsDir instanceLayout getPartitionsDirectory if partitionsDir exists
Modification csnMod new DefaultModification ModificationOperation REPLACE_ATTRIBUTE csnAt mods add csnMod atType MANDATORY_ENTRY_ATOP_MAP get SchemaConstants CREATORS_NAME_AT getAttributeType Attribute creatorAt entry get atType String creator creatorAt null creatorAt getString trim if creator length Dn isValid creator creatorAt new DefaultAttribute atType adminDn Modification creatorMod new DefaultModification ModificationOperation REPLACE_ATTRIBUTE creatorAt mods add creatorMod atType MANDATORY_ENTRY_ATOP_MAP get SchemaConstants CREATE_TIMESTAMP_AT getAttributeType Attribute createdTimeAt entry get atType String createdTime createdTimeAt null null createdTimeAt getString if timeChecker isValidSyntax createdTime createdTimeAt new DefaultAttribute atType DateUtils getGeneralizedTime dirService getTimeProvider Modification createdMod new DefaultModification ModificationOperation REPLACE_ATTRIBUTE createdTimeAt
private void startShutdownListener final InstanceLayout layout throws IOException final int shutdownPort getShutdownPort final String shutdownPassword writeShutdownPassword layout UUID randomUUID toString new Thread new Runnable Override public void run try ServerSocket shutdownSocket new ServerSocket shutdownPort Network LOOPBACK writeShutdownPort layout shutdownSocket getLocalPort
break else try InputStreamReader reader new InputStreamReader socket getInputStream StandardCharsets UTF_8 CharBuffer buffer CharBuffer allocate while reader read buffer buffer flip String password buffer toString if shutdownPassword equals password stop break else LOG warn password catch IOException e LOG warn e catch IOException e
public void addEntry try String cn System currentTimeMillis DN dn new DN cn config getBaseDn Entry entry new DefaultEntry entry add entry add cn entry add cn entry setDn dn
Override public Statement apply final Statement base final Description description final CreateDS createDs description getAnnotation CreateDS class if createDs null final DirectoryService directoryService getDirectoryService if directoryService null directoryService getChangeLog isEnabled return new Statement Override public void evaluate throws Throwable Tag tag directoryService getChangeLog tag DSAnnotationProcessor applyLdifs description directoryService
if methodLdapServer null methodLdapServer setDirectoryService directoryService setLdapServer invoke getTestClass getJavaClass methodLdapServer else if classLdapServer null oldLdapServerDirService classLdapServer getDirectoryService classLdapServer setDirectoryService directoryService setLdapServer invoke getTestClass getJavaClass classLdapServer if methodKdcServer null methodKdcServer setDirectoryService directoryService setKdcServer invoke getTestClass getJavaClass methodKdcServer else if classKdcServer null oldKdcServerDirService classKdcServer getDirectoryService classKdcServer setDirectoryService directoryService setKdcServer invoke getTestClass getJavaClass classKdcServer super runChild method notifier
private long getCurrentRevision DirectoryService dirService throws Exception if dirService null dirService getChangeLog isEnabled long revision dirService getChangeLog getCurrentRevision
InstanceLayout layout new InstanceLayout instanceDirectory service new ApacheDsService try System out println service start layout true System out println catch Exception e LOG error e stop System exit ExitCodes START try System out println service repair layout System out println catch Exception e
public Integer start String args LOG info if args null int argNb for String arg args
initialized false aliasCache invalidateAll piarCache invalidateAll entryDnCache invalidateAll MultiException errors new MultiException I18n err I18n ERR_577 for Index String index userIndices values try index close partitionTxn LOG debug index getAttributeId suffixDn catch Throwable t LOG error I18n err I18n ERR_124 t errors addThrowable t for Index String index systemIndices values try index close partitionTxn
aliasCache invalidateAll piarCache invalidateAll entryDnCache invalidateAll MultiException errors new MultiException I18n err I18n ERR_577 for Index String index userIndices values try index close partitionTxn LOG debug index getAttributeId suffixDn catch Throwable t LOG error I18n err I18n ERR_124 t errors addThrowable t for Index String index systemIndices values try index close partitionTxn LOG debug index getAttributeId suffixDn
try index close partitionTxn LOG debug index getAttributeId suffixDn catch Throwable t LOG error I18n err I18n ERR_124 t errors addThrowable t for Index String index systemIndices values try index close partitionTxn LOG debug index getAttributeId suffixDn catch Throwable t LOG error I18n err I18n ERR_124 t errors addThrowable t try master close partitionTxn
LOG debug index getAttributeId suffixDn catch Throwable t LOG error I18n err I18n ERR_124 t errors addThrowable t for Index String index systemIndices values try index close partitionTxn LOG debug index getAttributeId suffixDn catch Throwable t LOG error I18n err I18n ERR_124 t errors addThrowable t try master close partitionTxn if LOG isDebugEnabled LOG debug I18n err I18n ERR_125 suffixDn
if ctxCsnChanged return String contextCsn super getContextCsn partitionTxn if contextCsn null return try String contextEntryId getEntryId partitionTxn getSuffixDn Entry origEntry fetch partitionTxn contextEntryId if origEntry null return origEntry ClonedServerEntry origEntry getOriginalEntry origEntry removeAttributes contextCsnAT entryDnAT origEntry add contextCsnAT contextCsn master put partitionTxn contextEntryId origEntry ctxCsnChanged false
optimizer annotate partitionTxn filter evaluator evaluatorBuilder build partitionTxn filter if evaluator null ScopeNode node new ScopeNode aliasDerefMode effectiveBase effectiveBaseId scope evaluator new BaseLevelScopeEvaluator db node indexEntry setEntry entry resultSet add indexEntry searchResult setEvaluator evaluator searchResult setResultSet resultSet return searchResult ExprNode root if filter ObjectClassNode root new ScopeNode aliasDerefMode effectiveBase effectiveBaseId scope else root new AndNode
